(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const YT="modulepreload",KT=function(i){return"/"+i},a2={},Yy=function(t,e,r){let s=Promise.resolve();if(e&&e.length>0){const n=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=Promise.all(e.map(f=>{if(f=KT(f),f in a2)return;a2[f]=!0;const y=f.endsWith(".css"),A=y?'[rel="stylesheet"]':"";if(!!r)for(let L=n.length-1;L>=0;L--){const D=n[L];if(D.href===f&&(!y||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${A}`))return;const P=document.createElement("link");if(P.rel=y?"stylesheet":YT,y||(P.as="script",P.crossOrigin=""),P.href=f,l&&P.setAttribute("nonce",l),document.head.appendChild(P),y)return new Promise((L,D)=>{P.addEventListener("load",L),P.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${f}`)))})}))}return s.then(()=>t()).catch(n=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n})};function QT(i,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in i)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(i,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}var wd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Im(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var dA={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(wd,function(){var e={},r={};function s(c,l,f){if(r[c]=f,c==="index"){var y="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",A={};return r.shared(A),r.index(e,A),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),e}}s("shared",["exports"],function(c){function l(h,o,u,p){return new(u||(u=Promise))(function(_,x){function S(N){try{R(p.next(N))}catch(q){x(q)}}function I(N){try{R(p.throw(N))}catch(q){x(q)}}function R(N){var q;N.done?_(N.value):(q=N.value,q instanceof u?q:new u(function(W){W(q)})).then(S,I)}R((p=p.apply(h,o||[])).next())})}function f(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var y=A;function A(h,o){this.x=h,this.y=o}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,o){return this.clone()._rotateAround(h,o)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var o=h.x-this.x,u=h.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,o){return Math.atan2(this.x*o-this.y*h,this.x*h+this.y*o)},_matMult:function(h){var o=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=o,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var o=Math.cos(h),u=Math.sin(h),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(h,o){var u=Math.cos(h),p=Math.sin(h),_=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(h){return h instanceof A?h:Array.isArray(h)?new A(h[0],h[1]):h};var T=f(y),P=L;function L(h,o,u,p){this.cx=3*h,this.bx=3*(u-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=o,this.p2x=u,this.p2y=p}L.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,o){if(o===void 0&&(o=1e-6),h<0)return 0;if(h>1)return 1;for(var u=h,p=0;p<8;p++){var _=this.sampleCurveX(u)-h;if(Math.abs(_)<o)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=_/x}var S=0,I=1;for(u=h,p=0;p<20&&(_=this.sampleCurveX(u),!(Math.abs(_-h)<o));p++)h>_?S=u:I=u,u=.5*(I-S)+S;return u},solve:function(h,o){return this.sampleCurveY(this.solveCurveX(h,o))}};var D=f(P);let j,X;function Z(){return j==null&&(j=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),j}function $(){if(X==null&&(X=!1,Z())){const h=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(h){for(let u=0;u<5*5;u++){const p=4*u;h.fillStyle=`rgb(${p},${p+1},${p+2})`,h.fillRect(u%5,Math.floor(u/5),1,1)}const o=h.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&o[u]!==u){X=!0;break}}}return X||!1}function ht(h,o,u,p){const _=new D(h,o,u,p);return x=>_.solve(x)}const _t=ht(.25,.1,.25,1);function Mt(h,o,u){return Math.min(u,Math.max(o,h))}function Nt(h,o,u){const p=u-o,_=((h-o)%p+p)%p+o;return _===o?u:_}function Rt(h){for(var o=arguments.length,u=new Array(o>1?o-1:0),p=1;p<o;p++)u[p-1]=arguments[p];for(const _ of u)for(const x in _)h[x]=_[x];return h}let xt=1;function qt(h,o,u){const p={};for(const _ in h)p[_]=o.call(this,h[_],_,h);return p}function zt(h,o,u){const p={};for(const _ in h)o.call(this,h[_],_,h)&&(p[_]=h[_]);return p}function ct(h){return Array.isArray(h)?h.map(ct):typeof h=="object"&&h?qt(h,ct):h}const pt={};function Bt(h){pt[h]||(typeof console<"u"&&console.warn(h),pt[h]=!0)}function bt(h,o,u){return(u.y-h.y)*(o.x-h.x)>(o.y-h.y)*(u.x-h.x)}function ne(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let oe=null;function le(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function fe(h,o,u,p,_){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(h,{timestamp:0});try{const S=x==null?void 0:x.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const I=S.startsWith("BGR"),R=new Uint8ClampedArray(p*_*4);if(yield x.copyTo(R,function(N,q,W,Y,it){const at=4*Math.max(-q,0),ft=(Math.max(0,W)-W)*Y*4+at,At=4*Y,It=Math.max(0,q),Zt=Math.max(0,W);return{rect:{x:It,y:Zt,width:Math.min(N.width,q+Y)-It,height:Math.min(N.height,W+it)-Zt},layout:[{offset:ft,stride:At}]}}(h,o,u,p,_)),I)for(let N=0;N<R.length;N+=4){const q=R[N];R[N]=R[N+2],R[N+2]=q}return R}finally{x.close()}})}let de,Me;const nt="AbortError";function Et(){return new Error(nt)}const Lt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Gt(h){return Lt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const Wt="global-dispatcher";class $t extends Error{constructor(o,u,p,_){super(`AJAXError: ${u} (${o}): ${p}`),this.status=o,this.statusText=u,this.url=p,this.body=_}}const ee=()=>ne(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Kt=function(h,o){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const p=Gt(h.url);if(p)return p(h,o);if(ne(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:Wt},o)}if(!(/^file:/.test(u=h.url)||/^file:/.test(ee())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,_){return l(this,void 0,void 0,function*(){const x=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:ee(),signal:_.signal});p.type==="json"&&x.headers.set("Accept","application/json");const S=yield fetch(x);if(!S.ok){const N=yield S.blob();throw new $t(S.status,S.statusText,p.url,N)}let I;I=p.type==="arrayBuffer"||p.type==="image"?S.arrayBuffer():p.type==="json"?S.json():S.text();const R=yield I;if(_.signal.aborted)throw Et();return{data:R,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}})}(h,o);if(ne(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:Wt},o)}var u;return function(p,_){return new Promise((x,S)=>{const I=new XMLHttpRequest;I.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(I.responseType="arraybuffer");for(const R in p.headers)I.setRequestHeader(R,p.headers[R]);p.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=p.credentials==="include",I.onerror=()=>{S(new Error(I.statusText))},I.onload=()=>{if(!_.signal.aborted)if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){let R=I.response;if(p.type==="json")try{R=JSON.parse(I.response)}catch(N){return void S(N)}x({data:R,cacheControl:I.getResponseHeader("Cache-Control"),expires:I.getResponseHeader("Expires")})}else{const R=new Blob([I.response],{type:I.getResponseHeader("Content-Type")});S(new $t(I.status,I.statusText,p.url,R))}},_.signal.addEventListener("abort",()=>{I.abort(),S(Et())}),I.send(p.body)})}(h,o)};function Ce(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const o=new URL(h),u=window.location;return o.protocol===u.protocol&&o.host===u.host}function Ie(h,o,u){u[h]&&u[h].indexOf(o)!==-1||(u[h]=u[h]||[],u[h].push(o))}function Re(h,o,u){if(u&&u[h]){const p=u[h].indexOf(o);p!==-1&&u[h].splice(p,1)}}class Fe{constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rt(this,u),this.type=o}}class Ze extends Fe{constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Rt({error:o},u))}}class he{on(o,u){return this._listeners=this._listeners||{},Ie(o,u,this._listeners),this}off(o,u){return Re(o,u,this._listeners),Re(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ie(o,u,this._oneTimeListeners),this):new Promise(p=>this.once(o,p))}fire(o,u){typeof o=="string"&&(o=new Fe(o,u||{}));const p=o.type;if(this.listens(p)){o.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of _)I.call(this,o);const x=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of x)Re(p,I,this._oneTimeListeners),I.call(this,o);const S=this._eventedParent;S&&(Rt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(o))}else o instanceof Ze&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var ot={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ri(h,o){const u={};for(const p in h)p!=="ref"&&(u[p]=h[p]);return mi.forEach(p=>{p in o&&(u[p]=o[p])}),u}function _e(h,o){if(Array.isArray(h)){if(!Array.isArray(o)||h.length!==o.length)return!1;for(let u=0;u<h.length;u++)if(!_e(h[u],o[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&o!==null){if(typeof o!="object"||Object.keys(h).length!==Object.keys(o).length)return!1;for(const u in h)if(!_e(h[u],o[u]))return!1;return!0}return h===o}function Se(h,o){h.push(o)}function Le(h,o,u){Se(u,{command:"addSource",args:[h,o[h]]})}function Ne(h,o,u){Se(o,{command:"removeSource",args:[h]}),u[h]=!0}function ci(h,o,u,p){Ne(h,u,p),Le(h,o,u)}function Ei(h,o,u){let p;for(p in h[u])if(Object.prototype.hasOwnProperty.call(h[u],p)&&p!=="data"&&!_e(h[u][p],o[u][p]))return!1;for(p in o[u])if(Object.prototype.hasOwnProperty.call(o[u],p)&&p!=="data"&&!_e(h[u][p],o[u][p]))return!1;return!0}function Ci(h,o,u,p,_,x){h=h||{},o=o||{};for(const S in h)Object.prototype.hasOwnProperty.call(h,S)&&(_e(h[S],o[S])||u.push({command:x,args:[p,S,o[S],_]}));for(const S in o)Object.prototype.hasOwnProperty.call(o,S)&&!Object.prototype.hasOwnProperty.call(h,S)&&(_e(h[S],o[S])||u.push({command:x,args:[p,S,o[S],_]}))}function Ii(h){return h.id}function Vi(h,o){return h[o.id]=o,h}class be{constructor(o,u,p,_){this.message=(o?`${o}: `:"")+p,_&&(this.identifier=_),u!=null&&u.__line__&&(this.line=u.__line__)}}function ai(h){for(var o=arguments.length,u=new Array(o>1?o-1:0),p=1;p<o;p++)u[p-1]=arguments[p];for(const _ of u)for(const x in _)h[x]=_[x];return h}class Ai extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}class De{constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=o,this.bindings={};for(const[p,_]of u)this.bindings[p]=_}concat(o){return new De(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Lr={kind:"null"},me={kind:"number"},vi={kind:"string"},He={kind:"boolean"},Di={kind:"color"},Mr={kind:"object"},je={kind:"value"},Ls={kind:"collator"},ir={kind:"formatted"},rr={kind:"padding"},vt={kind:"resolvedImage"},K={kind:"variableAnchorOffsetCollection"};function Q(h,o){return{kind:"array",itemType:h,N:o}}function rt(h){if(h.kind==="array"){const o=rt(h.itemType);return typeof h.N=="number"?`array<${o}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${o}>`}return h.kind}const Ct=[Lr,me,vi,He,Di,ir,Mr,Q(je),rr,vt,K];function kt(h,o){if(o.kind==="error")return null;if(h.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!kt(h.itemType,o.itemType))&&(typeof h.N!="number"||h.N===o.N))return null}else{if(h.kind===o.kind)return null;if(h.kind==="value"){for(const u of Ct)if(!kt(u,o))return null}}return`Expected ${rt(h)} but found ${rt(o)} instead.`}function Ut(h,o){return o.some(u=>u.kind===h.kind)}function Vt(h,o){return o.some(u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h)}function St(h,o){return h.kind==="array"&&o.kind==="array"?h.itemType.kind===o.itemType.kind&&typeof h.N=="number":h.kind===o.kind}const Jt=.96422,ge=.82521,ae=4/29,se=6/29,qe=3*se*se,$e=se*se*se,wi=Math.PI/180,si=180/Math.PI;function Si(h){return(h%=360)<0&&(h+=360),h}function ki(h){let[o,u,p,_]=h,x,S;const I=tr((.2225045*(o=qi(o))+.7168786*(u=qi(u))+.0606169*(p=qi(p)))/1);o===u&&u===p?x=S=I:(x=tr((.4360747*o+.3850649*u+.1430804*p)/Jt),S=tr((.0139322*o+.0971045*u+.7141733*p)/ge));const R=116*I-16;return[R<0?0:R,500*(x-I),200*(I-S),_]}function qi(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function tr(h){return h>$e?Math.pow(h,1/3):h/qe+ae}function pi(h){let[o,u,p,_]=h,x=(o+16)/116,S=isNaN(u)?x:x+u/500,I=isNaN(p)?x:x-p/200;return x=1*sr(x),S=Jt*sr(S),I=ge*sr(I),[Fi(3.1338561*S-1.6168667*x-.4906146*I),Fi(-.9787684*S+1.9161415*x+.033454*I),Fi(.0719453*S-.2289914*x+1.4052427*I),_]}function Fi(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function sr(h){return h>se?h*h*h:qe*(h-ae)}function Ar(h){return parseInt(h.padEnd(2,h),16)/255}function Qr(h,o){return nr(o?h/100:h,0,1)}function nr(h,o,u){return Math.min(Math.max(o,h),u)}function pn(h){return!h.some(Number.isNaN)}const Tl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Wi{constructor(o,u,p){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=o,this.g=u,this.b=p,this.a=_,x||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[o,u,p,_]))}static parse(o){if(o instanceof Wi)return o;if(typeof o!="string")return;const u=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Tl[p];if(_){const[S,I,R]=_;return[S/255,I/255,R/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const S=p.length<6?1:2;let I=1;return[Ar(p.slice(I,I+=S)),Ar(p.slice(I,I+=S)),Ar(p.slice(I,I+=S)),Ar(p.slice(I,I+S)||"ff")]}if(p.startsWith("rgb")){const S=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[I,R,N,q,W,Y,it,at,ft,At,It,Zt]=S,Ft=[q||" ",it||" ",At].join("");if(Ft==="  "||Ft==="  /"||Ft===",,"||Ft===",,,"){const Ht=[N,Y,ft].join(""),ye=Ht==="%%%"?100:Ht===""?255:0;if(ye){const ve=[nr(+R/ye,0,1),nr(+W/ye,0,1),nr(+at/ye,0,1),It?Qr(+It,Zt):1];if(pn(ve))return ve}}return}}const x=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[S,I,R,N,q,W,Y,it,at]=x,ft=[R||" ",q||" ",Y].join("");if(ft==="  "||ft==="  /"||ft===",,"||ft===",,,"){const At=[+I,nr(+N,0,100),nr(+W,0,100),it?Qr(+it,at):1];if(pn(At))return function(It){let[Zt,Ft,Ht,ye]=It;function ve(Ve){const ei=(Ve+Zt/30)%12,Ue=Ft*Math.min(Ht,1-Ht);return Ht-Ue*Math.max(-1,Math.min(ei-3,9-ei,1))}return Zt=Si(Zt),Ft/=100,Ht/=100,[ve(0),ve(8),ve(4),ye]}(At)}}}(o);return u?new Wi(...u,!1):void 0}get rgb(){const{r:o,g:u,b:p,a:_}=this,x=_||1/0;return this.overwriteGetter("rgb",[o/x,u/x,p/x,_])}get hcl(){return this.overwriteGetter("hcl",function(o){const[u,p,_,x]=ki(o),S=Math.sqrt(p*p+_*_);return[Math.round(1e4*S)?Si(Math.atan2(_,p)*si):NaN,S,u,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ki(this.rgb))}overwriteGetter(o,u){return Object.defineProperty(this,o,{value:u}),u}toString(){const[o,u,p,_]=this.rgb;return`rgba(${[o,u,p].map(x=>Math.round(255*x)).join(",")},${_})`}}Wi.black=new Wi(0,0,0,1),Wi.white=new Wi(1,1,1,1),Wi.transparent=new Wi(0,0,0,0),Wi.red=new Wi(1,0,0,1);class ms{constructor(o,u,p){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hs{constructor(o,u,p,_,x){this.text=o,this.image=u,this.scale=p,this.fontStack=_,this.textColor=x}}class Rr{constructor(o){this.sections=o}static fromString(o){return new Rr([new Hs(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Rr?o:Rr.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class kr{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof kr)return o;if(typeof o=="number")return new kr([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const u of o)if(typeof u!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new kr(o)}}toString(){return JSON.stringify(this.values)}}const In=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gr{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof gr)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let u=0;u<o.length;u+=2){const p=o[u],_=o[u+1];if(typeof p!="string"||!In.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new gr(o)}}toString(){return JSON.stringify(this.values)}}class Or{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Or({name:o,available:!1}):null}}function Ka(h,o,u,p){return typeof h=="number"&&h>=0&&h<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[h,o,u,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[h,o,u,p]:[h,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ms(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof Wi||h instanceof ms||h instanceof Rr||h instanceof kr||h instanceof gr||h instanceof Or)return!0;if(Array.isArray(h)){for(const o of h)if(!Ms(o))return!1;return!0}if(typeof h=="object"){for(const o in h)if(!Ms(h[o]))return!1;return!0}return!1}function Sr(h){if(h===null)return Lr;if(typeof h=="string")return vi;if(typeof h=="boolean")return He;if(typeof h=="number")return me;if(h instanceof Wi)return Di;if(h instanceof ms)return Ls;if(h instanceof Rr)return ir;if(h instanceof kr)return rr;if(h instanceof gr)return K;if(h instanceof Or)return vt;if(Array.isArray(h)){const o=h.length;let u;for(const p of h){const _=Sr(p);if(u){if(u===_)continue;u=je;break}u=_}return Q(u||je,o)}return Mr}function Ji(h){const o=typeof h;return h===null?"":o==="string"||o==="number"||o==="boolean"?String(h):h instanceof Wi||h instanceof Rr||h instanceof kr||h instanceof gr||h instanceof Or?h.toString():JSON.stringify(h)}class Ws{constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(o.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Ms(o[1]))return u.error("invalid value");const p=o[1];let _=Sr(p);const x=u.expectedType;return _.kind!=="array"||_.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(_=x),new Ws(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class mr{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Qs={string:vi,number:me,boolean:He,object:Mr};class us{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let p,_=1;const x=o[0];if(x==="array"){let I,R;if(o.length>2){const N=o[1];if(typeof N!="string"||!(N in Qs)||N==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);I=Qs[N],_++}else I=je;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=o[2],_++}p=Q(I,R)}else{if(!Qs[x])throw new Error(`Types doesn't contain name = ${x}`);p=Qs[x]}const S=[];for(;_<o.length;_++){const I=u.parse(o[_],_,je);if(!I)return null;S.push(I)}return new us(p,S)}evaluate(o){for(let u=0;u<this.args.length;u++){const p=this.args[u].evaluate(o);if(!kt(this.type,Sr(p)))return p;if(u===this.args.length-1)throw new mr(`Expected value to be of type ${rt(this.type)}, but found ${rt(Sr(p))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const wo={"to-boolean":He,"to-color":Di,"to-number":me,"to-string":vi};class Fr{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const p=o[0];if(!wo[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&o.length!==2)return u.error("Expected one argument.");const _=wo[p],x=[];for(let S=1;S<o.length;S++){const I=u.parse(o[S],S,je);if(!I)return null;x.push(I)}return new Fr(_,x)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let u,p;for(const _ of this.args){if(u=_.evaluate(o),p=null,u instanceof Wi)return u;if(typeof u=="string"){const x=o.parseColor(u);if(x)return x}else if(Array.isArray(u)&&(p=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Ka(u[0],u[1],u[2],u[3]),!p))return new Wi(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new mr(p||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const p of this.args){u=p.evaluate(o);const _=kr.parse(u);if(_)return _}throw new mr(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const p of this.args){u=p.evaluate(o);const _=gr.parse(u);if(_)return _}throw new mr(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const p of this.args){if(u=p.evaluate(o),u===null)return 0;const _=Number(u);if(!isNaN(_))return _}throw new mr(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Rr.fromString(Ji(this.args[0].evaluate(o)));case"resolvedImage":return Or.fromString(Ji(this.args[0].evaluate(o)));default:return Ji(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Bs=["Unknown","Point","LineString","Polygon"];class rs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Bs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Wi.parse(o)),u}}class Hi{constructor(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],_=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new De,S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=o,this.path=p,this.key=p.map(I=>`[${I}]`).join(""),this.scope=x,this.errors=S,this.expectedType=_,this._isConstant=u}parse(o,u,p,_){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return u?this.concat(u,p,_)._parse(o,x):this._parse(o,x)}_parse(o,u){function p(_,x,S){return S==="assert"?new us(x,[_]):S==="coerce"?new Fr(x,[_]):_}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=o[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[_];if(x){let S=x.parse(o,this);if(!S)return null;if(this.expectedType){const I=this.expectedType,R=S.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||R.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(I.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(I,R))return null}else S=p(S,I,u.typeAnnotation||"coerce");else S=p(S,I,u.typeAnnotation||"coerce");else S=p(S,I,u.typeAnnotation||"coerce");else S=p(S,I,u.typeAnnotation||"assert")}if(!(S instanceof Ws)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const I=new rs;try{S=new Ws(S.type,S.evaluate(I))}catch(R){return this.error(R.message),null}}return S}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,p){const _=typeof o=="number"?this.path.concat(o):this.path,x=p?this.scope.concat(p):this.scope;return new Hi(this.registry,this._isConstant,_,u||null,x,this.errors)}error(o){for(var u=arguments.length,p=new Array(u>1?u-1:0),_=1;_<u;_++)p[_-1]=arguments[_];const x=`${this.key}${p.map(S=>`[${S}]`).join("")}`;this.errors.push(new Ai(x,o))}checkSubtype(o,u){const p=kt(o,u);return p&&this.error(p),p}}class Kn{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const p=[];for(let x=1;x<o.length-1;x+=2){const S=o[x];if(typeof S!="string")return u.error(`Expected string, but found ${typeof S} instead.`,x);if(/[^a-zA-Z0-9_]/.test(S))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);const I=u.parse(o[x+1],x+1);if(!I)return null;p.push([S,I])}const _=u.parse(o[o.length-1],o.length-1,u.expectedType,p);return _?new Kn(p,_):null}outputDefined(){return this.result.outputDefined()}}class Qn{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const p=o[1];return u.scope.has(p)?new Qn(p,u.scope.get(p)):u.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class Aa{constructor(o,u,p){this.type=o,this.index=u,this.input=p}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,me),_=u.parse(o[2],2,Q(u.expectedType||je));return p&&_?new Aa(_.type.itemType,p,_):null}evaluate(o){const u=this.index.evaluate(o),p=this.input.evaluate(o);if(u<0)throw new mr(`Array index out of bounds: ${u} < 0.`);if(u>=p.length)throw new mr(`Array index out of bounds: ${u} > ${p.length-1}.`);if(u!==Math.floor(u))throw new mr(`Array index must be an integer, but found ${u} instead.`);return p[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class Sa{constructor(o,u){this.type=He,this.needle=o,this.haystack=u}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,je),_=u.parse(o[2],2,je);return p&&_?Ut(p.type,[He,vi,me,Lr,je])?new Sa(p,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${rt(p.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!p)return!1;if(!Vt(u,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${rt(Sr(u))} instead.`);if(!Vt(p,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${rt(Sr(p))} instead.`);return p.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class st{constructor(o,u,p){this.type=me,this.needle=o,this.haystack=u,this.fromIndex=p}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,je),_=u.parse(o[2],2,je);if(!p||!_)return null;if(!Ut(p.type,[He,vi,me,Lr,je]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${rt(p.type)} instead`);if(o.length===4){const x=u.parse(o[3],3,me);return x?new st(p,_,x):null}return new st(p,_)}evaluate(o){const u=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!Vt(u,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${rt(Sr(u))} instead.`);if(!Vt(p,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${rt(Sr(p))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(o);return p.indexOf(u,_)}return p.indexOf(u)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class yt{constructor(o,u,p,_,x,S){this.inputType=o,this.type=u,this.input=p,this.cases=_,this.outputs=x,this.otherwise=S}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let p,_;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);const x={},S=[];for(let N=2;N<o.length-1;N+=2){let q=o[N];const W=o[N+1];Array.isArray(q)||(q=[q]);const Y=u.concat(N);if(q.length===0)return Y.error("Expected at least one branch label.");for(const at of q){if(typeof at!="number"&&typeof at!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof at=="number"&&Math.abs(at)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof at=="number"&&Math.floor(at)!==at)return Y.error("Numeric branch labels must be integer values.");if(p){if(Y.checkSubtype(p,Sr(at)))return null}else p=Sr(at);if(x[String(at)]!==void 0)return Y.error("Branch labels must be unique.");x[String(at)]=S.length}const it=u.parse(W,N,_);if(!it)return null;_=_||it.type,S.push(it)}const I=u.parse(o[1],1,je);if(!I)return null;const R=u.parse(o[o.length-1],o.length-1,_);return R?I.type.kind!=="value"&&u.concat(1).checkSubtype(p,I.type)?null:new yt(p,_,I,x,S,R):null}evaluate(o){const u=this.input.evaluate(o);return(Sr(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class Ot{constructor(o,u,p){this.type=o,this.branches=u,this.otherwise=p}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);const _=[];for(let S=1;S<o.length-1;S+=2){const I=u.parse(o[S],S,He);if(!I)return null;const R=u.parse(o[S+1],S+1,p);if(!R)return null;_.push([I,R]),p=p||R.type}const x=u.parse(o[o.length-1],o.length-1,p);if(!x)return null;if(!p)throw new Error("Can't infer output type");return new Ot(p,_,x)}evaluate(o){for(const[u,p]of this.branches)if(u.evaluate(o))return p.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,p]of this.branches)o(u),o(p);o(this.otherwise)}outputDefined(){return this.branches.every(o=>{let[u,p]=o;return p.outputDefined()})&&this.otherwise.outputDefined()}}class ce{constructor(o,u,p,_){this.type=o,this.input=u,this.beginIndex=p,this.endIndex=_}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,je),_=u.parse(o[2],2,me);if(!p||!_)return null;if(!Ut(p.type,[Q(je),vi,je]))return u.error(`Expected first argument to be of type array or string, but found ${rt(p.type)} instead`);if(o.length===4){const x=u.parse(o[3],3,me);return x?new ce(p.type,p,_,x):null}return new ce(p.type,p,_)}evaluate(o){const u=this.input.evaluate(o),p=this.beginIndex.evaluate(o);if(!Vt(u,["string","array"]))throw new mr(`Expected first argument to be of type array or string, but found ${rt(Sr(u))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(o);return u.slice(p,_)}return u.slice(p)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Ee(h,o){const u=h.length-1;let p,_,x=0,S=u,I=0;for(;x<=S;)if(I=Math.floor((x+S)/2),p=h[I],_=h[I+1],p<=o){if(I===u||o<_)return I;x=I+1}else{if(!(p>o))throw new mr("Input is not a number.");S=I-1}return 0}class hi{constructor(o,u,p){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of p)this.labels.push(_),this.outputs.push(x)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const p=u.parse(o[1],1,me);if(!p)return null;const _=[];let x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(let S=1;S<o.length;S+=2){const I=S===1?-1/0:o[S],R=o[S+1],N=S,q=S+1;if(typeof I!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(_.length&&_[_.length-1][0]>=I)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const W=u.parse(R,q,x);if(!W)return null;x=x||W.type,_.push([I,W])}return new hi(x,p,_)}evaluate(o){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(o);const _=this.input.evaluate(o);if(_<=u[0])return p[0].evaluate(o);const x=u.length;return _>=u[x-1]?p[x-1].evaluate(o):p[Ee(u,_)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Ti(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var cr=ls;function ls(h,o,u,p){this.cx=3*h,this.bx=3*(u-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=o,this.p2x=u,this.p2y=p}ls.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,o){if(o===void 0&&(o=1e-6),h<0)return 0;if(h>1)return 1;for(var u=h,p=0;p<8;p++){var _=this.sampleCurveX(u)-h;if(Math.abs(_)<o)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=_/x}var S=0,I=1;for(u=h,p=0;p<20&&(_=this.sampleCurveX(u),!(Math.abs(_-h)<o));p++)h>_?S=u:I=u,u=.5*(I-S)+S;return u},solve:function(h,o){return this.sampleCurveY(this.solveCurveX(h,o))}};var ds=Ti(cr);function Qi(h,o,u){return h+u*(o-h)}function Pl(h,o,u){return h.map((p,_)=>Qi(p,o[_],u))}const ys={number:Qi,color:function(h,o,u){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[p,_,x,S]=Pl(h.rgb,o.rgb,u);return new Wi(p,_,x,S,!1)}case"hcl":{const[p,_,x,S]=h.hcl,[I,R,N,q]=o.hcl;let W,Y;if(isNaN(p)||isNaN(I))isNaN(p)?isNaN(I)?W=NaN:(W=I,x!==1&&x!==0||(Y=R)):(W=p,N!==1&&N!==0||(Y=_));else{let It=I-p;I>p&&It>180?It-=360:I<p&&p-I>180&&(It+=360),W=p+u*It}const[it,at,ft,At]=function(It){let[Zt,Ft,Ht,ye]=It;return Zt=isNaN(Zt)?0:Zt*wi,pi([Ht,Math.cos(Zt)*Ft,Math.sin(Zt)*Ft,ye])}([W,Y??Qi(_,R,u),Qi(x,N,u),Qi(S,q,u)]);return new Wi(it,at,ft,At,!1)}case"lab":{const[p,_,x,S]=pi(Pl(h.lab,o.lab,u));return new Wi(p,_,x,S,!1)}}},array:Pl,padding:function(h,o,u){return new kr(Pl(h.values,o.values,u))},variableAnchorOffsetCollection:function(h,o,u){const p=h.values,_=o.values;if(p.length!==_.length)throw new mr(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${o.toString()}`);const x=[];for(let S=0;S<p.length;S+=2){if(p[S]!==_[S])throw new mr(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${p[S]}, to[${S}]: ${_[S]}`);x.push(p[S]);const[I,R]=p[S+1],[N,q]=_[S+1];x.push([Qi(I,N,u),Qi(R,q,u)])}return new gr(x)}};class yi{constructor(o,u,p,_,x){this.type=o,this.operator=u,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[S,I]of x)this.labels.push(S),this.outputs.push(I)}static interpolationFactor(o,u,p,_){let x=0;if(o.name==="exponential")x=gc(u,o.base,p,_);else if(o.name==="linear")x=gc(u,1,p,_);else if(o.name==="cubic-bezier"){const S=o.controlPoints;x=new ds(S[0],S[1],S[2],S[3]).solve(gc(u,1,p,_))}return x}static parse(o,u){let[p,_,x,...S]=o;if(!Array.isArray(_)||_.length===0)return u.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const N=_[1];if(typeof N!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:N}}else{if(_[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const N=_.slice(1);if(N.length!==4||N.some(q=>typeof q!="number"||q<0||q>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:N}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(x=u.parse(x,2,me),!x)return null;const I=[];let R=null;p==="interpolate-hcl"||p==="interpolate-lab"?R=Di:u.expectedType&&u.expectedType.kind!=="value"&&(R=u.expectedType);for(let N=0;N<S.length;N+=2){const q=S[N],W=S[N+1],Y=N+3,it=N+4;if(typeof q!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(I.length&&I[I.length-1][0]>=q)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const at=u.parse(W,it,R);if(!at)return null;R=R||at.type,I.push([q,at])}return St(R,me)||St(R,Di)||St(R,rr)||St(R,K)||St(R,Q(me))?new yi(R,p,_,x,I):u.error(`Type ${rt(R)} is not interpolatable.`)}evaluate(o){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(o);const _=this.input.evaluate(o);if(_<=u[0])return p[0].evaluate(o);const x=u.length;if(_>=u[x-1])return p[x-1].evaluate(o);const S=Ee(u,_),I=yi.interpolationFactor(this.interpolation,_,u[S],u[S+1]),R=p[S].evaluate(o),N=p[S+1].evaluate(o);switch(this.operator){case"interpolate":return ys[this.type.kind](R,N,I);case"interpolate-hcl":return ys.color(R,N,I,"hcl");case"interpolate-lab":return ys.color(R,N,I,"lab")}}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function gc(h,o,u,p){const _=p-u,x=h-u;return _===0?0:o===1?x/_:(Math.pow(o,x)-1)/(Math.pow(o,_)-1)}class Il{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expectected at least one argument.");let p=null;const _=u.expectedType;_&&_.kind!=="value"&&(p=_);const x=[];for(const I of o.slice(1)){const R=u.parse(I,1+x.length,p,void 0,{typeAnnotation:"omit"});if(!R)return null;p=p||R.type,x.push(R)}if(!p)throw new Error("No output type");const S=_&&x.some(I=>kt(_,I.type));return new Il(S?je:p,x)}evaluate(o){let u,p=null,_=0;for(const x of this.args)if(_++,p=x.evaluate(o),p&&p instanceof Or&&!p.available&&(u||(u=p.name),p=null,_===this.args.length&&(p=u)),p!==null)break;return p}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}function Ln(h,o){return h==="=="||h==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ll(h,o,u,p){return p.compare(o,u)===0}function Ho(h,o,u){const p=h!=="=="&&h!=="!=";return class pA{constructor(x,S,I){this.type=He,this.lhs=x,this.rhs=S,this.collator=I,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}static parse(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");const I=x[0];let R=S.parse(x[1],1,je);if(!R)return null;if(!Ln(I,R.type))return S.concat(1).error(`"${I}" comparisons are not supported for type '${rt(R.type)}'.`);let N=S.parse(x[2],2,je);if(!N)return null;if(!Ln(I,N.type))return S.concat(2).error(`"${I}" comparisons are not supported for type '${rt(N.type)}'.`);if(R.type.kind!==N.type.kind&&R.type.kind!=="value"&&N.type.kind!=="value")return S.error(`Cannot compare types '${rt(R.type)}' and '${rt(N.type)}'.`);p&&(R.type.kind==="value"&&N.type.kind!=="value"?R=new us(N.type,[R]):R.type.kind!=="value"&&N.type.kind==="value"&&(N=new us(R.type,[N])));let q=null;if(x.length===4){if(R.type.kind!=="string"&&N.type.kind!=="string"&&R.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(q=S.parse(x[3],3,Ls),!q)return null}return new pA(R,N,q)}evaluate(x){const S=this.lhs.evaluate(x),I=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){const R=Sr(S),N=Sr(I);if(R.kind!==N.kind||R.kind!=="string"&&R.kind!=="number")throw new mr(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${R.kind}, ${N.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const R=Sr(S),N=Sr(I);if(R.kind!=="string"||N.kind!=="string")return o(x,S,I)}return this.collator?u(x,S,I,this.collator.evaluate(x)):o(x,S,I)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Ml=Ho("==",function(h,o,u){return o===u},Ll),Bl=Ho("!=",function(h,o,u){return o!==u},function(h,o,u,p){return!Ll(0,o,u,p)}),Kc=Ho("<",function(h,o,u){return o<u},function(h,o,u,p){return p.compare(o,u)<0}),$h=Ho(">",function(h,o,u){return o>u},function(h,o,u,p){return p.compare(o,u)>0}),Yh=Ho("<=",function(h,o,u){return o<=u},function(h,o,u,p){return p.compare(o,u)<=0}),mc=Ho(">=",function(h,o,u){return o>=u},function(h,o,u,p){return p.compare(o,u)>=0});class xo{constructor(o,u,p){this.type=Ls,this.locale=p,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(o.length!==2)return u.error("Expected one argument.");const p=o[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");const _=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,He);if(!_)return null;const x=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,He);if(!x)return null;let S=null;return p.locale&&(S=u.parse(p.locale,1,vi),!S)?null:new xo(_,x,S)}evaluate(o){return new ms(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}class Ao{constructor(o,u,p,_,x){this.type=vi,this.number=o,this.locale=u,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(o,u){if(o.length!==3)return u.error("Expected two arguments.");const p=u.parse(o[1],1,me);if(!p)return null;const _=o[2];if(typeof _!="object"||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let x=null;if(_.locale&&(x=u.parse(_.locale,1,vi),!x))return null;let S=null;if(_.currency&&(S=u.parse(_.currency,1,vi),!S))return null;let I=null;if(_["min-fraction-digits"]&&(I=u.parse(_["min-fraction-digits"],1,me),!I))return null;let R=null;return _["max-fraction-digits"]&&(R=u.parse(_["max-fraction-digits"],1,me),!R)?null:new Ao(p,x,S,I,R)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Rl{constructor(o){this.type=ir,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const p=o[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");const _=[];let x=!1;for(let S=1;S<=o.length-1;++S){const I=o[S];if(x&&typeof I=="object"&&!Array.isArray(I)){x=!1;let R=null;if(I["font-scale"]&&(R=u.parse(I["font-scale"],1,me),!R))return null;let N=null;if(I["text-font"]&&(N=u.parse(I["text-font"],1,Q(vi)),!N))return null;let q=null;if(I["text-color"]&&(q=u.parse(I["text-color"],1,Di),!q))return null;const W=_[_.length-1];W.scale=R,W.font=N,W.textColor=q}else{const R=u.parse(o[S],1,je);if(!R)return null;const N=R.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,_.push({content:R,scale:null,font:null,textColor:null})}}return new Rl(_)}evaluate(o){return new Rr(this.sections.map(u=>{const p=u.content.evaluate(o);return Sr(p)===vt?new Hs("",p,null,null,null):new Hs(Ji(p),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor)}outputDefined(){return!1}}class Wo{constructor(o){this.type=vt,this.input=o}static parse(o,u){if(o.length!==2)return u.error("Expected two arguments.");const p=u.parse(o[1],1,vi);return p?new Wo(p):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),p=Or.fromString(u);return p&&o.availableImages&&(p.available=o.availableImages.indexOf(u)>-1),p}eachChild(o){o(this.input)}outputDefined(){return!1}}class Jo{constructor(o){this.type=me,this.input=o}static parse(o,u){if(o.length!==2)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const p=u.parse(o[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${rt(p.type)} instead.`):new Jo(p):null}evaluate(o){const u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new mr(`Expected value to be of type string or array, but found ${rt(Sr(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const _s=8192;function Yi(h,o){const u=(180+h[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(u*_*_s),Math.round(p*_*_s)]}function kl(h,o){const u=Math.pow(2,o.z);return[(_=(h[0]/_s+o.x)/u,360*_-180),(p=(h[1]/_s+o.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,_}function Ea(h,o){h[0]=Math.min(h[0],o[0]),h[1]=Math.min(h[1],o[1]),h[2]=Math.max(h[2],o[0]),h[3]=Math.max(h[3],o[1])}function Ca(h,o){return!(h[0]<=o[0]||h[2]>=o[2]||h[1]<=o[1]||h[3]>=o[3])}function Xo(h,o,u){const p=h[0]-o[0],_=h[1]-o[1],x=h[0]-u[0],S=h[1]-u[1];return p*S-x*_==0&&p*x<=0&&_*S<=0}function to(h,o,u,p){return(_=[p[0]-u[0],p[1]-u[1]])[0]*(x=[o[0]-h[0],o[1]-h[1]])[1]-_[1]*x[0]!=0&&!(!Qc(h,o,u,p)||!Qc(u,p,h,o));var _,x}function Kh(h,o,u){for(const p of u)for(let _=0;_<p.length-1;++_)if(to(h,o,p[_],p[_+1]))return!0;return!1}function fn(h,o){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=!1;for(const I of o)for(let R=0;R<I.length-1;R++){if(Xo(h,I[R],I[R+1]))return u;(x=I[R])[1]>(_=h)[1]!=(S=I[R+1])[1]>_[1]&&_[0]<(S[0]-x[0])*(_[1]-x[1])/(S[1]-x[1])+x[0]&&(p=!p)}var _,x,S;return p}function eo(h,o){for(const u of o)if(fn(h,u))return!0;return!1}function Ol(h,o){for(const u of h)if(!fn(u,o))return!1;for(let u=0;u<h.length-1;++u)if(Kh(h[u],h[u+1],o))return!1;return!0}function Qa(h,o){for(const u of o)if(Ol(h,u))return!0;return!1}function Qc(h,o,u,p){const _=p[0]-u[0],x=p[1]-u[1],S=(h[0]-u[0])*x-_*(h[1]-u[1]),I=(o[0]-u[0])*x-_*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function Ta(h,o,u){const p=[];for(let _=0;_<h.length;_++){const x=[];for(let S=0;S<h[_].length;S++){const I=Yi(h[_][S],u);Ea(o,I),x.push(I)}p.push(x)}return p}function th(h,o,u){const p=[];for(let _=0;_<h.length;_++){const x=Ta(h[_],o,u);p.push(x)}return p}function Fl(h,o,u,p){if(h[0]<u[0]||h[0]>u[2]){const _=.5*p;let x=h[0]-u[0]>_?-p:u[0]-h[0]>_?p:0;x===0&&(x=h[0]-u[2]>_?-p:u[2]-h[0]>_?p:0),h[0]+=x}Ea(o,h)}function Nl(h,o,u,p){const _=Math.pow(2,p.z)*_s,x=[p.x*_s,p.y*_s],S=[];for(const I of h)for(const R of I){const N=[R.x+x[0],R.y+x[1]];Fl(N,o,u,_),S.push(N)}return S}function yc(h,o,u,p){const _=Math.pow(2,p.z)*_s,x=[p.x*_s,p.y*_s],S=[];for(const R of h){const N=[];for(const q of R){const W=[q.x+x[0],q.y+x[1]];Ea(o,W),N.push(W)}S.push(N)}if(o[2]-o[0]<=_/2){(I=o)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const R of S)for(const N of R)Fl(N,o,u,_)}var I;return S}class Mn{constructor(o,u){this.type=He,this.geojson=o,this.geometries=u}static parse(o,u){if(o.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Ms(o[1])){const p=o[1];if(p.type==="FeatureCollection"){const _=[];for(const x of p.features){const{type:S,coordinates:I}=x.geometry;S==="Polygon"&&_.push(I),S==="MultiPolygon"&&_.push(...I)}if(_.length)return new Mn(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Mn(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Mn(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(p.type==="Polygon"){const I=Ta(p.coordinates,x,S),R=Nl(u.geometry(),_,x,S);if(!Ca(_,x))return!1;for(const N of R)if(!fn(N,I))return!1}if(p.type==="MultiPolygon"){const I=th(p.coordinates,x,S),R=Nl(u.geometry(),_,x,S);if(!Ca(_,x))return!1;for(const N of R)if(!eo(N,I))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(p.type==="Polygon"){const I=Ta(p.coordinates,x,S),R=yc(u.geometry(),_,x,S);if(!Ca(_,x))return!1;for(const N of R)if(!Ol(N,I))return!1}if(p.type==="MultiPolygon"){const I=th(p.coordinates,x,S),R=yc(u.geometry(),_,x,S);if(!Ca(_,x))return!1;for(const N of R)if(!Qa(N,I))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dl=class{constructor(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_c;if(this.data=h,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const h=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:o,compare:u}=this,p=o[h];for(;h>0;){const _=h-1>>1,x=o[_];if(u(p,x)>=0)break;o[h]=x,h=_}o[h]=p}_down(h){const{data:o,compare:u}=this,p=this.length>>1,_=o[h];for(;h<p;){let x=1+(h<<1),S=o[x];const I=x+1;if(I<this.length&&u(o[I],S)<0&&(x=I,S=o[I]),u(S,_)>=0)break;o[h]=S,h=x}o[h]=_}};function _c(h,o){return h<o?-1:h>o?1:0}function eh(h,o,u,p,_){ih(h,o,u,p||h.length-1,_||tl)}function ih(h,o,u,p,_){for(;p>u;){if(p-u>600){var x=p-u+1,S=o-u+1,I=Math.log(x),R=.5*Math.exp(2*I/3),N=.5*Math.sqrt(I*R*(x-R)/x)*(S-x/2<0?-1:1);ih(h,o,Math.max(u,Math.floor(o-S*R/x+N)),Math.min(p,Math.floor(o+(x-S)*R/x+N)),_)}var q=h[o],W=u,Y=p;for(So(h,u,o),_(h[p],q)>0&&So(h,u,p);W<Y;){for(So(h,W,Y),W++,Y--;_(h[W],q)<0;)W++;for(;_(h[Y],q)>0;)Y--}_(h[u],q)===0?So(h,u,Y):So(h,++Y,p),Y<=o&&(u=Y+1),o<=Y&&(p=Y-1)}}function So(h,o,u){var p=h[o];h[o]=h[u],h[u]=p}function tl(h,o){return h<o?-1:h>o?1:0}function Pa(h,o){if(h.length<=1)return[h];const u=[];let p,_;for(const x of h){const S=vc(x);S!==0&&(x.area=Math.abs(S),_===void 0&&(_=S<0),_===S<0?(p&&u.push(p),p=[x]):p.push(x))}if(p&&u.push(p),o>1)for(let x=0;x<u.length;x++)u[x].length<=o||(eh(u[x],o,1,u[x].length-1,Ia),u[x]=u[x].slice(0,o));return u}function Ia(h,o){return o.area-h.area}function vc(h){let o=0;for(let u,p,_=0,x=h.length,S=x-1;_<x;S=_++)u=h[_],p=h[S],o+=(p.x-u.x)*(u.y+p.y);return o}const F=1/298.257223563,et=F*(2-F),Pt=Math.PI/180;class jt{constructor(o){const u=6378.137*Pt*1e3,p=Math.cos(o*Pt),_=1/(1-et*(1-p*p)),x=Math.sqrt(_);this.kx=u*x*p,this.ky=u*x*_*(1-et)}distance(o,u){const p=this.wrap(o[0]-u[0])*this.kx,_=(o[1]-u[1])*this.ky;return Math.sqrt(p*p+_*_)}pointOnLine(o,u){let p,_,x,S,I=1/0;for(let R=0;R<o.length-1;R++){let N=o[R][0],q=o[R][1],W=this.wrap(o[R+1][0]-N)*this.kx,Y=(o[R+1][1]-q)*this.ky,it=0;W===0&&Y===0||(it=(this.wrap(u[0]-N)*this.kx*W+(u[1]-q)*this.ky*Y)/(W*W+Y*Y),it>1?(N=o[R+1][0],q=o[R+1][1]):it>0&&(N+=W/this.kx*it,q+=Y/this.ky*it)),W=this.wrap(u[0]-N)*this.kx,Y=(u[1]-q)*this.ky;const at=W*W+Y*Y;at<I&&(I=at,p=N,_=q,x=R,S=it)}return{point:[p,_],index:x,t:Math.max(0,Math.min(1,S))}}wrap(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}}function Yt(h,o){return o[0]-h[0]}function pe(h){return h[1]-h[0]+1}function Te(h,o){return h[1]>=h[0]&&h[1]<o}function Ye(h,o){if(h[0]>h[1])return[null,null];const u=pe(h);if(o){if(u===2)return[h,null];const _=Math.floor(u/2);return[[h[0],h[0]+_],[h[0]+_,h[1]]]}if(u===1)return[h,null];const p=Math.floor(u/2)-1;return[[h[0],h[0]+p],[h[0]+p+1,h[1]]]}function bi(h,o){if(!Te(o,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let p=o[0];p<=o[1];++p)Ea(u,h[p]);return u}function Li(h){const o=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const p of u)Ea(o,p);return o}function ui(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Xi(h,o,u){if(!ui(h)||!ui(o))return NaN;let p=0,_=0;return h[2]<o[0]&&(p=o[0]-h[2]),h[0]>o[2]&&(p=h[0]-o[2]),h[1]>o[3]&&(_=h[1]-o[3]),h[3]<o[1]&&(_=o[1]-h[3]),u.distance([0,0],[p,_])}function ni(h,o,u){const p=u.pointOnLine(o,h);return u.distance(h,p.point)}function Nr(h,o,u,p,_){const x=Math.min(ni(h,[u,p],_),ni(o,[u,p],_)),S=Math.min(ni(u,[h,o],_),ni(p,[h,o],_));return Math.min(x,S)}function Oi(h,o,u,p,_){if(!Te(o,h.length)||!Te(p,u.length))return 1/0;let x=1/0;for(let S=o[0];S<o[1];++S){const I=h[S],R=h[S+1];for(let N=p[0];N<p[1];++N){const q=u[N],W=u[N+1];if(to(I,R,q,W))return 0;x=Math.min(x,Nr(I,R,q,W,_))}}return x}function zi(h,o,u,p,_){if(!Te(o,h.length)||!Te(p,u.length))return NaN;let x=1/0;for(let S=o[0];S<=o[1];++S)for(let I=p[0];I<=p[1];++I)if(x=Math.min(x,_.distance(h[S],u[I])),x===0)return x;return x}function ss(h,o,u){if(fn(h,o,!0))return 0;let p=1/0;for(const _ of o){const x=_[0],S=_[_.length-1];if(x!==S&&(p=Math.min(p,ni(h,[S,x],u)),p===0))return p;const I=u.pointOnLine(_,h);if(p=Math.min(p,u.distance(h,I.point)),p===0)return p}return p}function Bn(h,o,u,p){if(!Te(o,h.length))return NaN;for(let x=o[0];x<=o[1];++x)if(fn(h[x],u,!0))return 0;let _=1/0;for(let x=o[0];x<o[1];++x){const S=h[x],I=h[x+1];for(const R of u)for(let N=0,q=R.length,W=q-1;N<q;W=N++){const Y=R[W],it=R[N];if(to(S,I,Y,it))return 0;_=Math.min(_,Nr(S,I,Y,it,p))}}return _}function gn(h,o){for(const u of h)for(const p of u)if(fn(p,o,!0))return!0;return!1}function Zo(h,o,u){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const _=Li(h),x=Li(o);if(p!==1/0&&Xi(_,x,u)>=p)return p;if(Ca(_,x)){if(gn(h,o))return 0}else if(gn(o,h))return 0;let S=1/0;for(const I of h)for(let R=0,N=I.length,q=N-1;R<N;q=R++){const W=I[q],Y=I[R];for(const it of o)for(let at=0,ft=it.length,At=ft-1;at<ft;At=at++){const It=it[At],Zt=it[at];if(to(W,Y,It,Zt))return 0;S=Math.min(S,Nr(W,Y,It,Zt,u))}}return S}function bc(h,o,u,p,_,x){if(!x)return;const S=Xi(bi(p,x),_,u);S<o&&h.push([S,x,[0,0]])}function La(h,o,u,p,_,x,S){if(!x||!S)return;const I=Xi(bi(p,x),bi(_,S),u);I<o&&h.push([I,x,S])}function $o(h,o,u,p){let _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,x=Math.min(p.distance(h[0],u[0][0]),_);if(x===0)return x;const S=new Dl([[0,[0,h.length-1],[0,0]]],Yt),I=Li(u);for(;S.length>0;){const R=S.pop();if(R[0]>=x)continue;const N=R[1],q=o?50:100;if(pe(N)<=q){if(!Te(N,h.length))return NaN;if(o){const W=Bn(h,N,u,p);if(isNaN(W)||W===0)return W;x=Math.min(x,W)}else for(let W=N[0];W<=N[1];++W){const Y=ss(h[W],u,p);if(x=Math.min(x,Y),x===0)return 0}}else{const W=Ye(N,o);bc(S,x,p,h,I,W[0]),bc(S,x,p,h,I,W[1])}}return x}function Eo(h,o,u,p,_){let x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,S=Math.min(x,_.distance(h[0],u[0]));if(S===0)return S;const I=new Dl([[0,[0,h.length-1],[0,u.length-1]]],Yt);for(;I.length>0;){const R=I.pop();if(R[0]>=S)continue;const N=R[1],q=R[2],W=o?50:100,Y=p?50:100;if(pe(N)<=W&&pe(q)<=Y){if(!Te(N,h.length)&&Te(q,u.length))return NaN;let it;if(o&&p)it=Oi(h,N,u,q,_),S=Math.min(S,it);else if(o&&!p){const at=h.slice(N[0],N[1]+1);for(let ft=q[0];ft<=q[1];++ft)if(it=ni(u[ft],at,_),S=Math.min(S,it),S===0)return S}else if(!o&&p){const at=u.slice(q[0],q[1]+1);for(let ft=N[0];ft<=N[1];++ft)if(it=ni(h[ft],at,_),S=Math.min(S,it),S===0)return S}else it=zi(h,N,u,q,_),S=Math.min(S,it)}else{const it=Ye(N,o),at=Ye(q,p);La(I,S,_,h,u,it[0],at[0]),La(I,S,_,h,u,it[0],at[1]),La(I,S,_,h,u,it[1],at[0]),La(I,S,_,h,u,it[1],at[1])}}return S}function Ma(h){return h.type==="MultiPolygon"?h.coordinates.map(o=>({type:"Polygon",coordinates:o})):h.type==="MultiLineString"?h.coordinates.map(o=>({type:"LineString",coordinates:o})):h.type==="MultiPoint"?h.coordinates.map(o=>({type:"Point",coordinates:o})):[h]}class Rn{constructor(o,u){this.type=me,this.geojson=o,this.geometries=u}static parse(o,u){if(o.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Ms(o[1])){const p=o[1];if(p.type==="FeatureCollection")return new Rn(p,p.features.map(_=>Ma(_.geometry)).flat());if(p.type==="Feature")return new Rn(p,Ma(p.geometry));if("type"in p&&"coordinates"in p)return new Rn(p,Ma(p))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,p){const _=u.geometry(),x=_.flat().map(R=>kl([R.x,R.y],u.canonical));if(_.length===0)return NaN;const S=new jt(x[0][1]);let I=1/0;for(const R of p){switch(R.type){case"Point":I=Math.min(I,Eo(x,!1,[R.coordinates],!1,S,I));break;case"LineString":I=Math.min(I,Eo(x,!1,R.coordinates,!0,S,I));break;case"Polygon":I=Math.min(I,$o(x,!1,R.coordinates,S,I))}if(I===0)return I}return I}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,p){const _=u.geometry(),x=_.flat().map(R=>kl([R.x,R.y],u.canonical));if(_.length===0)return NaN;const S=new jt(x[0][1]);let I=1/0;for(const R of p){switch(R.type){case"Point":I=Math.min(I,Eo(x,!0,[R.coordinates],!1,S,I));break;case"LineString":I=Math.min(I,Eo(x,!0,R.coordinates,!0,S,I));break;case"Polygon":I=Math.min(I,$o(x,!0,R.coordinates,S,I))}if(I===0)return I}return I}(o,this.geometries);if(o.geometryType()==="Polygon")return function(u,p){const _=u.geometry();if(_.length===0||_[0].length===0)return NaN;const x=Pa(_,0).map(R=>R.map(N=>N.map(q=>kl([q.x,q.y],u.canonical)))),S=new jt(x[0][0][0][1]);let I=1/0;for(const R of p)for(const N of x){switch(R.type){case"Point":I=Math.min(I,$o([R.coordinates],!1,N,S,I));break;case"LineString":I=Math.min(I,$o(R.coordinates,!0,N,S,I));break;case"Polygon":I=Math.min(I,Zo(N,R.coordinates,S,I))}if(I===0)return I}return I}(o,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const mn={"==":Ml,"!=":Bl,">":$h,"<":Kc,">=":mc,"<=":Yh,array:us,at:Aa,boolean:us,case:Ot,coalesce:Il,collator:xo,format:Rl,image:Wo,in:Sa,"index-of":st,interpolate:yi,"interpolate-hcl":yi,"interpolate-lab":yi,length:Jo,let:Kn,literal:Ws,match:yt,number:us,"number-format":Ao,object:us,slice:ce,step:hi,string:us,"to-boolean":Fr,"to-color":Fr,"to-number":Fr,"to-string":Fr,var:Qn,within:Mn,distance:Rn};class Dr{constructor(o,u,p,_){this.name=o,this.type=u,this._evaluate=p,this.args=_}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,u){const p=o[0],_=Dr.definitions[p];if(!_)return u.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(_)?_[0]:_.type,S=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,I=S.filter(N=>{let[q]=N;return!Array.isArray(q)||q.length===o.length-1});let R=null;for(const[N,q]of I){R=new Hi(u.registry,Rs,u.path,null,u.scope);const W=[];let Y=!1;for(let it=1;it<o.length;it++){const at=o[it],ft=Array.isArray(N)?N[it-1]:N.type,At=R.parse(at,1+W.length,ft);if(!At){Y=!0;break}W.push(At)}if(!Y)if(Array.isArray(N)&&N.length!==W.length)R.error(`Expected ${N.length} arguments, but found ${W.length} instead.`);else{for(let it=0;it<W.length;it++){const at=Array.isArray(N)?N[it]:N.type,ft=W[it];R.concat(it+1).checkSubtype(at,ft.type)}if(R.errors.length===0)return new Dr(p,x,q,W)}}if(I.length===1)u.errors.push(...R.errors);else{const N=(I.length?I:S).map(W=>{let[Y]=W;return it=Y,Array.isArray(it)?`(${it.map(rt).join(", ")})`:`(${rt(it.type)}...)`;var it}).join(" | "),q=[];for(let W=1;W<o.length;W++){const Y=u.parse(o[W],1+q.length);if(!Y)return null;q.push(rt(Y.type))}u.error(`Expected arguments of type ${N}, but found (${q.join(", ")}) instead.`)}return null}static register(o,u){Dr.definitions=u;for(const p in u)o[p]=Dr}}function el(h,o){let[u,p,_,x]=o;u=u.evaluate(h),p=p.evaluate(h),_=_.evaluate(h);const S=x?x.evaluate(h):1,I=Ka(u,p,_,S);if(I)throw new mr(I);return new Wi(u/255,p/255,_/255,S,!1)}function il(h,o){return h in o}function Ba(h,o){const u=o[h];return u===void 0?null:u}function io(h){return{type:h}}function Rs(h){if(h instanceof Qn)return Rs(h.boundExpression);if(h instanceof Dr&&h.name==="error"||h instanceof xo||h instanceof Mn||h instanceof Rn)return!1;const o=h instanceof Fr||h instanceof us;let u=!0;return h.eachChild(p=>{u=o?u&&Rs(p):u&&p instanceof Ws}),!!u&&zl(h)&&Ra(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zl(h){if(h instanceof Dr&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Mn||h instanceof Rn)return!1;let o=!0;return h.eachChild(u=>{o&&!zl(u)&&(o=!1)}),o}function Yo(h){if(h instanceof Dr&&h.name==="feature-state")return!1;let o=!0;return h.eachChild(u=>{o&&!Yo(u)&&(o=!1)}),o}function Ra(h,o){if(h instanceof Dr&&o.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild(p=>{u&&!Ra(p,o)&&(u=!1)}),u}function yn(h){return{result:"success",value:h}}function _n(h){return{result:"error",value:h}}function ka(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function wc(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Co(h){return!!h.expression&&h.expression.interpolated}function Pi(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function ks(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function ro(h){return h}function kn(h,o){const u=o.type==="color",p=h.stops&&typeof h.stops[0][0]=="object",_=p||!(p||h.property!==void 0),x=h.type||(Co(o)?"exponential":"interval");if(u||o.type==="padding"){const q=u?Wi.parse:kr.parse;(h=ai({},h)).stops&&(h.stops=h.stops.map(W=>[W[0],q(W[1])])),h.default=q(h.default?h.default:o.default)}if(h.colorSpace&&(S=h.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var S;let I,R,N;if(x==="exponential")I=To;else if(x==="interval")I=On;else if(x==="categorical"){I=rl,R=Object.create(null);for(const q of h.stops)R[q[0]]=q[1];N=typeof h.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);I=xc}if(p){const q={},W=[];for(let at=0;at<h.stops.length;at++){const ft=h.stops[at],At=ft[0].zoom;q[At]===void 0&&(q[At]={zoom:At,type:h.type,property:h.property,default:h.default,stops:[]},W.push(At)),q[At].stops.push([ft[0].value,ft[1]])}const Y=[];for(const at of W)Y.push([q[at].zoom,kn(q[at],o)]);const it={name:"linear"};return{kind:"composite",interpolationType:it,interpolationFactor:yi.interpolationFactor.bind(void 0,it),zoomStops:Y.map(at=>at[0]),evaluate:(at,ft)=>{let{zoom:At}=at;return To({stops:Y,base:h.base},o,At).evaluate(At,ft)}}}if(_){const q=x==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:yi.interpolationFactor.bind(void 0,q),zoomStops:h.stops.map(W=>W[0]),evaluate:W=>{let{zoom:Y}=W;return I(h,o,Y,R,N)}}}return{kind:"source",evaluate(q,W){const Y=W&&W.properties?W.properties[h.property]:void 0;return Y===void 0?Js(h.default,o.default):I(h,o,Y,R,N)}}}function Js(h,o,u){return h!==void 0?h:o!==void 0?o:u!==void 0?u:void 0}function rl(h,o,u,p,_){return Js(typeof u===_?p[u]:void 0,h.default,o.default)}function On(h,o,u){if(Pi(u)!=="number")return Js(h.default,o.default);const p=h.stops.length;if(p===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[p-1][0])return h.stops[p-1][1];const _=Ee(h.stops.map(x=>x[0]),u);return h.stops[_][1]}function To(h,o,u){const p=h.base!==void 0?h.base:1;if(Pi(u)!=="number")return Js(h.default,o.default);const _=h.stops.length;if(_===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[_-1][0])return h.stops[_-1][1];const x=Ee(h.stops.map(q=>q[0]),u),S=function(q,W,Y,it){const at=it-Y,ft=q-Y;return at===0?0:W===1?ft/at:(Math.pow(W,ft)-1)/(Math.pow(W,at)-1)}(u,p,h.stops[x][0],h.stops[x+1][0]),I=h.stops[x][1],R=h.stops[x+1][1],N=ys[o.type]||ro;return typeof I.evaluate=="function"?{evaluate(){for(var q=arguments.length,W=new Array(q),Y=0;Y<q;Y++)W[Y]=arguments[Y];const it=I.evaluate.apply(void 0,W),at=R.evaluate.apply(void 0,W);if(it!==void 0&&at!==void 0)return N(it,at,S,h.colorSpace)}}:N(I,R,S,h.colorSpace)}function xc(h,o,u){switch(o.type){case"color":u=Wi.parse(u);break;case"formatted":u=Rr.fromString(u.toString());break;case"resolvedImage":u=Or.fromString(u.toString());break;case"padding":u=kr.parse(u);break;default:Pi(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0)}return Js(u,h.default,o.default)}Dr.register(mn,{error:[{kind:"error"},[vi],(h,o)=>{let[u]=o;throw new mr(u.evaluate(h))}],typeof:[vi,[je],(h,o)=>{let[u]=o;return rt(Sr(u.evaluate(h)))}],"to-rgba":[Q(me,4),[Di],(h,o)=>{let[u]=o;const[p,_,x,S]=u.evaluate(h).rgb;return[255*p,255*_,255*x,S]}],rgb:[Di,[me,me,me],el],rgba:[Di,[me,me,me,me],el],has:{type:He,overloads:[[[vi],(h,o)=>{let[u]=o;return il(u.evaluate(h),h.properties())}],[[vi,Mr],(h,o)=>{let[u,p]=o;return il(u.evaluate(h),p.evaluate(h))}]]},get:{type:je,overloads:[[[vi],(h,o)=>{let[u]=o;return Ba(u.evaluate(h),h.properties())}],[[vi,Mr],(h,o)=>{let[u,p]=o;return Ba(u.evaluate(h),p.evaluate(h))}]]},"feature-state":[je,[vi],(h,o)=>{let[u]=o;return Ba(u.evaluate(h),h.featureState||{})}],properties:[Mr,[],h=>h.properties()],"geometry-type":[vi,[],h=>h.geometryType()],id:[je,[],h=>h.id()],zoom:[me,[],h=>h.globals.zoom],"heatmap-density":[me,[],h=>h.globals.heatmapDensity||0],"line-progress":[me,[],h=>h.globals.lineProgress||0],accumulated:[je,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[me,io(me),(h,o)=>{let u=0;for(const p of o)u+=p.evaluate(h);return u}],"*":[me,io(me),(h,o)=>{let u=1;for(const p of o)u*=p.evaluate(h);return u}],"-":{type:me,overloads:[[[me,me],(h,o)=>{let[u,p]=o;return u.evaluate(h)-p.evaluate(h)}],[[me],(h,o)=>{let[u]=o;return-u.evaluate(h)}]]},"/":[me,[me,me],(h,o)=>{let[u,p]=o;return u.evaluate(h)/p.evaluate(h)}],"%":[me,[me,me],(h,o)=>{let[u,p]=o;return u.evaluate(h)%p.evaluate(h)}],ln2:[me,[],()=>Math.LN2],pi:[me,[],()=>Math.PI],e:[me,[],()=>Math.E],"^":[me,[me,me],(h,o)=>{let[u,p]=o;return Math.pow(u.evaluate(h),p.evaluate(h))}],sqrt:[me,[me],(h,o)=>{let[u]=o;return Math.sqrt(u.evaluate(h))}],log10:[me,[me],(h,o)=>{let[u]=o;return Math.log(u.evaluate(h))/Math.LN10}],ln:[me,[me],(h,o)=>{let[u]=o;return Math.log(u.evaluate(h))}],log2:[me,[me],(h,o)=>{let[u]=o;return Math.log(u.evaluate(h))/Math.LN2}],sin:[me,[me],(h,o)=>{let[u]=o;return Math.sin(u.evaluate(h))}],cos:[me,[me],(h,o)=>{let[u]=o;return Math.cos(u.evaluate(h))}],tan:[me,[me],(h,o)=>{let[u]=o;return Math.tan(u.evaluate(h))}],asin:[me,[me],(h,o)=>{let[u]=o;return Math.asin(u.evaluate(h))}],acos:[me,[me],(h,o)=>{let[u]=o;return Math.acos(u.evaluate(h))}],atan:[me,[me],(h,o)=>{let[u]=o;return Math.atan(u.evaluate(h))}],min:[me,io(me),(h,o)=>Math.min(...o.map(u=>u.evaluate(h)))],max:[me,io(me),(h,o)=>Math.max(...o.map(u=>u.evaluate(h)))],abs:[me,[me],(h,o)=>{let[u]=o;return Math.abs(u.evaluate(h))}],round:[me,[me],(h,o)=>{let[u]=o;const p=u.evaluate(h);return p<0?-Math.round(-p):Math.round(p)}],floor:[me,[me],(h,o)=>{let[u]=o;return Math.floor(u.evaluate(h))}],ceil:[me,[me],(h,o)=>{let[u]=o;return Math.ceil(u.evaluate(h))}],"filter-==":[He,[vi,je],(h,o)=>{let[u,p]=o;return h.properties()[u.value]===p.value}],"filter-id-==":[He,[je],(h,o)=>{let[u]=o;return h.id()===u.value}],"filter-type-==":[He,[vi],(h,o)=>{let[u]=o;return h.geometryType()===u.value}],"filter-<":[He,[vi,je],(h,o)=>{let[u,p]=o;const _=h.properties()[u.value],x=p.value;return typeof _==typeof x&&_<x}],"filter-id-<":[He,[je],(h,o)=>{let[u]=o;const p=h.id(),_=u.value;return typeof p==typeof _&&p<_}],"filter->":[He,[vi,je],(h,o)=>{let[u,p]=o;const _=h.properties()[u.value],x=p.value;return typeof _==typeof x&&_>x}],"filter-id->":[He,[je],(h,o)=>{let[u]=o;const p=h.id(),_=u.value;return typeof p==typeof _&&p>_}],"filter-<=":[He,[vi,je],(h,o)=>{let[u,p]=o;const _=h.properties()[u.value],x=p.value;return typeof _==typeof x&&_<=x}],"filter-id-<=":[He,[je],(h,o)=>{let[u]=o;const p=h.id(),_=u.value;return typeof p==typeof _&&p<=_}],"filter->=":[He,[vi,je],(h,o)=>{let[u,p]=o;const _=h.properties()[u.value],x=p.value;return typeof _==typeof x&&_>=x}],"filter-id->=":[He,[je],(h,o)=>{let[u]=o;const p=h.id(),_=u.value;return typeof p==typeof _&&p>=_}],"filter-has":[He,[je],(h,o)=>{let[u]=o;return u.value in h.properties()}],"filter-has-id":[He,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[He,[Q(vi)],(h,o)=>{let[u]=o;return u.value.indexOf(h.geometryType())>=0}],"filter-id-in":[He,[Q(je)],(h,o)=>{let[u]=o;return u.value.indexOf(h.id())>=0}],"filter-in-small":[He,[vi,Q(je)],(h,o)=>{let[u,p]=o;return p.value.indexOf(h.properties()[u.value])>=0}],"filter-in-large":[He,[vi,Q(je)],(h,o)=>{let[u,p]=o;return function(_,x,S,I){for(;S<=I;){const R=S+I>>1;if(x[R]===_)return!0;x[R]>_?I=R-1:S=R+1}return!1}(h.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:He,overloads:[[[He,He],(h,o)=>{let[u,p]=o;return u.evaluate(h)&&p.evaluate(h)}],[io(He),(h,o)=>{for(const u of o)if(!u.evaluate(h))return!1;return!0}]]},any:{type:He,overloads:[[[He,He],(h,o)=>{let[u,p]=o;return u.evaluate(h)||p.evaluate(h)}],[io(He),(h,o)=>{for(const u of o)if(u.evaluate(h))return!0;return!1}]]},"!":[He,[He],(h,o)=>{let[u]=o;return!u.evaluate(h)}],"is-supported-script":[He,[vi],(h,o)=>{let[u]=o;const p=h.globals&&h.globals.isSupportedScript;return!p||p(u.evaluate(h))}],upcase:[vi,[vi],(h,o)=>{let[u]=o;return u.evaluate(h).toUpperCase()}],downcase:[vi,[vi],(h,o)=>{let[u]=o;return u.evaluate(h).toLowerCase()}],concat:[vi,io(je),(h,o)=>o.map(u=>Ji(u.evaluate(h))).join("")],"resolved-locale":[vi,[Ls],(h,o)=>{let[u]=o;return u.evaluate(h).resolvedLocale()}]});class Po{constructor(o,u){var p;this.expression=o,this._warningHistory={},this._evaluator=new rs,this._defaultValue=u?(p=u).type==="color"&&ks(p.default)?new Wi(0,0,0,0):p.type==="color"?Wi.parse(p.default)||null:p.type==="padding"?kr.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?gr.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(o,u,p,_,x,S){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(o,u,p,_,x,S){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=S||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function tn(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in mn}function Fn(h,o){const u=new Hi(mn,Rs,[],o?function(_){const x={color:Di,string:vi,number:me,enum:vi,boolean:He,formatted:ir,padding:rr,resolvedImage:vt,variableAnchorOffsetCollection:K};return _.type==="array"?Q(x[_.value]||je,_.length):x[_.type]}(o):void 0),p=u.parse(h,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?yn(new Po(p,o)):_n(u.errors)}class Ko{constructor(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!Yo(u.expression)}evaluateWithoutErrorHandling(o,u,p,_,x,S){return this._styleExpression.evaluateWithoutErrorHandling(o,u,p,_,x,S)}evaluate(o,u,p,_,x,S){return this._styleExpression.evaluate(o,u,p,_,x,S)}}class so{constructor(o,u,p,_){this.kind=o,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!Yo(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(o,u,p,_,x,S){return this._styleExpression.evaluateWithoutErrorHandling(o,u,p,_,x,S)}evaluate(o,u,p,_,x,S){return this._styleExpression.evaluate(o,u,p,_,x,S)}interpolationFactor(o,u,p){return this.interpolationType?yi.interpolationFactor(this.interpolationType,o,u,p):0}}function no(h,o){const u=Fn(h,o);if(u.result==="error")return u;const p=u.value.expression,_=zl(p);if(!_&&!ka(o))return _n([new Ai("","data expressions not supported")]);const x=Ra(p,["zoom"]);if(!x&&!wc(o))return _n([new Ai("","zoom expressions not supported")]);const S=Nn(p);return S||x?S instanceof Ai?_n([S]):S instanceof yi&&!Co(o)?_n([new Ai("",'"interpolate" expressions cannot be used with this property')]):yn(S?new so(_?"camera":"composite",u.value,S.labels,S instanceof yi?S.interpolation:void 0):new Ko(_?"constant":"source",u.value)):_n([new Ai("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Jr{constructor(o,u){this._parameters=o,this._specification=u,ai(this,kn(this._parameters,this._specification))}static deserialize(o){return new Jr(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Nn(h){let o=null;if(h instanceof Kn)o=Nn(h.result);else if(h instanceof Il){for(const u of h.args)if(o=Nn(u),o)break}else(h instanceof hi||h instanceof yi)&&h.input instanceof Dr&&h.input.name==="zoom"&&(o=h);return o instanceof Ai||h.eachChild(u=>{const p=Nn(u);p instanceof Ai?o=p:!o&&p?o=new Ai("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&p&&o!==p&&(o=new Ai("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function Xs(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const o of h.slice(1))if(!Xs(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const Qo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function vr(h){if(h==null)return{filter:()=>!0,needGeometry:!1};Xs(h)||(h=Gr(h));const o=Fn(h,Qo);if(o.result==="error")throw new Error(o.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,p,_)=>o.value.evaluate(u,p,{},_),needGeometry:Xr(h)}}function hr(h,o){return h<o?-1:h>o?1:0}function Xr(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let o=1;o<h.length;o++)if(Xr(h[o]))return!0;return!1}function Gr(h){if(!h)return!0;const o=h[0];return h.length<=1?o!=="any":o==="=="?oo(h[1],h[2],"=="):o==="!="?lo(oo(h[1],h[2],"==")):o==="<"||o===">"||o==="<="||o===">="?oo(h[1],h[2],o):o==="any"?(u=h.slice(1),["any"].concat(u.map(Gr))):o==="all"?["all"].concat(h.slice(1).map(Gr)):o==="none"?["all"].concat(h.slice(1).map(Gr).map(lo)):o==="in"?ao(h[1],h.slice(2)):o==="!in"?lo(ao(h[1],h.slice(2))):o==="has"?sl(h[1]):o!=="!has"||lo(sl(h[1]));var u}function oo(h,o,u){switch(h){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,h,o]}}function ao(h,o){if(o.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(u=>typeof u!=typeof o[0])?["filter-in-large",h,["literal",o.sort(hr)]]:["filter-in-small",h,["literal",o]]}}function sl(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function lo(h){return["!",h]}function rh(h){const o=typeof h;if(o==="number"||o==="boolean"||o==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let _="[";for(const x of h)_+=`${rh(x)},`;return`${_}]`}const u=Object.keys(h).sort();let p="{";for(let _=0;_<u.length;_++)p+=`${JSON.stringify(u[_])}:${rh(h[u[_]])},`;return`${p}}`}function sh(h){let o="";for(const u of mi)o+=`/${rh(h[u])}`;return o}function nh(h){const o=h.value;return o?[new be(h.key,o,"constants have been deprecated as of v8")]:[]}function zr(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function ta(h){if(Array.isArray(h))return h.map(ta);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const o={};for(const u in h)o[u]=ta(h[u]);return o}return zr(h)}function en(h){const o=h.key,u=h.value,p=h.valueSpec||{},_=h.objectElementValidators||{},x=h.style,S=h.styleSpec,I=h.validateSpec;let R=[];const N=Pi(u);if(N!=="object")return[new be(o,u,`object expected, ${N} found`)];for(const q in u){const W=q.split(".")[0],Y=p[W]||p["*"];let it;if(_[W])it=_[W];else if(p[W])it=I;else if(_["*"])it=_["*"];else{if(!p["*"]){R.push(new be(o,u[q],`unknown property "${q}"`));continue}it=I}R=R.concat(it({key:(o&&`${o}.`)+q,value:u[q],valueSpec:Y,style:x,styleSpec:S,object:u,objectKey:q,validateSpec:I},u))}for(const q in p)_[q]||p[q].required&&p[q].default===void 0&&u[q]===void 0&&R.push(new be(o,u,`missing required property "${q}"`));return R}function Ac(h){const o=h.value,u=h.valueSpec,p=h.style,_=h.styleSpec,x=h.key,S=h.arrayElementValidator||h.validateSpec;if(Pi(o)!=="array")return[new be(x,o,`array expected, ${Pi(o)} found`)];if(u.length&&o.length!==u.length)return[new be(x,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new be(x,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let I={type:u.value,values:u.values};_.$version<7&&(I.function=u.function),Pi(u.value)==="object"&&(I=u.value);let R=[];for(let N=0;N<o.length;N++)R=R.concat(S({array:o,arrayIndex:N,value:o[N],valueSpec:I,validateSpec:h.validateSpec,style:p,styleSpec:_,key:`${x}[${N}]`}));return R}function Oa(h){const o=h.key,u=h.value,p=h.valueSpec;let _=Pi(u);return _==="number"&&u!=u&&(_="NaN"),_!=="number"?[new be(o,u,`number expected, ${_} found`)]:"minimum"in p&&u<p.minimum?[new be(o,u,`${u} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&u>p.maximum?[new be(o,u,`${u} is greater than the maximum value ${p.maximum}`)]:[]}function Os(h){const o=h.valueSpec,u=zr(h.value.type);let p,_,x,S={};const I=u!=="categorical"&&h.value.property===void 0,R=!I,N=Pi(h.value.stops)==="array"&&Pi(h.value.stops[0])==="array"&&Pi(h.value.stops[0][0])==="object",q=en({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(it){if(u==="identity")return[new be(it.key,it.value,'identity function may not have a "stops" property')];let at=[];const ft=it.value;return at=at.concat(Ac({key:it.key,value:ft,valueSpec:it.valueSpec,validateSpec:it.validateSpec,style:it.style,styleSpec:it.styleSpec,arrayElementValidator:W})),Pi(ft)==="array"&&ft.length===0&&at.push(new be(it.key,ft,"array must have at least one stop")),at},default:function(it){return it.validateSpec({key:it.key,value:it.value,valueSpec:o,validateSpec:it.validateSpec,style:it.style,styleSpec:it.styleSpec})}}});return u==="identity"&&I&&q.push(new be(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||q.push(new be(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!Co(h.valueSpec)&&q.push(new be(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(R&&!ka(h.valueSpec)?q.push(new be(h.key,h.value,"property functions not supported")):I&&!wc(h.valueSpec)&&q.push(new be(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!N||h.value.property!==void 0||q.push(new be(h.key,h.value,'"property" property is required')),q;function W(it){let at=[];const ft=it.value,At=it.key;if(Pi(ft)!=="array")return[new be(At,ft,`array expected, ${Pi(ft)} found`)];if(ft.length!==2)return[new be(At,ft,`array length 2 expected, length ${ft.length} found`)];if(N){if(Pi(ft[0])!=="object")return[new be(At,ft,`object expected, ${Pi(ft[0])} found`)];if(ft[0].zoom===void 0)return[new be(At,ft,"object stop key must have zoom")];if(ft[0].value===void 0)return[new be(At,ft,"object stop key must have value")];if(x&&x>zr(ft[0].zoom))return[new be(At,ft[0].zoom,"stop zoom values must appear in ascending order")];zr(ft[0].zoom)!==x&&(x=zr(ft[0].zoom),_=void 0,S={}),at=at.concat(en({key:`${At}[0]`,value:ft[0],valueSpec:{zoom:{}},validateSpec:it.validateSpec,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{zoom:Oa,value:Y}}))}else at=at.concat(Y({key:`${At}[0]`,value:ft[0],valueSpec:{},validateSpec:it.validateSpec,style:it.style,styleSpec:it.styleSpec},ft));return tn(ta(ft[1]))?at.concat([new be(`${At}[1]`,ft[1],"expressions are not allowed in function stops.")]):at.concat(it.validateSpec({key:`${At}[1]`,value:ft[1],valueSpec:o,validateSpec:it.validateSpec,style:it.style,styleSpec:it.styleSpec}))}function Y(it,at){const ft=Pi(it.value),At=zr(it.value),It=it.value!==null?it.value:at;if(p){if(ft!==p)return[new be(it.key,It,`${ft} stop domain type must match previous stop domain type ${p}`)]}else p=ft;if(ft!=="number"&&ft!=="string"&&ft!=="boolean")return[new be(it.key,It,"stop domain value must be a number, string, or boolean")];if(ft!=="number"&&u!=="categorical"){let Zt=`number expected, ${ft} found`;return ka(o)&&u===void 0&&(Zt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new be(it.key,It,Zt)]}return u!=="categorical"||ft!=="number"||isFinite(At)&&Math.floor(At)===At?u!=="categorical"&&ft==="number"&&_!==void 0&&At<_?[new be(it.key,It,"stop domain values must appear in ascending order")]:(_=At,u==="categorical"&&At in S?[new be(it.key,It,"stop domain values must be unique")]:(S[At]=!0,[])):[new be(it.key,It,`integer expected, found ${At}`)]}}function vs(h){const o=(h.expressionContext==="property"?no:Fn)(ta(h.value),h.valueSpec);if(o.result==="error")return o.value.map(p=>new be(`${h.key}${p.key}`,h.value,p.message));const u=o.value.expression||o.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new be(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!Yo(u))return[new be(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!Yo(u))return[new be(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Ra(u,["zoom","feature-state"]))return[new be(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!zl(u))return[new be(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ea(h){const o=h.key,u=h.value,p=h.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(zr(u))===-1&&_.push(new be(o,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(zr(u))===-1&&_.push(new be(o,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),_}function nl(h){return Xs(ta(h.value))?vs(ai({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):oh(h)}function oh(h){const o=h.value,u=h.key;if(Pi(o)!=="array")return[new be(u,o,`array expected, ${Pi(o)} found`)];const p=h.styleSpec;let _,x=[];if(o.length<1)return[new be(u,o,"filter array must have at least 1 element")];switch(x=x.concat(ea({key:`${u}[0]`,value:o[0],valueSpec:p.filter_operator,style:h.style,styleSpec:h.styleSpec})),zr(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&zr(o[1])==="$type"&&x.push(new be(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&x.push(new be(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(_=Pi(o[1]),_!=="string"&&x.push(new be(`${u}[1]`,o[1],`string expected, ${_} found`)));for(let S=2;S<o.length;S++)_=Pi(o[S]),zr(o[1])==="$type"?x=x.concat(ea({key:`${u}[${S}]`,value:o[S],valueSpec:p.geometry_type,style:h.style,styleSpec:h.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new be(`${u}[${S}]`,o[S],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)x=x.concat(oh({key:`${u}[${S}]`,value:o[S],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":_=Pi(o[1]),o.length!==2?x.push(new be(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new be(`${u}[1]`,o[1],`string expected, ${_} found`))}return x}function ol(h,o){const u=h.key,p=h.validateSpec,_=h.style,x=h.styleSpec,S=h.value,I=h.objectKey,R=x[`${o}_${h.layerType}`];if(!R)return[];const N=I.match(/^(.*)-transition$/);if(o==="paint"&&N&&R[N[1]]&&R[N[1]].transition)return p({key:u,value:S,valueSpec:x.transition,style:_,styleSpec:x});const q=h.valueSpec||R[I];if(!q)return[new be(u,S,`unknown property "${I}"`)];let W;if(Pi(S)==="string"&&ka(q)&&!q.tokens&&(W=/^{([^}]+)}$/.exec(S)))return[new be(u,S,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const Y=[];return h.layerType==="symbol"&&(I==="text-field"&&_&&!_.glyphs&&Y.push(new be(u,S,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&ks(ta(S))&&zr(S.type)==="identity"&&Y.push(new be(u,S,'"text-font" does not support identity functions'))),Y.concat(p({key:h.key,value:S,valueSpec:q,style:_,styleSpec:x,expressionContext:"property",propertyType:o,propertyKey:I}))}function Ul(h){return ol(h,"paint")}function ah(h){return ol(h,"layout")}function lh(h){let o=[];const u=h.value,p=h.key,_=h.style,x=h.styleSpec;u.type||u.ref||o.push(new be(p,u,'either "type" or "ref" is required'));let S=zr(u.type);const I=zr(u.ref);if(u.id){const R=zr(u.id);for(let N=0;N<h.arrayIndex;N++){const q=_.layers[N];zr(q.id)===R&&o.push(new be(p,u.id,`duplicate layer id "${u.id}", previously used at line ${q.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(N=>{N in u&&o.push(new be(p,u[N],`"${N}" is prohibited for ref layers`))}),_.layers.forEach(N=>{zr(N.id)===I&&(R=N)}),R?R.ref?o.push(new be(p,u.ref,"ref cannot reference another ref layer")):S=zr(R.type):o.push(new be(p,u.ref,`ref layer "${I}" not found`))}else if(S!=="background")if(u.source){const R=_.sources&&_.sources[u.source],N=R&&zr(R.type);R?N==="vector"&&S==="raster"?o.push(new be(p,u.source,`layer "${u.id}" requires a raster source`)):N!=="raster-dem"&&S==="hillshade"?o.push(new be(p,u.source,`layer "${u.id}" requires a raster-dem source`)):N==="raster"&&S!=="raster"?o.push(new be(p,u.source,`layer "${u.id}" requires a vector source`)):N!=="vector"||u["source-layer"]?N==="raster-dem"&&S!=="hillshade"?o.push(new be(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!u.paint||!u.paint["line-gradient"]||N==="geojson"&&R.lineMetrics||o.push(new be(p,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new be(p,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new be(p,u.source,`source "${u.source}" not found`))}else o.push(new be(p,u,'missing required property "source"'));return o=o.concat(en({key:p,value:u,valueSpec:x.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${p}.type`,value:u.type,valueSpec:x.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:nl,layout:R=>en({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":N=>ah(ai({layerType:S},N))}}),paint:R=>en({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":N=>Ul(ai({layerType:S},N))}})}})),o}function ia(h){const o=h.value,u=h.key,p=Pi(o);return p!=="string"?[new be(u,o,`string expected, ${p} found`)]:[]}const Sc={promoteId:function(h){let{key:o,value:u}=h;if(Pi(u)==="string")return ia({key:o,value:u});{const p=[];for(const _ in u)p.push(...ia({key:`${o}.${_}`,value:u[_]}));return p}}};function jl(h){const o=h.value,u=h.key,p=h.styleSpec,_=h.style,x=h.validateSpec;if(!o.type)return[new be(u,o,'"type" is required')];const S=zr(o.type);let I;switch(S){case"vector":case"raster":return I=en({key:u,value:o,valueSpec:p[`source_${S.replace("-","_")}`],style:h.style,styleSpec:p,objectElementValidators:Sc,validateSpec:x}),I;case"raster-dem":return I=function(R){var N;const q=(N=R.sourceName)!==null&&N!==void 0?N:"",W=R.value,Y=R.styleSpec,it=Y.source_raster_dem,at=R.style;let ft=[];const At=Pi(W);if(W===void 0)return ft;if(At!=="object")return ft.push(new be("source_raster_dem",W,`object expected, ${At} found`)),ft;const It=zr(W.encoding)==="custom",Zt=["redFactor","greenFactor","blueFactor","baseShift"],Ft=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Ht in W)!It&&Zt.includes(Ht)?ft.push(new be(Ht,W[Ht],`In "${q}": "${Ht}" is only valid when "encoding" is set to "custom". ${Ft} encoding found`)):it[Ht]?ft=ft.concat(R.validateSpec({key:Ht,value:W[Ht],valueSpec:it[Ht],validateSpec:R.validateSpec,style:at,styleSpec:Y})):ft.push(new be(Ht,W[Ht],`unknown property "${Ht}"`));return ft}({sourceName:u,value:o,style:h.style,styleSpec:p,validateSpec:x}),I;case"geojson":if(I=en({key:u,value:o,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:x,objectElementValidators:Sc}),o.cluster)for(const R in o.clusterProperties){const[N,q]=o.clusterProperties[R],W=typeof N=="string"?[N,["accumulated"],["get",R]]:N;I.push(...vs({key:`${u}.${R}.map`,value:q,validateSpec:x,expressionContext:"cluster-map"})),I.push(...vs({key:`${u}.${R}.reduce`,value:W,validateSpec:x,expressionContext:"cluster-reduce"}))}return I;case"video":return en({key:u,value:o,valueSpec:p.source_video,style:_,validateSpec:x,styleSpec:p});case"image":return en({key:u,value:o,valueSpec:p.source_image,style:_,validateSpec:x,styleSpec:p});case"canvas":return[new be(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ea({key:`${u}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:x,styleSpec:p})}}function Ec(h){const o=h.value,u=h.styleSpec,p=u.light,_=h.style;let x=[];const S=Pi(o);if(o===void 0)return x;if(S!=="object")return x=x.concat([new be("light",o,`object expected, ${S} found`)]),x;for(const I in o){const R=I.match(/^(.*)-transition$/);x=x.concat(R&&p[R[1]]&&p[R[1]].transition?h.validateSpec({key:I,value:o[I],valueSpec:u.transition,validateSpec:h.validateSpec,style:_,styleSpec:u}):p[I]?h.validateSpec({key:I,value:o[I],valueSpec:p[I],validateSpec:h.validateSpec,style:_,styleSpec:u}):[new be(I,o[I],`unknown property "${I}"`)])}return x}function ju(h){const o=h.value,u=h.styleSpec,p=u.sky,_=h.style,x=Pi(o);if(o===void 0)return[];if(x!=="object")return[new be("sky",o,`object expected, ${x} found`)];let S=[];for(const I in o)S=S.concat(p[I]?h.validateSpec({key:I,value:o[I],valueSpec:p[I],style:_,styleSpec:u}):[new be(I,o[I],`unknown property "${I}"`)]);return S}function Gu(h){const o=h.value,u=h.styleSpec,p=u.terrain,_=h.style;let x=[];const S=Pi(o);if(o===void 0)return x;if(S!=="object")return x=x.concat([new be("terrain",o,`object expected, ${S} found`)]),x;for(const I in o)x=x.concat(p[I]?h.validateSpec({key:I,value:o[I],valueSpec:p[I],validateSpec:h.validateSpec,style:_,styleSpec:u}):[new be(I,o[I],`unknown property "${I}"`)]);return x}function ch(h){let o=[];const u=h.value,p=h.key;if(Array.isArray(u)){const _=[],x=[];for(const S in u)u[S].id&&_.includes(u[S].id)&&o.push(new be(p,u,`all the sprites' ids must be unique, but ${u[S].id} is duplicated`)),_.push(u[S].id),u[S].url&&x.includes(u[S].url)&&o.push(new be(p,u,`all the sprites' URLs must be unique, but ${u[S].url} is duplicated`)),x.push(u[S].url),o=o.concat(en({key:`${p}[${S}]`,value:u[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return o}return ia({key:p,value:u})}const Qh={"*":()=>[],array:Ac,boolean:function(h){const o=h.value,u=h.key,p=Pi(o);return p!=="boolean"?[new be(u,o,`boolean expected, ${p} found`)]:[]},number:Oa,color:function(h){const o=h.key,u=h.value,p=Pi(u);return p!=="string"?[new be(o,u,`color expected, ${p} found`)]:Wi.parse(String(u))?[]:[new be(o,u,`color expected, "${u}" found`)]},constants:nh,enum:ea,filter:nl,function:Os,layer:lh,object:en,source:jl,light:Ec,sky:ju,terrain:Gu,string:ia,formatted:function(h){return ia(h).length===0?[]:vs(h)},resolvedImage:function(h){return ia(h).length===0?[]:vs(h)},padding:function(h){const o=h.key,u=h.value;if(Pi(u)==="array"){if(u.length<1||u.length>4)return[new be(o,u,`padding requires 1 to 4 values; ${u.length} values found`)];const p={type:"number"};let _=[];for(let x=0;x<u.length;x++)_=_.concat(h.validateSpec({key:`${o}[${x}]`,value:u[x],validateSpec:h.validateSpec,valueSpec:p}));return _}return Oa({key:o,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const o=h.key,u=h.value,p=Pi(u),_=h.styleSpec;if(p!=="array"||u.length<1||u.length%2!=0)return[new be(o,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let S=0;S<u.length;S+=2)x=x.concat(ea({key:`${o}[${S}]`,value:u[S],valueSpec:_.layout_symbol["text-anchor"]})),x=x.concat(Ac({key:`${o}[${S+1}]`,value:u[S+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:_}));return x},sprite:ch};function Gl(h){const o=h.value,u=h.valueSpec,p=h.styleSpec;return h.validateSpec=Gl,u.expression&&ks(zr(o))?Os(h):u.expression&&tn(ta(o))?vs(h):u.type&&Qh[u.type]?Qh[u.type](h):en(ai({},h,{valueSpec:u.type?p[u.type]:u}))}function tu(h){const o=h.value,u=h.key,p=ia(h);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new be(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new be(u,o,'"glyphs" url must include a "{range}" token'))),p}function rn(h){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ot,u=[];return u=u.concat(Gl({key:"",value:h,valueSpec:o.$root,styleSpec:o,style:h,validateSpec:Gl,objectElementValidators:{glyphs:tu,"*":()=>[]}})),h.constants&&(u=u.concat(nh({key:"constants",value:h.constants,style:h,styleSpec:o,validateSpec:Gl}))),Vl(u)}function Io(h){return function(o){return h({...o,validateSpec:Gl})}}function Vl(h){return[].concat(h).sort((o,u)=>o.line-u.line)}function Dn(h){return function(){for(var o=arguments.length,u=new Array(o),p=0;p<o;p++)u[p]=arguments[p];return Vl(h.apply(this,u))}}rn.source=Dn(Io(jl)),rn.sprite=Dn(Io(ch)),rn.glyphs=Dn(Io(tu)),rn.light=Dn(Io(Ec)),rn.sky=Dn(Io(ju)),rn.terrain=Dn(Io(Gu)),rn.layer=Dn(Io(lh)),rn.filter=Dn(Io(nl)),rn.paintProperty=Dn(Io(Ul)),rn.layoutProperty=Dn(Io(ah));const ra=rn,Vu=ra.light,qu=ra.paintProperty,eu=ra.layoutProperty;function Hu(h,o){let u=!1;if(o&&o.length)for(const p of o)h.fire(new Ze(new Error(p.message))),u=!0;return u}class Cc{constructor(o,u,p){const _=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const S=new Int32Array(this.arrayBuffer);o=S[0],this.d=(u=S[1])+2*(p=S[2]);for(let R=0;R<this.d*this.d;R++){const N=S[3+R],q=S[3+R+1];_.push(N===q?null:S.subarray(N,q))}const I=S[3+_.length+1];this.keys=S.subarray(S[3+_.length],I),this.bboxes=S.subarray(I),this.insert=this._insertReadonly}else{this.d=u+2*p;for(let S=0;S<this.d*this.d;S++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=p,this.scale=u/o,this.uid=0;const x=p/u*o;this.min=-x,this.max=o+x}insert(o,u,p,_,x){this._forEachCell(u,p,_,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,u,p,_,x,S){this.cells[x].push(S)}query(o,u,p,_,x){const S=this.min,I=this.max;if(o<=S&&u<=S&&I<=p&&I<=_&&!x)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(o,u,p,_,this._queryCell,R,{},x),R}}_queryCell(o,u,p,_,x,S,I,R){const N=this.cells[x];if(N!==null){const q=this.keys,W=this.bboxes;for(let Y=0;Y<N.length;Y++){const it=N[Y];if(I[it]===void 0){const at=4*it;(R?R(W[at+0],W[at+1],W[at+2],W[at+3]):o<=W[at+2]&&u<=W[at+3]&&p>=W[at+0]&&_>=W[at+1])?(I[it]=!0,S.push(q[it])):I[it]=!1}}}}_forEachCell(o,u,p,_,x,S,I,R){const N=this._convertToCellCoord(o),q=this._convertToCellCoord(u),W=this._convertToCellCoord(p),Y=this._convertToCellCoord(_);for(let it=N;it<=W;it++)for(let at=q;at<=Y;at++){const ft=this.d*at+it;if((!R||R(this._convertFromCellCoord(it),this._convertFromCellCoord(at),this._convertFromCellCoord(it+1),this._convertFromCellCoord(at+1)))&&x.call(this,o,u,p,_,ft,S,I,R))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,u=3+this.cells.length+1+1;let p=0;for(let S=0;S<this.cells.length;S++)p+=this.cells[S].length;const _=new Int32Array(u+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let x=u;for(let S=0;S<o.length;S++){const I=o[S];_[3+S]=x,_.set(I,x),x+=I.length}return _[3+o.length]=x,_.set(this.keys,x),x+=this.keys.length,_[3+o.length+1]=x,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer}static serialize(o,u){const p=o.toArrayBuffer();return u&&u.push(p),{buffer:p}}static deserialize(o){return new Cc(o.buffer)}}const Fa={};function Je(h,o){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Fa[h])throw new Error(`${h} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:h,writeable:!1}),Fa[h]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}Je("Object",Object),Je("TransferableGridIndex",Cc),Je("Color",Wi),Je("Error",Error),Je("AJAXError",$t),Je("ResolvedImage",Or),Je("StylePropertyFunction",Jr),Je("StyleExpression",Po,{omit:["_evaluator"]}),Je("ZoomDependentExpression",so),Je("ZoomConstantExpression",Ko),Je("CompoundExpression",Dr,{omit:["_evaluate"]});for(const h in mn)mn[h]._classRegistryKey||Je(`Expression_${h}`,mn[h]);function sa(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function cs(h,o){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error)return h;if(sa(h)||le(h))return o&&o.push(h),h;if(ArrayBuffer.isView(h)){const u=h;return o&&o.push(u.buffer),u}if(h instanceof ImageData)return o&&o.push(h.data.buffer),h;if(Array.isArray(h)){const u=[];for(const p of h)u.push(cs(p,o));return u}if(typeof h=="object"){const u=h.constructor,p=u._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${u.name}`);if(!Fa[p])throw new Error(`${p} is not registered.`);const _=u.serialize?u.serialize(h,o):{};if(u.serialize){if(o&&_===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in h){if(!h.hasOwnProperty(x)||Fa[p].omit.indexOf(x)>=0)continue;const S=h[x];_[x]=Fa[p].shallow.indexOf(x)>=0?S:cs(S,o)}h instanceof Error&&(_.message=h.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(_.$name=p),_}throw new Error("can't serialize object of type "+typeof h)}function vn(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||sa(h)||le(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(vn);if(typeof h=="object"){const o=h.$name||"Object";if(!Fa[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:u}=Fa[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(h);const p=Object.create(u.prototype);for(const _ of Object.keys(h)){if(_==="$name")continue;const x=h[_];p[_]=Fa[o].shallow.indexOf(_)>=0?x:vn(x)}return p}throw new Error("can't deserialize object of type "+typeof h)}class Wu{constructor(){this.first=!0}update(o,u){const p=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=p,!0))}}const ze={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Lo(h){for(const o of h)if(iu(o.charCodeAt(0)))return!0;return!1}function bn(h){for(const o of h)if(!ep(o.charCodeAt(0)))return!1;return!0}function ep(h){return!(ze.Arabic(h)||ze["Arabic Supplement"](h)||ze["Arabic Extended-A"](h)||ze["Arabic Presentation Forms-A"](h)||ze["Arabic Presentation Forms-B"](h))}function iu(h){return!(h!==746&&h!==747&&(h<4352||!(ze["Bopomofo Extended"](h)||ze.Bopomofo(h)||ze["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||ze["CJK Compatibility Ideographs"](h)||ze["CJK Compatibility"](h)||ze["CJK Radicals Supplement"](h)||ze["CJK Strokes"](h)||!(!ze["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||ze["CJK Unified Ideographs Extension A"](h)||ze["CJK Unified Ideographs"](h)||ze["Enclosed CJK Letters and Months"](h)||ze["Hangul Compatibility Jamo"](h)||ze["Hangul Jamo Extended-A"](h)||ze["Hangul Jamo Extended-B"](h)||ze["Hangul Jamo"](h)||ze["Hangul Syllables"](h)||ze.Hiragana(h)||ze["Ideographic Description Characters"](h)||ze.Kanbun(h)||ze["Kangxi Radicals"](h)||ze["Katakana Phonetic Extensions"](h)||ze.Katakana(h)&&h!==12540||!(!ze["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!ze["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||ze["Unified Canadian Aboriginal Syllabics"](h)||ze["Unified Canadian Aboriginal Syllabics Extended"](h)||ze["Vertical Forms"](h)||ze["Yijing Hexagram Symbols"](h)||ze["Yi Syllables"](h)||ze["Yi Radicals"](h))))}function na(h){return!(iu(h)||function(o){return!!(ze["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||ze["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||ze["Letterlike Symbols"](o)||ze["Number Forms"](o)||ze["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||ze["Control Pictures"](o)&&o!==9251||ze["Optical Character Recognition"](o)||ze["Enclosed Alphanumerics"](o)||ze["Geometric Shapes"](o)||ze["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||ze["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||ze["CJK Symbols and Punctuation"](o)||ze.Katakana(o)||ze["Private Use Area"](o)||ze["CJK Compatibility Forms"](o)||ze["Small Form Variants"](o)||ze["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(h))}function hh(h){return h>=1424&&h<=2303||ze["Arabic Presentation Forms-A"](h)||ze["Arabic Presentation Forms-B"](h)}function uh(h,o){return!(!o&&hh(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||ze.Khmer(h))}function ru(h){for(const o of h)if(hh(o.charCodeAt(0)))return!0;return!1}const oa=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class br{constructor(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wu,this.transition={})}isSupportedScript(o){return function(u,p){for(const _ of u)if(!uh(_.charCodeAt(0),p))return!1;return!0}(o,oa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,u=o-Math.floor(o),p=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}}}class Mo{constructor(o,u){this.property=o,this.value=u,this.expression=function(p,_){if(ks(p))return new Jr(p,_);if(tn(p)){const x=no(p,_);if(x.result==="error")throw new Error(x.value.map(S=>`${S.key}: ${S.message}`).join(", "));return x.value}{let x=p;return _.type==="color"&&typeof p=="string"?x=Wi.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(x=gr.parse(p)):x=kr.parse(p),{kind:"constant",evaluate:()=>x}}}(u===void 0?o.specification.default:u,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,u,p){return this.property.possiblyEvaluate(this,o,u,p)}}class co{constructor(o){this.property=o,this.value=new Mo(o,void 0)}transitioned(o,u){return new ph(this.property,this.value,u,Rt({},o.transition,this.transition),o.now)}untransitioned(){return new ph(this.property,this.value,null,{},0)}}class dh{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return ct(this._values[o].value.value)}setValue(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new co(this._values[o].property)),this._values[o].value=new Mo(this._values[o].property,u===null?void 0:ct(u))}getTransition(o){return ct(this._values[o].transition)}setTransition(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new co(this._values[o].property)),this._values[o].transition=ct(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(o[u]=p);const _=this.getTransition(u);_!==void 0&&(o[`${u}-transition`]=_)}return o}transitioned(o,u){const p=new ql(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(o,u._values[_]);return p}untransitioned(){const o=new ql(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class ph{constructor(o,u,p,_,x){this.property=o,this.value=u,this.begin=x+_.delay||0,this.end=this.begin+_.duration||0,o.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(o,u,p){const _=o.now||0,x=this.value.possiblyEvaluate(o,u,p),S=this.prior;if(S){if(_>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(_<this.begin)return S.possiblyEvaluate(o,u,p);{const I=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(o,u,p),x,function(R){if(R<=0)return 0;if(R>=1)return 1;const N=R*R,q=N*R;return 4*(R<.5?q:3*(R-N)+q-.75)}(I))}}return x}}class ql{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,p){const _=new Tc(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(o,u,p);return _}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Ju{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return ct(this._values[o].value)}setValue(o,u){this._values[o]=new Mo(this._values[o].property,u===null?void 0:ct(u))}serialize(){const o={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(o[u]=p)}return o}possiblyEvaluate(o,u,p){const _=new Tc(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(o,u,p);return _}}class Bo{constructor(o,u,p){this.property=o,this.value=u,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,u,p,_){return this.property.evaluate(this.value,this.parameters,o,u,p,_)}}class Tc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class oi{constructor(o){this.specification=o}possiblyEvaluate(o,u){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(u)}interpolate(o,u,p){const _=ys[this.specification.type];return _?_(o,u,p):o}}class w{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,p,_){return new Bo(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},p,_)}:o.expression,u)}interpolate(o,u,p){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new Bo(this,{kind:"constant",value:void 0},o.parameters);const _=ys[this.specification.type];if(_){const x=_(o.value.value,u.value.value,p);return new Bo(this,{kind:"constant",value:x},o.parameters)}return o}evaluate(o,u,p,_,x,S){return o.kind==="constant"?o.value:o.evaluate(u,p,_,x,S)}}class a extends w{possiblyEvaluate(o,u,p,_){if(o.value===void 0)return new Bo(this,{kind:"constant",value:void 0},u);if(o.expression.kind==="constant"){const x=o.expression.evaluate(u,null,{},p,_),S=o.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,I=this._calculate(S,S,S,u);return new Bo(this,{kind:"constant",value:I},u)}if(o.expression.kind==="camera"){const x=this._calculate(o.expression.evaluate({zoom:u.zoom-1}),o.expression.evaluate({zoom:u.zoom}),o.expression.evaluate({zoom:u.zoom+1}),u);return new Bo(this,{kind:"constant",value:x},u)}return new Bo(this,o.expression,u)}evaluate(o,u,p,_,x,S){if(o.kind==="source"){const I=o.evaluate(u,p,_,x,S);return this._calculate(I,I,I,u)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(u.zoom)-1},p,_),o.evaluate({zoom:Math.floor(u.zoom)},p,_),o.evaluate({zoom:Math.floor(u.zoom)+1},p,_),u):o.value}_calculate(o,u,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:p,to:u}}interpolate(o){return o}}class d{constructor(o){this.specification=o}possiblyEvaluate(o,u,p,_){if(o.value!==void 0){if(o.expression.kind==="constant"){const x=o.expression.evaluate(u,null,{},p,_);return this._calculate(x,x,x,u)}return this._calculate(o.expression.evaluate(new br(Math.floor(u.zoom-1),u)),o.expression.evaluate(new br(Math.floor(u.zoom),u)),o.expression.evaluate(new br(Math.floor(u.zoom+1),u)),u)}}_calculate(o,u,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:p,to:u}}interpolate(o){return o}}class m{constructor(o){this.specification=o}possiblyEvaluate(o,u,p,_){return!!o.expression.evaluate(u,null,{},p,_)}interpolate(){return!1}}class v{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in o){const p=o[u];p.specification.overridable&&this.overridableProperties.push(u);const _=this.defaultPropertyValues[u]=new Mo(p,void 0),x=this.defaultTransitionablePropertyValues[u]=new co(p);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate({})}}}Je("DataDrivenProperty",w),Je("DataConstantProperty",oi),Je("CrossFadedDataDrivenProperty",a),Je("CrossFadedProperty",d),Je("ColorRampProperty",m);const E="-transition";class B extends he{constructor(o,u){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),u.layout&&(this._unevaluatedLayout=new Ju(u.layout)),u.paint)){this._transitionablePaint=new dh(u.paint);for(const p in o.paint)this.setPaintProperty(p,o.paint[p],{validate:!1});for(const p in o.layout)this.setLayoutProperty(p,o.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tc(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};u!=null&&this._validate(eu,`layers.${this.id}.layout.${o}`,o,u,p)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return o.endsWith(E)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(u!=null&&this._validate(qu,`layers.${this.id}.paint.${o}`,o,u,p))return!1;if(o.endsWith(E))return this._transitionablePaint.setTransition(o.slice(0,-11),u||void 0),!1;{const _=this._transitionablePaint._values[o],x=_.property.specification["property-type"]==="cross-faded-data-driven",S=_.value.isDataDriven(),I=_.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const R=this._transitionablePaint._values[o].value;return R.isDataDriven()||S||x||this._handleOverridablePaintPropertyUpdate(o,I,R)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,u,p){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),zt(o,(u,p)=>!(u===void 0||p==="layout"&&!Object.keys(u).length||p==="paint"&&!Object.keys(u).length))}_validate(o,u,p,_){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!x||x.validate!==!1)&&Hu(this,o.call(ra,{key:u,layerType:this.type,objectKey:p,value:_,styleSpec:ot,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof Bo&&ka(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const k={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class g{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class b{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function C(h){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=0,p=0;return{members:h.map(_=>{const x=k[_.type].BYTES_PER_ELEMENT,S=u=M(u,Math.max(o,x)),I=_.components||1;return p=Math.max(p,x),u+=x*I,{name:_.name,type:_.type,components:I,offset:S}}),size:M(u,Math.max(p,o)),alignment:o}}function M(h,o){return Math.ceil(h/o)*o}class O extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,u)}emplace(o,u,p){const _=2*o;return this.int16[_+0]=u,this.int16[_+1]=p,o}}O.prototype.bytesPerElement=4,Je("StructArrayLayout2i4",O);class z extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,p)}emplace(o,u,p,_){const x=3*o;return this.int16[x+0]=u,this.int16[x+1]=p,this.int16[x+2]=_,o}}z.prototype.bytesPerElement=6,Je("StructArrayLayout3i6",z);class U extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,p,_)}emplace(o,u,p,_,x){const S=4*o;return this.int16[S+0]=u,this.int16[S+1]=p,this.int16[S+2]=_,this.int16[S+3]=x,o}}U.prototype.bytesPerElement=8,Je("StructArrayLayout4i8",U);class V extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S){const I=this.length;return this.resize(I+1),this.emplace(I,o,u,p,_,x,S)}emplace(o,u,p,_,x,S,I){const R=6*o;return this.int16[R+0]=u,this.int16[R+1]=p,this.int16[R+2]=_,this.int16[R+3]=x,this.int16[R+4]=S,this.int16[R+5]=I,o}}V.prototype.bytesPerElement=12,Je("StructArrayLayout2i4i12",V);class G extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S){const I=this.length;return this.resize(I+1),this.emplace(I,o,u,p,_,x,S)}emplace(o,u,p,_,x,S,I){const R=4*o,N=8*o;return this.int16[R+0]=u,this.int16[R+1]=p,this.uint8[N+4]=_,this.uint8[N+5]=x,this.uint8[N+6]=S,this.uint8[N+7]=I,o}}G.prototype.bytesPerElement=8,Je("StructArrayLayout2i4ub8",G);class J extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,u)}emplace(o,u,p){const _=2*o;return this.float32[_+0]=u,this.float32[_+1]=p,o}}J.prototype.bytesPerElement=8,Je("StructArrayLayout2f8",J);class lt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S,I,R,N,q){const W=this.length;return this.resize(W+1),this.emplace(W,o,u,p,_,x,S,I,R,N,q)}emplace(o,u,p,_,x,S,I,R,N,q,W){const Y=10*o;return this.uint16[Y+0]=u,this.uint16[Y+1]=p,this.uint16[Y+2]=_,this.uint16[Y+3]=x,this.uint16[Y+4]=S,this.uint16[Y+5]=I,this.uint16[Y+6]=R,this.uint16[Y+7]=N,this.uint16[Y+8]=q,this.uint16[Y+9]=W,o}}lt.prototype.bytesPerElement=20,Je("StructArrayLayout10ui20",lt);class tt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S,I,R,N,q,W,Y){const it=this.length;return this.resize(it+1),this.emplace(it,o,u,p,_,x,S,I,R,N,q,W,Y)}emplace(o,u,p,_,x,S,I,R,N,q,W,Y,it){const at=12*o;return this.int16[at+0]=u,this.int16[at+1]=p,this.int16[at+2]=_,this.int16[at+3]=x,this.uint16[at+4]=S,this.uint16[at+5]=I,this.uint16[at+6]=R,this.uint16[at+7]=N,this.int16[at+8]=q,this.int16[at+9]=W,this.int16[at+10]=Y,this.int16[at+11]=it,o}}tt.prototype.bytesPerElement=24,Je("StructArrayLayout4i4ui4i24",tt);class ut extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,p)}emplace(o,u,p,_){const x=3*o;return this.float32[x+0]=u,this.float32[x+1]=p,this.float32[x+2]=_,o}}ut.prototype.bytesPerElement=12,Je("StructArrayLayout3f12",ut);class dt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}dt.prototype.bytesPerElement=4,Je("StructArrayLayout1ul4",dt);class Tt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S,I,R,N){const q=this.length;return this.resize(q+1),this.emplace(q,o,u,p,_,x,S,I,R,N)}emplace(o,u,p,_,x,S,I,R,N,q){const W=10*o,Y=5*o;return this.int16[W+0]=u,this.int16[W+1]=p,this.int16[W+2]=_,this.int16[W+3]=x,this.int16[W+4]=S,this.int16[W+5]=I,this.uint32[Y+3]=R,this.uint16[W+8]=N,this.uint16[W+9]=q,o}}Tt.prototype.bytesPerElement=20,Je("StructArrayLayout6i1ul2ui20",Tt);class wt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S){const I=this.length;return this.resize(I+1),this.emplace(I,o,u,p,_,x,S)}emplace(o,u,p,_,x,S,I){const R=6*o;return this.int16[R+0]=u,this.int16[R+1]=p,this.int16[R+2]=_,this.int16[R+3]=x,this.int16[R+4]=S,this.int16[R+5]=I,o}}wt.prototype.bytesPerElement=12,Je("StructArrayLayout2i2i2i12",wt);class gt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,p,_,x)}emplace(o,u,p,_,x,S){const I=4*o,R=8*o;return this.float32[I+0]=u,this.float32[I+1]=p,this.float32[I+2]=_,this.int16[R+6]=x,this.int16[R+7]=S,o}}gt.prototype.bytesPerElement=16,Je("StructArrayLayout2f1f2i16",gt);class mt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,p,_)}emplace(o,u,p,_,x){const S=12*o,I=3*o;return this.uint8[S+0]=u,this.uint8[S+1]=p,this.float32[I+1]=_,this.float32[I+2]=x,o}}mt.prototype.bytesPerElement=12,Je("StructArrayLayout2ub2f12",mt);class Dt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,p)}emplace(o,u,p,_){const x=3*o;return this.uint16[x+0]=u,this.uint16[x+1]=p,this.uint16[x+2]=_,o}}Dt.prototype.bytesPerElement=6,Je("StructArrayLayout3ui6",Dt);class Xt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S,I,R,N,q,W,Y,it,at,ft,At,It){const Zt=this.length;return this.resize(Zt+1),this.emplace(Zt,o,u,p,_,x,S,I,R,N,q,W,Y,it,at,ft,At,It)}emplace(o,u,p,_,x,S,I,R,N,q,W,Y,it,at,ft,At,It,Zt){const Ft=24*o,Ht=12*o,ye=48*o;return this.int16[Ft+0]=u,this.int16[Ft+1]=p,this.uint16[Ft+2]=_,this.uint16[Ft+3]=x,this.uint32[Ht+2]=S,this.uint32[Ht+3]=I,this.uint32[Ht+4]=R,this.uint16[Ft+10]=N,this.uint16[Ft+11]=q,this.uint16[Ft+12]=W,this.float32[Ht+7]=Y,this.float32[Ht+8]=it,this.uint8[ye+36]=at,this.uint8[ye+37]=ft,this.uint8[ye+38]=At,this.uint32[Ht+10]=It,this.int16[Ft+22]=Zt,o}}Xt.prototype.bytesPerElement=48,Je("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xt);class ie extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,_,x,S,I,R,N,q,W,Y,it,at,ft,At,It,Zt,Ft,Ht,ye,ve,Ve,ei,Ue,ke,Ke,li){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,o,u,p,_,x,S,I,R,N,q,W,Y,it,at,ft,At,It,Zt,Ft,Ht,ye,ve,Ve,ei,Ue,ke,Ke,li)}emplace(o,u,p,_,x,S,I,R,N,q,W,Y,it,at,ft,At,It,Zt,Ft,Ht,ye,ve,Ve,ei,Ue,ke,Ke,li,Ge){const we=32*o,ii=16*o;return this.int16[we+0]=u,this.int16[we+1]=p,this.int16[we+2]=_,this.int16[we+3]=x,this.int16[we+4]=S,this.int16[we+5]=I,this.int16[we+6]=R,this.int16[we+7]=N,this.uint16[we+8]=q,this.uint16[we+9]=W,this.uint16[we+10]=Y,this.uint16[we+11]=it,this.uint16[we+12]=at,this.uint16[we+13]=ft,this.uint16[we+14]=At,this.uint16[we+15]=It,this.uint16[we+16]=Zt,this.uint16[we+17]=Ft,this.uint16[we+18]=Ht,this.uint16[we+19]=ye,this.uint16[we+20]=ve,this.uint16[we+21]=Ve,this.uint16[we+22]=ei,this.uint32[ii+12]=Ue,this.float32[ii+13]=ke,this.float32[ii+14]=Ke,this.uint16[we+30]=li,this.uint16[we+31]=Ge,o}}ie.prototype.bytesPerElement=64,Je("StructArrayLayout8i15ui1ul2f2ui64",ie);class re extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}re.prototype.bytesPerElement=4,Je("StructArrayLayout1f4",re);class ue extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,p)}emplace(o,u,p,_){const x=3*o;return this.uint16[6*o+0]=u,this.float32[x+1]=p,this.float32[x+2]=_,o}}ue.prototype.bytesPerElement=12,Je("StructArrayLayout1ui2f12",ue);class Pe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,p)}emplace(o,u,p,_){const x=4*o;return this.uint32[2*o+0]=u,this.uint16[x+2]=p,this.uint16[x+3]=_,o}}Pe.prototype.bytesPerElement=8,Je("StructArrayLayout1ul2ui8",Pe);class xe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,u)}emplace(o,u,p){const _=2*o;return this.uint16[_+0]=u,this.uint16[_+1]=p,o}}xe.prototype.bytesPerElement=4,Je("StructArrayLayout2ui4",xe);class Oe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}Oe.prototype.bytesPerElement=2,Je("StructArrayLayout1ui2",Oe);class Xe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,p,_)}emplace(o,u,p,_,x){const S=4*o;return this.float32[S+0]=u,this.float32[S+1]=p,this.float32[S+2]=_,this.float32[S+3]=x,o}}Xe.prototype.bytesPerElement=16,Je("StructArrayLayout4f16",Xe);class We extends g{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}We.prototype.size=20;class _i extends Tt{get(o){return new We(this,o)}}Je("CollisionBoxArray",_i);class xi extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}xi.prototype.size=48;class Ui extends Xt{get(o){return new xi(this,o)}}Je("PlacedSymbolArray",Ui);class gi extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}gi.prototype.size=64;class Ni extends ie{get(o){return new gi(this,o)}}Je("SymbolInstanceArray",Ni);class Er extends re{getoffsetX(o){return this.float32[1*o+0]}}Je("GlyphOffsetArray",Er);class ur extends z{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}Je("SymbolLineVertexArray",ur);class Zr extends g{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Zr.prototype.size=12;class Zi extends ue{get(o){return new Zr(this,o)}}Je("TextAnchorOffsetArray",Zi);class bs extends g{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}bs.prototype.size=8;class ps extends Pe{get(o){return new bs(this,o)}}Je("FeatureIndexArray",ps);class Vr extends O{}class or extends O{}class dr extends O{}class Br extends V{}class sn extends G{}class $i extends J{}class ar extends lt{}class ws extends tt{}class qr extends ut{}class Na extends dt{}class $r extends wt{}class su extends mt{}class al extends Dt{}class fh extends xe{}const gh=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ro}=gh;class ns{constructor(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=o}prepareSegment(o,u,p,_){let x=this.segments[this.segments.length-1];return o>ns.MAX_VERTEX_ARRAY_LENGTH&&Bt(`Max vertices per segment is ${ns.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!x||x.vertexLength+o>ns.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==_)&&(x={vertexOffset:u.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},_!==void 0&&(x.sortKey=_),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,p,_){return new ns([{vertexOffset:o,primitiveOffset:u,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function wn(h,o){return 256*(h=Mt(Math.floor(h),0,255))+Mt(Math.floor(o),0,255)}ns.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Je("SegmentVector",ns);const ko=C([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ho={exports:{}},mh={exports:{}};mh.exports=function(h,o){var u,p,_,x,S,I,R,N;for(p=h.length-(u=3&h.length),_=o,S=3432918353,I=461845907,N=0;N<p;)R=255&h.charCodeAt(N)|(255&h.charCodeAt(++N))<<8|(255&h.charCodeAt(++N))<<16|(255&h.charCodeAt(++N))<<24,++N,_=27492+(65535&(x=5*(65535&(_=(_^=R=(65535&(R=(R=(65535&R)*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(R=0,u){case 3:R^=(255&h.charCodeAt(N+2))<<16;case 2:R^=(255&h.charCodeAt(N+1))<<8;case 1:_^=R=(65535&(R=(R=(65535&(R^=255&h.charCodeAt(N)))*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295}return _^=h.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var Hl=mh.exports,ip={exports:{}};ip.exports=function(h,o){for(var u,p=h.length,_=o^p,x=0;p>=4;)u=1540483477*(65535&(u=255&h.charCodeAt(x)|(255&h.charCodeAt(++x))<<8|(255&h.charCodeAt(++x))<<16|(255&h.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:_^=(255&h.charCodeAt(x+2))<<16;case 2:_^=(255&h.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&h.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var nu=Hl,rp=ip.exports;ho.exports=nu,ho.exports.murmur3=nu,ho.exports.murmur2=rp;var yh=f(ho.exports);class Wl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,p,_){this.ids.push(Ff(o)),this.positions.push(u,p,_)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Ff(o);let p=0,_=this.ids.length-1;for(;p<_;){const S=p+_>>1;this.ids[S]>=u?_=S:p=S+1}const x=[];for(;this.ids[p]===u;)x.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return x}static serialize(o,u){const p=new Float64Array(o.ids),_=new Uint32Array(o.positions);return sp(p,_,0,p.length-1),u&&u.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(o){const u=new Wl;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function Ff(h){const o=+h;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:yh(String(h))}function sp(h,o,u,p){for(;u<p;){const _=h[u+p>>1];let x=u-1,S=p+1;for(;;){do x++;while(h[x]<_);do S--;while(h[S]>_);if(x>=S)break;_h(h,x,S),_h(o,3*x,3*S),_h(o,3*x+1,3*S+1),_h(o,3*x+2,3*S+2)}S-u<p-S?(sp(h,o,u,S),u=S+1):(sp(h,o,S+1,p),p=S)}}function _h(h,o,u){const p=h[o];h[o]=h[u],h[u]=p}Je("FeaturePositionMap",Wl);class zn{constructor(o,u){this.gl=o.gl,this.location=u}}class Xu extends zn{constructor(o,u){super(o,u),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Nf extends zn{constructor(o,u){super(o,u),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class Df extends zn{constructor(o,u){super(o,u),this.current=Wi.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const zf=new Float32Array(16);function vh(h){return[wn(255*h.r,255*h.g),wn(255*h.b,255*h.a)]}class bh{constructor(o,u,p){this.value=o,this.uniformNames=u.map(_=>`u_${_}`),this.type=p}setUniform(o,u,p){o.set(p.constantOr(this.value))}getBinding(o,u,p){return this.type==="color"?new Df(o,u):new Xu(o,u)}}class Pc{constructor(o,u){this.uniformNames=u.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr}setUniform(o,u,p,_){const x=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&o.set(x)}getBinding(o,u,p){return p.substr(0,9)==="u_pattern"?new Nf(o,u):new Xu(o,u)}}class Oo{constructor(o,u,p,_){this.expression=o,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(x=>({name:`a_${x}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(o,u,p,_,x){const S=this.paintVertexArray.length,I=this.expression.evaluate(new br(0),u,{},_,[],x);this.paintVertexArray.resize(o),this._setPaintValue(S,o,I)}updatePaintArray(o,u,p,_){const x=this.expression.evaluate({zoom:0},p,_);this._setPaintValue(o,u,x)}_setPaintValue(o,u,p){if(this.type==="color"){const _=vh(p);for(let x=o;x<u;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=o;_<u;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uo{constructor(o,u,p,_,x,S){this.expression=o,this.uniformNames=u.map(I=>`u_${I}_t`),this.type=p,this.useIntegerZoom=_,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(I=>({name:`a_${I}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(o,u,p,_,x){const S=this.expression.evaluate(new br(this.zoom),u,{},_,[],x),I=this.expression.evaluate(new br(this.zoom+1),u,{},_,[],x),R=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(R,o,S,I)}updatePaintArray(o,u,p,_){const x=this.expression.evaluate({zoom:this.zoom},p,_),S=this.expression.evaluate({zoom:this.zoom+1},p,_);this._setPaintValue(o,u,x,S)}_setPaintValue(o,u,p,_){if(this.type==="color"){const x=vh(p),S=vh(_);for(let I=o;I<u;I++)this.paintVertexArray.emplace(I,x[0],x[1],S[0],S[1])}else{for(let x=o;x<u;x++)this.paintVertexArray.emplace(x,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u){const p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,_=Mt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);o.set(_)}getBinding(o,u,p){return new Xu(o,u)}}class Fo{constructor(o,u,p,_,x,S){this.expression=o,this.type=u,this.useIntegerZoom=p,this.zoom=_,this.layerId=S,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(o,u,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(_,o,u.patterns&&u.patterns[this.layerId],p)}updatePaintArray(o,u,p,_,x){this._setPaintValues(o,u,p.patterns&&p.patterns[this.layerId],x)}_setPaintValues(o,u,p,_){if(!_||!p)return;const{min:x,mid:S,max:I}=p,R=_[x],N=_[S],q=_[I];if(R&&N&&q)for(let W=o;W<u;W++)this.zoomInPaintVertexArray.emplace(W,N.tl[0],N.tl[1],N.br[0],N.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],N.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,N.tl[0],N.tl[1],N.br[0],N.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],N.pixelRatio,q.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,ko.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,ko.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class np{constructor(o,u,p){this.binders={},this._buffers=[];const _=[];for(const x in o.paint._values){if(!p(x))continue;const S=o.paint.get(x);if(!(S instanceof Bo&&ka(S.property.specification)))continue;const I=Zu(x,o.type),R=S.value,N=S.property.specification.type,q=S.property.useIntegerZoom,W=S.property.specification["property-type"],Y=W==="cross-faded"||W==="cross-faded-data-driven";if(R.kind==="constant")this.binders[x]=Y?new Pc(R.value,I):new bh(R.value,I,N),_.push(`/u_${x}`);else if(R.kind==="source"||Y){const it=op(x,N,"source");this.binders[x]=Y?new Fo(R,N,q,u,it,o.id):new Oo(R,I,N,it),_.push(`/a_${x}`)}else{const it=op(x,N,"composite");this.binders[x]=new uo(R,I,N,q,u,it),_.push(`/z_${x}`)}}this.cacheKey=_.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof Oo||u instanceof uo?u.maxValue:0}populatePaintArrays(o,u,p,_,x){for(const S in this.binders){const I=this.binders[S];(I instanceof Oo||I instanceof uo||I instanceof Fo)&&I.populatePaintArray(o,u,p,_,x)}}setConstantPatternPositions(o,u){for(const p in this.binders){const _=this.binders[p];_ instanceof Pc&&_.setConstantPatternPositions(o,u)}}updatePaintArrays(o,u,p,_,x){let S=!1;for(const I in o){const R=u.getPositions(I);for(const N of R){const q=p.feature(N.index);for(const W in this.binders){const Y=this.binders[W];if((Y instanceof Oo||Y instanceof uo||Y instanceof Fo)&&Y.expression.isStateDependent===!0){const it=_.paint.get(W);Y.expression=it.value,Y.updatePaintArray(N.start,N.end,q,o[I],x),S=!0}}}}return S}defines(){const o=[];for(const u in this.binders){const p=this.binders[u];(p instanceof bh||p instanceof Pc)&&o.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Oo||p instanceof uo)for(let _=0;_<p.paintVertexAttributes.length;_++)o.push(p.paintVertexAttributes[_].name);else if(p instanceof Fo)for(let _=0;_<ko.members.length;_++)o.push(ko.members[_].name)}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof bh||p instanceof Pc||p instanceof uo)for(const _ of p.uniformNames)o.push(_)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,u){const p=[];for(const _ in this.binders){const x=this.binders[_];if(x instanceof bh||x instanceof Pc||x instanceof uo){for(const S of x.uniformNames)if(u[S]){const I=x.getBinding(o,u[S],S);p.push({name:S,property:_,binding:I})}}}return p}setUniforms(o,u,p,_){for(const{name:x,property:S,binding:I}of u)this.binders[S].setUniform(I,_,p.get(S),x)}updatePaintBuffers(o){this._buffers=[];for(const u in this.binders){const p=this.binders[u];if(o&&p instanceof Fo){const _=o.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof Oo||p instanceof uo)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(o){for(const u in this.binders){const p=this.binders[u];(p instanceof Oo||p instanceof uo||p instanceof Fo)&&p.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof Oo||u instanceof uo||u instanceof Fo)&&u.destroy()}}}class Ic{constructor(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const _ of o)this.programConfigurations[_.id]=new np(_,u,p);this.needsUpload=!1,this._featureMap=new Wl,this._bufferOffset=0}populatePaintArrays(o,u,p,_,x,S){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,u,_,x,S);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,p,_){for(const x of p)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(o,this._featureMap,u,x,_)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function Zu(h,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${o}-`,"").replace(/-/g,"_")]}function op(h,o,u){const p={color:{source:J,composite:Xe},number:{source:re,composite:J}},_=function(x){return{"line-pattern":{source:ar,composite:ar},"fill-pattern":{source:ar,composite:ar},"fill-extrusion-pattern":{source:ar,composite:ar}}[x]}(h);return _&&_[u]||p[o][u]}Je("ConstantBinder",bh),Je("CrossFadedConstantBinder",Pc),Je("SourceExpressionBinder",Oo),Je("CrossFadedCompositeBinder",Fo),Je("CompositeExpressionBinder",uo),Je("ProgramConfiguration",np,{omit:["_buffers"]}),Je("ProgramConfigurationSet",Ic);const ts=8192,Da=Math.pow(2,14)-1,ap=-Da-1;function Jl(h){const o=ts/h.extent,u=h.loadGeometry();for(let p=0;p<u.length;p++){const _=u[p];for(let x=0;x<_.length;x++){const S=_[x],I=Math.round(S.x*o),R=Math.round(S.y*o);S.x=Mt(I,ap,Da),S.y=Mt(R,ap,Da),(I<S.x||I>S.x+1||R<S.y||R>S.y+1)&&Bt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Lc(h,o){return{type:h.type,id:h.id,properties:h.properties,geometry:o?Jl(h):[]}}function ou(h,o,u,p,_){h.emplaceBack(2*o+(p+1)/2,2*u+(_+1)/2)}class Xl{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new or,this.indexArray=new al,this.segments=new ns,this.programConfigurations=new Ic(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){const _=this.layers[0],x=[];let S=null,I=!1;_.type==="circle"&&(S=_.layout.get("circle-sort-key"),I=!S.isConstant());for(const{feature:R,id:N,index:q,sourceLayerIndex:W}of o){const Y=this.layers[0]._featureFilter.needGeometry,it=Lc(R,Y);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),it,p))continue;const at=I?S.evaluate(it,{},p):void 0,ft={id:N,properties:R.properties,type:R.type,sourceLayerIndex:W,index:q,geometry:Y?it.geometry:Jl(R),patterns:{},sortKey:at};x.push(ft)}I&&x.sort((R,N)=>R.sortKey-N.sortKey);for(const R of x){const{geometry:N,index:q,sourceLayerIndex:W}=R,Y=o[q].feature;this.addFeature(R,N,q,p),u.featureIndex.insert(Y,N,q,W,this.index)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ro),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,p,_){for(const x of u)for(const S of x){const I=S.x,R=S.y;if(I<0||I>=ts||R<0||R>=ts)continue;const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),q=N.vertexLength;ou(this.layoutVertexArray,I,R,-1,-1),ou(this.layoutVertexArray,I,R,1,-1),ou(this.layoutVertexArray,I,R,1,1),ou(this.layoutVertexArray,I,R,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,{},_)}}function Uf(h,o){for(let u=0;u<h.length;u++)if(po(o,h[u]))return!0;for(let u=0;u<o.length;u++)if(po(h,o[u]))return!0;return!!lp(h,o)}function jf(h,o,u){return!!po(h,o)||!!lu(o,h,u)}function Gf(h,o){if(h.length===1)return za(o,h[0]);for(let u=0;u<o.length;u++){const p=o[u];for(let _=0;_<p.length;_++)if(po(h,p[_]))return!0}for(let u=0;u<h.length;u++)if(za(o,h[u]))return!0;for(let u=0;u<o.length;u++)if(lp(h,o[u]))return!0;return!1}function Vf(h,o,u){if(h.length>1){if(lp(h,o))return!0;for(let p=0;p<o.length;p++)if(lu(o[p],h,u))return!0}for(let p=0;p<h.length;p++)if(lu(h[p],o,u))return!0;return!1}function lp(h,o){if(h.length===0||o.length===0)return!1;for(let u=0;u<h.length-1;u++){const p=h[u],_=h[u+1];for(let x=0;x<o.length-1;x++)if(au(p,_,o[x],o[x+1]))return!0}return!1}function au(h,o,u,p){return bt(h,u,p)!==bt(o,u,p)&&bt(h,o,u)!==bt(h,o,p)}function lu(h,o,u){const p=u*u;if(o.length===1)return h.distSqr(o[0])<p;for(let _=1;_<o.length;_++)if(cu(h,o[_-1],o[_])<p)return!0;return!1}function cu(h,o,u){const p=o.distSqr(u);if(p===0)return h.distSqr(o);const _=((h.x-o.x)*(u.x-o.x)+(h.y-o.y)*(u.y-o.y))/p;return h.distSqr(_<0?o:_>1?u:u.sub(o)._mult(_)._add(o))}function za(h,o){let u,p,_,x=!1;for(let S=0;S<h.length;S++){u=h[S];for(let I=0,R=u.length-1;I<u.length;R=I++)p=u[I],_=u[R],p.y>o.y!=_.y>o.y&&o.x<(_.x-p.x)*(o.y-p.y)/(_.y-p.y)+p.x&&(x=!x)}return x}function po(h,o){let u=!1;for(let p=0,_=h.length-1;p<h.length;_=p++){const x=h[p],S=h[_];x.y>o.y!=S.y>o.y&&o.x<(S.x-x.x)*(o.y-x.y)/(S.y-x.y)+x.x&&(u=!u)}return u}function Zl(h,o,u){const p=u[0],_=u[2];if(h.x<p.x&&o.x<p.x||h.x>_.x&&o.x>_.x||h.y<p.y&&o.y<p.y||h.y>_.y&&o.y>_.y)return!1;const x=bt(h,o,u[0]);return x!==bt(h,o,u[1])||x!==bt(h,o,u[2])||x!==bt(h,o,u[3])}function $l(h,o,u){const p=o.paint.get(h).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(h)}function wh(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function hu(h,o,u,p,_){if(!o[0]&&!o[1])return h;const x=T.convert(o)._mult(_);u==="viewport"&&x._rotate(-p);const S=[];for(let I=0;I<h.length;I++)S.push(h[I].sub(x));return S}let qf,$u;Je("CircleBucket",Xl,{omit:["layers"]});var cp={get paint(){return $u=$u||new v({"circle-radius":new w(ot.paint_circle["circle-radius"]),"circle-color":new w(ot.paint_circle["circle-color"]),"circle-blur":new w(ot.paint_circle["circle-blur"]),"circle-opacity":new w(ot.paint_circle["circle-opacity"]),"circle-translate":new oi(ot.paint_circle["circle-translate"]),"circle-translate-anchor":new oi(ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new oi(ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new oi(ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new w(ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new w(ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new w(ot.paint_circle["circle-stroke-opacity"])})},get layout(){return qf=qf||new v({"circle-sort-key":new w(ot.layout_circle["circle-sort-key"])})}},Un=1e-6,Yu=typeof Float32Array<"u"?Float32Array:Array;function Ym(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function Fv(h,o,u){var p=o[0],_=o[1],x=o[2],S=o[3],I=o[4],R=o[5],N=o[6],q=o[7],W=o[8],Y=o[9],it=o[10],at=o[11],ft=o[12],At=o[13],It=o[14],Zt=o[15],Ft=u[0],Ht=u[1],ye=u[2],ve=u[3];return h[0]=Ft*p+Ht*I+ye*W+ve*ft,h[1]=Ft*_+Ht*R+ye*Y+ve*At,h[2]=Ft*x+Ht*N+ye*it+ve*It,h[3]=Ft*S+Ht*q+ye*at+ve*Zt,h[4]=(Ft=u[4])*p+(Ht=u[5])*I+(ye=u[6])*W+(ve=u[7])*ft,h[5]=Ft*_+Ht*R+ye*Y+ve*At,h[6]=Ft*x+Ht*N+ye*it+ve*It,h[7]=Ft*S+Ht*q+ye*at+ve*Zt,h[8]=(Ft=u[8])*p+(Ht=u[9])*I+(ye=u[10])*W+(ve=u[11])*ft,h[9]=Ft*_+Ht*R+ye*Y+ve*At,h[10]=Ft*x+Ht*N+ye*it+ve*It,h[11]=Ft*S+Ht*q+ye*at+ve*Zt,h[12]=(Ft=u[12])*p+(Ht=u[13])*I+(ye=u[14])*W+(ve=u[15])*ft,h[13]=Ft*_+Ht*R+ye*Y+ve*At,h[14]=Ft*x+Ht*N+ye*it+ve*It,h[15]=Ft*S+Ht*q+ye*at+ve*Zt,h}Math.hypot||(Math.hypot=function(){for(var h=0,o=arguments.length;o--;)h+=arguments[o]*arguments[o];return Math.sqrt(h)});var hp,uC=Fv;function Hf(h,o,u){var p=o[0],_=o[1],x=o[2],S=o[3];return h[0]=u[0]*p+u[4]*_+u[8]*x+u[12]*S,h[1]=u[1]*p+u[5]*_+u[9]*x+u[13]*S,h[2]=u[2]*p+u[6]*_+u[10]*x+u[14]*S,h[3]=u[3]*p+u[7]*_+u[11]*x+u[15]*S,h}hp=new Yu(4),Yu!=Float32Array&&(hp[0]=0,hp[1]=0,hp[2]=0,hp[3]=0);class dC extends B{constructor(o){super(o,cp)}createBucket(o){return new Xl(o)}queryRadius(o){const u=o;return $l("circle-radius",this,u)+$l("circle-stroke-width",this,u)+wh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,u,p,_,x,S,I,R){const N=hu(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,I),q=this.paint.get("circle-radius").evaluate(u,p)+this.paint.get("circle-stroke-width").evaluate(u,p),W=this.paint.get("circle-pitch-alignment")==="map",Y=W?N:function(at,ft){return at.map(At=>Nv(At,ft))}(N,R),it=W?q*I:q;for(const at of _)for(const ft of at){const At=W?ft:Nv(ft,R);let It=it;const Zt=Hf([],[ft.x,ft.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?It*=Zt[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(It*=S.cameraToCenterDistance/Zt[3]),jf(Y,At,It))return!0}return!1}}function Nv(h,o){const u=Hf([],[h.x,h.y,0,1],o);return new T(u[0]/u[3],u[1]/u[3])}class Dv extends Xl{}let zv;Je("HeatmapBucket",Dv,{omit:["layers"]});var pC={get paint(){return zv=zv||new v({"heatmap-radius":new w(ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new w(ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new oi(ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new m(ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new oi(ot.paint_heatmap["heatmap-opacity"])})}};function Km(h,o,u,p){let{width:_,height:x}=o;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==_*x*u)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${_*x*u}`)}else p=new Uint8Array(_*x*u);return h.width=_,h.height=x,h.data=p,h}function Uv(h,o,u){let{width:p,height:_}=o;if(p===h.width&&_===h.height)return;const x=Km({},{width:p,height:_},u);Qm(h,x,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,p),height:Math.min(h.height,_)},u),h.width=p,h.height=_,h.data=x.data}function Qm(h,o,u,p,_,x){if(_.width===0||_.height===0)return o;if(_.width>h.width||_.height>h.height||u.x>h.width-_.width||u.y>h.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||p.x>o.width-_.width||p.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const S=h.data,I=o.data;if(S===I)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<_.height;R++){const N=((u.y+R)*h.width+u.x)*x,q=((p.y+R)*o.width+p.x)*x;for(let W=0;W<_.width*x;W++)I[q+W]=S[N+W]}return o}class up{constructor(o,u){Km(this,o,1,u)}resize(o){Uv(this,o,1)}clone(){return new up({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,p,_,x){Qm(o,u,p,_,x,1)}}class aa{constructor(o,u){Km(this,o,4,u)}resize(o){Uv(this,o,4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,p,_,x){Qm(o,u,p,_,x,4)}}function jv(h){const o={},u=h.resolution||256,p=h.clips?h.clips.length:1,_=h.image||new aa({width:u,height:p});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const x=(S,I,R)=>{o[h.evaluationKey]=R;const N=h.expression.evaluate(o);_.data[S+I+0]=Math.floor(255*N.r/N.a),_.data[S+I+1]=Math.floor(255*N.g/N.a),_.data[S+I+2]=Math.floor(255*N.b/N.a),_.data[S+I+3]=Math.floor(255*N.a)};if(h.clips)for(let S=0,I=0;S<p;++S,I+=4*u)for(let R=0,N=0;R<u;R++,N+=4){const q=R/(u-1),{start:W,end:Y}=h.clips[S];x(I,N,W*(1-q)+Y*q)}else for(let S=0,I=0;S<u;S++,I+=4)x(0,I,S/(u-1));return _}Je("AlphaImage",up),Je("RGBAImage",aa);class fC extends B{createBucket(o){return new Dv(o)}constructor(o){super(o,pC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=jv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Gv;var gC={get paint(){return Gv=Gv||new v({"hillshade-illumination-direction":new oi(ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new oi(ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new oi(ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new oi(ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new oi(ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new oi(ot.paint_hillshade["hillshade-accent-color"])})}};class mC extends B{constructor(o){super(o,gC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const yC=C([{name:"a_pos",components:2,type:"Int16"}],4),{members:_C}=yC;var t0={exports:{}};function Wf(h,o,u){u=u||2;var p,_,x,S,I,R,N,q=o&&o.length,W=q?o[0]*u:h.length,Y=Vv(h,0,W,u,!0),it=[];if(!Y||Y.next===Y.prev)return it;if(q&&(Y=function(ft,At,It,Zt){var Ft,Ht,ye,ve=[];for(Ft=0,Ht=At.length;Ft<Ht;Ft++)(ye=Vv(ft,At[Ft]*Zt,Ft<Ht-1?At[Ft+1]*Zt:ft.length,Zt,!1))===ye.next&&(ye.steiner=!0),ve.push(CC(ye));for(ve.sort(AC),Ft=0;Ft<ve.length;Ft++)It=SC(ve[Ft],It);return It}(h,o,Y,u)),h.length>80*u){p=x=h[0],_=S=h[1];for(var at=u;at<W;at+=u)(I=h[at])<p&&(p=I),(R=h[at+1])<_&&(_=R),I>x&&(x=I),R>S&&(S=R);N=(N=Math.max(x-p,S-_))!==0?32767/N:0}return dp(Y,it,u,p,_,N,0),it}function Vv(h,o,u,p,_){var x,S;if(_===r0(h,o,u,p)>0)for(x=o;x<u;x+=p)S=Wv(x,h[x],h[x+1],S);else for(x=u-p;x>=o;x-=p)S=Wv(x,h[x],h[x+1],S);return S&&Jf(S,S.next)&&(fp(S),S=S.next),S}function uu(h,o){if(!h)return h;o||(o=h);var u,p=h;do if(u=!1,p.steiner||!Jf(p,p.next)&&fs(p.prev,p,p.next)!==0)p=p.next;else{if(fp(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function dp(h,o,u,p,_,x,S){if(h){!S&&x&&function(q,W,Y,it){var at=q;do at.z===0&&(at.z=e0(at.x,at.y,W,Y,it)),at.prevZ=at.prev,at.nextZ=at.next,at=at.next;while(at!==q);at.prevZ.nextZ=null,at.prevZ=null,function(ft){var At,It,Zt,Ft,Ht,ye,ve,Ve,ei=1;do{for(It=ft,ft=null,Ht=null,ye=0;It;){for(ye++,Zt=It,ve=0,At=0;At<ei&&(ve++,Zt=Zt.nextZ);At++);for(Ve=ei;ve>0||Ve>0&&Zt;)ve!==0&&(Ve===0||!Zt||It.z<=Zt.z)?(Ft=It,It=It.nextZ,ve--):(Ft=Zt,Zt=Zt.nextZ,Ve--),Ht?Ht.nextZ=Ft:ft=Ft,Ft.prevZ=Ht,Ht=Ft;It=Zt}Ht.nextZ=null,ei*=2}while(ye>1)}(at)}(h,p,_,x);for(var I,R,N=h;h.prev!==h.next;)if(I=h.prev,R=h.next,x?bC(h,p,_,x):vC(h))o.push(I.i/u|0),o.push(h.i/u|0),o.push(R.i/u|0),fp(h),h=R.next,N=R.next;else if((h=R)===N){S?S===1?dp(h=wC(uu(h),o,u),o,u,p,_,x,2):S===2&&xC(h,o,u,p,_,x):dp(uu(h),o,u,p,_,x,1);break}}}function vC(h){var o=h.prev,u=h,p=h.next;if(fs(o,u,p)>=0)return!1;for(var _=o.x,x=u.x,S=p.x,I=o.y,R=u.y,N=p.y,q=_<x?_<S?_:S:x<S?x:S,W=I<R?I<N?I:N:R<N?R:N,Y=_>x?_>S?_:S:x>S?x:S,it=I>R?I>N?I:N:R>N?R:N,at=p.next;at!==o;){if(at.x>=q&&at.x<=Y&&at.y>=W&&at.y<=it&&Ku(_,I,x,R,S,N,at.x,at.y)&&fs(at.prev,at,at.next)>=0)return!1;at=at.next}return!0}function bC(h,o,u,p){var _=h.prev,x=h,S=h.next;if(fs(_,x,S)>=0)return!1;for(var I=_.x,R=x.x,N=S.x,q=_.y,W=x.y,Y=S.y,it=I<R?I<N?I:N:R<N?R:N,at=q<W?q<Y?q:Y:W<Y?W:Y,ft=I>R?I>N?I:N:R>N?R:N,At=q>W?q>Y?q:Y:W>Y?W:Y,It=e0(it,at,o,u,p),Zt=e0(ft,At,o,u,p),Ft=h.prevZ,Ht=h.nextZ;Ft&&Ft.z>=It&&Ht&&Ht.z<=Zt;){if(Ft.x>=it&&Ft.x<=ft&&Ft.y>=at&&Ft.y<=At&&Ft!==_&&Ft!==S&&Ku(I,q,R,W,N,Y,Ft.x,Ft.y)&&fs(Ft.prev,Ft,Ft.next)>=0||(Ft=Ft.prevZ,Ht.x>=it&&Ht.x<=ft&&Ht.y>=at&&Ht.y<=At&&Ht!==_&&Ht!==S&&Ku(I,q,R,W,N,Y,Ht.x,Ht.y)&&fs(Ht.prev,Ht,Ht.next)>=0))return!1;Ht=Ht.nextZ}for(;Ft&&Ft.z>=It;){if(Ft.x>=it&&Ft.x<=ft&&Ft.y>=at&&Ft.y<=At&&Ft!==_&&Ft!==S&&Ku(I,q,R,W,N,Y,Ft.x,Ft.y)&&fs(Ft.prev,Ft,Ft.next)>=0)return!1;Ft=Ft.prevZ}for(;Ht&&Ht.z<=Zt;){if(Ht.x>=it&&Ht.x<=ft&&Ht.y>=at&&Ht.y<=At&&Ht!==_&&Ht!==S&&Ku(I,q,R,W,N,Y,Ht.x,Ht.y)&&fs(Ht.prev,Ht,Ht.next)>=0)return!1;Ht=Ht.nextZ}return!0}function wC(h,o,u){var p=h;do{var _=p.prev,x=p.next.next;!Jf(_,x)&&qv(_,p,p.next,x)&&pp(_,x)&&pp(x,_)&&(o.push(_.i/u|0),o.push(p.i/u|0),o.push(x.i/u|0),fp(p),fp(p.next),p=h=x),p=p.next}while(p!==h);return uu(p)}function xC(h,o,u,p,_,x){var S=h;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&TC(S,I)){var R=Hv(S,I);return S=uu(S,S.next),R=uu(R,R.next),dp(S,o,u,p,_,x,0),void dp(R,o,u,p,_,x,0)}I=I.next}S=S.next}while(S!==h)}function AC(h,o){return h.x-o.x}function SC(h,o){var u=function(_,x){var S,I=x,R=_.x,N=_.y,q=-1/0;do{if(N<=I.y&&N>=I.next.y&&I.next.y!==I.y){var W=I.x+(N-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(W<=R&&W>q&&(q=W,S=I.x<I.next.x?I:I.next,W===R))return S}I=I.next}while(I!==x);if(!S)return null;var Y,it=S,at=S.x,ft=S.y,At=1/0;I=S;do R>=I.x&&I.x>=at&&R!==I.x&&Ku(N<ft?R:q,N,at,ft,N<ft?q:R,N,I.x,I.y)&&(Y=Math.abs(N-I.y)/(R-I.x),pp(I,_)&&(Y<At||Y===At&&(I.x>S.x||I.x===S.x&&EC(S,I)))&&(S=I,At=Y)),I=I.next;while(I!==it);return S}(h,o);if(!u)return o;var p=Hv(u,h);return uu(p,p.next),uu(u,u.next)}function EC(h,o){return fs(h.prev,h,o.prev)<0&&fs(o.next,h,h.next)<0}function e0(h,o,u,p,_){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*_|0)|h<<8))|h<<4))|h<<2))|h<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-p)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function CC(h){var o=h,u=h;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==h);return u}function Ku(h,o,u,p,_,x,S,I){return(_-S)*(o-I)>=(h-S)*(x-I)&&(h-S)*(p-I)>=(u-S)*(o-I)&&(u-S)*(x-I)>=(_-S)*(p-I)}function TC(h,o){return h.next.i!==o.i&&h.prev.i!==o.i&&!function(u,p){var _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==p.i&&_.next.i!==p.i&&qv(_,_.next,u,p))return!0;_=_.next}while(_!==u);return!1}(h,o)&&(pp(h,o)&&pp(o,h)&&function(u,p){var _=u,x=!1,S=(u.x+p.x)/2,I=(u.y+p.y)/2;do _.y>I!=_.next.y>I&&_.next.y!==_.y&&S<(_.next.x-_.x)*(I-_.y)/(_.next.y-_.y)+_.x&&(x=!x),_=_.next;while(_!==u);return x}(h,o)&&(fs(h.prev,h,o.prev)||fs(h,o.prev,o))||Jf(h,o)&&fs(h.prev,h,h.next)>0&&fs(o.prev,o,o.next)>0)}function fs(h,o,u){return(o.y-h.y)*(u.x-o.x)-(o.x-h.x)*(u.y-o.y)}function Jf(h,o){return h.x===o.x&&h.y===o.y}function qv(h,o,u,p){var _=Zf(fs(h,o,u)),x=Zf(fs(h,o,p)),S=Zf(fs(u,p,h)),I=Zf(fs(u,p,o));return _!==x&&S!==I||!(_!==0||!Xf(h,u,o))||!(x!==0||!Xf(h,p,o))||!(S!==0||!Xf(u,h,p))||!(I!==0||!Xf(u,o,p))}function Xf(h,o,u){return o.x<=Math.max(h.x,u.x)&&o.x>=Math.min(h.x,u.x)&&o.y<=Math.max(h.y,u.y)&&o.y>=Math.min(h.y,u.y)}function Zf(h){return h>0?1:h<0?-1:0}function pp(h,o){return fs(h.prev,h,h.next)<0?fs(h,o,h.next)>=0&&fs(h,h.prev,o)>=0:fs(h,o,h.prev)<0||fs(h,h.next,o)<0}function Hv(h,o){var u=new i0(h.i,h.x,h.y),p=new i0(o.i,o.x,o.y),_=h.next,x=o.prev;return h.next=o,o.prev=h,u.next=_,_.prev=u,p.next=u,u.prev=p,x.next=p,p.prev=x,p}function Wv(h,o,u,p){var _=new i0(h,o,u);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function fp(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function i0(h,o,u){this.i=h,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function r0(h,o,u,p){for(var _=0,x=o,S=u-p;x<u;x+=p)_+=(h[S]-h[x])*(h[x+1]+h[S+1]),S=x;return _}t0.exports=Wf,t0.exports.default=Wf,Wf.deviation=function(h,o,u,p){var _=o&&o.length,x=Math.abs(r0(h,0,_?o[0]*u:h.length,u));if(_)for(var S=0,I=o.length;S<I;S++)x-=Math.abs(r0(h,o[S]*u,S<I-1?o[S+1]*u:h.length,u));var R=0;for(S=0;S<p.length;S+=3){var N=p[S]*u,q=p[S+1]*u,W=p[S+2]*u;R+=Math.abs((h[N]-h[W])*(h[q+1]-h[N+1])-(h[N]-h[q])*(h[W+1]-h[N+1]))}return x===0&&R===0?0:Math.abs((R-x)/x)},Wf.flatten=function(h){for(var o=h[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,_=0;_<h.length;_++){for(var x=0;x<h[_].length;x++)for(var S=0;S<o;S++)u.vertices.push(h[_][x][S]);_>0&&u.holes.push(p+=h[_-1].length)}return u};var Jv=f(t0.exports);function s0(h,o,u){const p=u.patternDependencies;let _=!1;for(const x of o){const S=x.paint.get(`${h}-pattern`);S.isConstant()||(_=!0);const I=S.constantOr(null);I&&(_=!0,p[I.to]=!0,p[I.from]=!0)}return _}function n0(h,o,u,p,_){const x=_.patternDependencies;for(const S of o){const I=S.paint.get(`${h}-pattern`).value;if(I.kind!=="constant"){let R=I.evaluate({zoom:p-1},u,{},_.availableImages),N=I.evaluate({zoom:p},u,{},_.availableImages),q=I.evaluate({zoom:p+1},u,{},_.availableImages);R=R&&R.name?R.name:R,N=N&&N.name?N.name:N,q=q&&q.name?q.name:q,x[R]=!0,x[N]=!0,x[q]=!0,u.patterns[S.id]={min:R,mid:N,max:q}}}return u}class o0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new dr,this.indexArray=new al,this.indexArray2=new fh,this.programConfigurations=new Ic(o.layers,o.zoom),this.segments=new ns,this.segments2=new ns,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){this.hasPattern=s0("fill",this.layers,u);const _=this.layers[0].layout.get("fill-sort-key"),x=!_.isConstant(),S=[];for(const{feature:I,id:R,index:N,sourceLayerIndex:q}of o){const W=this.layers[0]._featureFilter.needGeometry,Y=Lc(I,W);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),Y,p))continue;const it=x?_.evaluate(Y,{},p,u.availableImages):void 0,at={id:R,properties:I.properties,type:I.type,sourceLayerIndex:q,index:N,geometry:W?Y.geometry:Jl(I),patterns:{},sortKey:it};S.push(at)}x&&S.sort((I,R)=>I.sortKey-R.sortKey);for(const I of S){const{geometry:R,index:N,sourceLayerIndex:q}=I;if(this.hasPattern){const W=n0("fill",this.layers,I,this.zoom,u);this.patternFeatures.push(W)}else this.addFeature(I,R,N,p,{});u.featureIndex.insert(o[N].feature,R,N,q,this.index)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}addFeatures(o,u,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_C),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,p,_,x){for(const S of Pa(u,500)){let I=0;for(const it of S)I+=it.length;const R=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),N=R.vertexLength,q=[],W=[];for(const it of S){if(it.length===0)continue;it!==S[0]&&W.push(q.length/2);const at=this.segments2.prepareSegment(it.length,this.layoutVertexArray,this.indexArray2),ft=at.vertexLength;this.layoutVertexArray.emplaceBack(it[0].x,it[0].y),this.indexArray2.emplaceBack(ft+it.length-1,ft),q.push(it[0].x),q.push(it[0].y);for(let At=1;At<it.length;At++)this.layoutVertexArray.emplaceBack(it[At].x,it[At].y),this.indexArray2.emplaceBack(ft+At-1,ft+At),q.push(it[At].x),q.push(it[At].y);at.vertexLength+=it.length,at.primitiveLength+=it.length}const Y=Jv(q,W);for(let it=0;it<Y.length;it+=3)this.indexArray.emplaceBack(N+Y[it],N+Y[it+1],N+Y[it+2]);R.vertexLength+=I,R.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,x,_)}}let Xv,Zv;Je("FillBucket",o0,{omit:["layers","patternFeatures"]});var PC={get paint(){return Zv=Zv||new v({"fill-antialias":new oi(ot.paint_fill["fill-antialias"]),"fill-opacity":new w(ot.paint_fill["fill-opacity"]),"fill-color":new w(ot.paint_fill["fill-color"]),"fill-outline-color":new w(ot.paint_fill["fill-outline-color"]),"fill-translate":new oi(ot.paint_fill["fill-translate"]),"fill-translate-anchor":new oi(ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new a(ot.paint_fill["fill-pattern"])})},get layout(){return Xv=Xv||new v({"fill-sort-key":new w(ot.layout_fill["fill-sort-key"])})}};class IC extends B{constructor(o){super(o,PC)}recalculate(o,u){super.recalculate(o,u);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new o0(o)}queryRadius(){return wh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,u,p,_,x,S,I){return Gf(hu(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,I),_)}isTileClipped(){return!0}}const LC=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),MC=C([{name:"a_centroid",components:2,type:"Int16"}],4),{members:BC}=LC;var xh={},RC=y,$v=Qu;function Qu(h,o,u,p,_){this.properties={},this.extent=u,this.type=0,this._pbf=h,this._geometry=-1,this._keys=p,this._values=_,h.readFields(kC,this,o)}function kC(h,o,u){h==1?o.id=u.readVarint():h==2?function(p,_){for(var x=p.readVarint()+p.pos;p.pos<x;){var S=_._keys[p.readVarint()],I=_._values[p.readVarint()];_.properties[S]=I}}(u,o):h==3?o.type=u.readVarint():h==4&&(o._geometry=u.pos)}function OC(h){for(var o,u,p=0,_=0,x=h.length,S=x-1;_<x;S=_++)p+=((u=h[S]).x-(o=h[_]).x)*(o.y+u.y);return p}Qu.types=["Unknown","Point","LineString","Polygon"],Qu.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var o,u=h.readVarint()+h.pos,p=1,_=0,x=0,S=0,I=[];h.pos<u;){if(_<=0){var R=h.readVarint();p=7&R,_=R>>3}if(_--,p===1||p===2)x+=h.readSVarint(),S+=h.readSVarint(),p===1&&(o&&I.push(o),o=[]),o.push(new RC(x,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Qu.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var o=h.readVarint()+h.pos,u=1,p=0,_=0,x=0,S=1/0,I=-1/0,R=1/0,N=-1/0;h.pos<o;){if(p<=0){var q=h.readVarint();u=7&q,p=q>>3}if(p--,u===1||u===2)(_+=h.readSVarint())<S&&(S=_),_>I&&(I=_),(x+=h.readSVarint())<R&&(R=x),x>N&&(N=x);else if(u!==7)throw new Error("unknown command "+u)}return[S,R,I,N]},Qu.prototype.toGeoJSON=function(h,o,u){var p,_,x=this.extent*Math.pow(2,u),S=this.extent*h,I=this.extent*o,R=this.loadGeometry(),N=Qu.types[this.type];function q(it){for(var at=0;at<it.length;at++){var ft=it[at];it[at]=[360*(ft.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(ft.y+I)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(p=0;p<R.length;p++)W[p]=R[p][0];q(R=W);break;case 2:for(p=0;p<R.length;p++)q(R[p]);break;case 3:for(R=function(it){var at=it.length;if(at<=1)return[it];for(var ft,At,It=[],Zt=0;Zt<at;Zt++){var Ft=OC(it[Zt]);Ft!==0&&(At===void 0&&(At=Ft<0),At===Ft<0?(ft&&It.push(ft),ft=[it[Zt]]):ft.push(it[Zt]))}return ft&&It.push(ft),It}(R),p=0;p<R.length;p++)for(_=0;_<R[p].length;_++)q(R[p][_])}R.length===1?R=R[0]:N="Multi"+N;var Y={type:"Feature",geometry:{type:N,coordinates:R},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var FC=$v,Yv=Kv;function Kv(h,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(NC,this,o),this.length=this._features.length}function NC(h,o,u){h===15?o.version=u.readVarint():h===1?o.name=u.readString():h===5?o.extent=u.readVarint():h===2?o._features.push(u.pos):h===3?o._keys.push(u.readString()):h===4&&o._values.push(function(p){for(var _=null,x=p.readVarint()+p.pos;p.pos<x;){var S=p.readVarint()>>3;_=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return _}(u))}Kv.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var o=this._pbf.readVarint()+this._pbf.pos;return new FC(this._pbf,o,this.extent,this._keys,this._values)};var DC=Yv;function zC(h,o,u){if(h===3){var p=new DC(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}xh.VectorTile=function(h,o){this.layers=h.readFields(zC,{},o)},xh.VectorTileFeature=$v,xh.VectorTileLayer=Yv;const UC=xh.VectorTileFeature.types,a0=Math.pow(2,13);function gp(h,o,u,p,_,x,S,I){h.emplaceBack(o,u,2*Math.floor(p*a0)+S,_*a0*2,x*a0*2,Math.round(I))}class l0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Br,this.centroidVertexArray=new Vr,this.indexArray=new al,this.programConfigurations=new Ic(o.layers,o.zoom),this.segments=new ns,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){this.features=[],this.hasPattern=s0("fill-extrusion",this.layers,u);for(const{feature:_,id:x,index:S,sourceLayerIndex:I}of o){const R=this.layers[0]._featureFilter.needGeometry,N=Lc(_,R);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),N,p))continue;const q={id:x,sourceLayerIndex:I,index:S,geometry:R?N.geometry:Jl(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(n0("fill-extrusion",this.layers,q,this.zoom,u)):this.addFeature(q,q.geometry,S,p,{}),u.featureIndex.insert(_,q.geometry,S,I,this.index,!0)}}addFeatures(o,u,p){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,u,p)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,BC),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,MC.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,u,p,_,x){const S={x:0,y:0,vertexCount:0};for(const I of Pa(u,500)){let R=0;for(const at of I)R+=at.length;let N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const at of I){if(at.length===0||GC(at))continue;let ft=0;for(let At=0;At<at.length;At++){const It=at[At];if(At>=1){const Zt=at[At-1];if(!jC(It,Zt)){N.vertexLength+4>ns.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ft=It.sub(Zt)._perp()._unit(),Ht=Zt.dist(It);ft+Ht>32768&&(ft=0),gp(this.layoutVertexArray,It.x,It.y,Ft.x,Ft.y,0,0,ft),gp(this.layoutVertexArray,It.x,It.y,Ft.x,Ft.y,0,1,ft),S.x+=2*It.x,S.y+=2*It.y,S.vertexCount+=2,ft+=Ht,gp(this.layoutVertexArray,Zt.x,Zt.y,Ft.x,Ft.y,0,0,ft),gp(this.layoutVertexArray,Zt.x,Zt.y,Ft.x,Ft.y,0,1,ft),S.x+=2*Zt.x,S.y+=2*Zt.y,S.vertexCount+=2;const ye=N.vertexLength;this.indexArray.emplaceBack(ye,ye+2,ye+1),this.indexArray.emplaceBack(ye+1,ye+2,ye+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+R>ns.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),UC[o.type]!=="Polygon")continue;const q=[],W=[],Y=N.vertexLength;for(const at of I)if(at.length!==0){at!==I[0]&&W.push(q.length/2);for(let ft=0;ft<at.length;ft++){const At=at[ft];gp(this.layoutVertexArray,At.x,At.y,0,0,1,1,0),S.x+=At.x,S.y+=At.y,S.vertexCount+=1,q.push(At.x),q.push(At.y)}}const it=Jv(q,W);for(let at=0;at<it.length;at+=3)this.indexArray.emplaceBack(Y+it[at],Y+it[at+2],Y+it[at+1]);N.primitiveLength+=it.length/3,N.vertexLength+=R}for(let I=0;I<S.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,x,_)}}function jC(h,o){return h.x===o.x&&(h.x<0||h.x>ts)||h.y===o.y&&(h.y<0||h.y>ts)}function GC(h){return h.every(o=>o.x<0)||h.every(o=>o.x>ts)||h.every(o=>o.y<0)||h.every(o=>o.y>ts)}let Qv;Je("FillExtrusionBucket",l0,{omit:["layers","features"]});var VC={get paint(){return Qv=Qv||new v({"fill-extrusion-opacity":new oi(ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new w(ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new oi(ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new oi(ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new a(ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new w(ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new w(ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new oi(ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qC extends B{constructor(o){super(o,VC)}createBucket(o){return new l0(o)}queryRadius(){return wh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,u,p,_,x,S,I,R){const N=hu(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,I),q=this.paint.get("fill-extrusion-height").evaluate(u,p),W=this.paint.get("fill-extrusion-base").evaluate(u,p),Y=function(at,ft,At,It){const Zt=[];for(const Ft of at){const Ht=[Ft.x,Ft.y,0,1];Hf(Ht,Ht,ft),Zt.push(new T(Ht[0]/Ht[3],Ht[1]/Ht[3]))}return Zt}(N,R),it=function(at,ft,At,It){const Zt=[],Ft=[],Ht=It[8]*ft,ye=It[9]*ft,ve=It[10]*ft,Ve=It[11]*ft,ei=It[8]*At,Ue=It[9]*At,ke=It[10]*At,Ke=It[11]*At;for(const li of at){const Ge=[],we=[];for(const ii of li){const Qe=ii.x,Mi=ii.y,Tr=It[0]*Qe+It[4]*Mi+It[12],Pr=It[1]*Qe+It[5]*Mi+It[13],xs=It[2]*Qe+It[6]*Mi+It[14],ca=It[3]*Qe+It[7]*Mi+It[15],xn=xs+ve,Ns=ca+Ve,Zs=Tr+ei,An=Pr+Ue,jn=xs+ke,Sn=ca+Ke,As=new T((Tr+Ht)/Ns,(Pr+ye)/Ns);As.z=xn/Ns,Ge.push(As);const Gs=new T(Zs/Sn,An/Sn);Gs.z=jn/Sn,we.push(Gs)}Zt.push(Ge),Ft.push(we)}return[Zt,Ft]}(_,W,q,R);return function(at,ft,At){let It=1/0;Gf(At,ft)&&(It=tb(At,ft[0]));for(let Zt=0;Zt<ft.length;Zt++){const Ft=ft[Zt],Ht=at[Zt];for(let ye=0;ye<Ft.length-1;ye++){const ve=Ft[ye],Ve=[ve,Ft[ye+1],Ht[ye+1],Ht[ye],ve];Uf(At,Ve)&&(It=Math.min(It,tb(At,Ve)))}}return It!==1/0&&It}(it[0],it[1],Y)}}function mp(h,o){return h.x*o.x+h.y*o.y}function tb(h,o){if(h.length===1){let u=0;const p=o[u++];let _;for(;!_||p.equals(_);)if(_=o[u++],!_)return 1/0;for(;u<o.length;u++){const x=o[u],S=h[0],I=_.sub(p),R=x.sub(p),N=S.sub(p),q=mp(I,I),W=mp(I,R),Y=mp(R,R),it=mp(N,I),at=mp(N,R),ft=q*Y-W*W,At=(Y*it-W*at)/ft,It=(q*at-W*it)/ft,Zt=p.z*(1-At-It)+_.z*At+x.z*It;if(isFinite(Zt))return Zt}return 1/0}{let u=1/0;for(const p of o)u=Math.min(u,p.z);return u}}const HC=C([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:WC}=HC,JC=C([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:XC}=JC,ZC=xh.VectorTileFeature.types,$C=Math.cos(Math.PI/180*37.5),eb=Math.pow(2,14)/.5;class c0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new sn,this.layoutVertexArray2=new $i,this.indexArray=new al,this.programConfigurations=new Ic(o.layers,o.zoom),this.segments=new ns,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){this.hasPattern=s0("line",this.layers,u);const _=this.layers[0].layout.get("line-sort-key"),x=!_.isConstant(),S=[];for(const{feature:I,id:R,index:N,sourceLayerIndex:q}of o){const W=this.layers[0]._featureFilter.needGeometry,Y=Lc(I,W);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),Y,p))continue;const it=x?_.evaluate(Y,{},p):void 0,at={id:R,properties:I.properties,type:I.type,sourceLayerIndex:q,index:N,geometry:W?Y.geometry:Jl(I),patterns:{},sortKey:it};S.push(at)}x&&S.sort((I,R)=>I.sortKey-R.sortKey);for(const I of S){const{geometry:R,index:N,sourceLayerIndex:q}=I;if(this.hasPattern){const W=n0("line",this.layers,I,this.zoom,u);this.patternFeatures.push(W)}else this.addFeature(I,R,N,p,{});u.featureIndex.insert(o[N].feature,R,N,q,this.index)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}addFeatures(o,u,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,XC)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,WC),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,p,_,x){const S=this.layers[0].layout,I=S.get("line-join").evaluate(o,{}),R=S.get("line-cap"),N=S.get("line-miter-limit"),q=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const W of u)this.addLine(W,o,I,R,N,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,x,_)}addLine(o,u,p,_,x,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let It=0;It<o.length-1;It++)this.totalDistance+=o[It].dist(o[It+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=ZC[u.type]==="Polygon";let R=o.length;for(;R>=2&&o[R-1].equals(o[R-2]);)R--;let N=0;for(;N<R-1&&o[N].equals(o[N+1]);)N++;if(R<(I?3:2))return;p==="bevel"&&(x=1.05);const q=this.overscaling<=16?15*ts/(512*this.overscaling):0,W=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let Y,it,at,ft,At;this.e1=this.e2=-1,I&&(Y=o[R-2],At=o[N].sub(Y)._unit()._perp());for(let It=N;It<R;It++){if(at=It===R-1?I?o[N+1]:void 0:o[It+1],at&&o[It].equals(at))continue;At&&(ft=At),Y&&(it=Y),Y=o[It],At=at?at.sub(Y)._unit()._perp():ft,ft=ft||At;let Zt=ft.add(At);Zt.x===0&&Zt.y===0||Zt._unit();const Ft=ft.x*At.x+ft.y*At.y,Ht=Zt.x*At.x+Zt.y*At.y,ye=Ht!==0?1/Ht:1/0,ve=2*Math.sqrt(2-2*Ht),Ve=Ht<$C&&it&&at,ei=ft.x*At.y-ft.y*At.x>0;if(Ve&&It>N){const Ke=Y.dist(it);if(Ke>2*q){const li=Y.sub(Y.sub(it)._mult(q/Ke)._round());this.updateDistance(it,li),this.addCurrentVertex(li,ft,0,0,W),it=li}}const Ue=it&&at;let ke=Ue?p:I?"butt":_;if(Ue&&ke==="round"&&(ye<S?ke="miter":ye<=2&&(ke="fakeround")),ke==="miter"&&ye>x&&(ke="bevel"),ke==="bevel"&&(ye>2&&(ke="flipbevel"),ye<x&&(ke="miter")),it&&this.updateDistance(it,Y),ke==="miter")Zt._mult(ye),this.addCurrentVertex(Y,Zt,0,0,W);else if(ke==="flipbevel"){if(ye>100)Zt=At.mult(-1);else{const Ke=ye*ft.add(At).mag()/ft.sub(At).mag();Zt._perp()._mult(Ke*(ei?-1:1))}this.addCurrentVertex(Y,Zt,0,0,W),this.addCurrentVertex(Y,Zt.mult(-1),0,0,W)}else if(ke==="bevel"||ke==="fakeround"){const Ke=-Math.sqrt(ye*ye-1),li=ei?Ke:0,Ge=ei?0:Ke;if(it&&this.addCurrentVertex(Y,ft,li,Ge,W),ke==="fakeround"){const we=Math.round(180*ve/Math.PI/20);for(let ii=1;ii<we;ii++){let Qe=ii/we;if(Qe!==.5){const Tr=Qe-.5;Qe+=Qe*Tr*(Qe-1)*((1.0904+Ft*(Ft*(3.55645-1.43519*Ft)-3.2452))*Tr*Tr+(.848013+Ft*(.215638*Ft-1.06021)))}const Mi=At.sub(ft)._mult(Qe)._add(ft)._unit()._mult(ei?-1:1);this.addHalfVertex(Y,Mi.x,Mi.y,!1,ei,0,W)}}at&&this.addCurrentVertex(Y,At,-li,-Ge,W)}else if(ke==="butt")this.addCurrentVertex(Y,Zt,0,0,W);else if(ke==="square"){const Ke=it?1:-1;this.addCurrentVertex(Y,Zt,Ke,Ke,W)}else ke==="round"&&(it&&(this.addCurrentVertex(Y,ft,0,0,W),this.addCurrentVertex(Y,ft,1,1,W,!0)),at&&(this.addCurrentVertex(Y,At,-1,-1,W,!0),this.addCurrentVertex(Y,At,0,0,W)));if(Ve&&It<R-1){const Ke=Y.dist(at);if(Ke>2*q){const li=Y.add(at.sub(Y)._mult(q/Ke)._round());this.updateDistance(Y,li),this.addCurrentVertex(li,At,0,0,W),Y=li}}}}addCurrentVertex(o,u,p,_,x){let S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const I=u.y*_-u.x,R=-u.y-u.x*_;this.addHalfVertex(o,u.x+u.y*p,u.y-u.x*p,S,!1,p,x),this.addHalfVertex(o,I,R,S,!0,-_,x),this.distance>eb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,u,p,_,x,S))}addHalfVertex(o,u,p,_,x,S,I){let{x:R,y:N}=o;const q=.5*(this.lineClips?this.scaledDistance*(eb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((R<<1)+(_?1:0),(N<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(S===0?0:S<0?-1:1)|(63&q)<<2,q>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const W=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,W),I.primitiveLength++),x?this.e2=W:this.e1=W}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}}let ib,rb;Je("LineBucket",c0,{omit:["layers","patternFeatures"]});var sb={get paint(){return rb=rb||new v({"line-opacity":new w(ot.paint_line["line-opacity"]),"line-color":new w(ot.paint_line["line-color"]),"line-translate":new oi(ot.paint_line["line-translate"]),"line-translate-anchor":new oi(ot.paint_line["line-translate-anchor"]),"line-width":new w(ot.paint_line["line-width"]),"line-gap-width":new w(ot.paint_line["line-gap-width"]),"line-offset":new w(ot.paint_line["line-offset"]),"line-blur":new w(ot.paint_line["line-blur"]),"line-dasharray":new d(ot.paint_line["line-dasharray"]),"line-pattern":new a(ot.paint_line["line-pattern"]),"line-gradient":new m(ot.paint_line["line-gradient"])})},get layout(){return ib=ib||new v({"line-cap":new oi(ot.layout_line["line-cap"]),"line-join":new w(ot.layout_line["line-join"]),"line-miter-limit":new oi(ot.layout_line["line-miter-limit"]),"line-round-limit":new oi(ot.layout_line["line-round-limit"]),"line-sort-key":new w(ot.layout_line["line-sort-key"])})}};class YC extends w{possiblyEvaluate(o,u){return u=new br(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(o,u)}evaluate(o,u,p,_){return u=Rt({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(o,u,p,_)}}let $f;class KC extends B{constructor(o){super(o,sb),this.gradientVersion=0,$f||($f=new YC(sb.paint.properties["line-width"].specification),$f.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof hi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,u){super.recalculate(o,u),this.paint._values["line-floorwidth"]=$f.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new c0(o)}queryRadius(o){const u=o,p=nb($l("line-width",this,u),$l("line-gap-width",this,u)),_=$l("line-offset",this,u);return p/2+Math.abs(_)+wh(this.paint.get("line-translate"))}queryIntersectsFeature(o,u,p,_,x,S,I){const R=hu(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,I),N=I/2*nb(this.paint.get("line-width").evaluate(u,p),this.paint.get("line-gap-width").evaluate(u,p)),q=this.paint.get("line-offset").evaluate(u,p);return q&&(_=function(W,Y){const it=[];for(let at=0;at<W.length;at++){const ft=W[at],At=[];for(let It=0;It<ft.length;It++){const Zt=ft[It-1],Ft=ft[It],Ht=ft[It+1],ye=It===0?new T(0,0):Ft.sub(Zt)._unit()._perp(),ve=It===ft.length-1?new T(0,0):Ht.sub(Ft)._unit()._perp(),Ve=ye._add(ve)._unit(),ei=Ve.x*ve.x+Ve.y*ve.y;ei!==0&&Ve._mult(1/ei),At.push(Ve._mult(Y)._add(Ft))}it.push(At)}return it}(_,q*I)),function(W,Y,it){for(let at=0;at<Y.length;at++){const ft=Y[at];if(W.length>=3){for(let At=0;At<ft.length;At++)if(po(W,ft[At]))return!0}if(Vf(W,ft,it))return!0}return!1}(R,_,N)}isTileClipped(){return!0}}function nb(h,o){return o>0?o+2*h:h}const QC=C([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tT=C([{name:"a_projected_pos",components:3,type:"Float32"}],4);C([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eT=C([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);C([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ob=C([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),iT=C([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function rT(h,o,u){return h.sections.forEach(p=>{p.text=function(_,x,S){const I=x.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?_=_.toLocaleUpperCase():I==="lowercase"&&(_=_.toLocaleLowerCase()),oa.applyArabicShaping&&(_=oa.applyArabicShaping(_)),_}(p.text,o,u)}),h}C([{name:"triangle",components:3,type:"Uint16"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),C([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),C([{type:"Float32",name:"offsetX"}]),C([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),C([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const yp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Fs=24,ab=Cr,lb=function(h,o,u,p,_){var x,S,I=8*_-p-1,R=(1<<I)-1,N=R>>1,q=-7,W=_-1,Y=-1,it=h[o+W];for(W+=Y,x=it&(1<<-q)-1,it>>=-q,q+=I;q>0;x=256*x+h[o+W],W+=Y,q-=8);for(S=x&(1<<-q)-1,x>>=-q,q+=p;q>0;S=256*S+h[o+W],W+=Y,q-=8);if(x===0)x=1-N;else{if(x===R)return S?NaN:1/0*(it?-1:1);S+=Math.pow(2,p),x-=N}return(it?-1:1)*S*Math.pow(2,x-p)},cb=function(h,o,u,p,_,x){var S,I,R,N=8*x-_-1,q=(1<<N)-1,W=q>>1,Y=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,it=0,at=1,ft=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=q):(S=Math.floor(Math.log(o)/Math.LN2),o*(R=Math.pow(2,-S))<1&&(S--,R*=2),(o+=S+W>=1?Y/R:Y*Math.pow(2,1-W))*R>=2&&(S++,R/=2),S+W>=q?(I=0,S=q):S+W>=1?(I=(o*R-1)*Math.pow(2,_),S+=W):(I=o*Math.pow(2,W-1)*Math.pow(2,_),S=0));_>=8;h[u+it]=255&I,it+=at,I/=256,_-=8);for(S=S<<_|I,N+=_;N>0;h[u+it]=255&S,it+=at,S/=256,N-=8);h[u+it-at]|=128*ft};function Cr(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Cr.Varint=0,Cr.Fixed64=1,Cr.Bytes=2,Cr.Fixed32=5;var h0=4294967296,hb=1/h0,ub=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Mc(h){return h.type===Cr.Bytes?h.readVarint()+h.pos:h.pos+1}function sT(h,o,u){return u?4294967296*o+(h>>>0):4294967296*(o>>>0)+(h>>>0)}function db(h,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var _=u.pos-1;_>=h;_--)u.buf[_+p]=u.buf[_]}function nT(h,o){for(var u=0;u<h.length;u++)o.writeVarint(h[u])}function oT(h,o){for(var u=0;u<h.length;u++)o.writeSVarint(h[u])}function aT(h,o){for(var u=0;u<h.length;u++)o.writeFloat(h[u])}function lT(h,o){for(var u=0;u<h.length;u++)o.writeDouble(h[u])}function cT(h,o){for(var u=0;u<h.length;u++)o.writeBoolean(h[u])}function hT(h,o){for(var u=0;u<h.length;u++)o.writeFixed32(h[u])}function uT(h,o){for(var u=0;u<h.length;u++)o.writeSFixed32(h[u])}function dT(h,o){for(var u=0;u<h.length;u++)o.writeFixed64(h[u])}function pT(h,o){for(var u=0;u<h.length;u++)o.writeSFixed64(h[u])}function Yf(h,o){return(h[o]|h[o+1]<<8|h[o+2]<<16)+16777216*h[o+3]}function td(h,o,u){h[u]=o,h[u+1]=o>>>8,h[u+2]=o>>>16,h[u+3]=o>>>24}function pb(h,o){return(h[o]|h[o+1]<<8|h[o+2]<<16)+(h[o+3]<<24)}Cr.prototype={destroy:function(){this.buf=null},readFields:function(h,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),_=p>>3,x=this.pos;this.type=7&p,h(_,o,this),this.pos===x&&this.skip(p)}return o},readMessage:function(h,o){return this.readFields(h,o,this.readVarint()+this.pos)},readFixed32:function(){var h=Yf(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=pb(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=Yf(this.buf,this.pos)+Yf(this.buf,this.pos+4)*h0;return this.pos+=8,h},readSFixed64:function(){var h=Yf(this.buf,this.pos)+pb(this.buf,this.pos+4)*h0;return this.pos+=8,h},readFloat:function(){var h=lb(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=lb(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(_,x,S){var I,R,N=S.buf;if(I=(112&(R=N[S.pos++]))>>4,R<128||(I|=(127&(R=N[S.pos++]))<<3,R<128)||(I|=(127&(R=N[S.pos++]))<<10,R<128)||(I|=(127&(R=N[S.pos++]))<<17,R<128)||(I|=(127&(R=N[S.pos++]))<<24,R<128)||(I|=(1&(R=N[S.pos++]))<<31,R<128))return sT(_,I,x);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,o=this.pos;return this.pos=h,h-o>=12&&ub?function(u,p,_){return ub.decode(u.subarray(p,_))}(this.buf,o,h):function(u,p,_){for(var x="",S=p;S<_;){var I,R,N,q=u[S],W=null,Y=q>239?4:q>223?3:q>191?2:1;if(S+Y>_)break;Y===1?q<128&&(W=q):Y===2?(192&(I=u[S+1]))==128&&(W=(31&q)<<6|63&I)<=127&&(W=null):Y===3?(R=u[S+2],(192&(I=u[S+1]))==128&&(192&R)==128&&((W=(15&q)<<12|(63&I)<<6|63&R)<=2047||W>=55296&&W<=57343)&&(W=null)):Y===4&&(R=u[S+2],N=u[S+3],(192&(I=u[S+1]))==128&&(192&R)==128&&(192&N)==128&&((W=(15&q)<<18|(63&I)<<12|(63&R)<<6|63&N)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,Y=1):W>65535&&(W-=65536,x+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),x+=String.fromCharCode(W),S+=Y}return x}(this.buf,o,h)},readBytes:function(){var h=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,h);return this.pos=h,o},readPackedVarint:function(h,o){if(this.type!==Cr.Bytes)return h.push(this.readVarint(o));var u=Mc(this);for(h=h||[];this.pos<u;)h.push(this.readVarint(o));return h},readPackedSVarint:function(h){if(this.type!==Cr.Bytes)return h.push(this.readSVarint());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Cr.Bytes)return h.push(this.readBoolean());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Cr.Bytes)return h.push(this.readFloat());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Cr.Bytes)return h.push(this.readDouble());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Cr.Bytes)return h.push(this.readFixed32());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Cr.Bytes)return h.push(this.readSFixed32());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Cr.Bytes)return h.push(this.readFixed64());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Cr.Bytes)return h.push(this.readSFixed64());var o=Mc(this);for(h=h||[];this.pos<o;)h.push(this.readSFixed64());return h},skip:function(h){var o=7&h;if(o===Cr.Varint)for(;this.buf[this.pos++]>127;);else if(o===Cr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Cr.Fixed32)this.pos+=4;else{if(o!==Cr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(h,o){this.writeVarint(h<<3|o)},realloc:function(h){for(var o=this.length||16;o<this.pos+h;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),td(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),td(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),td(this.buf,-1&h,this.pos),td(this.buf,Math.floor(h*hb),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),td(this.buf,-1&h,this.pos),td(this.buf,Math.floor(h*hb),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(o,u){var p,_;if(o>=0?(p=o%4294967296|0,_=o/4294967296|0):(_=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,_=_+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(x,S,I){I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,I.buf[I.pos]=127&(x>>>=7)}(p,0,u),function(x,S){var I=(7&x)<<4;S.buf[S.pos++]|=I|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(_,u)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var o=this.pos;this.pos=function(p,_,x){for(var S,I,R=0;R<_.length;R++){if((S=_.charCodeAt(R))>55295&&S<57344){if(!I){S>56319||R+1===_.length?(p[x++]=239,p[x++]=191,p[x++]=189):I=S;continue}if(S<56320){p[x++]=239,p[x++]=191,p[x++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(p[x++]=239,p[x++]=191,p[x++]=189,I=null);S<128?p[x++]=S:(S<2048?p[x++]=S>>6|192:(S<65536?p[x++]=S>>12|224:(p[x++]=S>>18|240,p[x++]=S>>12&63|128),p[x++]=S>>6&63|128),p[x++]=63&S|128)}return x}(this.buf,h,this.pos);var u=this.pos-o;u>=128&&db(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(h){this.realloc(4),cb(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),cb(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var o=h.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=h[u]},writeRawMessage:function(h,o){this.pos++;var u=this.pos;h(o,this);var p=this.pos-u;p>=128&&db(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(h,o,u){this.writeTag(h,Cr.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(h,o){o.length&&this.writeMessage(h,nT,o)},writePackedSVarint:function(h,o){o.length&&this.writeMessage(h,oT,o)},writePackedBoolean:function(h,o){o.length&&this.writeMessage(h,cT,o)},writePackedFloat:function(h,o){o.length&&this.writeMessage(h,aT,o)},writePackedDouble:function(h,o){o.length&&this.writeMessage(h,lT,o)},writePackedFixed32:function(h,o){o.length&&this.writeMessage(h,hT,o)},writePackedSFixed32:function(h,o){o.length&&this.writeMessage(h,uT,o)},writePackedFixed64:function(h,o){o.length&&this.writeMessage(h,dT,o)},writePackedSFixed64:function(h,o){o.length&&this.writeMessage(h,pT,o)},writeBytesField:function(h,o){this.writeTag(h,Cr.Bytes),this.writeBytes(o)},writeFixed32Field:function(h,o){this.writeTag(h,Cr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(h,o){this.writeTag(h,Cr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(h,o){this.writeTag(h,Cr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(h,o){this.writeTag(h,Cr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(h,o){this.writeTag(h,Cr.Varint),this.writeVarint(o)},writeSVarintField:function(h,o){this.writeTag(h,Cr.Varint),this.writeSVarint(o)},writeStringField:function(h,o){this.writeTag(h,Cr.Bytes),this.writeString(o)},writeFloatField:function(h,o){this.writeTag(h,Cr.Fixed32),this.writeFloat(o)},writeDoubleField:function(h,o){this.writeTag(h,Cr.Fixed64),this.writeDouble(o)},writeBooleanField:function(h,o){this.writeVarintField(h,!!o)}};var u0=f(ab);const d0=3;function fT(h,o,u){h===1&&u.readMessage(gT,o)}function gT(h,o,u){if(h===3){const{id:p,bitmap:_,width:x,height:S,left:I,top:R,advance:N}=u.readMessage(mT,{});o.push({id:p,bitmap:new up({width:x+2*d0,height:S+2*d0},_),metrics:{width:x,height:S,left:I,top:R,advance:N}})}}function mT(h,o,u){h===1?o.id=u.readVarint():h===2?o.bitmap=u.readBytes():h===3?o.width=u.readVarint():h===4?o.height=u.readVarint():h===5?o.left=u.readSVarint():h===6?o.top=u.readSVarint():h===7&&(o.advance=u.readVarint())}const fb=d0;function gb(h){let o=0,u=0;for(const S of h)o+=S.w*S.h,u=Math.max(u,S.w);h.sort((S,I)=>I.h-S.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let _=0,x=0;for(const S of h)for(let I=p.length-1;I>=0;I--){const R=p[I];if(!(S.w>R.w||S.h>R.h)){if(S.x=R.x,S.y=R.y,x=Math.max(x,S.y+S.h),_=Math.max(_,S.x+S.w),S.w===R.w&&S.h===R.h){const N=p.pop();I<p.length&&(p[I]=N)}else S.h===R.h?(R.x+=S.w,R.w-=S.w):S.w===R.w?(R.y+=S.h,R.h-=S.h):(p.push({x:R.x+S.w,y:R.y,w:R.w-S.w,h:S.h}),R.y+=S.h,R.h-=S.h);break}}return{w:_,h:x,fill:o/(_*x)||0}}const fo=1;class p0{constructor(o,u){let{pixelRatio:p,version:_,stretchX:x,stretchY:S,content:I,textFitWidth:R,textFitHeight:N}=u;this.paddedRect=o,this.pixelRatio=p,this.stretchX=x,this.stretchY=S,this.content=I,this.version=_,this.textFitWidth=R,this.textFitHeight=N}get tl(){return[this.paddedRect.x+fo,this.paddedRect.y+fo]}get br(){return[this.paddedRect.x+this.paddedRect.w-fo,this.paddedRect.y+this.paddedRect.h-fo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*fo)/this.pixelRatio,(this.paddedRect.h-2*fo)/this.pixelRatio]}}class mb{constructor(o,u){const p={},_={};this.haveRenderCallbacks=[];const x=[];this.addImages(o,p,x),this.addImages(u,_,x);const{w:S,h:I}=gb(x),R=new aa({width:S||1,height:I||1});for(const N in o){const q=o[N],W=p[N].paddedRect;aa.copy(q.data,R,{x:0,y:0},{x:W.x+fo,y:W.y+fo},q.data)}for(const N in u){const q=u[N],W=_[N].paddedRect,Y=W.x+fo,it=W.y+fo,at=q.data.width,ft=q.data.height;aa.copy(q.data,R,{x:0,y:0},{x:Y,y:it},q.data),aa.copy(q.data,R,{x:0,y:ft-1},{x:Y,y:it-1},{width:at,height:1}),aa.copy(q.data,R,{x:0,y:0},{x:Y,y:it+ft},{width:at,height:1}),aa.copy(q.data,R,{x:at-1,y:0},{x:Y-1,y:it},{width:1,height:ft}),aa.copy(q.data,R,{x:0,y:0},{x:Y+at,y:it},{width:1,height:ft})}this.image=R,this.iconPositions=p,this.patternPositions=_}addImages(o,u,p){for(const _ in o){const x=o[_],S={x:0,y:0,w:x.data.width+2*fo,h:x.data.height+2*fo};p.push(S),u[_]=new p0(S,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(o,u){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in o.updatedImages)this.patchUpdatedImage(this.iconPositions[p],o.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],o.getImage(p),u)}patchUpdatedImage(o,u,p){if(!o||!u||o.version===u.version)return;o.version=u.version;const[_,x]=o.tl;p.update(u.data,void 0,{x:_,y:x})}}var Ah;Je("ImagePosition",p0),Je("ImageAtlas",mb),c.ah=void 0,(Ah=c.ah||(c.ah={}))[Ah.none=0]="none",Ah[Ah.horizontal=1]="horizontal",Ah[Ah.vertical=2]="vertical",Ah[Ah.horizontalOnly=3]="horizontalOnly";const _p=-17;class vp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,u){const p=new vp;return p.scale=o||1,p.fontStack=u,p}static forImage(o){const u=new vp;return u.imageName=o,u}}class ed{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const p=new ed;for(let _=0;_<o.sections.length;_++){const x=o.sections[_];x.image?p.addImageSection(x):p.addTextSection(x,u)}return p}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let u="";for(let p=0;p<o.length;p++){const _=o.charCodeAt(p+1)||null,x=o.charCodeAt(p-1)||null;u+=_&&na(_)&&!yp[o[p+1]]||x&&na(x)&&!yp[o[p-1]]||!yp[o[p]]?o[p]:yp[o[p]]}return u}(this.text)}trim(){let o=0;for(let p=0;p<this.text.length&&Qf[this.text.charCodeAt(p)];p++)o++;let u=this.text.length;for(let p=this.text.length-1;p>=0&&p>=o&&Qf[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const p=new ed;return p.text=this.text.substring(o,u),p.sectionIndex=this.sectionIndex.slice(o,u),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,u)=>Math.max(o,this.sections[u].scale),0)}addTextSection(o,u){this.text+=o.text,this.sections.push(vp.forText(o.scale,o.fontStack||u));const p=this.sections.length-1;for(let _=0;_<o.text.length;++_)this.sectionIndex.push(p)}addImageSection(o){const u=o.image?o.image.name:"";if(u.length===0)return void Bt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(vp.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Bt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kf(h,o,u,p,_,x,S,I,R,N,q,W,Y,it,at,ft){const At=ed.fromFeature(h,_);let It;W===c.ah.vertical&&At.verticalizePunctuation();const{processBidirectionalText:Zt,processStyledBidirectionalText:Ft}=oa;if(Zt&&At.sections.length===1){It=[];const ve=Zt(At.toString(),f0(At,N,x,o,p,it,at));for(const Ve of ve){const ei=new ed;ei.text=Ve,ei.sections=At.sections;for(let Ue=0;Ue<Ve.length;Ue++)ei.sectionIndex.push(0);It.push(ei)}}else if(Ft){It=[];const ve=Ft(At.text,At.sectionIndex,f0(At,N,x,o,p,it,at));for(const Ve of ve){const ei=new ed;ei.text=Ve[0],ei.sectionIndex=Ve[1],ei.sections=At.sections,It.push(ei)}}else It=function(ve,Ve){const ei=[],Ue=ve.text;let ke=0;for(const Ke of Ve)ei.push(ve.substring(ke,Ke)),ke=Ke;return ke<Ue.length&&ei.push(ve.substring(ke,Ue.length)),ei}(At,f0(At,N,x,o,p,it,at));const Ht=[],ye={positionedLines:Ht,text:At.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(ve,Ve,ei,Ue,ke,Ke,li,Ge,we,ii,Qe,Mi){let Tr=0,Pr=_p,xs=0,ca=0;const xn=Ge==="right"?1:Ge==="left"?0:.5;let Ns=0;for(const As of ke){As.trim();const Gs=As.getMaxScale(),Gn=(Gs-1)*Fs,go={positionedGlyphs:[],lineOffset:0};ve.positionedLines[Ns]=go;const on=go.positionedGlyphs;let mo=0;if(!As.length()){Pr+=Ke,++Ns;continue}for(let hs=0;hs<As.length();hs++){const ji=As.getSection(hs),Ss=As.getSectionIndex(hs),an=As.getCharCode(hs);let Ds=0,Ua=null,ll=null,cl=null,Bc=Fs;const ja=!(we===c.ah.horizontal||!Qe&&!iu(an)||Qe&&(Qf[an]||(Zs=an,ze.Arabic(Zs)||ze["Arabic Supplement"](Zs)||ze["Arabic Extended-A"](Zs)||ze["Arabic Presentation Forms-A"](Zs)||ze["Arabic Presentation Forms-B"](Zs))));if(ji.imageName){const ua=Ue[ji.imageName];if(!ua)continue;cl=ji.imageName,ve.iconsInText=ve.iconsInText||!0,ll=ua.paddedRect;const yo=ua.displaySize;ji.scale=ji.scale*Fs/Mi,Ua={width:yo[0],height:yo[1],left:fo,top:-fb,advance:ja?yo[1]:yo[0]},Ds=Gn+(Fs-yo[1]*ji.scale),Bc=Ua.advance;const Rc=ja?yo[0]*ji.scale-Fs*Gs:yo[1]*ji.scale-Fs*Gs;Rc>0&&Rc>mo&&(mo=Rc)}else{const ua=ei[ji.fontStack],yo=ua&&ua[an];if(yo&&yo.rect)ll=yo.rect,Ua=yo.metrics;else{const Rc=Ve[ji.fontStack],Sp=Rc&&Rc[an];if(!Sp)continue;Ua=Sp.metrics}Ds=(Gs-ji.scale)*Fs}ja?(ve.verticalizable=!0,on.push({glyph:an,imageName:cl,x:Tr,y:Pr+Ds,vertical:ja,scale:ji.scale,fontStack:ji.fontStack,sectionIndex:Ss,metrics:Ua,rect:ll}),Tr+=Bc*ji.scale+ii):(on.push({glyph:an,imageName:cl,x:Tr,y:Pr+Ds,vertical:ja,scale:ji.scale,fontStack:ji.fontStack,sectionIndex:Ss,metrics:Ua,rect:ll}),Tr+=Ua.advance*ji.scale+ii)}on.length!==0&&(xs=Math.max(Tr-ii,xs),vT(on,0,on.length-1,xn,mo)),Tr=0;const ha=Ke*Gs+mo;go.lineOffset=Math.max(mo,Gn),Pr+=ha,ca=Math.max(ha,ca),++Ns}var Zs;const An=Pr-_p,{horizontalAlign:jn,verticalAlign:Sn}=g0(li);(function(As,Gs,Gn,go,on,mo,ha,hs,ji){const Ss=(Gs-Gn)*on;let an=0;an=mo!==ha?-hs*go-_p:(-go*ji+.5)*ha;for(const Ds of As)for(const Ua of Ds.positionedGlyphs)Ua.x+=Ss,Ua.y+=an})(ve.positionedLines,xn,jn,Sn,xs,ca,Ke,An,ke.length),ve.top+=-Sn*An,ve.bottom=ve.top+An,ve.left+=-jn*xs,ve.right=ve.left+xs}(ye,o,u,p,It,S,I,R,W,N,Y,ft),!function(ve){for(const Ve of ve)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(Ht)&&ye}const Qf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yb(h,o,u,p,_,x){if(o.imageName){const S=p[o.imageName];return S?S.displaySize[0]*o.scale*Fs/x+_:0}{const S=u[o.fontStack],I=S&&S[h];return I?I.metrics.advance*o.scale+_:0}}function _b(h,o,u,p){const _=Math.pow(h-o,2);return p?h<o?_/2:2*_:_+Math.abs(u)*u}function _T(h,o,u){let p=0;return h===10&&(p-=1e4),u&&(p+=150),h!==40&&h!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function vb(h,o,u,p,_,x){let S=null,I=_b(o,u,_,x);for(const R of p){const N=_b(o-R.x,u,_,x)+R.badness;N<=I&&(S=R,I=N)}return{index:h,x:o,priorBreak:S,badness:I}}function bb(h){return h?bb(h.priorBreak).concat(h.index):[]}function f0(h,o,u,p,_,x,S){if(x!=="point")return[];if(!h)return[];const I=[],R=function(Y,it,at,ft,At,It){let Zt=0;for(let Ft=0;Ft<Y.length();Ft++){const Ht=Y.getSection(Ft);Zt+=yb(Y.getCharCode(Ft),Ht,ft,At,it,It)}return Zt/Math.max(1,Math.ceil(Zt/at))}(h,o,u,p,_,S),N=h.text.indexOf("​")>=0;let q=0;for(let Y=0;Y<h.length();Y++){const it=h.getSection(Y),at=h.getCharCode(Y);if(Qf[at]||(q+=yb(at,it,p,_,o,S)),Y<h.length()-1){const ft=!((W=at)<11904||!(ze["Bopomofo Extended"](W)||ze.Bopomofo(W)||ze["CJK Compatibility Forms"](W)||ze["CJK Compatibility Ideographs"](W)||ze["CJK Compatibility"](W)||ze["CJK Radicals Supplement"](W)||ze["CJK Strokes"](W)||ze["CJK Symbols and Punctuation"](W)||ze["CJK Unified Ideographs Extension A"](W)||ze["CJK Unified Ideographs"](W)||ze["Enclosed CJK Letters and Months"](W)||ze["Halfwidth and Fullwidth Forms"](W)||ze.Hiragana(W)||ze["Ideographic Description Characters"](W)||ze["Kangxi Radicals"](W)||ze["Katakana Phonetic Extensions"](W)||ze.Katakana(W)||ze["Vertical Forms"](W)||ze["Yi Radicals"](W)||ze["Yi Syllables"](W)));(yT[at]||ft||it.imageName)&&I.push(vb(Y+1,q,R,I,_T(at,h.getCharCode(Y+1),ft&&N),!1))}}var W;return bb(vb(h.length(),q,R,I,0,!0))}function g0(h){let o=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function vT(h,o,u,p,_){if(!p&&!_)return;const x=h[u],S=(h[u].x+x.metrics.advance*x.scale)*p;for(let I=o;I<=u;I++)h[I].x-=S,h[I].y+=_}function bT(h,o,u){const{horizontalAlign:p,verticalAlign:_}=g0(u),x=o[0]-h.displaySize[0]*p,S=o[1]-h.displaySize[1]*_;return{image:h,top:S,bottom:S+h.displaySize[1],left:x,right:x+h.displaySize[0]}}function wb(h){var o,u;let p=h.left,_=h.top,x=h.right-p,S=h.bottom-_;const I=(o=h.image.textFitWidth)!==null&&o!==void 0?o:"stretchOrShrink",R=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",N=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(R==="proportional"){if(I==="stretchOnly"&&x/S<N||I==="proportional"){const q=Math.ceil(S*N);p*=q/x,x=q}}else if(I==="proportional"&&R==="stretchOnly"&&N!==0&&x/S>N){const q=Math.ceil(x/N);_*=q/S,S=q}return{x1:p,y1:_,x2:p+x,y2:_+S}}function xb(h,o,u,p,_,x){const S=h.image;let I;if(S.content){const At=S.content,It=S.pixelRatio||1;I=[At[0]/It,At[1]/It,S.displaySize[0]-At[2]/It,S.displaySize[1]-At[3]/It]}const R=o.left*x,N=o.right*x;let q,W,Y,it;u==="width"||u==="both"?(it=_[0]+R-p[3],W=_[0]+N+p[1]):(it=_[0]+(R+N-S.displaySize[0])/2,W=it+S.displaySize[0]);const at=o.top*x,ft=o.bottom*x;return u==="height"||u==="both"?(q=_[1]+at-p[0],Y=_[1]+ft+p[2]):(q=_[1]+(at+ft-S.displaySize[1])/2,Y=q+S.displaySize[1]),{image:S,top:q,right:W,bottom:Y,left:it,collisionPadding:I}}const bp=255,Yl=128,Sh=bp*Yl;function Ab(h,o){const{expression:u}=o;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new br(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=u;let x=0;for(;x<p.length&&p[x]<=h;)x++;x=Math.max(0,x-1);let S=x;for(;S<p.length&&p[S]<h+1;)S++;S=Math.min(p.length-1,S);const I=p[x],R=p[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:R,interpolationType:_}:{kind:"camera",minZoom:I,maxZoom:R,minSize:u.evaluate(new br(I)),maxSize:u.evaluate(new br(R)),interpolationType:_}}}function m0(h,o,u){let p="never";const _=h.get(o);return _?p=_:h.get(u)&&(p="always"),p}const wT=xh.VectorTileFeature.types,xT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tg(h,o,u,p,_,x,S,I,R,N,q,W,Y){const it=I?Math.min(Sh,Math.round(I[0])):0,at=I?Math.min(Sh,Math.round(I[1])):0;h.emplaceBack(o,u,Math.round(32*p),Math.round(32*_),x,S,(it<<1)+(R?1:0),at,16*N,16*q,256*W,256*Y)}function y0(h,o,u){h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u)}function AT(h){for(const o of h.sections)if(ru(o.text))return!0;return!1}class _0{constructor(o){this.layoutVertexArray=new ws,this.indexArray=new al,this.programConfigurations=o,this.segments=new ns,this.dynamicLayoutVertexArray=new qr,this.opacityVertexArray=new Na,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ui}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,u,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,QC.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,tT.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,xT,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Je("SymbolBuffers",_0);class v0{constructor(o,u,p){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new p,this.segments=new ns,this.collisionVertexArray=new su}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,eT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Je("CollisionBuffers",v0);class id{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(S=>S.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ym([]),this.placementViewportMatrix=Ym([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ab(this.zoom,u["text-size"]),this.iconSizeData=Ab(this.zoom,u["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),x=p.get("symbol-z-order");this.canOverlap=m0(p,"text-overlap","text-allow-overlap")!=="never"||m0(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(S=>c.ah[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=o.sourceID}createArrays(){this.text=new _0(new Ic(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new _0(new Ic(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Er,this.lineVertexArray=new ur,this.symbolInstances=new Ni,this.textAnchorOffsets=new Zi}calculateGlyphDependencies(o,u,p,_,x){for(let S=0;S<o.length;S++)if(u[o.charCodeAt(S)]=!0,(p||_)&&x){const I=yp[o.charAt(S)];I&&(u[I.charCodeAt(0)]=!0)}}populate(o,u,p){const _=this.layers[0],x=_.layout,S=x.get("text-font"),I=x.get("text-field"),R=x.get("icon-image"),N=(I.value.kind!=="constant"||I.value.value instanceof Rr&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),q=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,W=x.get("symbol-sort-key");if(this.features=[],!N&&!q)return;const Y=u.iconDependencies,it=u.glyphDependencies,at=u.availableImages,ft=new br(this.zoom);for(const{feature:At,id:It,index:Zt,sourceLayerIndex:Ft}of o){const Ht=_._featureFilter.needGeometry,ye=Lc(At,Ht);if(!_._featureFilter.filter(ft,ye,p))continue;let ve,Ve;if(Ht||(ye.geometry=Jl(At)),N){const Ue=_.getValueAndResolveTokens("text-field",ye,p,at),ke=Rr.factory(Ue),Ke=this.hasRTLText=this.hasRTLText||AT(ke);(!Ke||oa.getRTLTextPluginStatus()==="unavailable"||Ke&&oa.isParsed())&&(ve=rT(ke,_,ye))}if(q){const Ue=_.getValueAndResolveTokens("icon-image",ye,p,at);Ve=Ue instanceof Or?Ue:Or.fromString(Ue)}if(!ve&&!Ve)continue;const ei=this.sortFeaturesByKey?W.evaluate(ye,{},p):void 0;if(this.features.push({id:It,text:ve,icon:Ve,index:Zt,sourceLayerIndex:Ft,geometry:ye.geometry,properties:At.properties,type:wT[At.type],sortKey:ei}),Ve&&(Y[Ve.name]=!0),ve){const Ue=S.evaluate(ye,{},p).join(","),ke=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const Ke of ve.sections)if(Ke.image)Y[Ke.image.name]=!0;else{const li=Lo(ve.toString()),Ge=Ke.fontStack||Ue,we=it[Ge]=it[Ge]||{};this.calculateGlyphDependencies(Ke.text,we,ke,this.allowVerticalPlacement,li)}}}x.get("symbol-placement")==="line"&&(this.features=function(At){const It={},Zt={},Ft=[];let Ht=0;function ye(Ue){Ft.push(At[Ue]),Ht++}function ve(Ue,ke,Ke){const li=Zt[Ue];return delete Zt[Ue],Zt[ke]=li,Ft[li].geometry[0].pop(),Ft[li].geometry[0]=Ft[li].geometry[0].concat(Ke[0]),li}function Ve(Ue,ke,Ke){const li=It[ke];return delete It[ke],It[Ue]=li,Ft[li].geometry[0].shift(),Ft[li].geometry[0]=Ke[0].concat(Ft[li].geometry[0]),li}function ei(Ue,ke,Ke){const li=Ke?ke[0][ke[0].length-1]:ke[0][0];return`${Ue}:${li.x}:${li.y}`}for(let Ue=0;Ue<At.length;Ue++){const ke=At[Ue],Ke=ke.geometry,li=ke.text?ke.text.toString():null;if(!li){ye(Ue);continue}const Ge=ei(li,Ke),we=ei(li,Ke,!0);if(Ge in Zt&&we in It&&Zt[Ge]!==It[we]){const ii=Ve(Ge,we,Ke),Qe=ve(Ge,we,Ft[ii].geometry);delete It[Ge],delete Zt[we],Zt[ei(li,Ft[Qe].geometry,!0)]=Qe,Ft[ii].geometry=null}else Ge in Zt?ve(Ge,we,Ke):we in It?Ve(Ge,we,Ke):(ye(Ue),It[Ge]=Ht-1,Zt[we]=Ht-1)}return Ft.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((At,It)=>At.sortKey-It.sortKey)}update(o,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const p=this.lineVertexArray.length;if(o.segment!==void 0){let _=o.dist(u[o.segment+1]),x=o.dist(u[o.segment]);const S={};for(let I=o.segment+1;I<u.length;I++)S[I]={x:u[I].x,y:u[I].y,tileUnitDistanceFromAnchor:_},I<u.length-1&&(_+=u[I+1].dist(u[I]));for(let I=o.segment||0;I>=0;I--)S[I]={x:u[I].x,y:u[I].y,tileUnitDistanceFromAnchor:x},I>0&&(x+=u[I-1].dist(u[I]));for(let I=0;I<u.length;I++){const R=S[I];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(o,u,p,_,x,S,I,R,N,q,W,Y){const it=o.indexArray,at=o.layoutVertexArray,ft=o.segments.prepareSegment(4*u.length,at,it,this.canOverlap?S.sortKey:void 0),At=this.glyphOffsetArray.length,It=ft.vertexLength,Zt=this.allowVerticalPlacement&&I===c.ah.vertical?Math.PI/2:0,Ft=S.text&&S.text.sections;for(let Ht=0;Ht<u.length;Ht++){const{tl:ye,tr:ve,bl:Ve,br:ei,tex:Ue,pixelOffsetTL:ke,pixelOffsetBR:Ke,minFontScaleX:li,minFontScaleY:Ge,glyphOffset:we,isSDF:ii,sectionIndex:Qe}=u[Ht],Mi=ft.vertexLength,Tr=we[1];tg(at,R.x,R.y,ye.x,Tr+ye.y,Ue.x,Ue.y,p,ii,ke.x,ke.y,li,Ge),tg(at,R.x,R.y,ve.x,Tr+ve.y,Ue.x+Ue.w,Ue.y,p,ii,Ke.x,ke.y,li,Ge),tg(at,R.x,R.y,Ve.x,Tr+Ve.y,Ue.x,Ue.y+Ue.h,p,ii,ke.x,Ke.y,li,Ge),tg(at,R.x,R.y,ei.x,Tr+ei.y,Ue.x+Ue.w,Ue.y+Ue.h,p,ii,Ke.x,Ke.y,li,Ge),y0(o.dynamicLayoutVertexArray,R,Zt),it.emplaceBack(Mi,Mi+1,Mi+2),it.emplaceBack(Mi+1,Mi+2,Mi+3),ft.vertexLength+=4,ft.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(we[0]),Ht!==u.length-1&&Qe===u[Ht+1].sectionIndex||o.programConfigurations.populatePaintArrays(at.length,S,S.index,{},Y,Ft&&Ft[Qe])}o.placedSymbolArray.emplaceBack(R.x,R.y,At,this.glyphOffsetArray.length-At,It,N,q,R.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],I,0,!1,0,W)}_addCollisionDebugVertex(o,u,p,_,x,S){return u.emplaceBack(0,0),o.emplaceBack(p.x,p.y,_,x,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(o,u,p,_,x,S,I){const R=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),N=R.vertexLength,q=x.layoutVertexArray,W=x.collisionVertexArray,Y=I.anchorX,it=I.anchorY;this._addCollisionDebugVertex(q,W,S,Y,it,new T(o,u)),this._addCollisionDebugVertex(q,W,S,Y,it,new T(p,u)),this._addCollisionDebugVertex(q,W,S,Y,it,new T(p,_)),this._addCollisionDebugVertex(q,W,S,Y,it,new T(o,_)),R.vertexLength+=4;const at=x.indexArray;at.emplaceBack(N,N+1),at.emplaceBack(N+1,N+2),at.emplaceBack(N+2,N+3),at.emplaceBack(N+3,N),R.primitiveLength+=4}addDebugCollisionBoxes(o,u,p,_){for(let x=o;x<u;x++){const S=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,_?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new v0($r,ob.members,fh),this.iconCollisionBox=new v0($r,ob.members,fh);for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(o,u,p,_,x,S,I,R,N){const q={};for(let W=u;W<p;W++){const Y=o.get(W);q.textBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.textFeatureIndex=Y.featureIndex;break}for(let W=_;W<x;W++){const Y=o.get(W);q.verticalTextBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.verticalTextFeatureIndex=Y.featureIndex;break}for(let W=S;W<I;W++){const Y=o.get(W);q.iconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.iconFeatureIndex=Y.featureIndex;break}for(let W=R;W<N;W++){const Y=o.get(W);q.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},q.verticalIconFeatureIndex=Y.featureIndex;break}return q}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const p=o.placedSymbolArray.get(u),_=p.vertexStartIndex+4*p.numGlyphs;for(let x=p.vertexStartIndex;x<_;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(o),p=Math.cos(o),_=[],x=[],S=[];for(let I=0;I<this.symbolInstances.length;++I){S.push(I);const R=this.symbolInstances.get(I);_.push(0|Math.round(u*R.anchorX+p*R.anchorY)),x.push(R.featureIndex)}return S.sort((I,R)=>_[I]-_[R]||x[R]-x[I]),S}addToSortKeyRanges(o,u){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const p=this.symbolInstances.get(u);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((_,x,S)=>{_>=0&&S.indexOf(_)===x&&this.addIndicesForPlacedSymbol(this.text,_)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Sb,Eb;Je("SymbolBucket",id,{omit:["layers","collisionBoxArray","features","compareText"]}),id.MAX_GLYPHS=65535,id.addDynamicAttributes=y0;var b0={get paint(){return Eb=Eb||new v({"icon-opacity":new w(ot.paint_symbol["icon-opacity"]),"icon-color":new w(ot.paint_symbol["icon-color"]),"icon-halo-color":new w(ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new w(ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new w(ot.paint_symbol["icon-halo-blur"]),"icon-translate":new oi(ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new oi(ot.paint_symbol["icon-translate-anchor"]),"text-opacity":new w(ot.paint_symbol["text-opacity"]),"text-color":new w(ot.paint_symbol["text-color"],{runtimeType:Di,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new w(ot.paint_symbol["text-halo-color"]),"text-halo-width":new w(ot.paint_symbol["text-halo-width"]),"text-halo-blur":new w(ot.paint_symbol["text-halo-blur"]),"text-translate":new oi(ot.paint_symbol["text-translate"]),"text-translate-anchor":new oi(ot.paint_symbol["text-translate-anchor"])})},get layout(){return Sb=Sb||new v({"symbol-placement":new oi(ot.layout_symbol["symbol-placement"]),"symbol-spacing":new oi(ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new oi(ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new w(ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new oi(ot.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new oi(ot.layout_symbol["icon-allow-overlap"]),"icon-overlap":new oi(ot.layout_symbol["icon-overlap"]),"icon-ignore-placement":new oi(ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new oi(ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new oi(ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new w(ot.layout_symbol["icon-size"]),"icon-text-fit":new oi(ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new oi(ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new w(ot.layout_symbol["icon-image"]),"icon-rotate":new w(ot.layout_symbol["icon-rotate"]),"icon-padding":new w(ot.layout_symbol["icon-padding"]),"icon-keep-upright":new oi(ot.layout_symbol["icon-keep-upright"]),"icon-offset":new w(ot.layout_symbol["icon-offset"]),"icon-anchor":new w(ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new oi(ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new oi(ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new oi(ot.layout_symbol["text-rotation-alignment"]),"text-field":new w(ot.layout_symbol["text-field"]),"text-font":new w(ot.layout_symbol["text-font"]),"text-size":new w(ot.layout_symbol["text-size"]),"text-max-width":new w(ot.layout_symbol["text-max-width"]),"text-line-height":new oi(ot.layout_symbol["text-line-height"]),"text-letter-spacing":new w(ot.layout_symbol["text-letter-spacing"]),"text-justify":new w(ot.layout_symbol["text-justify"]),"text-radial-offset":new w(ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new oi(ot.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new w(ot.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new w(ot.layout_symbol["text-anchor"]),"text-max-angle":new oi(ot.layout_symbol["text-max-angle"]),"text-writing-mode":new oi(ot.layout_symbol["text-writing-mode"]),"text-rotate":new w(ot.layout_symbol["text-rotate"]),"text-padding":new oi(ot.layout_symbol["text-padding"]),"text-keep-upright":new oi(ot.layout_symbol["text-keep-upright"]),"text-transform":new w(ot.layout_symbol["text-transform"]),"text-offset":new w(ot.layout_symbol["text-offset"]),"text-allow-overlap":new oi(ot.layout_symbol["text-allow-overlap"]),"text-overlap":new oi(ot.layout_symbol["text-overlap"]),"text-ignore-placement":new oi(ot.layout_symbol["text-ignore-placement"]),"text-optional":new oi(ot.layout_symbol["text-optional"])})}};class Cb{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Lr,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Je("FormatSectionOverride",Cb,{omit:["defaultValue"]});class eg extends B{constructor(o){super(o,b0)}recalculate(o,u){if(super.recalculate(o,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const x of p)_.indexOf(x)<0&&_.push(x);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,u,p,_){const x=this.layout.get(o).evaluate(u,{},p,_),S=this._unevaluatedLayout._values[o];return S.isDataDriven()||tn(S.value)||!x?x:function(I,R){return R.replace(/{([^{}]+)}/g,(N,q)=>I&&q in I?String(I[q]):"")}(u.properties,x)}createBucket(o){return new id(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of b0.paint.overridableProperties){if(!eg.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),p=new Cb(u),_=new Po(p,u.property.specification);let x=null;x=u.value.kind==="constant"||u.value.kind==="source"?new Ko("source",_):new so("composite",_,u.value.zoomStops),this.paint._values[o]=new Bo(u.property,x,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,p){return!(!this.layout||u.isDataDriven()||p.isDataDriven())&&eg.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const p=o.get("text-field"),_=b0.paint.properties[u];let x=!1;const S=I=>{for(const R of I)if(_.overrides&&_.overrides.hasOverride(R))return void(x=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Rr)S(p.value.value.sections);else if(p.value.kind==="source"){const I=N=>{x||(N instanceof Ws&&Sr(N.value)===ir?S(N.value.sections):N instanceof Rl?S(N.sections):N.eachChild(I))},R=p.value;R._styleExpression&&I(R._styleExpression.expression)}return x}}let Tb;var ST={get paint(){return Tb=Tb||new v({"background-color":new oi(ot.paint_background["background-color"]),"background-pattern":new d(ot.paint_background["background-pattern"]),"background-opacity":new oi(ot.paint_background["background-opacity"])})}};class ET extends B{constructor(o){super(o,ST)}}let Pb;var CT={get paint(){return Pb=Pb||new v({"raster-opacity":new oi(ot.paint_raster["raster-opacity"]),"raster-hue-rotate":new oi(ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new oi(ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new oi(ot.paint_raster["raster-brightness-max"]),"raster-saturation":new oi(ot.paint_raster["raster-saturation"]),"raster-contrast":new oi(ot.paint_raster["raster-contrast"]),"raster-resampling":new oi(ot.paint_raster["raster-resampling"]),"raster-fade-duration":new oi(ot.paint_raster["raster-fade-duration"])})}};class TT extends B{constructor(o){super(o,CT)}}class PT extends B{constructor(o){super(o,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class IT{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const w0=63710088e-1;class Eh{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Eh(Nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,p=this.lat*u,_=o.lat*u,x=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((o.lng-this.lng)*u);return w0*Math.acos(Math.min(x,1))}static convert(o){if(o instanceof Eh)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Eh(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Eh(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ib=2*Math.PI*w0;function Lb(h){return Ib*Math.cos(h*Math.PI/180)}function Mb(h){return(180+h)/360}function Bb(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function Rb(h,o){return h/Lb(o)}function x0(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class ig{constructor(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+o,this.y=+u,this.z=+p}static fromLngLat(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=Eh.convert(o);return new ig(Mb(p.lng),Bb(p.lat),Rb(u,p.lat))}toLngLat(){return new Eh(360*this.x-180,x0(this.y))}toAltitude(){return this.z*Lb(x0(this.y))}meterInMercatorCoordinateUnits(){return 1/Ib*(o=x0(this.y),1/Math.cos(o*Math.PI/180));var o}}function kb(h,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[h*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}class A0{constructor(o,u,p){if(o<0||o>25||p<0||p>=Math.pow(2,o)||u<0||u>=Math.pow(2,o))throw new Error(`x=${u}, y=${p}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=u,this.y=p,this.key=wp(0,o,o,u,p)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u,p){const _=(S=this.y,I=this.z,R=kb(256*(x=this.x),256*(S=Math.pow(2,I)-S-1),I),N=kb(256*(x+1),256*(S+1),I),R[0]+","+R[1]+","+N[0]+","+N[1]);var x,S,I,R,N;const q=function(W,Y,it){let at,ft="";for(let At=W;At>0;At--)at=1<<At-1,ft+=(Y&at?1:0)+(it&at?2:0);return ft}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,_)}isChildOf(o){const u=this.z-o.z;return u>0&&o.x===this.x>>u&&o.y===this.y>>u}getTilePoint(o){const u=Math.pow(2,this.z);return new T((o.x*u-this.x)*ts,(o.y*u-this.y)*ts)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ob{constructor(o,u){this.wrap=o,this.canonical=u,this.key=wp(o,u.z,u.z,u.x,u.y)}}class la{constructor(o,u,p,_,x){if(o<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${p}`);this.overscaledZ=o,this.wrap=u,this.canonical=new A0(p,+_,+x),this.key=wp(u,o,p,_,x)}clone(){return new la(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-o;return o>this.canonical.z?new la(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new la(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(o,u){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-o;return o>this.canonical.z?wp(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):wp(this.wrap*+u,o,o,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new la(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new la(u,this.wrap,u,p,_),new la(u,this.wrap,u,p+1,_),new la(u,this.wrap,u,p,_+1),new la(u,this.wrap,u,p+1,_+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new la(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new la(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ob(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new ig(o.x-this.wrap,o.y))}}function wp(h,o,u,p,_){(h*=2)<0&&(h=-1*h-1);const x=1<<u;return(x*x*h+x*_+p).toString(36)+u.toString(36)+o.toString(36)}Je("CanonicalTileID",A0),Je("OverscaledTileID",la,{omit:["posMatrix"]});class Fb{constructor(o,u,p){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,I=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Bt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const R=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=x,this.blueFactor=S,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let N=0;N<R;N++)this.data[this._idx(-1,N)]=this.data[this._idx(0,N)],this.data[this._idx(R,N)]=this.data[this._idx(R-1,N)],this.data[this._idx(N,-1)]=this.data[this._idx(N,0)],this.data[this._idx(N,R)]=this.data[this._idx(N,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let N=0;N<R;N++)for(let q=0;q<R;q++){const W=this.get(N,q);W>this.max&&(this.max=W),W<this.min&&(this.min=W)}}get(o,u){const p=new Uint8Array(this.data.buffer),_=4*this._idx(o,u);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}unpack(o,u,p){return o*this.redFactor+u*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new aa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,u,p){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let _=u*this.dim,x=u*this.dim+this.dim,S=p*this.dim,I=p*this.dim+this.dim;switch(u){case-1:_=x-1;break;case 1:x=_+1}switch(p){case-1:S=I-1;break;case 1:I=S+1}const R=-u*this.dim,N=-p*this.dim;for(let q=S;q<I;q++)for(let W=_;W<x;W++)this.data[this._idx(W,q)]=o.data[this._idx(W+R,q+N)]}}Je("DEMData",Fb);class Nb{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const p=o[u];this._stringToNumber[p]=u,this._numberToString[u]=p}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class Db{constructor(o,u,p,_,x){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=p,o._y=_,this.properties=o.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o}}class zb{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Cc(ts,16,0),this.grid3D=new Cc(ts,16,0),this.featureIndexArray=new ps,this.promoteId=u}insert(o,u,p,_,x,S){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,x);const R=S?this.grid3D:this.grid;for(let N=0;N<u.length;N++){const q=u[N],W=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<q.length;Y++){const it=q[Y];W[0]=Math.min(W[0],it.x),W[1]=Math.min(W[1],it.y),W[2]=Math.max(W[2],it.x),W[3]=Math.max(W[3],it.y)}W[0]<ts&&W[1]<ts&&W[2]>=0&&W[3]>=0&&R.insert(I,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xh.VectorTile(new u0(this.rawTileData)).layers,this.sourceLayerCoder=new Nb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,u,p,_){this.loadVTLayers();const x=o.params||{},S=ts/o.tileSize/o.scale,I=vr(x.filter),R=o.queryGeometry,N=o.queryPadding*S,q=jb(R),W=this.grid.query(q.minX-N,q.minY-N,q.maxX+N,q.maxY+N),Y=jb(o.cameraQueryGeometry),it=this.grid3D.query(Y.minX-N,Y.minY-N,Y.maxX+N,Y.maxY+N,(At,It,Zt,Ft)=>function(Ht,ye,ve,Ve,ei){for(const ke of Ht)if(ye<=ke.x&&ve<=ke.y&&Ve>=ke.x&&ei>=ke.y)return!0;const Ue=[new T(ye,ve),new T(ye,ei),new T(Ve,ei),new T(Ve,ve)];if(Ht.length>2){for(const ke of Ue)if(po(Ht,ke))return!0}for(let ke=0;ke<Ht.length-1;ke++)if(Zl(Ht[ke],Ht[ke+1],Ue))return!0;return!1}(o.cameraQueryGeometry,At-N,It-N,Zt+N,Ft+N));for(const At of it)W.push(At);W.sort(LT);const at={};let ft;for(let At=0;At<W.length;At++){const It=W[At];if(It===ft)continue;ft=It;const Zt=this.featureIndexArray.get(It);let Ft=null;this.loadMatchingFeature(at,Zt.bucketIndex,Zt.sourceLayerIndex,Zt.featureIndex,I,x.layers,x.availableImages,u,p,_,(Ht,ye,ve)=>(Ft||(Ft=Jl(Ht)),ye.queryIntersectsFeature(R,Ht,ve,Ft,this.z,o.transform,S,o.pixelPosMatrix)))}return at}loadMatchingFeature(o,u,p,_,x,S,I,R,N,q,W){const Y=this.bucketLayerIDs[u];if(S&&!function(At,It){for(let Zt=0;Zt<At.length;Zt++)if(It.indexOf(At[Zt])>=0)return!0;return!1}(S,Y))return;const it=this.sourceLayerCoder.decode(p),at=this.vtLayers[it].feature(_);if(x.needGeometry){const At=Lc(at,!0);if(!x.filter(new br(this.tileID.overscaledZ),At,this.tileID.canonical))return}else if(!x.filter(new br(this.tileID.overscaledZ),at))return;const ft=this.getId(at,it);for(let At=0;At<Y.length;At++){const It=Y[At];if(S&&S.indexOf(It)<0)continue;const Zt=R[It];if(!Zt)continue;let Ft={};ft&&q&&(Ft=q.getState(Zt.sourceLayer||"_geojsonTileLayer",ft));const Ht=Rt({},N[It]);Ht.paint=Ub(Ht.paint,Zt.paint,at,Ft,I),Ht.layout=Ub(Ht.layout,Zt.layout,at,Ft,I);const ye=!W||W(at,Zt,Ft);if(!ye)continue;const ve=new Db(at,this.z,this.x,this.y,ft);ve.layer=Ht;let Ve=o[It];Ve===void 0&&(Ve=o[It]=[]),Ve.push({featureIndex:_,feature:ve,intersectionZ:ye})}}lookupSymbolFeatures(o,u,p,_,x,S,I,R){const N={};this.loadVTLayers();const q=vr(x);for(const W of o)this.loadMatchingFeature(N,p,_,W,q,S,I,R,u);return N}hasLayer(o){for(const u of this.bucketLayerIDs)for(const p of u)if(o===p)return!0;return!1}getId(o,u){let p=o.id;return this.promoteId&&(p=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof p=="boolean"&&(p=Number(p))),p}}function Ub(h,o,u,p,_){return qt(h,(x,S)=>{const I=o instanceof Tc?o.get(S):null;return I&&I.evaluate?I.evaluate(u,p,_):I})}function jb(h){let o=1/0,u=1/0,p=-1/0,_=-1/0;for(const x of h)o=Math.min(o,x.x),u=Math.min(u,x.y),p=Math.max(p,x.x),_=Math.max(_,x.y);return{minX:o,minY:u,maxX:p,maxY:_}}function LT(h,o){return o-h}function Gb(h,o,u,p,_){const x=[];for(let S=0;S<h.length;S++){const I=h[S];let R;for(let N=0;N<I.length-1;N++){let q=I[N],W=I[N+1];q.x<o&&W.x<o||(q.x<o?q=new T(o,q.y+(o-q.x)/(W.x-q.x)*(W.y-q.y))._round():W.x<o&&(W=new T(o,q.y+(o-q.x)/(W.x-q.x)*(W.y-q.y))._round()),q.y<u&&W.y<u||(q.y<u?q=new T(q.x+(u-q.y)/(W.y-q.y)*(W.x-q.x),u)._round():W.y<u&&(W=new T(q.x+(u-q.y)/(W.y-q.y)*(W.x-q.x),u)._round()),q.x>=p&&W.x>=p||(q.x>=p?q=new T(p,q.y+(p-q.x)/(W.x-q.x)*(W.y-q.y))._round():W.x>=p&&(W=new T(p,q.y+(p-q.x)/(W.x-q.x)*(W.y-q.y))._round()),q.y>=_&&W.y>=_||(q.y>=_?q=new T(q.x+(_-q.y)/(W.y-q.y)*(W.x-q.x),_)._round():W.y>=_&&(W=new T(q.x+(_-q.y)/(W.y-q.y)*(W.x-q.x),_)._round()),R&&q.equals(R[R.length-1])||(R=[q],x.push(R)),R.push(W)))))}}return x}Je("FeatureIndex",zb,{omit:["rawTileData","sourceLayerCoder"]});class Ch extends T{constructor(o,u,p,_){super(o,u),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new Ch(this.x,this.y,this.angle,this.segment)}}function Vb(h,o,u,p,_){if(o.segment===void 0||u===0)return!0;let x=o,S=o.segment+1,I=0;for(;I>-u/2;){if(S--,S<0)return!1;I-=h[S].dist(x),x=h[S]}I+=h[S].dist(h[S+1]),S++;const R=[];let N=0;for(;I<u/2;){const q=h[S],W=h[S+1];if(!W)return!1;let Y=h[S-1].angleTo(q)-q.angleTo(W);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:I,angleDelta:Y}),N+=Y;I-R[0].distance>p;)N-=R.shift().angleDelta;if(N>_)return!1;S++,I+=q.dist(W)}return!0}function qb(h){let o=0;for(let u=0;u<h.length-1;u++)o+=h[u].dist(h[u+1]);return o}function Hb(h,o,u){return h?.6*o*u:0}function Wb(h,o){return Math.max(h?h.right-h.left:0,o?o.right-o.left:0)}function MT(h,o,u,p,_,x){const S=Hb(u,_,x),I=Wb(u,p)*x;let R=0;const N=qb(h)/2;for(let q=0;q<h.length-1;q++){const W=h[q],Y=h[q+1],it=W.dist(Y);if(R+it>N){const at=(N-R)/it,ft=ys.number(W.x,Y.x,at),At=ys.number(W.y,Y.y,at),It=new Ch(ft,At,Y.angleTo(W),q);return It._round(),!S||Vb(h,It,I,S,o)?It:void 0}R+=it}}function BT(h,o,u,p,_,x,S,I,R){const N=Hb(p,x,S),q=Wb(p,_),W=q*S,Y=h[0].x===0||h[0].x===R||h[0].y===0||h[0].y===R;return o-W<o/4&&(o=W+o/4),Jb(h,Y?o/2*I%o:(q/2+2*x)*S*I%o,o,N,u,W,Y,!1,R)}function Jb(h,o,u,p,_,x,S,I,R){const N=x/2,q=qb(h);let W=0,Y=o-u,it=[];for(let at=0;at<h.length-1;at++){const ft=h[at],At=h[at+1],It=ft.dist(At),Zt=At.angleTo(ft);for(;Y+u<W+It;){Y+=u;const Ft=(Y-W)/It,Ht=ys.number(ft.x,At.x,Ft),ye=ys.number(ft.y,At.y,Ft);if(Ht>=0&&Ht<R&&ye>=0&&ye<R&&Y-N>=0&&Y+N<=q){const ve=new Ch(Ht,ye,Zt,at);ve._round(),p&&!Vb(h,ve,x,p,_)||it.push(ve)}}W+=It}return I||it.length||S||(it=Jb(h,W/2,u,p,_,x,S,!0,R)),it}Je("Anchor",Ch);const rd=fo;function Xb(h,o,u,p){const _=[],x=h.image,S=x.pixelRatio,I=x.paddedRect.w-2*rd,R=x.paddedRect.h-2*rd;let N={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const q=x.stretchX||[[0,I]],W=x.stretchY||[[0,R]],Y=(we,ii)=>we+ii[1]-ii[0],it=q.reduce(Y,0),at=W.reduce(Y,0),ft=I-it,At=R-at;let It=0,Zt=it,Ft=0,Ht=at,ye=0,ve=ft,Ve=0,ei=At;if(x.content&&p){const we=x.content,ii=we[2]-we[0],Qe=we[3]-we[1];(x.textFitWidth||x.textFitHeight)&&(N=wb(h)),It=rg(q,0,we[0]),Ft=rg(W,0,we[1]),Zt=rg(q,we[0],we[2]),Ht=rg(W,we[1],we[3]),ye=we[0]-It,Ve=we[1]-Ft,ve=ii-Zt,ei=Qe-Ht}const Ue=N.x1,ke=N.y1,Ke=N.x2-Ue,li=N.y2-ke,Ge=(we,ii,Qe,Mi)=>{const Tr=sg(we.stretch-It,Zt,Ke,Ue),Pr=ng(we.fixed-ye,ve,we.stretch,it),xs=sg(ii.stretch-Ft,Ht,li,ke),ca=ng(ii.fixed-Ve,ei,ii.stretch,at),xn=sg(Qe.stretch-It,Zt,Ke,Ue),Ns=ng(Qe.fixed-ye,ve,Qe.stretch,it),Zs=sg(Mi.stretch-Ft,Ht,li,ke),An=ng(Mi.fixed-Ve,ei,Mi.stretch,at),jn=new T(Tr,xs),Sn=new T(xn,xs),As=new T(xn,Zs),Gs=new T(Tr,Zs),Gn=new T(Pr/S,ca/S),go=new T(Ns/S,An/S),on=o*Math.PI/180;if(on){const hs=Math.sin(on),ji=Math.cos(on),Ss=[ji,-hs,hs,ji];jn._matMult(Ss),Sn._matMult(Ss),Gs._matMult(Ss),As._matMult(Ss)}const mo=we.stretch+we.fixed,ha=ii.stretch+ii.fixed;return{tl:jn,tr:Sn,bl:Gs,br:As,tex:{x:x.paddedRect.x+rd+mo,y:x.paddedRect.y+rd+ha,w:Qe.stretch+Qe.fixed-mo,h:Mi.stretch+Mi.fixed-ha},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gn,pixelOffsetBR:go,minFontScaleX:ve/S/Ke,minFontScaleY:ei/S/li,isSDF:u}};if(p&&(x.stretchX||x.stretchY)){const we=Zb(q,ft,it),ii=Zb(W,At,at);for(let Qe=0;Qe<we.length-1;Qe++){const Mi=we[Qe],Tr=we[Qe+1];for(let Pr=0;Pr<ii.length-1;Pr++)_.push(Ge(Mi,ii[Pr],Tr,ii[Pr+1]))}}else _.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:R+1}));return _}function rg(h,o,u){let p=0;for(const _ of h)p+=Math.max(o,Math.min(u,_[1]))-Math.max(o,Math.min(u,_[0]));return p}function Zb(h,o,u){const p=[{fixed:-rd,stretch:0}];for(const[_,x]of h){const S=p[p.length-1];p.push({fixed:_-S.stretch,stretch:S.stretch}),p.push({fixed:_-S.stretch,stretch:S.stretch+(x-_)})}return p.push({fixed:o+rd,stretch:u}),p}function sg(h,o,u,p){return h/o*u+p}function ng(h,o,u,p){return h-o*u/p}class og{constructor(o,u,p,_,x,S,I,R,N,q){var W;if(this.boxStartIndex=o.length,N){let Y=S.top,it=S.bottom;const at=S.collisionPadding;at&&(Y-=at[1],it+=at[3]);let ft=it-Y;ft>0&&(ft=Math.max(10,ft),this.circleDiameter=ft)}else{const Y=!((W=S.image)===null||W===void 0)&&W.content&&(S.image.textFitWidth||S.image.textFitHeight)?wb(S):{x1:S.left,y1:S.top,x2:S.right,y2:S.bottom};Y.y1=Y.y1*I-R[0],Y.y2=Y.y2*I+R[2],Y.x1=Y.x1*I-R[3],Y.x2=Y.x2*I+R[1];const it=S.collisionPadding;if(it&&(Y.x1-=it[0]*I,Y.y1-=it[1]*I,Y.x2+=it[2]*I,Y.y2+=it[3]*I),q){const at=new T(Y.x1,Y.y1),ft=new T(Y.x2,Y.y1),At=new T(Y.x1,Y.y2),It=new T(Y.x2,Y.y2),Zt=q*Math.PI/180;at._rotate(Zt),ft._rotate(Zt),At._rotate(Zt),It._rotate(Zt),Y.x1=Math.min(at.x,ft.x,At.x,It.x),Y.x2=Math.max(at.x,ft.x,At.x,It.x),Y.y1=Math.min(at.y,ft.y,At.y,It.y),Y.y2=Math.max(at.y,ft.y,At.y,It.y)}o.emplaceBack(u.x,u.y,Y.x1,Y.y1,Y.x2,Y.y2,p,_,x)}this.boxEndIndex=o.length}}class RT{constructor(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kT;if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:p}=this,_=u[o];for(;o>0;){const x=o-1>>1,S=u[x];if(p(_,S)>=0)break;u[o]=S,o=x}u[o]=_}_down(o){const{data:u,compare:p}=this,_=this.length>>1,x=u[o];for(;o<_;){let S=1+(o<<1),I=u[S];const R=S+1;if(R<this.length&&p(u[R],I)<0&&(S=R,I=u[R]),p(I,x)>=0)break;u[o]=I,o=S}u[o]=x}}function kT(h,o){return h<o?-1:h>o?1:0}function OT(h){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,_=1/0,x=-1/0,S=-1/0;const I=h[0];for(let it=0;it<I.length;it++){const at=I[it];(!it||at.x<p)&&(p=at.x),(!it||at.y<_)&&(_=at.y),(!it||at.x>x)&&(x=at.x),(!it||at.y>S)&&(S=at.y)}const R=Math.min(x-p,S-_);let N=R/2;const q=new RT([],FT);if(R===0)return new T(p,_);for(let it=p;it<x;it+=R)for(let at=_;at<S;at+=R)q.push(new sd(it+N,at+N,N,h));let W=function(it){let at=0,ft=0,At=0;const It=it[0];for(let Zt=0,Ft=It.length,Ht=Ft-1;Zt<Ft;Ht=Zt++){const ye=It[Zt],ve=It[Ht],Ve=ye.x*ve.y-ve.x*ye.y;ft+=(ye.x+ve.x)*Ve,At+=(ye.y+ve.y)*Ve,at+=3*Ve}return new sd(ft/at,At/at,0,it)}(h),Y=q.length;for(;q.length;){const it=q.pop();(it.d>W.d||!W.d)&&(W=it,u&&console.log("found best %d after %d probes",Math.round(1e4*it.d)/1e4,Y)),it.max-W.d<=o||(N=it.h/2,q.push(new sd(it.p.x-N,it.p.y-N,N,h)),q.push(new sd(it.p.x+N,it.p.y-N,N,h)),q.push(new sd(it.p.x-N,it.p.y+N,N,h)),q.push(new sd(it.p.x+N,it.p.y+N,N,h)),Y+=4)}return u&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${W.d}`)),W.p}function FT(h,o){return o.max-h.max}function sd(h,o,u,p){this.p=new T(h,o),this.h=u,this.d=function(_,x){let S=!1,I=1/0;for(let R=0;R<x.length;R++){const N=x[R];for(let q=0,W=N.length,Y=W-1;q<W;Y=q++){const it=N[q],at=N[Y];it.y>_.y!=at.y>_.y&&_.x<(at.x-it.x)*(_.y-it.y)/(at.y-it.y)+it.x&&(S=!S),I=Math.min(I,cu(_,it,at))}}return(S?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var nn;c.ap=void 0,(nn=c.ap||(c.ap={}))[nn.center=1]="center",nn[nn.left=2]="left",nn[nn.right=3]="right",nn[nn.top=4]="top",nn[nn.bottom=5]="bottom",nn[nn["top-left"]=6]="top-left",nn[nn["top-right"]=7]="top-right",nn[nn["bottom-left"]=8]="bottom-left",nn[nn["bottom-right"]=9]="bottom-right";const Th=7,S0=Number.POSITIVE_INFINITY;function $b(h,o){return o[1]!==S0?function(u,p,_){let x=0,S=0;switch(p=Math.abs(p),_=Math.abs(_),u){case"top-right":case"top-left":case"top":S=_-Th;break;case"bottom-right":case"bottom-left":case"bottom":S=-_+Th}switch(u){case"top-right":case"bottom-right":case"right":x=-p;break;case"top-left":case"bottom-left":case"left":x=p}return[x,S]}(h,o[0],o[1]):function(u,p){let _=0,x=0;p<0&&(p=0);const S=p/Math.SQRT2;switch(u){case"top-right":case"top-left":x=S-Th;break;case"bottom-right":case"bottom-left":x=-S+Th;break;case"bottom":x=-p+Th;break;case"top":x=p-Th}switch(u){case"top-right":case"bottom-right":_=-S;break;case"top-left":case"bottom-left":_=S;break;case"left":_=p;break;case"right":_=-p}return[_,x]}(h,o[0])}function Yb(h,o,u){var p;const _=h.layout,x=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(o,{},u);if(x){const I=x.values,R=[];for(let N=0;N<I.length;N+=2){const q=R[N]=I[N],W=I[N+1].map(Y=>Y*Fs);q.startsWith("top")?W[1]-=Th:q.startsWith("bottom")&&(W[1]+=Th),R[N+1]=W}return new gr(R)}const S=_.get("text-variable-anchor");if(S){let I;I=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(o,{},u)*Fs,S0]:_.get("text-offset").evaluate(o,{},u).map(N=>N*Fs);const R=[];for(const N of S)R.push(N,$b(N,I));return new gr(R)}return null}function E0(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function NT(h,o,u,p,_,x,S,I,R,N,q){let W=x.textMaxSize.evaluate(o,{});W===void 0&&(W=S);const Y=h.layers[0].layout,it=Y.get("icon-offset").evaluate(o,{},q),at=Qb(u.horizontal),ft=S/24,At=h.tilePixelRatio*ft,It=h.tilePixelRatio*W/24,Zt=h.tilePixelRatio*I,Ft=h.tilePixelRatio*Y.get("symbol-spacing"),Ht=Y.get("text-padding")*h.tilePixelRatio,ye=function(we,ii,Qe){let Mi=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Tr=we.get("icon-padding").evaluate(ii,{},Qe),Pr=Tr&&Tr.values;return[Pr[0]*Mi,Pr[1]*Mi,Pr[2]*Mi,Pr[3]*Mi]}(Y,o,q,h.tilePixelRatio),ve=Y.get("text-max-angle")/180*Math.PI,Ve=Y.get("text-rotation-alignment")!=="viewport"&&Y.get("symbol-placement")!=="point",ei=Y.get("icon-rotation-alignment")==="map"&&Y.get("symbol-placement")!=="point",Ue=Y.get("symbol-placement"),ke=Ft/2,Ke=Y.get("icon-text-fit");let li;p&&Ke!=="none"&&(h.allowVerticalPlacement&&u.vertical&&(li=xb(p,u.vertical,Ke,Y.get("icon-text-fit-padding"),it,ft)),at&&(p=xb(p,at,Ke,Y.get("icon-text-fit-padding"),it,ft)));const Ge=(we,ii)=>{ii.x<0||ii.x>=ts||ii.y<0||ii.y>=ts||function(Qe,Mi,Tr,Pr,xs,ca,xn,Ns,Zs,An,jn,Sn,As,Gs,Gn,go,on,mo,ha,hs,ji,Ss,an,Ds,Ua){const ll=Qe.addToLineVertexArray(Mi,Tr);let cl,Bc,ja,ua,yo=0,Rc=0,Sp=0,r2=0,R0=-1,k0=-1;const kc={};let s2=yh("");if(Qe.allowVerticalPlacement&&Pr.vertical){const En=Ns.layout.get("text-rotate").evaluate(ji,{},Ds)+90;ja=new og(Zs,Mi,An,jn,Sn,Pr.vertical,As,Gs,Gn,En),xn&&(ua=new og(Zs,Mi,An,jn,Sn,xn,on,mo,Gn,En))}if(xs){const En=Ns.layout.get("icon-rotate").evaluate(ji,{}),da=Ns.layout.get("icon-text-fit")!=="none",du=Xb(xs,En,an,da),ul=xn?Xb(xn,En,an,da):void 0;Bc=new og(Zs,Mi,An,jn,Sn,xs,on,mo,!1,En),yo=4*du.length;const pu=Qe.iconSizeData;let Kl=null;pu.kind==="source"?(Kl=[Yl*Ns.layout.get("icon-size").evaluate(ji,{})],Kl[0]>Sh&&Bt(`${Qe.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)):pu.kind==="composite"&&(Kl=[Yl*Ss.compositeIconSizes[0].evaluate(ji,{},Ds),Yl*Ss.compositeIconSizes[1].evaluate(ji,{},Ds)],(Kl[0]>Sh||Kl[1]>Sh)&&Bt(`${Qe.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)),Qe.addSymbols(Qe.icon,du,Kl,hs,ha,ji,c.ah.none,Mi,ll.lineStartIndex,ll.lineLength,-1,Ds),R0=Qe.icon.placedSymbolArray.length-1,ul&&(Rc=4*ul.length,Qe.addSymbols(Qe.icon,ul,Kl,hs,ha,ji,c.ah.vertical,Mi,ll.lineStartIndex,ll.lineLength,-1,Ds),k0=Qe.icon.placedSymbolArray.length-1)}const n2=Object.keys(Pr.horizontal);for(const En of n2){const da=Pr.horizontal[En];if(!cl){s2=yh(da.text);const ul=Ns.layout.get("text-rotate").evaluate(ji,{},Ds);cl=new og(Zs,Mi,An,jn,Sn,da,As,Gs,Gn,ul)}const du=da.positionedLines.length===1;if(Sp+=Kb(Qe,Mi,da,ca,Ns,Gn,ji,go,ll,Pr.vertical?c.ah.horizontal:c.ah.horizontalOnly,du?n2:[En],kc,R0,Ss,Ds),du)break}Pr.vertical&&(r2+=Kb(Qe,Mi,Pr.vertical,ca,Ns,Gn,ji,go,ll,c.ah.vertical,["vertical"],kc,k0,Ss,Ds));const UT=cl?cl.boxStartIndex:Qe.collisionBoxArray.length,jT=cl?cl.boxEndIndex:Qe.collisionBoxArray.length,GT=ja?ja.boxStartIndex:Qe.collisionBoxArray.length,VT=ja?ja.boxEndIndex:Qe.collisionBoxArray.length,qT=Bc?Bc.boxStartIndex:Qe.collisionBoxArray.length,HT=Bc?Bc.boxEndIndex:Qe.collisionBoxArray.length,WT=ua?ua.boxStartIndex:Qe.collisionBoxArray.length,JT=ua?ua.boxEndIndex:Qe.collisionBoxArray.length;let hl=-1;const lg=(En,da)=>En&&En.circleDiameter?Math.max(En.circleDiameter,da):da;hl=lg(cl,hl),hl=lg(ja,hl),hl=lg(Bc,hl),hl=lg(ua,hl);const o2=hl>-1?1:0;o2&&(hl*=Ua/Fs),Qe.glyphOffsetArray.length>=id.MAX_GLYPHS&&Bt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ji.sortKey!==void 0&&Qe.addToSortKeyRanges(Qe.symbolInstances.length,ji.sortKey);const XT=Yb(Ns,ji,Ds),[ZT,$T]=function(En,da){const du=En.length,ul=da==null?void 0:da.values;if((ul==null?void 0:ul.length)>0)for(let pu=0;pu<ul.length;pu+=2){const Kl=ul[pu+1];En.emplaceBack(c.ap[ul[pu]],Kl[0],Kl[1])}return[du,En.length]}(Qe.textAnchorOffsets,XT);Qe.symbolInstances.emplaceBack(Mi.x,Mi.y,kc.right>=0?kc.right:-1,kc.center>=0?kc.center:-1,kc.left>=0?kc.left:-1,kc.vertical||-1,R0,k0,s2,UT,jT,GT,VT,qT,HT,WT,JT,An,Sp,r2,yo,Rc,o2,0,As,hl,ZT,$T)}(h,ii,we,u,p,_,li,h.layers[0],h.collisionBoxArray,o.index,o.sourceLayerIndex,h.index,At,[Ht,Ht,Ht,Ht],Ve,R,Zt,ye,ei,it,o,x,N,q,S)};if(Ue==="line")for(const we of Gb(o.geometry,0,0,ts,ts)){const ii=BT(we,Ft,ve,u.vertical||at,p,24,It,h.overscaling,ts);for(const Qe of ii)at&&DT(h,at.text,ke,Qe)||Ge(we,Qe)}else if(Ue==="line-center"){for(const we of o.geometry)if(we.length>1){const ii=MT(we,ve,u.vertical||at,p,24,It);ii&&Ge(we,ii)}}else if(o.type==="Polygon")for(const we of Pa(o.geometry,0)){const ii=OT(we,16);Ge(we[0],new Ch(ii.x,ii.y,0))}else if(o.type==="LineString")for(const we of o.geometry)Ge(we,new Ch(we[0].x,we[0].y,0));else if(o.type==="Point")for(const we of o.geometry)for(const ii of we)Ge([ii],new Ch(ii.x,ii.y,0))}function Kb(h,o,u,p,_,x,S,I,R,N,q,W,Y,it,at){const ft=function(Zt,Ft,Ht,ye,ve,Ve,ei,Ue){const ke=ye.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,Ke=[];for(const li of Ft.positionedLines)for(const Ge of li.positionedGlyphs){if(!Ge.rect)continue;const we=Ge.rect||{};let ii=fb+1,Qe=!0,Mi=1,Tr=0;const Pr=(ve||Ue)&&Ge.vertical,xs=Ge.metrics.advance*Ge.scale/2;if(Ue&&Ft.verticalizable&&(Tr=li.lineOffset/2-(Ge.imageName?-(Fs-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*Fs)),Ge.imageName){const hs=ei[Ge.imageName];Qe=hs.sdf,Mi=hs.pixelRatio,ii=fo/Mi}const ca=ve?[Ge.x+xs,Ge.y]:[0,0];let xn=ve?[0,0]:[Ge.x+xs+Ht[0],Ge.y+Ht[1]-Tr],Ns=[0,0];Pr&&(Ns=xn,xn=[0,0]);const Zs=Ge.metrics.isDoubleResolution?2:1,An=(Ge.metrics.left-ii)*Ge.scale-xs+xn[0],jn=(-Ge.metrics.top-ii)*Ge.scale+xn[1],Sn=An+we.w/Zs*Ge.scale/Mi,As=jn+we.h/Zs*Ge.scale/Mi,Gs=new T(An,jn),Gn=new T(Sn,jn),go=new T(An,As),on=new T(Sn,As);if(Pr){const hs=new T(-xs,xs-_p),ji=-Math.PI/2,Ss=Fs/2-xs,an=new T(5-_p-Ss,-(Ge.imageName?Ss:0)),Ds=new T(...Ns);Gs._rotateAround(ji,hs)._add(an)._add(Ds),Gn._rotateAround(ji,hs)._add(an)._add(Ds),go._rotateAround(ji,hs)._add(an)._add(Ds),on._rotateAround(ji,hs)._add(an)._add(Ds)}if(ke){const hs=Math.sin(ke),ji=Math.cos(ke),Ss=[ji,-hs,hs,ji];Gs._matMult(Ss),Gn._matMult(Ss),go._matMult(Ss),on._matMult(Ss)}const mo=new T(0,0),ha=new T(0,0);Ke.push({tl:Gs,tr:Gn,bl:go,br:on,tex:we,writingMode:Ft.writingMode,glyphOffset:ca,sectionIndex:Ge.sectionIndex,isSDF:Qe,pixelOffsetTL:mo,pixelOffsetBR:ha,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,u,I,_,x,S,p,h.allowVerticalPlacement),At=h.textSizeData;let It=null;At.kind==="source"?(It=[Yl*_.layout.get("text-size").evaluate(S,{})],It[0]>Sh&&Bt(`${h.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)):At.kind==="composite"&&(It=[Yl*it.compositeTextSizes[0].evaluate(S,{},at),Yl*it.compositeTextSizes[1].evaluate(S,{},at)],(It[0]>Sh||It[1]>Sh)&&Bt(`${h.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)),h.addSymbols(h.text,ft,It,I,x,S,N,o,R.lineStartIndex,R.lineLength,Y,at);for(const Zt of q)W[Zt]=h.text.placedSymbolArray.length-1;return 4*ft.length}function Qb(h){for(const o in h)return h[o];return null}function DT(h,o,u,p){const _=h.compareText;if(o in _){const x=_[o];for(let S=x.length-1;S>=0;S--)if(p.dist(x[S])<u)return!0}else _[o]=[];return _[o].push(p),!1}const t2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class C0{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,p]=new Uint8Array(o,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const x=t2[15&p];if(!x)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(o,2,1),[I]=new Uint32Array(o,4,1);return new C0(I,S,x,o)}constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,_=arguments.length>3?arguments[3]:void 0;if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=p,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const x=t2.indexOf(this.ArrayType),S=2*o*this.ArrayType.BYTES_PER_ELEMENT,I=o*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-I%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+R,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+S+I+R),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+R,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=o)}add(o,u){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=o,this.coords[this._pos++]=u,p}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return T0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,u,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:S,nodeSize:I}=this,R=[0,x.length-1,0],N=[];for(;R.length;){const q=R.pop()||0,W=R.pop()||0,Y=R.pop()||0;if(W-Y<=I){for(let At=Y;At<=W;At++){const It=S[2*At],Zt=S[2*At+1];It>=o&&It<=p&&Zt>=u&&Zt<=_&&N.push(x[At])}continue}const it=Y+W>>1,at=S[2*it],ft=S[2*it+1];at>=o&&at<=p&&ft>=u&&ft<=_&&N.push(x[it]),(q===0?o<=at:u<=ft)&&(R.push(Y),R.push(it-1),R.push(1-q)),(q===0?p>=at:_>=ft)&&(R.push(it+1),R.push(W),R.push(1-q))}return N}within(o,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:S}=this,I=[0,_.length-1,0],R=[],N=p*p;for(;I.length;){const q=I.pop()||0,W=I.pop()||0,Y=I.pop()||0;if(W-Y<=S){for(let At=Y;At<=W;At++)i2(x[2*At],x[2*At+1],o,u)<=N&&R.push(_[At]);continue}const it=Y+W>>1,at=x[2*it],ft=x[2*it+1];i2(at,ft,o,u)<=N&&R.push(_[it]),(q===0?o-p<=at:u-p<=ft)&&(I.push(Y),I.push(it-1),I.push(1-q)),(q===0?o+p>=at:u+p>=ft)&&(I.push(it+1),I.push(W),I.push(1-q))}return R}}function T0(h,o,u,p,_,x){if(_-p<=u)return;const S=p+_>>1;e2(h,o,S,p,_,x),T0(h,o,u,p,S-1,1-x),T0(h,o,u,S+1,_,1-x)}function e2(h,o,u,p,_,x){for(;_>p;){if(_-p>600){const N=_-p+1,q=u-p+1,W=Math.log(N),Y=.5*Math.exp(2*W/3),it=.5*Math.sqrt(W*Y*(N-Y)/N)*(q-N/2<0?-1:1);e2(h,o,u,Math.max(p,Math.floor(u-q*Y/N+it)),Math.min(_,Math.floor(u+(N-q)*Y/N+it)),x)}const S=o[2*u+x];let I=p,R=_;for(xp(h,o,p,u),o[2*_+x]>S&&xp(h,o,p,_);I<R;){for(xp(h,o,I,R),I++,R--;o[2*I+x]<S;)I++;for(;o[2*R+x]>S;)R--}o[2*p+x]===S?xp(h,o,p,R):(R++,xp(h,o,R,_)),R<=u&&(p=R+1),u<=R&&(_=R-1)}}function xp(h,o,u,p){P0(h,u,p),P0(o,2*u,2*p),P0(o,2*u+1,2*p+1)}function P0(h,o,u){const p=h[o];h[o]=h[u],h[u]=p}function i2(h,o,u,p){const _=h-u,x=o-p;return _*_+x*x}var I0;c.bd=void 0,(I0=c.bd||(c.bd={})).create="create",I0.load="load",I0.fullLoad="fullLoad";let ag=null,Ap=[];const L0=1e3/60,M0="loadTime",B0="fullLoadTime",zT={mark(h){performance.mark(h)},frame(h){const o=h;ag!=null&&Ap.push(o-ag),ag=o},clearMetrics(){ag=null,Ap=[],performance.clearMeasures(M0),performance.clearMeasures(B0);for(const h in c.bd)performance.clearMarks(c.bd[h])},getPerformanceMetrics(){performance.measure(M0,c.bd.create,c.bd.load),performance.measure(B0,c.bd.create,c.bd.fullLoad);const h=performance.getEntriesByName(M0)[0].duration,o=performance.getEntriesByName(B0)[0].duration,u=Ap.length,p=1/(Ap.reduce((x,S)=>x+S,0)/u/1e3),_=Ap.filter(x=>x>L0).reduce((x,S)=>x+(S-L0)/L0,0);return{loadTime:h,fullLoadTime:o,fps:p,percentDroppedFrames:_/(u+_)*100,totalFrames:u}}};c.$=ns,c.A=Yu,c.B=function(h){if(oe==null){const o=h.navigator?h.navigator.userAgent:null;oe=!!h.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return oe},c.C=class{constructor(h,o){this.target=h,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new IT(()=>this.process()),this.subscription=function(u,p,_,x){return u.addEventListener(p,_,!1),{unsubscribe:()=>{u.removeEventListener(p,_,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=ne(self)?h:window}registerMessageHandler(h,o){this.messageHandlers[h]=o}sendAsync(h,o){return new Promise((u,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:u,reject:p},o&&o.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const I={id:_,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const x=[],S=Object.assign(Object.assign({},h),{id:_,sourceMapId:this.mapId,origin:location.origin,data:cs(h.data,x)});this.target.postMessage(S,{transfer:x})})}receive(h){const o=h.data,u=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[u];const p=this.abortControllers[u];return delete this.abortControllers[u],void(p&&p.abort())}if(ne(self)||o.mustQueue)return this.tasks[u]=o,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,o)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),o=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(h,o)}processTask(h,o){return l(this,void 0,void 0,function*(){if(o.type==="<response>"){const _=this.resolveRejects[h];return delete this.resolveRejects[h],_?void(o.error?_.reject(vn(o.error)):_.resolve(vn(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=vn(o.data),p=new AbortController;this.abortControllers[h]=p;try{const _=yield this.messageHandlers[o.type](o.sourceMapId,u,p);this.completeTask(h,null,_)}catch(_){this.completeTask(h,_)}})}completeTask(h,o,u){const p=[];delete this.abortControllers[h];const _={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?cs(o):null,data:cs(u,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.D=oi,c.E=he,c.F=function(){var h=new Yu(16);return Yu!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.G=Wt,c.H=function(h,o,u){var p,_,x,S,I,R,N,q,W,Y,it,at,ft=u[0],At=u[1],It=u[2];return o===h?(h[12]=o[0]*ft+o[4]*At+o[8]*It+o[12],h[13]=o[1]*ft+o[5]*At+o[9]*It+o[13],h[14]=o[2]*ft+o[6]*At+o[10]*It+o[14],h[15]=o[3]*ft+o[7]*At+o[11]*It+o[15]):(_=o[1],x=o[2],S=o[3],I=o[4],R=o[5],N=o[6],q=o[7],W=o[8],Y=o[9],it=o[10],at=o[11],h[0]=p=o[0],h[1]=_,h[2]=x,h[3]=S,h[4]=I,h[5]=R,h[6]=N,h[7]=q,h[8]=W,h[9]=Y,h[10]=it,h[11]=at,h[12]=p*ft+I*At+W*It+o[12],h[13]=_*ft+R*At+Y*It+o[13],h[14]=x*ft+N*At+it*It+o[14],h[15]=S*ft+q*At+at*It+o[15]),h},c.I=p0,c.J=function(h,o,u){var p=u[0],_=u[1],x=u[2];return h[0]=o[0]*p,h[1]=o[1]*p,h[2]=o[2]*p,h[3]=o[3]*p,h[4]=o[4]*_,h[5]=o[5]*_,h[6]=o[6]*_,h[7]=o[7]*_,h[8]=o[8]*x,h[9]=o[9]*x,h[10]=o[10]*x,h[11]=o[11]*x,h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15],h},c.K=Fv,c.L=function(h,o){const u={};for(let p=0;p<o.length;p++){const _=o[p];_ in h&&(u[_]=h[_])}return u},c.M=Eh,c.N=Mb,c.O=Bb,c.P=T,c.Q=la,c.R=aa,c.S=Z,c.T=dh,c.U=$,c.V=fe,c.W=ts,c.X=C,c.Y=ig,c.Z=class extends U{},c._=l,c.a=Lt,c.a$=function(h,o,u){return h[0]=o[0]*u[0],h[1]=o[1]*u[1],h[2]=o[2]*u[2],h[3]=o[3]*u[3],h},c.a0=A0,c.a1=be,c.a2=h=>{const o=window.document.createElement("video");return o.muted=!0,new Promise(u=>{o.onloadstart=()=>{u(o)};for(const p of h){const _=window.document.createElement("source");Ce(p)||(o.crossOrigin="Anonymous"),_.src=p,o.appendChild(_)}})},c.a3=function(){return xt++},c.a4=_i,c.a5=id,c.a6=vr,c.a7=Lc,c.a8=br,c.a9=Db,c.aA=ct,c.aB=function(h,o){if(!h)return[{command:"setStyle",args:[o]}];let u=[];try{if(!_e(h.version,o.version))return[{command:"setStyle",args:[o]}];_e(h.center,o.center)||u.push({command:"setCenter",args:[o.center]}),_e(h.zoom,o.zoom)||u.push({command:"setZoom",args:[o.zoom]}),_e(h.bearing,o.bearing)||u.push({command:"setBearing",args:[o.bearing]}),_e(h.pitch,o.pitch)||u.push({command:"setPitch",args:[o.pitch]}),_e(h.sprite,o.sprite)||u.push({command:"setSprite",args:[o.sprite]}),_e(h.glyphs,o.glyphs)||u.push({command:"setGlyphs",args:[o.glyphs]}),_e(h.transition,o.transition)||u.push({command:"setTransition",args:[o.transition]}),_e(h.light,o.light)||u.push({command:"setLight",args:[o.light]}),_e(h.terrain,o.terrain)||u.push({command:"setTerrain",args:[o.terrain]}),_e(h.sky,o.sky)||u.push({command:"setSky",args:[o.sky]});const p={},_=[];(function(S,I,R,N){let q;for(q in I=I||{},S=S||{})Object.prototype.hasOwnProperty.call(S,q)&&(Object.prototype.hasOwnProperty.call(I,q)||Ne(q,R,N));for(q in I)Object.prototype.hasOwnProperty.call(I,q)&&(Object.prototype.hasOwnProperty.call(S,q)?_e(S[q],I[q])||(S[q].type==="geojson"&&I[q].type==="geojson"&&Ei(S,I,q)?Se(R,{command:"setGeoJSONSourceData",args:[q,I[q].data]}):ci(q,I,R,N)):Le(q,I,R))})(h.sources,o.sources,_,p);const x=[];h.layers&&h.layers.forEach(S=>{"source"in S&&p[S.source]?u.push({command:"removeLayer",args:[S.id]}):x.push(S)}),u=u.concat(_),function(S,I,R){I=I||[];const N=(S=S||[]).map(Ii),q=I.map(Ii),W=S.reduce(Vi,{}),Y=I.reduce(Vi,{}),it=N.slice(),at=Object.create(null);let ft,At,It,Zt,Ft;for(let Ht=0,ye=0;Ht<N.length;Ht++)ft=N[Ht],Object.prototype.hasOwnProperty.call(Y,ft)?ye++:(Se(R,{command:"removeLayer",args:[ft]}),it.splice(it.indexOf(ft,ye),1));for(let Ht=0,ye=0;Ht<q.length;Ht++)ft=q[q.length-1-Ht],it[it.length-1-Ht]!==ft&&(Object.prototype.hasOwnProperty.call(W,ft)?(Se(R,{command:"removeLayer",args:[ft]}),it.splice(it.lastIndexOf(ft,it.length-ye),1)):ye++,Zt=it[it.length-Ht],Se(R,{command:"addLayer",args:[Y[ft],Zt]}),it.splice(it.length-Ht,0,ft),at[ft]=!0);for(let Ht=0;Ht<q.length;Ht++)if(ft=q[Ht],At=W[ft],It=Y[ft],!at[ft]&&!_e(At,It))if(_e(At.source,It.source)&&_e(At["source-layer"],It["source-layer"])&&_e(At.type,It.type)){for(Ft in Ci(At.layout,It.layout,R,ft,null,"setLayoutProperty"),Ci(At.paint,It.paint,R,ft,null,"setPaintProperty"),_e(At.filter,It.filter)||Se(R,{command:"setFilter",args:[ft,It.filter]}),_e(At.minzoom,It.minzoom)&&_e(At.maxzoom,It.maxzoom)||Se(R,{command:"setLayerZoomRange",args:[ft,It.minzoom,It.maxzoom]}),At)Object.prototype.hasOwnProperty.call(At,Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?Ci(At[Ft],It[Ft],R,ft,Ft.slice(6),"setPaintProperty"):_e(At[Ft],It[Ft])||Se(R,{command:"setLayerProperty",args:[ft,Ft,It[Ft]]}));for(Ft in It)Object.prototype.hasOwnProperty.call(It,Ft)&&!Object.prototype.hasOwnProperty.call(At,Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?Ci(At[Ft],It[Ft],R,ft,Ft.slice(6),"setPaintProperty"):_e(At[Ft],It[Ft])||Se(R,{command:"setLayerProperty",args:[ft,Ft,It[Ft]]}))}else Se(R,{command:"removeLayer",args:[ft]}),Zt=it[it.lastIndexOf(ft)+1],Se(R,{command:"addLayer",args:[It,Zt]})}(x,o.layers,u)}catch(p){console.warn("Unable to compute style diff:",p),u=[{command:"setStyle",args:[o]}]}return u},c.aC=function(h){const o=[],u=h.id;return u===void 0&&o.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&o.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},c.aD=function h(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(let p=0;p<o.length;p++)if(!h(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(const p in o)if(!h(o[p],u[p]))return!1;return!0}return o===u},c.aE=qt,c.aF=zt,c.aG=class extends zn{constructor(h,o){super(h,o),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.aH=Xu,c.aI=class extends zn{constructor(h,o){super(h,o),this.current=zf}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let o=1;o<16;o++)if(h[o]!==this.current[o]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.aJ=Nf,c.aK=class extends zn{constructor(h,o){super(h,o),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.aL=class extends zn{constructor(h,o){super(h,o),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.aM=Df,c.aN=function(h,o,u,p,_,x,S){var I=1/(o-u),R=1/(p-_),N=1/(x-S);return h[0]=-2*I,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*R,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*N,h[11]=0,h[12]=(o+u)*I,h[13]=(_+p)*R,h[14]=(S+x)*N,h[15]=1,h},c.aO=Wi,c.aP=uC,c.aQ=class extends gt{},c.aR=iT,c.aS=class extends Dt{},c.aT=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.aU=jv,c.aV=Vr,c.aW=class extends Oe{},c.aX=al,c.aY=function(h,o){return h[0]===o[0]&&h[1]===o[1]&&h[2]===o[2]&&h[3]===o[3]&&h[4]===o[4]&&h[5]===o[5]&&h[6]===o[6]&&h[7]===o[7]&&h[8]===o[8]&&h[9]===o[9]&&h[10]===o[10]&&h[11]===o[11]&&h[12]===o[12]&&h[13]===o[13]&&h[14]===o[14]&&h[15]===o[15]},c.aZ=function(h,o){var u=h[0],p=h[1],_=h[2],x=h[3],S=h[4],I=h[5],R=h[6],N=h[7],q=h[8],W=h[9],Y=h[10],it=h[11],at=h[12],ft=h[13],At=h[14],It=h[15],Zt=o[0],Ft=o[1],Ht=o[2],ye=o[3],ve=o[4],Ve=o[5],ei=o[6],Ue=o[7],ke=o[8],Ke=o[9],li=o[10],Ge=o[11],we=o[12],ii=o[13],Qe=o[14],Mi=o[15];return Math.abs(u-Zt)<=Un*Math.max(1,Math.abs(u),Math.abs(Zt))&&Math.abs(p-Ft)<=Un*Math.max(1,Math.abs(p),Math.abs(Ft))&&Math.abs(_-Ht)<=Un*Math.max(1,Math.abs(_),Math.abs(Ht))&&Math.abs(x-ye)<=Un*Math.max(1,Math.abs(x),Math.abs(ye))&&Math.abs(S-ve)<=Un*Math.max(1,Math.abs(S),Math.abs(ve))&&Math.abs(I-Ve)<=Un*Math.max(1,Math.abs(I),Math.abs(Ve))&&Math.abs(R-ei)<=Un*Math.max(1,Math.abs(R),Math.abs(ei))&&Math.abs(N-Ue)<=Un*Math.max(1,Math.abs(N),Math.abs(Ue))&&Math.abs(q-ke)<=Un*Math.max(1,Math.abs(q),Math.abs(ke))&&Math.abs(W-Ke)<=Un*Math.max(1,Math.abs(W),Math.abs(Ke))&&Math.abs(Y-li)<=Un*Math.max(1,Math.abs(Y),Math.abs(li))&&Math.abs(it-Ge)<=Un*Math.max(1,Math.abs(it),Math.abs(Ge))&&Math.abs(at-we)<=Un*Math.max(1,Math.abs(at),Math.abs(we))&&Math.abs(ft-ii)<=Un*Math.max(1,Math.abs(ft),Math.abs(ii))&&Math.abs(At-Qe)<=Un*Math.max(1,Math.abs(At),Math.abs(Qe))&&Math.abs(It-Mi)<=Un*Math.max(1,Math.abs(It),Math.abs(Mi))},c.a_=function(h,o){return h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[3],h[4]=o[4],h[5]=o[5],h[6]=o[6],h[7]=o[7],h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15],h},c.aa=function(h){const o={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,p,_,x)=>{const S=_||x;return o[p]=!S||S.toLowerCase(),""}),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o},c.ab=function(h,o){const u=[];for(const p in h)p in o||u.push(p);return u},c.ac=Mt,c.ad=function(h,o,u){var p=Math.sin(u),_=Math.cos(u),x=o[0],S=o[1],I=o[2],R=o[3],N=o[4],q=o[5],W=o[6],Y=o[7];return o!==h&&(h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[0]=x*_+N*p,h[1]=S*_+q*p,h[2]=I*_+W*p,h[3]=R*_+Y*p,h[4]=N*_-x*p,h[5]=q*_-S*p,h[6]=W*_-I*p,h[7]=Y*_-R*p,h},c.ae=function(h){var o=new Yu(16);return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],o[9]=h[9],o[10]=h[10],o[11]=h[11],o[12]=h[12],o[13]=h[13],o[14]=h[14],o[15]=h[15],o},c.af=Hf,c.ag=function(h,o){let u=0,p=0;if(h.kind==="constant")p=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:_,minZoom:x,maxZoom:S}=h,I=_?Mt(yi.interpolationFactor(_,o,x,S),0,1):0;h.kind==="camera"?p=ys.number(h.minSize,h.maxSize,I):u=I}return{uSizeT:u,uSize:p}},c.ai=function(h,o,u){let{uSize:p,uSizeT:_}=o,{lowerSize:x,upperSize:S}=u;return h.kind==="source"?x/Yl:h.kind==="composite"?ys.number(x/Yl,S/Yl,_):p},c.aj=y0,c.ak=function(h,o,u,p){const _=o.y-h.y,x=o.x-h.x,S=p.y-u.y,I=p.x-u.x,R=S*x-I*_;if(R===0)return null;const N=(I*(h.y-u.y)-S*(h.x-u.x))/R;return new T(h.x+N*x,h.y+N*_)},c.al=Gb,c.am=Uf,c.an=Ym,c.ao=Fs,c.aq=m0,c.ar=function(h,o){var u=o[0],p=o[1],_=o[2],x=o[3],S=o[4],I=o[5],R=o[6],N=o[7],q=o[8],W=o[9],Y=o[10],it=o[11],at=o[12],ft=o[13],At=o[14],It=o[15],Zt=u*I-p*S,Ft=u*R-_*S,Ht=u*N-x*S,ye=p*R-_*I,ve=p*N-x*I,Ve=_*N-x*R,ei=q*ft-W*at,Ue=q*At-Y*at,ke=q*It-it*at,Ke=W*At-Y*ft,li=W*It-it*ft,Ge=Y*It-it*At,we=Zt*Ge-Ft*li+Ht*Ke+ye*ke-ve*Ue+Ve*ei;return we?(h[0]=(I*Ge-R*li+N*Ke)*(we=1/we),h[1]=(_*li-p*Ge-x*Ke)*we,h[2]=(ft*Ve-At*ve+It*ye)*we,h[3]=(Y*ve-W*Ve-it*ye)*we,h[4]=(R*ke-S*Ge-N*Ue)*we,h[5]=(u*Ge-_*ke+x*Ue)*we,h[6]=(At*Ht-at*Ve-It*Ft)*we,h[7]=(q*Ve-Y*Ht+it*Ft)*we,h[8]=(S*li-I*ke+N*ei)*we,h[9]=(p*ke-u*li-x*ei)*we,h[10]=(at*ve-ft*Ht+It*Zt)*we,h[11]=(W*Ht-q*ve-it*Zt)*we,h[12]=(I*Ue-S*Ke-R*ei)*we,h[13]=(u*Ke-p*Ue+_*ei)*we,h[14]=(ft*Ft-at*ye-At*Zt)*we,h[15]=(q*ye-W*Ft+Y*Zt)*we,h):null},c.as=E0,c.at=g0,c.au=C0,c.av=function(){const h={},o=ot.$version;for(const u in ot.$root){const p=ot.$root[u];if(p.required){let _=null;_=u==="version"?o:p.type==="array"?[]:{},_!=null&&(h[u]=_)}}return h},c.aw=Wu,c.ax=ee,c.ay=function(h){h=h.slice();const o=Object.create(null);for(let u=0;u<h.length;u++)o[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=ri(h[u],o[h[u].ref]));return h},c.az=function(h){if(h.type==="custom")return new PT(h);switch(h.type){case"background":return new ET(h);case"circle":return new dC(h);case"fill":return new IC(h);case"fill-extrusion":return new qC(h);case"heatmap":return new fC(h);case"hillshade":return new mC(h);case"line":return new KC(h);case"raster":return new TT(h);case"symbol":return new eg(h)}},c.b=le,c.b0=function(h,o){return h[0]*o[0]+h[1]*o[1]+h[2]*o[2]+h[3]*o[3]},c.b1=Nt,c.b2=Ob,c.b3=Rb,c.b4=function(h,o,u,p,_){var x,S=1/Math.tan(o/2);return h[0]=S/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=S,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,_!=null&&_!==1/0?(h[10]=(_+p)*(x=1/(p-_)),h[14]=2*_*p*x):(h[10]=-1,h[14]=-2*p),h},c.b5=function(h,o,u){var p=Math.sin(u),_=Math.cos(u),x=o[4],S=o[5],I=o[6],R=o[7],N=o[8],q=o[9],W=o[10],Y=o[11];return o!==h&&(h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[3],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[4]=x*_+N*p,h[5]=S*_+q*p,h[6]=I*_+W*p,h[7]=R*_+Y*p,h[8]=N*_-x*p,h[9]=q*_-S*p,h[10]=W*_-I*p,h[11]=Y*_-R*p,h},c.b6=ht,c.b7=_t,c.b8=function(h){return h*Math.PI/180},c.b9=function(h,o){return h[0]=o[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=o[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=o[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.bA=oa,c.ba=class extends z{},c.bb=w0,c.bc=zT,c.be=$t,c.bf=function(h,o){Lt.REGISTERED_PROTOCOLS[h]=o},c.bg=function(h){delete Lt.REGISTERED_PROTOCOLS[h]},c.bh=function(h,o){const u={};for(let _=0;_<h.length;_++){const x=o&&o[h[_].id]||sh(h[_]);o&&(o[h[_].id]=x);let S=u[x];S||(S=u[x]=[]),S.push(h[_])}const p=[];for(const _ in u)p.push(u[_]);return p},c.bi=Je,c.bj=Nb,c.bk=zb,c.bl=mb,c.bm=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=ts/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const o=h.bucket.layers[0],u=o.layout,p=o._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new br(h.bucket.zoom+1),h.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new br(h.bucket.zoom+1),h.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new br(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:q}=h.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new br(N),h.canonical),p["text-size"].possiblyEvaluate(new br(q),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:q}=h.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new br(N),h.canonical),p["icon-size"].possiblyEvaluate(new br(q),h.canonical)]}const x=u.get("text-line-height")*Fs,S=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",I=u.get("text-keep-upright"),R=u.get("text-size");for(const N of h.bucket.features){const q=u.get("text-font").evaluate(N,{},h.canonical).join(","),W=R.evaluate(N,{},h.canonical),Y=_.layoutTextSize.evaluate(N,{},h.canonical),it=_.layoutIconSize.evaluate(N,{},h.canonical),at={horizontal:{},vertical:void 0},ft=N.text;let At,It=[0,0];if(ft){const Ht=ft.toString(),ye=u.get("text-letter-spacing").evaluate(N,{},h.canonical)*Fs,ve=bn(Ht)?ye:0,Ve=u.get("text-anchor").evaluate(N,{},h.canonical),ei=Yb(o,N,h.canonical);if(!ei){const Ge=u.get("text-radial-offset").evaluate(N,{},h.canonical);It=Ge?$b(Ve,[Ge*Fs,S0]):u.get("text-offset").evaluate(N,{},h.canonical).map(we=>we*Fs)}let Ue=S?"center":u.get("text-justify").evaluate(N,{},h.canonical);const ke=u.get("symbol-placement"),Ke=ke==="point"?u.get("text-max-width").evaluate(N,{},h.canonical)*Fs:0,li=()=>{h.bucket.allowVerticalPlacement&&Lo(Ht)&&(at.vertical=Kf(ft,h.glyphMap,h.glyphPositions,h.imagePositions,q,Ke,x,Ve,"left",ve,It,c.ah.vertical,!0,ke,Y,W))};if(!S&&ei){const Ge=new Set;if(Ue==="auto")for(let ii=0;ii<ei.values.length;ii+=2)Ge.add(E0(ei.values[ii]));else Ge.add(Ue);let we=!1;for(const ii of Ge)if(!at.horizontal[ii])if(we)at.horizontal[ii]=at.horizontal[0];else{const Qe=Kf(ft,h.glyphMap,h.glyphPositions,h.imagePositions,q,Ke,x,"center",ii,ve,It,c.ah.horizontal,!1,ke,Y,W);Qe&&(at.horizontal[ii]=Qe,we=Qe.positionedLines.length===1)}li()}else{Ue==="auto"&&(Ue=E0(Ve));const Ge=Kf(ft,h.glyphMap,h.glyphPositions,h.imagePositions,q,Ke,x,Ve,Ue,ve,It,c.ah.horizontal,!1,ke,Y,W);Ge&&(at.horizontal[Ue]=Ge),li(),Lo(Ht)&&S&&I&&(at.vertical=Kf(ft,h.glyphMap,h.glyphPositions,h.imagePositions,q,Ke,x,Ve,Ue,ve,It,c.ah.vertical,!1,ke,Y,W))}}let Zt=!1;if(N.icon&&N.icon.name){const Ht=h.imageMap[N.icon.name];Ht&&(At=bT(h.imagePositions[N.icon.name],u.get("icon-offset").evaluate(N,{},h.canonical),u.get("icon-anchor").evaluate(N,{},h.canonical)),Zt=!!Ht.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=Zt:h.bucket.sdfIcons!==Zt&&Bt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ht.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Ft=Qb(at.horizontal)||at.vertical;h.bucket.iconsInText=!!Ft&&Ft.iconsInText,(Ft||At)&&NT(h.bucket,N,at,At,h.imageMap,_,Y,it,It,Zt,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.bn=c0,c.bo=o0,c.bp=l0,c.bq=xh,c.br=u0,c.bs=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.bt=function(h,o,u,p,_){return l(this,void 0,void 0,function*(){if($())try{return yield fe(h,o,u,p,_)}catch{}return function(x,S,I,R,N){const q=x.width,W=x.height;de&&Me||(de=new OffscreenCanvas(q,W),Me=de.getContext("2d",{willReadFrequently:!0})),de.width=q,de.height=W,Me.drawImage(x,0,0,q,W);const Y=Me.getImageData(S,I,R,N);return Me.clearRect(0,0,q,W),Y.data}(h,o,u,p,_)})},c.bu=Fb,c.bv=f,c.bw=y,c.bx=ab,c.by=Fn,c.bz=function(h){return h.message===nt},c.c=Et,c.d=h=>l(void 0,void 0,void 0,function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(o)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=Rt,c.f=h=>new Promise((o,u)=>{const p=new Image;p.onload=()=>{o(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=Qt})},p.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(h)],{type:"image/png"});p.src=h.byteLength?URL.createObjectURL(_):Qt}),c.g=Gt,c.h=(h,o)=>Kt(Rt(h,{type:"json"}),o),c.i=ne,c.j=Ze,c.k=Fe,c.l=(h,o)=>Kt(Rt(h,{type:"arrayBuffer"}),o),c.m=Kt,c.n=function(h){return new u0(h).readFields(fT,[])},c.o=up,c.p=gb,c.q=v,c.r=Vu,c.s=Ce,c.t=Hu,c.u=ze,c.v=ot,c.w=Bt,c.x=ra,c.y=function(h){let[o,u,p]=h;return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},c.z=ys}),s("worker",["./shared"],function(c){class l{constructor(K){this.keyCache={},K&&this.replace(K)}replace(K){this._layerConfigs={},this._layers={},this.update(K,[])}update(K,Q){for(const Ct of K){this._layerConfigs[Ct.id]=Ct;const kt=this._layers[Ct.id]=c.az(Ct);kt._featureFilter=c.a6(kt.filter),this.keyCache[Ct.id]&&delete this.keyCache[Ct.id]}for(const Ct of Q)delete this.keyCache[Ct],delete this._layerConfigs[Ct],delete this._layers[Ct];this.familiesBySource={};const rt=c.bh(Object.values(this._layerConfigs),this.keyCache);for(const Ct of rt){const kt=Ct.map(ae=>this._layers[ae.id]),Ut=kt[0];if(Ut.visibility==="none")continue;const Vt=Ut.source||"";let St=this.familiesBySource[Vt];St||(St=this.familiesBySource[Vt]={});const Jt=Ut.sourceLayer||"_geojsonTileLayer";let ge=St[Jt];ge||(ge=St[Jt]=[]),ge.push(kt)}}}class f{constructor(K){const Q={},rt=[];for(const Vt in K){const St=K[Vt],Jt=Q[Vt]={};for(const ge in St){const ae=St[+ge];if(!ae||ae.bitmap.width===0||ae.bitmap.height===0)continue;const se={x:0,y:0,w:ae.bitmap.width+2,h:ae.bitmap.height+2};rt.push(se),Jt[ge]={rect:se,metrics:ae.metrics}}}const{w:Ct,h:kt}=c.p(rt),Ut=new c.o({width:Ct||1,height:kt||1});for(const Vt in K){const St=K[Vt];for(const Jt in St){const ge=St[+Jt];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const ae=Q[Vt][Jt].rect;c.o.copy(ge.bitmap,Ut,{x:0,y:0},{x:ae.x+1,y:ae.y+1},ge.bitmap)}}this.image=Ut,this.positions=Q}}c.bi("GlyphAtlas",f);class y{constructor(K){this.tileID=new c.Q(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[]}parse(K,Q,rt,Ct){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new c.a4;const kt=new c.bj(Object.keys(K.layers).sort()),Ut=new c.bk(this.tileID,this.promoteId);Ut.bucketLayerIDs=[];const Vt={},St={featureIndex:Ut,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:rt},Jt=Q.familiesBySource[this.source];for(const pi in Jt){const Fi=K.layers[pi];if(!Fi)continue;Fi.version===1&&c.w(`Vector tile source "${this.source}" layer "${pi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const sr=kt.encode(pi),Ar=[];for(let Qr=0;Qr<Fi.length;Qr++){const nr=Fi.feature(Qr),pn=Ut.getId(nr,pi);Ar.push({feature:nr,id:pn,index:Qr,sourceLayerIndex:sr})}for(const Qr of Jt[pi]){const nr=Qr[0];nr.source!==this.source&&c.w(`layer.source = ${nr.source} does not equal this.source = ${this.source}`),nr.minzoom&&this.zoom<Math.floor(nr.minzoom)||nr.maxzoom&&this.zoom>=nr.maxzoom||nr.visibility!=="none"&&(A(Qr,this.zoom,rt),(Vt[nr.id]=nr.createBucket({index:Ut.bucketLayerIDs.length,layers:Qr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sr,sourceID:this.source})).populate(Ar,St,this.tileID.canonical),Ut.bucketLayerIDs.push(Qr.map(pn=>pn.id)))}}const ge=c.aE(St.glyphDependencies,pi=>Object.keys(pi).map(Number));this.inFlightDependencies.forEach(pi=>pi==null?void 0:pi.abort()),this.inFlightDependencies=[];let ae=Promise.resolve({});if(Object.keys(ge).length){const pi=new AbortController;this.inFlightDependencies.push(pi),ae=Ct.sendAsync({type:"GG",data:{stacks:ge,source:this.source,tileID:this.tileID,type:"glyphs"}},pi)}const se=Object.keys(St.iconDependencies);let qe=Promise.resolve({});if(se.length){const pi=new AbortController;this.inFlightDependencies.push(pi),qe=Ct.sendAsync({type:"GI",data:{icons:se,source:this.source,tileID:this.tileID,type:"icons"}},pi)}const $e=Object.keys(St.patternDependencies);let wi=Promise.resolve({});if($e.length){const pi=new AbortController;this.inFlightDependencies.push(pi),wi=Ct.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"patterns"}},pi)}const[si,Si,ki]=yield Promise.all([ae,qe,wi]),qi=new f(si),tr=new c.bl(Si,ki);for(const pi in Vt){const Fi=Vt[pi];Fi instanceof c.a5?(A(Fi.layers,this.zoom,rt),c.bm({bucket:Fi,glyphMap:si,glyphPositions:qi.positions,imageMap:Si,imagePositions:tr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Fi.hasPattern&&(Fi instanceof c.bn||Fi instanceof c.bo||Fi instanceof c.bp)&&(A(Fi.layers,this.zoom,rt),Fi.addFeatures(St,this.tileID.canonical,tr.patternPositions))}return this.status="done",{buckets:Object.values(Vt).filter(pi=>!pi.isEmpty()),featureIndex:Ut,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qi.image,imageAtlas:tr,glyphMap:this.returnDependencies?si:null,iconMap:this.returnDependencies?Si:null,glyphPositions:this.returnDependencies?qi.positions:null}})}}function A(vt,K,Q){const rt=new c.a8(K);for(const Ct of vt)Ct.recalculate(rt,Q)}class T{constructor(K,Q,rt){this.actor=K,this.layerIndex=Q,this.availableImages=rt,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(K,Q){return c._(this,void 0,void 0,function*(){const rt=yield c.l(K.request,Q);try{return{vectorTile:new c.bq.VectorTile(new c.br(rt.data)),rawData:rt.data,cacheControl:rt.cacheControl,expires:rt.expires}}catch(Ct){const kt=new Uint8Array(rt.data);let Ut=`Unable to parse the tile at ${K.request.url}, `;throw Ut+=kt[0]===31&&kt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ct.messge}`,new Error(Ut)}})}loadTile(K){return c._(this,void 0,void 0,function*(){const Q=K.uid,rt=!!(K&&K.request&&K.request.collectResourceTiming)&&new c.bs(K.request),Ct=new y(K);this.loading[Q]=Ct;const kt=new AbortController;Ct.abort=kt;try{const Ut=yield this.loadVectorTile(K,kt);if(delete this.loading[Q],!Ut)return null;const Vt=Ut.rawData,St={};Ut.expires&&(St.expires=Ut.expires),Ut.cacheControl&&(St.cacheControl=Ut.cacheControl);const Jt={};if(rt){const ae=rt.finish();ae&&(Jt.resourceTiming=JSON.parse(JSON.stringify(ae)))}Ct.vectorTile=Ut.vectorTile;const ge=Ct.parse(Ut.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Q]=Ct,this.fetching[Q]={rawTileData:Vt,cacheControl:St,resourceTiming:Jt};try{const ae=yield ge;return c.e({rawTileData:Vt.slice(0)},ae,St,Jt)}finally{delete this.fetching[Q]}}catch(Ut){throw delete this.loading[Q],Ct.status="done",this.loaded[Q]=Ct,Ut}})}reloadTile(K){return c._(this,void 0,void 0,function*(){const Q=K.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const rt=this.loaded[Q];if(rt.showCollisionBoxes=K.showCollisionBoxes,rt.status==="parsing"){const Ct=yield rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor);let kt;if(this.fetching[Q]){const{rawTileData:Ut,cacheControl:Vt,resourceTiming:St}=this.fetching[Q];delete this.fetching[Q],kt=c.e({rawTileData:Ut.slice(0)},Ct,Vt,St)}else kt=Ct;return kt}if(rt.status==="done"&&rt.vectorTile)return rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(K){return c._(this,void 0,void 0,function*(){const Q=this.loading,rt=K.uid;Q&&Q[rt]&&Q[rt].abort&&(Q[rt].abort.abort(),delete Q[rt])})}removeTile(K){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]})}}class P{constructor(){this.loaded={}}loadTile(K){return c._(this,void 0,void 0,function*(){const{uid:Q,encoding:rt,rawImageData:Ct,redFactor:kt,greenFactor:Ut,blueFactor:Vt,baseShift:St}=K,Jt=Ct.width+2,ge=Ct.height+2,ae=c.b(Ct)?new c.R({width:Jt,height:ge},yield c.bt(Ct,-1,-1,Jt,ge)):Ct,se=new c.bu(Q,ae,rt,kt,Ut,Vt,St);return this.loaded=this.loaded||{},this.loaded[Q]=se,se})}removeTile(K){const Q=this.loaded,rt=K.uid;Q&&Q[rt]&&delete Q[rt]}}function L(vt,K){if(vt.length!==0){D(vt[0],K);for(var Q=1;Q<vt.length;Q++)D(vt[Q],!K)}}function D(vt,K){for(var Q=0,rt=0,Ct=0,kt=vt.length,Ut=kt-1;Ct<kt;Ut=Ct++){var Vt=(vt[Ct][0]-vt[Ut][0])*(vt[Ut][1]+vt[Ct][1]),St=Q+Vt;rt+=Math.abs(Q)>=Math.abs(Vt)?Q-St+Vt:Vt-St+Q,Q=St}Q+rt>=0!=!!K&&vt.reverse()}var j=c.bv(function vt(K,Q){var rt,Ct=K&&K.type;if(Ct==="FeatureCollection")for(rt=0;rt<K.features.length;rt++)vt(K.features[rt],Q);else if(Ct==="GeometryCollection")for(rt=0;rt<K.geometries.length;rt++)vt(K.geometries[rt],Q);else if(Ct==="Feature")vt(K.geometry,Q);else if(Ct==="Polygon")L(K.coordinates,Q);else if(Ct==="MultiPolygon")for(rt=0;rt<K.coordinates.length;rt++)L(K.coordinates[rt],Q);return K});const X=c.bq.VectorTileFeature.prototype.toGeoJSON;var Z={exports:{}},$=c.bw,ht=c.bq.VectorTileFeature,_t=Mt;function Mt(vt,K){this.options=K||{},this.features=vt,this.length=vt.length}function Nt(vt,K){this.id=typeof vt.id=="number"?vt.id:void 0,this.type=vt.type,this.rawGeometry=vt.type===1?[vt.geometry]:vt.geometry,this.properties=vt.tags,this.extent=K||4096}Mt.prototype.feature=function(vt){return new Nt(this.features[vt],this.options.extent)},Nt.prototype.loadGeometry=function(){var vt=this.rawGeometry;this.geometry=[];for(var K=0;K<vt.length;K++){for(var Q=vt[K],rt=[],Ct=0;Ct<Q.length;Ct++)rt.push(new $(Q[Ct][0],Q[Ct][1]));this.geometry.push(rt)}return this.geometry},Nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var vt=this.geometry,K=1/0,Q=-1/0,rt=1/0,Ct=-1/0,kt=0;kt<vt.length;kt++)for(var Ut=vt[kt],Vt=0;Vt<Ut.length;Vt++){var St=Ut[Vt];K=Math.min(K,St.x),Q=Math.max(Q,St.x),rt=Math.min(rt,St.y),Ct=Math.max(Ct,St.y)}return[K,rt,Q,Ct]},Nt.prototype.toGeoJSON=ht.prototype.toGeoJSON;var Rt=c.bx,xt=_t;function qt(vt){var K=new Rt;return function(Q,rt){for(var Ct in Q.layers)rt.writeMessage(3,zt,Q.layers[Ct])}(vt,K),K.finish()}function zt(vt,K){var Q;K.writeVarintField(15,vt.version||1),K.writeStringField(1,vt.name||""),K.writeVarintField(5,vt.extent||4096);var rt={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<vt.length;Q++)rt.feature=vt.feature(Q),K.writeMessage(2,ct,rt);var Ct=rt.keys;for(Q=0;Q<Ct.length;Q++)K.writeStringField(3,Ct[Q]);var kt=rt.values;for(Q=0;Q<kt.length;Q++)K.writeMessage(4,oe,kt[Q])}function ct(vt,K){var Q=vt.feature;Q.id!==void 0&&K.writeVarintField(1,Q.id),K.writeMessage(2,pt,vt),K.writeVarintField(3,Q.type),K.writeMessage(4,ne,Q)}function pt(vt,K){var Q=vt.feature,rt=vt.keys,Ct=vt.values,kt=vt.keycache,Ut=vt.valuecache;for(var Vt in Q.properties){var St=Q.properties[Vt],Jt=kt[Vt];if(St!==null){Jt===void 0&&(rt.push(Vt),kt[Vt]=Jt=rt.length-1),K.writeVarint(Jt);var ge=typeof St;ge!=="string"&&ge!=="boolean"&&ge!=="number"&&(St=JSON.stringify(St));var ae=ge+":"+St,se=Ut[ae];se===void 0&&(Ct.push(St),Ut[ae]=se=Ct.length-1),K.writeVarint(se)}}}function Bt(vt,K){return(K<<3)+(7&vt)}function bt(vt){return vt<<1^vt>>31}function ne(vt,K){for(var Q=vt.loadGeometry(),rt=vt.type,Ct=0,kt=0,Ut=Q.length,Vt=0;Vt<Ut;Vt++){var St=Q[Vt],Jt=1;rt===1&&(Jt=St.length),K.writeVarint(Bt(1,Jt));for(var ge=rt===3?St.length-1:St.length,ae=0;ae<ge;ae++){ae===1&&rt!==1&&K.writeVarint(Bt(2,ge-1));var se=St[ae].x-Ct,qe=St[ae].y-kt;K.writeVarint(bt(se)),K.writeVarint(bt(qe)),Ct+=se,kt+=qe}rt===3&&K.writeVarint(Bt(7,1))}}function oe(vt,K){var Q=typeof vt;Q==="string"?K.writeStringField(1,vt):Q==="boolean"?K.writeBooleanField(7,vt):Q==="number"&&(vt%1!=0?K.writeDoubleField(3,vt):vt<0?K.writeSVarintField(6,vt):K.writeVarintField(5,vt))}Z.exports=qt,Z.exports.fromVectorTileJs=qt,Z.exports.fromGeojsonVt=function(vt,K){K=K||{};var Q={};for(var rt in vt)Q[rt]=new xt(vt[rt].features,K),Q[rt].name=rt,Q[rt].version=K.version,Q[rt].extent=K.extent;return qt({layers:Q})},Z.exports.GeoJSONWrapper=xt;var le=c.bv(Z.exports);const Qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vt=>vt},fe=Math.fround||(de=new Float32Array(1),vt=>(de[0]=+vt,de[0]));var de;const Me=3,nt=5,Et=6;class Lt{constructor(K){this.options=Object.assign(Object.create(Qt),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:Q,minZoom:rt,maxZoom:Ct}=this.options;Q&&console.time("total time");const kt=`prepare ${K.length} points`;Q&&console.time(kt),this.points=K;const Ut=[];for(let St=0;St<K.length;St++){const Jt=K[St];if(!Jt.geometry)continue;const[ge,ae]=Jt.geometry.coordinates,se=fe($t(ge)),qe=fe(ee(ae));Ut.push(se,qe,1/0,St,-1,1),this.options.reduce&&Ut.push(0)}let Vt=this.trees[Ct+1]=this._createTree(Ut);Q&&console.timeEnd(kt);for(let St=Ct;St>=rt;St--){const Jt=+Date.now();Vt=this.trees[St]=this._createTree(this._cluster(Vt,St)),Q&&console.log("z%d: %d clusters in %dms",St,Vt.numItems,+Date.now()-Jt)}return Q&&console.timeEnd("total time"),this}getClusters(K,Q){let rt=((K[0]+180)%360+360)%360-180;const Ct=Math.max(-90,Math.min(90,K[1]));let kt=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Ut=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)rt=-180,kt=180;else if(rt>kt){const ae=this.getClusters([rt,Ct,180,Ut],Q),se=this.getClusters([-180,Ct,kt,Ut],Q);return ae.concat(se)}const Vt=this.trees[this._limitZoom(Q)],St=Vt.range($t(rt),ee(Ut),$t(kt),ee(Ct)),Jt=Vt.data,ge=[];for(const ae of St){const se=this.stride*ae;ge.push(Jt[se+nt]>1?Gt(Jt,se,this.clusterProps):this.points[Jt[se+Me]])}return ge}getChildren(K){const Q=this._getOriginId(K),rt=this._getOriginZoom(K),Ct="No cluster with the specified id.",kt=this.trees[rt];if(!kt)throw new Error(Ct);const Ut=kt.data;if(Q*this.stride>=Ut.length)throw new Error(Ct);const Vt=this.options.radius/(this.options.extent*Math.pow(2,rt-1)),St=kt.within(Ut[Q*this.stride],Ut[Q*this.stride+1],Vt),Jt=[];for(const ge of St){const ae=ge*this.stride;Ut[ae+4]===K&&Jt.push(Ut[ae+nt]>1?Gt(Ut,ae,this.clusterProps):this.points[Ut[ae+Me]])}if(Jt.length===0)throw new Error(Ct);return Jt}getLeaves(K,Q,rt){const Ct=[];return this._appendLeaves(Ct,K,Q=Q||10,rt=rt||0,0),Ct}getTile(K,Q,rt){const Ct=this.trees[this._limitZoom(K)],kt=Math.pow(2,K),{extent:Ut,radius:Vt}=this.options,St=Vt/Ut,Jt=(rt-St)/kt,ge=(rt+1+St)/kt,ae={features:[]};return this._addTileFeatures(Ct.range((Q-St)/kt,Jt,(Q+1+St)/kt,ge),Ct.data,Q,rt,kt,ae),Q===0&&this._addTileFeatures(Ct.range(1-St/kt,Jt,1,ge),Ct.data,kt,rt,kt,ae),Q===kt-1&&this._addTileFeatures(Ct.range(0,Jt,St/kt,ge),Ct.data,-1,rt,kt,ae),ae.features.length?ae:null}getClusterExpansionZoom(K){let Q=this._getOriginZoom(K)-1;for(;Q<=this.options.maxZoom;){const rt=this.getChildren(K);if(Q++,rt.length!==1)break;K=rt[0].properties.cluster_id}return Q}_appendLeaves(K,Q,rt,Ct,kt){const Ut=this.getChildren(Q);for(const Vt of Ut){const St=Vt.properties;if(St&&St.cluster?kt+St.point_count<=Ct?kt+=St.point_count:kt=this._appendLeaves(K,St.cluster_id,rt,Ct,kt):kt<Ct?kt++:K.push(Vt),K.length===rt)break}return kt}_createTree(K){const Q=new c.au(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let rt=0;rt<K.length;rt+=this.stride)Q.add(K[rt],K[rt+1]);return Q.finish(),Q.data=K,Q}_addTileFeatures(K,Q,rt,Ct,kt,Ut){for(const Vt of K){const St=Vt*this.stride,Jt=Q[St+nt]>1;let ge,ae,se;if(Jt)ge=Wt(Q,St,this.clusterProps),ae=Q[St],se=Q[St+1];else{const wi=this.points[Q[St+Me]];ge=wi.properties;const[si,Si]=wi.geometry.coordinates;ae=$t(si),se=ee(Si)}const qe={type:1,geometry:[[Math.round(this.options.extent*(ae*kt-rt)),Math.round(this.options.extent*(se*kt-Ct))]],tags:ge};let $e;$e=Jt||this.options.generateId?Q[St+Me]:this.points[Q[St+Me]].id,$e!==void 0&&(qe.id=$e),Ut.features.push(qe)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,Q){const{radius:rt,extent:Ct,reduce:kt,minPoints:Ut}=this.options,Vt=rt/(Ct*Math.pow(2,Q)),St=K.data,Jt=[],ge=this.stride;for(let ae=0;ae<St.length;ae+=ge){if(St[ae+2]<=Q)continue;St[ae+2]=Q;const se=St[ae],qe=St[ae+1],$e=K.within(St[ae],St[ae+1],Vt),wi=St[ae+nt];let si=wi;for(const Si of $e){const ki=Si*ge;St[ki+2]>Q&&(si+=St[ki+nt])}if(si>wi&&si>=Ut){let Si,ki=se*wi,qi=qe*wi,tr=-1;const pi=((ae/ge|0)<<5)+(Q+1)+this.points.length;for(const Fi of $e){const sr=Fi*ge;if(St[sr+2]<=Q)continue;St[sr+2]=Q;const Ar=St[sr+nt];ki+=St[sr]*Ar,qi+=St[sr+1]*Ar,St[sr+4]=pi,kt&&(Si||(Si=this._map(St,ae,!0),tr=this.clusterProps.length,this.clusterProps.push(Si)),kt(Si,this._map(St,sr)))}St[ae+4]=pi,Jt.push(ki/si,qi/si,1/0,pi,-1,si),kt&&Jt.push(tr)}else{for(let Si=0;Si<ge;Si++)Jt.push(St[ae+Si]);if(si>1)for(const Si of $e){const ki=Si*ge;if(!(St[ki+2]<=Q)){St[ki+2]=Q;for(let qi=0;qi<ge;qi++)Jt.push(St[ki+qi])}}}}return Jt}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,Q,rt){if(K[Q+nt]>1){const Ut=this.clusterProps[K[Q+Et]];return rt?Object.assign({},Ut):Ut}const Ct=this.points[K[Q+Me]].properties,kt=this.options.map(Ct);return rt&&kt===Ct?Object.assign({},kt):kt}}function Gt(vt,K,Q){return{type:"Feature",id:vt[K+Me],properties:Wt(vt,K,Q),geometry:{type:"Point",coordinates:[(rt=vt[K],360*(rt-.5)),Kt(vt[K+1])]}};var rt}function Wt(vt,K,Q){const rt=vt[K+nt],Ct=rt>=1e4?`${Math.round(rt/1e3)}k`:rt>=1e3?Math.round(rt/100)/10+"k":rt,kt=vt[K+Et],Ut=kt===-1?{}:Object.assign({},Q[kt]);return Object.assign(Ut,{cluster:!0,cluster_id:vt[K+Me],point_count:rt,point_count_abbreviated:Ct})}function $t(vt){return vt/360+.5}function ee(vt){const K=Math.sin(vt*Math.PI/180),Q=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Q<0?0:Q>1?1:Q}function Kt(vt){const K=(180-360*vt)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function Ce(vt,K,Q,rt){for(var Ct,kt=rt,Ut=Q-K>>1,Vt=Q-K,St=vt[K],Jt=vt[K+1],ge=vt[Q],ae=vt[Q+1],se=K+3;se<Q;se+=3){var qe=Ie(vt[se],vt[se+1],St,Jt,ge,ae);if(qe>kt)Ct=se,kt=qe;else if(qe===kt){var $e=Math.abs(se-Ut);$e<Vt&&(Ct=se,Vt=$e)}}kt>rt&&(Ct-K>3&&Ce(vt,K,Ct,rt),vt[Ct+2]=kt,Q-Ct>3&&Ce(vt,Ct,Q,rt))}function Ie(vt,K,Q,rt,Ct,kt){var Ut=Ct-Q,Vt=kt-rt;if(Ut!==0||Vt!==0){var St=((vt-Q)*Ut+(K-rt)*Vt)/(Ut*Ut+Vt*Vt);St>1?(Q=Ct,rt=kt):St>0&&(Q+=Ut*St,rt+=Vt*St)}return(Ut=vt-Q)*Ut+(Vt=K-rt)*Vt}function Re(vt,K,Q,rt){var Ct={id:vt===void 0?null:vt,type:K,geometry:Q,tags:rt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(kt){var Ut=kt.geometry,Vt=kt.type;if(Vt==="Point"||Vt==="MultiPoint"||Vt==="LineString")Fe(kt,Ut);else if(Vt==="Polygon"||Vt==="MultiLineString")for(var St=0;St<Ut.length;St++)Fe(kt,Ut[St]);else if(Vt==="MultiPolygon")for(St=0;St<Ut.length;St++)for(var Jt=0;Jt<Ut[St].length;Jt++)Fe(kt,Ut[St][Jt])}(Ct),Ct}function Fe(vt,K){for(var Q=0;Q<K.length;Q+=3)vt.minX=Math.min(vt.minX,K[Q]),vt.minY=Math.min(vt.minY,K[Q+1]),vt.maxX=Math.max(vt.maxX,K[Q]),vt.maxY=Math.max(vt.maxY,K[Q+1])}function Ze(vt,K,Q,rt){if(K.geometry){var Ct=K.geometry.coordinates,kt=K.geometry.type,Ut=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),Vt=[],St=K.id;if(Q.promoteId?St=K.properties[Q.promoteId]:Q.generateId&&(St=rt||0),kt==="Point")he(Ct,Vt);else if(kt==="MultiPoint")for(var Jt=0;Jt<Ct.length;Jt++)he(Ct[Jt],Vt);else if(kt==="LineString")ot(Ct,Vt,Ut,!1);else if(kt==="MultiLineString"){if(Q.lineMetrics){for(Jt=0;Jt<Ct.length;Jt++)ot(Ct[Jt],Vt=[],Ut,!1),vt.push(Re(St,"LineString",Vt,K.properties));return}mi(Ct,Vt,Ut,!1)}else if(kt==="Polygon")mi(Ct,Vt,Ut,!0);else{if(kt!=="MultiPolygon"){if(kt==="GeometryCollection"){for(Jt=0;Jt<K.geometry.geometries.length;Jt++)Ze(vt,{id:St,geometry:K.geometry.geometries[Jt],properties:K.properties},Q,rt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Jt=0;Jt<Ct.length;Jt++){var ge=[];mi(Ct[Jt],ge,Ut,!0),Vt.push(ge)}}vt.push(Re(St,kt,Vt,K.properties))}}function he(vt,K){K.push(ri(vt[0])),K.push(_e(vt[1])),K.push(0)}function ot(vt,K,Q,rt){for(var Ct,kt,Ut=0,Vt=0;Vt<vt.length;Vt++){var St=ri(vt[Vt][0]),Jt=_e(vt[Vt][1]);K.push(St),K.push(Jt),K.push(0),Vt>0&&(Ut+=rt?(Ct*Jt-St*kt)/2:Math.sqrt(Math.pow(St-Ct,2)+Math.pow(Jt-kt,2))),Ct=St,kt=Jt}var ge=K.length-3;K[2]=1,Ce(K,0,ge,Q),K[ge+2]=1,K.size=Math.abs(Ut),K.start=0,K.end=K.size}function mi(vt,K,Q,rt){for(var Ct=0;Ct<vt.length;Ct++){var kt=[];ot(vt[Ct],kt,Q,rt),K.push(kt)}}function ri(vt){return vt/360+.5}function _e(vt){var K=Math.sin(vt*Math.PI/180),Q=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Q<0?0:Q>1?1:Q}function Se(vt,K,Q,rt,Ct,kt,Ut,Vt){if(rt/=K,kt>=(Q/=K)&&Ut<rt)return vt;if(Ut<Q||kt>=rt)return null;for(var St=[],Jt=0;Jt<vt.length;Jt++){var ge=vt[Jt],ae=ge.geometry,se=ge.type,qe=Ct===0?ge.minX:ge.minY,$e=Ct===0?ge.maxX:ge.maxY;if(qe>=Q&&$e<rt)St.push(ge);else if(!($e<Q||qe>=rt)){var wi=[];if(se==="Point"||se==="MultiPoint")Le(ae,wi,Q,rt,Ct);else if(se==="LineString")Ne(ae,wi,Q,rt,Ct,!1,Vt.lineMetrics);else if(se==="MultiLineString")Ei(ae,wi,Q,rt,Ct,!1);else if(se==="Polygon")Ei(ae,wi,Q,rt,Ct,!0);else if(se==="MultiPolygon")for(var si=0;si<ae.length;si++){var Si=[];Ei(ae[si],Si,Q,rt,Ct,!0),Si.length&&wi.push(Si)}if(wi.length){if(Vt.lineMetrics&&se==="LineString"){for(si=0;si<wi.length;si++)St.push(Re(ge.id,se,wi[si],ge.tags));continue}se!=="LineString"&&se!=="MultiLineString"||(wi.length===1?(se="LineString",wi=wi[0]):se="MultiLineString"),se!=="Point"&&se!=="MultiPoint"||(se=wi.length===3?"Point":"MultiPoint"),St.push(Re(ge.id,se,wi,ge.tags))}}}return St.length?St:null}function Le(vt,K,Q,rt,Ct){for(var kt=0;kt<vt.length;kt+=3){var Ut=vt[kt+Ct];Ut>=Q&&Ut<=rt&&(K.push(vt[kt]),K.push(vt[kt+1]),K.push(vt[kt+2]))}}function Ne(vt,K,Q,rt,Ct,kt,Ut){for(var Vt,St,Jt=ci(vt),ge=Ct===0?Ii:Vi,ae=vt.start,se=0;se<vt.length-3;se+=3){var qe=vt[se],$e=vt[se+1],wi=vt[se+2],si=vt[se+3],Si=vt[se+4],ki=Ct===0?qe:$e,qi=Ct===0?si:Si,tr=!1;Ut&&(Vt=Math.sqrt(Math.pow(qe-si,2)+Math.pow($e-Si,2))),ki<Q?qi>Q&&(St=ge(Jt,qe,$e,si,Si,Q),Ut&&(Jt.start=ae+Vt*St)):ki>rt?qi<rt&&(St=ge(Jt,qe,$e,si,Si,rt),Ut&&(Jt.start=ae+Vt*St)):Ci(Jt,qe,$e,wi),qi<Q&&ki>=Q&&(St=ge(Jt,qe,$e,si,Si,Q),tr=!0),qi>rt&&ki<=rt&&(St=ge(Jt,qe,$e,si,Si,rt),tr=!0),!kt&&tr&&(Ut&&(Jt.end=ae+Vt*St),K.push(Jt),Jt=ci(vt)),Ut&&(ae+=Vt)}var pi=vt.length-3;qe=vt[pi],$e=vt[pi+1],wi=vt[pi+2],(ki=Ct===0?qe:$e)>=Q&&ki<=rt&&Ci(Jt,qe,$e,wi),pi=Jt.length-3,kt&&pi>=3&&(Jt[pi]!==Jt[0]||Jt[pi+1]!==Jt[1])&&Ci(Jt,Jt[0],Jt[1],Jt[2]),Jt.length&&K.push(Jt)}function ci(vt){var K=[];return K.size=vt.size,K.start=vt.start,K.end=vt.end,K}function Ei(vt,K,Q,rt,Ct,kt){for(var Ut=0;Ut<vt.length;Ut++)Ne(vt[Ut],K,Q,rt,Ct,kt,!1)}function Ci(vt,K,Q,rt){vt.push(K),vt.push(Q),vt.push(rt)}function Ii(vt,K,Q,rt,Ct,kt){var Ut=(kt-K)/(rt-K);return vt.push(kt),vt.push(Q+(Ct-Q)*Ut),vt.push(1),Ut}function Vi(vt,K,Q,rt,Ct,kt){var Ut=(kt-Q)/(Ct-Q);return vt.push(K+(rt-K)*Ut),vt.push(kt),vt.push(1),Ut}function be(vt,K){for(var Q=[],rt=0;rt<vt.length;rt++){var Ct,kt=vt[rt],Ut=kt.type;if(Ut==="Point"||Ut==="MultiPoint"||Ut==="LineString")Ct=ai(kt.geometry,K);else if(Ut==="MultiLineString"||Ut==="Polygon"){Ct=[];for(var Vt=0;Vt<kt.geometry.length;Vt++)Ct.push(ai(kt.geometry[Vt],K))}else if(Ut==="MultiPolygon")for(Ct=[],Vt=0;Vt<kt.geometry.length;Vt++){for(var St=[],Jt=0;Jt<kt.geometry[Vt].length;Jt++)St.push(ai(kt.geometry[Vt][Jt],K));Ct.push(St)}Q.push(Re(kt.id,Ut,Ct,kt.tags))}return Q}function ai(vt,K){var Q=[];Q.size=vt.size,vt.start!==void 0&&(Q.start=vt.start,Q.end=vt.end);for(var rt=0;rt<vt.length;rt+=3)Q.push(vt[rt]+K,vt[rt+1],vt[rt+2]);return Q}function Ai(vt,K){if(vt.transformed)return vt;var Q,rt,Ct,kt=1<<vt.z,Ut=vt.x,Vt=vt.y;for(Q=0;Q<vt.features.length;Q++){var St=vt.features[Q],Jt=St.geometry,ge=St.type;if(St.geometry=[],ge===1)for(rt=0;rt<Jt.length;rt+=2)St.geometry.push(De(Jt[rt],Jt[rt+1],K,kt,Ut,Vt));else for(rt=0;rt<Jt.length;rt++){var ae=[];for(Ct=0;Ct<Jt[rt].length;Ct+=2)ae.push(De(Jt[rt][Ct],Jt[rt][Ct+1],K,kt,Ut,Vt));St.geometry.push(ae)}}return vt.transformed=!0,vt}function De(vt,K,Q,rt,Ct,kt){return[Math.round(Q*(vt*rt-Ct)),Math.round(Q*(K*rt-kt))]}function Lr(vt,K,Q,rt,Ct){for(var kt=K===Ct.maxZoom?0:Ct.tolerance/((1<<K)*Ct.extent),Ut={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:rt,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Vt=0;Vt<vt.length;Vt++){Ut.numFeatures++,me(Ut,vt[Vt],kt,Ct);var St=vt[Vt].minX,Jt=vt[Vt].minY,ge=vt[Vt].maxX,ae=vt[Vt].maxY;St<Ut.minX&&(Ut.minX=St),Jt<Ut.minY&&(Ut.minY=Jt),ge>Ut.maxX&&(Ut.maxX=ge),ae>Ut.maxY&&(Ut.maxY=ae)}return Ut}function me(vt,K,Q,rt){var Ct=K.geometry,kt=K.type,Ut=[];if(kt==="Point"||kt==="MultiPoint")for(var Vt=0;Vt<Ct.length;Vt+=3)Ut.push(Ct[Vt]),Ut.push(Ct[Vt+1]),vt.numPoints++,vt.numSimplified++;else if(kt==="LineString")vi(Ut,Ct,vt,Q,!1,!1);else if(kt==="MultiLineString"||kt==="Polygon")for(Vt=0;Vt<Ct.length;Vt++)vi(Ut,Ct[Vt],vt,Q,kt==="Polygon",Vt===0);else if(kt==="MultiPolygon")for(var St=0;St<Ct.length;St++){var Jt=Ct[St];for(Vt=0;Vt<Jt.length;Vt++)vi(Ut,Jt[Vt],vt,Q,!0,Vt===0)}if(Ut.length){var ge=K.tags||null;if(kt==="LineString"&&rt.lineMetrics){for(var ae in ge={},K.tags)ge[ae]=K.tags[ae];ge.mapbox_clip_start=Ct.start/Ct.size,ge.mapbox_clip_end=Ct.end/Ct.size}var se={geometry:Ut,type:kt==="Polygon"||kt==="MultiPolygon"?3:kt==="LineString"||kt==="MultiLineString"?2:1,tags:ge};K.id!==null&&(se.id=K.id),vt.features.push(se)}}function vi(vt,K,Q,rt,Ct,kt){var Ut=rt*rt;if(rt>0&&K.size<(Ct?Ut:rt))Q.numPoints+=K.length/3;else{for(var Vt=[],St=0;St<K.length;St+=3)(rt===0||K[St+2]>Ut)&&(Q.numSimplified++,Vt.push(K[St]),Vt.push(K[St+1])),Q.numPoints++;Ct&&function(Jt,ge){for(var ae=0,se=0,qe=Jt.length,$e=qe-2;se<qe;$e=se,se+=2)ae+=(Jt[se]-Jt[$e])*(Jt[se+1]+Jt[$e+1]);if(ae>0===ge)for(se=0,qe=Jt.length;se<qe/2;se+=2){var wi=Jt[se],si=Jt[se+1];Jt[se]=Jt[qe-2-se],Jt[se+1]=Jt[qe-1-se],Jt[qe-2-se]=wi,Jt[qe-1-se]=si}}(Vt,kt),vt.push(Vt)}}function He(vt,K){var Q=(K=this.options=function(Ct,kt){for(var Ut in kt)Ct[Ut]=kt[Ut];return Ct}(Object.create(this.options),K)).debug;if(Q&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var rt=function(Ct,kt){var Ut=[];if(Ct.type==="FeatureCollection")for(var Vt=0;Vt<Ct.features.length;Vt++)Ze(Ut,Ct.features[Vt],kt,Vt);else Ze(Ut,Ct.type==="Feature"?Ct:{geometry:Ct},kt);return Ut}(vt,K);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),rt=function(Ct,kt){var Ut=kt.buffer/kt.extent,Vt=Ct,St=Se(Ct,1,-1-Ut,Ut,0,-1,2,kt),Jt=Se(Ct,1,1-Ut,2+Ut,0,-1,2,kt);return(St||Jt)&&(Vt=Se(Ct,1,-Ut,1+Ut,0,-1,2,kt)||[],St&&(Vt=be(St,1).concat(Vt)),Jt&&(Vt=Vt.concat(be(Jt,-1)))),Vt}(rt,K),rt.length&&this.splitTile(rt,0,0,0),Q&&(rt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Di(vt,K,Q){return 32*((1<<vt)*Q+K)+vt}function Mr(vt,K){return K?vt.properties[K]:vt.id}function je(vt,K){if(vt==null)return!0;if(vt.type==="Feature")return Mr(vt,K)!=null;if(vt.type==="FeatureCollection"){const Q=new Set;for(const rt of vt.features){const Ct=Mr(rt,K);if(Ct==null||Q.has(Ct))return!1;Q.add(Ct)}return!0}return!1}function Ls(vt,K){const Q=new Map;if(vt!=null)if(vt.type==="Feature")Q.set(Mr(vt,K),vt);else for(const rt of vt.features)Q.set(Mr(rt,K),rt);return Q}He.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},He.prototype.splitTile=function(vt,K,Q,rt,Ct,kt,Ut){for(var Vt=[vt,K,Q,rt],St=this.options,Jt=St.debug;Vt.length;){rt=Vt.pop(),Q=Vt.pop(),K=Vt.pop(),vt=Vt.pop();var ge=1<<K,ae=Di(K,Q,rt),se=this.tiles[ae];if(!se&&(Jt>1&&console.time("creation"),se=this.tiles[ae]=Lr(vt,K,Q,rt,St),this.tileCoords.push({z:K,x:Q,y:rt}),Jt)){Jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,Q,rt,se.numFeatures,se.numPoints,se.numSimplified),console.timeEnd("creation"));var qe="z"+K;this.stats[qe]=(this.stats[qe]||0)+1,this.total++}if(se.source=vt,Ct){if(K===St.maxZoom||K===Ct)continue;var $e=1<<Ct-K;if(Q!==Math.floor(kt/$e)||rt!==Math.floor(Ut/$e))continue}else if(K===St.indexMaxZoom||se.numPoints<=St.indexMaxPoints)continue;if(se.source=null,vt.length!==0){Jt>1&&console.time("clipping");var wi,si,Si,ki,qi,tr,pi=.5*St.buffer/St.extent,Fi=.5-pi,sr=.5+pi,Ar=1+pi;wi=si=Si=ki=null,qi=Se(vt,ge,Q-pi,Q+sr,0,se.minX,se.maxX,St),tr=Se(vt,ge,Q+Fi,Q+Ar,0,se.minX,se.maxX,St),vt=null,qi&&(wi=Se(qi,ge,rt-pi,rt+sr,1,se.minY,se.maxY,St),si=Se(qi,ge,rt+Fi,rt+Ar,1,se.minY,se.maxY,St),qi=null),tr&&(Si=Se(tr,ge,rt-pi,rt+sr,1,se.minY,se.maxY,St),ki=Se(tr,ge,rt+Fi,rt+Ar,1,se.minY,se.maxY,St),tr=null),Jt>1&&console.timeEnd("clipping"),Vt.push(wi||[],K+1,2*Q,2*rt),Vt.push(si||[],K+1,2*Q,2*rt+1),Vt.push(Si||[],K+1,2*Q+1,2*rt),Vt.push(ki||[],K+1,2*Q+1,2*rt+1)}}},He.prototype.getTile=function(vt,K,Q){var rt=this.options,Ct=rt.extent,kt=rt.debug;if(vt<0||vt>24)return null;var Ut=1<<vt,Vt=Di(vt,K=(K%Ut+Ut)%Ut,Q);if(this.tiles[Vt])return Ai(this.tiles[Vt],Ct);kt>1&&console.log("drilling down to z%d-%d-%d",vt,K,Q);for(var St,Jt=vt,ge=K,ae=Q;!St&&Jt>0;)Jt--,ge=Math.floor(ge/2),ae=Math.floor(ae/2),St=this.tiles[Di(Jt,ge,ae)];return St&&St.source?(kt>1&&console.log("found parent tile z%d-%d-%d",Jt,ge,ae),kt>1&&console.time("drilling down"),this.splitTile(St.source,Jt,ge,ae,vt,K,Q),kt>1&&console.timeEnd("drilling down"),this.tiles[Vt]?Ai(this.tiles[Vt],Ct):null):null};class ir extends T{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(K,Q){return c._(this,void 0,void 0,function*(){const rt=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ct=this._geoJSONIndex.getTile(rt.z,rt.x,rt.y);if(!Ct)return null;const kt=new class{constructor(Vt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.W,this.length=Vt.length,this._features=Vt}feature(Vt){return new class{constructor(St){this._feature=St,this.extent=c.W,this.type=St.type,this.properties=St.tags,"id"in St&&!isNaN(St.id)&&(this.id=parseInt(St.id,10))}loadGeometry(){if(this._feature.type===1){const St=[];for(const Jt of this._feature.geometry)St.push([new c.P(Jt[0],Jt[1])]);return St}{const St=[];for(const Jt of this._feature.geometry){const ge=[];for(const ae of Jt)ge.push(new c.P(ae[0],ae[1]));St.push(ge)}return St}}toGeoJSON(St,Jt,ge){return X.call(this,St,Jt,ge)}}(this._features[Vt])}}(Ct.features);let Ut=le(kt);return Ut.byteOffset===0&&Ut.byteLength===Ut.buffer.byteLength||(Ut=new Uint8Array(Ut)),{vectorTile:kt,rawData:Ut.buffer}})}loadData(K){return c._(this,void 0,void 0,function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const rt=!!(K&&K.request&&K.request.collectResourceTiming)&&new c.bs(K.request);this._pendingRequest=new AbortController;try{let Ct=yield this.loadGeoJSON(K,this._pendingRequest);if(delete this._pendingRequest,typeof Ct!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(j(Ct,!0),K.filter){const Ut=c.by(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ut.result==="error")throw new Error(Ut.value.map(Vt=>`${Vt.key}: ${Vt.message}`).join(", "));Ct={type:"FeatureCollection",features:Ct.features.filter(Vt=>Ut.value.evaluate({zoom:0},Vt))}}this._geoJSONIndex=K.cluster?new Lt(function(Ut){let{superclusterOptions:Vt,clusterProperties:St}=Ut;if(!St||!Vt)return Vt;const Jt={},ge={},ae={accumulated:null,zoom:0},se={properties:null},qe=Object.keys(St);for(const $e of qe){const[wi,si]=St[$e],Si=c.by(si),ki=c.by(typeof wi=="string"?[wi,["accumulated"],["get",$e]]:wi);Jt[$e]=Si.value,ge[$e]=ki.value}return Vt.map=$e=>{se.properties=$e;const wi={};for(const si of qe)wi[si]=Jt[si].evaluate(ae,se);return wi},Vt.reduce=($e,wi)=>{se.properties=wi;for(const si of qe)ae.accumulated=$e[si],$e[si]=ge[si].evaluate(ae,se)},Vt}(K)).load(Ct.features):function(Ut,Vt){return new He(Ut,Vt)}(Ct,K.geojsonVtOptions),this.loaded={};const kt={};if(rt){const Ut=rt.finish();Ut&&(kt.resourceTiming={},kt.resourceTiming[K.source]=JSON.parse(JSON.stringify(Ut)))}return kt}catch(Ct){if(delete this._pendingRequest,c.bz(Ct))return{abandoned:!0};throw Ct}})}reloadTile(K){const Q=this.loaded;return Q&&Q[K.uid]?super.reloadTile(K):this.loadTile(K)}loadGeoJSON(K,Q){return c._(this,void 0,void 0,function*(){const{promoteId:rt}=K;if(K.request){const Ct=yield c.h(K.request,Q);return this._dataUpdateable=je(Ct.data,rt)?Ls(Ct.data,rt):void 0,Ct.data}if(typeof K.data=="string")try{const Ct=JSON.parse(K.data);return this._dataUpdateable=je(Ct,rt)?Ls(Ct,rt):void 0,Ct}catch{throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`)}if(!K.dataDiff)throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K.source}`);return function(Ct,kt,Ut){var Vt,St,Jt,ge;if(kt.removeAll&&Ct.clear(),kt.remove)for(const ae of kt.remove)Ct.delete(ae);if(kt.add)for(const ae of kt.add){const se=Mr(ae,Ut);se!=null&&Ct.set(se,ae)}if(kt.update)for(const ae of kt.update){let se=Ct.get(ae.id);if(se==null)continue;const qe=!ae.removeAllProperties&&(((Vt=ae.removeProperties)===null||Vt===void 0?void 0:Vt.length)>0||((St=ae.addOrUpdateProperties)===null||St===void 0?void 0:St.length)>0);if((ae.newGeometry||ae.removeAllProperties||qe)&&(se=Object.assign({},se),Ct.set(ae.id,se),qe&&(se.properties=Object.assign({},se.properties))),ae.newGeometry&&(se.geometry=ae.newGeometry),ae.removeAllProperties)se.properties={};else if(((Jt=ae.removeProperties)===null||Jt===void 0?void 0:Jt.length)>0)for(const $e of ae.removeProperties)Object.prototype.hasOwnProperty.call(se.properties,$e)&&delete se.properties[$e];if(((ge=ae.addOrUpdateProperties)===null||ge===void 0?void 0:ge.length)>0)for(const{key:$e,value:wi}of ae.addOrUpdateProperties)se.properties[$e]=wi}}(this._dataUpdateable,K.dataDiff,rt),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(K){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}class rr{constructor(K){this.self=K,this.actor=new c.C(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Q,rt)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=rt},this.self.addProtocol=c.bf,this.self.removeProtocol=c.bg,this.self.registerRTLTextPlugin=Q=>{if(c.bA.isParsed())throw new Error("RTL text plugin already registered.");c.bA.setMethods(Q)},this.actor.registerMessageHandler("LDT",(Q,rt)=>this._getDEMWorkerSource(Q,rt.source).loadTile(rt)),this.actor.registerMessageHandler("RDT",(Q,rt)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Q,rt.source).removeTile(rt)})),this.actor.registerMessageHandler("GCEZ",(Q,rt)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,rt.type,rt.source).getClusterExpansionZoom(rt)})),this.actor.registerMessageHandler("GCC",(Q,rt)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,rt.type,rt.source).getClusterChildren(rt)})),this.actor.registerMessageHandler("GCL",(Q,rt)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,rt.type,rt.source).getClusterLeaves(rt)})),this.actor.registerMessageHandler("LD",(Q,rt)=>this._getWorkerSource(Q,rt.type,rt.source).loadData(rt)),this.actor.registerMessageHandler("LT",(Q,rt)=>this._getWorkerSource(Q,rt.type,rt.source).loadTile(rt)),this.actor.registerMessageHandler("RT",(Q,rt)=>this._getWorkerSource(Q,rt.type,rt.source).reloadTile(rt)),this.actor.registerMessageHandler("AT",(Q,rt)=>this._getWorkerSource(Q,rt.type,rt.source).abortTile(rt)),this.actor.registerMessageHandler("RMT",(Q,rt)=>this._getWorkerSource(Q,rt.type,rt.source).removeTile(rt)),this.actor.registerMessageHandler("RS",(Q,rt)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[Q]||!this.workerSources[Q][rt.type]||!this.workerSources[Q][rt.type][rt.source])return;const Ct=this.workerSources[Q][rt.type][rt.source];delete this.workerSources[Q][rt.type][rt.source],Ct.removeSource!==void 0&&Ct.removeSource(rt)})),this.actor.registerMessageHandler("RM",Q=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q]})),this.actor.registerMessageHandler("SR",(Q,rt)=>c._(this,void 0,void 0,function*(){this.referrer=rt})),this.actor.registerMessageHandler("SRPS",(Q,rt)=>this._syncRTLPluginState(Q,rt)),this.actor.registerMessageHandler("IS",(Q,rt)=>c._(this,void 0,void 0,function*(){this.self.importScripts(rt)})),this.actor.registerMessageHandler("SI",(Q,rt)=>this._setImages(Q,rt)),this.actor.registerMessageHandler("UL",(Q,rt)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(Q).update(rt.layers,rt.removedIds)})),this.actor.registerMessageHandler("SL",(Q,rt)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(Q).replace(rt)}))}_setImages(K,Q){return c._(this,void 0,void 0,function*(){this.availableImages[K]=Q;for(const rt in this.workerSources[K]){const Ct=this.workerSources[K][rt];for(const kt in Ct)Ct[kt].availableImages=Q}})}_syncRTLPluginState(K,Q){return c._(this,void 0,void 0,function*(){if(c.bA.isParsed())return c.bA.getState();if(Q.pluginStatus!=="loading")return c.bA.setState(Q),Q;const rt=Q.pluginURL;if(this.self.importScripts(rt),c.bA.isParsed()){const Ct={pluginStatus:"loaded",pluginURL:rt};return c.bA.setState(Ct),Ct}throw c.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${rt}`)})}_getAvailableImages(K){let Q=this.availableImages[K];return Q||(Q=[]),Q}_getLayerIndex(K){let Q=this.layerIndexes[K];return Q||(Q=this.layerIndexes[K]=new l),Q}_getWorkerSource(K,Q,rt){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][Q]||(this.workerSources[K][Q]={}),!this.workerSources[K][Q][rt]){const Ct={sendAsync:(kt,Ut)=>(kt.targetMapId=K,this.actor.sendAsync(kt,Ut))};switch(Q){case"vector":this.workerSources[K][Q][rt]=new T(Ct,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][Q][rt]=new ir(Ct,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][Q][rt]=new this.externalWorkerSourceTypes[Q](Ct,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][Q][rt]}_getDEMWorkerSource(K,Q){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][Q]||(this.demWorkerSources[K][Q]=new P),this.demWorkerSources[K][Q]}}return c.i(self)&&(self.worker=new rr(self)),rr}),s("index",["exports","./shared"],function(c,l){var f="4.2.0";let y,A;const T={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((a,d)=>{const m=requestAnimationFrame(a);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),d(l.c())})}),getImageData(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(w).getImageData(-a,-a,w.width+2*a,w.height+2*a)},getImageCanvasContext(w){const a=window.document.createElement("canvas"),d=a.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return a.width=w.width,a.height=w.height,d.drawImage(w,0,0,w.width,w.height),d},resolveURL:w=>(y||(y=document.createElement("a")),y.href=w,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(A==null&&(A=matchMedia("(prefers-reduced-motion: reduce)")),A.matches)}};class P{static testProp(a){if(!P.docStyle)return a[0];for(let d=0;d<a.length;d++)if(a[d]in P.docStyle)return a[d];return a[0]}static create(a,d,m){const v=window.document.createElement(a);return d!==void 0&&(v.className=d),m&&m.appendChild(v),v}static createNS(a,d){return window.document.createElementNS(a,d)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(a,d){a.style[P.transformProp]=d}static addEventListener(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.addEventListener(d,m,"passive"in v?v:v.capture)}static removeEventListener(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.removeEventListener(d,m,"passive"in v?v:v.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(a){const d=a.getBoundingClientRect();return{x:d.width/a.offsetWidth||1,y:d.height/a.offsetHeight||1,boundingClientRect:d}}static getPoint(a,d,m){const v=d.boundingClientRect;return new l.P((m.clientX-v.left)/d.x-a.clientLeft,(m.clientY-v.top)/d.y-a.clientTop)}static mousePos(a,d){const m=P.getScale(a);return P.getPoint(a,m,d)}static touchPos(a,d){const m=[],v=P.getScale(a);for(let E=0;E<d.length;E++)m.push(P.getPoint(a,v,d[E]));return m}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(w){!X&&j&&(Z?$(w):D=w)}};let D,j,X=!1,Z=!1;function $(w){const a=w.createTexture();w.bindTexture(w.TEXTURE_2D,a);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,j),w.isContextLost())return;L.supported=!0}catch{}w.deleteTexture(a),X=!0}var ht;typeof document<"u"&&(j=document.createElement("img"),j.onload=()=>{D&&$(D),D=null,Z=!0},j.onerror=()=>{X=!0,D=null},j.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let a,d,m,v;w.resetRequestQueue=()=>{a=[],d=0,m=0,v={}},w.addThrottleControl=g=>{const b=m++;return v[b]=g,b},w.removeThrottleControl=g=>{delete v[g],B()},w.getImage=function(g,b){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((M,O)=>{L.supported&&(g.headers||(g.headers={}),g.headers.accept="image/webp,*/*"),l.e(g,{type:"image"}),a.push({abortController:b,requestParameters:g,supportImageRefresh:C,state:"queued",onError:z=>{O(z)},onSuccess:z=>{M(z)}}),B()})};const E=g=>l._(this,void 0,void 0,function*(){g.state="running";const{requestParameters:b,supportImageRefresh:C,onError:M,onSuccess:O,abortController:z}=g,U=C===!1&&!l.i(self)&&!l.g(b.url)&&(!b.headers||Object.keys(b.headers).reduce((J,lt)=>J&&lt==="accept",!0));d++;const V=U?k(b,z):l.m(b,z);try{const J=yield V;delete g.abortController,g.state="completed",J.data instanceof HTMLImageElement||l.b(J.data)?O(J):J.data&&O({data:yield(G=J.data,typeof createImageBitmap=="function"?l.d(G):l.f(G)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete g.abortController,M(J)}finally{d--,B()}var G}),B=()=>{const g=(()=>{for(const b of Object.keys(v))if(v[b]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let b=d;b<g&&a.length>0;b++){const C=a.shift();C.abortController.signal.aborted?b--:E(C)}},k=(g,b)=>new Promise((C,M)=>{const O=new Image,z=g.url,U=g.credentials;U&&U==="include"?O.crossOrigin="use-credentials":(U&&U==="same-origin"||!l.s(z))&&(O.crossOrigin="anonymous"),b.signal.addEventListener("abort",()=>{O.src="",M(l.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,C({data:O})},O.onerror=()=>{O.onerror=O.onload=null,b.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=z})}(ht||(ht={})),ht.resetRequestQueue();class _t{constructor(a){this._transformRequestFn=a}transformRequest(a,d){return this._transformRequestFn&&this._transformRequestFn(a,d)||{url:a}}normalizeSpriteURL(a,d,m){const v=function(E){const B=E.match(Mt);if(!B)throw new Error(`Unable to parse URL "${E}"`);return{protocol:B[1],authority:B[2],path:B[3]||"/",params:B[4]?B[4].split("&"):[]}}(a);return v.path+=`${d}${m}`,function(E){const B=E.params.length?`?${E.params.join("&")}`:"";return`${E.protocol}://${E.authority}${E.path}${B}`}(v)}setTransformRequest(a){this._transformRequestFn=a}}const Mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Nt(w){var a=new l.A(3);return a[0]=w[0],a[1]=w[1],a[2]=w[2],a}var Rt,xt=function(w,a,d){return w[0]=a[0]-d[0],w[1]=a[1]-d[1],w[2]=a[2]-d[2],w};Rt=new l.A(3),l.A!=Float32Array&&(Rt[0]=0,Rt[1]=0,Rt[2]=0);var qt=function(w){var a=w[0],d=w[1];return a*a+d*d};function zt(w){const a=[];if(typeof w=="string")a.push({id:"default",url:w});else if(w&&w.length>0){const d=[];for(const{id:m,url:v}of w){const E=`${m}${v}`;d.indexOf(E)===-1&&(d.push(E),a.push({id:m,url:v}))}}return a}(function(){var w=new l.A(2);l.A!=Float32Array&&(w[0]=0,w[1]=0)})();class ct{constructor(a,d,m,v){this.context=a,this.format=m,this.texture=a.gl.createTexture(),this.update(d,v)}update(a,d,m){const{width:v,height:E}=a,B=!(this.size&&this.size[0]===v&&this.size[1]===E||m),{context:k}=this,{gl:g}=k;if(this.useMipmap=!!(d&&d.useMipmap),g.bindTexture(g.TEXTURE_2D,this.texture),k.pixelStoreUnpackFlipY.set(!1),k.pixelStoreUnpack.set(1),k.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!d||d.premultiply!==!1)),B)this.size=[v,E],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,a):g.texImage2D(g.TEXTURE_2D,0,this.format,v,E,0,this.format,g.UNSIGNED_BYTE,a.data);else{const{x:b,y:C}=m||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?g.texSubImage2D(g.TEXTURE_2D,0,b,C,g.RGBA,g.UNSIGNED_BYTE,a):g.texSubImage2D(g.TEXTURE_2D,0,b,C,v,E,g.RGBA,g.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&g.generateMipmap(g.TEXTURE_2D)}bind(a,d,m){const{context:v}=this,{gl:E}=v;E.bindTexture(E.TEXTURE_2D,this.texture),m!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=E.LINEAR),a!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,a),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,m||a),this.filter=a),d!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,d),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function pt(w){const{userImage:a}=w;return!!(a&&a.render&&a.render())&&(w.data.replace(new Uint8Array(a.data.buffer)),!0)}class Bt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,promiseResolve:m}of this.requestors)m(this._getImagesForIds(d));this.requestors=[]}}getImage(a){const d=this.images[a];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new l.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(a,d){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let m=!0;const v=d.data||d.spriteData;return this._validateStretch(d.stretchX,v&&v.width)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,v&&v.height)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "content" value`))),m=!1),m}_validateStretch(a,d){if(!a)return!0;let m=0;for(const v of a){if(v[0]<m||v[1]<v[0]||d<v[1])return!1;m=v[1]}return!0}_validateContent(a,d){if(!a)return!0;if(a.length!==4)return!1;const m=d.spriteData,v=m&&m.width||d.data.width,E=m&&m.height||d.data.height;return!(a[0]<0||v<a[0]||a[1]<0||E<a[1]||a[2]<0||v<a[2]||a[3]<0||E<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const v=this.getImage(a);if(m&&(v.data.width!==d.data.width||v.data.height!==d.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=v.version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((d,m)=>{let v=!0;if(!this.isLoaded())for(const E of a)this.images[E]||(v=!1);this.isLoaded()||v?d(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:d})})}_getImagesForIds(a){const d={};for(const m of a){let v=this.getImage(m);v||(this.fire(new l.k("styleimagemissing",{id:m})),v=this.getImage(m)),v?d[m]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,textFitWidth:v.textFitWidth,textFitHeight:v.textFitHeight,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:l.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],m=this.getImage(a);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},E=new l.I(v,m);this.patterns[a]={bin:v,position:E}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ct(a,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const E in this.patterns)a.push(this.patterns[E].bin);const{w:d,h:m}=l.p(a),v=this.atlasImage;v.resize({width:d||1,height:m||1});for(const E in this.patterns){const{bin:B}=this.patterns[E],k=B.x+1,g=B.y+1,b=this.getImage(E).data,C=b.width,M=b.height;l.R.copy(b,v,{x:0,y:0},{x:k,y:g},{width:C,height:M}),l.R.copy(b,v,{x:0,y:M-1},{x:k,y:g-1},{width:C,height:1}),l.R.copy(b,v,{x:0,y:0},{x:k,y:g+M},{width:C,height:1}),l.R.copy(b,v,{x:C-1,y:0},{x:k-1,y:g},{width:1,height:M}),l.R.copy(b,v,{x:0,y:0},{x:k+C,y:g},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||l.w(`Image with ID: "${d}" was not found`),pt(m)&&this.updateImage(d,m)}}}const bt=1e20;function ne(w,a,d,m,v,E,B,k,g){for(let b=a;b<a+m;b++)oe(w,d*E+b,E,v,B,k,g);for(let b=d;b<d+v;b++)oe(w,b*E+a,1,m,B,k,g)}function oe(w,a,d,m,v,E,B){E[0]=0,B[0]=-bt,B[1]=bt,v[0]=w[a];for(let k=1,g=0,b=0;k<m;k++){v[k]=w[a+k*d];const C=k*k;do{const M=E[g];b=(v[k]-v[M]+C-M*M)/(k-M)/2}while(b<=B[g]&&--g>-1);g++,E[g]=k,B[g]=b,B[g+1]=bt}for(let k=0,g=0;k<m;k++){for(;B[g+1]<k;)g++;const b=E[g],C=k-b;w[a+k*d]=v[b]+C*C}}class le{constructor(a,d){this.requestManager=a,this.localIdeographFontFamily=d,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return l._(this,void 0,void 0,function*(){const d=[];for(const E in a)for(const B of a[E])d.push(this._getAndCacheGlyphsPromise(E,B));const m=yield Promise.all(d),v={};for(const{stack:E,id:B,glyph:k}of m)v[E]||(v[E]={}),v[E][B]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return v})}_getAndCacheGlyphsPromise(a,d){return l._(this,void 0,void 0,function*(){let m=this.entries[a];m||(m=this.entries[a]={glyphs:{},requests:{},ranges:{}});let v=m.glyphs[d];if(v!==void 0)return{stack:a,id:d,glyph:v};if(v=this._tinySDF(m,a,d),v)return m.glyphs[d]=v,{stack:a,id:d,glyph:v};const E=Math.floor(d/256);if(256*E>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[E])return{stack:a,id:d,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[E]){const k=le.loadGlyphRange(a,E,this.url,this.requestManager);m.requests[E]=k}const B=yield m.requests[E];for(const k in B)this._doesCharSupportLocalGlyph(+k)||(m.glyphs[+k]=B[+k]);return m.ranges[E]=!0,{stack:a,id:d,glyph:B[d]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](a)||l.u["Hangul Syllables"](a)||l.u.Hiragana(a)||l.u.Katakana(a))}_tinySDF(a,d,m){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(m))return;let E=a.tinySDF;if(!E){let k="400";/bold/i.test(d)?k="900":/medium/i.test(d)?k="500":/light/i.test(d)&&(k="200"),E=a.tinySDF=new le.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:k})}const B=E.draw(String.fromCharCode(m));return{id:m,bitmap:new l.o({width:B.width||60,height:B.height||60},B.data),metrics:{width:B.glyphWidth/2||24,height:B.glyphHeight/2||24,left:B.glyphLeft/2+.5||0,top:B.glyphTop/2-27.5||-8,advance:B.glyphAdvance/2||24,isDoubleResolution:!0}}}}le.loadGlyphRange=function(w,a,d,m){return l._(this,void 0,void 0,function*(){const v=256*a,E=v+255,B=m.transformRequest(d.replace("{fontstack}",w).replace("{range}",`${v}-${E}`),"Glyphs"),k=yield l.l(B,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${a}, ${v}-${E}`);const g={};for(const b of l.n(k.data))g[b.id]=b;return g})},le.TinySDF=class{constructor(){let{fontSize:w=24,buffer:a=3,radius:d=8,cutoff:m=.25,fontFamily:v="sans-serif",fontWeight:E="normal",fontStyle:B="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=a,this.cutoff=m,this.radius=d;const k=this.size=w+4*a,g=this._createCanvas(k),b=this.ctx=g.getContext("2d",{willReadFrequently:!0});b.font=`${B} ${E} ${w}px ${v}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(w){const a=document.createElement("canvas");return a.width=a.height=w,a}draw(w){const{width:a,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:v,actualBoundingBoxRight:E}=this.ctx.measureText(w),B=Math.ceil(d),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-v))),g=Math.min(this.size-this.buffer,B+Math.ceil(m)),b=k+2*this.buffer,C=g+2*this.buffer,M=Math.max(b*C,0),O=new Uint8ClampedArray(M),z={data:O,width:b,height:C,glyphWidth:k,glyphHeight:g,glyphTop:B,glyphLeft:0,glyphAdvance:a};if(k===0||g===0)return z;const{ctx:U,buffer:V,gridInner:G,gridOuter:J}=this;U.clearRect(V,V,k,g),U.fillText(w,V,V+B);const lt=U.getImageData(V,V,k,g);J.fill(bt,0,M),G.fill(0,0,M);for(let tt=0;tt<g;tt++)for(let ut=0;ut<k;ut++){const dt=lt.data[4*(tt*k+ut)+3]/255;if(dt===0)continue;const Tt=(tt+V)*b+ut+V;if(dt===1)J[Tt]=0,G[Tt]=bt;else{const wt=.5-dt;J[Tt]=wt>0?wt*wt:0,G[Tt]=wt<0?wt*wt:0}}ne(J,0,0,b,C,b,this.f,this.v,this.z),ne(G,V,V,k,g,b,this.f,this.v,this.z);for(let tt=0;tt<M;tt++){const ut=Math.sqrt(J[tt])-Math.sqrt(G[tt]);O[tt]=Math.round(255-255*(ut/this.radius+this.cutoff))}return z}};class Qt{constructor(){this.specification=l.v.light.position}possiblyEvaluate(a,d){return l.y(a.expression.evaluate(d))}interpolate(a,d,m){return{x:l.z.number(a.x,d.x,m),y:l.z.number(a.y,d.y,m),z:l.z.number(a.z,d.z,m)}}}let fe;class de extends l.E{constructor(a){super(),fe=fe||new l.q({anchor:new l.D(l.v.light.anchor),position:new Qt,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(fe),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(l.r,a,d))for(const m in a){const v=a[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),v):this._transitionable.setValue(m,v)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,m){return(!m||m.validate!==!1)&&l.t(this,a.call(l.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class Me{constructor(a,d){this.width=a,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,d){const m=a.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(a,d)),this.dashEntry[m]}getDashRanges(a,d,m){const v=[];let E=a.length%2==1?-a[a.length-1]*m:0,B=a[0]*m,k=!0;v.push({left:E,right:B,isDash:k,zeroLength:a[0]===0});let g=a[0];for(let b=1;b<a.length;b++){k=!k;const C=a[b];E=g*m,g+=C,B=g*m,v.push({left:E,right:B,isDash:k,zeroLength:C===0})}return v}addRoundDash(a,d,m){const v=d/2;for(let E=-m;E<=m;E++){const B=this.width*(this.nextRow+m+E);let k=0,g=a[k];for(let b=0;b<this.width;b++){b/g.right>1&&(g=a[++k]);const C=Math.abs(b-g.left),M=Math.abs(b-g.right),O=Math.min(C,M);let z;const U=E/m*(v+1);if(g.isDash){const V=v-Math.abs(U);z=Math.sqrt(O*O+V*V)}else z=v-Math.sqrt(O*O+U*U);this.data[B+b]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(a){for(let k=a.length-1;k>=0;--k){const g=a[k],b=a[k+1];g.zeroLength?a.splice(k,1):b&&b.isDash===g.isDash&&(b.left=g.left,a.splice(k,1))}const d=a[0],m=a[a.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const v=this.width*this.nextRow;let E=0,B=a[E];for(let k=0;k<this.width;k++){k/B.right>1&&(B=a[++E]);const g=Math.abs(k-B.left),b=Math.abs(k-B.right),C=Math.min(g,b);this.data[v+k]=Math.max(0,Math.min(255,(B.isDash?C:-C)+128))}}addDash(a,d){const m=d?7:0,v=2*m+1;if(this.nextRow+v>this.height)return l.w("LineAtlas out of space"),null;let E=0;for(let k=0;k<a.length;k++)E+=a[k];if(E!==0){const k=this.width/E,g=this.getDashRanges(a,this.width,k);d?this.addRoundDash(g,k,m):this.addRegularDash(g)}const B={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:E};return this.nextRow+=v,this.dirty=!0,B}bind(a){const d=a.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const nt="maplibre_preloaded_worker_pool";class Et{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Et.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nt]}numActive(){return Object.keys(this.active).length}}const Lt=Math.floor(T.hardwareConcurrency/2);let Gt,Wt;function $t(){return Gt||(Gt=new Et),Gt}Et.workerCount=l.B(globalThis)?Math.max(Math.min(Lt,3),1):1;class ee{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let v=0;v<m.length;v++){const E=new l.C(m[v],d);E.name=`Worker ${v}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,d){const m=[];for(const v of this.actors)m.push(v.sendAsync({type:a,data:d}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,d){for(const m of this.actors)m.registerMessageHandler(a,d)}}function Kt(){return Wt||(Wt=new ee($t(),l.G),Wt.registerMessageHandler("GR",(w,a,d)=>l.m(a,d))),Wt}function Ce(w,a){const d=l.F();return l.H(d,d,[1,1,0]),l.J(d,d,[.5*w.width,.5*w.height,1]),l.K(d,d,w.calculatePosMatrix(a.toUnwrapped()))}function Ie(w,a,d,m,v,E){const B=function(M,O,z){if(M)for(const U of M){const V=O[U];if(V&&V.source===z&&V.type==="fill-extrusion")return!0}else for(const U in O){const V=O[U];if(V.source===z&&V.type==="fill-extrusion")return!0}return!1}(v&&v.layers,a,w.id),k=E.maxPitchScaleFactor(),g=w.tilesIn(m,k,B);g.sort(Re);const b=[];for(const M of g)b.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(a,d,w._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,v,E,k,Ce(w.transform,M.tileID))});const C=function(M){const O={},z={};for(const U of M){const V=U.queryResults,G=U.wrappedTileID,J=z[G]=z[G]||{};for(const lt in V){const tt=V[lt],ut=J[lt]=J[lt]||{},dt=O[lt]=O[lt]||[];for(const Tt of tt)ut[Tt.featureIndex]||(ut[Tt.featureIndex]=!0,dt.push(Tt))}}return O}(b);for(const M in C)C[M].forEach(O=>{const z=O.feature,U=w.getFeatureState(z.layer["source-layer"],z.id);z.source=z.layer.source,z.layer["source-layer"]&&(z.sourceLayer=z.layer["source-layer"]),z.state=U});return C}function Re(w,a){const d=w.tileID,m=a.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}function Fe(w,a,d){return l._(this,void 0,void 0,function*(){let m=w;if(w.url?m=(yield l.h(a.transformRequest(w.url,"Source"),d)).data:yield T.frameAsync(d),!m)return null;const v=l.L(l.e(m,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(v.vectorLayerIds=m.vector_layers.map(E=>E.id)),v})}class Ze{constructor(a,d){a&&(d?this.setSouthWest(a).setNorthEast(d):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}extend(a){const d=this._sw,m=this._ne;let v,E;if(a instanceof l.M)v=a,E=a;else{if(!(a instanceof Ze))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Ze.convert(a)):this.extend(l.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(l.M.convert(a)):this;if(v=a._sw,E=a._ne,!v||!E)return this}return d||m?(d.lng=Math.min(v.lng,d.lng),d.lat=Math.min(v.lat,d.lat),m.lng=Math.max(E.lng,m.lng),m.lat=Math.max(E.lat,m.lat)):(this._sw=new l.M(v.lng,v.lat),this._ne=new l.M(E.lng,E.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:d,lat:m}=l.M.convert(a);let v=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&v}static convert(a){return a instanceof Ze?a:a&&new Ze(a)}static fromLngLat(a){const d=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,m=d/Math.cos(Math.PI/180*a.lat);return new Ze(new l.M(a.lng-m,a.lat-d),new l.M(a.lng+m,a.lat+d))}}class he{constructor(a,d,m){this.bounds=Ze.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),m=Math.floor(l.N(this.bounds.getWest())*d),v=Math.floor(l.O(this.bounds.getNorth())*d),E=Math.ceil(l.N(this.bounds.getEast())*d),B=Math.ceil(l.O(this.bounds.getSouth())*d);return a.x>=m&&a.x<E&&a.y>=v&&a.y<B}}class ot extends l.E{constructor(a,d,m,v){if(super(),this.id=a,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Fe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(l.e(this,a),a.bounds&&(this.tileBounds=new he(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,"Tile"),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((E,B)=>{a.reloadPromise={resolve:E,reject:B}})}else a.actor=this.dispatcher.getActor(),v="LT";a.abortController=new AbortController;try{const E=yield a.actor.sendAsync({type:v,data:m},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,E)}catch(E){if(delete a.abortController,a.aborted)return;if(E&&E.status!==404)throw E;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,d){if(d&&d.resourceTiming&&(a.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&a.setExpiryData(d),a.loadVectorData(d,this.map.painter),a.reloadPromise){const m=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(m.resolve).catch(m.reject)}}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"AT",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class mi extends l.E{constructor(a,d,m,v){super(),this.id=a,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.L(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Fe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new he(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return l.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const m=yield ht.getImage(this.map._requestManager.transformRequest(d,"Tile"),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&a.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const v=this.map.painter.context,E=v.gl,B=m.data;a.texture=this.map.painter.getTileTexture(B.width),a.texture?a.texture.update(B,{useMipmap:!0}):(a.texture=new ct(v,B,E.RGBA,{useMipmap:!0}),a.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(m){if(delete a.abortController,a.aborted)a.state="unloaded";else if(m)throw a.state="errored",m}})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class ri extends mi{constructor(a,d,m,v){super(a,d,m,v),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,"Tile");a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const v=yield ht.getImage(m,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(v&&v.data){const E=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&a.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const B=l.b(E)&&l.S()?E:yield this.readImageNow(E),k={type:this.type,uid:a.uid,source:this.id,rawImageData:B,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const g=yield a.actor.sendAsync({type:"LDT",data:k});a.dem=g,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(v){if(delete a.abortController,a.aborted)a.state="unloaded";else if(v)throw a.state="errored",v}})}readImageNow(a){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const d=a.width+2,m=a.height+2;try{return new l.R({width:d,height:m},yield l.V(a,-1,-1,d,m))}catch{}}return T.getImageData(a,1)})}_getNeighboringTiles(a){const d=a.canonical,m=Math.pow(2,d.z),v=(d.x-1+m)%m,E=d.x===0?a.wrap-1:a.wrap,B=(d.x+1+m)%m,k=d.x+1===m?a.wrap+1:a.wrap,g={};return g[new l.Q(a.overscaledZ,E,d.z,v,d.y).key]={backfilled:!1},g[new l.Q(a.overscaledZ,k,d.z,B,d.y).key]={backfilled:!1},d.y>0&&(g[new l.Q(a.overscaledZ,E,d.z,v,d.y-1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,k,d.z,B,d.y-1).key]={backfilled:!1}),d.y+1<m&&(g[new l.Q(a.overscaledZ,E,d.z,v,d.y+1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,k,d.z,B,d.y+1).key]={backfilled:!1}),g}unloadTile(a){return l._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"RDT",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class _e extends l.E{constructor(a,d,m,v){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(v),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const E=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*E,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*E,extent:l.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.W,radius:(d.clusterRadius||50)*E,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,d,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:a,limit:d,offset:m}})}_updateWorkerData(a){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);a?d.dataDiff=a:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(T.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let v=null;m.resourceTiming&&m.resourceTiming[this.id]&&(v=m.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&l.e(E,{resourceTiming:v}),this.fire(new l.k("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.actor?"RT":"LT";a.actor=this.actor;const m={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const v=yield this.actor.sendAsync({type:d,data:m},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(v,this.map.painter,d==="RT")})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Se=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Le extends l.E{constructor(a,d,m,v){super(),this.id=a,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=d}load(a){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield ht.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,a&&(this.coordinates=a),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const d=a.map(l.Y.fromLngLat);this.tileID=function(v){let E=1/0,B=1/0,k=-1/0,g=-1/0;for(const O of v)E=Math.min(E,O.x),B=Math.min(B,O.y),k=Math.max(k,O.x),g=Math.max(g,O.y);const b=Math.max(k-E,g-B),C=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),M=Math.pow(2,C);return new l.a0(C,Math.floor((E+k)/2*M),Math.floor((B+g)/2*M))}(d),this.minzoom=this.maxzoom=this.tileID.z;const m=d.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,l.W,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,l.W),this._boundsArray.emplaceBack(m[2].x,m[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Se.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ct(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ne extends Le{constructor(a,d,m,v){super(a,d,m,v),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const d of a.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield l.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const d=this.video.seekable;a<d.start(0)||a>d.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Se.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new ct(a,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ci extends Le{constructor(a,d,m,v){super(a,d,m,v),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(B=>typeof B!="number"))||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Se.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ct(d,this.canvas,m.RGBA,{premultiply:!0});let v=!1;for(const E in this.tiles){const B=this.tiles[E];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,v=!0)}v&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Ei={},Ci=w=>{switch(w){case"geojson":return _e;case"image":return Le;case"raster":return mi;case"raster-dem":return ri;case"vector":return ot;case"video":return Ne;case"canvas":return ci}return Ei[w]},Ii="RTLPluginLoaded";class Vi extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Kt()}_syncState(a){return this.status=a,this.dispatcher.broadcast("SRPS",{pluginStatus:a,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(a){return l._(this,arguments,void 0,function(d){var m=this;let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(m.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(m.url=T.resolveURL(d),!m.url)throw new Error(`requested url ${d} is invalid`);if(m.status==="unavailable"){if(!v)return m._requestImport();m.status="deferred",m._syncState(m.status)}else if(m.status==="requested")return m._requestImport()}()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Ii))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let be=null;function ai(){return be||(be=new Vi),be}class Ai{constructor(a,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=l.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const d=a+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(v,E){const B={};if(!E)return B;for(const k of v){const g=k.layerIds.map(b=>E.getLayer(b)).filter(Boolean);if(g.length!==0){k.layers=g,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(b=>g.filter(C=>C.id===b)[0]));for(const b of g)B[b.id]=k}}return B}(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const E=this.buckets[v];if(E instanceof l.a5){if(this.hasSymbolBuckets=!0,!m)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const E=this.buckets[v];if(E instanceof l.a5&&E.hasRTLText){this.hasRTLText=!0,ai().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const E=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(v).queryRadius(E))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const m in this.buckets){const v=this.buckets[m];v.uploadPending()&&v.upload(a)}const d=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ct(a,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ct(a,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,d,m,v,E,B,k,g,b,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:E,scale:B,tileSize:this.tileSize,pixelPosMatrix:C,transform:g,params:k,queryPadding:this.queryPadding*b},a,d,m):{}}querySourceFeatures(a,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),E=d&&d.sourceLayer?d.sourceLayer:"",B=v._geojsonTileLayer||v[E];if(!B)return;const k=l.a6(d&&d.filter),{z:g,x:b,y:C}=this.tileID.canonical,M={z:g,x:b,y:C};for(let O=0;O<B.length;O++){const z=B.feature(O);if(k.needGeometry){const G=l.a7(z,!0);if(!k.filter(new l.a8(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!k.filter(new l.a8(this.tileID.overscaledZ),z))continue;const U=m.getId(z,E),V=new l.a9(z,g,b,C,U);V.tile=M,a.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const m=l.aa(a.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(d)if(this.expirationTime<d)v=!0;else{const E=this.expirationTime-d;E?this.expirationTime=m+Math.max(E,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!d.style.hasLayer(v))continue;const E=this.buckets[v],B=E.layers[0].sourceLayer||"_geojsonTileLayer",k=m[B],g=a[B];if(!k||!g||Object.keys(g).length===0)continue;E.update(g,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const b=d&&d.style&&d.style.getLayer(v);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<T.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=T.now()+a}setDependencies(a,d){const m={};for(const v of d)m[v]=!0;this.dependencies[a]=m}hasDependency(a,d){for(const m of a){const v=this.dependencies[m];if(v){for(const E of d)if(v[E])return!0}}return!1}}class De{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,m){const v=a.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const E={value:d,timeout:void 0};if(m!==void 0&&(E.timeout=setTimeout(()=>{this.remove(a,E)},m)),this.data[v].push(E),this.order.push(v),this.order.length>this.max){const B=this._getAndRemoveByKey(this.order[0]);B&&this.onRemove(B)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const m=a.wrapped().key,v=d===void 0?0:this.data[m].indexOf(d),E=this.data[m][v];return this.data[m].splice(v,1),E.timeout&&clearTimeout(E.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(E.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const m in this.data)for(const v of this.data[m])a(v.value)||d.push(v);for(const m of d)this.remove(m.value.tileID,m)}}class Lr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,m){const v=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][v]=this.stateChanges[a][v]||{},l.e(this.stateChanges[a][v],m),this.deletedStates[a]===null){this.deletedStates[a]={};for(const E in this.state[a])E!==v&&(this.deletedStates[a][E]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][v]===null){this.deletedStates[a][v]={};for(const E in this.state[a][v])m[E]||(this.deletedStates[a][v][E]=null)}else for(const E in m)this.deletedStates[a]&&this.deletedStates[a][v]&&this.deletedStates[a][v][E]===null&&delete this.deletedStates[a][v][E]}removeFeatureState(a,d,m){if(this.deletedStates[a]===null)return;const v=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},m&&d!==void 0)this.deletedStates[a][v]!==null&&(this.deletedStates[a][v]=this.deletedStates[a][v]||{},this.deletedStates[a][v][m]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][v])for(m in this.deletedStates[a][v]={},this.stateChanges[a][v])this.deletedStates[a][v][m]=null;else this.deletedStates[a][v]=null;else this.deletedStates[a]=null}getState(a,d){const m=String(d),v=l.e({},(this.state[a]||{})[m],(this.stateChanges[a]||{})[m]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const E=this.deletedStates[a][d];if(E===null)return{};for(const B in E)delete v[B]}return v}initializeTileState(a,d){a.setFeatureState(this.state,d)}coalesceChanges(a,d){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const E={};for(const B in this.stateChanges[v])this.state[v][B]||(this.state[v][B]={}),l.e(this.state[v][B],this.stateChanges[v][B]),E[B]=this.state[v][B];m[v]=E}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const E={};if(this.deletedStates[v]===null)for(const B in this.state[v])E[B]={},this.state[v][B]={};else for(const B in this.deletedStates[v]){if(this.deletedStates[v][B]===null)this.state[v][B]={};else for(const k of Object.keys(this.deletedStates[v][B]))delete this.state[v][B][k];E[B]=this.state[v][B]}m[v]=m[v]||{},l.e(m[v],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in a)a[v].setFeatureState(m,d)}}class me extends l.E{constructor(a,d,m){super(),this.id=a,this.dispatcher=m,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,E,B,k)=>{const g=new(Ci(E.type))(v,E,B,k);if(g.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${g.id}`);return g})(a,d,m,this),this._tiles={},this._cache=new De(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lr,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const d=this._tiles[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,d,m){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,d,m)}catch(v){a.state="errored",v.status!==404?this._source.fire(new l.j(v,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new l.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(a),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(vi).map(a=>a.key)}getRenderableIds(a){const d=[];for(const m in this._tiles)this._isIdRenderable(m,a)&&d.push(this._tiles[m]);return a?d.sort((m,v)=>{const E=m.tileID,B=v.tileID,k=new l.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),g=new l.P(B.canonical.x,B.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-B.overscaledZ||g.y-k.y||g.x-k.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(vi).map(m=>m.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,d){return l._(this,void 0,void 0,function*(){const m=this._tiles[a];m&&(m.state!=="loading"&&(m.state=d),yield this._loadTile(m,a,d))})}_tileLoaded(a,d,m){a.timeAdded=T.now(),m==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const d=this.getRenderableIds();for(let v=0;v<d.length;v++){const E=d[v];if(a.neighboringTiles&&a.neighboringTiles[E]){const B=this.getTileByID(E);m(a,B),m(B,a)}}function m(v,E){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let B=E.tileID.canonical.x-v.tileID.canonical.x;const k=E.tileID.canonical.y-v.tileID.canonical.y,g=Math.pow(2,v.tileID.canonical.z),b=E.tileID.key;B===0&&k===0||Math.abs(k)>1||(Math.abs(B)>1&&(Math.abs(B+g)===1?B+=g:Math.abs(B-g)===1&&(B-=g)),E.dem&&v.dem&&(v.dem.backfillBorder(E.dem,B,k),v.neighboringTiles&&v.neighboringTiles[b]&&(v.neighboringTiles[b].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,m,v){for(const E in this._tiles){let B=this._tiles[E];if(v[E]||!B.hasData()||B.tileID.overscaledZ<=d||B.tileID.overscaledZ>m)continue;let k=B.tileID;for(;B&&B.tileID.overscaledZ>d+1;){const b=B.tileID.scaledTo(B.tileID.overscaledZ-1);B=this._tiles[b.key],B&&B.hasData()&&(k=b)}let g=k;for(;g.overscaledZ>d;)if(g=g.scaledTo(g.overscaledZ-1),a[g.key]){v[k.key]=k;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const m=this._loadedParentTiles[a.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=a.overscaledZ-1;m>=d;m--){const v=a.scaledTo(m),E=this._getLoadedTile(v);if(E)return E}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const d=Math.ceil(a.width/this._source.tileSize)+1,m=Math.ceil(a.height/this._source.tileSize)+1,v=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(E)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const m={};for(const v in this._tiles){const E=this._tiles[v];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+d),m[E.tileID.key]=E}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(a,d){if(!this._sourceLoaded||this._paused)return;let m;this.transform=a,this.terrain=d,this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new l.Q(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(m=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(m=m.filter(C=>this._source.hasTile(C)))):m=[];const v=a.coveringZoomLevel(this._source),E=Math.max(v-me.maxOverzooming,this._source.minzoom),B=Math.max(v+me.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const C={};for(const M of m)if(M.canonical.z>this._source.minzoom){const O=M.scaledTo(M.canonical.z-1);C[O.key]=O;const z=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));C[z.key]=z}m=m.concat(Object.values(C))}const k=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=this._updateRetainedTiles(m,v);if(He(this._source.type)){const C={},M={},O=Object.keys(g),z=T.now();for(const U of O){const V=g[U],G=this._tiles[U];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=z)continue;const J=this.findLoadedParent(V,E);J&&(this._addTile(J.tileID),C[J.tileID.key]=J.tileID),M[U]=V}this._retainLoadedChildren(M,v,B,g);for(const U in C)g[U]||(this._coveredTiles[U]=!0,g[U]=C[U]);if(d){const U={},V={};for(const G of m)this._tiles[G.key].hasData()?U[G.key]=G:V[G.key]=G;for(const G in V){const J=V[G].children(this._source.maxzoom);this._tiles[J[0].key]&&this._tiles[J[1].key]&&this._tiles[J[2].key]&&this._tiles[J[3].key]&&(U[J[0].key]=g[J[0].key]=J[0],U[J[1].key]=g[J[1].key]=J[1],U[J[2].key]=g[J[2].key]=J[2],U[J[3].key]=g[J[3].key]=J[3],delete V[G])}for(const G in V){const J=this.findLoadedParent(V[G],this._source.minzoom);if(J){U[J.tileID.key]=g[J.tileID.key]=J.tileID;for(const lt in U)U[lt].isChildOf(J.tileID)&&delete U[lt]}}for(const G in this._tiles)U[G]||(this._coveredTiles[G]=!0)}}for(const C in g)this._tiles[C].clearFadeHold();const b=l.ab(this._tiles,g);for(const C of b){const M=this._tiles[C];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,d){var m;const v={},E={},B=Math.max(d-me.maxOverzooming,this._source.minzoom),k=Math.max(d+me.maxUnderzooming,this._source.minzoom),g={};for(const b of a){const C=this._addTile(b);v[b.key]=b,C.hasData()||d<this._source.maxzoom&&(g[b.key]=b)}this._retainLoadedChildren(g,d,k,v);for(const b of a){let C=this._tiles[b.key];if(C.hasData())continue;if(d+1>this._source.maxzoom){const O=b.children(this._source.maxzoom)[0],z=this.getTile(O);if(z&&z.hasData()){v[O.key]=O;continue}}else{const O=b.children(this._source.maxzoom);if(v[O[0].key]&&v[O[1].key]&&v[O[2].key]&&v[O[3].key])continue}let M=C.wasRequested();for(let O=b.overscaledZ-1;O>=B;--O){const z=b.scaledTo(O);if(E[z.key])break;if(E[z.key]=!0,C=this.getTile(z),!C&&M&&(C=this._addTile(z)),C){const U=C.hasData();if((U||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||M)&&(v[z.key]=z),M=C.wasRequested(),U)break}}}return v}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let m,v=this._tiles[a].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}d.push(v.key);const E=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(E),m)break;v=E}for(const E of d)this._loadedParentTiles[E]=m}}_addTile(a){let d=this._tiles[a.key];if(d)return d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const m=d;return d||(d=new Ai(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(d,a.key,d.state)),d.uses++,this._tiles[a.key]=d,m||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const m=d.getExpiryTimeout();m&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},m))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(a){const d=a.sourceDataType;a.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,d,m){const v=[],E=this.transform;if(!E)return v;const B=m?E.getCameraQueryGeometry(a):a,k=a.map(U=>E.pointCoordinate(U,this.terrain)),g=B.map(U=>E.pointCoordinate(U,this.terrain)),b=this.getIds();let C=1/0,M=1/0,O=-1/0,z=-1/0;for(const U of g)C=Math.min(C,U.x),M=Math.min(M,U.y),O=Math.max(O,U.x),z=Math.max(z,U.y);for(let U=0;U<b.length;U++){const V=this._tiles[b[U]];if(V.holdingForFade())continue;const G=V.tileID,J=Math.pow(2,E.zoom-V.tileID.overscaledZ),lt=d*V.queryPadding*l.W/V.tileSize/J,tt=[G.getTilePoint(new l.Y(C,M)),G.getTilePoint(new l.Y(O,z))];if(tt[0].x-lt<l.W&&tt[0].y-lt<l.W&&tt[1].x+lt>=0&&tt[1].y+lt>=0){const ut=k.map(Tt=>G.getTilePoint(Tt)),dt=g.map(Tt=>G.getTilePoint(Tt));v.push({tile:V,tileID:G,queryGeometry:ut,cameraQueryGeometry:dt,scale:J})}}return v}getVisibleCoordinates(a){const d=this.getRenderableIds(a).map(m=>this._tiles[m].tileID);for(const m of d)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(He(this._source.type)){const a=T.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=a)return!0}return!1}setFeatureState(a,d,m){this._state.updateState(a=a||"_geojsonTileLayer",d,m)}removeFeatureState(a,d,m){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,m)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,m){const v=this._tiles[a];v&&v.setDependencies(d,m)}reloadTilesForDependencies(a,d){for(const m in this._tiles)this._tiles[m].hasDependency(a,d)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(a,d))}}function vi(w,a){const d=Math.abs(2*w.wrap)-+(w.wrap<0),m=Math.abs(2*a.wrap)-+(a.wrap<0);return w.overscaledZ-a.overscaledZ||m-d||a.canonical.y-w.canonical.y||a.canonical.x-w.canonical.x}function He(w){return w==="raster"||w==="image"||w==="video"}me.maxOverzooming=10,me.maxUnderzooming=3;class Di{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=l.ac(a,0,1);let d=1,m=this._distances[d];const v=a*this.paddedLength+this.padding;for(;m<v&&d<this._distances.length;)m=this._distances[++d];const E=d-1,B=this._distances[E],k=m-B,g=k>0?(v-B)/k:0;return this.points[E].mult(1-g).add(this.points[d].mult(g))}}function Mr(w,a){let d=!0;return w==="always"||w!=="never"&&a!=="never"||(d=!1),d}class je{constructor(a,d,m){const v=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(a/m),this.yCellCount=Math.ceil(d/m);for(let B=0;B<this.xCellCount*this.yCellCount;B++)v.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,m,v,E){this._forEachCell(d,m,v,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(E)}insertCircle(a,d,m,v){this._forEachCell(d-v,m-v,d+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(m),this.circles.push(v)}_insertBoxCell(a,d,m,v,E,B){this.boxCells[E].push(B)}_insertCircleCell(a,d,m,v,E,B){this.circleCells[E].push(B)}_query(a,d,m,v,E,B,k){if(m<0||a>this.width||v<0||d>this.height)return[];const g=[];if(a<=0&&d<=0&&this.width<=m&&this.height<=v){if(E)return[{key:null,x1:a,y1:d,x2:m,y2:v}];for(let b=0;b<this.boxKeys.length;b++)g.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const C=this.circles[3*b],M=this.circles[3*b+1],O=this.circles[3*b+2];g.push({key:this.circleKeys[b],x1:C-O,y1:M-O,x2:C+O,y2:M+O})}}else this._forEachCell(a,d,m,v,this._queryCell,g,{hitTest:E,overlapMode:B,seenUids:{box:{},circle:{}}},k);return g}query(a,d,m,v){return this._query(a,d,m,v,!1,null)}hitTest(a,d,m,v,E,B){return this._query(a,d,m,v,!0,E,B).length>0}hitTestCircle(a,d,m,v,E){const B=a-m,k=a+m,g=d-m,b=d+m;if(k<0||B>this.width||b<0||g>this.height)return!1;const C=[];return this._forEachCell(B,g,k,b,this._queryCellCircle,C,{hitTest:!0,overlapMode:v,circle:{x:a,y:d,radius:m},seenUids:{box:{},circle:{}}},E),C.length>0}_queryCell(a,d,m,v,E,B,k,g){const{seenUids:b,hitTest:C,overlapMode:M}=k,O=this.boxCells[E];if(O!==null){const U=this.bboxes;for(const V of O)if(!b.box[V]){b.box[V]=!0;const G=4*V,J=this.boxKeys[V];if(a<=U[G+2]&&d<=U[G+3]&&m>=U[G+0]&&v>=U[G+1]&&(!g||g(J))&&(!C||!Mr(M,J.overlapMode))&&(B.push({key:J,x1:U[G],y1:U[G+1],x2:U[G+2],y2:U[G+3]}),C))return!0}}const z=this.circleCells[E];if(z!==null){const U=this.circles;for(const V of z)if(!b.circle[V]){b.circle[V]=!0;const G=3*V,J=this.circleKeys[V];if(this._circleAndRectCollide(U[G],U[G+1],U[G+2],a,d,m,v)&&(!g||g(J))&&(!C||!Mr(M,J.overlapMode))){const lt=U[G],tt=U[G+1],ut=U[G+2];if(B.push({key:J,x1:lt-ut,y1:tt-ut,x2:lt+ut,y2:tt+ut}),C)return!0}}}return!1}_queryCellCircle(a,d,m,v,E,B,k,g){const{circle:b,seenUids:C,overlapMode:M}=k,O=this.boxCells[E];if(O!==null){const U=this.bboxes;for(const V of O)if(!C.box[V]){C.box[V]=!0;const G=4*V,J=this.boxKeys[V];if(this._circleAndRectCollide(b.x,b.y,b.radius,U[G+0],U[G+1],U[G+2],U[G+3])&&(!g||g(J))&&!Mr(M,J.overlapMode))return B.push(!0),!0}}const z=this.circleCells[E];if(z!==null){const U=this.circles;for(const V of z)if(!C.circle[V]){C.circle[V]=!0;const G=3*V,J=this.circleKeys[V];if(this._circlesCollide(U[G],U[G+1],U[G+2],b.x,b.y,b.radius)&&(!g||g(J))&&!Mr(M,J.overlapMode))return B.push(!0),!0}}}_forEachCell(a,d,m,v,E,B,k,g){const b=this._convertToXCellCoord(a),C=this._convertToYCellCoord(d),M=this._convertToXCellCoord(m),O=this._convertToYCellCoord(v);for(let z=b;z<=M;z++)for(let U=C;U<=O;U++)if(E.call(this,a,d,m,v,this.xCellCount*U+z,B,k,g))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,m,v,E,B){const k=v-a,g=E-d,b=m+B;return b*b>k*k+g*g}_circleAndRectCollide(a,d,m,v,E,B,k){const g=(B-v)/2,b=Math.abs(a-(v+g));if(b>g+m)return!1;const C=(k-E)/2,M=Math.abs(d-(E+C));if(M>C+m)return!1;if(b<=g||M<=C)return!0;const O=b-g,z=M-C;return O*O+z*z<=m*m}}function Ls(w,a,d,m,v){const E=l.F();return a?(l.J(E,E,[1/v,1/v,1]),d||l.ad(E,E,m.angle)):l.K(E,m.labelPlaneMatrix,w),E}function ir(w,a,d,m,v){if(a){const E=l.ae(w);return l.J(E,E,[v,v,1]),d||l.ad(E,E,-m.angle),E}return m.glCoordMatrix}function rr(w,a,d){let m;d?(m=[w.x,w.y,d(w.x,w.y),1],l.af(m,m,a)):(m=[w.x,w.y,0,1],qe(m,m,a));const v=m[3];return{point:new l.P(m[0]/v,m[1]/v),signedDistanceFromCamera:v}}function vt(w,a){return .5+w/a*.5}function K(w,a){const d=w[0]/w[3],m=w[1]/w[3];return d>=-a[0]&&d<=a[0]&&m>=-a[1]&&m<=a[1]}function Q(w,a,d,m,v,E,B,k,g,b){const C=m?w.textSizeData:w.iconSizeData,M=l.ag(C,d.transform.zoom),O=[256/d.width*2+1,256/d.height*2+1],z=m?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;z.clear();const U=w.lineVertexArray,V=m?w.text.placedSymbolArray:w.icon.placedSymbolArray,G=d.transform.width/d.transform.height;let J=!1;for(let lt=0;lt<V.length;lt++){const tt=V.get(lt);if(tt.hidden||tt.writingMode===l.ah.vertical&&!J){se(tt.numGlyphs,z);continue}let ut;if(J=!1,b?(ut=[tt.anchorX,tt.anchorY,b(tt.anchorX,tt.anchorY),1],l.af(ut,ut,a)):(ut=[tt.anchorX,tt.anchorY,0,1],qe(ut,ut,a)),!K(ut,O)){se(tt.numGlyphs,z);continue}const dt=vt(d.transform.cameraToCenterDistance,ut[3]),Tt=l.ai(C,M,tt),wt=B?Tt/dt:Tt*dt,gt=new l.P(tt.anchorX,tt.anchorY),mt=rr(gt,v,b).point,Dt={projections:{},offsets:{}},Xt=kt(tt,wt,!1,k,a,v,E,w.glyphOffsetArray,U,z,mt,gt,Dt,G,g,b);J=Xt.useVertical,(Xt.notEnoughRoom||J||Xt.needsFlipping&&kt(tt,wt,!0,k,a,v,E,w.glyphOffsetArray,U,z,mt,gt,Dt,G,g,b).notEnoughRoom)&&se(tt.numGlyphs,z)}m?w.text.dynamicLayoutVertexBuffer.updateData(z):w.icon.dynamicLayoutVertexBuffer.updateData(z)}function rt(w,a,d,m,v,E,B,k,g,b,C,M,O){const z=k.glyphStartIndex+k.numGlyphs,U=k.lineStartIndex,V=k.lineStartIndex+k.lineLength,G=a.getoffsetX(k.glyphStartIndex),J=a.getoffsetX(z-1),lt=ge(w*G,d,m,v,E,B,k.segment,U,V,g,b,C,M,O);if(!lt)return null;const tt=ge(w*J,d,m,v,E,B,k.segment,U,V,g,b,C,M,O);return tt?{first:lt,last:tt}:null}function Ct(w,a,d,m){return w===l.ah.horizontal&&Math.abs(d.y-a.y)>Math.abs(d.x-a.x)*m?{useVertical:!0}:(w===l.ah.vertical?a.y<d.y:a.x>d.x)?{needsFlipping:!0}:null}function kt(w,a,d,m,v,E,B,k,g,b,C,M,O,z,U,V){const G=a/24,J=w.lineOffsetX*G,lt=w.lineOffsetY*G;let tt;if(w.numGlyphs>1){const ut=w.glyphStartIndex+w.numGlyphs,dt=w.lineStartIndex,Tt=w.lineStartIndex+w.lineLength,wt=rt(G,k,J,lt,d,C,M,w,g,E,O,U,V);if(!wt)return{notEnoughRoom:!0};const gt=rr(wt.first.point,B,V).point,mt=rr(wt.last.point,B,V).point;if(m&&!d){const Dt=Ct(w.writingMode,gt,mt,z);if(Dt)return Dt}tt=[wt.first];for(let Dt=w.glyphStartIndex+1;Dt<ut-1;Dt++)tt.push(ge(G*k.getoffsetX(Dt),J,lt,d,C,M,w.segment,dt,Tt,g,E,O,U,V));tt.push(wt.last)}else{if(m&&!d){const dt=rr(M,v,V).point,Tt=w.lineStartIndex+w.segment+1,wt=new l.P(g.getx(Tt),g.gety(Tt)),gt=rr(wt,v,V),mt=gt.signedDistanceFromCamera>0?gt.point:Ut(M,wt,dt,1,v,V),Dt=Ct(w.writingMode,dt,mt,z);if(Dt)return Dt}const ut=ge(G*k.getoffsetX(w.glyphStartIndex),J,lt,d,C,M,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,g,E,O,U,V);if(!ut)return{notEnoughRoom:!0};tt=[ut]}for(const ut of tt)l.aj(b,ut.point,ut.angle);return{}}function Ut(w,a,d,m,v,E){const B=rr(w.add(w.sub(a)._unit()),v,E).point,k=d.sub(B);return d.add(k._mult(m/k.mag()))}function Vt(w,a){const{projectionCache:d,lineVertexArray:m,labelPlaneMatrix:v,tileAnchorPoint:E,distanceFromAnchor:B,getElevation:k,previousVertex:g,direction:b,absOffsetX:C}=a;if(d.projections[w])return d.projections[w];const M=new l.P(m.getx(w),m.gety(w)),O=rr(M,v,k);if(O.signedDistanceFromCamera>0)return d.projections[w]=O.point,O.point;const z=w-b;return Ut(B===0?E:new l.P(m.getx(z),m.gety(z)),M,g,C-B+1,v,k)}function St(w,a,d){return w._unit()._perp()._mult(a*d)}function Jt(w,a,d,m,v,E,B,k){const{projectionCache:g,direction:b}=k;if(g.offsets[w])return g.offsets[w];const C=d.add(a);if(w+b<m||w+b>=v)return g.offsets[w]=C,C;const M=Vt(w+b,k),O=St(M.sub(d),B,b),z=d.add(O),U=M.add(O);return g.offsets[w]=l.ak(E,C,z,U)||C,g.offsets[w]}function ge(w,a,d,m,v,E,B,k,g,b,C,M,O,z){const U=m?w-a:w+a;let V=U>0?1:-1,G=0;m&&(V*=-1,G=Math.PI),V<0&&(G+=Math.PI);let J,lt,tt=V>0?k+B:k+B+1,ut=v,dt=v,Tt=0,wt=0;const gt=Math.abs(U),mt=[];let Dt;for(;Tt+wt<=gt;){if(tt+=V,tt<k||tt>=g)return null;Tt+=wt,dt=ut,lt=J;const re={projectionCache:M,lineVertexArray:b,labelPlaneMatrix:C,tileAnchorPoint:E,distanceFromAnchor:Tt,getElevation:z,previousVertex:dt,direction:V,absOffsetX:gt};if(ut=Vt(tt,re),d===0)mt.push(dt),Dt=ut.sub(dt);else{let ue;const Pe=ut.sub(dt);ue=Pe.mag()===0?St(Vt(tt+V,re).sub(ut),d,V):St(Pe,d,V),lt||(lt=dt.add(ue)),J=Jt(tt,ue,ut,k,g,lt,d,re),mt.push(lt),Dt=J.sub(lt)}wt=Dt.mag()}const Xt=Dt._mult((gt-Tt)/wt)._add(lt||dt),ie=G+Math.atan2(ut.y-dt.y,ut.x-dt.x);return mt.push(Xt),{point:Xt,angle:O?ie:0,path:mt}}const ae=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function se(w,a){for(let d=0;d<w;d++){const m=a.length;a.resize(m+4),a.float32.set(ae,3*m)}}function qe(w,a,d){const m=a[0],v=a[1];return w[0]=d[0]*m+d[4]*v+d[12],w[1]=d[1]*m+d[5]*v+d[13],w[3]=d[3]*m+d[7]*v+d[15],w}const $e=100;class wi{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new je(a.width+200,a.height+200,25),m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new je(a.width+200,a.height+200,25);this.transform=a,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+$e,this.screenBottomBoundary=a.height+$e,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,d,m,v,E,B){const k=this.projectAndGetPerspectiveRatio(v,a.anchorPointX,a.anchorPointY,B),g=m*k.perspectiveRatio,b=a.x1*g+k.point.x,C=a.y1*g+k.point.y,M=a.x2*g+k.point.x,O=a.y2*g+k.point.y;return!this.isInsideGrid(b,C,M,O)||d!=="always"&&this.grid.hitTest(b,C,M,O,d,E)||k.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[b,C,M,O],offscreen:this.isOffscreen(b,C,M,O)}}placeCollisionCircles(a,d,m,v,E,B,k,g,b,C,M,O,z,U){const V=[],G=new l.P(d.anchorX,d.anchorY),J=rr(G,B,U),lt=vt(this.transform.cameraToCenterDistance,J.signedDistanceFromCamera),tt=(C?E/lt:E*lt)/l.ao,ut=rr(G,k,U).point,dt=rt(tt,v,d.lineOffsetX*tt,d.lineOffsetY*tt,!1,ut,G,d,m,k,{projections:{},offsets:{}},!1,U);let Tt=!1,wt=!1,gt=!0;if(dt){const mt=.5*O*lt+z,Dt=new l.P(-100,-100),Xt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),ie=new Di,re=dt.first,ue=dt.last;let Pe=[];for(let Xe=re.path.length-1;Xe>=1;Xe--)Pe.push(re.path[Xe]);for(let Xe=1;Xe<ue.path.length;Xe++)Pe.push(ue.path[Xe]);const xe=2.5*mt;if(g){const Xe=Pe.map(We=>rr(We,g,U));Pe=Xe.some(We=>We.signedDistanceFromCamera<=0)?[]:Xe.map(We=>We.point)}let Oe=[];if(Pe.length>0){const Xe=Pe[0].clone(),We=Pe[0].clone();for(let _i=1;_i<Pe.length;_i++)Xe.x=Math.min(Xe.x,Pe[_i].x),Xe.y=Math.min(Xe.y,Pe[_i].y),We.x=Math.max(We.x,Pe[_i].x),We.y=Math.max(We.y,Pe[_i].y);Oe=Xe.x>=Dt.x&&We.x<=Xt.x&&Xe.y>=Dt.y&&We.y<=Xt.y?[Pe]:We.x<Dt.x||Xe.x>Xt.x||We.y<Dt.y||Xe.y>Xt.y?[]:l.al([Pe],Dt.x,Dt.y,Xt.x,Xt.y)}for(const Xe of Oe){ie.reset(Xe,.25*mt);let We=0;We=ie.length<=.5*mt?1:Math.ceil(ie.paddedLength/xe)+1;for(let _i=0;_i<We;_i++){const xi=_i/Math.max(We-1,1),Ui=ie.lerp(xi),gi=Ui.x+$e,Ni=Ui.y+$e;V.push(gi,Ni,mt,0);const Er=gi-mt,ur=Ni-mt,Zr=gi+mt,Zi=Ni+mt;if(gt=gt&&this.isOffscreen(Er,ur,Zr,Zi),wt=wt||this.isInsideGrid(Er,ur,Zr,Zi),a!=="always"&&this.grid.hitTestCircle(gi,Ni,mt,a,M)&&(Tt=!0,!b))return{circles:[],offscreen:!1,collisionDetected:Tt}}}}return{circles:!b&&Tt||!wt||lt<this.perspectiveRatioCutoff?[]:V,offscreen:gt,collisionDetected:Tt}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let m=1/0,v=1/0,E=-1/0,B=-1/0;for(const C of a){const M=new l.P(C.x+$e,C.y+$e);m=Math.min(m,M.x),v=Math.min(v,M.y),E=Math.max(E,M.x),B=Math.max(B,M.y),d.push(M)}const k=this.grid.query(m,v,E,B).concat(this.ignoredGrid.query(m,v,E,B)),g={},b={};for(const C of k){const M=C.key;if(g[M.bucketInstanceId]===void 0&&(g[M.bucketInstanceId]={}),g[M.bucketInstanceId][M.featureIndex])continue;const O=[new l.P(C.x1,C.y1),new l.P(C.x2,C.y1),new l.P(C.x2,C.y2),new l.P(C.x1,C.y2)];l.am(d,O)&&(g[M.bucketInstanceId][M.featureIndex]=!0,b[M.bucketInstanceId]===void 0&&(b[M.bucketInstanceId]=[]),b[M.bucketInstanceId].push(M.featureIndex))}return b}insertCollisionBox(a,d,m,v,E,B){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:E,collisionGroupID:B,overlapMode:d},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,m,v,E,B){const k=m?this.ignoredGrid:this.grid,g={bucketInstanceId:v,featureIndex:E,collisionGroupID:B,overlapMode:d};for(let b=0;b<a.length;b+=4)k.insertCircle(g,a[b],a[b+1],a[b+2])}projectAndGetPerspectiveRatio(a,d,m,v){let E;return v?(E=[d,m,v(d,m),1],l.af(E,E,a)):(E=[d,m,0,1],qe(E,E,a)),{point:new l.P((E[0]/E[3]+1)/2*this.transform.width+$e,(-E[1]/E[3]+1)/2*this.transform.height+$e),perspectiveRatio:.5+this.transform.cameraToCenterDistance/E[3]*.5}}isOffscreen(a,d,m,v){return m<$e||a>=this.screenRightBoundary||v<$e||d>this.screenBottomBoundary}isInsideGrid(a,d,m,v){return m>=0&&a<this.gridRightBoundary&&v>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=l.an([]);return l.H(a,a,[-100,-100,0]),a}}function si(w,a,d){return a*(l.W/(w.tileSize*Math.pow(2,d-w.tileID.overscaledZ)))}class Si{constructor(a,d,m,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ki{constructor(a,d,m,v,E){this.text=new Si(a?a.text:null,d,m,E),this.icon=new Si(a?a.icon:null,d,v,E)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qi{constructor(a,d,m){this.text=a,this.icon=d,this.skipFade=m}}class tr{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class pi{constructor(a,d,m,v,E){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=E}}class Fi{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[a]}}function sr(w,a,d,m,v){const{horizontalAlign:E,verticalAlign:B}=l.at(w);return new l.P(-(E-.5)*a+m[0]*v,-(B-.5)*d+m[1]*v)}function Ar(w,a,d,m,v,E){const{x1:B,x2:k,y1:g,y2:b,anchorPointX:C,anchorPointY:M}=w,O=new l.P(a,d);return m&&O._rotate(v?E:-E),{x1:B+O.x,y1:g+O.y,x2:k+O.x,y2:b+O.y,anchorPointX:C,anchorPointY:M}}class Qr{constructor(a,d,m,v,E){this.transform=a.clone(),this.terrain=d,this.collisionIndex=new wi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Fi(v),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,m,v){const E=m.getBucket(d),B=m.latestFeatureIndex;if(!E||!B||d.id!==E.layerIds[0])return;const k=m.collisionBoxArray,g=E.layers[0].layout,b=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),C=m.tileSize/l.W,M=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),O=g.get("text-pitch-alignment")==="map",z=g.get("text-rotation-alignment")==="map",U=si(m,1,this.transform.zoom),V=Ls(M,O,z,this.transform,U);let G=null;if(O){const lt=ir(M,O,z,this.transform,U);G=l.K([],this.transform.labelPlaneMatrix,lt)}this.retainedQueryData[E.bucketInstanceId]=new pi(E.bucketInstanceId,B,E.sourceLayerIndex,E.index,m.tileID);const J={bucket:E,layout:g,posMatrix:M,textLabelPlaneMatrix:V,labelToScreenMatrix:G,scale:b,textPixelRatio:C,holdingForFade:m.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:l.ag(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(v)for(const lt of E.sortKeyRanges){const{sortKey:tt,symbolInstanceStart:ut,symbolInstanceEnd:dt}=lt;a.push({sortKey:tt,symbolInstanceStart:ut,symbolInstanceEnd:dt,parameters:J})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:J})}attemptAnchorPlacement(a,d,m,v,E,B,k,g,b,C,M,O,z,U,V,G){const J=l.ap[a.textAnchor],lt=[a.textOffset0,a.textOffset1],tt=sr(J,m,v,lt,E),ut=this.collisionIndex.placeCollisionBox(Ar(d,tt.x,tt.y,B,k,this.transform.angle),M,g,b,C.predicate,G);if((!V||this.collisionIndex.placeCollisionBox(Ar(V,tt.x,tt.y,B,k,this.transform.angle),M,g,b,C.predicate,G).box.length!==0)&&ut.box.length>0){let dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(dt=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:lt,width:m,height:v,anchor:J,textBoxScale:E,prevAnchor:dt},this.markUsedJustification(z,J,O,U),z.allowVerticalPlacement&&(this.markUsedOrientation(z,U,O),this.placedOrientations[O.crossTileID]=U),{shift:tt,placedGlyphBoxes:ut}}}placeLayerBucketPart(a,d,m){const{bucket:v,layout:E,posMatrix:B,textLabelPlaneMatrix:k,labelToScreenMatrix:g,textPixelRatio:b,holdingForFade:C,collisionBoxArray:M,partiallyEvaluatedTextSize:O,collisionGroup:z}=a.parameters,U=E.get("text-optional"),V=E.get("icon-optional"),G=l.aq(E,"text-overlap","text-allow-overlap"),J=G==="always",lt=l.aq(E,"icon-overlap","icon-allow-overlap"),tt=lt==="always",ut=E.get("text-rotation-alignment")==="map",dt=E.get("text-pitch-alignment")==="map",Tt=E.get("icon-text-fit")!=="none",wt=E.get("symbol-z-order")==="viewport-y",gt=J&&(tt||!v.hasIconData()||V),mt=tt&&(J||!v.hasTextData()||U);!v.collisionArrays&&M&&v.deserializeCollisionBoxes(M);const Dt=this.retainedQueryData[v.bucketInstanceId].tileID,Xt=this.terrain?(re,ue)=>this.terrain.getElevation(Dt,re,ue):null,ie=(re,ue)=>{var Pe,xe;if(d[re.crossTileID])return;if(C)return void(this.placements[re.crossTileID]=new qi(!1,!1,!1));let Oe=!1,Xe=!1,We=!0,_i=null,xi={box:null,offscreen:null},Ui={box:null,offscreen:null},gi=null,Ni=null,Er=null,ur=0,Zr=0,Zi=0;ue.textFeatureIndex?ur=ue.textFeatureIndex:re.useRuntimeCollisionCircles&&(ur=re.featureIndex),ue.verticalTextFeatureIndex&&(Zr=ue.verticalTextFeatureIndex);const bs=ue.textBox;if(bs){const or=$i=>{let ar=l.ah.horizontal;if(v.allowVerticalPlacement&&!$i&&this.prevPlacement){const ws=this.prevPlacement.placedOrientations[re.crossTileID];ws&&(this.placedOrientations[re.crossTileID]=ws,ar=ws,this.markUsedOrientation(v,ar,re))}return ar},dr=($i,ar)=>{if(v.allowVerticalPlacement&&re.numVerticalGlyphVertices>0&&ue.verticalTextBox){for(const ws of v.writingModes)if(ws===l.ah.vertical?(xi=ar(),Ui=xi):xi=$i(),xi&&xi.box&&xi.box.length)break}else xi=$i()},Br=re.textAnchorOffsetStartIndex,sn=re.textAnchorOffsetEndIndex;if(sn===Br){const $i=(ar,ws)=>{const qr=this.collisionIndex.placeCollisionBox(ar,G,b,B,z.predicate,Xt);return qr&&qr.box&&qr.box.length&&(this.markUsedOrientation(v,ws,re),this.placedOrientations[re.crossTileID]=ws),qr};dr(()=>$i(bs,l.ah.horizontal),()=>{const ar=ue.verticalTextBox;return v.allowVerticalPlacement&&re.numVerticalGlyphVertices>0&&ar?$i(ar,l.ah.vertical):{box:null,offscreen:null}}),or(xi&&xi.box&&xi.box.length)}else{let $i=l.ap[(xe=(Pe=this.prevPlacement)===null||Pe===void 0?void 0:Pe.variableOffsets[re.crossTileID])===null||xe===void 0?void 0:xe.anchor];const ar=(qr,Na,$r)=>{const su=qr.x2-qr.x1,al=qr.y2-qr.y1,fh=re.textBoxScale,gh=Tt&&lt==="never"?Na:null;let Ro={box:[],offscreen:!1},ns=G==="never"?1:2,wn="never";$i&&ns++;for(let ko=0;ko<ns;ko++){for(let ho=Br;ho<sn;ho++){const mh=v.textAnchorOffsets.get(ho);if($i&&mh.textAnchor!==$i)continue;const Hl=this.attemptAnchorPlacement(mh,qr,su,al,fh,ut,dt,b,B,z,wn,re,v,$r,gh,Xt);if(Hl&&(Ro=Hl.placedGlyphBoxes,Ro&&Ro.box&&Ro.box.length))return Oe=!0,_i=Hl.shift,Ro}$i?$i=null:wn=G}return Ro};dr(()=>ar(bs,ue.iconBox,l.ah.horizontal),()=>{const qr=ue.verticalTextBox;return v.allowVerticalPlacement&&!(xi&&xi.box&&xi.box.length)&&re.numVerticalGlyphVertices>0&&qr?ar(qr,ue.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),xi&&(Oe=xi.box,We=xi.offscreen);const ws=or(xi&&xi.box);if(!Oe&&this.prevPlacement){const qr=this.prevPlacement.variableOffsets[re.crossTileID];qr&&(this.variableOffsets[re.crossTileID]=qr,this.markUsedJustification(v,qr.anchor,re,ws))}}}if(gi=xi,Oe=gi&&gi.box&&gi.box.length>0,We=gi&&gi.offscreen,re.useRuntimeCollisionCircles){const or=v.text.placedSymbolArray.get(re.centerJustifiedTextSymbolIndex),dr=l.ai(v.textSizeData,O,or),Br=E.get("text-padding");Ni=this.collisionIndex.placeCollisionCircles(G,or,v.lineVertexArray,v.glyphOffsetArray,dr,B,k,g,m,dt,z.predicate,re.collisionCircleDiameter,Br,Xt),Ni.circles.length&&Ni.collisionDetected&&!m&&l.w("Collisions detected, but collision boxes are not shown"),Oe=J||Ni.circles.length>0&&!Ni.collisionDetected,We=We&&Ni.offscreen}if(ue.iconFeatureIndex&&(Zi=ue.iconFeatureIndex),ue.iconBox){const or=dr=>{const Br=Tt&&_i?Ar(dr,_i.x,_i.y,ut,dt,this.transform.angle):dr;return this.collisionIndex.placeCollisionBox(Br,lt,b,B,z.predicate,Xt)};Ui&&Ui.box&&Ui.box.length&&ue.verticalIconBox?(Er=or(ue.verticalIconBox),Xe=Er.box.length>0):(Er=or(ue.iconBox),Xe=Er.box.length>0),We=We&&Er.offscreen}const ps=U||re.numHorizontalGlyphVertices===0&&re.numVerticalGlyphVertices===0,Vr=V||re.numIconVertices===0;if(ps||Vr?Vr?ps||(Xe=Xe&&Oe):Oe=Xe&&Oe:Xe=Oe=Xe&&Oe,Oe&&gi&&gi.box&&this.collisionIndex.insertCollisionBox(gi.box,G,E.get("text-ignore-placement"),v.bucketInstanceId,Ui&&Ui.box&&Zr?Zr:ur,z.ID),Xe&&Er&&this.collisionIndex.insertCollisionBox(Er.box,lt,E.get("icon-ignore-placement"),v.bucketInstanceId,Zi,z.ID),Ni&&(Oe&&this.collisionIndex.insertCollisionCircles(Ni.circles,G,E.get("text-ignore-placement"),v.bucketInstanceId,ur,z.ID),m)){const or=v.bucketInstanceId;let dr=this.collisionCircleArrays[or];dr===void 0&&(dr=this.collisionCircleArrays[or]=new tr);for(let Br=0;Br<Ni.circles.length;Br+=4)dr.circles.push(Ni.circles[Br+0]),dr.circles.push(Ni.circles[Br+1]),dr.circles.push(Ni.circles[Br+2]),dr.circles.push(Ni.collisionDetected?1:0)}if(re.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[re.crossTileID]=new qi(Oe||gt,Xe||mt,We||v.justReloaded),d[re.crossTileID]=!0};if(wt){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const re=v.getSortedSymbolIndexes(this.transform.angle);for(let ue=re.length-1;ue>=0;--ue){const Pe=re[ue];ie(v.symbolInstances.get(Pe),v.collisionArrays[Pe])}}else for(let re=a.symbolInstanceStart;re<a.symbolInstanceEnd;re++)ie(v.symbolInstances.get(re),v.collisionArrays[re]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[v.bucketInstanceId];l.ar(re.invProjMatrix,B),re.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(a,d,m,v){let E;E=v===l.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.as(d)];const B=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const k of B)k>=0&&(a.text.placedSymbolArray.get(k).crossTileID=E>=0&&k!==E?0:m.crossTileID)}markUsedOrientation(a,d,m){const v=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,E=d===l.ah.vertical?d:0,B=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const k of B)a.text.placedSymbolArray.get(k).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const v=d?d.symbolFadeChange(a):1,E=d?d.opacities:{},B=d?d.variableOffsets:{},k=d?d.placedOrientations:{};for(const g in this.placements){const b=this.placements[g],C=E[g];C?(this.opacities[g]=new ki(C,v,b.text,b.icon),m=m||b.text!==C.text.placed||b.icon!==C.icon.placed):(this.opacities[g]=new ki(null,v,b.text,b.icon,b.skipFade),m=m||b.text||b.icon)}for(const g in E){const b=E[g];if(!this.opacities[g]){const C=new ki(b,v,!1,!1);C.isHidden()||(this.opacities[g]=C,m=m||b.text.placed||b.icon.placed)}}for(const g in B)this.variableOffsets[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.variableOffsets[g]=B[g]);for(const g in k)this.placedOrientations[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.placedOrientations[g]=k[g]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const m={};for(const v of d){const E=v.getBucket(a);E&&v.latestFeatureIndex&&a.id===E.layerIds[0]&&this.updateBucketOpacities(E,m,v.collisionBoxArray)}}updateBucketOpacities(a,d,m){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const v=a.layers[0],E=v.layout,B=new ki(null,0,!1,!1,!0),k=E.get("text-allow-overlap"),g=E.get("icon-allow-overlap"),b=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),C=E.get("text-rotation-alignment")==="map",M=E.get("text-pitch-alignment")==="map",O=E.get("icon-text-fit")!=="none",z=new ki(null,0,k&&(g||!a.hasIconData()||E.get("icon-optional")),g&&(k||!a.hasTextData()||E.get("text-optional")),!0);!a.collisionArrays&&m&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(m);const U=(V,G,J)=>{for(let lt=0;lt<G/4;lt++)V.opacityVertexArray.emplaceBack(J);V.hasVisibleVertices=V.hasVisibleVertices||J!==gr};for(let V=0;V<a.symbolInstances.length;V++){const G=a.symbolInstances.get(V),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:lt,crossTileID:tt}=G;let ut=this.opacities[tt];d[tt]?ut=B:ut||(ut=z,this.opacities[tt]=ut),d[tt]=!0;const dt=G.numIconVertices>0,Tt=this.placedOrientations[G.crossTileID],wt=Tt===l.ah.vertical,gt=Tt===l.ah.horizontal||Tt===l.ah.horizontalOnly;if(J>0||lt>0){const mt=In(ut.text);U(a.text,J,wt?gr:mt),U(a.text,lt,gt?gr:mt);const Dt=ut.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(re=>{re>=0&&(a.text.placedSymbolArray.get(re).hidden=Dt||wt?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=Dt||gt?1:0);const Xt=this.variableOffsets[G.crossTileID];Xt&&this.markUsedJustification(a,Xt.anchor,G,Tt);const ie=this.placedOrientations[G.crossTileID];ie&&(this.markUsedJustification(a,"left",G,ie),this.markUsedOrientation(a,ie,G))}if(dt){const mt=In(ut.icon),Dt=!(O&&G.verticalPlacedIconSymbolIndex&&wt);G.placedIconSymbolIndex>=0&&(U(a.icon,G.numIconVertices,Dt?mt:gr),a.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=ut.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(U(a.icon,G.numVerticalIconVertices,Dt?gr:mt),a.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=ut.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const mt=a.collisionArrays[V];if(mt){let Dt=new l.P(0,0);if(mt.textBox||mt.verticalTextBox){let ie=!0;if(b){const re=this.variableOffsets[tt];re?(Dt=sr(re.anchor,re.width,re.height,re.textOffset,re.textBoxScale),C&&Dt._rotate(M?this.transform.angle:-this.transform.angle)):ie=!1}mt.textBox&&nr(a.textCollisionBox.collisionVertexArray,ut.text.placed,!ie||wt,Dt.x,Dt.y),mt.verticalTextBox&&nr(a.textCollisionBox.collisionVertexArray,ut.text.placed,!ie||gt,Dt.x,Dt.y)}const Xt=!!(!gt&&mt.verticalIconBox);mt.iconBox&&nr(a.iconCollisionBox.collisionVertexArray,ut.icon.placed,Xt,O?Dt.x:0,O?Dt.y:0),mt.verticalIconBox&&nr(a.iconCollisionBox.collisionVertexArray,ut.icon.placed,!Xt,O?Dt.x:0,O?Dt.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const V=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=V.invProjMatrix,a.placementViewportMatrix=V.viewportMatrix,a.collisionCircleArray=V.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>a}setStale(){this.stale=!0}}function nr(w,a,d,m,v){w.emplaceBack(a?1:0,d?1:0,m||0,v||0),w.emplaceBack(a?1:0,d?1:0,m||0,v||0),w.emplaceBack(a?1:0,d?1:0,m||0,v||0),w.emplaceBack(a?1:0,d?1:0,m||0,v||0)}const pn=Math.pow(2,25),Tl=Math.pow(2,24),Wi=Math.pow(2,17),ms=Math.pow(2,16),Hs=Math.pow(2,9),Rr=Math.pow(2,8),kr=Math.pow(2,1);function In(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const a=w.placed?1:0,d=Math.floor(127*w.opacity);return d*pn+a*Tl+d*Wi+a*ms+d*Hs+a*Rr+d*kr+a}const gr=0;class Or{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,d,m,v,E){const B=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(B,v,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,B.sort((k,g)=>k.sortKey-g.sortKey));this._currentPartIndex<B.length;)if(d.placeLayerBucketPart(B[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,E())return!0;return!1}}class Ka{constructor(a,d,m,v,E,B,k,g){this.placement=new Qr(a,d,B,k,g),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(a,d,m){const v=T.now(),E=()=>!this._forceFullPlacement&&T.now()-v>2;for(;this._currentPlacementIndex>=0;){const B=d[a[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=k)&&(!B.maxzoom||B.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Or(B)),this._inProgressLayer.continuePlacement(m[B.source],this.placement,this._showCollisionBoxes,B,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Ms=512/l.W/2;class Sr{constructor(a,d,m){this.tileID=a,this.bucketInstanceId=m,this._symbolsByKey={};const v=new Map;for(let E=0;E<d.length;E++){const B=d.get(E),k=B.key,g=v.get(k);g?g.push(B):v.set(k,[B])}for(const[E,B]of v){const k={positions:B.map(g=>({x:Math.floor(g.anchorX*Ms),y:Math.floor(g.anchorY*Ms)})),crossTileIDs:B.map(g=>g.crossTileID)};if(k.positions.length>128){const g=new l.au(k.positions.length,16,Uint16Array);for(const{x:b,y:C}of k.positions)g.add(b,C);g.finish(),delete k.positions,k.index=g}this._symbolsByKey[E]=k}}getScaledCoordinates(a,d){const{x:m,y:v,z:E}=this.tileID.canonical,{x:B,y:k,z:g}=d.canonical,b=Ms/Math.pow(2,g-E),C=(k*l.W+a.anchorY)*b,M=v*l.W*Ms;return{x:Math.floor((B*l.W+a.anchorX)*b-m*l.W*Ms),y:Math.floor(C-M)}}findMatches(a,d,m){const v=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let E=0;E<a.length;E++){const B=a.get(E);if(B.crossTileID)continue;const k=this._symbolsByKey[B.key];if(!k)continue;const g=this.getScaledCoordinates(B,d);if(k.index){const b=k.index.range(g.x-v,g.y-v,g.x+v,g.y+v).sort();for(const C of b){const M=k.crossTileIDs[C];if(!m[M]){m[M]=!0,B.crossTileID=M;break}}}else if(k.positions)for(let b=0;b<k.positions.length;b++){const C=k.positions[b],M=k.crossTileIDs[b];if(Math.abs(C.x-g.x)<=v&&Math.abs(C.y-g.y)<=v&&!m[M]){m[M]=!0,B.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(a=>{let{crossTileIDs:d}=a;return d})}}class Ji{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ws{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(d!==0)for(const m in this.indexes){const v=this.indexes[m],E={};for(const B in v){const k=v[B];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+d),E[k.tileID.key]=k}this.indexes[m]=E}this.lng=a}addBucket(a,d,m){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const v=this.usedCrossTileIDs[a.overscaledZ];for(const E in this.indexes){const B=this.indexes[E];if(Number(E)>a.overscaledZ)for(const k in B){const g=B[k];g.tileID.isChildOf(a)&&g.findMatches(d.symbolInstances,a,v)}else{const k=B[a.scaledTo(Number(E)).key];k&&k.findMatches(d.symbolInstances,a,v)}}for(let E=0;E<d.symbolInstances.length;E++){const B=d.symbolInstances.get(E);B.crossTileID||(B.crossTileID=m.generate(),v[B.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Sr(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const m of d.getCrossTileIDsLists())for(const v of m)delete this.usedCrossTileIDs[a][v]}removeStaleBuckets(a){let d=!1;for(const m in this.indexes){const v=this.indexes[m];for(const E in v)a[v[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[E]),delete v[E],d=!0)}return d}}class mr{constructor(){this.layerIndexes={},this.crossTileIDs=new Ji,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,m){let v=this.layerIndexes[a.id];v===void 0&&(v=this.layerIndexes[a.id]=new Ws);let E=!1;const B={};v.handleWrapJump(m);for(const k of d){const g=k.getBucket(a);g&&a.id===g.layerIds[0]&&(g.bucketInstanceId||(g.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(k.tileID,g,this.crossTileIDs)&&(E=!0),B[g.bucketInstanceId]=!0)}return v.removeStaleBuckets(B)&&(E=!0),E}pruneUnusedLayers(a){const d={};a.forEach(m=>{d[m]=!0});for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}const Qs=(w,a)=>l.t(w,a&&a.filter(d=>d.identifier!=="source.canvas")),us=l.av();class wo extends l.E{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const v=this.sourceCaches[m].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[m].reload()}},this.map=a,this.dispatcher=new ee($t(),a._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,v)=>this.getGlyphs(m,v)),this.dispatcher.registerMessageHandler("GI",(m,v)=>this.getImages(m,v)),this.imageManager=new Bt,this.imageManager.setEventedParent(this),this.glyphManager=new le(a._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Me(256,512),this.crossTileSymbolIndex=new mr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),ai().on(Ii,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const v=this.sourceCaches[m.sourceId];if(!v)return;const E=v.getSource();if(E&&E.vectorLayerIds)for(const B in this._layers){const k=this._layers[B];k.source===E.id&&this._validateLayer(k)}})}loadURL(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const v=this.map._requestManager.transformRequest(a,"Style");this._loadStyleRequest=new AbortController,l.h(v,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,d,m)}).catch(E=>{this._loadStyleRequest=null,E&&this.fire(new l.j(E))})}loadJSON(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(a,d,m)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(us,{validate:!1})}_load(a,d,m){var v;const E=d.transformStyle?d.transformStyle(m,a):a;if(!d.validate||!Qs(this,l.x(E))){this._loaded=!0,this.stylesheet=E;for(const B in E.sources)this.addSource(B,E.sources[B],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new de(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const a=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",a),this._order=a.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of a){const m=l.az(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(E,B,k,g){return l._(this,void 0,void 0,function*(){const b=zt(E),C=k>1?"@2x":"",M={},O={};for(const{id:z,url:U}of b){const V=B.transformRequest(B.normalizeSpriteURL(U,C,".json"),"SpriteJSON");M[z]=l.h(V,g);const G=B.transformRequest(B.normalizeSpriteURL(U,C,".png"),"SpriteImage");O[z]=ht.getImage(G,g)}return yield Promise.all([...Object.values(M),...Object.values(O)]),function(z,U){return l._(this,void 0,void 0,function*(){const V={};for(const G in z){V[G]={};const J=T.getImageCanvasContext((yield U[G]).data),lt=(yield z[G]).data;for(const tt in lt){const{width:ut,height:dt,x:Tt,y:wt,sdf:gt,pixelRatio:mt,stretchX:Dt,stretchY:Xt,content:ie,textFitWidth:re,textFitHeight:ue}=lt[tt];V[G][tt]={data:null,pixelRatio:mt,sdf:gt,stretchX:Dt,stretchY:Xt,content:ie,textFitWidth:re,textFitHeight:ue,spriteData:{width:ut,height:dt,x:Tt,y:wt,context:J}}}}return V})}(M,O)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(E=>{if(this._spriteRequest=null,E)for(const B in E){this._spritesImagesIds[B]=[];const k=this._spritesImagesIds[B]?this._spritesImagesIds[B].filter(g=>!(g in E)):[];for(const g of k)this.imageManager.removeImage(g),this._changedImages[g]=!0;for(const g in E[B]){const b=B==="default"?g:`${B}:${g}`;this._spritesImagesIds[B].push(b),b in this.imageManager.images?this.imageManager.updateImage(b,E[B][g],!1):this.imageManager.addImage(b,E[B][g]),d&&(this._changedImages[b]=!0)}}}).catch(E=>{this._spriteRequest=null,v=E,this.fire(new l.j(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),m&&m(v)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(a){const d=this.sourceCaches[a.source];if(!d)return;const m=a.sourceLayer;if(!m)return;const v=d.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(m)===-1)&&this.fire(new l.j(new Error(`Source layer "${m}" does not exist on source "${v.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const d=this._serializedAllLayers();if(!a||a.length===0)return Object.values(d);const m=[];for(const v of a)d[v]&&m.push(d[v]);return m}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const v=this._layers[m];v.type!=="custom"&&(a[m]=v.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const d=this._changed;if(d){const v=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(v.length||E.length)&&this._updateWorkerLayers(v,E);for(const B in this._updatedSources){const k=this._updatedSources[B];if(k==="reload")this._reloadSource(B);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(B)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const B in this._updatedPaintProps)this._layers[B].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const m={};for(const v in this.sourceCaches){const E=this.sourceCaches[v];m[v]=E.used,E.used=!1}for(const v of this._order){const E=this._layers[v];E.recalculate(a,this._availableImages),!E.isHidden(a.zoom)&&E.source&&(this.sourceCaches[E.source].used=!0)}for(const v in m){const E=this.sourceCaches[v];!!m[v]!=!!E.used&&E.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(a),this.z=a.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var m;this._checkLoaded();const v=this.serialize();if(a=d.transformStyle?d.transformStyle(v,a):a,((m=d.validate)===null||m===void 0||m)&&Qs(this,l.x(a)))return!1;(a=l.aA(a)).layers=l.ay(a.layers);const E=l.aB(v,a),B=this._getOperationsToPerform(E);if(B.unimplemented.length>0)throw new Error(`Unimplemented: ${B.unimplemented.join(", ")}.`);if(B.operations.length===0)return!1;for(const k of B.operations)k();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const d=[],m=[];for(const v of a)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":d.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":d.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":d.push(()=>{});break;default:m.push(v.command)}return{operations:d,unimplemented:m}}addImage(a,d){if(this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,d),this._afterImageUpdated(a)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.x.source,`sources.${a}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const v=this.sourceCaches[a]=new me(a,d,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:a})),v.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===a)return this.fire(new l.j(new Error(`Source "${a}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,d){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const m=this.sourceCaches[a].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const v=a.id;if(this.getLayer(v))return void this.fire(new l.j(new Error(`Layer "${v}" already exists on this map.`)));let E;if(a.type==="custom"){if(Qs(this,l.aC(a)))return;E=l.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(v,a.source),a=l.aA(a),a=l.e(a,{source:v})),this._validate(l.x.layer,`layers.${v}`,a,{arrayIndex:-1},m))return;E=l.az(a),this._validateLayer(E),E.setEventedParent(this,{layer:{id:v}})}const B=d?this._order.indexOf(d):this._order.length;if(d&&B===-1)this.fire(new l.j(new Error(`Cannot add layer "${v}" before non-existing layer "${d}".`)));else{if(this._order.splice(B,0,v),this._layerOrderChanged=!0,this._layers[v]=E,this._removedLayers[v]&&E.source&&E.type!=="custom"){const k=this._removedLayers[v];delete this._removedLayers[v],k.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new l.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const m=this._order.indexOf(a);this._order.splice(m,1);const v=d?this._order.indexOf(d):this._order.length;d&&v===-1?this.fire(new l.j(new Error(`Cannot move layer "${a}" before non-existing layer "${d}".`))):(this._order.splice(v,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${a}".`)));d.setEventedParent(null);const m=this._order.indexOf(a);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,d,m){this._checkLoaded();const v=this.getLayer(a);v?v.minzoom===d&&v.maxzoom===m||(d!=null&&(v.minzoom=d),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const v=this.getLayer(a);if(v){if(!l.aD(v.filter,d))return d==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(l.x.filter,`layers.${v.id}.filter`,d,null,m)||(v.filter=l.aA(d),this._updateLayer(v)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return l.aA(this.getLayer(a).filter)}setLayoutProperty(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const E=this.getLayer(a);E?l.aD(E.getLayoutProperty(d),m)||(E.setLayoutProperty(d,m,v),this._updateLayer(E)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,d){const m=this.getLayer(a);if(m)return m.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const E=this.getLayer(a);E?l.aD(E.getPaintProperty(d),m)||(E.setPaintProperty(d,m,v)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[a]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,d){return this.getLayer(a).getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const m=a.source,v=a.sourceLayer,E=this.sourceCaches[m];if(E===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const B=E.getSource().type;B==="geojson"&&v?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||v?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),E.setFeatureState(v,a.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,d){this._checkLoaded();const m=a.source,v=this.sourceCaches[m];if(v===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const E=v.getSource().type,B=E==="vector"?a.sourceLayer:void 0;E!=="vector"||B?d&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(B,a.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const d=a.source,m=a.sourceLayer,v=this.sourceCaches[d];if(v!==void 0)return v.getSource().type!=="vector"||m?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(m,a.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=l.aE(this.sourceCaches,E=>E.serialize()),d=this._serializeByIds(this._order),m=this.map.getTerrain()||void 0,v=this.stylesheet;return l.aF({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:a,layers:d,terrain:m},E=>E!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const d=B=>this._layers[B].type==="fill-extrusion",m={},v=[];for(let B=this._order.length-1;B>=0;B--){const k=this._order[B];if(d(k)){m[k]=B;for(const g of a){const b=g[k];if(b)for(const C of b)v.push(C)}}}v.sort((B,k)=>k.intersectionZ-B.intersectionZ);const E=[];for(let B=this._order.length-1;B>=0;B--){const k=this._order[B];if(d(k))for(let g=v.length-1;g>=0;g--){const b=v[g].feature;if(m[b.layer.id]<B)break;E.push(b),v.pop()}else for(const g of a){const b=g[k];if(b)for(const C of b)E.push(C.feature)}}return E}queryRenderedFeatures(a,d,m){d&&d.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const v={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const k of d.layers){const g=this._layers[k];if(!g)return this.fire(new l.j(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];v[g.source]=!0}}const E=[];d.availableImages=this._availableImages;const B=this._serializedAllLayers();for(const k in this.sourceCaches)d.layers&&!v[k]||E.push(Ie(this.sourceCaches[k],this._layers,B,a,d,m));return this.placement&&E.push(function(k,g,b,C,M,O,z){const U={},V=O.queryRenderedSymbols(C),G=[];for(const J of Object.keys(V).map(Number))G.push(z[J]);G.sort(Re);for(const J of G){const lt=J.featureIndex.lookupSymbolFeatures(V[J.bucketInstanceId],g,J.bucketIndex,J.sourceLayerIndex,M.filter,M.layers,M.availableImages,k);for(const tt in lt){const ut=U[tt]=U[tt]||[],dt=lt[tt];dt.sort((Tt,wt)=>{const gt=J.featureSortOrder;if(gt){const mt=gt.indexOf(Tt.featureIndex);return gt.indexOf(wt.featureIndex)-mt}return wt.featureIndex-Tt.featureIndex});for(const Tt of dt)ut.push(Tt)}}for(const J in U)U[J].forEach(lt=>{const tt=lt.feature,ut=b[k[J].source].getFeatureState(tt.layer["source-layer"],tt.id);tt.source=tt.layer.source,tt.layer["source-layer"]&&(tt.sourceLayer=tt.layer["source-layer"]),tt.state=ut});return U}(this._layers,B,this.sourceCaches,a,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(a,d){d&&d.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[a];return m?function(v,E){const B=v.getRenderableIds().map(b=>v.getTileByID(b)),k=[],g={};for(let b=0;b<B.length;b++){const C=B[b],M=C.tileID.canonical.key;g[M]||(g[M]=!0,C.querySourceFeatures(k,E))}return k}(m,d):[]}getLight(){return this.light.getLight()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const m=this.light.getLight();let v=!1;for(const B in a)if(!l.aD(a[B],m[B])){v=!0;break}if(!v)return;const E={now:T.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,d),this.light.updateTransitions(E)}_validate(a,d,m,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!E||E.validate!==!1)&&Qs(this,a.call(l.x,l.e({key:d,style:this.serialize(),value:m,styleSpec:l.v},v)))}_remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ai().off(Ii,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const d in this.sourceCaches)this.sourceCaches[d].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,d,m,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,B=!1,k=!1;const g={};for(const b of this._order){const C=this._layers[b];if(C.type!=="symbol")continue;if(!g[C.source]){const O=this.sourceCaches[C.source];g[C.source]=O.getRenderableIds(!0).map(z=>O.getTileByID(z)).sort((z,U)=>U.tileID.overscaledZ-z.tileID.overscaledZ||(z.tileID.isLessThan(U.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(C,g[C.source],a.center.lng);B=B||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now(),a.zoom))&&(this.pauseablePlacement=new Ka(a,this.map.terrain,this._order,E,d,m,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,g),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.now()),k=!0),B&&this.pauseablePlacement.placement.setStale()),k||B)for(const b of this._order){const C=this._layers[b];C.type==="symbol"&&this.placement.updateLayerOpacities(C,g[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d){return l._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,d.icons),m})}getGlyphs(a,d){return l._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(d.stacks),v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),a&&this._validate(l.x.glyphs,"glyphs",a,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const E=[{id:a,url:d}],B=[...zt(this.stylesheet.sprite),...E];this._validate(l.x.sprite,"sprite",B,null,m)||(this.stylesheet.sprite=B,this._loadSprite(E,!0,v))}removeSprite(a){this._checkLoaded();const d=zt(this.stylesheet.sprite);if(d.find(m=>m.id===a)){if(this._spritesImagesIds[a])for(const m of this._spritesImagesIds[a])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex(m=>m.id===a),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return zt(this.stylesheet.sprite)}setSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),a&&this._validate(l.x.sprite,"sprite",a,null,d)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,m):(this._unloadSprite(),m&&m(null)))}}var Fr=l.X([{name:"a_pos",type:"Int16",components:2}]),Bs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const rs={prelude:Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Hi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Hi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Bs),terrainDepth:Hi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Bs),terrainCoords:Hi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Bs)};function Hi(w,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=a.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),B=E?E.concat(v):v,k={};return{fragmentSource:w=w.replace(d,(g,b,C,M,O)=>(k[O]=!0,b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${C} ${M} ${O};
#else
uniform ${C} ${M} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${C} ${M} ${O} = u_${O};
#endif
`)),vertexSource:a=a.replace(d,(g,b,C,M,O)=>{const z=M==="float"?"vec2":"vec4",U=O.match(/color/)?"color":z;return k[O]?b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${C} ${z} a_${O};
varying ${C} ${M} ${O};
#else
uniform ${C} ${M} u_${O};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${C} ${M} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${C} ${M} ${O} = u_${O};
#endif
`:b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${C} ${z} a_${O};
#else
uniform ${C} ${M} u_${O};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${C} ${M} ${O} = a_${O};
#else
    ${C} ${M} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${C} ${M} ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${C} ${M} ${O} = u_${O};
#endif
`}),staticAttributes:m,staticUniforms:B}}class Kn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,d,m,v,E,B,k,g,b){this.context=a;let C=this.boundPaintVertexBuffers.length!==v.length;for(let M=0;!C&&M<v.length;M++)this.boundPaintVertexBuffers[M]!==v[M]&&(C=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||C||this.boundIndexBuffer!==E||this.boundVertexOffset!==B||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==g||this.boundDynamicVertexBuffer3!==b?this.freshBind(d,m,v,E,B,k,g,b):(a.bindVertexArray.set(this.vao),k&&k.bind(),E&&E.dynamicDraw&&E.bind(),g&&g.bind(),b&&b.bind())}freshBind(a,d,m,v,E,B,k,g){const b=a.numAttributes,C=this.context,M=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=B,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=g,d.enableAttributes(M,a);for(const O of m)O.enableAttributes(M,a);B&&B.enableAttributes(M,a),k&&k.enableAttributes(M,a),g&&g.enableAttributes(M,a),d.bind(),d.setVertexAttribPointers(M,a,E);for(const O of m)O.bind(),O.setVertexAttribPointers(M,a,E);B&&(B.bind(),B.setVertexAttribPointers(M,a,E)),v&&v.bind(),k&&(k.bind(),k.setVertexAttribPointers(M,a,E)),g&&(g.bind(),g.setVertexAttribPointers(M,a,E)),C.currentNumAttributes=b}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Qn(w){const a=[];for(let d=0;d<w.length;d++){if(w[d]===null)continue;const m=w[d].split(" ");a.push(m.pop())}return a}class Aa{constructor(a,d,m,v,E,B){const k=a.gl;this.program=k.createProgram();const g=Qn(d.staticAttributes),b=m?m.getBinderAttributes():[],C=g.concat(b),M=rs.prelude.staticUniforms?Qn(rs.prelude.staticUniforms):[],O=d.staticUniforms?Qn(d.staticUniforms):[],z=m?m.getBinderUniforms():[],U=M.concat(O).concat(z),V=[];for(const Tt of U)V.indexOf(Tt)<0&&V.push(Tt);const G=m?m.defines():[];E&&G.push("#define OVERDRAW_INSPECTOR;"),B&&G.push("#define TERRAIN3D;");const J=G.concat(rs.prelude.fragmentSource,d.fragmentSource).join(`
`),lt=G.concat(rs.prelude.vertexSource,d.vertexSource).join(`
`),tt=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(tt,J),k.compileShader(tt),!k.getShaderParameter(tt,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(tt)}`);k.attachShader(this.program,tt);const ut=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(ut,lt),k.compileShader(ut),!k.getShaderParameter(ut,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(ut)}`);k.attachShader(this.program,ut),this.attributes={};const dt={};this.numAttributes=C.length;for(let Tt=0;Tt<this.numAttributes;Tt++)C[Tt]&&(k.bindAttribLocation(this.program,Tt,C[Tt]),this.attributes[C[Tt]]=Tt);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(ut),k.deleteShader(tt);for(let Tt=0;Tt<V.length;Tt++){const wt=V[Tt];if(wt&&!dt[wt]){const gt=k.getUniformLocation(this.program,wt);gt&&(dt[wt]=gt)}}this.fixedUniforms=v(a,dt),this.terrainUniforms=((Tt,wt)=>({u_depth:new l.aG(Tt,wt.u_depth),u_terrain:new l.aG(Tt,wt.u_terrain),u_terrain_dim:new l.aH(Tt,wt.u_terrain_dim),u_terrain_matrix:new l.aI(Tt,wt.u_terrain_matrix),u_terrain_unpack:new l.aJ(Tt,wt.u_terrain_unpack),u_terrain_exaggeration:new l.aH(Tt,wt.u_terrain_exaggeration)}))(a,dt),this.binderUniforms=m?m.getUniforms(a,dt):[]}draw(a,d,m,v,E,B,k,g,b,C,M,O,z,U,V,G,J,lt){const tt=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(m),a.setStencilMode(v),a.setColorMode(E),a.setCullFace(B),g){a.activeTexture.set(tt.TEXTURE2),tt.bindTexture(tt.TEXTURE_2D,g.depthTexture),a.activeTexture.set(tt.TEXTURE3),tt.bindTexture(tt.TEXTURE_2D,g.texture);for(const dt in this.terrainUniforms)this.terrainUniforms[dt].set(g[dt])}for(const dt in this.fixedUniforms)this.fixedUniforms[dt].set(k[dt]);V&&V.setUniforms(a,this.binderUniforms,z,{zoom:U});let ut=0;switch(d){case tt.LINES:ut=2;break;case tt.TRIANGLES:ut=3;break;case tt.LINE_STRIP:ut=1}for(const dt of O.get()){const Tt=dt.vaos||(dt.vaos={});(Tt[b]||(Tt[b]=new Kn)).bind(a,this,C,V?V.getPaintVertexBuffers():[],M,dt.vertexOffset,G,J,lt),tt.drawElements(d,dt.primitiveLength*ut,tt.UNSIGNED_SHORT,dt.primitiveOffset*ut*2)}}}function Sa(w,a,d){const m=1/si(d,1,a.transform.tileZoom),v=Math.pow(2,d.tileID.overscaledZ),E=d.tileSize*Math.pow(2,a.transform.tileZoom)/v,B=E*(d.tileID.canonical.x+d.tileID.wrap*v),k=E*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[B>>16,k>>16],u_pixel_coord_lower:[65535&B,65535&k]}}const st=(w,a,d,m)=>{const v=a.style.light,E=v.properties.get("position"),B=[E.x,E.y,E.z],k=function(){var b=new l.A(9);return l.A!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}();v.properties.get("anchor")==="viewport"&&function(b,C){var M=Math.sin(C),O=Math.cos(C);b[0]=O,b[1]=M,b[2]=0,b[3]=-M,b[4]=O,b[5]=0,b[6]=0,b[7]=0,b[8]=1}(k,-a.transform.angle),function(b,C,M){var O=C[0],z=C[1],U=C[2];b[0]=O*M[0]+z*M[3]+U*M[6],b[1]=O*M[1]+z*M[4]+U*M[7],b[2]=O*M[2]+z*M[5]+U*M[8]}(B,B,k);const g=v.properties.get("color");return{u_matrix:w,u_lightpos:B,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_vertical_gradient:+d,u_opacity:m}},yt=(w,a,d,m,v,E,B)=>l.e(st(w,a,d,m),Sa(E,a,B),{u_height_factor:-Math.pow(2,v.overscaledZ)/B.tileSize/8}),Ot=w=>({u_matrix:w}),ce=(w,a,d,m)=>l.e(Ot(w),Sa(d,a,m)),Ee=(w,a)=>({u_matrix:w,u_world:a}),hi=(w,a,d,m,v)=>l.e(ce(w,a,d,m),{u_world:v}),Ti=(w,a,d,m)=>{const v=w.transform;let E,B;if(m.paint.get("circle-pitch-alignment")==="map"){const k=si(d,1,v.zoom);E=!0,B=[k,k]}else E=!1,B=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(a.posMatrix,d,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:B}},cr=(w,a,d)=>{const m=si(d,1,a.zoom),v=Math.pow(2,a.zoom-d.tileID.overscaledZ),E=d.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[a.pixelsToGLUnits[0]/(m*v),a.pixelsToGLUnits[1]/(m*v)],u_overscale_factor:E}},ls=function(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:w,u_color:a,u_overlay:0,u_overlay_scale:d}},ds=w=>({u_matrix:w}),Qi=(w,a,d,m)=>({u_matrix:w,u_extrude_scale:si(a,1,d),u_intensity:m});function Pl(w,a){const d=Math.pow(2,a.canonical.z),m=a.canonical.y;return[new l.Y(0,m/d).toLngLat().lat,new l.Y(0,(m+1)/d).toLngLat().lat]}const ys=(w,a,d,m)=>{const v=w.transform;return{u_matrix:Ll(w,a,d,m),u_ratio:1/si(a,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},yi=(w,a,d,m,v)=>l.e(ys(w,a,d,v),{u_image:0,u_image_height:m}),gc=(w,a,d,m,v)=>{const E=w.transform,B=Ln(a,E);return{u_matrix:Ll(w,a,d,v),u_texsize:a.imageAtlasTexture.size,u_ratio:1/si(a,1,E.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[B,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Il=(w,a,d,m,v,E)=>{const B=w.lineAtlas,k=Ln(a,w.transform),g=d.layout.get("line-cap")==="round",b=B.getDash(m.from,g),C=B.getDash(m.to,g),M=b.width*v.fromScale,O=C.width*v.toScale;return l.e(ys(w,a,d,E),{u_patternscale_a:[k/M,-b.height/2],u_patternscale_b:[k/O,-C.height/2],u_sdfgamma:B.width/(256*Math.min(M,O)*w.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:C.y,u_mix:v.t})};function Ln(w,a){return 1/si(w,1,a.tileZoom)}function Ll(w,a,d,m){return w.translatePosMatrix(m?m.posMatrix:a.tileID.posMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Ho=(w,a,d,m,v)=>{return{u_matrix:w,u_tl_parent:a,u_scale_parent:d,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(B=v.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(E=v.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Ml(v.paint.get("raster-hue-rotate"))};var E,B};function Ml(w){w*=Math.PI/180;const a=Math.sin(w),d=Math.cos(w);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const Bl=(w,a,d,m,v,E,B,k,g,b)=>{const C=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:C.cameraToCenterDistance,u_pitch:C.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:C.width/C.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:B,u_coord_matrix:k,u_is_text:+g,u_pitch_with_map:+m,u_texsize:b,u_texture:0}},Kc=(w,a,d,m,v,E,B,k,g,b,C)=>{const M=v.transform;return l.e(Bl(w,a,d,m,v,E,B,k,g,b),{u_gamma_scale:m?Math.cos(M._pitch)*M.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+C})},$h=(w,a,d,m,v,E,B,k,g,b)=>l.e(Kc(w,a,d,m,v,E,B,k,!0,g,!0),{u_texsize_icon:b,u_texture_icon:1}),Yh=(w,a,d)=>({u_matrix:w,u_opacity:a,u_color:d}),mc=(w,a,d,m,v,E)=>l.e(function(B,k,g,b){const C=g.imageManager.getPattern(B.from.toString()),M=g.imageManager.getPattern(B.to.toString()),{width:O,height:z}=g.imageManager.getPixelSize(),U=Math.pow(2,b.tileID.overscaledZ),V=b.tileSize*Math.pow(2,g.transform.tileZoom)/U,G=V*(b.tileID.canonical.x+b.tileID.wrap*U),J=V*b.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[O,z],u_mix:k.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/si(b,1,g.transform.tileZoom),u_pixel_coord_upper:[G>>16,J>>16],u_pixel_coord_lower:[65535&G,65535&J]}}(m,E,d,v),{u_matrix:w,u_opacity:a}),xo={fillExtrusion:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_lightpos:new l.aK(w,a.u_lightpos),u_lightintensity:new l.aH(w,a.u_lightintensity),u_lightcolor:new l.aK(w,a.u_lightcolor),u_vertical_gradient:new l.aH(w,a.u_vertical_gradient),u_opacity:new l.aH(w,a.u_opacity)}),fillExtrusionPattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_lightpos:new l.aK(w,a.u_lightpos),u_lightintensity:new l.aH(w,a.u_lightintensity),u_lightcolor:new l.aK(w,a.u_lightcolor),u_vertical_gradient:new l.aH(w,a.u_vertical_gradient),u_height_factor:new l.aH(w,a.u_height_factor),u_image:new l.aG(w,a.u_image),u_texsize:new l.aL(w,a.u_texsize),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade),u_opacity:new l.aH(w,a.u_opacity)}),fill:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix)}),fillPattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_image:new l.aG(w,a.u_image),u_texsize:new l.aL(w,a.u_texsize),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade)}),fillOutline:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_world:new l.aL(w,a.u_world)}),fillOutlinePattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_world:new l.aL(w,a.u_world),u_image:new l.aG(w,a.u_image),u_texsize:new l.aL(w,a.u_texsize),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade)}),circle:(w,a)=>({u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_scale_with_map:new l.aG(w,a.u_scale_with_map),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_extrude_scale:new l.aL(w,a.u_extrude_scale),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_matrix:new l.aI(w,a.u_matrix)}),collisionBox:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(w,a.u_pixels_to_tile_units),u_extrude_scale:new l.aL(w,a.u_extrude_scale),u_overscale_factor:new l.aH(w,a.u_overscale_factor)}),collisionCircle:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_inv_matrix:new l.aI(w,a.u_inv_matrix),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_viewport_size:new l.aL(w,a.u_viewport_size)}),debug:(w,a)=>({u_color:new l.aM(w,a.u_color),u_matrix:new l.aI(w,a.u_matrix),u_overlay:new l.aG(w,a.u_overlay),u_overlay_scale:new l.aH(w,a.u_overlay_scale)}),clippingMask:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix)}),heatmap:(w,a)=>({u_extrude_scale:new l.aH(w,a.u_extrude_scale),u_intensity:new l.aH(w,a.u_intensity),u_matrix:new l.aI(w,a.u_matrix)}),heatmapTexture:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_world:new l.aL(w,a.u_world),u_image:new l.aG(w,a.u_image),u_color_ramp:new l.aG(w,a.u_color_ramp),u_opacity:new l.aH(w,a.u_opacity)}),hillshade:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_image:new l.aG(w,a.u_image),u_latrange:new l.aL(w,a.u_latrange),u_light:new l.aL(w,a.u_light),u_shadow:new l.aM(w,a.u_shadow),u_highlight:new l.aM(w,a.u_highlight),u_accent:new l.aM(w,a.u_accent)}),hillshadePrepare:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_image:new l.aG(w,a.u_image),u_dimension:new l.aL(w,a.u_dimension),u_zoom:new l.aH(w,a.u_zoom),u_unpack:new l.aJ(w,a.u_unpack)}),line:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels)}),lineGradient:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels),u_image:new l.aG(w,a.u_image),u_image_height:new l.aH(w,a.u_image_height)}),linePattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_texsize:new l.aL(w,a.u_texsize),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_image:new l.aG(w,a.u_image),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade)}),lineSDF:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels),u_patternscale_a:new l.aL(w,a.u_patternscale_a),u_patternscale_b:new l.aL(w,a.u_patternscale_b),u_sdfgamma:new l.aH(w,a.u_sdfgamma),u_image:new l.aG(w,a.u_image),u_tex_y_a:new l.aH(w,a.u_tex_y_a),u_tex_y_b:new l.aH(w,a.u_tex_y_b),u_mix:new l.aH(w,a.u_mix)}),raster:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_tl_parent:new l.aL(w,a.u_tl_parent),u_scale_parent:new l.aH(w,a.u_scale_parent),u_buffer_scale:new l.aH(w,a.u_buffer_scale),u_fade_t:new l.aH(w,a.u_fade_t),u_opacity:new l.aH(w,a.u_opacity),u_image0:new l.aG(w,a.u_image0),u_image1:new l.aG(w,a.u_image1),u_brightness_low:new l.aH(w,a.u_brightness_low),u_brightness_high:new l.aH(w,a.u_brightness_high),u_saturation_factor:new l.aH(w,a.u_saturation_factor),u_contrast_factor:new l.aH(w,a.u_contrast_factor),u_spin_weights:new l.aK(w,a.u_spin_weights)}),symbolIcon:(w,a)=>({u_is_size_zoom_constant:new l.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(w,a.u_is_size_feature_constant),u_size_t:new l.aH(w,a.u_size_t),u_size:new l.aH(w,a.u_size),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pitch:new l.aH(w,a.u_pitch),u_rotate_symbol:new l.aG(w,a.u_rotate_symbol),u_aspect_ratio:new l.aH(w,a.u_aspect_ratio),u_fade_change:new l.aH(w,a.u_fade_change),u_matrix:new l.aI(w,a.u_matrix),u_label_plane_matrix:new l.aI(w,a.u_label_plane_matrix),u_coord_matrix:new l.aI(w,a.u_coord_matrix),u_is_text:new l.aG(w,a.u_is_text),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_texsize:new l.aL(w,a.u_texsize),u_texture:new l.aG(w,a.u_texture)}),symbolSDF:(w,a)=>({u_is_size_zoom_constant:new l.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(w,a.u_is_size_feature_constant),u_size_t:new l.aH(w,a.u_size_t),u_size:new l.aH(w,a.u_size),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pitch:new l.aH(w,a.u_pitch),u_rotate_symbol:new l.aG(w,a.u_rotate_symbol),u_aspect_ratio:new l.aH(w,a.u_aspect_ratio),u_fade_change:new l.aH(w,a.u_fade_change),u_matrix:new l.aI(w,a.u_matrix),u_label_plane_matrix:new l.aI(w,a.u_label_plane_matrix),u_coord_matrix:new l.aI(w,a.u_coord_matrix),u_is_text:new l.aG(w,a.u_is_text),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_texsize:new l.aL(w,a.u_texsize),u_texture:new l.aG(w,a.u_texture),u_gamma_scale:new l.aH(w,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_is_halo:new l.aG(w,a.u_is_halo)}),symbolTextAndIcon:(w,a)=>({u_is_size_zoom_constant:new l.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(w,a.u_is_size_feature_constant),u_size_t:new l.aH(w,a.u_size_t),u_size:new l.aH(w,a.u_size),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pitch:new l.aH(w,a.u_pitch),u_rotate_symbol:new l.aG(w,a.u_rotate_symbol),u_aspect_ratio:new l.aH(w,a.u_aspect_ratio),u_fade_change:new l.aH(w,a.u_fade_change),u_matrix:new l.aI(w,a.u_matrix),u_label_plane_matrix:new l.aI(w,a.u_label_plane_matrix),u_coord_matrix:new l.aI(w,a.u_coord_matrix),u_is_text:new l.aG(w,a.u_is_text),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_texsize:new l.aL(w,a.u_texsize),u_texsize_icon:new l.aL(w,a.u_texsize_icon),u_texture:new l.aG(w,a.u_texture),u_texture_icon:new l.aG(w,a.u_texture_icon),u_gamma_scale:new l.aH(w,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_is_halo:new l.aG(w,a.u_is_halo)}),background:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_opacity:new l.aH(w,a.u_opacity),u_color:new l.aM(w,a.u_color)}),backgroundPattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_opacity:new l.aH(w,a.u_opacity),u_image:new l.aG(w,a.u_image),u_pattern_tl_a:new l.aL(w,a.u_pattern_tl_a),u_pattern_br_a:new l.aL(w,a.u_pattern_br_a),u_pattern_tl_b:new l.aL(w,a.u_pattern_tl_b),u_pattern_br_b:new l.aL(w,a.u_pattern_br_b),u_texsize:new l.aL(w,a.u_texsize),u_mix:new l.aH(w,a.u_mix),u_pattern_size_a:new l.aL(w,a.u_pattern_size_a),u_pattern_size_b:new l.aL(w,a.u_pattern_size_b),u_scale_a:new l.aH(w,a.u_scale_a),u_scale_b:new l.aH(w,a.u_scale_b),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(w,a.u_tile_units_to_pixels)}),terrain:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_texture:new l.aG(w,a.u_texture),u_ele_delta:new l.aH(w,a.u_ele_delta)}),terrainDepth:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ele_delta:new l.aH(w,a.u_ele_delta)}),terrainCoords:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_texture:new l.aG(w,a.u_texture),u_terrain_coords_id:new l.aH(w,a.u_terrain_coords_id),u_ele_delta:new l.aH(w,a.u_ele_delta)})};class Ao{constructor(a,d,m){this.context=a;const v=a.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Rl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wo{constructor(a,d,m,v){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=v,this.context=a;const E=a.gl;this.buffer=E.createBuffer(),a.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let m=0;m<this.attributes.length;m++){const v=d.attributes[this.attributes[m].name];v!==void 0&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,d,m){for(let v=0;v<this.attributes.length;v++){const E=this.attributes[v],B=d.attributes[E.name];B!==void 0&&a.vertexAttribPointer(B,E.components,a[Rl[E.type]],!1,this.itemSize,E.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Jo=new WeakMap;function _s(w){var a;if(Jo.has(w))return Jo.get(w);{const d=(a=w.getParameter(w.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return Jo.set(w,d),d}}class Yi{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kl extends Yi{getDefault(){return l.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Ea extends Yi{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Ca extends Yi{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Xo extends Yi{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class to extends Yi{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Kh extends Yi{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class fn extends Yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class eo extends Yi{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Ol extends Yi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class Qa extends Yi{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Qc extends Yi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class Ta extends Yi{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class th extends Yi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class Fl extends Yi{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Nl extends Yi{getDefault(){return l.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class yc extends Yi{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Mn extends Yi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class Dl extends Yi{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class _c extends Yi{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class eh extends Yi{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class ih extends Yi{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class So extends Yi{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class tl extends Yi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Pa extends Yi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ia extends Yi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class vc extends Yi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class F extends Yi{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class et extends Yi{getDefault(){return null}set(a){var d;if(a===this.current&&!this.dirty)return;const m=this.gl;_s(m)?m.bindVertexArray(a):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class Pt extends Yi{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class jt extends Yi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Yt extends Yi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class pe extends Yi{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class Te extends pe{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Ye extends pe{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class bi extends pe{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Li{constructor(a,d,m,v,E){this.context=a,this.width=d,this.height=m;const B=a.gl,k=this.framebuffer=B.createFramebuffer();if(this.colorAttachment=new Te(a,k),v)this.depthAttachment=E?new bi(a,k):new Ye(a,k);else if(E)throw new Error("Stencil cannot be set without depth");if(B.checkFramebufferStatus(B.FRAMEBUFFER)!==B.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&a.deleteRenderbuffer(m)}a.deleteFramebuffer(this.framebuffer)}}class ui{constructor(a,d,m){this.blendFunction=a,this.blendColor=d,this.mask=m}}ui.Replace=[1,0],ui.disabled=new ui(ui.Replace,l.aO.transparent,[!1,!1,!1,!1]),ui.unblended=new ui(ui.Replace,l.aO.transparent,[!0,!0,!0,!0]),ui.alphaBlended=new ui([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Xi{constructor(a){var d,m;if(this.gl=a,this.clearColor=new kl(this),this.clearDepth=new Ea(this),this.clearStencil=new Ca(this),this.colorMask=new Xo(this),this.depthMask=new to(this),this.stencilMask=new Kh(this),this.stencilFunc=new fn(this),this.stencilOp=new eo(this),this.stencilTest=new Ol(this),this.depthRange=new Qa(this),this.depthTest=new Qc(this),this.depthFunc=new Ta(this),this.blend=new th(this),this.blendFunc=new Fl(this),this.blendColor=new Nl(this),this.blendEquation=new yc(this),this.cullFace=new Mn(this),this.cullFaceSide=new Dl(this),this.frontFace=new _c(this),this.program=new eh(this),this.activeTexture=new ih(this),this.viewport=new So(this),this.bindFramebuffer=new tl(this),this.bindRenderbuffer=new Pa(this),this.bindTexture=new Ia(this),this.bindVertexBuffer=new vc(this),this.bindElementBuffer=new F(this),this.bindVertexArray=new et(this),this.pixelStoreUnpack=new Pt(this),this.pixelStoreUnpackPremultiplyAlpha=new jt(this),this.pixelStoreUnpackFlipY=new Yt(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),_s(a)){this.HALF_FLOAT=a.HALF_FLOAT;const v=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=a.RGBA16F)!==null&&d!==void 0?d:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(m=a.RGB16F)!==null&&m!==void 0?m:v==null?void 0:v.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const v=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new Ao(this,a,d)}createVertexBuffer(a,d,m){return new Wo(this,a,d,m)}createRenderbuffer(a,d,m){const v=this.gl,E=v.createRenderbuffer();return this.bindRenderbuffer.set(E),v.renderbufferStorage(v.RENDERBUFFER,a,d,m),this.bindRenderbuffer.set(null),E}createFramebuffer(a,d,m,v){return new Li(this,a,d,m,v)}clear(a){let{color:d,depth:m,stencil:v}=a;const E=this.gl;let B=0;d&&(B|=E.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(B|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),v!==void 0&&(B|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),E.clear(B)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){l.aD(a.blendFunction,ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return _s(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var d;return _s(this.gl)?this.gl.deleteVertexArray(a):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class ni{constructor(a,d,m){this.func=a,this.mask=d,this.range=m}}ni.ReadOnly=!1,ni.ReadWrite=!0,ni.disabled=new ni(519,ni.ReadOnly,[0,1]);const Nr=7680;class Oi{constructor(a,d,m,v,E,B){this.test=a,this.ref=d,this.mask=m,this.fail=v,this.depthFail=E,this.pass=B}}Oi.disabled=new Oi({func:519,mask:0},0,0,Nr,Nr,Nr);class zi{constructor(a,d,m){this.enable=a,this.mode=d,this.frontFace=m}}let ss;function Bn(w,a,d,m,v,E,B){const k=w.context,g=k.gl,b=w.useProgram("collisionBox"),C=[];let M=0,O=0;for(let tt=0;tt<m.length;tt++){const ut=m[tt],dt=a.getTile(ut),Tt=dt.getBucket(d);if(!Tt)continue;let wt=ut.posMatrix;v[0]===0&&v[1]===0||(wt=w.translatePosMatrix(ut.posMatrix,dt,v,E));const gt=B?Tt.textCollisionBox:Tt.iconCollisionBox,mt=Tt.collisionCircleArray;if(mt.length>0){const Dt=l.F(),Xt=wt;l.aP(Dt,Tt.placementInvProjMatrix,w.transform.glCoordMatrix),l.aP(Dt,Dt,Tt.placementViewportMatrix),C.push({circleArray:mt,circleOffset:O,transform:Xt,invTransform:Dt,coord:ut}),M+=mt.length/4,O=M}gt&&b.draw(k,g.LINES,ni.disabled,Oi.disabled,w.colorModeForRenderPass(),zi.disabled,cr(wt,w.transform,dt),w.style.map.terrain&&w.style.map.terrain.getTerrainData(ut),d.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,null,w.transform.zoom,null,null,gt.collisionVertexBuffer)}if(!B||!C.length)return;const z=w.useProgram("collisionCircle"),U=new l.aQ;U.resize(4*M),U._trim();let V=0;for(const tt of C)for(let ut=0;ut<tt.circleArray.length/4;ut++){const dt=4*ut,Tt=tt.circleArray[dt+0],wt=tt.circleArray[dt+1],gt=tt.circleArray[dt+2],mt=tt.circleArray[dt+3];U.emplace(V++,Tt,wt,gt,mt,0),U.emplace(V++,Tt,wt,gt,mt,1),U.emplace(V++,Tt,wt,gt,mt,2),U.emplace(V++,Tt,wt,gt,mt,3)}(!ss||ss.length<2*M)&&(ss=function(tt){const ut=2*tt,dt=new l.aS;dt.resize(ut),dt._trim();for(let Tt=0;Tt<ut;Tt++){const wt=6*Tt;dt.uint16[wt+0]=4*Tt+0,dt.uint16[wt+1]=4*Tt+1,dt.uint16[wt+2]=4*Tt+2,dt.uint16[wt+3]=4*Tt+2,dt.uint16[wt+4]=4*Tt+3,dt.uint16[wt+5]=4*Tt+0}return dt}(M));const G=k.createIndexBuffer(ss,!0),J=k.createVertexBuffer(U,l.aR.members,!0);for(const tt of C){const ut={u_matrix:tt.transform,u_inv_matrix:tt.invTransform,u_camera_to_center_distance:(lt=w.transform).cameraToCenterDistance,u_viewport_size:[lt.width,lt.height]};z.draw(k,g.TRIANGLES,ni.disabled,Oi.disabled,w.colorModeForRenderPass(),zi.disabled,ut,w.style.map.terrain&&w.style.map.terrain.getTerrainData(tt.coord),d.id,J,G,l.$.simpleSegment(0,2*tt.circleOffset,tt.circleArray.length,tt.circleArray.length/2),null,w.transform.zoom,null,null,null)}var lt;J.destroy(),G.destroy()}zi.disabled=new zi(!1,1029,2305),zi.backCCW=new zi(!0,1029,2305);const gn=l.an(new Float32Array(16));function Zo(w,a,d,m,v,E){const{horizontalAlign:B,verticalAlign:k}=l.at(w);return new l.P((-(B-.5)*a/v+m[0])*E,(-(k-.5)*d/v+m[1])*E)}function bc(w,a,d,m,v,E,B,k,g,b,C){const M=w.text.placedSymbolArray,O=w.text.dynamicLayoutVertexArray,z=w.icon.dynamicLayoutVertexArray,U={};O.clear();for(let V=0;V<M.length;V++){const G=M.get(V),J=G.hidden||!G.crossTileID||w.allowVerticalPlacement&&!G.placedOrientation?null:m[G.crossTileID];if(J){const lt=new l.P(G.anchorX,G.anchorY),tt=rr(lt,d?B:E,C),ut=vt(v.cameraToCenterDistance,tt.signedDistanceFromCamera);let dt=l.ai(w.textSizeData,g,G)*ut/l.ao;d&&(dt*=w.tilePixelRatio/k);const{width:Tt,height:wt,anchor:gt,textOffset:mt,textBoxScale:Dt}=J,Xt=Zo(gt,Tt,wt,mt,Dt,dt),ie=d?rr(lt.add(Xt),E,C).point:tt.point.add(a?Xt.rotate(-v.angle):Xt),re=w.allowVerticalPlacement&&G.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let ue=0;ue<G.numGlyphs;ue++)l.aj(O,ie,re);b&&G.associatedIconIndex>=0&&(U[G.associatedIconIndex]={shiftedAnchor:ie,angle:re})}else se(G.numGlyphs,O)}if(b){z.clear();const V=w.icon.placedSymbolArray;for(let G=0;G<V.length;G++){const J=V.get(G);if(J.hidden)se(J.numGlyphs,z);else{const lt=U[G];if(lt)for(let tt=0;tt<J.numGlyphs;tt++)l.aj(z,lt.shiftedAnchor,lt.angle);else se(J.numGlyphs,z)}}w.icon.dynamicLayoutVertexBuffer.updateData(z)}w.text.dynamicLayoutVertexBuffer.updateData(O)}function La(w,a,d){return d.iconsInText&&a?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function $o(w,a,d,m,v,E,B,k,g,b,C,M){const O=w.context,z=O.gl,U=w.transform,V=k==="map",G=g==="map",J=k!=="viewport"&&d.layout.get("symbol-placement")!=="point",lt=V&&!G&&!J,tt=!d.layout.get("symbol-sort-key").isConstant();let ut=!1;const dt=w.depthModeForSublayer(0,ni.ReadOnly),Tt=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),wt=[];for(const gt of m){const mt=a.getTile(gt),Dt=mt.getBucket(d);if(!Dt)continue;const Xt=v?Dt.text:Dt.icon;if(!Xt||!Xt.segments.get().length||!Xt.hasVisibleVertices)continue;const ie=Xt.programConfigurations.get(d.id),re=v||Dt.sdfIcons,ue=v?Dt.textSizeData:Dt.iconSizeData,Pe=G||U.pitch!==0,xe=w.useProgram(La(re,v,Dt),ie),Oe=l.ag(ue,U.zoom),Xe=w.style.map.terrain&&w.style.map.terrain.getTerrainData(gt);let We,_i,xi,Ui,gi=[0,0],Ni=null;if(v)_i=mt.glyphAtlasTexture,xi=z.LINEAR,We=mt.glyphAtlasTexture.size,Dt.iconsInText&&(gi=mt.imageAtlasTexture.size,Ni=mt.imageAtlasTexture,Ui=Pe||w.options.rotating||w.options.zooming||ue.kind==="composite"||ue.kind==="camera"?z.LINEAR:z.NEAREST);else{const $i=d.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear;_i=mt.imageAtlasTexture,xi=re||w.options.rotating||w.options.zooming||$i||Pe?z.LINEAR:z.NEAREST,We=mt.imageAtlasTexture.size}const Er=si(mt,1,w.transform.zoom),ur=Ls(gt.posMatrix,G,V,w.transform,Er),Zr=ir(gt.posMatrix,G,V,w.transform,Er),Zi=Tt&&Dt.hasTextData(),bs=d.layout.get("icon-text-fit")!=="none"&&Zi&&Dt.hasIconData();if(J){const $i=w.style.map.terrain?(ws,qr)=>w.style.map.terrain.getElevation(gt,ws,qr):null,ar=d.layout.get("text-rotation-alignment")==="map";Q(Dt,gt.posMatrix,w,v,ur,Zr,G,b,ar,$i)}const ps=w.translatePosMatrix(gt.posMatrix,mt,E,B),Vr=J||v&&Tt||bs?gn:ur,or=w.translatePosMatrix(Zr,mt,E,B,!0),dr=re&&d.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Br;Br=re?Dt.iconsInText?$h(ue.kind,Oe,lt,G,w,ps,Vr,or,We,gi):Kc(ue.kind,Oe,lt,G,w,ps,Vr,or,v,We,!0):Bl(ue.kind,Oe,lt,G,w,ps,Vr,or,v,We);const sn={program:xe,buffers:Xt,uniformValues:Br,atlasTexture:_i,atlasTextureIcon:Ni,atlasInterpolation:xi,atlasInterpolationIcon:Ui,isSDF:re,hasHalo:dr};if(tt&&Dt.canOverlap){ut=!0;const $i=Xt.segments.get();for(const ar of $i)wt.push({segments:new l.$([ar]),sortKey:ar.sortKey,state:sn,terrainData:Xe})}else wt.push({segments:Xt.segments,sortKey:0,state:sn,terrainData:Xe})}ut&&wt.sort((gt,mt)=>gt.sortKey-mt.sortKey);for(const gt of wt){const mt=gt.state;if(O.activeTexture.set(z.TEXTURE0),mt.atlasTexture.bind(mt.atlasInterpolation,z.CLAMP_TO_EDGE),mt.atlasTextureIcon&&(O.activeTexture.set(z.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,z.CLAMP_TO_EDGE)),mt.isSDF){const Dt=mt.uniformValues;mt.hasHalo&&(Dt.u_is_halo=1,Eo(mt.buffers,gt.segments,d,w,mt.program,dt,C,M,Dt,gt.terrainData)),Dt.u_is_halo=0}Eo(mt.buffers,gt.segments,d,w,mt.program,dt,C,M,mt.uniformValues,gt.terrainData)}}function Eo(w,a,d,m,v,E,B,k,g,b){const C=m.context;v.draw(C,C.gl.TRIANGLES,E,B,k,zi.disabled,g,b,d.id,w.layoutVertexBuffer,w.indexBuffer,a,d.paint,m.transform.zoom,w.programConfigurations.get(d.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Ma(w,a,d,m,v){if(!d||!m||!m.imageAtlas)return;const E=m.imageAtlas.patternPositions;let B=E[d.to.toString()],k=E[d.from.toString()];if(!B&&k&&(B=k),!k&&B&&(k=B),!B||!k){const g=v.getPaintProperty(a);B=E[g],k=E[g]}B&&k&&w.setConstantPatternPositions(B,k)}function Rn(w,a,d,m,v,E,B){const k=w.context.gl,g="fill-pattern",b=d.paint.get(g),C=b&&b.constantOr(1),M=d.getCrossfadeParameters();let O,z,U,V,G;B?(z=C&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=k.LINES):(z=C?"fillPattern":"fill",O=k.TRIANGLES);const J=b.constantOr(null);for(const lt of m){const tt=a.getTile(lt);if(C&&!tt.patternsLoaded())continue;const ut=tt.getBucket(d);if(!ut)continue;const dt=ut.programConfigurations.get(d.id),Tt=w.useProgram(z,dt),wt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(lt);C&&(w.context.activeTexture.set(k.TEXTURE0),tt.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),dt.updatePaintBuffers(M)),Ma(dt,g,J,tt,d);const gt=wt?lt:null,mt=w.translatePosMatrix(gt?gt.posMatrix:lt.posMatrix,tt,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(B){V=ut.indexBuffer2,G=ut.segments2;const Dt=[k.drawingBufferWidth,k.drawingBufferHeight];U=z==="fillOutlinePattern"&&C?hi(mt,w,M,tt,Dt):Ee(mt,Dt)}else V=ut.indexBuffer,G=ut.segments,U=C?ce(mt,w,M,tt):Ot(mt);Tt.draw(w.context,O,v,w.stencilModeForClipping(lt),E,zi.disabled,U,wt,d.id,ut.layoutVertexBuffer,V,G,d.paint,w.transform.zoom,dt)}}function mn(w,a,d,m,v,E,B){const k=w.context,g=k.gl,b="fill-extrusion-pattern",C=d.paint.get(b),M=C.constantOr(1),O=d.getCrossfadeParameters(),z=d.paint.get("fill-extrusion-opacity"),U=C.constantOr(null);for(const V of m){const G=a.getTile(V),J=G.getBucket(d);if(!J)continue;const lt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(V),tt=J.programConfigurations.get(d.id),ut=w.useProgram(M?"fillExtrusionPattern":"fillExtrusion",tt);M&&(w.context.activeTexture.set(g.TEXTURE0),G.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),tt.updatePaintBuffers(O)),Ma(tt,b,U,G,d);const dt=w.translatePosMatrix(V.posMatrix,G,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Tt=d.paint.get("fill-extrusion-vertical-gradient"),wt=M?yt(dt,w,Tt,z,V,O,G):st(dt,w,Tt,z);ut.draw(k,k.gl.TRIANGLES,v,E,B,zi.backCCW,wt,lt,d.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,d.paint,w.transform.zoom,tt,w.style.map.terrain&&J.centroidVertexBuffer)}}function Dr(w,a,d,m,v,E,B){const k=w.context,g=k.gl,b=d.fbo;if(!b)return;const C=w.useProgram("hillshade"),M=w.style.map.terrain&&w.style.map.terrain.getTerrainData(a);k.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,b.colorAttachment.get()),C.draw(k,g.TRIANGLES,v,E,B,zi.disabled,((O,z,U,V)=>{const G=U.paint.get("hillshade-shadow-color"),J=U.paint.get("hillshade-highlight-color"),lt=U.paint.get("hillshade-accent-color");let tt=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(tt-=O.transform.angle);const ut=!O.options.moving;return{u_matrix:V?V.posMatrix:O.transform.calculatePosMatrix(z.tileID.toUnwrapped(),ut),u_image:0,u_latrange:Pl(0,z.tileID),u_light:[U.paint.get("hillshade-exaggeration"),tt],u_shadow:G,u_highlight:J,u_accent:lt}})(w,d,m,M?a:null),M,m.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function el(w,a,d,m,v,E){const B=w.context,k=B.gl,g=a.dem;if(g&&g.data){const b=g.dim,C=g.stride,M=g.getPixels();if(B.activeTexture.set(k.TEXTURE1),B.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||w.getTileTexture(C),a.demTexture){const z=a.demTexture;z.update(M,{premultiply:!1}),z.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else a.demTexture=new ct(B,M,k.RGBA,{premultiply:!1}),a.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);B.activeTexture.set(k.TEXTURE0);let O=a.fbo;if(!O){const z=new ct(B,{width:b,height:b,data:null},k.RGBA);z.bind(k.LINEAR,k.CLAMP_TO_EDGE),O=a.fbo=B.createFramebuffer(b,b,!0,!1),O.colorAttachment.set(z.texture)}B.bindFramebuffer.set(O.framebuffer),B.viewport.set([0,0,b,b]),w.useProgram("hillshadePrepare").draw(B,k.TRIANGLES,m,v,E,zi.disabled,((z,U)=>{const V=U.stride,G=l.F();return l.aN(G,0,l.W,-l.W,0,0,1),l.H(G,G,[0,-l.W,0]),{u_matrix:G,u_image:1,u_dimension:[V,V],u_zoom:z.overscaledZ,u_unpack:U.getUnpackVector()}})(a.tileID,g),null,d.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function il(w,a,d,m,v,E){const B=m.paint.get("raster-fade-duration");if(!E&&B>0){const k=T.now(),g=(k-w.timeAdded)/B,b=a?(k-a.timeAdded)/B:-1,C=d.getSource(),M=v.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),O=!a||Math.abs(a.tileID.overscaledZ-M)>Math.abs(w.tileID.overscaledZ-M),z=O&&w.refreshedUponExpiration?1:l.ac(O?g:1-b,0,1);return w.refreshedUponExpiration&&g>=1&&(w.refreshedUponExpiration=!1),a?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}const Ba=new l.aO(1,0,0,1),io=new l.aO(0,1,0,1),Rs=new l.aO(0,0,1,1),zl=new l.aO(1,0,1,1),Yo=new l.aO(0,1,1,1);function Ra(w,a,d,m){_n(w,0,a+d/2,w.transform.width,d,m)}function yn(w,a,d,m){_n(w,a-d/2,0,d,w.transform.height,m)}function _n(w,a,d,m,v,E){const B=w.context,k=B.gl;k.enable(k.SCISSOR_TEST),k.scissor(a*w.pixelRatio,d*w.pixelRatio,m*w.pixelRatio,v*w.pixelRatio),B.clear({color:E}),k.disable(k.SCISSOR_TEST)}function ka(w,a,d){const m=w.context,v=m.gl,E=d.posMatrix,B=w.useProgram("debug"),k=ni.disabled,g=Oi.disabled,b=w.colorModeForRenderPass(),C="$debug",M=w.style.map.terrain&&w.style.map.terrain.getTerrainData(d);m.activeTexture.set(v.TEXTURE0);const O=a.getTileByID(d.key).latestRawTileData,z=Math.floor((O&&O.byteLength||0)/1024),U=a.getTile(d).tileSize,V=512/Math.min(U,512)*(d.overscaledZ/w.transform.zoom)*.5;let G=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(G+=` => ${d.overscaledZ}`),function(J,lt){J.initDebugOverlayCanvas();const tt=J.debugOverlayCanvas,ut=J.context.gl,dt=J.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,tt.width,tt.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(lt,5,5),dt.strokeText(lt,5,5),J.debugOverlayTexture.update(tt),J.debugOverlayTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE)}(w,`${G} ${z}kB`),B.draw(m,v.TRIANGLES,k,g,ui.alphaBlended,zi.disabled,ls(E,l.aO.transparent,V),null,C,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),B.draw(m,v.LINE_STRIP,k,g,b,zi.disabled,ls(E,l.aO.red),M,C,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function wc(w,a,d){const m=w.context,v=m.gl,E=w.colorModeForRenderPass(),B=new ni(v.LEQUAL,ni.ReadWrite,w.depthRangeFor3D),k=w.useProgram("terrain"),g=a.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,w.width,w.height]);for(const b of d){const C=w.renderToTexture.getTexture(b),M=a.getTerrainData(b.tileID);m.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,C.texture);const O={u_matrix:w.transform.calculatePosMatrix(b.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(w.transform.zoom)};k.draw(m,v.TRIANGLES,B,Oi.disabled,E,zi.backCCW,O,M,"terrain",g.vertexBuffer,g.indexBuffer,g.segments)}}class Co{constructor(a,d){this.context=new Xi(a),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=me.maxUnderzooming+me.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new mr}resize(a,d,m){if(this.width=Math.floor(a*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const a=this.context,d=new l.aV;d.emplaceBack(0,0),d.emplaceBack(l.W,0),d.emplaceBack(0,l.W),d.emplaceBack(l.W,l.W),this.tileExtentBuffer=a.createVertexBuffer(d,Fr.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const m=new l.aV;m.emplaceBack(0,0),m.emplaceBack(l.W,0),m.emplaceBack(0,l.W),m.emplaceBack(l.W,l.W),this.debugBuffer=a.createVertexBuffer(m,Fr.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const v=new l.Z;v.emplaceBack(0,0,0,0),v.emplaceBack(l.W,0,l.W,0),v.emplaceBack(0,l.W,0,l.W),v.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=a.createVertexBuffer(v,Se.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const E=new l.aV;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(E,Fr.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const B=new l.aW;B.emplaceBack(0),B.emplaceBack(1),B.emplaceBack(3),B.emplaceBack(2),B.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(B);const k=new l.aX;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(k);const g=this.context.gl;this.stencilClearMode=new Oi({func:g.ALWAYS,mask:0},0,255,g.ZERO,g.ZERO,g.ZERO)}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=l.F();l.aN(m,0,this.width,this.height,0,0,1),l.J(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,d.TRIANGLES,ni.disabled,this.stencilClearMode,ui.disabled,zi.disabled,ds(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,d){if(this.currentStencilSource===a.source||!a.isTileClipped()||!d||!d.length)return;this.currentStencilSource=a.source;const m=this.context,v=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(ui.disabled),m.setDepthMode(ni.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of d){const k=this._tileClippingMaskIDs[B.key]=this.nextStencilID++,g=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B);E.draw(m,v.TRIANGLES,ni.disabled,new Oi({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),ui.disabled,zi.disabled,ds(B.posMatrix),g,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new Oi({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){const d=this.context.gl;return new Oi({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,m=a.sort((B,k)=>k.overscaledZ-B.overscaledZ),v=m[m.length-1].overscaledZ,E=m[0].overscaledZ-v+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const B={};for(let k=0;k<E;k++)B[k+v]=new Oi({func:d.GEQUAL,mask:255},k+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[B,m]}return[{[v]:Oi.disabled},m]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new ui([a.CONSTANT_COLOR,a.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ui.unblended:ui.alphaBlended}depthModeForSublayer(a,d,m){if(!this.opaquePassEnabledForLayer())return ni.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new ni(m||this.context.gl.LEQUAL,d,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(T.now()),this.imageManager.beginFrame();const m=this.style._order,v=this.style.sourceCaches,E={},B={},k={};for(const g in v){const b=v[g];b.used&&b.prepare(this.context),E[g]=b.getVisibleCoordinates(),B[g]=E[g].slice().reverse(),k[g]=b.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let g=0;g<m.length;g++)if(this.style._layers[m[g]].is3D()){this.opaquePassCutoff=g;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const g of m){const b=this.style._layers[g];if(!b.hasOffscreenPass()||b.isHidden(this.transform.zoom))continue;const C=B[b.source];(b.type==="custom"||C.length)&&this.renderLayer(this,v[b.source],b,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const g=this.style._layers[m[this.currentLayer]],b=v[g.source],C=E[g.source];this._renderTileClippingMasks(g,C),this.renderLayer(this,b,g,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const g=this.style._layers[m[this.currentLayer]],b=v[g.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(g))continue;const C=(g.type==="symbol"?k:B)[g.source];this._renderTileClippingMasks(g,E[g.source]),this.renderLayer(this,b,g,C)}if(this.options.showTileBoundaries){const g=function(b,C){let M=null;const O=Object.values(b._layers).flatMap(G=>G.source&&!G.isHidden(C)?[b.sourceCaches[G.source]]:[]),z=O.filter(G=>G.getSource().type==="vector"),U=O.filter(G=>G.getSource().type!=="vector"),V=G=>{(!M||M.getSource().maxzoom<G.getSource().maxzoom)&&(M=G)};return z.forEach(G=>V(G)),M||U.forEach(G=>V(G)),M}(this.style,this.transform.zoom);g&&function(b,C,M){for(let O=0;O<M.length;O++)ka(b,C,M[O])}(this,g,g.getVisibleCoordinates())}this.options.showPadding&&function(g){const b=g.transform.padding;Ra(g,g.transform.height-(b.top||0),3,Ba),Ra(g,b.bottom||0,3,io),yn(g,b.left||0,3,Rs),yn(g,g.transform.width-(b.right||0),3,zl);const C=g.transform.centerPoint;(function(M,O,z,U){_n(M,O-1,z-10,2,20,U),_n(M,O-10,z-1,20,2,U)})(g,C.x,g.transform.height-C.y,Yo)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(a){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,m=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;v||(v=a?!l.aY(d,m):!l.aZ(d,m)),v||(v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),v&&(l.a_(d,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(E,B){const k=E.context,g=k.gl,b=ui.unblended,C=new ni(g.LEQUAL,ni.ReadWrite,[0,1]),M=B.getTerrainMesh(),O=B.sourceCache.getRenderableTiles(),z=E.useProgram("terrainDepth");k.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),k.clear({color:l.aO.transparent,depth:1});for(const U of O){const V=B.getTerrainData(U.tileID),G={u_matrix:E.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_ele_delta:B.getMeshFrameDelta(E.transform.zoom)};z.draw(k,g.TRIANGLES,C,Oi.disabled,b,zi.backCCW,G,V,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain),function(E,B){const k=E.context,g=k.gl,b=ui.unblended,C=new ni(g.LEQUAL,ni.ReadWrite,[0,1]),M=B.getTerrainMesh(),O=B.getCoordsTexture(),z=B.sourceCache.getRenderableTiles(),U=E.useProgram("terrainCoords");k.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),k.clear({color:l.aO.transparent,depth:1}),B.coordsIndex=[];for(const V of z){const G=B.getTerrainData(V.tileID);k.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,O.texture);const J={u_matrix:E.transform.calculatePosMatrix(V.tileID.toUnwrapped()),u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0,u_ele_delta:B.getMeshFrameDelta(E.transform.zoom)};U.draw(k,g.TRIANGLES,C,Oi.disabled,b,zi.backCCW,J,G,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),B.coordsIndex.push(V.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain))}renderLayer(a,d,m,v){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(v||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(E,B,k,g,b){if(E.renderPass!=="translucent")return;const C=Oi.disabled,M=E.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,z,U,V,G,J,lt){const tt=z.transform,ut=G==="map",dt=J==="map";for(const Tt of O){const wt=V.getTile(Tt),gt=wt.getBucket(U);if(!gt||!gt.text||!gt.text.segments.get().length)continue;const mt=l.ag(gt.textSizeData,tt.zoom),Dt=si(wt,1,z.transform.zoom),Xt=Ls(Tt.posMatrix,dt,ut,z.transform,Dt),ie=U.layout.get("icon-text-fit")!=="none"&&gt.hasIconData();if(mt){const re=Math.pow(2,tt.zoom-wt.tileID.overscaledZ);bc(gt,ut,dt,lt,tt,Xt,Tt.posMatrix,re,mt,ie,z.style.map.terrain?(ue,Pe)=>z.style.map.terrain.getElevation(Tt,ue,Pe):null)}}}(g,E,k,B,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),b),k.paint.get("icon-opacity").constantOr(1)!==0&&$o(E,B,k,g,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),C,M),k.paint.get("text-opacity").constantOr(1)!==0&&$o(E,B,k,g,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),C,M),B.map.showCollisionBoxes&&(Bn(E,B,k,g,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),!0),Bn(E,B,k,g,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),!1))})(a,d,m,v,this.style.placement.variableOffsets);break;case"circle":(function(E,B,k,g){if(E.renderPass!=="translucent")return;const b=k.paint.get("circle-opacity"),C=k.paint.get("circle-stroke-width"),M=k.paint.get("circle-stroke-opacity"),O=!k.layout.get("circle-sort-key").isConstant();if(b.constantOr(1)===0&&(C.constantOr(1)===0||M.constantOr(1)===0))return;const z=E.context,U=z.gl,V=E.depthModeForSublayer(0,ni.ReadOnly),G=Oi.disabled,J=E.colorModeForRenderPass(),lt=[];for(let tt=0;tt<g.length;tt++){const ut=g[tt],dt=B.getTile(ut),Tt=dt.getBucket(k);if(!Tt)continue;const wt=Tt.programConfigurations.get(k.id),gt=E.useProgram("circle",wt),mt=Tt.layoutVertexBuffer,Dt=Tt.indexBuffer,Xt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(ut),ie={programConfiguration:wt,program:gt,layoutVertexBuffer:mt,indexBuffer:Dt,uniformValues:Ti(E,ut,dt,k),terrainData:Xt};if(O){const re=Tt.segments.get();for(const ue of re)lt.push({segments:new l.$([ue]),sortKey:ue.sortKey,state:ie})}else lt.push({segments:Tt.segments,sortKey:0,state:ie})}O&&lt.sort((tt,ut)=>tt.sortKey-ut.sortKey);for(const tt of lt){const{programConfiguration:ut,program:dt,layoutVertexBuffer:Tt,indexBuffer:wt,uniformValues:gt,terrainData:mt}=tt.state;dt.draw(z,U.TRIANGLES,V,G,J,zi.disabled,gt,mt,k.id,Tt,wt,tt.segments,k.paint,E.transform.zoom,ut)}})(a,d,m,v);break;case"heatmap":(function(E,B,k,g){if(k.paint.get("heatmap-opacity")!==0)if(E.renderPass==="offscreen"){const b=E.context,C=b.gl,M=Oi.disabled,O=new ui([C.ONE,C.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(z,U,V){const G=z.gl;z.activeTexture.set(G.TEXTURE1),z.viewport.set([0,0,U.width/4,U.height/4]);let J=V.heatmapFbo;if(J)G.bindTexture(G.TEXTURE_2D,J.colorAttachment.get()),z.bindFramebuffer.set(J.framebuffer);else{const lt=G.createTexture();G.bindTexture(G.TEXTURE_2D,lt),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),J=V.heatmapFbo=z.createFramebuffer(U.width/4,U.height/4,!1,!1),function(tt,ut,dt,Tt){var wt,gt;const mt=tt.gl,Dt=(wt=tt.HALF_FLOAT)!==null&&wt!==void 0?wt:mt.UNSIGNED_BYTE,Xt=(gt=tt.RGBA16F)!==null&&gt!==void 0?gt:mt.RGBA;mt.texImage2D(mt.TEXTURE_2D,0,Xt,ut.width/4,ut.height/4,0,mt.RGBA,Dt,null),Tt.colorAttachment.set(dt)}(z,U,lt,J)}})(b,E,k),b.clear({color:l.aO.transparent});for(let z=0;z<g.length;z++){const U=g[z];if(B.hasRenderableParent(U))continue;const V=B.getTile(U),G=V.getBucket(k);if(!G)continue;const J=G.programConfigurations.get(k.id),lt=E.useProgram("heatmap",J),{zoom:tt}=E.transform;lt.draw(b,C.TRIANGLES,ni.disabled,M,O,zi.disabled,Qi(U.posMatrix,V,tt,k.paint.get("heatmap-intensity")),null,k.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,k.paint,E.transform.zoom,J)}b.viewport.set([0,0,E.width,E.height])}else E.renderPass==="translucent"&&(E.context.setColorMode(E.colorModeForRenderPass()),function(b,C){const M=b.context,O=M.gl,z=C.heatmapFbo;if(!z)return;M.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,z.colorAttachment.get()),M.activeTexture.set(O.TEXTURE1);let U=C.colorRampTexture;U||(U=C.colorRampTexture=new ct(M,C.colorRamp,O.RGBA)),U.bind(O.LINEAR,O.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(M,O.TRIANGLES,ni.disabled,Oi.disabled,b.colorModeForRenderPass(),zi.disabled,((V,G,J,lt)=>{const tt=l.F();l.aN(tt,0,V.width,V.height,0,0,1);const ut=V.context.gl;return{u_matrix:tt,u_world:[ut.drawingBufferWidth,ut.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}})(b,C),null,C.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,C.paint,b.transform.zoom)}(E,k))})(a,d,m,v);break;case"line":(function(E,B,k,g){if(E.renderPass!=="translucent")return;const b=k.paint.get("line-opacity"),C=k.paint.get("line-width");if(b.constantOr(1)===0||C.constantOr(1)===0)return;const M=E.depthModeForSublayer(0,ni.ReadOnly),O=E.colorModeForRenderPass(),z=k.paint.get("line-dasharray"),U=k.paint.get("line-pattern"),V=U.constantOr(1),G=k.paint.get("line-gradient"),J=k.getCrossfadeParameters(),lt=V?"linePattern":z?"lineSDF":G?"lineGradient":"line",tt=E.context,ut=tt.gl;let dt=!0;for(const Tt of g){const wt=B.getTile(Tt);if(V&&!wt.patternsLoaded())continue;const gt=wt.getBucket(k);if(!gt)continue;const mt=gt.programConfigurations.get(k.id),Dt=E.context.program.get(),Xt=E.useProgram(lt,mt),ie=dt||Xt.program!==Dt,re=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Tt),ue=U.constantOr(null);if(ue&&wt.imageAtlas){const Oe=wt.imageAtlas,Xe=Oe.patternPositions[ue.to.toString()],We=Oe.patternPositions[ue.from.toString()];Xe&&We&&mt.setConstantPatternPositions(Xe,We)}const Pe=re?Tt:null,xe=V?gc(E,wt,k,J,Pe):z?Il(E,wt,k,z,J,Pe):G?yi(E,wt,k,gt.lineClipsArray.length,Pe):ys(E,wt,k,Pe);if(V)tt.activeTexture.set(ut.TEXTURE0),wt.imageAtlasTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),mt.updatePaintBuffers(J);else if(z&&(ie||E.lineAtlas.dirty))tt.activeTexture.set(ut.TEXTURE0),E.lineAtlas.bind(tt);else if(G){const Oe=gt.gradients[k.id];let Xe=Oe.texture;if(k.gradientVersion!==Oe.version){let We=256;if(k.stepInterpolant){const _i=B.getSource().maxzoom,xi=Tt.canonical.z===_i?Math.ceil(1<<E.transform.maxZoom-Tt.canonical.z):1;We=l.ac(l.aT(gt.maxLineLength/l.W*1024*xi),256,tt.maxTextureSize)}Oe.gradient=l.aU({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:Oe.gradient||void 0,clips:gt.lineClipsArray}),Oe.texture?Oe.texture.update(Oe.gradient):Oe.texture=new ct(tt,Oe.gradient,ut.RGBA),Oe.version=k.gradientVersion,Xe=Oe.texture}tt.activeTexture.set(ut.TEXTURE0),Xe.bind(k.stepInterpolant?ut.NEAREST:ut.LINEAR,ut.CLAMP_TO_EDGE)}Xt.draw(tt,ut.TRIANGLES,M,E.stencilModeForClipping(Tt),O,zi.disabled,xe,re,k.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,k.paint,E.transform.zoom,mt,gt.layoutVertexBuffer2),dt=!1}})(a,d,m,v);break;case"fill":(function(E,B,k,g){const b=k.paint.get("fill-color"),C=k.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const M=E.colorModeForRenderPass(),O=k.paint.get("fill-pattern"),z=E.opaquePassEnabledForLayer()&&!O.constantOr(1)&&b.constantOr(l.aO.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===z){const U=E.depthModeForSublayer(1,E.renderPass==="opaque"?ni.ReadWrite:ni.ReadOnly);Rn(E,B,k,g,U,M,!1)}if(E.renderPass==="translucent"&&k.paint.get("fill-antialias")){const U=E.depthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,ni.ReadOnly);Rn(E,B,k,g,U,M,!0)}})(a,d,m,v);break;case"fill-extrusion":(function(E,B,k,g){const b=k.paint.get("fill-extrusion-opacity");if(b!==0&&E.renderPass==="translucent"){const C=new ni(E.context.gl.LEQUAL,ni.ReadWrite,E.depthRangeFor3D);if(b!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))mn(E,B,k,g,C,Oi.disabled,ui.disabled),mn(E,B,k,g,C,E.stencilModeFor3D(),E.colorModeForRenderPass());else{const M=E.colorModeForRenderPass();mn(E,B,k,g,C,Oi.disabled,M)}}})(a,d,m,v);break;case"hillshade":(function(E,B,k,g){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const b=E.context,C=E.depthModeForSublayer(0,ni.ReadOnly),M=E.colorModeForRenderPass(),[O,z]=E.renderPass==="translucent"?E.stencilConfigForOverlap(g):[{},g];for(const U of z){const V=B.getTile(U);V.needsHillshadePrepare!==void 0&&V.needsHillshadePrepare&&E.renderPass==="offscreen"?el(E,V,k,C,Oi.disabled,M):E.renderPass==="translucent"&&Dr(E,U,V,k,C,O[U.overscaledZ],M)}b.viewport.set([0,0,E.width,E.height])})(a,d,m,v);break;case"raster":(function(E,B,k,g){if(E.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!g.length)return;const b=E.context,C=b.gl,M=B.getSource(),O=E.useProgram("raster"),z=E.colorModeForRenderPass(),[U,V]=M instanceof Le?[{},g]:E.stencilConfigForOverlap(g),G=V[V.length-1].overscaledZ,J=!E.options.moving;for(const lt of V){const tt=E.depthModeForSublayer(lt.overscaledZ-G,k.paint.get("raster-opacity")===1?ni.ReadWrite:ni.ReadOnly,C.LESS),ut=B.getTile(lt);ut.registerFadeDuration(k.paint.get("raster-fade-duration"));const dt=B.findLoadedParent(lt,0),Tt=il(ut,dt,B,k,E.transform,E.style.map.terrain);let wt,gt;const mt=k.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;b.activeTexture.set(C.TEXTURE0),ut.texture.bind(mt,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(C.TEXTURE1),dt?(dt.texture.bind(mt,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),wt=Math.pow(2,dt.tileID.overscaledZ-ut.tileID.overscaledZ),gt=[ut.tileID.canonical.x*wt%1,ut.tileID.canonical.y*wt%1]):ut.texture.bind(mt,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);const Dt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(lt),Xt=Dt?lt:null,ie=Xt?Xt.posMatrix:E.transform.calculatePosMatrix(lt.toUnwrapped(),J),re=Ho(ie,gt||[0,0],wt||1,Tt,k);M instanceof Le?O.draw(b,C.TRIANGLES,tt,Oi.disabled,z,zi.disabled,re,Dt,k.id,M.boundsBuffer,E.quadTriangleIndexBuffer,M.boundsSegments):O.draw(b,C.TRIANGLES,tt,U[lt.overscaledZ],z,zi.disabled,re,Dt,k.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}})(a,d,m,v);break;case"background":(function(E,B,k,g){const b=k.paint.get("background-color"),C=k.paint.get("background-opacity");if(C===0)return;const M=E.context,O=M.gl,z=E.transform,U=z.tileSize,V=k.paint.get("background-pattern");if(E.isPatternMissing(V))return;const G=!V&&b.a===1&&C===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==G)return;const J=Oi.disabled,lt=E.depthModeForSublayer(0,G==="opaque"?ni.ReadWrite:ni.ReadOnly),tt=E.colorModeForRenderPass(),ut=E.useProgram(V?"backgroundPattern":"background"),dt=g||z.coveringTiles({tileSize:U,terrain:E.style.map.terrain});V&&(M.activeTexture.set(O.TEXTURE0),E.imageManager.bind(E.context));const Tt=k.getCrossfadeParameters();for(const wt of dt){const gt=g?wt.posMatrix:E.transform.calculatePosMatrix(wt.toUnwrapped()),mt=V?mc(gt,C,E,V,{tileID:wt,tileSize:U},Tt):Yh(gt,C,b),Dt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(wt);ut.draw(M,O.TRIANGLES,lt,J,tt,zi.disabled,mt,Dt,k.id,E.tileExtentBuffer,E.quadTriangleIndexBuffer,E.tileExtentSegments)}})(a,0,m,v);break;case"custom":(function(E,B,k){const g=E.context,b=k.implementation;if(E.renderPass==="offscreen"){const C=b.prerender;C&&(E.setCustomLayerDefaults(),g.setColorMode(E.colorModeForRenderPass()),C.call(b,g.gl,E.transform.customLayerMatrix()),g.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),g.setColorMode(E.colorModeForRenderPass()),g.setStencilMode(Oi.disabled);const C=b.renderingMode==="3d"?new ni(E.context.gl.LEQUAL,ni.ReadWrite,E.depthRangeFor3D):E.depthModeForSublayer(0,ni.ReadOnly);g.setDepthMode(C),b.render(g.gl,E.transform.customLayerMatrix()),g.setDirty(),E.setBaseState(),g.bindFramebuffer.set(null)}})(a,0,m)}}translatePosMatrix(a,d,m,v,E){if(!m[0]&&!m[1])return a;const B=E?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(B){const b=Math.sin(B),C=Math.cos(B);m=[m[0]*C-m[1]*b,m[0]*b+m[1]*C]}const k=[E?m[0]:si(d,m[0],this.transform.zoom),E?m[1]:si(d,m[1],this.transform.zoom),0],g=new Float32Array(16);return l.H(g,a,k),g}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const d=this.imageManager.getPattern(a.from.toString()),m=this.imageManager.getPattern(a.to.toString());return!d||!m}useProgram(a,d){this.cache=this.cache||{};const m=a+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new Aa(this.context,rs[a],d,xo[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ct(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:d}=this.context.gl;return this.width!==a||this.height!==d}}class Pi{constructor(a,d){this.points=a,this.planes=d}static fromInvProjectionMatrix(a,d,m){const v=Math.pow(2,m),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const g=1/(k=l.af([],k,a))[3]/d*v;return l.a$(k,k,[g,g,1/k[3],g])}),B=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const g=function(O,z){var U=z[0],V=z[1],G=z[2],J=U*U+V*V+G*G;return J>0&&(J=1/Math.sqrt(J)),O[0]=z[0]*J,O[1]=z[1]*J,O[2]=z[2]*J,O}([],function(O,z,U){var V=z[0],G=z[1],J=z[2],lt=U[0],tt=U[1],ut=U[2];return O[0]=G*ut-J*tt,O[1]=J*lt-V*ut,O[2]=V*tt-G*lt,O}([],xt([],E[k[0]],E[k[1]]),xt([],E[k[2]],E[k[1]]))),b=-((C=g)[0]*(M=E[k[1]])[0]+C[1]*M[1]+C[2]*M[2]);var C,M;return g.concat(b)});return new Pi(E,B)}}class ks{constructor(a,d){this.min=a,this.max=d,this.center=function(m,v,E){return m[0]=.5*v[0],m[1]=.5*v[1],m[2]=.5*v[2],m}([],function(m,v,E){return m[0]=v[0]+E[0],m[1]=v[1]+E[1],m[2]=v[2]+E[2],m}([],this.min,this.max))}quadrant(a){const d=[a%2==0,a<2],m=Nt(this.min),v=Nt(this.max);for(let E=0;E<d.length;E++)m[E]=d[E]?this.min[E]:this.center[E],v[E]=d[E]?this.center[E]:this.max[E];return v[2]=this.max[2],new ks(m,v)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let v=0;v<a.planes.length;v++){const E=a.planes[v];let B=0;for(let k=0;k<d.length;k++)l.b0(E,d[k])>=0&&B++;if(B===0)return 0;B!==d.length&&(m=!1)}if(m)return 2;for(let v=0;v<3;v++){let E=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let k=0;k<a.points.length;k++){const g=a.points[k][v]-this.min[v];E=Math.min(E,g),B=Math.max(B,g)}if(B<0||E>this.max[v]-this.min[v])return 0}return 1}}class ro{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=m,this.right=v}interpolate(a,d,m){return d.top!=null&&a.top!=null&&(this.top=l.z.number(a.top,d.top,m)),d.bottom!=null&&a.bottom!=null&&(this.bottom=l.z.number(a.bottom,d.bottom,m)),d.left!=null&&a.left!=null&&(this.left=l.z.number(a.left,d.left,m)),d.right!=null&&a.right!=null&&(this.right=l.z.number(a.right,d.right,m)),this}getCenter(a,d){const m=l.ac((this.left+a-this.right)/2,0,a),v=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(m,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new ro(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const kn=85.051129;class Js{constructor(a,d,m,v,E){this.tileSize=512,this._renderWorldCopies=E===void 0||!!E,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ro,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new Js(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const d=-l.b1(a,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var m=new l.A(4);return l.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,v,E){var B=v[0],k=v[1],g=v[2],b=v[3],C=Math.sin(E),M=Math.cos(E);m[0]=B*M+g*C,m[1]=k*M+b*C,m[2]=B*-C+g*M,m[3]=k*-C+b*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=l.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,m){this._unmodified=!1,this._edgeInsets.interpolate(a,d,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new l.b2(0,a)];if(this._renderWorldCopies){const m=this.pointCoordinate(new l.P(0,0)),v=this.pointCoordinate(new l.P(this.width,0)),E=this.pointCoordinate(new l.P(this.width,this.height)),B=this.pointCoordinate(new l.P(0,this.height)),k=Math.floor(Math.min(m.x,v.x,E.x,B.x)),g=Math.floor(Math.max(m.x,v.x,E.x,B.x)),b=1;for(let C=k-b;C<=g+b;C++)C!==0&&d.push(new l.b2(C,a))}return d}coveringTiles(a){var d,m;let v=this.coveringZoomLevel(a);const E=v;if(a.minzoom!==void 0&&v<a.minzoom)return[];a.maxzoom!==void 0&&v>a.maxzoom&&(v=a.maxzoom);const B=this.pointCoordinate(this.getCameraPoint()),k=l.Y.fromLngLat(this.center),g=Math.pow(2,v),b=[g*B.x,g*B.y,0],C=[g*k.x,g*k.y,0],M=Pi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let O=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=v);const z=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,U=tt=>({aabb:new ks([tt*g,0,0],[(tt+1)*g,g,0]),zoom:0,x:0,y:0,wrap:tt,fullyVisible:!1}),V=[],G=[],J=v,lt=a.reparseOverscaled?E:v;if(this._renderWorldCopies)for(let tt=1;tt<=3;tt++)V.push(U(-tt)),V.push(U(tt));for(V.push(U(0));V.length>0;){const tt=V.pop(),ut=tt.x,dt=tt.y;let Tt=tt.fullyVisible;if(!Tt){const Xt=tt.aabb.intersects(M);if(Xt===0)continue;Tt=Xt===2}const wt=a.terrain?b:C,gt=tt.aabb.distanceX(wt),mt=tt.aabb.distanceY(wt),Dt=Math.max(Math.abs(gt),Math.abs(mt));if(tt.zoom===J||Dt>z+(1<<J-tt.zoom)-2&&tt.zoom>=O){const Xt=J-tt.zoom,ie=b[0]-.5-(ut<<Xt),re=b[1]-.5-(dt<<Xt);G.push({tileID:new l.Q(tt.zoom===J?lt:tt.zoom,tt.wrap,tt.zoom,ut,dt),distanceSq:qt([C[0]-.5-ut,C[1]-.5-dt]),tileDistanceToCamera:Math.sqrt(ie*ie+re*re)})}else for(let Xt=0;Xt<4;Xt++){const ie=(ut<<1)+Xt%2,re=(dt<<1)+(Xt>>1),ue=tt.zoom+1;let Pe=tt.aabb.quadrant(Xt);if(a.terrain){const xe=new l.Q(ue,tt.wrap,ue,ie,re),Oe=a.terrain.getMinMaxElevation(xe),Xe=(d=Oe.minElevation)!==null&&d!==void 0?d:this.elevation,We=(m=Oe.maxElevation)!==null&&m!==void 0?m:this.elevation;Pe=new ks([Pe.min[0],Pe.min[1],Xe],[Pe.max[0],Pe.max[1],We])}V.push({aabb:Pe,zoom:ue,x:ie,y:re,wrap:tt.wrap,fullyVisible:Tt})}}return G.sort((tt,ut)=>tt.distanceSq-ut.distanceSq).map(tt=>tt.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=l.ac(a.lat,-85.051129,kn);return new l.P(l.N(a.lng)*this.worldSize,l.O(d)*this.worldSize)}unproject(a){return new l.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const d=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,a),E=a.getElevationForLngLatZoom(v,this.tileZoom);if(!(this.elevation-E))return;const B=m+d-E,k=Math.cos(this._pitch)*this.cameraToCenterDistance/B/l.b3(1,v.lat),g=this.scaleZoom(k/this.tileSize);this._elevation=E,this._center=v,this.zoom=g}setLocationAtPoint(a,d){const m=this.pointCoordinate(d),v=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(a),B=new l.Y(E.x-(m.x-v.x),E.y-(m.y-v.y));this.center=this.coordinateLocation(B),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,d){return d?this.coordinatePoint(this.locationCoordinate(a),d.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,d){return this.coordinateLocation(this.pointCoordinate(a,d))}locationCoordinate(a){return l.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,d){if(d){const O=d.pointCoordinate(a);if(O!=null)return O}const m=[a.x,a.y,0,1],v=[a.x,a.y,1,1];l.af(m,m,this.pixelMatrixInverse),l.af(v,v,this.pixelMatrixInverse);const E=m[3],B=v[3],k=m[1]/E,g=v[1]/B,b=m[2]/E,C=v[2]/B,M=b===C?0:(0-b)/(C-b);return new l.Y(l.z.number(m[0]/E,v[0]/B,M)/this.worldSize,l.z.number(k,g,M)/this.worldSize)}coordinatePoint(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const v=[a.x*this.worldSize,a.y*this.worldSize,d,1];return l.af(v,v,m),new l.P(v[0]/v[3],v[1]/v[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new Ze().extend(this.pointLocation(new l.P(0,a))).extend(this.pointLocation(new l.P(this.width,a))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ze([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,kn])}calculatePosMatrix(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const m=a.key,v=d?this._alignedPosMatrixCache:this._posMatrixCache;if(v[m])return v[m];const E=a.canonical,B=this.worldSize/this.zoomScale(E.z),k=E.x+Math.pow(2,E.z)*a.wrap,g=l.an(new Float64Array(16));return l.H(g,g,[k*B,E.y*B,0]),l.J(g,g,[B/l.W,B/l.W,1]),l.K(g,d?this.alignedProjMatrix:this.projMatrix,g),v[m]=new Float32Array(g),v[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(a,d){d=l.ac(+d,this.minZoom,this.maxZoom);const m={center:new l.M(a.lng,a.lat),zoom:d};let v=this.lngRange;if(!this._renderWorldCopies&&v===null){const tt=179.9999999999;v=[-tt,tt]}const E=this.tileSize*this.zoomScale(m.zoom);let B=0,k=E,g=0,b=E,C=0,M=0;const{x:O,y:z}=this.size;if(this.latRange){const tt=this.latRange;B=l.O(tt[1])*E,k=l.O(tt[0])*E,k-B<z&&(C=z/(k-B))}v&&(g=l.b1(l.N(v[0])*E,0,E),b=l.b1(l.N(v[1])*E,0,E),b<g&&(b+=E),b-g<O&&(M=O/(b-g)));const{x:U,y:V}=this.project.call({worldSize:E},a);let G,J;const lt=Math.max(M||0,C||0);if(lt){const tt=new l.P(M?(b+g)/2:U,C?(k+B)/2:V);return m.center=this.unproject.call({worldSize:E},tt).wrap(),m.zoom+=this.scaleZoom(lt),m}if(this.latRange){const tt=z/2;V-tt<B&&(J=B+tt),V+tt>k&&(J=k-tt)}if(v){const tt=(g+b)/2;let ut=U;this._renderWorldCopies&&(ut=l.b1(U,tt-E/2,tt+E/2));const dt=O/2;ut-dt<g&&(G=g+dt),ut+dt>b&&(G=b-dt)}if(G!==void 0||J!==void 0){const tt=new l.P(G??U,J??V);m.center=this.unproject.call({worldSize:E},tt).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this._unmodified,{center:d,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=m,this._unmodified=a,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let v=l.an(new Float64Array(16));l.J(v,v,[this.width/2,-this.height/2,1]),l.H(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=l.an(new Float64Array(16)),l.J(v,v,[1,-1,1]),l.H(v,v,[-1,-1,0]),l.J(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const E=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),B=Math.min(this.elevation,this.minElevationForCurrentTile),k=E-B*this._pixelPerMeter/Math.cos(this._pitch),g=B<0?k:E,b=Math.PI/2+this._pitch,C=this._fov*(.5+a.y/this.height),M=Math.sin(C)*g/Math.sin(l.ac(Math.PI-b-C,.01,Math.PI-.01)),O=this.getHorizon(),z=2*Math.atan(O/this.cameraToCenterDistance)*(.5+a.y/(2*O)),U=Math.sin(z)*g/Math.sin(l.ac(Math.PI-b-z,.01,Math.PI-.01)),V=Math.min(M,U),G=1.01*(Math.cos(Math.PI/2-this._pitch)*V+g),J=this.height/50;v=new Float64Array(16),l.b4(v,this._fov,this.width/this.height,J,G),v[8]=2*-a.x/this.width,v[9]=2*a.y/this.height,l.J(v,v,[1,-1,1]),l.H(v,v,[0,0,-this.cameraToCenterDistance]),l.b5(v,v,this._pitch),l.ad(v,v,this.angle),l.H(v,v,[-d,-m,0]),this.mercatorMatrix=l.J([],v,[this.worldSize,this.worldSize,this.worldSize]),l.J(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,v),l.H(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=l.ar([],v),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,v);const lt=this.width%2/2,tt=this.height%2/2,ut=Math.cos(this.angle),dt=Math.sin(this.angle),Tt=d-Math.round(d)+ut*lt+dt*tt,wt=m-Math.round(m)+ut*tt+dt*lt,gt=new Float64Array(v);if(l.H(gt,gt,[Tt>.5?Tt-1:Tt,wt>.5?wt-1:wt,0]),this.alignedProjMatrix=gt,v=l.ar(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new l.P(0,0)),d=[a.x*this.worldSize,a.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,a))}getCameraQueryGeometry(a){const d=this.getCameraPoint();if(a.length===1)return[a[0],d];{let m=d.x,v=d.y,E=d.x,B=d.y;for(const k of a)m=Math.min(m,k.x),v=Math.min(v,k.y),E=Math.max(E,k.x),B=Math.max(B,k.y);return[new l.P(m,v),new l.P(E,v),new l.P(E,B),new l.P(m,B),new l.P(m,v)]}}lngLatToCameraDepth(a,d){const m=this.locationCoordinate(a),v=[m.x*this.worldSize,m.y*this.worldSize,d,1];return l.af(v,v,this.projMatrix),v[2]/v[3]}}function rl(w,a){var d=this;let m,v=!1,E=null,B=null;const k=()=>{E=null,v&&(w.apply(B,m),E=setTimeout(k,a),v=!1)};return function(){for(var g=arguments.length,b=new Array(g),C=0;C<g;C++)b[C]=arguments[C];return v=!0,B=d,m=b,E||k(),E}}class On{constructor(a){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(m=v)}),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=rl(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,v),B=Math.round(d.lng*E)/E,k=Math.round(d.lat*E)/E,g=this._map.getBearing(),b=this._map.getPitch();let C="";if(C+=a?`/${B}/${k}/${m}`:`${m}/${k}/${B}`,(g||b)&&(C+="/"+Math.round(10*g)/10),b&&(C+=`/${Math.round(b)}`),this._hashName){const M=this._hashName;let O=!1;const z=window.location.hash.slice(1).split("&").map(U=>{const V=U.split("=")[0];return V===M?(O=!0,`${V}=${C}`):U}).filter(U=>U);return O||z.push(`${M}=${C}`),`#${z.join("&")}`}return`#${C}`}}const To={linearity:.3,easing:l.b6(0,0,.3,1)},xc=l.e({deceleration:2500,maxSpeed:1400},To),Po=l.e({deceleration:20,maxSpeed:1400},To),tn=l.e({deceleration:1e3,maxSpeed:360},To),Fn=l.e({deceleration:1e3,maxSpeed:90},To);class Ko{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:T.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=T.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(d.pan.mag()){const E=no(d.pan.mag(),m,l.e({},xc,a||{}));v.offset=d.pan.mult(E.amount/d.pan.mag()),v.center=this._map.transform.center,so(v,E)}if(d.zoom){const E=no(d.zoom,m,Po);v.zoom=this._map.transform.zoom+E.amount,so(v,E)}if(d.bearing){const E=no(d.bearing,m,tn);v.bearing=this._map.transform.bearing+l.ac(E.amount,-179,179),so(v,E)}if(d.pitch){const E=no(d.pitch,m,Fn);v.pitch=this._map.transform.pitch+E.amount,so(v,E)}if(v.zoom||v.bearing){const E=d.pinchAround===void 0?d.around:d.pinchAround;v.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),l.e(v,{noMoveStart:!0})}}function so(w,a){(!w.duration||w.duration<a.duration)&&(w.duration=a.duration,w.easing=a.easing)}function no(w,a,d){const{maxSpeed:m,linearity:v,deceleration:E}=d,B=l.ac(w*v/(a/1e3),-m,m),k=Math.abs(B)/(E*v);return{easing:d.easing,duration:1e3*k,amount:B*(k/2)}}class Jr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const E=P.mousePos(d.getCanvas(),m),B=d.unproject(E);super(a,l.e({point:E,lngLat:B,originalEvent:m},v)),this._defaultPrevented=!1,this.target=d}}class Nn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,m){const v=a==="touchend"?m.changedTouches:m.touches,E=P.touchPos(d.getCanvasContainer(),v),B=E.map(g=>d.unproject(g)),k=E.reduce((g,b,C,M)=>g.add(b.div(M.length)),new l.P(0,0));super(a,{points:E,point:k,lngLats:B,lngLat:d.unproject(k),originalEvent:m}),this._defaultPrevented=!1}}class Xs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,m){super(a,{originalEvent:m}),this._defaultPrevented=!1}}class Qo{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new Xs(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new Jr(a.type,this._map,a))}mouseup(a){this._map.fire(new Jr(a.type,this._map,a))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Jr(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Jr(a.type,this._map,a))}mouseover(a){this._map.fire(new Jr(a.type,this._map,a))}mouseout(a){this._map.fire(new Jr(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Nn(a.type,this._map,a))}touchmove(a){this._map.fire(new Nn(a.type,this._map,a))}touchend(a){this._map.fire(new Nn(a.type,this._map,a))}touchcancel(a){this._map.fire(new Nn(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vr{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Jr(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Jr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Jr(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hr{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(l.P.convert(a),this._map.terrain)}}class Xr{constructor(a,d){this._map=a,this._tr=new hr(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&a.button===0&&(P.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const E=Math.min(v.x,m.x),B=Math.max(v.x,m.x),k=Math.min(v.y,m.y),g=Math.max(v.y,m.y);P.setTransform(this._box,`translate(${E}px,${k}px)`),this._box.style.width=B-E+"px",this._box.style.height=g-k+"px"}mouseupWindow(a,d){if(!this._active||a.button!==0)return;const m=this._startPos,v=d;if(this.reset(),P.suppressClick(),m.x!==v.x||m.y!==v.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:a})),{cameraAnimation:E=>E.fitScreenCoordinates(m,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new l.k(a,{originalEvent:d}))}}function Gr(w,a){if(w.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${a.length}`);const d={};for(let m=0;m<w.length;m++)d[w[m].identifier]=a[m];return d}class oo{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const E=new l.P(0,0);for(const B of v)E._add(B);return E.div(v.length)}(d),this.touches=Gr(m,d)))}touchmove(a,d,m){if(this.aborted||!this.centroid)return;const v=Gr(m,d);for(const E in this.touches){const B=v[E];(!B||B.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(a,d,m){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class ao{constructor(a){this.singleTap=new oo(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,d,m){this.singleTap.touchstart(a,d,m)}touchmove(a,d,m){this.singleTap.touchmove(a,d,m)}touchend(a,d,m){const v=this.singleTap.touchend(a,d,m);if(v){const E=a.timeStamp-this.lastTime<500,B=!this.lastTap||this.lastTap.dist(v)<30;if(E&&B||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class sl{constructor(a){this._tr=new hr(a),this._zoomIn=new ao({numTouches:1,numTaps:2}),this._zoomOut=new ao({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,m){this._zoomIn.touchstart(a,d,m),this._zoomOut.touchstart(a,d,m)}touchmove(a,d,m){this._zoomIn.touchmove(a,d,m),this._zoomOut.touchmove(a,d,m)}touchend(a,d,m){const v=this._zoomIn.touchend(a,d,m),E=this._zoomOut.touchend(a,d,m),B=this._tr;return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:B.zoom+1,around:B.unproject(v)},{originalEvent:a})}):E?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:B.zoom-1,around:B.unproject(E)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lo{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(){const a=this._moveFunction(...arguments);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(a,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const v=d.length?d[0]:d;return!this._moved&&v.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(m,v))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&P.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const rh={0:1,2:2};class sh{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const d=P.mouseButton(a);this._eventButton=d}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(d,m){const v=rh[m];return d.buttons===void 0||(d.buttons&v)!==v}(a,this._eventButton)}isValidEndEvent(a){return P.mouseButton(a)===this._eventButton}}class nh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const zr=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=a=>{a.preventDefault()}},ta=w=>{let{enable:a,clickTolerance:d,bearingDegreesPerPixelMoved:m=.8}=w;const v=new sh({checkCorrectEvent:E=>P.mouseButton(E)===0&&E.ctrlKey||P.mouseButton(E)===2});return new lo({clickTolerance:d,move:(E,B)=>({bearingDelta:(B.x-E.x)*m}),moveStateManager:v,enable:a,assignEvents:zr})},en=w=>{let{enable:a,clickTolerance:d,pitchDegreesPerPixelMoved:m=-.5}=w;const v=new sh({checkCorrectEvent:E=>P.mouseButton(E)===0&&E.ctrlKey||P.mouseButton(E)===2});return new lo({clickTolerance:d,move:(E,B)=>({pitchDelta:(B.y-E.y)*m}),moveStateManager:v,enable:a,assignEvents:zr})};class Ac{constructor(a,d){this._clickTolerance=a.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,d,m){return this._calculateTransform(a,d,m)}touchmove(a,d,m){if(this._active&&!(m.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,d,m)}touchend(a,d,m){this._calculateTransform(a,d,m),this._active&&m.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,m){m.length>0&&(this._active=!0);const v=Gr(m,d),E=new l.P(0,0),B=new l.P(0,0);let k=0;for(const b in v){const C=v[b],M=this._touches[b];M&&(E._add(C),B._add(C.sub(M)),k++,v[b]=C)}if(this._touches=v,k<this.minTouchs()||!B.mag())return;const g=B.div(k);return this._sum._add(g),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(k),panDelta:g}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,m){if(!this._firstTwoTouches)return;a.preventDefault();const[v,E]=this._firstTwoTouches,B=Os(m,d,v),k=Os(m,d,E);if(!B||!k)return;const g=this._aroundCenter?null:B.add(k).div(2);return this._move([B,k],g,a)}touchend(a,d,m){if(!this._firstTwoTouches)return;const[v,E]=this._firstTwoTouches,B=Os(m,d,v),k=Os(m,d,E);B&&k||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Os(w,a,d){for(let m=0;m<w.length;m++)if(w[m].identifier===d)return a[m]}function vs(w,a){return Math.log(w/a)/Math.LN2}class ea extends Oa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const m=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(vs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vs(this._distance,m),pinchAround:d}}}function nl(w,a){return 180*w.angleWith(a)/Math.PI}class oh extends Oa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d,m){const v=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nl(this._vector,v),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,m=nl(a,this._startVector);return Math.abs(m)<d}}function ol(w){return Math.abs(w.y)>Math.abs(w.x)}class Ul extends Oa{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,d,m){super.touchstart(a,d,m),this._currentTouchCount=m.length}_start(a){this._lastPoints=a,ol(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=a[0].sub(this._lastPoints[0]),E=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,E,m.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5}):void 0}gestureBeginsVertically(a,d,m){if(this._valid!==void 0)return this._valid;const v=a.mag()>=2,E=d.mag()>=2;if(!v&&!E)return;if(!v||!E)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const B=a.y>0==d.y>0;return ol(a)&&ol(d)&&B}}const ah={panStep:100,bearingStep:15,pitchStep:10};class lh{constructor(a){this._tr=new hr(a);const d=ah;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,m=0,v=0,E=0,B=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?m=-1:(a.preventDefault(),E=-1);break;case 39:a.shiftKey?m=1:(a.preventDefault(),E=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),B=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),B=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:k=>{const g=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:ia,zoom:d?Math.round(g.zoom)+d*(a.shiftKey?2:1):g.zoom,bearing:g.bearing+m*this._bearingStep,pitch:g.pitch+v*this._pitchStep,offset:[-E*this._panStep,-B*this._panStep],center:g.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ia(w){return w*(2-w)}const Sc=4.000244140625;class jl{constructor(a,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=a,this._tr=new hr(a),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let d=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const m=T.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%Sc==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=P.mousePos(this._map.getCanvas(),a),m=this._tr;this._around=d.y>m.transform.height/2-m.transform.getHorizon()?l.M.convert(this._aroundCenter?m.center:m.unproject(d)):l.M.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Sc?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&g!==0&&(g=1/g);const b=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(b*g))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,m=this._startZoom,v=this._easing;let E,B=!1;if(this._type==="wheel"&&m&&v){const k=Math.min((T.now()-this._lastWheelEventTime)/200,1),g=v(k);E=l.z.number(m,d,g),k<1?this._frameId||(this._frameId=!0):B=!0}else E=d,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:E-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=l.b7;if(this._prevEase){const m=this._prevEase,v=(T.now()-m.start)/m.duration,E=m.easing(v+.01)-m.easing(v),B=.27/Math.sqrt(E*E+1e-4)*.01,k=Math.sqrt(.0729-B*B);d=l.b6(B,k,.25,1)}return this._prevEase={start:T.now(),duration:a,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ec{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ju{constructor(a){this._tr=new hr(a),this.reset()}reset(){this._active=!1}dblclick(a,d){return a.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gu{constructor(){this._tap=new ao({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,d,m){if(!this._swipePoint)if(this._tapTime){const v=d[0],E=a.timeStamp-this._tapTime<500,B=this._tapPoint.dist(v)<30;E&&B?m.length>0&&(this._swipePoint=v,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(a,d,m)}touchmove(a,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=d[0],E=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(a,d,m)}touchend(a,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const v=this._tap.touchend(a,d,m);v&&(this._tapTime=a.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ch{constructor(a,d,m){this._el=a,this._mousePan=d,this._touchPan=m}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qh{constructor(a,d,m){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gl{constructor(a,d,m,v){this._el=a,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class tu{constructor(a,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",a);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=d,this._container.appendChild(v);const E=document.createElement("div");E.className="maplibregl-mobile-message",E.textContent=m,this._container.appendChild(E),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const rn=w=>w.zoom||w.drag||w.pitch||w.rotate;class Io extends l.k{}function Vl(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Dn{constructor(a,d){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,E)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const B=v.type==="renderFrame"?void 0:v,k={needsRenderFrame:!1},g={},b={},C=v.touches,M=C?this._getMapTouches(C):void 0,O=M?P.touchPos(this._map.getCanvas(),M):P.mousePos(this._map.getCanvas(),v);for(const{handlerName:V,handler:G,allowed:J}of this._handlers){if(!G.isEnabled())continue;let lt;this._blockedByActive(b,J,V)?G.reset():G[E||v.type]&&(lt=G[E||v.type](v,O,M),this.mergeHandlerResult(k,g,lt,V,B),lt&&lt.needsRenderFrame&&this._triggerRenderFrame()),(lt||G.isActive())&&(b[V]=G)}const z={};for(const V in this._previousActiveHandlers)b[V]||(z[V]=B);this._previousActiveHandlers=b,(Object.keys(z).length||Vl(k))&&(this._changes.push([k,g,z]),this._triggerRenderFrame()),(Object.keys(b).length||Vl(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=k;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ko(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,E,B]of this._listeners)P.addEventListener(v,E,v===document?this.handleWindowEvent:this.handleEvent,B)}destroy(){for(const[a,d,m]of this._listeners)P.removeEventListener(a,d,a===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(a){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new Qo(d,a));const v=d.boxZoom=new Xr(d,a);this._add("boxZoom",v),a.interactive&&a.boxZoom&&v.enable();const E=d.cooperativeGestures=new tu(d,a.cooperativeGestures);this._add("cooperativeGestures",E),a.cooperativeGestures&&E.enable();const B=new sl(d),k=new ju(d);d.doubleClickZoom=new Ec(k,B),this._add("tapZoom",B),this._add("clickZoom",k),a.interactive&&a.doubleClickZoom&&d.doubleClickZoom.enable();const g=new Gu;this._add("tapDragZoom",g);const b=d.touchPitch=new Ul(d);this._add("touchPitch",b),a.interactive&&a.touchPitch&&d.touchPitch.enable(a.touchPitch);const C=ta(a),M=en(a);d.dragRotate=new Qh(a,C,M),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),a.interactive&&a.dragRotate&&d.dragRotate.enable();const O=(lt=>{let{enable:tt,clickTolerance:ut}=lt;const dt=new sh({checkCorrectEvent:Tt=>P.mouseButton(Tt)===0&&!Tt.ctrlKey});return new lo({clickTolerance:ut,move:(Tt,wt)=>({around:wt,panDelta:wt.sub(Tt)}),activateOnStart:!0,moveStateManager:dt,enable:tt,assignEvents:zr})})(a),z=new Ac(a,d);d.dragPan=new ch(m,O,z),this._add("mousePan",O),this._add("touchPan",z,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&d.dragPan.enable(a.dragPan);const U=new oh,V=new ea;d.touchZoomRotate=new Gl(m,V,U,g),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&d.touchZoomRotate.enable(a.touchZoomRotate);const G=d.scrollZoom=new jl(d,()=>this._triggerRenderFrame());this._add("scrollZoom",G,["mousePan"]),a.interactive&&a.scrollZoom&&d.scrollZoom.enable(a.scrollZoom);const J=d.keyboard=new lh(d);this._add("keyboard",J),a.interactive&&a.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new vr(d))}_add(a,d,m){this._handlers.push({handlerName:a,handler:d,allowed:m}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rn(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,d,m){for(const v in a)if(v!==m&&(!d||d.indexOf(v)<0))return!0;return!1}_getMapTouches(a){const d=[];for(const m of a)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(a,d,m,v,E){if(!m)return;l.e(a,m);const B={handlerName:v,originalEvent:m.originalEvent||E};m.zoomDelta!==void 0&&(d.zoom=B),m.panDelta!==void 0&&(d.drag=B),m.pitchDelta!==void 0&&(d.pitch=B),m.bearingDelta!==void 0&&(d.rotate=B)}_applyChanges(){const a={},d={},m={};for(const[v,E,B]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new l.P(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(a.around=v.around),v.pinchAround!==void 0&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),l.e(d,E),l.e(m,B);this._updateMapTransform(a,d,m),this._changes=[]}_updateMapTransform(a,d,m){const v=this._map,E=v._getTransformForUpdate(),B=v.terrain;if(!(Vl(a)||B&&this._terrainMovement))return this._fireEvents(d,m,!0);let{panDelta:k,zoomDelta:g,bearingDelta:b,pitchDelta:C,around:M,pinchAround:O}=a;O!==void 0&&(M=O),v._stop(!0),M=M||v.transform.centerPoint;const z=E.pointLocation(k?M.sub(k):M);b&&(E.bearing+=b),C&&(E.pitch+=C),g&&(E.zoom+=g),B?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?E.center=E.pointLocation(E.centerPoint.sub(k)):E.setLocationAtPoint(z,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,E.setLocationAtPoint(z,M),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,E.recalculateZoom(v.terrain)})):E.setLocationAtPoint(z,M),v._applyUpdatedTransform(E),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,m,!0)}_fireEvents(a,d,m){const v=rn(this._eventsInProgress),E=rn(a),B={};for(const C in a){const{originalEvent:M}=a[C];this._eventsInProgress[C]||(B[`${C}start`]=M),this._eventsInProgress[C]=a[C]}!v&&E&&this._fireEvent("movestart",E.originalEvent);for(const C in B)this._fireEvent(C,B[C]);E&&this._fireEvent("move",E.originalEvent);for(const C in a){const{originalEvent:M}=a[C];this._fireEvent(C,M)}const k={};let g;for(const C in this._eventsInProgress){const{handlerName:M,originalEvent:O}=this._eventsInProgress[C];this._handlersById[M].isActive()||(delete this._eventsInProgress[C],g=d[M]||O,k[`${C}end`]=g)}for(const C in k)this._fireEvent(C,k[C]);const b=rn(this._eventsInProgress);if(m&&(v||E)&&!b){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!C||!C.essential&&T.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:g})),M(this._map.getBearing())&&this._map.resetNorth()):(M(C.bearing||this._map.getBearing())&&(C.bearing=0),C.freezeElevation=!0,this._map.easeTo(C,{originalEvent:g})),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new l.k(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new Io("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ra extends l.E{constructor(a,d){super(),this._renderFrameCallback=()=>{const m=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,m){return a=l.P.convert(a).mult(-1),this.panTo(this.transform.center,l.e({offset:a},d),m)}panTo(a,d,m){return this.easeTo(l.e({center:a},d),m)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,m){return this.easeTo(l.e({zoom:a},d),m)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,m){return this.easeTo(l.e({bearing:a},d),m)}resetNorth(a,d){return this.rotateTo(0,l.e({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=Ze.convert(a);const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),m,d)}_cameraForBoxAndBearing(a,d,m,v){const E={top:0,bottom:0,right:0,left:0};if(typeof(v=l.e({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const Xt=v.padding;v.padding={top:Xt,bottom:Xt,right:Xt,left:Xt}}v.padding=l.e(E,v.padding);const B=this.transform,k=B.padding,g=new Ze(a,d),b=B.project(g.getNorthWest()),C=B.project(g.getNorthEast()),M=B.project(g.getSouthEast()),O=B.project(g.getSouthWest()),z=l.b8(-m),U=b.rotate(z),V=C.rotate(z),G=M.rotate(z),J=O.rotate(z),lt=new l.P(Math.max(U.x,V.x,J.x,G.x),Math.max(U.y,V.y,J.y,G.y)),tt=new l.P(Math.min(U.x,V.x,J.x,G.x),Math.min(U.y,V.y,J.y,G.y)),ut=lt.sub(tt),dt=(B.width-(k.left+k.right+v.padding.left+v.padding.right))/ut.x,Tt=(B.height-(k.top+k.bottom+v.padding.top+v.padding.bottom))/ut.y;if(Tt<0||dt<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const wt=Math.min(B.scaleZoom(B.scale*Math.min(dt,Tt)),v.maxZoom),gt=l.P.convert(v.offset),mt=new l.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(l.b8(m)),Dt=gt.add(mt).mult(B.scale/B.zoomScale(wt));return{center:B.unproject(b.add(M).div(2).sub(Dt)),zoom:wt,bearing:m}}fitBounds(a,d,m){return this._fitInternal(this.cameraForBounds(a,d),d,m)}fitScreenCoordinates(a,d,m,v,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(a)),this.transform.pointLocation(l.P.convert(d)),m,v),v,E)}_fitInternal(a,d,m){return a?(delete(d=l.e(a,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(a,d){this.stop();const m=this._getTransformForUpdate();let v=!1,E=!1,B=!1;return"zoom"in a&&m.zoom!==+a.zoom&&(v=!0,m.zoom=+a.zoom),a.center!==void 0&&(m.center=l.M.convert(a.center)),"bearing"in a&&m.bearing!==+a.bearing&&(E=!0,m.bearing=+a.bearing),"pitch"in a&&m.pitch!==+a.pitch&&(B=!0,m.pitch=+a.pitch),a.padding==null||m.isPaddingEqual(a.padding)||(m.padding=a.padding),this._applyUpdatedTransform(m),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),v&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),E&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),B&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const E=l.Y.fromLngLat(a,d),B=l.Y.fromLngLat(m,v),k=B.x-E.x,g=B.y-E.y,b=B.z-E.z,C=Math.hypot(k,g,b);if(C===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(k,g),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/C/this.transform.tileSize),z=180*Math.atan2(k,-g)/Math.PI;let U=180*Math.acos(M/C)/Math.PI;return U=b<0?90-U:90+U,{center:B.toLngLat(),zoom:O,pitch:U,bearing:z}}easeTo(a,d){var m;this._stop(!1,a.easeId),((a=l.e({offset:[0,0],duration:500,easing:l.b7},a)).animate===!1||!a.essential&&T.prefersReducedMotion)&&(a.duration=0);const v=this._getTransformForUpdate(),E=this.getZoom(),B=this.getBearing(),k=this.getPitch(),g=this.getPadding(),b="bearing"in a?this._normalizeBearing(a.bearing,B):B,C="pitch"in a?+a.pitch:k,M="padding"in a?a.padding:v.padding,O=l.P.convert(a.offset);let z=v.centerPoint.add(O);const U=v.pointLocation(z),{center:V,zoom:G}=v.getConstrained(l.M.convert(a.center||U),(m=a.zoom)!==null&&m!==void 0?m:E);this._normalizeCenter(V);const J=v.project(U),lt=v.project(V).sub(J),tt=v.zoomScale(G-E);let ut,dt;a.around&&(ut=l.M.convert(a.around),dt=v.locationPoint(ut));const Tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||G!==E,this._rotating=this._rotating||B!==b,this._pitching=this._pitching||C!==k,this._padding=!v.isPaddingEqual(M),this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,Tt),this.terrain&&this._prepareElevation(V),this._ease(wt=>{if(this._zooming&&(v.zoom=l.z.number(E,G,wt)),this._rotating&&(v.bearing=l.z.number(B,b,wt)),this._pitching&&(v.pitch=l.z.number(k,C,wt)),this._padding&&(v.interpolatePadding(g,M,wt),z=v.centerPoint.add(O)),this.terrain&&!a.freezeElevation&&this._updateElevation(wt),ut)v.setLocationAtPoint(ut,dt);else{const gt=v.zoomScale(v.zoom-E),mt=G>E?Math.min(2,tt):Math.max(.5,tt),Dt=Math.pow(mt,1-wt),Xt=v.unproject(J.add(lt.mult(wt*Dt)).mult(gt));v.setLocationAtPoint(v.renderWorldCopies?Xt.wrap():Xt,z)}this._applyUpdatedTransform(v),this._fireMoveEvents(d)},wt=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,wt)},a),this}_prepareEase(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||m.moving||this.fire(new l.k("movestart",a)),this._zooming&&!m.zooming&&this.fire(new l.k("zoomstart",a)),this._rotating&&!m.rotating&&this.fire(new l.k("rotatestart",a)),this._pitching&&!m.pitching&&this.fire(new l.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(m-(d-(m*a+this._elevationStart))/(1-a)),this._elevationTarget=d}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const d=a.clone(),{center:m,zoom:v,pitch:E,bearing:B,elevation:k}=this.transformCameraUpdate(d);m&&(d.center=m),v!==void 0&&(d.zoom=v),E!==void 0&&(d.pitch=E),B!==void 0&&(d.bearing=B),k!==void 0&&(d.elevation=k),this.transform.apply(d)}_fireMoveEvents(a){this.fire(new l.k("move",a)),this._zooming&&this.fire(new l.k("zoom",a)),this._rotating&&this.fire(new l.k("rotate",a)),this._pitching&&this.fire(new l.k("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,v=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.k("zoomend",a)),v&&this.fire(new l.k("rotateend",a)),E&&this.fire(new l.k("pitchend",a)),this.fire(new l.k("moveend",a))}flyTo(a,d){var m;if(!a.essential&&T.prefersReducedMotion){const xe=l.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xe,d)}this.stop(),a=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},a);const v=this._getTransformForUpdate(),E=this.getZoom(),B=this.getBearing(),k=this.getPitch(),g=this.getPadding(),b="bearing"in a?this._normalizeBearing(a.bearing,B):B,C="pitch"in a?+a.pitch:k,M="padding"in a?a.padding:v.padding,O=l.P.convert(a.offset);let z=v.centerPoint.add(O);const U=v.pointLocation(z),{center:V,zoom:G}=v.getConstrained(l.M.convert(a.center||U),(m=a.zoom)!==null&&m!==void 0?m:E);this._normalizeCenter(V);const J=v.zoomScale(G-E),lt=v.project(U),tt=v.project(V).sub(lt);let ut=a.curve;const dt=Math.max(v.width,v.height),Tt=dt/J,wt=tt.mag();if("minZoom"in a){const xe=l.ac(Math.min(a.minZoom,E,G),v.minZoom,v.maxZoom),Oe=dt/v.zoomScale(xe-E);ut=Math.sqrt(Oe/wt*2)}const gt=ut*ut;function mt(xe){const Oe=(Tt*Tt-dt*dt+(xe?-1:1)*gt*gt*wt*wt)/(2*(xe?Tt:dt)*gt*wt);return Math.log(Math.sqrt(Oe*Oe+1)-Oe)}function Dt(xe){return(Math.exp(xe)-Math.exp(-xe))/2}function Xt(xe){return(Math.exp(xe)+Math.exp(-xe))/2}const ie=mt(!1);let re=function(xe){return Xt(ie)/Xt(ie+ut*xe)},ue=function(xe){return dt*((Xt(ie)*(Dt(Oe=ie+ut*xe)/Xt(Oe))-Dt(ie))/gt)/wt;var Oe},Pe=(mt(!0)-ie)/ut;if(Math.abs(wt)<1e-6||!isFinite(Pe)){if(Math.abs(dt-Tt)<1e-6)return this.easeTo(a,d);const xe=Tt<dt?-1:1;Pe=Math.abs(Math.log(Tt/dt))/ut,ue=()=>0,re=Oe=>Math.exp(xe*ut*Oe)}return a.duration="duration"in a?+a.duration:1e3*Pe/("screenSpeed"in a?+a.screenSpeed/ut:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=B!==b,this._pitching=C!==k,this._padding=!v.isPaddingEqual(M),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(V),this._ease(xe=>{const Oe=xe*Pe,Xe=1/re(Oe);v.zoom=xe===1?G:E+v.scaleZoom(Xe),this._rotating&&(v.bearing=l.z.number(B,b,xe)),this._pitching&&(v.pitch=l.z.number(k,C,xe)),this._padding&&(v.interpolatePadding(g,M,xe),z=v.centerPoint.add(O)),this.terrain&&!a.freezeElevation&&this._updateElevation(xe);const We=xe===1?V:v.unproject(lt.add(tt.mult(ue(Oe))).mult(Xe));v.setLocationAtPoint(v.renderWorldCopies?We.wrap():We,z),this._applyUpdatedTransform(v),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}if(!a){const m=this.handlers;m&&m.stop(!1)}return this}_ease(a,d,m){m.animate===!1||m.duration===0?(a(1),d()):(this._easeStart=T.now(),this._easeOptions=m,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,d){a=l.b1(a,-180,180);const m=Math.abs(a-d);return Math.abs(a-360-d)<m&&(a-=360),Math.abs(a+360-d)<m&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const m=a.lng-d.center.lng;a.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const Vu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class qu{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Vu;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const m=this._map._getUIString(`AttributionControl.${d}`);a.title=m,a.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const d=this._map.style.sourceCaches;for(const v in d){const E=d[v];if(E.used||E.usedForTerrain){const B=E.getSource();B.attribution&&a.indexOf(B.attribution)<0&&a.push(B.attribution)}}a=a.filter(v=>String(v).trim()),a.sort((v,E)=>v.length-E.length),a=a.filter((v,E)=>{for(let B=E+1;B<a.length;B++)if(a[B].indexOf(v)>=0)return!1;return!0});const m=a.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,a.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class eu{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const d=P.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Hu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const v of m)if(v.id===a)return void(v.cancelled=!0)}run(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Cc=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class Fa extends l.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,d){this.sourceCache.update(a,d),this._renderableTilesKeys=[];const m={};for(const v of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))m[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),l.aN(v.posMatrix,0,l.W,0,l.W,0,1),this._tiles[v.key]=new Ai(v,this.tileSize));for(const v in this._tiles)m[v]||delete this._tiles[v]}freeRtt(a){for(const d in this._tiles){const m=this._tiles[d];(!a||m.tileID.equals(a)||m.tileID.isChildOf(a)||a.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const d={};for(const m of this._renderableTilesKeys){const v=this._tiles[m].tileID;if(v.canonical.equals(a.canonical)){const E=a.clone();E.posMatrix=new Float64Array(16),l.aN(E.posMatrix,0,l.W,0,l.W,0,1),d[m]=E}else if(v.canonical.isChildOf(a.canonical)){const E=a.clone();E.posMatrix=new Float64Array(16);const B=v.canonical.z-a.canonical.z,k=v.canonical.x-(v.canonical.x>>B<<B),g=v.canonical.y-(v.canonical.y>>B<<B),b=l.W>>B;l.aN(E.posMatrix,0,b,0,b,0,1),l.H(E.posMatrix,E.posMatrix,[-k*b,-g*b,0]),d[m]=E}else if(a.canonical.isChildOf(v.canonical)){const E=a.clone();E.posMatrix=new Float64Array(16);const B=a.canonical.z-v.canonical.z,k=a.canonical.x-(a.canonical.x>>B<<B),g=a.canonical.y-(a.canonical.y>>B<<B),b=l.W>>B;l.aN(E.posMatrix,0,l.W,0,l.W,0,1),l.H(E.posMatrix,E.posMatrix,[k*b,g*b,0]),l.J(E.posMatrix,E.posMatrix,[1/2**B,1/2**B,0]),d[m]=E}}return d}getSourceTile(a,d){const m=this.sourceCache._source;let v=a.overscaledZ-this.deltaZoom;if(v>m.maxzoom&&(v=m.maxzoom),v<m.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(v).key);let E=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!E||!E.dem)&&d)for(;v>=m.minzoom&&(!E||!E.dem);)E=this.sourceCache.getTileByID(a.scaledTo(v--).key);return E}tilesAfterTime(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=a)}}class Je{constructor(a,d,m){this.painter=a,this.sourceCache=new Fa(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l.W;var E;if(!(d>=0&&d<v&&m>=0&&m<v))return 0;const B=this.getTerrainData(a),k=(E=B.tile)===null||E===void 0?void 0:E.dem;if(!k)return 0;const g=function(U,V,G){var J=V[0],lt=V[1];return U[0]=G[0]*J+G[4]*lt+G[12],U[1]=G[1]*J+G[5]*lt+G[13],U}([],[d/v*l.W,m/v*l.W],B.u_terrain_matrix),b=[g[0]*k.dim,g[1]*k.dim],C=Math.floor(b[0]),M=Math.floor(b[1]),O=b[0]-C,z=b[1]-M;return k.get(C,M)*(1-O)*(1-z)+k.get(C+1,M)*O*(1-z)+k.get(C,M+1)*(1-O)*z+k.get(C+1,M+1)*O*z}getElevationForLngLatZoom(a,d){const{tileID:m,mercatorX:v,mercatorY:E}=this._getOverscaledTileIDFromLngLatZoom(a,d);return this.getElevation(m,v%l.W,E%l.W,l.W)}getElevation(a,d,m){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l.W;return this.getDEMElevation(a,d,m,v)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const v=this.painter.context,E=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ct(v,E,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ct(v,new l.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(a,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const v=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new ct(v,d.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),d.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+a.key;if(m&&!this._demMatrixCache[m]){const v=this.sourceCache.sourceCache._source.maxzoom;let E=a.canonical.z-d.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=v?E=a.canonical.z-v:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const B=a.canonical.x-(a.canonical.x>>E<<E),k=a.canonical.y-(a.canonical.y>>E<<E),g=l.b9(new Float64Array(16),[1/(l.W<<E),1/(l.W<<E),0]);l.H(g,g,[B*l.W,k*l.W,0]),this._demMatrixCache[a.key]={matrix:g,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(a){const d=this.painter,m=d.width/devicePixelRatio,v=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ct(d.context,{width:m,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ct(d.context,{width:m,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,v,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,v))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let E=0,B=0;E<this._coordsTextureSize;E++)for(let k=0;k<this._coordsTextureSize;k++,B+=4)d[B+0]=255&k,d[B+1]=255&E,d[B+2]=k>>8<<4|E>>8,d[B+3]=0;const m=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),v=new ct(a,m,a.gl.RGBA,{premultiply:!1});return v.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(a){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),m=this.painter.context,v=m.gl,E=Math.round(a.x*this.painter.pixelRatio/devicePixelRatio),B=Math.round(a.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(E,k-B-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const g=d[0]+(d[2]>>4<<8),b=d[1]+((15&d[2])<<8),C=this.coordsIndex[255-d[3]],M=C&&this.sourceCache.getTileByID(C);if(!M)return null;const O=this._coordsTextureSize,z=(1<<M.tileID.canonical.z)*O;return new l.Y((M.tileID.canonical.x*O+g)/z+M.tileID.wrap,(M.tileID.canonical.y*O+b)/z,this.getElevation(M.tileID,g,b,O))}depthAtPoint(a){const d=new Uint8Array(4),m=this.painter.context,v=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,d=new l.ba,m=new l.aX,v=this.meshSize,E=l.W/v,B=v*v;for(let M=0;M<=v;M++)for(let O=0;O<=v;O++)d.emplaceBack(O*E,M*E,0);for(let M=0;M<B;M+=v+1)for(let O=0;O<v;O++)m.emplaceBack(O+M,v+O+M+1,v+O+M+2),m.emplaceBack(O+M,v+O+M+2,O+M+1);const k=d.length,g=k+2*(v+1);for(const M of[0,1])for(let O=0;O<=v;O++)for(const z of[0,1])d.emplaceBack(O*E,M*l.W,z);for(let M=0;M<2*v;M+=2)m.emplaceBack(g+M,g+M+1,g+M+3),m.emplaceBack(g+M,g+M+3,g+M+2),m.emplaceBack(k+M,k+M+3,k+M+1),m.emplaceBack(k+M,k+M+2,k+M+3);const b=d.length,C=b+2*(v+1);for(const M of[0,1])for(let O=0;O<=v;O++)for(const z of[0,1])d.emplaceBack(M*l.W,O*E,z);for(let M=0;M<2*v;M+=2)m.emplaceBack(b+M,b+M+1,b+M+3),m.emplaceBack(b+M,b+M+3,b+M+2),m.emplaceBack(C+M,C+M+3,C+M+1),m.emplaceBack(C+M,C+M+2,C+M+3);return this._mesh={indexBuffer:a.createIndexBuffer(m),vertexBuffer:a.createVertexBuffer(d,Cc.members),segments:l.$.simpleSegment(0,0,d.length,m.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*l.bb/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,d){var m;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(a,d);return(m=this.getMinMaxElevation(v).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(a){const d=this.getTerrainData(a).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(a,d){const m=l.Y.fromLngLat(a.wrap()),v=(1<<d)*l.W,E=m.x*v,B=m.y*v,k=Math.floor(E/l.W),g=Math.floor(B/l.W);return{tileID:new l.Q(d,0,d,k,g),mercatorX:E,mercatorY:B}}}class sa{constructor(a,d,m){this._context=a,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new ct(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:a,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>a.id!==d),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const cs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class vn{constructor(a,d){this.painter=a,this.terrain=d,this.pool=new sa(a.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(m=>!a._layers[m].isHidden(d)),this._coordsDescendingInv={};for(const m in a.sourceCaches){this._coordsDescendingInv[m]={};const v=a.sourceCaches[m].getVisibleCoordinates();for(const E of v){const B=this.terrain.sourceCache.getTerrainCoords(E);for(const k in B)this._coordsDescendingInv[m][k]||(this._coordsDescendingInv[m][k]=[]),this._coordsDescendingInv[m][k].push(B[k])}}this._coordsDescendingInvStr={};for(const m of a._order){const v=a._layers[m],E=v.source;if(cs[v.type]&&!this._coordsDescendingInvStr[E]){this._coordsDescendingInvStr[E]={};for(const B in this._coordsDescendingInv[E])this._coordsDescendingInvStr[E][B]=this._coordsDescendingInv[E][B].map(k=>k.key).sort().join()}}for(const m of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const E=this._coordsDescendingInvStr[v][m.tileID.key];E&&E!==m.rttCoords[v]&&(m.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const d=a.type,m=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(cs[d]&&(this._prevType&&cs[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(a.id),!v))return!0;if(cs[this._prevType]||cs[d]&&v){this._prevType=d;const E=this._stacks.length-1,B=this._stacks[E]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(wc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[E]){const b=this.pool.getObjectForId(k.rtt[E].id);if(b.stamp===k.rtt[E].stamp){this.pool.useObject(b);continue}}const g=this.pool.getOrCreateFreeObject();this.pool.useObject(g),this.pool.stampObject(g),k.rtt[E]={id:g.id,stamp:g.stamp},m.context.bindFramebuffer.set(g.fbo.framebuffer),m.context.clear({color:l.aO.transparent,stencil:0}),m.currentStencilSource=void 0;for(let b=0;b<B.length;b++){const C=m.style._layers[B[b]],M=C.source?this._coordsDescendingInv[C.source][k.tileID.key]:[k.tileID];m.context.viewport.set([0,0,g.fbo.width,g.fbo.height]),m._renderTileClippingMasks(C,M),m.renderLayer(m,m.style.sourceCaches[C.source],C,M),C.source&&(k.rttCoords[C.source]=this._coordsDescendingInvStr[C.source][k.tileID.key])}}return wc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),cs[d]}return!1}}const Wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ze=f,Lo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Vu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},bn=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},ep={showCompass:!0,showZoom:!0,visualizePitch:!1};class iu{constructor(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=B=>{this.startMouse(l.e({},B,{ctrlKey:!0,preventDefault:()=>B.preventDefault()}),P.mousePos(this.element,B)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=B=>{this.moveMouse(B,P.mousePos(this.element,B))},this.mouseup=B=>{this.mouseRotate.dragEnd(B),this.mousePitch&&this.mousePitch.dragEnd(B),this.offTemp()},this.touchstart=B=>{B.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.startTouch(B,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=B=>{B.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.moveTouch(B,this._lastPos))},this.touchend=B=>{B.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=a.dragRotate._mouseRotate.getClickTolerance(),E=a.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=ta({clickTolerance:v,enable:!0}),this.touchRotate=(B=>{let{enable:k,clickTolerance:g,bearingDegreesPerPixelMoved:b=.8}=B;const C=new nh;return new lo({clickTolerance:g,move:(M,O)=>({bearingDelta:(O.x-M.x)*b}),moveStateManager:C,enable:k,assignEvents:bn})})({clickTolerance:v,enable:!0}),this.map=a,m&&(this.mousePitch=en({clickTolerance:E,enable:!0}),this.touchPitch=(B=>{let{enable:k,clickTolerance:g,pitchDegreesPerPixelMoved:b=-.5}=B;const C=new nh;return new lo({clickTolerance:g,move:(M,O)=>({pitchDelta:(O.y-M.y)*b}),moveStateManager:C,enable:k,assignEvents:bn})})({clickTolerance:E,enable:!0})),P.addEventListener(d,"mousedown",this.mousedown),P.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(d,"touchcancel",this.reset)}startMouse(a,d){this.mouseRotate.dragStart(a,d),this.mousePitch&&this.mousePitch.dragStart(a,d),P.disableDrag()}startTouch(a,d){this.touchRotate.dragStart(a,d),this.touchPitch&&this.touchPitch.dragStart(a,d),P.disableDrag()}moveMouse(a,d){const m=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(a,d)||{};if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){const{pitchDelta:E}=this.mousePitch.dragMove(a,d)||{};E&&m.setPitch(m.getPitch()+E)}}moveTouch(a,d){const m=this.map,{bearingDelta:v}=this.touchRotate.dragMove(a,d)||{};if(v&&m.setBearing(m.getBearing()+v),this.touchPitch){const{pitchDelta:E}=this.touchPitch.dragMove(a,d)||{};E&&m.setPitch(m.getPitch()+E)}}off(){const a=this.element;P.removeEventListener(a,"mousedown",this.mousedown),P.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let na;function hh(w,a,d){const m=new l.M(w.lng,w.lat);if(w=new l.M(w.lng,w.lat),a){const v=new l.M(w.lng-360,w.lat),E=new l.M(w.lng+360,w.lat),B=d.locationPoint(w).distSqr(a);d.locationPoint(v).distSqr(a)<B?w=v:d.locationPoint(E).distSqr(a)<B&&(w=E)}for(;Math.abs(w.lng-d.center.lng)>180;){const v=d.locationPoint(w);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;w.lng>d.center.lng?w.lng-=360:w.lng+=360}return w.lng!==m.lng&&d.locationPoint(w).y>d.height/2-d.getHorizon()?w:m}const uh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ru(w,a,d){const m=w.classList;for(const v in uh)m.remove(`maplibregl-${d}-anchor-${v}`);m.add(`maplibregl-${d}-anchor-${a}`)}class oa extends l.E{constructor(a){if(super(),this._onKeyPress=d=>{const m=d.code,v=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,v=this._element;this._popup&&(m===v||v.contains(m))&&this.togglePopup()},this._update=d=>{var m;if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?hh(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let E="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?E=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(E=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let B="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?B="rotateX(0deg)":this._pitchAlignment==="map"&&(B=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${uh[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${B} ${E}`),T.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=l.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const d=P.createNS("http://www.w3.org/2000/svg","svg"),m=41,v=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${v}px`),d.setAttributeNS(null,"viewBox",`0 0 ${v} ${m}`);const E=P.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const B=P.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");const k=P.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const g=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of g){const lt=P.createNS("http://www.w3.org/2000/svg","ellipse");lt.setAttributeNS(null,"opacity","0.04"),lt.setAttributeNS(null,"cx","10.5"),lt.setAttributeNS(null,"cy","5.80029008"),lt.setAttributeNS(null,"rx",J.rx),lt.setAttributeNS(null,"ry",J.ry),k.appendChild(lt)}const b=P.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill",this._color);const C=P.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),b.appendChild(C);const M=P.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const O=P.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(O);const z=P.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),z.setAttributeNS(null,"fill","#FFFFFF");const U=P.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const V=P.createNS("http://www.w3.org/2000/svg","circle");V.setAttributeNS(null,"fill","#000000"),V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"cx","5.5"),V.setAttributeNS(null,"cy","5.5"),V.setAttributeNS(null,"r","5.4999962");const G=P.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),U.appendChild(V),U.appendChild(G),B.appendChild(k),B.appendChild(b),B.appendChild(M),B.appendChild(z),B.appendChild(U),d.appendChild(B),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),ru(this._element,this._anchor,"marker"),a&&a.className)for(const d of a.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=l.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const d=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d,m;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,E=v.terrain.depthAtPoint(this._pos),B=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,B)-E<.006)return void(this._element.style.opacity=this._opacity);const k=-this._offset.y/v.transform._pixelPerMeter,g=Math.sin(v.getPitch()*Math.PI/180)*k,b=v.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),C=v.transform.lngLatToCameraDepth(this._lngLat,B+g)-b>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&C&&this._popup.remove(),this._element.style.opacity=C?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=l.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,d){return a===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const br={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mo=0,co=!1;const dh={maxWidth:100,unit:"metric"};function ph(w,a,d){const m=d&&d.maxWidth||100,v=w._container.clientHeight/2,E=w.unproject([0,v]),B=w.unproject([m,v]),k=E.distanceTo(B);if(d&&d.unit==="imperial"){const g=3.2808*k;g>5280?ql(a,m,g/5280,w._getUIString("ScaleControl.Miles")):ql(a,m,g,w._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?ql(a,m,k/1852,w._getUIString("ScaleControl.NauticalMiles")):k>=1e3?ql(a,m,k/1e3,w._getUIString("ScaleControl.Kilometers")):ql(a,m,k,w._getUIString("ScaleControl.Meters"))}function ql(w,a,d,m){const v=function(E){const B=Math.pow(10,`${Math.floor(E)}`.length-1);let k=E/B;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(g){const b=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*b)/b}(k),B*k}(d);w.style.width=a*(v/d)+"px",w.innerHTML=`${v}&nbsp;${m}`}const Ju={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Bo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Tc(w){if(w){if(typeof w=="number"){const a=Math.round(Math.abs(w)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,w),"top-left":new l.P(a,a),"top-right":new l.P(-a,a),bottom:new l.P(0,-w),"bottom-left":new l.P(a,-a),"bottom-right":new l.P(-a,-a),left:new l.P(w,0),right:new l.P(-w,0)}}if(w instanceof l.P||Array.isArray(w)){const a=l.P.convert(w);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:l.P.convert(w.center||[0,0]),top:l.P.convert(w.top||[0,0]),"top-left":l.P.convert(w["top-left"]||[0,0]),"top-right":l.P.convert(w["top-right"]||[0,0]),bottom:l.P.convert(w.bottom||[0,0]),"bottom-left":l.P.convert(w["bottom-left"]||[0,0]),"bottom-right":l.P.convert(w["bottom-right"]||[0,0]),left:l.P.convert(w.left||[0,0]),right:l.P.convert(w.right||[0,0])}}return Tc(new l.P(0,0))}const oi=f;c.AJAXError=l.be,c.Evented=l.E,c.LngLat=l.M,c.MercatorCoordinate=l.Y,c.Point=l.P,c.addProtocol=l.bf,c.config=l.a,c.removeProtocol=l.bg,c.AttributionControl=qu,c.BoxZoomHandler=Xr,c.CanvasSource=ci,c.CooperativeGesturesHandler=tu,c.DoubleClickZoomHandler=Ec,c.DragPanHandler=ch,c.DragRotateHandler=Qh,c.EdgeInsets=ro,c.FullscreenControl=class extends l.E{constructor(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var a;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=d==null?void 0:d.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=_e,c.GeolocateControl=class extends l.E{constructor(w){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const d=new l.M(a.coords.longitude,a.coords.latitude),m=a.coords.accuracy,v=this._map.getBearing(),E=l.e({bearing:v},this.options.fitBoundsOptions),B=Ze.fromLngLat(d,m);this._map.fitBounds(B,E,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const d=new l.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&co)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new oa({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new oa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},br,w)}onAdd(w){return this._map=w,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(na!==void 0&&!a)return na;if(window.navigator.permissions===void 0)return na=!!window.navigator.geolocation,na;try{na=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{na=!!window.navigator.geolocation}return na}()})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mo=0,co=!1}_isOutOfMapMaxBounds(w){const a=this._map.getMaxBounds(),d=w.coords;return a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),a=w.getSouthEast(),d=w.getNorthEast(),m=a.distanceTo(d),v=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mo--,co=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mo++,Mo>1?(w={maximumAge:6e5,timeout:0},co=!0):(w=this.options.positionOptions,co=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=On,c.ImageSource=Le,c.KeyboardHandler=lh,c.LngLatBounds=Ze,c.LogoControl=eu,c.Map=class extends ra{constructor(w){if(l.bc.mark(l.bd.create),(w=l.e({},Lo,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Js(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new Hu,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},Wu,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=w.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=ht.addThrottleControl(()=>this.isMoving()),this._requestManager=new _t(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const d=rl(m=>{this._trackResize&&!this._removed&&this.resize(m)._update()},50);this._resizeObserver=new ResizeObserver(m=>{a?d(m):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Dn(this,w),this._hash=w.hash&&new On(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,l.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new qu(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new eu,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new l.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new l.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new l.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(w,a){if(a===void 0&&(a=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=w.onAdd(this);this._controls.push(w);const m=this._controlPositions[a];return a.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(w);return a>-1&&this._controls.splice(a,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,a,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,a,d,m)}resize(w){var a;const d=this._containerDimensions(),m=d[0],v=d[1],E=this._getClampedPixelRatio(m,v);if(this._resizeCanvas(m,v,E),this.painter.resize(m,v,E),this.painter.overLimit()){const k=this.painter.context.gl;this._maxCanvasSize=[k.drawingBufferWidth,k.drawingBufferHeight];const g=this._getClampedPixelRatio(m,v);this._resizeCanvas(m,v,g),this.painter.resize(m,v,g)}this.transform.resize(m,v),(a=this._requestedCameraState)===null||a===void 0||a.resize(m,v);const B=!this._moving;return B&&(this.stop(),this.fire(new l.k("movestart",w)).fire(new l.k("move",w))),this.fire(new l.k("resize",w)),B&&this.fire(new l.k("moveend",w)),this}_getClampedPixelRatio(w,a){const{0:d,1:m}=this._maxCanvasSize,v=this.getPixelRatio(),E=w*v,B=a*v;return Math.min(E>d?d/E:1,B>m?m/B:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Ze.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(l.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(l.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,a,d){if(w==="mouseenter"||w==="mouseover"){let m=!1;return{layer:a,listener:d,delegates:{mousemove:v=>{const E=this.getLayer(a)?this.queryRenderedFeatures(v.point,{layers:[a]}):[];E.length?m||(m=!0,d.call(this,new Jr(w,this,v.originalEvent,{features:E}))):m=!1},mouseout:()=>{m=!1}}}}if(w==="mouseleave"||w==="mouseout"){let m=!1;return{layer:a,listener:d,delegates:{mousemove:v=>{(this.getLayer(a)?this.queryRenderedFeatures(v.point,{layers:[a]}):[]).length?m=!0:m&&(m=!1,d.call(this,new Jr(w,this,v.originalEvent)))},mouseout:v=>{m&&(m=!1,d.call(this,new Jr(w,this,v.originalEvent)))}}}}{const m=v=>{const E=this.getLayer(a)?this.queryRenderedFeatures(v.point,{layers:[a]}):[];E.length&&(v.features=E,d.call(this,v),delete v.features)};return{layer:a,listener:d,delegates:{[w]:m}}}}on(w,a,d){if(d===void 0)return super.on(w,a);const m=this._createDelegatedListener(w,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(w,a,d){if(d===void 0)return super.once(w,a);const m=this._createDelegatedListener(w,a,d);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(w,a,d){return d===void 0?super.off(w,a):(this._delegatedListeners&&this._delegatedListeners[w]&&(m=>{const v=this._delegatedListeners[w];for(let E=0;E<v.length;E++){const B=v[E];if(B.layer===a&&B.listener===d){for(const k in B.delegates)this.off(k,B.delegates[k]);return v.splice(E,1),this}}})(),this)}queryRenderedFeatures(w,a){if(!this.style)return[];let d;const m=w instanceof l.P||Array.isArray(w),v=m?w:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(m?{}:w)||{},v instanceof l.P||typeof v[0]=="number")d=[l.P.convert(v)];else{const E=l.P.convert(v[0]),B=l.P.convert(v[1]);d=[E,new l.P(B.x,E.y),B,new l.P(E.x,B.y),E]}return this.style.queryRenderedFeatures(d,a,this.transform)}querySourceFeatures(w,a){return this.style.querySourceFeatures(w,a)}setStyle(w,a){return(a=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(w,a))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const a=this._locale[w];if(a==null)throw new Error(`Missing UI string '${w}'`);return a}_updateStyle(w,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,a));const d=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new wo(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,a,d):this.style.loadJSON(w,a,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,a){if(typeof w=="string"){const d=this._requestManager.transformRequest(w,"Style");l.h(d,new AbortController).then(m=>{this._updateDiff(m.data,a)}).catch(m=>{m&&this.fire(new l.j(m))})}else typeof w=="object"&&this._updateDiff(w,a)}_updateDiff(w,a){try{this.style.setState(w,a)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(w,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(w,a){return this._lazyInitEmptyStyle(),this.style.addSource(w,a),this._update(!0)}isSourceLoaded(w){const a=this.style&&this.style.sourceCaches[w];if(a!==void 0)return a.loaded();this.fire(new l.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const a=this.style.sourceCaches[w.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&a.reload();for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===w.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Je(this.painter,a,w),this.painter.renderToTexture=new vn(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:w})),this}getTerrain(){var w,a;return(a=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const a in w){const d=w[a]._tiles;for(const m in d){const v=d[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:m=1,sdf:v=!1,stretchX:E,stretchY:B,content:k,textFitWidth:g,textFitHeight:b}=d;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||l.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:M,data:O}=a,z=a;return this.style.addImage(w,{data:new l.R({width:C,height:M},new Uint8Array(O)),pixelRatio:m,stretchX:E,stretchY:B,content:k,textFitWidth:g,textFitHeight:b,sdf:v,version:0,userImage:z}),z.onAdd&&z.onAdd(this,w),this}}{const{width:C,height:M,data:O}=T.getImageData(a);this.style.addImage(w,{data:new l.R({width:C,height:M},O),pixelRatio:m,stretchX:E,stretchY:B,content:k,textFitWidth:g,textFitHeight:b,sdf:v,version:0})}}updateImage(w,a){const d=this.style.getImage(w);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=a instanceof HTMLImageElement||l.b(a)?T.getImageData(a):a,{width:v,height:E,data:B}=m;if(v===void 0||E===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==d.data.width||E!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(a instanceof HTMLImageElement||l.b(a));return d.data.replace(B,k),this.style.updateImage(w,d),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return ht.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,a){return this._lazyInitEmptyStyle(),this.style.addLayer(w,a),this._update(!0)}moveLayer(w,a){return this.style.moveLayer(w,a),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,a,d){return this.style.setLayerZoomRange(w,a,d),this._update(!0)}setFilter(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(w,a,d),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,a,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(w,a,d,m),this._update(!0)}getPaintProperty(w,a){return this.style.getPaintProperty(w,a)}setLayoutProperty(w,a,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(w,a,d,m),this._update(!0)}getLayoutProperty(w,a){return this.style.getLayoutProperty(w,a)}setGlyphs(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(w,a,d,m=>{m||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(w,a,d=>{d||this._update(!0)}),this}setLight(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(w,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,a){return this.style.setFeatureState(w,a),this._update()}removeFeatureState(w,a){return this.style.removeFeatureState(w,a),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,a=0;return this._container&&(w=this._container.clientWidth||400,a=this._container.clientHeight||300),[w,a]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const a=this._canvasContainer=P.create("div","maplibregl-canvas-container",w);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const v=this._controlContainer=P.create("div","maplibregl-control-container",w),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(B=>{E[B]=P.create("div",`maplibregl-ctrl-${B} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,a,d){this._canvas.width=Math.floor(d*w),this._canvas.height=Math.floor(d*a),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{a={requestedAttributes:w},m&&(a.statusMessage=m.statusMessage,a.type=m.type)},{once:!0});const d=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!d){const m="Failed to initialize WebGL";throw a?(a.message=m,new Error(JSON.stringify(a))):new Error(m)}this.painter=new Co(d,this.transform),L.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,E=T.now();this.style.zoomHistory.update(v,E);const B=new l.a8(v,{now:E,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=B.crossFadingFactor();k===1&&k===this._crossFadingFactor||(d=!0,this._crossFadingFactor=k),this.style.update(B)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ht.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(w=>{l.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return ze}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=Jr,c.MapTouchEvent=Nn,c.MapWheelEvent=Xs,c.Marker=oa,c.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const a=this._map.getZoom(),d=a===this._map.getMaxZoom(),m=a===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);a.title=m,a.setAttribute("aria-label",m)},this.options=l.e({},ep,w),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new iu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,a){const d=P.create("button",w,this._container);return d.type="button",d.addEventListener("click",a),d}},c.Popup=class extends l.E{constructor(w){super(),this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const k of this.options.className.split(" "))this._container.classList.add(k);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?hh(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!a)return;const m=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let v=this.options.anchor;const E=Tc(this.options.offset);if(!v){const k=this._container.offsetWidth,g=this._container.offsetHeight;let b;b=m.y+E.bottom.y<g?["top"]:m.y>this._map.transform.height-g?["bottom"]:[],m.x<k/2?b.push("left"):m.x>this._map.transform.width-k/2&&b.push("right"),v=b.length===0?"bottom":b.join("-")}let B=m.add(E[v]);this.options.subpixelPositioning||(B=B.round()),P.setTransform(this._container,`${uh[v]} translate(${B.x}px,${B.y}px)`),ru(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Ju),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=l.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const a=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=w;m=d.firstChild,m;)a.appendChild(m);return this.setDOMContent(a)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){return this._container&&this._container.classList.add(w),this}removeClassName(w){return this._container&&this._container.classList.remove(w),this}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Bo);w&&w.focus()}},c.RasterDEMTileSource=ri,c.RasterTileSource=mi,c.ScaleControl=class{constructor(w){this._onMove=()=>{ph(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,ph(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},dh),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=jl,c.Style=wo,c.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=Ul,c.TwoFingersTouchRotateHandler=oh,c.TwoFingersTouchZoomHandler=ea,c.TwoFingersTouchZoomRotateHandler=Gl,c.VectorTileSource=ot,c.VideoSource=Ne,c.addSourceType=(w,a)=>l._(void 0,void 0,void 0,function*(){if(Ci(w))throw new Error(`A source type called "${w}" already exists.`);((d,m)=>{Ei[d]=m})(w,a)}),c.clearPrewarmedResources=function(){const w=Gt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(nt),Gt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return ai().getRTLTextPluginStatus()},c.getVersion=function(){return oi},c.getWorkerCount=function(){return Et.workerCount},c.getWorkerUrl=function(){return l.a.WORKER_URL},c.importScriptInWorkers=function(w){return Kt().broadcast("IS",w)},c.prewarm=function(){$t().acquire(nt)},c.setMaxParallelImageRequests=function(w){l.a.MAX_PARALLEL_IMAGE_REQUESTS=w},c.setRTLTextPlugin=function(w,a){return ai().setRTLTextPlugin(w,a)},c.setWorkerCount=function(w){Et.workerCount=w},c.setWorkerUrl=function(w){l.a.WORKER_URL=w}});var n=e;return n})})(dA);var fA=dA.exports;const Cn=Im(fA);var un;(function(i){i[i.Unknown=0]="Unknown",i[i.Point=1]="Point",i[i.LineString=2]="LineString",i[i.Polygon=3]="Polygon",i[i.MultiPoint=4]="MultiPoint",i[i.MultiLineString=5]="MultiLineString",i[i.MultiPolygon=6]="MultiPolygon",i[i.GeometryCollection=7]="GeometryCollection",i[i.CircularString=8]="CircularString",i[i.CompoundCurve=9]="CompoundCurve",i[i.CurvePolygon=10]="CurvePolygon",i[i.MultiCurve=11]="MultiCurve",i[i.MultiSurface=12]="MultiSurface",i[i.Curve=13]="Curve",i[i.Surface=14]="Surface",i[i.PolyhedralSurface=15]="PolyhedralSurface",i[i.TIN=16]="TIN",i[i.Triangle=17]="Triangle"})(un||(un={}));const Ep=4,Cp=4,yf=4,zh=new Int32Array(2),l2=new Float32Array(zh.buffer),c2=new Float64Array(zh.buffer),cg=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Ky;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(Ky||(Ky={}));class Wc{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Wc(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return zh[0]=this.readInt32(t),l2[0]}readFloat64(t){return zh[cg?0:1]=this.readInt32(t),zh[cg?1:0]=this.readInt32(t+4),c2[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){l2[0]=e,this.writeInt32(t,zh[0])}writeFloat64(t,e){c2[0]=e,this.writeInt32(t,zh[cg?0:1]),this.writeInt32(t+4,zh[cg?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Ep+Cp)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Cp;e++)t+=String.fromCharCode(this.readInt8(this.position_+Ep+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);t+=Ep;const s=this.bytes_.subarray(t,t+r);return e===Ky.UTF8_BYTES?s:this.text_decoder_.decode(s)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Ep}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Cp)throw new Error("FlatBuffers: file identifier must be length "+Cp);for(let e=0;e<Cp;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Ep+e))return!1;return!0}createScalarList(t,e){const r=[];for(let s=0;s<e;++s){const n=t(s);n!==null&&r.push(n)}return r}createObjList(t,e){const r=[];for(let s=0;s<e;++s){const n=t(s);n!==null&&r.push(n.unpack())}return r}}let tP=class Do{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new Do).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+yf),(e||new Do).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):un.Unknown}parts(t,e){const r=this.bb.__offset(this.bb_pos,18);return r?(e||new Do).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,un.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,r,s,n,c,l,f,y){return Do.startGeometry(t),Do.addEnds(t,e),Do.addXy(t,r),Do.addZ(t,s),Do.addM(t,n),Do.addT(t,c),Do.addTm(t,l),Do.addType(t,f),Do.addParts(t,y),Do.endGeometry(t)}};function Qy(i,t){const e=[];for(let r=0;r<i.length;r+=2){const s=[i[r],i[r+1]];t&&s.push(t[r>>1]),e.push(s)}return e}function h2(i,t,e){if(!e||e.length===0)return[Qy(i,t)];let r=0;const s=Array.from(e).map(c=>i.slice(r,r=c<<1));let n;return t&&(r=0,n=Array.from(e).map(c=>t.slice(r,r=c))),s.map((c,l)=>Qy(c,n?n[l]:void 0))}function eP(i,t){const e=i.xyArray(),r=i.zArray();switch(t){case un.Point:{const s=Array.from(e);return r&&s.push(r[0]),s}case un.MultiPoint:case un.LineString:return Qy(e,r);case un.MultiLineString:return h2(e,r,i.endsArray());case un.Polygon:return h2(e,r,i.endsArray())}}function t1(i,t){let e=t;if(e===un.Unknown&&(e=i.type()),e===un.GeometryCollection){const s=[];for(let n=0;n<i.partsLength();n++){const c=i.parts(n),l=c.type();s.push(t1(c,l))}return{type:un[e],geometries:s}}else if(e===un.MultiPolygon){const s=[];for(let n=0;n<i.partsLength();n++)s.push(t1(i.parts(n),un.Polygon));return{type:un[e],coordinates:s.map(n=>n.coordinates)}}const r=eP(i,e);return{type:un[e],coordinates:r}}var cn;(function(i){i[i.Byte=0]="Byte",i[i.UByte=1]="UByte",i[i.Bool=2]="Bool",i[i.Short=3]="Short",i[i.UShort=4]="UShort",i[i.Int=5]="Int",i[i.UInt=6]="UInt",i[i.Long=7]="Long",i[i.ULong=8]="ULong",i[i.Float=9]="Float",i[i.Double=10]="Double",i[i.String=11]="String",i[i.Json=12]="Json",i[i.DateTime=13]="DateTime",i[i.Binary=14]="Binary"})(cn||(cn={}));class ln{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new ln).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+yf),(e||new ln).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):cn.Byte}title(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,cn.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){const e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,r,s,n,c,l,f,y,A,T,P){return ln.startColumn(t),ln.addName(t,e),ln.addType(t,r),ln.addTitle(t,s),ln.addDescription(t,n),ln.addWidth(t,c),ln.addPrecision(t,l),ln.addScale(t,f),ln.addNullable(t,y),ln.addUnique(t,A),ln.addPrimaryKey(t,T),ln.addMetadata(t,P),ln.endColumn(t)}}class ml{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new ml).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+yf),(e||new ml).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new tP).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new ln).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,r,s){return ml.startFeature(t),ml.addGeometry(t,e),ml.addProperties(t,r),ml.addColumns(t,s),ml.endFeature(t)}}new TextEncoder;const u2=new TextDecoder;function iP(i,t){const e={};if(!t||t.length===0)return e;const r=i.propertiesArray();if(!r)return e;const s=new DataView(r.buffer,r.byteOffset),n=i.propertiesLength();let c=0;for(;c<n;){const l=s.getUint16(c,!0);c+=2;const f=t[l],y=f.name;switch(f.type){case cn.Bool:{e[y]=!!s.getUint8(c),c+=1;break}case cn.Byte:{e[y]=s.getInt8(c),c+=1;break}case cn.UByte:{e[y]=s.getUint8(c),c+=1;break}case cn.Short:{e[y]=s.getInt16(c,!0),c+=2;break}case cn.UShort:{e[y]=s.getUint16(c,!0),c+=2;break}case cn.Int:{e[y]=s.getInt32(c,!0),c+=4;break}case cn.UInt:{e[y]=s.getUint32(c,!0),c+=4;break}case cn.Long:{e[y]=Number(s.getBigInt64(c,!0)),c+=8;break}case cn.ULong:{e[y]=Number(s.getBigUint64(c,!0)),c+=8;break}case cn.Float:{e[y]=s.getFloat32(c,!0),c+=4;break}case cn.Double:{e[y]=s.getFloat64(c,!0),c+=8;break}case cn.DateTime:case cn.String:{const A=s.getUint32(c,!0);c+=4,e[y]=u2.decode(r.subarray(c,c+A)),c+=A;break}case cn.Json:{const A=s.getUint32(c,!0);c+=4;const T=u2.decode(r.subarray(c,c+A));e[y]=JSON.parse(T),c+=A;break}default:throw new Error("Unknown type "+f.type)}}return e}function h_(i,t){const e=t.columns;return{type:"Feature",geometry:t1(i.geometry(),t.geometryType),properties:iP(i,e)}}const u_=new Uint8Array(0);function rP(){return this._source.cancel()}function sP(i,t){if(!i.length)return t;if(!t.length)return i;var e=new Uint8Array(i.length+t.length);return e.set(i),e.set(t,i.length),e}function nP(){var i=this,t=i._array.subarray(i._index);return i._source.read().then(function(e){return i._array=u_,i._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:sP(t,e.value)}})}function oP(i){if((i|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+i<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=i));var r=new Uint8Array(i);return r.set(this._array.subarray(this._index)),function s(){return t._source.read().then(function(n){return n.done?(t._array=u_,t._index=0,e>0?r.subarray(0,e):null):e+n.value.length>=i?(t._array=n.value,t._index=i-e,r.set(n.value.subarray(0,i-e),e),r):(r.set(n.value,e),e+=n.value.length,s())})}()}function aP(i){return typeof i.slice=="function"?i:new Lm(typeof i.read=="function"?i:i.getReader())}function Lm(i){this._source=i,this._array=u_,this._index=0}Lm.prototype.read=nP;Lm.prototype.slice=oP;Lm.prototype.cancel=rP;class Ga{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new Ga).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+yf),(e||new Ga).__init(t.readInt32(t.position())+t.position(),t)}org(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,r,s,n,c,l){return Ga.startCrs(t),Ga.addOrg(t,e),Ga.addCode(t,r),Ga.addName(t,s),Ga.addDescription(t,n),Ga.addWkt(t,c),Ga.addCodeString(t,l),Ga.endCrs(t)}}class om{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new om).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+yf),(e||new om).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):un.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,e){const r=this.bb.__offset(this.bb_pos,18);return r?(e||new ln).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const e=this.bb.__offset(this.bb_pos,24);return e?(t||new Ga).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){const e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,un.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function d_(i){const t=om.getRootAsHeader(i),e=t.featuresCount(),r=t.indexNodeSize(),s=[];for(let l=0;l<t.columnsLength();l++){const f=t.columns(l);if(!f)throw new Error("Column unexpectedly missing");if(!f.name())throw new Error("Column name unexpectedly missing");s.push({name:f.name(),type:f.type(),title:f.title(),description:f.description(),width:f.width(),precision:f.precision(),scale:f.scale(),nullable:f.nullable(),unique:f.unique(),primary_key:f.primaryKey()})}const n=t.crs(),c=n?{org:n.org(),code:n.code(),name:n.name(),description:n.description(),wkt:n.wkt(),code_string:n.codeString()}:null;return{geometryType:t.geometryType(),columns:s,envelope:null,featuresCount:Number(e),indexNodeSize:r,crs:c,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var e1=function(i,t){return e1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])},e1(i,t)};function lP(i,t){e1(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Nd(i,t,e,r){function s(n){return n instanceof e?n:new e(function(c){c(n)})}return new(e||(e=Promise))(function(n,c){function l(A){try{y(r.next(A))}catch(T){c(T)}}function f(A){try{y(r.throw(A))}catch(T){c(T)}}function y(A){A.done?n(A.value):s(A.value).then(l,f)}y((r=r.apply(i,[])).next())})}function Hh(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(y){return function(A){return f([y,A])}}function f(y){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,s&&(n=y[0]&2?s.return:y[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,y[1])).done)return n;switch(s=0,n&&(y=[y[0]&2,n.value]),y[0]){case 0:case 1:n=y;break;case 4:return e.label++,{value:y[1],done:!1};case 5:e.label++,s=y[1],y=[0];continue;case 7:y=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(y[0]===6||y[0]===2)){e=0;continue}if(y[0]===3&&(!n||y[1]>n[0]&&y[1]<n[3])){e.label=y[1];break}if(y[0]===6&&e.label<n[1]){e.label=n[1],n=y;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(y);break}n[2]&&e.ops.pop(),e.trys.pop();continue}y=t.call(i,e)}catch(A){y=[6,A],s=0}finally{r=n=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function Zd(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function rf(i){return this instanceof rf?(this.v=i,this):new rf(i)}function cP(i,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(i,t||[]),s,n=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(P){r[P]&&(s[P]=function(L){return new Promise(function(D,j){n.push([P,L,D,j])>1||l(P,L)})})}function l(P,L){try{f(r[P](L))}catch(D){T(n[0][3],D)}}function f(P){P.value instanceof rf?Promise.resolve(P.value.v).then(y,A):T(n[0][2],P)}function y(P){l("next",P)}function A(P){l("throw",P)}function T(P,L){P(L),n.shift(),n.length&&l(n[0][0],n[0][1])}}var gA=function(i){lP(t,i);function t(e){var r=i.call(this,e)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return t}(Error);(function(){function i(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),i.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();(function(){function i(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();(function(){function i(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();function i1(i){i!=null&&typeof i.then=="function"&&i.then(cm,cm)}var O0=0,d2=1,Bu=2,am=3,r1=4,lm=1024,cm=function(){};function Td(i){var t=i.err,e=Promise.resolve(i.execution).then(function(r){if(t!=null)throw t;return r});return i.err=void 0,i.execution=e.then(function(){},function(){}),i.pending===void 0?e:i.pending.then(function(){return e})}function wu(i,t){var e=i.state>=am;return Promise.resolve(t).then(function(r){return!e&&i.state>=r1?Td(i).then(function(s){return{value:s,done:!0}}):{value:r,done:e}})}function p_(i,t){var e,r;if(!(i.state>=Bu))if(i.state=Bu,i.onnext(),i.onstop(),i.err==null&&(i.err=t),i.pushes.length===0&&(typeof i.buffer>"u"||i.buffer.empty))Jp(i);else try{for(var s=Zd(i.pushes),n=s.next();!n.done;n=s.next()){var c=n.value;c.resolve()}}catch(l){e={error:l}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}}function Jp(i){var t,e;if(!(i.state>=am)){i.state<Bu&&p_(i),i.state=am,i.buffer=void 0;try{for(var r=Zd(i.nexts),s=r.next();!s.done;s=r.next()){var n=s.value,c=i.pending===void 0?Td(i):i.pending.then(function(){return Td(i)});n.resolve(wu(i,c))}}catch(l){t={error:l}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}i.pushes=[],i.nexts=[]}}function p2(i){i.state>=r1||(i.state<am&&Jp(i),i.state=r1)}function hP(i,t){if(i1(t),i.pushes.length>=lm)throw new gA("No more than "+lm+" pending calls to push are allowed on a single repeater.");if(i.state>=Bu)return Promise.resolve(void 0);var e=i.pending===void 0?Promise.resolve(t):i.pending.then(function(){return t});e=e.catch(function(f){i.state<Bu&&(i.err=f),p2(i)});var r;if(i.nexts.length){var s=i.nexts.shift();s.resolve(wu(i,e)),i.nexts.length?r=Promise.resolve(i.nexts[0].value):r=new Promise(function(f){return i.onnext=f})}else typeof i.buffer<"u"&&!i.buffer.full?(i.buffer.add(e),r=Promise.resolve(void 0)):r=new Promise(function(f){return i.pushes.push({resolve:f,value:e})});var n=!0,c={},l=r.catch(function(f){if(n)throw f});return c.then=function(f,y){return n=!1,Promise.prototype.then.call(r,f,y)},c.catch=function(f){return n=!1,Promise.prototype.catch.call(r,f)},c.finally=r.finally.bind(r),i.pending=e.then(function(){return l}).catch(function(f){i.err=f,p2(i)}),c}function uP(i){var t=p_.bind(null,i),e=new Promise(function(r){return i.onstop=r});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function dP(i){if(!(i.state>=d2)){i.state=d2;var t=hP.bind(null,i),e=uP(i);i.execution=new Promise(function(r){return r(i.executor(t,e))}),i.execution.catch(function(){return p_(i)})}}var hg=new WeakMap,_f=function(){function i(t,e){hg.set(this,{executor:t,buffer:e,err:void 0,state:O0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:cm,onstop:cm})}return i.prototype.next=function(t){i1(t);var e=hg.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=lm)throw new gA("No more than "+lm+" pending calls to next are allowed on a single repeater.");if(e.state<=O0&&dP(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var r=wu(e,e.buffer.remove());if(e.pushes.length){var s=e.pushes.shift();e.buffer.add(s.value),e.onnext=s.resolve}return r}else if(e.pushes.length){var n=e.pushes.shift();return e.onnext=n.resolve,wu(e,n.value)}else if(e.state>=Bu)return Jp(e),wu(e,Td(e));return new Promise(function(c){return e.nexts.push({resolve:c,value:t})})},i.prototype.return=function(t){i1(t);var e=hg.get(this);if(e===void 0)throw new Error("WeakMap error");return Jp(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),wu(e,Td(e))},i.prototype.throw=function(t){var e=hg.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=O0||e.state>=Bu||typeof e.buffer<"u"&&!e.buffer.empty?(Jp(e),e.err==null&&(e.err=t),wu(e,Td(e))):this.next(Promise.reject(t))},i.prototype[Symbol.asyncIterator]=function(){return this},i.race=pP,i.merge=fP,i.zip=gP,i.latest=mP,i}();function Mm(i,t){var e,r,s=[],n=function(y){y!=null&&typeof y[Symbol.asyncIterator]=="function"?s.push(y[Symbol.asyncIterator]()):y!=null&&typeof y[Symbol.iterator]=="function"?s.push(y[Symbol.iterator]()):s.push(function(){return cP(this,arguments,function(){return Hh(this,function(A){switch(A.label){case 0:return t.yieldValues?[4,rf(y)]:[3,3];case 1:return[4,A.sent()];case 2:A.sent(),A.label=3;case 3:return t.returnValues?[4,rf(y)]:[3,5];case 4:return[2,A.sent()];case 5:return[2]}})})}())};try{for(var c=Zd(i),l=c.next();!l.done;l=c.next()){var f=l.value;n(f)}}catch(y){e={error:y}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}return s}function pP(i){var t=this,e=Mm(i,{returnValues:!0});return new _f(function(r,s){return Nd(t,void 0,void 0,function(){var n,c,l,f,y,A;return Hh(this,function(T){switch(T.label){case 0:if(!e.length)return s(),[2];c=!1,s.then(function(){n(),c=!0}),T.label=1;case 1:T.trys.push([1,,5,7]),f=void 0,y=0,A=function(){var P,L,D,j,X,Z;return Hh(this,function($){switch($.label){case 0:P=y;try{for(L=(X=void 0,Zd(e)),D=L.next();!D.done;D=L.next())j=D.value,Promise.resolve(j.next()).then(function(ht){ht.done?(s(),l===void 0&&(l=ht)):y===P&&(y++,n(ht))},function(ht){return s(ht)})}catch(ht){X={error:ht}}finally{try{D&&!D.done&&(Z=L.return)&&Z.call(L)}finally{if(X)throw X.error}}return[4,new Promise(function(ht){return n=ht})];case 1:return f=$.sent(),f===void 0?[3,3]:[4,r(f.value)];case 2:$.sent(),$.label=3;case 3:return[2]}})},T.label=2;case 2:return c?[3,4]:[5,A()];case 3:return T.sent(),[3,2];case 4:return[2,l&&l.value];case 5:return s(),[4,Promise.race(e.map(function(P){return P.return&&P.return()}))];case 6:return T.sent(),[7];case 7:return[2]}})})})}function fP(i){var t=this,e=Mm(i,{yieldValues:!0});return new _f(function(r,s){return Nd(t,void 0,void 0,function(){var n,c,l,f=this;return Hh(this,function(y){switch(y.label){case 0:if(!e.length)return s(),[2];n=[],c=!1,s.then(function(){var A,T;c=!0;try{for(var P=Zd(n),L=P.next();!L.done;L=P.next()){var D=L.value;D()}}catch(j){A={error:j}}finally{try{L&&!L.done&&(T=P.return)&&T.call(P)}finally{if(A)throw A.error}}}),y.label=1;case 1:return y.trys.push([1,,3,4]),[4,Promise.all(e.map(function(A,T){return Nd(f,void 0,void 0,function(){var P,L;return Hh(this,function(D){switch(D.label){case 0:D.trys.push([0,,6,9]),D.label=1;case 1:return c?[3,5]:(Promise.resolve(A.next()).then(function(j){return n[T](j)},function(j){return s(j)}),[4,new Promise(function(j){n[T]=j})]);case 2:return P=D.sent(),P===void 0?[3,4]:P.done?(l=P,[2]):[4,r(P.value)];case 3:D.sent(),D.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return L=A.return,L?[4,A.return()]:[3,8];case 7:L=D.sent(),D.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return y.sent(),[2,l&&l.value];case 3:return s(),[7];case 4:return[2]}})})})}function gP(i){var t=this,e=Mm(i,{returnValues:!0});return new _f(function(r,s){return Nd(t,void 0,void 0,function(){var n,c,l,f;return Hh(this,function(y){switch(y.label){case 0:if(!e.length)return s(),[2,[]];c=!1,s.then(function(){n(),c=!0}),y.label=1;case 1:y.trys.push([1,,6,8]),y.label=2;case 2:return c?[3,5]:(Promise.all(e.map(function(A){return A.next()})).then(function(A){return n(A)},function(A){return s(A)}),[4,new Promise(function(A){return n=A})]);case 3:return l=y.sent(),l===void 0?[2]:(f=l.map(function(A){return A.value}),l.some(function(A){return A.done})?[2,f]:[4,r(f)]);case 4:return y.sent(),[3,2];case 5:return[3,8];case 6:return s(),[4,Promise.all(e.map(function(A){return A.return&&A.return()}))];case 7:return y.sent(),[7];case 8:return[2]}})})})}function mP(i){var t=this,e=Mm(i,{yieldValues:!0,returnValues:!0});return new _f(function(r,s){return Nd(t,void 0,void 0,function(){var n,c,l,f,y,A=this;return Hh(this,function(T){switch(T.label){case 0:if(!e.length)return s(),[2,[]];c=[],l=!1,s.then(function(){var P,L;n();try{for(var D=Zd(c),j=D.next();!j.done;j=D.next()){var X=j.value;X()}}catch(Z){P={error:Z}}finally{try{j&&!j.done&&(L=D.return)&&L.call(D)}finally{if(P)throw P.error}}l=!0}),T.label=1;case 1:return T.trys.push([1,,5,7]),Promise.all(e.map(function(P){return P.next()})).then(function(P){return n(P)},function(P){return s(P)}),[4,new Promise(function(P){return n=P})];case 2:return f=T.sent(),f===void 0?[2]:(y=f.map(function(P){return P.value}),f.every(function(P){return P.done})?[2,y]:[4,r(y.slice())]);case 3:return T.sent(),[4,Promise.all(e.map(function(P,L){return Nd(A,void 0,void 0,function(){var D;return Hh(this,function(j){switch(j.label){case 0:if(f[L].done)return[2,f[L].value];j.label=1;case 1:return l?[3,4]:(Promise.resolve(P.next()).then(function(X){return c[L](X)},function(X){return s(X)}),[4,new Promise(function(X){return c[L]=X})]);case 2:return D=j.sent(),D===void 0?[2,f[L].value]:D.done?[2,D.value]:(y[L]=D.value,[4,r(y.slice())]);case 3:return j.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,T.sent()];case 5:return s(),[4,Promise.all(e.map(function(P){return P.return&&P.return()}))];case 6:return T.sent(),[7];case 7:return[2]}})})})}let hm=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(i){if(i<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=i}};hm.global=new hm;var gl;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warn=2]="Warn",i[i.Error=3]="Error"})(gl||(gl={}));class dn{static debug(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(gl.Debug,...e)}static info(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(gl.Info,...e)}static warn(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(gl.Warn,...e)}static error(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(gl.Error,...e)}static log(t){if(!(this.logLevel>t)){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];switch(t){case gl.Debug:{console.debug(...r);break}case gl.Info:{console.info(...r);break}case gl.Warn:{console.warn(...r);break}case gl.Error:{console.error(...r);break}}}}}dn.logLevel=gl.Warn;const xu=8*4+8,yP=16;function f_(i,t){t=Math.min(Math.max(+t,2),65535);let e=i,r=e;do e=Math.ceil(e/t),r+=e;while(e!==1);return r*xu}function _P(i,t){if(t<2)throw new Error("Node size must be at least 2");if(i===0)throw new Error("Number of items must be greater than 0");let e=i,r=e;const s=[e];do e=Math.ceil(e/t),r+=e,s.push(e);while(e!==1);const n=[];e=r;for(const l of s)n.push(e-l),e-=l;const c=[];for(let l=0;l<s.length;l++)c.push([n[l],n[l]+s[l]]);return c}async function*vP(i,t,e,r){class s{constructor(L,D){this._level=D,this.nodes=L}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(L){console.assert(L>this.nodes[1]),this.nodes[1]=L}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:n,minY:c,maxX:l,maxY:f}=e;dn.info(`tree items: ${i}, nodeSize: ${t}`);const y=_P(i,t),A=y[0][0],T=[(()=>{const P=[0,1],L=y.length-1;return new s(P,L)})()];for(dn.debug(`starting stream search with queue: ${T}, numItems: ${i}, nodeSize: ${t}, levelBounds: ${y}`);T.length!=0;){const P=T.shift();dn.debug(`popped node: ${P}, queueLength: ${T.length}`);const L=P.startNodeIdx(),D=L>=A,j=(()=>{const[,ht]=y[P.level()],_t=Math.min(P.endNodeIdx()+t,ht);return D&&_t<ht?_t+1:_t})(),X=j-L,Z=await r(L*xu,X*xu),$=new DataView(Z);for(let ht=L;ht<j;ht++){const _t=ht-L,Mt=_t*xu;if(l<$.getFloat64(Mt+0,!0)||f<$.getFloat64(Mt+8,!0)||n>$.getFloat64(Mt+16,!0)||c>$.getFloat64(Mt+24,!0))continue;const Nt=$.getBigUint64(Mt+32,!0);if(D){const ct=Nt,pt=(()=>{if(ht<i-1){const bt=(_t+1)*xu;return $.getBigUint64(bt+32,!0)-ct}else return null})(),Bt=ht-A;yield[Number(ct),Bt,Number(pt)];continue}const Rt=Nt,xt=hm.global.extraRequestThreshold()/xu,qt=T[T.length-1];if(qt!==void 0&&qt.level()==P.level()-1&&Rt<qt.endNodeIdx()+xt){dn.debug(`Merging "nodeRange" request into existing range: ${qt}, newEndNodeIdx: ${qt.endNodeIdx()} -> ${Rt}`),qt.extendEndNodeIdx(Number(Rt));continue}const zt=(()=>{const ct=P.level()-1,pt=[Number(Rt),Number(Rt)+1];return new s(pt,ct)})();qt!==void 0&&qt.level()==zt.level()?dn.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Rt} rather than merging with distant ${qt}`):dn.info(`Pushing new level for ${zt} onto queue with nearestNodeRange: ${qt} since there's not already a range for this level.`),T.push(zt)}}}const Uh=new Uint8Array([102,103,98,3,102,103,98,0]),Uc=4;class g_{constructor(t,e,r,s,n){this.headerClient=t,this.header=e,this.headerLength=r,this.indexLength=s,this.nocache=n}static async open(t,e){const r=new f2(t,e),s=(()=>{const T=yP,P=3;let L=0,D;for(D=0;D<P;D++){const j=T**D*xu;L+=j}return L})(),n=2024+s;dn.debug(`fetching header. minReqLength: ${n} (assumedHeaderLength: 2024, assumedIndexLength: ${s})`);{const T=new Uint8Array(await r.getRange(0,8,n,"header"));if(!T.subarray(0,3).every((P,L)=>Uh[L]===P))throw dn.error(`bytes: ${T} != ${Uh}`),new Error("Not a FlatGeobuf file");dn.debug("magic bytes look good")}let c;{const T=await r.getRange(8,4,n,"header");c=new DataView(T).getUint32(0,!0);const P=1048576*10;if(c>P||c<8)throw new Error("Invalid header size");dn.debug(`headerLength: ${c}`)}const l=await r.getRange(12,c,n,"header"),f=new Wc(new Uint8Array(l)),y=d_(f),A=f_(y.featuresCount,y.indexNodeSize);return dn.debug("completed: opening http reader"),new g_(r,y,c,A,e)}async*selectBbox(t){const e=this.lengthBeforeTree(),r=this.headerClient,s=async function(f,y){return r.getRange(e+f,y,0,"index")},n=[];let c=[];for await(const f of vP(this.header.featuresCount,this.header.indexNodeSize,t,s)){const[y,,]=f;let[,,A]=f;if(A||(dn.info("final feature"),A=4),c.length==0){c.push([y,A]);continue}const T=c[c.length-1],P=y-(T[0]+T[1]);P>hm.global.extraRequestThreshold()&&(dn.info(`Pushing new feature batch, since gap ${P} was too large`),n.push(c),c=[]),c.push([y,A])}this.headerClient.logUsage("header+index"),c.length>0&&n.push(c);const l=n.flatMap(f=>this.readFeatureBatch(f,this.nocache));yield*_f.merge(l)}lengthBeforeTree(){return Uh.length+Uc+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new f2(this.headerClient.httpClient,t)}async*readFeatureBatch(t,e){const[r]=t[0],[s,n]=t[t.length-1],c=r,l=s+n-c,f=this.buildFeatureClient(e);let y=l;for(const[A]of t)yield await this.readFeature(f,A,y),y=0;f.logUsage("feature")}async readFeature(t,e,r){const s=e+this.lengthBeforeFeatures();let n;{const A=await t.getRange(s,4,r,"feature length");n=new DataView(A).getUint32(0,!0)}const c=await t.getRange(s+4,n,r,"feature data"),l=new Uint8Array(c),f=new Uint8Array(n+Uc);f.set(l,Uc);const y=new Wc(f);return y.setPosition(Uc),ml.getRootAsFeature(y)}}class f2{constructor(t,e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new g2(t,e);else if(t instanceof g2)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,e,r,s){this.bytesEverUsed+=e;const n=t-this.head,c=n+e;if(n>=0&&c<=this.buffer.byteLength)return this.buffer.slice(n,c);const l=Math.max(e,r);return this.bytesEverFetched+=l,dn.debug(`requesting for new Range: ${t}-${t+l-1}`),this.buffer=await this.httpClient.getRange(t,l,s),this.head=t,this.buffer.slice(0,e)}logUsage(t){const e=t.split(" ")[0],r=this.bytesEverUsed,s=this.bytesEverFetched,n=(100*r/s).toFixed(2);dn.info(`${e} bytes used/requested: ${r} / ${s} = ${n}%`)}}class g2{constructor(t,e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=e}async getRange(t,e,r){this.requestsEverMade+=1,this.bytesEverRequested+=e;const s=`bytes=${t}-${t+e-1}`;dn.info(`request: #${this.requestsEverMade}, purpose: ${r}), bytes: (this_request: ${e}, ever: ${this.bytesEverRequested}), Range: ${s}`);const n={Range:s};return this.nocache&&(n["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:n})).arrayBuffer()}}function bP(i,t,e){if(!i.subarray(0,3).every((A,T)=>Uh[T]===A))throw new Error("Not a FlatGeobuf file");const r=new Wc(i),s=r.readUint32(Uh.length);r.setPosition(Uh.length+Uc);const n=d_(r);let c=Uh.length+Uc+s;const{indexNodeSize:l,featuresCount:f}=n;l>0&&(c+=f_(f,l));const y=[];for(;c<r.capacity();){const A=r.readUint32(c);r.setPosition(c+Uc);const T=ml.getRootAsFeature(r);y.push(t(T,n)),c+=Uc+A}return y}async function*wP(i,t,e){const r=aP(i),s=async P=>await r.slice(P);let n=new Uint8Array(await s(8));if(!n.subarray(0,3).every((P,L)=>Uh[L]===P))throw new Error("Not a FlatGeobuf file");n=new Uint8Array(await s(4));let c=new Wc(n);const l=c.readUint32(0);n=new Uint8Array(await s(l)),c=new Wc(n);const f=d_(c),{indexNodeSize:y,featuresCount:A}=f;if(y>0){const P=f_(A,y);await s(P)}let T;for(;T=await AP(s,f,t);)yield T}function xP(i,t,e,r){try{let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const n=await g_.open(i,s);dn.debug("opened reader");for await(const c of n.selectBbox(t))yield e(c,n.header)}()}catch(s){return Promise.reject(s)}}async function AP(i,t,e){let r=new Uint8Array(await i(4,"feature length"));if(r.byteLength===0)return;let s=new Wc(r);const n=s.readUint32(0);r=new Uint8Array(await i(n,"feature data"));const c=new Uint8Array(n+4);c.set(r,4),s=new Wc(c),s.setPosition(Uc);const l=ml.getRootAsFeature(s);return e(l,t)}function SP(i,t){return{type:"FeatureCollection",features:bP(i,h_)}}function EP(i,t){return wP(i,h_)}function CP(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return xP(i,t,h_,e,r)}function m2(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return i instanceof Uint8Array?SP(i):i instanceof ReadableStream?EP(i):CP(i,t,e,r)}class TP{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let e=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(e._btn.className.indexOf("3d")!=-1){let y={pitch:e._pitch,bearing:e._bearing};e._minpitchzoom&&t.getZoom()>e._minpitchzoom&&(y.zoom=e._minpitchzoom);var r=0,s=38.5,n=6,c=62.33,{longitude:l,latitude:f}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainMapZen",exaggeration:1.5}):l>=r&&l<=n&&f>=s&&f<=c?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainMapZen",exaggeration:1.5}),t.easeTo(y),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function sf(i){"@babel/helpers - typeof";return sf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sf(i)}function PP(i,t){if(sf(i)!="object"||!i)return i;var e=i[Symbol.toPrimitive];if(e!==void 0){var r=e.call(i,t||"default");if(sf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(i)}function IP(i){var t=PP(i,"string");return sf(t)=="symbol"?t:t+""}function H(i,t,e){return t=IP(t),t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function Kr(i,t){if(!i)throw new Error(t||"loader assertion failed.")}const Bm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),y2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);y2&&parseFloat(y2[1]);const LP="3.4.15";function dc(i,t){if(!i)throw new Error(t||"loaders.gl assertion failed.")}const F0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},MP=F0.global||F0.self||F0.window||{},qc=typeof process!="object"||String(process)!=="[object process]"||process.browser,m_=typeof importScripts=="function",BP=typeof window<"u"&&typeof window.orientation<"u",_2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_2&&parseFloat(_2[1]);class RP{constructor(t,e){H(this,"name",void 0),H(this,"workerThread",void 0),H(this,"isRunning",!0),H(this,"result",void 0),H(this,"_resolve",()=>{}),H(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){dc(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){dc(this.isRunning),this.isRunning=!1,this._reject(t)}}let N0=class{terminate(){}};const D0=new Map;function kP(i){dc(i.source&&!i.url||!i.source&&i.url);let t=D0.get(i.source||i.url);return t||(i.url&&(t=OP(i.url),D0.set(i.url,t)),i.source&&(t=mA(i.source),D0.set(i.source,t))),dc(t),t}function OP(i){if(!i.startsWith("http"))return i;const t=FP(i);return mA(t)}function mA(i){const t=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(t)}function FP(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function yA(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const r=e||new Set;if(i){if(v2(i))r.add(i);else if(v2(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)&&t&&typeof i=="object")for(const s in i)yA(i[s],t,r)}return e===void 0?Array.from(r):[]}function v2(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const z0=()=>{};class s1{static isSupported(){return typeof Worker<"u"&&qc||typeof N0<"u"&&!qc}constructor(t){H(this,"name",void 0),H(this,"source",void 0),H(this,"url",void 0),H(this,"terminated",!1),H(this,"worker",void 0),H(this,"onMessage",void 0),H(this,"onError",void 0),H(this,"_loadableURL","");const{name:e,source:r,url:s}=t;dc(r||s),this.name=e,this.source=r,this.url=s,this.onMessage=z0,this.onError=n=>console.log(n),this.worker=qc?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=z0,this.onError=z0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||yA(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=kP({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new N0(e,{eval:!1})}else if(this.source)t=new N0(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class NP{static isSupported(){return s1.isSupported()}constructor(t){H(this,"name","unnamed"),H(this,"source",void 0),H(this,"url",void 0),H(this,"maxConcurrency",1),H(this,"maxMobileConcurrency",1),H(this,"onDebug",()=>{}),H(this,"reuseWorkers",!0),H(this,"props",{}),H(this,"jobQueue",[]),H(this,"idleQueue",[]),H(this,"count",0),H(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(n,c,l)=>n.done(l),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(n,c)=>n.error(c);const s=new Promise(n=>(this.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const r=new RP(e.name,t);t.onMessage=s=>e.onMessage(r,s.type,s.payload),t.onError=s=>e.onError(r,s),e.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new s1({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return BP?this.maxMobileConcurrency:this.maxConcurrency}}const DP={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Dc{static isSupported(){return s1.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Dc._workerFarm=Dc._workerFarm||new Dc({}),Dc._workerFarm.setProps(t),Dc._workerFarm}constructor(t){H(this,"props",void 0),H(this,"workerPools",new Map),this.props={...DP},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:r,url:s}=t;let n=this.workerPools.get(e);return n||(n=new NP({name:e,source:r,url:s}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}H(Dc,"_workerFarm",void 0);const zP="latest";function UP(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[i.id]||{},r="".concat(i.id,"-worker.js");let s=e.workerUrl;if(!s&&i.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(s="modules/".concat(i.module,"/dist/").concat(r)),!s){let n=i.version;n==="latest"&&(n=zP);const c=n?"@".concat(n):"";s="https://unpkg.com/@loaders.gl/".concat(i.module).concat(c,"/dist/").concat(r)}return dc(s),s}function jP(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:LP;dc(i,"no worker provided");const e=i.version;return!(!t||!e)}const GP=null,VP=null,n1=null,_A=null,qP=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:GP,readFileAsText:VP,requireFromFile:n1,requireFromString:_A},Symbol.toStringTag,{value:"Module"})),HP="3.4.15",U0={};async function Pu(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(i=WP(i,t,e)),U0[i]=U0[i]||JP(i),await U0[i]}function WP(i,t,e){if(i.startsWith("http"))return i;const r=e.modules||{};return r[i]?r[i]:qc?e.CDN?(dc(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(t,"@").concat(HP,"/dist/libs/").concat(i)):m_?"../src/libs/".concat(i):"modules/".concat(t,"/src/libs/").concat(i):"modules/".concat(t,"/dist/libs/").concat(i)}async function JP(i){if(i.endsWith("wasm"))return await(await fetch(i)).arrayBuffer();if(!qc)try{return qP&&n1&&await n1(i)}catch{return null}if(m_)return importScripts(i);const t=await(await fetch(i)).text();return XP(t,i)}function XP(i,t){if(!qc)return _A;if(m_)return eval.call(MP,i),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(i))}catch{e.text=i}return document.body.appendChild(e),null}function ZP(i,t){return!Dc.isSupported()||!qc&&!(t!=null&&t._nodeWorkers)?!1:i.worker&&(t==null?void 0:t.worker)}async function $P(i,t,e,r,s){const n=i.id,c=UP(i,e),l=Dc.getWorkerFarm(e).getWorkerPool({name:n,url:c});e=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(r||{}));const f=await l.startJob("process-on-worker",YP.bind(null,s));return f.postMessage("process",{input:t,options:e,context:r}),await(await f.result).result}async function YP(i,t,e,r){switch(e){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:s,input:n,options:c}=r;try{const l=await i(n,c);t.postMessage("done",{id:s,result:l})}catch(l){const f=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:s,error:f})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function KP(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?b2(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?b2(i,0,t):""}function b2(i,t,e){if(i.byteLength<=t+e)return"";const r=new DataView(i);let s="";for(let n=0;n<e;n++)s+=String.fromCharCode(r.getUint8(t+n));return s}function QP(i){try{return JSON.parse(i)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(KP(i),'"'))}}function tI(i,t,e){if(e=e||i.byteLength,i.byteLength<e||t.byteLength<e)return!1;const r=new Uint8Array(i),s=new Uint8Array(t);for(let n=0;n<r.length;++n)if(r[n]!==s[n])return!1;return!0}function eI(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];const r=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),s=r.reduce((l,f)=>l+f.byteLength,0),n=new Uint8Array(s);let c=0;for(const l of r)n.set(l,c),c+=l.byteLength;return n.buffer}function y_(i,t,e){const r=e!==void 0?new Uint8Array(i).subarray(t,t+e):new Uint8Array(i).subarray(t);return new Uint8Array(r).buffer}function vf(i,t){return Kr(i>=0),Kr(t>0),i+(t-1)&~(t-1)}function iI(i,t,e){let r;if(i instanceof ArrayBuffer)r=new Uint8Array(i);else{const s=i.byteOffset,n=i.byteLength;r=new Uint8Array(i.buffer||i.arrayBuffer,s,n)}return t.set(r,e),e+vf(r.byteLength,4)}async function rI(i){const t=[];for await(const e of i)t.push(e);return eI(...t)}function w2(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}class x2{constructor(t,e){H(this,"name",void 0),H(this,"type",void 0),H(this,"sampleSize",1),H(this,"time",void 0),H(this,"count",void 0),H(this,"samples",void 0),H(this,"lastTiming",void 0),H(this,"lastSampleTime",void 0),H(this,"lastSampleCount",void 0),H(this,"_count",0),H(this,"_time",0),H(this,"_samples",0),H(this,"_startTime",0),H(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=w2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(w2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class bf{constructor(t){H(this,"id",void 0),H(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:r}=t;return this.stats[e]||(t instanceof x2?this.stats[e]=t:this.stats[e]=new x2(e,r)),this.stats[e]}}const sI="Queued Requests",nI="Active Requests",oI="Cancelled Requests",aI="Queued Requests Ever",lI="Active Requests Ever",cI={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class hI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"props",void 0),H(this,"stats",void 0),H(this,"activeRequestCount",0),H(this,"requestQueue",[]),H(this,"requestMap",new Map),H(this,"deferredUpdate",null),this.props={...cI,...t},this.stats=new bf({id:this.props.id}),this.stats.get(sI),this.stats.get(nI),this.stats.get(oI),this.stats.get(aI),this.stats.get(lI)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const r={handle:t,priority:0,getPriority:e},s=new Promise(n=>(r.resolve=n,r));return this.requestQueue.push(r),this.requestMap.set(t,s),this._issueNewRequests(),s}_issueRequest(t){const{handle:e,resolve:r}=t;let s=!1;const n=()=>{s||(s=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:n}):Promise.resolve({done:n})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const r=t[e];this._updateRequest(r)||(t.splice(e,1),this.requestMap.delete(r.handle),e--)}t.sort((e,r)=>e.priority-r.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let uI="";const A2={};function dI(i){for(const t in A2)if(i.startsWith(t)){const e=A2[t];i=i.replace(t,e)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(uI).concat(i)),i}function pI(i){return i&&typeof i=="object"&&i.isBuffer}function vA(i){if(pI(i)||i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const t=i;return new TextEncoder().encode(t).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function bA(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(t+1):""}function __(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(0,t):""}const fI=i=>typeof i=="boolean",Xp=i=>typeof i=="function",wf=i=>i!==null&&typeof i=="object",S2=i=>wf(i)&&i.constructor==={}.constructor,gI=i=>i&&typeof i[Symbol.iterator]=="function",mI=i=>i&&typeof i[Symbol.asyncIterator]=="function",Fu=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Nu=i=>typeof Blob<"u"&&i instanceof Blob,yI=i=>i&&typeof i=="object"&&i.isBuffer,_I=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||wf(i)&&Xp(i.tee)&&Xp(i.cancel)&&Xp(i.getReader),vI=i=>wf(i)&&Xp(i.read)&&Xp(i.pipe)&&fI(i.readable),wA=i=>_I(i)||vI(i),bI=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,wI=/^([-\w.]+\/[-\w.+]+)/;function xI(i){const t=wI.exec(i);return t?t[1]:i}function E2(i){const t=bI.exec(i);return t?t[1]:""}const xA=/\?.*/;function AI(i){const t=i.match(xA);return t&&t[0]}function v_(i){return i.replace(xA,"")}function Rm(i){return Fu(i)?i.url:Nu(i)?i.name||"":typeof i=="string"?i:""}function b_(i){if(Fu(i)){const t=i,e=t.headers.get("content-type")||"",r=v_(t.url);return xI(e)||E2(r)}return Nu(i)?i.type||"":typeof i=="string"?E2(i):""}function SI(i){return Fu(i)?i.headers["content-length"]||-1:Nu(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function AA(i){if(Fu(i))return i;const t={},e=SI(i);e>=0&&(t["content-length"]=String(e));const r=Rm(i),s=b_(i);s&&(t["content-type"]=s);const n=await TI(i);n&&(t["x-first-bytes"]=n),typeof i=="string"&&(i=new TextEncoder().encode(i));const c=new Response(i,{headers:t});return Object.defineProperty(c,"url",{value:r}),c}async function EI(i){if(!i.ok){const t=await CI(i);throw new Error(t)}}async function CI(i){let t="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const e=i.headers.get("Content-Type");let r=i.statusText;e.includes("application/json")&&(r+=" ".concat(await i.text())),t+=r,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function TI(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(e=>{const r=new FileReader;r.onload=s=>{var n;return e(s==null||(n=s.target)===null||n===void 0?void 0:n.result)},r.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),e=PI(t);return"data:base64,".concat(e)}return null}function PI(i){let t="";const e=new Uint8Array(i);for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t)}async function C2(i,t){if(typeof i=="string"){i=dI(i);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(i,e)}return await AA(i)}function SA(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function $c(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||SA()}const Gg={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},j0=Gg.window||Gg.self||Gg.global,ug=Gg.process||{},EA=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";$c();const G0=globalThis;function CA(i){if(!$c())return"Node";if(SA())return"Electron";const t=(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const e=t.indexOf("MSIE ")!==-1,r=t.indexOf("Trident/")!==-1;return e||r?"IE":G0.chrome?"Chrome":G0.safari?"Safari":G0.mozInnerScreenX?"Firefox":"Unknown"}function II(i){try{const t=window[i],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class LI{constructor(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";H(this,"storage",void 0),H(this,"id",void 0),H(this,"config",void 0),this.storage=II(r),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function MI(i){let t;return i<10?t="".concat(i.toFixed(2),"ms"):i<100?t="".concat(i.toFixed(1),"ms"):i<1e3?t="".concat(i.toFixed(0),"ms"):t="".concat((i/1e3).toFixed(2),"s"),t}function BI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-i.length,0);return"".concat(" ".repeat(e)).concat(i)}function V0(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(e=Math.min(e,r/i.width));const n=i.width*e,c=i.height*e,l=["font-size:1px;","padding:".concat(Math.floor(c/2),"px ").concat(Math.floor(n/2),"px;"),"line-height:".concat(c,"px;"),"background:url(".concat(s,");"),"background-size:".concat(n,"px ").concat(c,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),l]}let um;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(um||(um={}));function T2(i){return typeof i=="string"?um[i.toUpperCase()]||um.WHITE:i}function RI(i,t,e){return!$c&&typeof i=="string"&&(t&&(t=T2(t),i="\x1B[".concat(t,"m").concat(i,"\x1B[39m")),e&&(t=T2(e),i="\x1B[".concat(e+10,"m").concat(i,"\x1B[49m"))),i}function kI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(e);for(const s of r)typeof i[s]=="function"&&(t.find(n=>s===n)||(i[s]=i[s].bind(i)))}function dm(i,t){if(!i)throw new Error(t||"Assertion failed")}function nd(){let i;if($c&&"performance"in j0){var t,e;i=j0==null||(t=j0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in ug){var r;const s=ug==null||(r=ug.hrtime)===null||r===void 0?void 0:r.call(ug);i=s[0]*1e3+s[1]/1e6}else i=Date.now();return i}const od={debug:$c&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},OI={enabled:!0,level:0};function Ha(){}const P2={},I2={once:!0};class xf{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};H(this,"id",void 0),H(this,"VERSION",EA),H(this,"_startTs",nd()),H(this,"_deltaTs",nd()),H(this,"_storage",void 0),H(this,"userData",{}),H(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new LI("__probe-".concat(this.id,"__"),OI),this.timeStamp("".concat(this.id," started")),kI(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((nd()-this._startTs).toPrecision(10))}getDelta(){return Number((nd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){dm(t,e)}warn(t){return this._getLogFunction(0,t,od.warn,arguments,I2)}error(t){return this._getLogFunction(0,t,od.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,od.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,od.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var r=arguments.length,s=new Array(r>2?r-2:0),n=2;n<r;n++)s[n-2]=arguments[n];return this._getLogFunction(t,e,od.debug||od.info,arguments,I2)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||Ha,r&&[r],{tag:zI(e)}):Ha}image(t){let{logLevel:e,priority:r,image:s,message:n="",scale:c=1}=t;return this._shouldLog(e||r)?$c?DI({image:s,message:n,scale:c}):NI():Ha}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Ha)}group(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=L2({logLevel:t,message:e,opts:r}),{collapsed:n}=r;return s.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Ha)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=TA(t)}_getLogFunction(t,e,r,s,n){if(this._shouldLog(t)){n=L2({logLevel:t,message:e,args:s,opts:n}),r=r||n.method,dm(r),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=nd();const c=n.tag||n.message;if(n.once)if(!P2[c])P2[c]=nd();else return Ha;return e=FI(this.id,n.message,n),r.bind(console,e,...n.args)}return Ha}}H(xf,"VERSION",EA);function TA(i){if(!i)return 0;let t;switch(typeof i){case"number":t=i;break;case"object":t=i.logLevel||i.priority||0;break;default:return 0}return dm(Number.isFinite(t)&&t>=0),t}function L2(i){const{logLevel:t,message:e}=i;i.logLevel=TA(t);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&r.unshift(e),i.message=t;break;case"object":Object.assign(i,t);break}typeof i.message=="function"&&(i.message=i.message());const s=typeof i.message;return dm(s==="string"||s==="object"),Object.assign(i,{args:r},i.opts)}function FI(i,t,e){if(typeof t=="string"){const r=e.time?BI(MI(e.total)):"";t=e.time?"".concat(i,": ").concat(r,"  ").concat(t):"".concat(i,": ").concat(t),t=RI(t,e.color,e.background)}return t}function NI(i){return console.warn("removed"),Ha}function DI(i){let{image:t,message:e="",scale:r=1}=i;if(typeof t=="string"){const n=new Image;return n.onload=()=>{const c=V0(n,e,r);console.log(...c)},n.src=t,Ha}const s=t.nodeName||"";if(s.toLowerCase()==="img")return console.log(...V0(t,e,r)),Ha;if(s.toLowerCase()==="canvas"){const n=new Image;return n.onload=()=>console.log(...V0(n,e,r)),n.src=t.toDataURL(),Ha}return Ha}function zI(i){for(const t in i)for(const e in i[t])return e||"untitled";return"empty"}const M2=new xf({id:"loaders.gl"});class UI{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class jI{constructor(){H(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.error.bind(this.console,...e)}}const PA={fetch:null,mimeType:void 0,nothrow:!1,log:new jI,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Bm,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},GI={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function IA(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const LA=()=>{const i=IA();return i.globalOptions=i.globalOptions||{...PA},i.globalOptions};function VI(i,t,e,r){return e=e||[],e=Array.isArray(e)?e:[e],qI(i,e),WI(t,i,r)}function qI(i,t){B2(i,null,PA,GI,t);for(const e of t){const r=i&&i[e.id]||{},s=e.options&&e.options[e.id]||{},n=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};B2(r,e.id,s,n,t)}}function B2(i,t,e,r,s){const n=t||"Top level",c=t?"".concat(t,"."):"";for(const l in i){const f=!t&&wf(i[l]),y=l==="baseUri"&&!t,A=l==="workerUrl"&&t;if(!(l in e)&&!y&&!A){if(l in r)M2.warn("".concat(n," loader option '").concat(c).concat(l,"' no longer supported, use '").concat(r[l],"'"))();else if(!f){const T=HI(l,s);M2.warn("".concat(n," loader option '").concat(c).concat(l,"' not recognized. ").concat(T))()}}}}function HI(i,t){const e=i.toLowerCase();let r="";for(const s of t)for(const n in s.options){if(i===n)return"Did you mean '".concat(s.id,".").concat(n,"'?");const c=n.toLowerCase();(e.startsWith(c)||c.startsWith(e))&&(r=r||"Did you mean '".concat(s.id,".").concat(n,"'?"))}return r}function WI(i,t,e){const r={...i.options||{}};return JI(r,e),r.log===null&&(r.log=new UI),R2(r,LA()),R2(r,t),r}function R2(i,t){for(const e in t)if(e in t){const r=t[e];S2(r)&&S2(i[e])?i[e]={...i[e],...t[e]}:i[e]=t[e]}}function JI(i,t){t&&!("baseUri"in i)&&(i.baseUri=t)}function w_(i){var t;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((t=i)===null||t===void 0?void 0:t.extensions)):!1}function x_(i){var t,e;Kr(i,"null loader"),Kr(w_(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((t=i)!==null&&t!==void 0&&t.parseTextSync||(e=i)!==null&&e!==void 0&&e.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const MA=()=>{const i=IA();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function XI(i){const t=MA();i=Array.isArray(i)?i:[i];for(const e of i){const r=x_(e);t.find(s=>r===s)||t.unshift(r)}}function ZI(){return MA()}const $I=new xf({id:"loaders.gl"}),YI=/\.([^.]+)$/;async function KI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!BA(i))return null;let s=k2(i,t,{...e,nothrow:!0},r);if(s)return s;if(Nu(i)&&(i=await i.slice(0,10).arrayBuffer(),s=k2(i,t,e,r)),!s&&!(e!=null&&e.nothrow))throw new Error(RA(i));return s}function k2(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!BA(i))return null;if(t&&!Array.isArray(t))return x_(t);let s=[];t&&(s=s.concat(t)),e!=null&&e.ignoreRegisteredLoaders||s.push(...ZI()),tL(s);const n=QI(i,s,e,r);if(!n&&!(e!=null&&e.nothrow))throw new Error(RA(i));return n}function QI(i,t,e,r){const s=Rm(i),n=b_(i),c=v_(s)||(r==null?void 0:r.url);let l=null,f="";if(e!=null&&e.mimeType&&(l=q0(t,e==null?void 0:e.mimeType),f="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),l=l||eL(t,c),f=f||(l?"matched url ".concat(c):""),l=l||q0(t,n),f=f||(l?"matched MIME type ".concat(n):""),l=l||rL(t,i),f=f||(l?"matched initial data ".concat(kA(i)):""),l=l||q0(t,e==null?void 0:e.fallbackMimeType),f=f||(l?"matched fallback MIME type ".concat(n):""),f){var y;$I.log(1,"selectLoader selected ".concat((y=l)===null||y===void 0?void 0:y.name,": ").concat(f,"."))}return l}function BA(i){return!(i instanceof Response&&i.status===204)}function RA(i){const t=Rm(i),e=b_(i);let r="No valid loader found (";r+=t?"".concat(bA(t),", "):"no url provided, ",r+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const s=i?kA(i):"";return r+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",r+=")",r}function tL(i){for(const t of i)x_(t)}function eL(i,t){const e=t&&YI.exec(t),r=e&&e[1];return r?iL(i,r):null}function iL(i,t){t=t.toLowerCase();for(const e of i)for(const r of e.extensions)if(r.toLowerCase()===t)return e;return null}function q0(i,t){for(const e of i)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function rL(i,t){if(!t)return null;for(const e of i)if(typeof t=="string"){if(sL(t,e))return e}else if(ArrayBuffer.isView(t)){if(O2(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&O2(t,0,e))return e;return null}function sL(i,t){return t.testText?t.testText(i):(Array.isArray(t.tests)?t.tests:[t.tests]).some(e=>i.startsWith(e))}function O2(i,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>nL(i,t,e,r))}function nL(i,t,e,r){if(r instanceof ArrayBuffer)return tI(r,i,r.byteLength);switch(typeof r){case"function":return r(i,e);case"string":const s=o1(i,t,r.length);return r===s;default:return!1}}function kA(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?o1(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?o1(i,0,t):""}function o1(i,t,e){if(i.byteLength<t+e)return"";const r=new DataView(i);let s="";for(let n=0;n<e;n++)s+=String.fromCharCode(r.getUint8(t+n));return s}const oL=256*1024;function*aL(i,t){const e=(t==null?void 0:t.chunkSize)||oL;let r=0;const s=new TextEncoder;for(;r<i.length;){const n=Math.min(i.length-r,e),c=i.slice(r,r+n);r+=n,yield s.encode(c)}}const lL=256*1024;function cL(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=lL}=t;let r=0;for(;r<i.byteLength;){const s=Math.min(i.byteLength-r,e),n=new ArrayBuffer(s),c=new Uint8Array(i,r,s);new Uint8Array(n).set(c),r+=s,yield n}}()}const hL=1024*1024;async function*uL(i,t){const e=(t==null?void 0:t.chunkSize)||hL;let r=0;for(;r<i.size;){const s=r+e,n=await i.slice(r,s).arrayBuffer();r=s,yield n}}function F2(i,t){return Bm?dL(i,t):pL(i)}async function*dL(i,t){const e=i.getReader();let r;try{for(;;){const s=r||e.read();t!=null&&t._streamReadAhead&&(r=e.read());const{done:n,value:c}=await s;if(n)return;yield vA(c)}}catch{e.releaseLock()}}async function*pL(i,t){for await(const e of i)yield vA(e)}function fL(i,t){if(typeof i=="string")return aL(i,t);if(i instanceof ArrayBuffer)return cL(i,t);if(Nu(i))return uL(i,t);if(wA(i))return F2(i,t);if(Fu(i))return F2(i.body,t);throw new Error("makeIterator")}const OA="Cannot convert supplied data type";function gL(i,t,e){if(t.text&&typeof i=="string")return i;if(yI(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const s=i.byteLength||i.length;return(i.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+s)),r}throw new Error(OA)}async function mL(i,t,e){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return gL(i,t);if(Nu(i)&&(i=await AA(i)),Fu(i)){const s=i;return await EI(s),t.binary?await s.arrayBuffer():await s.text()}if(wA(i)&&(i=fL(i,e)),gI(i)||mI(i))return rI(i);throw new Error(OA)}function FA(i,t){const e=LA(),r=i||e;return typeof r.fetch=="function"?r.fetch:wf(r.fetch)?s=>C2(s,r):t!=null&&t.fetch?t==null?void 0:t.fetch:C2}function yL(i,t,e){if(e)return e;const r={fetch:FA(t,i),...i};if(r.url){const s=v_(r.url);r.baseUrl=s,r.queryString=AI(r.url),r.filename=bA(s),r.baseUrl=__(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function _L(i,t){if(!t&&i&&!Array.isArray(i))return i;let e;if(i&&(e=Array.isArray(i)?i:[i]),t&&t.loaders){const r=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...r]:r}return e&&e.length?e:null}async function A_(i,t,e,r){dc(!r||typeof r=="object"),t&&!Array.isArray(t)&&!w_(t)&&(r=void 0,e=t,t=void 0),i=await i,e=e||{};const s=Rm(i),n=_L(t,r),c=await KI(i,n,e);return c?(e=VI(e,c,n,s),r=yL({url:s,parse:A_,loaders:n},e,r||null),await vL(c,i,e,r)):null}async function vL(i,t,e,r){if(jP(i),Fu(t)){const s=t,{ok:n,redirected:c,status:l,statusText:f,type:y,url:A}=s,T=Object.fromEntries(s.headers.entries());r.response={headers:T,ok:n,redirected:c,status:l,statusText:f,type:y,url:A}}if(t=await mL(t,i,e),i.parseTextSync&&typeof t=="string")return e.dataType="text",i.parseTextSync(t,e,r,i);if(ZP(i,e))return await $P(i,t,e,r,A_);if(i.parseText&&typeof t=="string")return await i.parseText(t,e,r,i);if(i.parse)return await i.parse(t,e,r,i);throw dc(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function Wh(i,t,e,r){!Array.isArray(t)&&!w_(t)&&(e=t,t=void 0);const s=FA(e);let n=i;return typeof i=="string"&&(n=await s(i)),Nu(i)&&(n=await s(i)),await A_(n,t,e)}const bL="3.4.15",{_parseImageNode:wL}=globalThis,a1=typeof Image<"u",l1=typeof ImageBitmap<"u",xL=!!wL,c1=Bm?!0:xL;function AL(i){switch(i){case"auto":return l1||a1||c1;case"imagebitmap":return l1;case"image":return a1;case"data":return c1;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function SL(){if(l1)return"imagebitmap";if(a1)return"image";if(c1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function EL(i){const t=TL(i);if(!t)throw new Error("Not an image");return t}function CL(i){switch(EL(i)){case"data":return i;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=i.width,t.height=i.height,e.drawImage(i,0,0),e.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function TL(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const PL=/^data:image\/svg\+xml/,IL=/\.svg((\?|#).*)?$/;function S_(i){return i&&(PL.test(i)||IL.test(i))}function LL(i,t){if(S_(t)){let e=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(e=unescape(encodeURIComponent(e)))}catch(r){throw new Error(r.message)}return"data:image/svg+xml;base64,".concat(btoa(e))}return NA(i,t)}function NA(i,t){if(S_(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function DA(i,t,e){const r=LL(i,e),s=self.URL||self.webkitURL,n=typeof r!="string"&&s.createObjectURL(r);try{return await ML(n||r,t)}finally{n&&s.revokeObjectURL(n)}}async function ML(i,t){const e=new Image;return e.src=i,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((r,s)=>{try{e.onload=()=>r(e),e.onerror=n=>s(new Error("Could not load image ".concat(i,": ").concat(n)))}catch(n){s(n)}})}const BL={};let N2=!0;async function RL(i,t,e){let r;S_(e)?r=await DA(i,t,e):r=NA(i,e);const s=t&&t.imagebitmap;return await kL(r,s)}async function kL(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((OL(t)||!N2)&&(t=null),t)try{return await createImageBitmap(i,t)}catch(e){console.warn(e),N2=!1}return await createImageBitmap(i)}function OL(i){for(const t in i||BL)return!1;return!0}function FL(i){return!UL(i,"ftyp",4)||!(i[8]&96)?null:NL(i)}function NL(i){switch(DL(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function DL(i,t,e){return String.fromCharCode(...i.slice(t,e))}function zL(i){return[...i].map(t=>t.charCodeAt(0))}function UL(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=zL(t);for(let s=0;s<r.length;++s)if(r[s]!==i[s+e])return!1;return!0}const sc=!1,Zp=!0;function E_(i){const t=Af(i);return VL(t)||WL(t)||qL(t)||HL(t)||jL(t)}function jL(i){const t=new Uint8Array(i instanceof DataView?i.buffer:i),e=FL(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function VL(i){const t=Af(i);return t.byteLength>=24&&t.getUint32(0,sc)===2303741511?{mimeType:"image/png",width:t.getUint32(16,sc),height:t.getUint32(20,sc)}:null}function qL(i){const t=Af(i);return t.byteLength>=10&&t.getUint32(0,sc)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Zp),height:t.getUint16(8,Zp)}:null}function HL(i){const t=Af(i);return t.byteLength>=14&&t.getUint16(0,sc)===16973&&t.getUint32(2,Zp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Zp),height:t.getUint32(22,Zp)}:null}function WL(i){const t=Af(i);if(!(t.byteLength>=3&&t.getUint16(0,sc)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:e,sofMarkers:r}=JL();let s=2;for(;s+9<t.byteLength;){const n=t.getUint16(s,sc);if(r.has(n))return{mimeType:"image/jpeg",height:t.getUint16(s+5,sc),width:t.getUint16(s+7,sc)};if(!e.has(n))return null;s+=2,s+=t.getUint16(s,sc)}return null}function JL(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Af(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function XL(i,t){const{mimeType:e}=E_(i)||{},r=globalThis._parseImageNode;return Kr(r),await r(i,e)}async function ZL(i,t,e){t=t||{};const r=(t.image||{}).type||"auto",{url:s}=e||{},n=$L(r);let c;switch(n){case"imagebitmap":c=await RL(i,t,s);break;case"image":c=await DA(i,t,s);break;case"data":c=await XL(i);break;default:Kr(!1)}return r==="data"&&(c=CL(c)),c}function $L(i){switch(i){case"auto":case"data":return SL();default:return AL(i),i}}const YL=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],KL=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],QL={image:{type:"auto",decode:!0}},zA={id:"image",module:"images",name:"Images",version:bL,mimeTypes:KL,extensions:YL,parse:ZL,tests:[i=>!!E_(new DataView(i))],options:QL},H0={};function t4(i){if(H0[i]===void 0){const t=Bm?i4(i):e4(i);H0[i]=t}return H0[i]}function e4(i){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:e,_imageFormatsNode:r=t}=globalThis;return!!e&&r.includes(i)}function i4(i){switch(i){case"image/avif":case"image/webp":return r4(i);default:return!0}}function r4(i){try{return document.createElement("canvas").toDataURL(i).indexOf("data:".concat(i))===0}catch{return!1}}const fr=new xf({id:"deck"}),Ph={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},W0=1,Tp=2,J0=3,X0=4,s4=2,n4=i=>({"layer.changeFlag":(t,e,r)=>{i.log(J0,"".concat(t.id," ").concat(e,": "),r[e])()},"layer.initialize":t=>{i.log(W0,"Initializing ".concat(t))()},"layer.update":(t,e)=>{if(e){const r=t.getChangeFlags();i.log(Tp,"Updating ".concat(t," because: ").concat(Object.keys(r).filter(s=>r[s]).join(", ")))()}else i.log(X0,"".concat(t," does not need update"))()},"layer.matched":(t,e)=>{e&&i.log(X0,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{i.log(W0,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,e,r)=>{e?i.log(Tp,"Composite layer rendered new subLayers ".concat(t),r)():i.log(X0,"Composite layer reused subLayers ".concat(t),r)()},"layerManager.setLayers":(t,e,r)=>{e&&i.log(Tp,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(t,e)=>{i.log(J0,"Viewport changed",e)()},"attributeManager.invalidate":(t,e,r)=>{i.log(W0,r?"invalidated attributes ".concat(r," (").concat(e,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{Ph.attributeUpdateMessages.length=0,Ph.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,e)=>{const r=Math.round(Date.now()-Ph.attributeManagerUpdateStart);i.groupCollapsed(Tp,"Updated attributes for ".concat(e," instances in ").concat(t.id," in ").concat(r,"ms"))();for(const s of Ph.attributeUpdateMessages)i.log(J0,s)();i.groupEnd(Tp)()},"attribute.updateStart":t=>{Ph.attributeUpdateStart=Date.now()},"attribute.allocate":(t,e)=>{const r="".concat(t.id," allocated ").concat(e);Ph.attributeUpdateMessages.push(r)},"attribute.updateEnd":(t,e)=>{const r=Math.round(Date.now()-Ph.attributeUpdateStart),s="".concat(t.id," updated ").concat(e," in ").concat(r,"ms");Ph.attributeUpdateMessages.push(s)},"deckRenderer.renderLayers":(t,e,r)=>{const{pass:s,redrawReason:n,stats:c}=r;for(const l of e){const{totalCount:f,visibleCount:y,compositeCount:A,pickableCount:T}=l,P=f-A-y;i.log(s4,"RENDER #".concat(t.renderCount,"   ").concat(y," (of ").concat(f," layers) to ").concat(s," because ").concat(n,"   (").concat(P," hidden, ").concat(A," composite ").concat(T," pickable)"))(),c&&c.get("Redraw Layers").add(y)}}});var o4={};let pm={};o4.NODE_ENV!=="production"&&(pm=n4(fr));function a4(i){pm=i}function Xn(i,t,e,r){fr.level>0&&pm[i]&&pm[i].call(null,t,e,r)}function l4(i){const t=i[0],e=i[i.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const c4={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:l4,parseTextSync:JSON.parse};function h4(){const i="8.9.36",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==i)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(i));return t||(fr.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:fr,_registerLoggers:a4},XI([c4,[zA,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const u4=h4(),lr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(lr,"IDENTITY",{get:()=>(fr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const oc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},h1={common:0,meters:1,pixels:2},D2={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},di=new xf({id:"luma.gl"});function _o(i,t){if(!i)throw new Error(t||"luma.gl: assertion failed.")}const d4="Invalid WebGLRenderingContext",p4="Requires WebGL2";function km(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function Ki(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function f4(i){return Ki(i)?i:null}function Om(i){return _o(km(i),d4),i}function vo(i){return _o(Ki(i),p4),i}const Vp={};function g4(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function m4(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function y4(i,t){Vp[i]=!0,g4(t)}function _4(i){const t=i.getError;i.getError=function(){let e;do e=t.apply(i),e!==0&&(Vp[e]=!0);while(e!==0);for(e in Vp)if(Vp[e])return delete Vp[e],parseInt(e,10);return 0}}const Sf=function i(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const s=new i.VertexAttrib(e);this.attribs[r]=s}this.maxAttrib=0};Sf.VertexAttrib=function(i){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Sf.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Du=function(i){const t=this;this.gl=i,_4(i);const e=this.original={getParameter:i.getParameter,enableVertexAttribArray:i.enableVertexAttribArray,disableVertexAttribArray:i.disableVertexAttribArray,bindBuffer:i.bindBuffer,getVertexAttrib:i.getVertexAttrib,vertexAttribPointer:i.vertexAttribPointer};i.getParameter=function(r){return r===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:e.getParameter.apply(this,arguments)},i.enableVertexAttribArray=function(r){const s=t.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,r);const n=s.attribs[r];return n.enabled=!0,e.enableVertexAttribArray.apply(this,arguments)},i.disableVertexAttribArray=function(r){const s=t.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,r);const n=s.attribs[r];return n.enabled=!1,e.disableVertexAttribArray.apply(this,arguments)},i.bindBuffer=function(r,s){switch(r){case 34962:t.currentArrayBuffer=s;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=s;break}return e.bindBuffer.apply(this,arguments)},i.getVertexAttrib=function(r,s){const n=t.currentVertexArrayObject.attribs[r];switch(s){case 34975:return n.buffer;case 34338:return n.enabled;case 34339:return n.size;case 34340:return n.stride;case 34341:return n.type;case 34922:return n.normalized;default:return e.getVertexAttrib.apply(this,arguments)}},i.vertexAttribPointer=function(r,s,n,c,l,f){const y=t.currentVertexArrayObject;y.maxAttrib=Math.max(y.maxAttrib,r);const A=y.attribs[r];return A.buffer=t.currentArrayBuffer,A.size=s,A.type=n,A.normalized=c,A.stride=l,A.offset=f,A.recache(),e.vertexAttribPointer.apply(this,arguments)},i.instrumentExtension&&i.instrumentExtension(this,"OES_vertex_array_object"),i.canvas&&i.canvas.addEventListener("webglcontextrestored",()=>{m4("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};Du.prototype.VERTEX_ARRAY_BINDING_OES=34229;Du.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const i=this.gl;this.maxVertexAttribs=i.getParameter(34921),this.defaultVertexArrayObject=new Sf(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Du.prototype.createVertexArrayOES=function(){const i=new Sf(this);return this.vertexArrayObjects.push(i),i};Du.prototype.deleteVertexArrayOES=function(i){i.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(i),1),this.currentVertexArrayObject===i&&this.bindVertexArrayOES(null)};Du.prototype.isVertexArrayOES=function(i){return!!(i&&i instanceof Sf&&i.hasBeenBound&&i.ext===this)};Du.prototype.bindVertexArrayOES=function(i){const t=this.gl;if(i&&!i.isAlive){y4(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const e=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=i||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&e.bindBuffer.call(t,34963,s.elementArrayBuffer);let n=this.currentArrayBuffer;const c=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=c;l++){const f=s.attribs[l],y=r?r.attribs[l]:null;if((!r||f.enabled!==y.enabled)&&(f.enabled?e.enableVertexAttribArray.call(t,l):e.disableVertexAttribArray.call(t,l)),f.enabled){let A=!1;(!r||f.buffer!==y.buffer)&&(n!==f.buffer&&(e.bindBuffer.call(t,34962,f.buffer),n=f.buffer),A=!0),(A||f.cached!==y.cached)&&e.vertexAttribPointer.call(t,l,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==n&&e.bindBuffer.call(t,34962,this.currentArrayBuffer)};function v4(i){if(typeof i.createVertexArray=="function")return;const t=i.getSupportedExtensions;i.getSupportedExtensions=function(){const r=t.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const e=i.getExtension;i.getExtension=function(r){return e.call(this,r)||(r!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Du(this)),this.__OESVertexArrayObject))}}const z2="OES_element_index",U2="WEBGL_draw_buffers",b4="EXT_disjoint_timer_query",w4="EXT_disjoint_timer_query_webgl2",x4="EXT_texture_filter_anisotropic",j2="WEBGL_debug_renderer_info",A4=35723,S4=4352,E4=36795,C4=34047,T4=37445,P4=37446,es=i=>Ki(i)?void 0:0,I4={3074:i=>Ki(i)?void 0:36064,[A4]:i=>Ki(i)?void 0:S4,35977:es,32937:es,[E4]:(i,t)=>{const e=Ki(i)?i.getExtension(w4):i.getExtension(b4);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[T4]:(i,t)=>{const e=i.getExtension(j2);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[P4]:(i,t)=>{const e=i.getExtension(j2);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[C4]:(i,t)=>{const e=i.luma.extensions[x4];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:es,35071:es,37447:es,36063:(i,t)=>{if(!Ki(i)){const e=i.getExtension(U2);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:es,35374:es,35377:es,34852:i=>{if(!Ki(i)){const t=i.getExtension(U2);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:i=>i.getExtension(z2)?2147483647:65535,33001:i=>i.getExtension(z2)?16777216:65535,33e3:i=>16777216,37157:es,35373:es,35657:es,36183:es,37137:es,34045:es,35978:es,35979:es,35968:es,35376:es,35375:es,35659:es,37154:es,35371:es,35658:es,35076:es,35077:es,35380:es};function L4(i,t,e){const r=I4[e],s=typeof r=="function"?r(i,t,e):r;return s!==void 0?s:t(e)}const M4="OES_vertex_array_object",UA="ANGLE_instanced_arrays",B4="WEBGL_draw_buffers",R4="EXT_disjoint_timer_query",k4="EXT_texture_filter_anisotropic",O4="VertexArray requires WebGL2 or OES_vertex_array_object extension";function F4(i,t){return{webgl2:Ki(i),ext:i.getExtension(t)}}const jA={[M4]:{meta:{suffix:"OES"},createVertexArray:()=>{_o(!1,O4)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[UA]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,t){_o(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[B4]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{_o(!1)}},[R4]:{meta:{suffix:"EXT"},createQuery:()=>{_o(!1)},deleteQuery:()=>{_o(!1)},beginQuery:()=>{_o(!1)},endQuery:()=>{},getQuery(i,t){return this.getQueryObject(i,t)},getQueryParameter(i,t){return this.getQueryObject(i,t)},getQueryObject:()=>{}}},Z0={readBuffer:(i,t,e)=>{Ki(i)&&t(e)},getVertexAttrib:(i,t,e,r)=>{const{webgl2:s,ext:n}=F4(i,UA);let c;switch(r){case 35069:c=s?void 0:!1;break;case 35070:c=!s&&!n?0:void 0;break}return c!==void 0?c:t(e,r)},getProgramParameter:(i,t,e,r)=>{if(!Ki(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,r)},getInternalformatParameter:(i,t,e,r,s)=>{if(!Ki(i))switch(s){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(e,r,s)},getTexParameter(i,t,e,r){switch(r){case 34046:const{extensions:s}=i.luma,n=s[k4];r=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,r)},getParameter:L4,hint(i,t,e,r){return t(e,r)}};function N4(i){i.luma=i.luma||{};const{luma:t}=i;return t.polyfilled||(v4(i),D4(i),U4(i,jA),z4(i,{target:t,target2:i}),t.polyfilled=!0),i}globalThis.polyfillContext=N4;function D4(i){i.luma.extensions={};const t=i.getSupportedExtensions()||[];for(const e of t)i.luma[e]=i.getExtension(e)}function z4(i,t){let{target:e,target2:r}=t;Object.keys(Z0).forEach(s=>{if(typeof Z0[s]=="function"){const n=i[s]?i[s].bind(i):()=>{},c=Z0[s].bind(null,i,n);e[s]=c,r[s]=c}})}function U4(i,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&j4(i,{extension:e,target:i.luma,target2:i})}function j4(i,t){let{extension:e,target:r,target2:s}=t;const n=jA[e];_o(n);const{meta:c={}}=n,{suffix:l=""}=c,f=i.getExtension(e);for(const y of Object.keys(n)){const A="".concat(y).concat(l);let T=null;y==="meta"||typeof i[y]=="function"||(f&&typeof f[A]=="function"?T=function(){return f[A](...arguments)}:typeof n[y]=="function"&&(T=n[y].bind(r))),T&&(r[y]=T,s[y]=T)}}const C_={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ih=(i,t,e)=>t?i.enable(e):i.disable(e),G2=(i,t,e)=>i.hint(e,t),pa=(i,t,e)=>i.pixelStorei(e,t),G4=(i,t)=>{const e=Ki(i)?36009:36160;return i.bindFramebuffer(e,t)},V4=(i,t)=>i.bindFramebuffer(36008,t);function Pp(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const q4={3042:Ih,32773:(i,t)=>i.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,t)=>i.clearColor(...t),3107:(i,t)=>i.colorMask(...t),2884:Ih,2885:(i,t)=>i.cullFace(t),2929:Ih,2931:(i,t)=>i.clearDepth(t),2932:(i,t)=>i.depthFunc(t),2928:(i,t)=>i.depthRange(...t),2930:(i,t)=>i.depthMask(t),3024:Ih,35723:G2,36006:G4,2886:(i,t)=>i.frontFace(t),33170:G2,2849:(i,t)=>i.lineWidth(t),32823:Ih,32824:"polygonOffset",10752:"polygonOffset",35977:Ih,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ih,3088:(i,t)=>i.scissor(...t),2960:Ih,2961:(i,t)=>i.clearStencil(t),2968:(i,t)=>i.stencilMaskSeparate(1028,t),36005:(i,t)=>i.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,t)=>i.viewport(...t),3333:pa,3317:pa,37440:pa,37441:pa,37443:pa,3330:pa,3332:pa,3331:pa,36010:V4,3314:pa,32878:pa,3316:pa,3315:pa,32877:pa,framebuffer:(i,t)=>{const e=t&&"handle"in t?t.handle:t;return i.bindFramebuffer(36160,e)},blend:(i,t)=>t?i.enable(3042):i.disable(3042),blendColor:(i,t)=>i.blendColor(...t),blendEquation:(i,t)=>{t=Pp(t)?t:[t,t],i.blendEquationSeparate(...t)},blendFunc:(i,t)=>{t=Pp(t)&&t.length===2?[...t,...t]:t,i.blendFuncSeparate(...t)},clearColor:(i,t)=>i.clearColor(...t),clearDepth:(i,t)=>i.clearDepth(t),clearStencil:(i,t)=>i.clearStencil(t),colorMask:(i,t)=>i.colorMask(...t),cull:(i,t)=>t?i.enable(2884):i.disable(2884),cullFace:(i,t)=>i.cullFace(t),depthTest:(i,t)=>t?i.enable(2929):i.disable(2929),depthFunc:(i,t)=>i.depthFunc(t),depthMask:(i,t)=>i.depthMask(t),depthRange:(i,t)=>i.depthRange(...t),dither:(i,t)=>t?i.enable(3024):i.disable(3024),derivativeHint:(i,t)=>{i.hint(35723,t)},frontFace:(i,t)=>i.frontFace(t),mipmapHint:(i,t)=>i.hint(33170,t),lineWidth:(i,t)=>i.lineWidth(t),polygonOffsetFill:(i,t)=>t?i.enable(32823):i.disable(32823),polygonOffset:(i,t)=>i.polygonOffset(...t),sampleCoverage:(i,t)=>i.sampleCoverage(...t),scissorTest:(i,t)=>t?i.enable(3089):i.disable(3089),scissor:(i,t)=>i.scissor(...t),stencilTest:(i,t)=>t?i.enable(2960):i.disable(2960),stencilMask:(i,t)=>{t=Pp(t)?t:[t,t];const[e,r]=t;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,t)=>{t=Pp(t)&&t.length===3?[...t,...t]:t;const[e,r,s,n,c,l]=t;i.stencilFuncSeparate(1028,e,r,s),i.stencilFuncSeparate(1029,n,c,l)},stencilOp:(i,t)=>{t=Pp(t)&&t.length===3?[...t,...t]:t;const[e,r,s,n,c,l]=t;i.stencilOpSeparate(1028,e,r,s),i.stencilOpSeparate(1029,n,c,l)},viewport:(i,t)=>i.viewport(...t)};function Es(i,t,e){return t[i]!==void 0?t[i]:e[i]}const H4={blendEquation:(i,t,e)=>i.blendEquationSeparate(Es(32777,t,e),Es(34877,t,e)),blendFunc:(i,t,e)=>i.blendFuncSeparate(Es(32969,t,e),Es(32968,t,e),Es(32971,t,e),Es(32970,t,e)),polygonOffset:(i,t,e)=>i.polygonOffset(Es(32824,t,e),Es(10752,t,e)),sampleCoverage:(i,t,e)=>i.sampleCoverage(Es(32938,t,e),Es(32939,t,e)),stencilFuncFront:(i,t,e)=>i.stencilFuncSeparate(1028,Es(2962,t,e),Es(2967,t,e),Es(2963,t,e)),stencilFuncBack:(i,t,e)=>i.stencilFuncSeparate(1029,Es(34816,t,e),Es(36003,t,e),Es(36004,t,e)),stencilOpFront:(i,t,e)=>i.stencilOpSeparate(1028,Es(2964,t,e),Es(2965,t,e),Es(2966,t,e)),stencilOpBack:(i,t,e)=>i.stencilOpSeparate(1029,Es(34817,t,e),Es(34818,t,e),Es(34819,t,e))},V2={enable:(i,t)=>i({[t]:!0}),disable:(i,t)=>i({[t]:!1}),pixelStorei:(i,t,e)=>i({[t]:e}),hint:(i,t,e)=>i({[t]:e}),bindFramebuffer:(i,t,e)=>{switch(t){case 36160:return i({36006:e,36010:e});case 36009:return i({36006:e});case 36008:return i({36010:e});default:return null}},blendColor:(i,t,e,r,s)=>i({32773:new Float32Array([t,e,r,s])}),blendEquation:(i,t)=>i({32777:t,34877:t}),blendEquationSeparate:(i,t,e)=>i({32777:t,34877:e}),blendFunc:(i,t,e)=>i({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(i,t,e,r,s)=>i({32969:t,32968:e,32971:r,32970:s}),clearColor:(i,t,e,r,s)=>i({3106:new Float32Array([t,e,r,s])}),clearDepth:(i,t)=>i({2931:t}),clearStencil:(i,t)=>i({2961:t}),colorMask:(i,t,e,r,s)=>i({3107:[t,e,r,s]}),cullFace:(i,t)=>i({2885:t}),depthFunc:(i,t)=>i({2932:t}),depthRange:(i,t,e)=>i({2928:new Float32Array([t,e])}),depthMask:(i,t)=>i({2930:t}),frontFace:(i,t)=>i({2886:t}),lineWidth:(i,t)=>i({2849:t}),polygonOffset:(i,t,e)=>i({32824:t,10752:e}),sampleCoverage:(i,t,e)=>i({32938:t,32939:e}),scissor:(i,t,e,r,s)=>i({3088:new Int32Array([t,e,r,s])}),stencilMask:(i,t)=>i({2968:t,36005:t}),stencilMaskSeparate:(i,t,e)=>i({[t===1028?2968:36005]:e}),stencilFunc:(i,t,e,r)=>i({2962:t,2967:e,2963:r,34816:t,36003:e,36004:r}),stencilFuncSeparate:(i,t,e,r,s)=>i({[t===1028?2962:34816]:e,[t===1028?2967:36003]:r,[t===1028?2963:36004]:s}),stencilOp:(i,t,e,r)=>i({2964:t,2965:e,2966:r,34817:t,34818:e,34819:r}),stencilOpSeparate:(i,t,e,r,s)=>i({[t===1028?2964:34817]:e,[t===1028?2965:34818]:r,[t===1028?2966:34819]:s}),viewport:(i,t,e,r,s)=>i({2978:[t,e,r,s]})},Ql=(i,t)=>i.isEnabled(t),q2={3042:Ql,2884:Ql,2929:Ql,3024:Ql,32823:Ql,32926:Ql,32928:Ql,3089:Ql,2960:Ql,35977:Ql};function GA(i){for(const t in i)return!1;return!0}function W4(i,t){if(i===t)return!0;const e=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&r&&i.length===t.length){for(let s=0;s<i.length;++s)if(i[s]!==t[s])return!1;return!0}return!1}function H2(i,t){const e=i[t].bind(i);i[t]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in i.state.cache?i.state.enable?i.state.cache[r]:e(...arguments):e(...arguments)},Object.defineProperty(i[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function J4(i,t,e){const r=i[t].bind(i);i[t]=function(){for(var s=arguments.length,n=new Array(s),c=0;c<s;c++)n[c]=arguments[c];const{valueChanged:l,oldValue:f}=e(i.state._updateCache,...n);return l&&r(...n),f},Object.defineProperty(i[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function X4(i){const t=i.useProgram.bind(i);i.useProgram=function(e){i.state.program!==e&&(t(e),i.state.program=e)}}class Z4{constructor(t){let{copyState:e=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?Y4(t):Object.assign({},C_),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){_o(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Jc(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,r;const s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const n in t){_o(n!==void 0);const c=t[n],l=this.cache[n];W4(c,l)||(e=!0,r=l,s&&!(n in s)&&(s[n]=l),this.cache[n]=c)}return{valueChanged:e,oldValue:r}}}function VA(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:r}=t;if(_o(r!==void 0),!i.state){const{polyfillContext:s}=globalThis;s&&s(i),i.state=new Z4(i,{copyState:r}),X4(i);for(const n in V2){const c=V2[n];J4(i,n,c)}H2(i,"getParameter"),H2(i,"isEnabled")}return i.state.enable=e,i}function $4(i){i.state||VA(i,{copyState:!1}),i.state.push()}function W2(i){_o(i.state),i.state.pop()}function Jc(i,t){if(_o(km(i),"setParameters requires a WebGL context"),GA(t))return;const e={};for(const s in t){const n=Number(s),c=q4[s];c&&(typeof c=="string"?e[c]=!0:c(i,t[s],n))}const r=i.state&&i.state.cache;if(r)for(const s in e){const n=H4[s];n(i,t,r)}}function Y4(i,t){if(t=t||C_,typeof t=="number"){const s=t,n=q2[s];return n?n(i,s):i.getParameter(s)}const e=Array.isArray(t)?t:Object.keys(t),r={};for(const s of e){const n=q2[s];r[s]=n?n(i,Number(s)):i.getParameter(Number(s))}return r}function K4(i){Jc(i,C_)}function wl(i,t,e){if(GA(t))return e(i);const{nocatch:r=!0}=t;$4(i),Jc(i,t);let s;if(r)s=e(i),W2(i);else try{s=e(i)}finally{W2(i)}return s}function Dd(i){const{luma:t}=i;if(i.canvas&&t){const e=t.canvasSizeInfo,r="clientWidth"in e?e.clientWidth:i.canvas.clientWidth;return r?i.drawingBufferWidth/r:1}return 1}function $0(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=Dd(i),s=i.drawingBufferWidth,n=i.drawingBufferHeight;return tM(t,r,s,n,e)}function Q4(i){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?t:1}function tM(i,t,e,r,s){const n=J2(i[0],t,e);let c=X2(i[1],t,r,s),l=J2(i[0]+1,t,e);const f=l===e-1?l:l-1;l=X2(i[1]+1,t,r,s);let y;return s?(l=l===0?l:l+1,y=c,c=l):y=l===r-1?l:l-1,{x:n,y:c,width:Math.max(f-n+1,1),height:Math.max(y-c+1,1)}}function J2(i,t,e){return Math.min(Math.round(i*t),e-1)}function X2(i,t,e,r){return r?Math.max(0,e-1-Math.round(i*t)):Math.min(Math.round(i*t),e-1)}const T_=$c(),eM=T_&&typeof document<"u",qA={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function HA(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_o(T_,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},qA,i);const{width:t,height:e}=i;function r(l){if(i.throwOnError)throw new Error(l);return console.error(l),null}i.onError=r;let s;const{canvas:n}=i,c=nM({canvas:n,width:t,height:e,onError:r});return s=sM(c,i),s?(s=P_(s,i),oM(s),s):null}function P_(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||aM(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},t=Object.assign({},qA,t);const{manageState:e,debug:r}=t;return e&&VA(i,{copyState:!1,log:function(){for(var s=arguments.length,n=new Array(s),c=0;c<s;c++)n[c]=arguments[c];return di.log(1,...n)()}}),T_&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,t),di.level=Math.max(di.level,1)):di.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function iM(i){const t=i.getParameter(7936),e=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),s=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),n=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||t,renderer:n||e,vendorMasked:t,rendererMasked:e,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function rM(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=Q4(t.useDevicePixels);lM(i,r,t);return}const e=i.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function sM(i,t){const{onError:e}=t;let r=null;const s=f=>r=f.statusMessage||r;i.addEventListener("webglcontextcreationerror",s,!1);const{webgl1:n=!0,webgl2:c=!0}=t;let l=null;return c&&(l=l||i.getContext("webgl2",t),l=l||i.getContext("experimental-webgl2",t)),n&&(l=l||i.getContext("webgl",t),l=l||i.getContext("experimental-webgl",t)),i.removeEventListener("webglcontextcreationerror",s,!1),l?(t.onContextLost&&i.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&i.addEventListener("webglcontextrestored",t.onContextRestored,!1),l):e("Failed to create ".concat(c&&!n?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function nM(i){let{canvas:t,width:e=800,height:r=600,onError:s}=i,n;return typeof t=="string"?(eM&&document.readyState==="complete"||s("createGLContext called on canvas '".concat(t,"' before page was loaded")),n=document.getElementById(t)):t?n=t:(n=document.createElement("canvas"),n.id="lumagl-canvas",n.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",n.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(n,document.body.firstChild)),n}function oM(i){const t=Ki(i)?"WebGL2":"WebGL1",e=iM(i),r=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",s=i.debug?" debug":"";di.info(1,"".concat(t).concat(s," context ").concat(r))()}function aM(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function lM(i,t,e){let r="width"in e?e.width:i.canvas.clientWidth,s="height"in e?e.height:i.canvas.clientHeight;(!r||!s)&&(di.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,r=i.canvas.width||1,s=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const n=i.luma.canvasSizeInfo;if(n.clientWidth!==r||n.clientHeight!==s||n.devicePixelRatio!==t){let c=t;const l=Math.floor(r*c),f=Math.floor(s*c);i.canvas.width=l,i.canvas.height=f,(i.drawingBufferWidth!==l||i.drawingBufferHeight!==f)&&(di.warn("Device pixel ratio clamped")(),c=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/s),i.canvas.width=Math.floor(r*c),i.canvas.height=Math.floor(s*c)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:s,devicePixelRatio:t})}}const $p="8.5.21",cM="set luma.log.level=1 (or higher) to trace rendering";class hM{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new bf({id:t})),this.stats.get(t)}}const Su=new hM;if(globalThis.luma&&globalThis.luma.VERSION!==$p)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat($p));globalThis.luma||($c()&&di.log(1,"luma.gl ".concat($p," - ").concat(cM))(),globalThis.luma=globalThis.luma||{VERSION:$p,version:$p,log:di,stats:Su,globals:{modules:{},nodeIO:{}}});function uM(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function dM(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function ti(i,t){if(!i)throw new Error(t||"luma.gl: assertion failed.")}function Y0(i,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const r=i[t];return ti(r!==void 0,"Accessing undefined constant GL.".concat(t)),r}function Vh(i,t){t=Number(t);for(const e in i)if(i[e]===t)return"GL.".concat(e);return String(t)}const K0={};function Xc(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";K0[i]=K0[i]||1;const t=K0[i]++;return"".concat(i,"-").concat(t)}function Z2(i){return ti(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function zd(i){let t=!0;for(const e in i){t=!1;break}return t}function WA(i,t,e,r){const s="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),n=Object.getPrototypeOf(i);r.forEach(c=>{n.methodName||(n[c]=()=>{throw di.removed("Calling removed method ".concat(t,".").concat(c,": "),s)(),new Error(c)})})}const ad="Resource subclass must define virtual methods";let Yc=class{get[Symbol.toStringTag](){return"Resource"}constructor(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Om(i);const{id:e,userData:r={}}=t;this.gl=i,this.gl2=i,this.id=e||Xc(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:i=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&i&&t.filter(Boolean).forEach(e=>e.delete()),this}bind(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof i!="function")return this._bindHandle(i),this;let t;return this._bound?t=i():(this._bindHandle(this.handle),this._bound=!0,t=i(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};i=Y0(this.gl,i),ti(i);const e=(this.constructor.PARAMETERS||{})[i];if(e){const r=Ki(this.gl);if(!((!("webgl2"in e)||r)&&(!("extension"in e)||this.gl.getExtension(e.extension)))){const s=e.webgl1,n="webgl2"in e?e.webgl2:e.webgl1;return r?n:s}}return this._getParameter(i,t)}getParameters(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:e}=i,r=this.constructor.PARAMETERS||{},s=Ki(this.gl),n={},c=t||Object.keys(r);for(const l of c){const f=r[l];if(f&&(!("webgl2"in f)||s)&&(!("extension"in f)||this.gl.getExtension(f.extension))){const y=e?Vh(this.gl,l):l;n[y]=this.getParameter(l,i),e&&f.type==="GLenum"&&(n[y]=Vh(this.gl,n[y]))}}return n}setParameter(i,t){i=Y0(this.gl,i),ti(i);const e=(this.constructor.PARAMETERS||{})[i];if(e){const r=Ki(this.gl);if(!((!("webgl2"in e)||r)&&(!("extension"in e)||this.gl.getExtension(e.extension))))throw new Error("Parameter not available on this platform");e.type==="GLenum"&&(t=Y0(t))}return this._setParameter(i,t),this}setParameters(i){for(const t in i)this.setParameter(t,i[t]);return this}stubRemovedMethods(i,t,e){return WA(this,i,t,e)}initialize(i){}_createHandle(){throw new Error(ad)}_deleteHandle(){throw new Error(ad)}_bindHandle(i){throw new Error(ad)}_getOptsFromHandle(){throw new Error(ad)}_getParameter(i,t){throw new Error(ad)}_setParameter(i,t){throw new Error(ad)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const i=this[Symbol.toStringTag],t=Su.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(i,"s Created")).incrementCount(),t.get("".concat(i,"s Active")).incrementCount()}_removeStats(){const i=this[Symbol.toStringTag];Su.get("Resource Counts").get("".concat(i,"s Active")).decrementCount()}_trackAllocatedMemory(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(i,t),this._trackAllocatedMemoryForContext(i,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=i}_trackAllocatedMemoryForContext(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=Su.get("Memory Usage".concat(e));r.get("GPU Memory").addCount(i),r.get("".concat(t," Memory")).addCount(i)}_trackDeallocatedMemory(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(i),this._trackDeallocatedMemoryForContext(i,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const e=Su.get("Memory Usage".concat(t));e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(i," Memory")).subtractCount(this.byteLength)}};const pM="Failed to deduce GL constant from typed array";function u1(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(pM)}}function nf(i){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function fM(i){let{data:t,width:e,height:r,bytesPerPixel:s=4,temp:n}=i;const c=e*s;n=n||new Uint8Array(c);for(let l=0;l<r/2;++l){const f=l*c,y=(r-l-1)*c;n.set(t.subarray(f,f+c)),t.copyWithin(f,y,y+c),t.set(n,y)}}function gM(i){let{data:t,width:e,height:r}=i;const s=Math.round(e/2),n=Math.round(r/2),c=new Uint8Array(s*n*4);for(let l=0;l<n;l++)for(let f=0;f<s;f++)for(let y=0;y<4;y++)c[(l*s+f)*4+y]=t[(l*2*e+f*2)*4+y];return{data:c,width:s,height:n}}function d1(i,t,e){const{removedProps:r={},deprecatedProps:s={},replacedProps:n={}}=e;for(const l in r)if(l in t){const f=r[l]?"".concat(i,".").concat(r[l]):"N/A";di.removed("".concat(i,".").concat(l),f)()}for(const l in s)if(l in t){const f=s[l];di.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(f))()}let c=null;for(const l in n)if(l in t){const f=n[l];di.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(f))(),c=c||Object.assign({},t),c[f]=t[l],delete c[l]}return c||t}const mM={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},yM={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class zo{static getBytesPerElement(t){return nf(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return ti(t.size),nf(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new zo(mM,...e)}constructor(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(s=>this._assign(s)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return zo.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return zo.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=d1("Accessor",t,yM),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const $2=10,JA={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},_M={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:JA},vM={removedProps:JA};let Hr=class extends Yc{get[Symbol.toStringTag](){return"Buffer"}constructor(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(i,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/zo.getBytesPerElement(i))}getVertexCount(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/zo.getBytesPerVertex(i))}initialize(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(i)&&(i={data:i}),Number.isFinite(i)&&(i={byteLength:i}),i=d1("Buffer",i,_M),this.usage=i.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},i,i.accessor)),i.data?this._setData(i.data,i.offset,i.byteLength):this._setByteLength(i.byteLength||0),this}setProps(i){return i=d1("Buffer",i,vM),"accessor"in i&&this.setAccessor(i.accessor),this}setAccessor(i){return i=Object.assign({},i),delete i.buffer,this.accessor=new zo(i),this}reallocate(i){return i>this.byteLength?(this._setByteLength(i),!0):(this.bytesUsed=i,!1)}setData(i){return this.initialize(i)}subData(i){ArrayBuffer.isView(i)&&(i={data:i});const{data:t,offset:e=0,srcOffset:r=0}=i,s=i.byteLength||i.length;ti(t);const n=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(n,this.handle),r!==0||s!==void 0?(vo(this.gl),this.gl.bufferSubData(this.target,e,t,r,s)):this.gl.bufferSubData(n,e,t),this.gl.bindBuffer(n,null),this.debugData=null,this._inferType(t),this}copyData(i){let{sourceBuffer:t,readOffset:e=0,writeOffset:r=0,size:s}=i;const{gl:n}=this;return vo(n),n.bindBuffer(36662,t.handle),n.bindBuffer(36663,this.handle),n.copyBufferSubData(36662,36663,e,r,s),n.bindBuffer(36662,null),n.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:i=null,srcByteOffset:t=0,dstOffset:e=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vo(this.gl);const s=nf(this.accessor.type||5126,{clamped:!1}),n=this._getAvailableElementCount(t),c=e;let l,f;i?(f=i.length,l=f-c):(l=Math.min(n,r||n),f=c+l);const y=Math.min(n,l);return r=r||y,ti(r<=y),i=i||new s(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,e,r),this.gl.bindBuffer(36662,null),i}bind(){let{target:i=this.target,index:t=this.accessor&&this.accessor.index,offset:e=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i===35345||i===35982?r!==void 0?this.gl.bindBufferRange(i,t,this.handle,e,r):(ti(e===0),this.gl.bindBufferBase(i,t,this.handle)):this.gl.bindBuffer(i,this.handle),this}unbind(){let{target:i=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i===35345||i===35982?this.gl.bindBufferBase(i,t,null):this.gl.bindBuffer(i,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min($2,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i.byteLength+t;ti(ArrayBuffer.isView(i)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,e,this.usage),this.gl.bufferSubData(r,t,i),this.gl.bindBuffer(r,null),this.debugData=i.slice(0,$2),this.bytesUsed=e,this._trackAllocatedMemory(e);const s=u1(i);return ti(s),this.setAccessor(new zo(this.accessor,{type:s})),this}_setByteLength(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ti(i>=0),this._trackDeallocatedMemory();let e=i;i===0&&(e=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,e,t),this.gl.bindBuffer(r,null),this.usage=t,this.debugData=null,this.bytesUsed=i,this._trackAllocatedMemory(i),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(i){const t=nf(this.accessor.type||5126,{clamped:!1}),e=i/t.BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(i){this.accessor.type||this.setAccessor(new zo(this.accessor,{type:u1(i)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(i){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,i);return this.gl.bindBuffer(this.target,null),t}get type(){return di.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return di.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(i){return di.deprecated("setByteLength","reallocate")(),this.reallocate(i)}updateAccessor(i){return di.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new zo(this.accessor,i),this}};const I_={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},XA={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},ZA={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function bM(i,t){const e=I_[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const r=Ki(i)&&e.gl2||e.gl1;return typeof r=="string"?i.getExtension(r):r}function wM(i,t){const e=I_[t];switch(e&&e.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const xM=[9729,9728],Y2=globalThis.WebGLBuffer||function(){};class Ud extends Yc{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:s}=e;let n=!0;return r&&(n=n&&bM(t,r),n=n&&(!s||wM(t,r))),n}constructor(t,e){const{id:r=Xc("texture"),handle:s,target:n}=e;super(t,{id:r,handle:s}),this.target=n,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then($=>this.initialize(Object.assign({},t,{pixels:$,data:$}))),this;const r=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(r&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:s=null,format:n=6408,border:c=0,recreate:l=!1,parameters:f={},pixelStore:y={},textureUnit:A=void 0}=t;e||(e=s);let{width:T,height:P,dataFormat:L,type:D,compressed:j=!1,mipmaps:X=!0}=t;const{depth:Z=0}=t;return{width:T,height:P,compressed:j,dataFormat:L,type:D}=this._deduceParameters({format:n,type:D,dataFormat:L,compressed:j,data:e,width:T,height:P}),this.width=T,this.height=P,this.depth=Z,this.format=n,this.type=D,this.dataFormat=L,this.border=c,this.textureUnit=A,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),X&&this._isNPOT()&&(di.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),X=!1,this._updateForNPOT(f)),this.mipmaps=X,this.setImageData({data:e,width:T,height:P,depth:Z,format:n,type:D,dataFormat:L,border:c,mipmaps:X,parameters:y,compressed:j}),X&&this.generateMipmap(),this.setParameters(f),l&&(this.data=e),r&&(this._video={video:e,parameters:f,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:r}=this._video;if(r===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:r,mipmaps:s=!1}=t;return r!==this.width||e!==this.height?this.initialize({width:r,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:s}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(di.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),wl(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:r=null,level:s=0,format:n=this.format,border:c=this.border,offset:l=0,parameters:f={}}=t;let{data:y=null,type:A=this.type,width:T=this.width,height:P=this.height,dataFormat:L=this.dataFormat,compressed:D=!1}=t;y||(y=r),{type:A,dataFormat:L,compressed:D,width:T,height:P}=this._deduceParameters({format:n,type:A,dataFormat:L,compressed:D,data:y,width:T,height:P});const{gl:j}=this;j.bindTexture(this.target,this.handle);let X=null;({data:y,dataType:X}=this._getDataType({data:y,compressed:D}));let Z,$=0;if(wl(this.gl,f,()=>{switch(X){case"null":j.texImage2D(e,s,n,T,P,c,L,A,y);break;case"typed-array":j.texImage2D(e,s,n,T,P,c,L,A,y,l);break;case"buffer":Z=vo(j),Z.bindBuffer(35052,y.handle||y),Z.texImage2D(e,s,n,T,P,c,L,A,l),Z.bindBuffer(35052,null);break;case"browser-object":Ki(j)?j.texImage2D(e,s,n,T,P,c,L,A,y):j.texImage2D(e,s,n,L,A,y);break;case"compressed":for(const[ht,_t]of y.entries())j.compressedTexImage2D(e,ht,_t.format,_t.width,_t.height,c,_t.data),$+=_t.levelSize;break;default:ti(!1,"Unknown image data type")}}),X==="compressed")this._trackAllocatedMemory($,"Texture");else if(y&&y.byteLength)this._trackAllocatedMemory(y.byteLength,"Texture");else{const ht=XA[this.dataFormat]||4,_t=ZA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*ht*_t,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:r=null,data:s=null,x:n=0,y:c=0,width:l=this.width,height:f=this.height,level:y=0,format:A=this.format,type:T=this.type,dataFormat:P=this.dataFormat,compressed:L=!1,offset:D=0,border:j=this.border,parameters:X={}}=t;if({type:T,dataFormat:P,compressed:L,width:l,height:f}=this._deduceParameters({format:A,type:T,dataFormat:P,compressed:L,data:s,width:l,height:f}),ti(this.depth===0,"texSubImage not supported for 3D textures"),s||(s=r),s&&s.data){const Z=s;s=Z.data,l=Z.shape[0],f=Z.shape[1]}s instanceof Hr&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),wl(this.gl,X,()=>{if(L)this.gl.compressedTexSubImage2D(e,y,n,c,l,f,A,s);else if(s===null)this.gl.texSubImage2D(e,y,n,c,l,f,P,T,null);else if(ArrayBuffer.isView(s))this.gl.texSubImage2D(e,y,n,c,l,f,P,T,s,D);else if(s instanceof Y2){const Z=vo(this.gl);Z.bindBuffer(35052,s),Z.texSubImage2D(e,y,n,c,l,f,P,T,D),Z.bindBuffer(35052,null)}else Ki(this.gl)?vo(this.gl).texSubImage2D(e,y,n,c,l,f,P,T,s):this.gl.texSubImage2D(e,y,n,c,P,T,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return di.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:r=!1}=t;return r?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Hr?{data:e.handle,dataType:"buffer"}:e instanceof Y2?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:r}=t;let{width:s,height:n,dataFormat:c,type:l,compressed:f}=t;const y=I_[e];return c=c||y&&y.dataFormat,l=l||y&&y.types[0],f=f||y&&y.compressed,{width:s,height:n}=this._deduceImageSize(r,s,n),{dataFormat:c,type:l,compressed:f,width:s,height:n,format:e,data:r}}_deduceImageSize(t,e,r){let s;return typeof ImageData<"u"&&t instanceof ImageData?s={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?s={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?s={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?s={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?s={width:t.videoWidth,height:t.videoHeight}:t?s={width:e,height:r}:s={width:e>=0?e:1,height:r>=0?r:1},ti(s,"Could not deduced texture size"),ti(e===void 0||s.width===e,"Deduced texture width does not match supplied width"),ti(r===void 0||s.height===r,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:ti(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Ki(this.gl)||!this.width||!this.height?!1:!Z2(this.width)||!Z2(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:xM.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let AM="";function SM(i,t){return ti(typeof i=="string"),i=AM+i,new Promise((e,r)=>{try{const s=new Image;s.onload=()=>e(s),s.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),s.crossOrigin=t&&t.crossOrigin||"anonymous",s.src=i}catch(s){r(s)}})}class xa extends Ud{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return Ud.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Om(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:SM(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const p1=[34069,34070,34071,34072,34073,34074];class $A extends Ud{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Om(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:r={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(r)}),this}subImage(t){let{face:e,data:r,x:s=0,y:n=0,mipmapLevel:c=0}=t;return this._subImage({target:e,data:r,x:s,y:n,mipmapLevel:c})}async setCubeMapImageData(t){let{width:e,height:r,pixels:s,data:n,border:c=0,format:l=6408,type:f=5121}=t;const{gl:y}=this,A=s||n,T=await Promise.all(p1.map(P=>{const L=A[P];return Promise.all(Array.isArray(L)?L:[L])}));this.bind(),p1.forEach((P,L)=>{T[L].length>1&&this.opts.mipmaps!==!1&&di.warn("".concat(this.id," has mipmap and multiple LODs."))(),T[L].forEach((D,j)=>{e&&r?y.texImage2D(P,j,l,e,r,c,l,f,D):y.texImage2D(P,j,l,l,f,D)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:r,height:s,pixels:n,data:c,border:l=0,format:f=6408,type:y=5121}=t,{gl:A}=this,T=n||c;return this.bind(),T instanceof Promise?T.then(P=>this.setImageDataForFace(Object.assign({},t,{face:e,data:P,pixels:P}))):this.width||this.height?A.texImage2D(e,0,f,r,s,l,f,y,T):A.texImage2D(e,0,f,f,y,T),this}}$A.FACES=p1;class EM extends Ud{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return Ki(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vo(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:r=6408,width:s,height:n,depth:c=1,border:l=0,format:f,type:y=5121,offset:A=0,data:T,parameters:P={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),wl(this.gl,P,()=>{ArrayBuffer.isView(T)&&this.gl.texImage3D(this.target,e,r,s,n,c,l,f,y,T),T instanceof Hr&&(this.gl.bindBuffer(35052,T.handle),this.gl.texImage3D(this.target,e,r,s,n,c,l,f,y,A))}),T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{const L=XA[this.dataFormat]||4,D=ZA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*L*D,"Texture")}return this.loaded=!0,this}}const fu="EXT_color_buffer_float",K2={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:fu,bpp:2},33327:{gl2:fu,bpp:4},34842:{gl2:fu,bpp:8},33326:{gl2:fu,bpp:4},33328:{gl2:fu,bpp:8},34836:{gl2:fu,bpp:16},35898:{gl2:fu,bpp:4}};function CM(i,t,e){const r=e[t];if(!r)return!1;const s=Ki(i)&&r.gl2||r.gl1;return typeof s=="string"?i.getExtension(s):s}class xd extends Yc{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||CM(t,e,K2)}static getSamplesForFormat(t,e){let{format:r}=e;return t.getInternalformatParameter(36161,r,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:r=1,height:s=1,samples:n=0}=t;return ti(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),n!==0&&Ki(this.gl)?this.gl.renderbufferStorageMultisample(36161,n,e,r,s):this.gl.renderbufferStorage(36161,e,r,s),this.format=e,this.width=r,this.height=s,this.samples=n,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*K2[this.format].bpp),this}resize(t){let{width:e,height:r}=t;return e!==this.width||r!==this.height?this.initialize({width:e,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const TM=256,PM=1024,IM=16384,Q2=6144,tw=6145,ew=6146,iw=34041,YA="clear: bad arguments";function L_(i){let{framebuffer:t=null,color:e=null,depth:r=null,stencil:s=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};t&&(n.framebuffer=t);let c=0;e&&(c|=IM,e!==!0&&(n.clearColor=e)),r&&(c|=TM,r!==!0&&(n.clearDepth=r)),s&&(c|=PM,r!==!0&&(n.clearStencil=r)),ti(c!==0,YA),wl(i,n,()=>{i.clear(c)})}function LM(i){let{framebuffer:t=null,buffer:e=Q2,drawBuffer:r=0,value:s=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vo(i),wl(i,{framebuffer:t},()=>{switch(e){case Q2:switch(s.constructor){case Int32Array:i.clearBufferiv(e,r,s);break;case Uint32Array:i.clearBufferuiv(e,r,s);break;case Float32Array:default:i.clearBufferfv(e,r,s)}break;case tw:i.clearBufferfv(tw,0,[s]);break;case ew:i.clearBufferiv(ew,0,[s]);break;case iw:const[n,c]=s;i.clearBufferfi(iw,0,n,c);break;default:ti(!1,YA)}})}function MM(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ti(!1),0}}function Fm(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:r=0,sourceFormat:s=6408}=t;let{sourceAttachment:n=36064,target:c=null,sourceWidth:l,sourceHeight:f,sourceType:y}=t;const{framebuffer:A,deleteFramebuffer:T}=BM(i);ti(A);const{gl:P,handle:L,attachments:D}=A;l=l||A.width,f=f||A.height,n===36064&&L===null&&(n=1028),ti(D[n]),y=y||D[n].type,c=RM(c,y,s,l,f),y=y||u1(c);const j=P.bindFramebuffer(36160,L);return P.readPixels(e,r,l,f,s,y,c),P.bindFramebuffer(36160,j||null),T&&A.delete(),c}function rw(i){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Fm(i,{sourceAttachment:t}),{width:s,height:n}=i;for(;n>e;)({data:r,width:s,height:n}=gM({data:r,width:s,height:n}));fM({data:r,width:s,height:n});const c=document.createElement("canvas");c.width=s,c.height=n;const l=c.getContext("2d"),f=l.createImageData(s,n);return f.data.set(r),l.putImageData(f,0,0),c.toDataURL()}function BM(i){return i instanceof Ks?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:GM(i),deleteFramebuffer:!0}}function RM(i,t,e,r,s){if(i)return i;t=t||5121;const n=nf(t,{clamped:!1}),c=MM(e);return new n(r*s*c)}const is={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function kM(i){const t=new xa(i,{format:6408,type:5126,dataFormat:6408}),e=new Ks(i,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),r=e.getStatus();return t.delete(),e.delete(),r===36053}const KA={[is.WEBGL2]:[!1,!0],[is.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[is.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[is.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[is.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[is.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[is.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[is.FLOAT_BLEND]:["EXT_float_blend"],[is.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[is.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[is.TEXTURE_FLOAT]:["OES_texture_float",!0],[is.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[is.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[is.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[is.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[is.COLOR_ATTACHMENT_RGBA32F]:[kM,"EXT_color_buffer_float"],[is.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[is.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[is.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[is.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[is.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[is.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},OM=2;function M_(i,t){return QA(i,t)}function QA(i,t){return t=Array.isArray(t)?t:[t],t.every(e=>t3(i,e))}function FM(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const t in KA)i.luma.caps[t]===void 0&&(i.luma.caps[t]=t3(i,t));return i.luma.caps}function t3(i,t){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[t]===void 0&&(i.luma.caps[t]=NM(i,t)),i.luma.caps[t]||di.log(OM,"Feature: ".concat(t," not supported"))(),i.luma.caps[t]}function NM(i,t){const e=KA[t];ti(e,t);let r;const s=Ki(i)&&e[1]||e[0];if(typeof s=="function")r=s(i);else if(Array.isArray(s)){r=!0;for(const n of s)r=r&&!!i.getExtension(n)}else typeof s=="string"?r=!!i.getExtension(s):typeof s=="boolean"?r=s:ti(!1);return r}const sw="Multiple render targets not supported";class Ks extends Yc{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:s}=e;let n=!0;return r&&(n=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),s&&(n=n&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),n}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new Ks(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=vo(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=vo(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:r=1,attachments:s=null,color:n=!0,depth:c=!0,stencil:l=!1,check:f=!0,readBuffer:y=void 0,drawBuffers:A=void 0}=t;if(ti(e>=0&&r>=0,"Width and height need to be integers"),this.width=e,this.height=r,s)for(const T in s){const P=s[T];(Array.isArray(P)?P[0]:P).resize({width:e,height:r})}else s=this._createDefaultAttachments(n,c,l,e,r);this.update({clearAttachments:!0,attachments:s,readBuffer:y,drawBuffers:A}),s&&f&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:r,drawBuffers:s,clearAttachments:n=!1,resizeAttachments:c=!0}=t;this.attach(e,{clearAttachments:n,resizeAttachments:c});const{gl:l}=this,f=l.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),s&&this._setDrawBuffers(s),l.bindFramebuffer(36160,f||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:r}=t;if(this.handle===null)return ti(e===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),e!==this.width&&r!==this.height&&di.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(r))();for(const s in this.attachments)this.attachments[s].resize({width:e,height:r});return this.width=e,this.height=r,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&Object.keys(this.attachments).forEach(c=>{s[c]=null}),Object.assign(s,t);const n=this.gl.bindFramebuffer(36160,this.handle);for(const c in s){ti(c!==void 0,"Misspelled framebuffer binding point?");const l=Number(c),f=s[l];let y=f;if(!y)this._unattach(l);else if(y instanceof xd)this._attachRenderbuffer({attachment:l,renderbuffer:y});else if(Array.isArray(f)){const[A,T=0,P=0]=f;y=A,this._attachTexture({attachment:l,texture:A,layer:T,level:P})}else this._attachTexture({attachment:l,texture:y,layer:0,level:0});r&&y&&y.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,n||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(c=>!this.attachments[c]).forEach(c=>{delete this.attachments[c]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(zM(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),r=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),r}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:r,stencil:s,drawBuffers:n=[]}=t,c=this.gl.bindFramebuffer(36160,this.handle);return(e||r||s)&&L_(this.gl,{color:e,depth:r,stencil:s}),n.forEach((l,f)=>{LM(this.gl,{drawBuffer:f,value:l})}),this.gl.bindFramebuffer(36160,c||null),this}readPixels(){return di.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return di.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return di.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return di.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return di.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return di.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:r=0,y:s=0,width:n,height:c}=t;const l=vo(this.gl),f=l.bindFramebuffer(36008,this.handle);return r===0&&s===0&&n===void 0&&c===void 0?l.invalidateFramebuffer(36008,e):l.invalidateFramebuffer(36008,e,r,s,n,c),l.bindFramebuffer(36008,f),this}getAttachmentParameter(t,e,r){let s=this._getAttachmentParameterFallback(e);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),r&&s>1e3&&(s=Vh(this.gl,s)),s}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const s={};for(const n of r){const c=e?Vh(this.gl,n):n;s[c]=this.getAttachmentParameter(t,n,e)}return s}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),r={};for(const s of e){const n=Number(s),c=t?Vh(this.gl,n):n;r[c]=this.getAttachmentParameters(n,t)}return r}show(){return typeof window<"u"&&window.open(rw(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>di.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const r=rw(this,{targetMaxHeight:100});return di.image({logLevel:t,message:e,image:r},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,r,s,n){let c=null;return t&&(c=c||{},c[36064]=new xa(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:s,height:n,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(c[36064])),e&&r?(c=c||{},c[33306]=new xd(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:s,height:111}),this.ownResources.push(c[33306])):e?(c=c||{},c[36096]=new xd(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:s,height:n}),this.ownResources.push(c[36096])):r&&ti(!1),c}_unattach(t){const e=this.attachments[t];e&&(e instanceof xd?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:r}=t;const{gl:s}=this;s.framebufferRenderbuffer(36160,e,36161,r.handle),this.attachments[e]=r}_attachTexture(t){let{attachment:e=36064,texture:r,layer:s,level:n}=t;const{gl:c}=this;switch(c.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:vo(c).framebufferTextureLayer(36160,e,r.target,n,s);break;case 34067:const l=DM(s);c.framebufferTexture2D(36160,e,l,r.handle,n);break;case 3553:c.framebufferTexture2D(36160,e,3553,r.handle,n);break;default:ti(!1,"Illegal texture type")}c.bindTexture(r.target,null),this.attachments[e]=r}_setReadBuffer(t){const e=f4(this.gl);e?e.readBuffer(t):ti(t===36064||t===1029,sw),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,r=vo(e);if(r)r.drawBuffers(t);else{const s=e.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(t):ti(t.length===1&&(t[0]===36064||t[0]===1029),sw)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=FM(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function DM(i){return i<34069?i+34069:i}function zM(i){return(Ks.STATUS||{})[i]||"Framebuffer error ".concat(i)}const UM=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ks.ATTACHMENT_PARAMETERS=UM;function jM(i,t){ti(i instanceof xa||i instanceof $A||i instanceof EM);const e=i.constructor,{gl:r,width:s,height:n,format:c,type:l,dataFormat:f,border:y,mipmaps:A}=i,T=Object.assign({width:s,height:n,format:c,type:l,dataFormat:f,border:y,mipmaps:A},t);return new e(r,T)}function GM(i,t){const{gl:e,width:r,height:s,id:n}=i;return new Ks(e,Object.assign({},t,{id:"framebuffer-for-".concat(n),width:r,height:s,attachments:{36064:i}}))}function Vg(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(e);return r?r[1]:t}const VM=35632,qM=35633;function HM(i){switch(i){case VM:return"fragment";case qM:return"vertex";default:return"unknown type"}}function WM(i,t,e,r){const s=i.split(/\r?\n/),n={},c={},l=r||Vg(t)||"(unnamed)",f="".concat(HM(e)," shader ").concat(l);for(let A=0;A<s.length;A++){const T=s[A];if(T.length<=1)continue;const P=T.split(":"),L=P[0],D=parseInt(P[2],10);if(isNaN(D))throw new Error("GLSL compilation error in ".concat(f,": ").concat(i));L!=="WARNING"?n[D]=T:c[D]=T}const y=JM(t);return{shaderName:f,errors:nw(n,y),warnings:nw(c,y)}}function nw(i,t){let e="";for(let r=0;r<t.length;r++){const s=t[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(e+="".concat(s,`
`),i[r+1])){const n=i[r+1],c=n.split(":",3),l=c[0],f=parseInt(c[1],10)||0,y=n.substring(c.join(":").length+1).trim();e+=e3("^^^ ".concat(l,": ").concat(y,`

`),f)}}return e}function JM(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),s=String(r.length+t-1).length;return r.map((n,c)=>{const l=String(c+t),f=l.length;return e3(l,s-f)+e+n})}function e3(i,t){let e="";for(let r=0;r<t;++r)e+=" ";return"".concat(e).concat(i)}function i3(i){let t=100;const e=i.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const r=parseInt(e[1],10);Number.isFinite(r)&&(t=r)}return t}const XM="Shader: GLSL source code must be a JavaScript string";class of extends Yc{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ti(!1),"unknown"}}constructor(t,e){Om(t),ti(typeof e.source=="string",XM);const r=Vg(e.source,null)||e.id||Xc("unnamed ".concat(of.getTypeName(e.shaderType)));super(t,{id:r}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const r=Vg(e,null);r&&(this.id=Xc(r)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(of.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Vg(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:n}=WM(e,this.source,this.shaderType,this.id);throw di.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),di.warn("GLSL compilation warnings in ".concat(r,`
`).concat(n))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Q0 extends of{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class ty extends of{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const ZM={5126:os.bind(null,"uniform1fv",fa,1,Vn),35664:os.bind(null,"uniform2fv",fa,2,Vn),35665:os.bind(null,"uniform3fv",fa,3,Vn),35666:os.bind(null,"uniform4fv",fa,4,Vn),5124:os.bind(null,"uniform1iv",Lh,1,Vn),35667:os.bind(null,"uniform2iv",Lh,2,Vn),35668:os.bind(null,"uniform3iv",Lh,3,Vn),35669:os.bind(null,"uniform4iv",Lh,4,Vn),35670:os.bind(null,"uniform1iv",Lh,1,Vn),35671:os.bind(null,"uniform2iv",Lh,2,Vn),35672:os.bind(null,"uniform3iv",Lh,3,Vn),35673:os.bind(null,"uniform4iv",Lh,4,Vn),35674:os.bind(null,"uniformMatrix2fv",fa,4,Oc),35675:os.bind(null,"uniformMatrix3fv",fa,9,Oc),35676:os.bind(null,"uniformMatrix4fv",fa,16,Oc),35678:Tn,35680:Tn,5125:os.bind(null,"uniform1uiv",dg,1,Vn),36294:os.bind(null,"uniform2uiv",dg,2,Vn),36295:os.bind(null,"uniform3uiv",dg,3,Vn),36296:os.bind(null,"uniform4uiv",dg,4,Vn),35685:os.bind(null,"uniformMatrix2x3fv",fa,6,Oc),35686:os.bind(null,"uniformMatrix2x4fv",fa,8,Oc),35687:os.bind(null,"uniformMatrix3x2fv",fa,6,Oc),35688:os.bind(null,"uniformMatrix3x4fv",fa,12,Oc),35689:os.bind(null,"uniformMatrix4x2fv",fa,8,Oc),35690:os.bind(null,"uniformMatrix4x3fv",fa,12,Oc),35678:Tn,35680:Tn,35679:Tn,35682:Tn,36289:Tn,36292:Tn,36293:Tn,36298:Tn,36299:Tn,36300:Tn,36303:Tn,36306:Tn,36307:Tn,36308:Tn,36311:Tn},$M={},YM={},KM={},ow=[0];function B_(i,t,e,r){t===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(ow[0]=i,i=ow);const s=i.length;if(s%t&&di.warn("Uniform size should be multiples of ".concat(t),i)(),i instanceof e)return i;let n=r[s];n||(n=new e(s),r[s]=n);for(let c=0;c<s;c++)n[c]=i[c];return n}function fa(i,t){return B_(i,t,Float32Array,$M)}function Lh(i,t){return B_(i,t,Int32Array,YM)}function dg(i,t){return B_(i,t,Uint32Array,KM)}function aw(i,t,e){const r=ZM[e.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(e.type));return r().bind(null,i,t)}function QM(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=i.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:e[1],length:e[2]||1,isArray:!!e[2]}}function tB(i,t,e){for(const r in i){const s=i[r];if((!e||e[r])&&!eB(s))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(r),s),new Error("".concat(t," Bad uniform ").concat(r))}return!0}function eB(i){return Array.isArray(i)||ArrayBuffer.isView(i)?rB(i):isFinite(i)||i===!0||i===!1||i instanceof Ud||i instanceof xd?!0:i instanceof Ks?!!i.texture:!1}function iB(i,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(i[t]){const r=i[t];for(let s=0,n=e.length;s<n;++s)r[s]=e[s]}else i[t]=e.slice();else i[t]=e}function rB(i){if(i.length===0)return!1;const t=Math.min(i.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(i[e]))return!1;return!0}function Tn(){let i=null;return(t,e,r)=>{const s=i!==r;return s&&(t.uniform1i(e,r),i=r),s}}function os(i,t,e,r){let s=null,n=null;return(c,l,f)=>{const y=t(f,e),A=y.length;let T=!1;if(s===null)s=new Float32Array(A),n=A,T=!0;else{ti(n===A,"Uniform length cannot change.");for(let P=0;P<A;++P)if(y[P]!==s[P]){T=!0;break}}return T&&(r(c,i,l,y),s.set(y)),T}}function Vn(i,t,e,r){i[t](e,r)}function Oc(i,t,e,r){i[t](e,!1,r)}const sB=5120,nB=5121,oB=5122,aB=5123,lw=0,pg=1,lB=2,cB=3,fg=4,hB=5,uB=6,$s=5126,dB=35664,pB=35665,fB=35666,Ip=5124,gB=35667,mB=35668,yB=35669,Lp=5125,_B=36294,vB=36295,bB=36296,wB=35670,xB=35671,AB=35672,SB=35673,EB=35674,CB=35675,TB=35676,PB=35685,IB=35686,LB=35687,MB=35688,BB=35689,RB=35690,f1={[$s]:[$s,1,"float"],[dB]:[$s,2,"vec2"],[pB]:[$s,3,"vec3"],[fB]:[$s,4,"vec4"],[Ip]:[Ip,1,"int"],[gB]:[Ip,2,"ivec2"],[mB]:[Ip,3,"ivec3"],[yB]:[Ip,4,"ivec4"],[Lp]:[Lp,1,"uint"],[_B]:[Lp,2,"uvec2"],[vB]:[Lp,3,"uvec3"],[bB]:[Lp,4,"uvec4"],[wB]:[$s,1,"bool"],[xB]:[$s,2,"bvec2"],[AB]:[$s,3,"bvec3"],[SB]:[$s,4,"bvec4"],[EB]:[$s,8,"mat2"],[PB]:[$s,8,"mat2x3"],[IB]:[$s,8,"mat2x4"],[CB]:[$s,12,"mat3"],[LB]:[$s,12,"mat3x2"],[MB]:[$s,12,"mat3x4"],[TB]:[$s,16,"mat4"],[BB]:[$s,16,"mat4x2"],[RB]:[$s,16,"mat4x3"]};function kB(i){switch(i){case lw:return lw;case pg:return pg;case cB:return pg;case lB:return pg;case fg:return fg;case hB:return fg;case uB:return fg;default:return ti(!1),0}}function cw(i){const t=f1[i];if(!t)return null;const[e,r]=t;return{type:e,components:r}}function r3(i,t){switch(i){case sB:case nB:case oB:case aB:i=$s;break}for(const e in f1){const[r,s,n]=f1[e];if(r===i&&s===t)return{glType:e,name:n}}return null}class OB{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,r=e.getProgramParameter(t.handle,35721);for(let s=0;s<r;s++){const{name:n,type:c,size:l}=e.getActiveAttrib(t.handle,s),f=e.getAttribLocation(t.handle,n);f>=0&&this._addAttribute(f,n,c,l)}this.attributeInfos.sort((s,n)=>s.location-n.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!Ki(e))return;const r=e.getProgramParameter(t.handle,35971);for(let s=0;s<r;s++){const{name:n,type:c,size:l}=e.getTransformFeedbackVarying(t.handle,s);this._addVarying(s,n,c,l)}this.varyingInfos.sort((s,n)=>s.location-n.location)}_addAttribute(t,e,r,s){const{type:n,components:c}=cw(r),l={type:n,size:s*c};this._inferProperties(t,e,l);const f={location:t,name:e,accessor:new zo(l)};this.attributeInfos.push(f),this.attributeInfosByLocation[t]=f,this.attributeInfosByName[f.name]=f}_inferProperties(t,e,r){/instance/i.test(e)&&(r.divisor=1)}_addVarying(t,e,r,s){const{type:n,components:c}=cw(r),l=new zo({type:n,size:s*c}),f={location:t,name:e,accessor:l};this.varyingInfos.push(f),this.varyingInfosByName[f.name]=f}}const hw=4,FB=35981,NB=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class s3 extends Yc{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",NB),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:r,fs:s,varyings:n,bufferMode:c=FB}=t;return this.hash=e||"",this.vs=typeof r=="string"?new Q0(this.gl,{id:"".concat(t.id,"-vs"),source:r}):r,this.fs=typeof s=="string"?new ty(this.gl,{id:"".concat(t.id,"-fs"),source:s}):s,ti(this.vs instanceof Q0),ti(this.fs instanceof ty),this.uniforms={},this._textureUniforms={},n&&n.length>0&&(vo(this.gl),this.varyings=n,this.gl2.transformFeedbackVaryings(this.handle,n,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new OB(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:r=4,vertexCount:s,offset:n=0,start:c,end:l,isIndexed:f=!1,indexType:y=5123,instanceCount:A=0,isInstanced:T=A>0,vertexArray:P=null,transformFeedback:L,framebuffer:D,parameters:j={},uniforms:X,samplers:Z}=t;if((X||Z)&&(di.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(X||{})),di.priority>=e){const $=D?D.id:"default",ht="mode=".concat(Vh(this.gl,r)," verts=").concat(s," ")+"instances=".concat(A," indexType=").concat(Vh(this.gl,y)," ")+"isInstanced=".concat(T," isIndexed=").concat(f," ")+"Framebuffer=".concat($);di.log(e,ht)()}return ti(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||s===0||T&&A===0?!1:(P.bindForDraw(s,A,()=>{if(D!==void 0&&(j=Object.assign({},j,{framebuffer:D})),L){const $=kB(r);L.begin($)}this._bindTextures(),wl(this.gl,j,()=>{f&&T?this.gl2.drawElementsInstanced(r,s,y,n,A):f&&Ki(this.gl)&&!isNaN(c)&&!isNaN(l)?this.gl2.drawRangeElements(r,c,l,s,y,n):f?this.gl.drawElements(r,s,y,n):T?this.gl2.drawArraysInstanced(r,n,s,A):this.gl.drawArrays(r,n,s)}),L&&L.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};di.priority>=2&&tB(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const r=t[e],s=this._uniformSetters[e];if(s){let n=r,c=!1;if(n instanceof Ks&&(n=n.texture),n instanceof Ud)if(c=this.uniforms[e]!==r,c){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);const l=n,{textureIndex:f}=s;l.bind(f),n=f,this._textureUniforms[e]=l}else n=s.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(s(n)||c)&&iB(this.uniforms,e,r)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const r=this._textureUniforms[e];r.update(),t=t&&r.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),r={};for(const s of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new Q0({handle:s});break;case 35632:r.fs=new ty({handle:s});break}return r}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=Xc(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),di.time(hw,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),di.timeEnd(hw,"linkProgram for ".concat(this._getName()))(),t.debug||di.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const r=this.gl.getActiveUniform(this.handle,e),{name:s}=QM(r.name);let n=t.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=aw(t,n,r),r.size>1)for(let c=0;c<r.size;c++)n=t.getUniformLocation(this.handle,"".concat(s,"[").concat(c,"]")),this._uniformSetters["".concat(s,"[").concat(c,"]")]=aw(t,n,r)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const DB=34918,zB=34919,UB=35007,jB=36795,GB=35976,VB=35887,qB=36202;class fm extends Yc{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=Ki(t),s=QA(t,is.TIMER_QUERY);let n=r||s;for(const c of e)switch(c){case"queries":n=n&&r;break;case"timers":n=n&&s;break;default:ti(!1)}return n}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(UB)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?qB:VB)}beginTransformFeedbackQuery(){return this.begin(GB)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,zB);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(jB)}getResult(){return this.gl2.getQueryParameter(this.handle,DB)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((r,s)=>{const n=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):e++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(n)};requestAnimationFrame(n)}),this._pollingPromise}_createHandle(){return fm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class n3 extends Yc{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return Ki(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vo(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,zd(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const r=this._getVaryingIndex(t),{buffer:s,byteSize:n,byteOffset:c}=this._getBufferParams(e);return r<0?(this.unused[t]=s,di.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[r]=e,this.bindOnUse||this._bindBuffer(r,s,c,n),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,r,s;return t instanceof Hr?s=t:(s=t.buffer,r=t.byteSize,e=t.byteOffset),(e!==void 0||r!==void 0)&&(e=e||0,r=r||s.byteLength-e),{buffer:s,byteOffset:e,byteSize:r}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:r,byteOffset:s}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,s,r)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const n=e&&e.handle;return!n||s===void 0?this.gl.bindBufferBase(35982,t,n):this.gl.bindBufferRange(35982,t,n,r,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let gg=null;function HB(i){return(!gg||gg.byteLength<i)&&(gg=new ArrayBuffer(i)),gg}function WB(i,t){const e=HB(i.BYTES_PER_ELEMENT*t);return new i(e,0,t)}function JB(i){let{target:t,source:e,start:r=0,count:s=1}=i;const n=e.length,c=s*n;let l=0;for(let f=r;l<n;l++)t[f++]=e[l];for(;l<c;)l<c-l?(t.copyWithin(r+l,r,r+l),l*=2):(t.copyWithin(r+l,r,r+c-l),l=c);return t}const XB="elements must be GL.ELEMENT_ARRAY_BUFFER";class _a extends Yc{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Ki(t)||CA()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new _a(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return _a.MAX_ATTRIBUTES=_a.MAX_ATTRIBUTES||t.getParameter(34921),_a.MAX_ATTRIBUTES}static setConstant(t,e,r){switch(r.constructor){case Float32Array:_a._setConstantFloatArray(t,e,r);break;case Int32Array:_a._setConstantIntArray(t,e,r);break;case Uint32Array:_a._setConstantUintArray(t,e,r);break;default:ti(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return _a.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ti(!t||t.target===34963,XB),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,r){if(e.target===34963)return this.setElementBuffer(e,r);const{size:s,type:n,stride:c,offset:l,normalized:f,integer:y,divisor:A}=r,{gl:T,gl2:P}=this;return t=Number(t),this.bind(()=>{T.bindBuffer(34962,e.handle),y?(ti(Ki(T)),P.vertexAttribIPointer(t,s,n,c,l)):T.vertexAttribPointer(t,s,n,f,c,l),T.enableVertexAttribArray(t),P.vertexAttribDivisor(t,A||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!_a.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const r=this._normalizeConstantArrayValue(e),s=r.byteLength*t,n=r.length*t;let c=!this.buffer;if(this.buffer=this.buffer||new Hr(this.gl,s),c=c||this.buffer.reallocate(s),c=c||!this._compareConstantArrayValues(r,this.bufferValue),c){const l=WB(e.constructor,n);JB({target:l,source:r,start:0,count:n}),this.buffer.subData(l),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}static _setConstantFloatArray(t,e,r){switch(r.length){case 1:t.vertexAttrib1fv(e,r);break;case 2:t.vertexAttrib2fv(e,r);break;case 3:t.vertexAttrib3fv(e,r);break;case 4:t.vertexAttrib4fv(e,r);break;default:ti(!1)}}static _setConstantIntArray(t,e,r){switch(ti(Ki(t)),r.length){case 1:t.vertexAttribI1iv(e,r);break;case 2:t.vertexAttribI2iv(e,r);break;case 3:t.vertexAttribI3iv(e,r);break;case 4:t.vertexAttribI4iv(e,r);break;default:ti(!1)}}static _setConstantUintArray(t,e,r){switch(ti(Ki(t)),r.length){case 1:t.vertexAttribI1uiv(e,r);break;case 2:t.vertexAttribI2uiv(e,r);break;case 3:t.vertexAttribI3uiv(e,r);break;case 4:t.vertexAttribI4uiv(e,r);break;default:ti(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:r}=e;return ti(Number.isFinite(r)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(r,t);default:return this.gl.getVertexAttrib(r,t)}})}}const ZB="VertexArray: attributes must be Buffers or constants (i.e. typed array)",$B=/^(.+)__LOCATION_([0-9]+)$/,YB=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class KB{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=e.id||e.program&&e.program.id;this.id=r,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new _a(t),WA(this,"VertexArray","v6.0",YB),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const r=t[e];this._setAttribute(e,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,r);const{location:s,accessor:n}=this._resolveLocationAndAccessor(t,e,e.accessor,r);return s>=0&&(this.values[s]=e,this.accessors[s]=n,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,e,n)),this}setConstant(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:s,accessor:n}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},r));return s>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[s]=e,this.accessors[s]=n,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Hr(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof Hr&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof Hr&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,r){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),s=r()}),s}_resolveLocationAndAccessor(t,e,r,s){const n={location:-1,accessor:null},{location:c,name:l}=this._getAttributeIndex(t);if(!Number.isFinite(c)||c<0)return this.unused[t]=e,di.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),n;const f=this._getAttributeInfo(l||c);if(!f)return n;const y=this.accessors[c]||{},A=zo.resolve(f.accessor,y,r,s),{size:T,type:P}=A;return ti(Number.isFinite(T)&&Number.isFinite(P)),{location:c,accessor:A}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const r=$B.exec(t),s=r?r[1]:t,n=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+n,name:s}:{location:-1}}_setAttribute(t,e){if(e instanceof Hr)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof Hr){const r=e[0],s=e[1];this.setBuffer(t,r,s)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const r=e;this.setConstant(t,r)}else if(e.buffer instanceof Hr){const r=e;this.setBuffer(t,r.buffer,r)}else throw new Error(ZB)}_setConstantAttributes(t,e){const r=Math.max(t|0,e|0);let s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,r);for(let n=1;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)s=this.values[n],ArrayBuffer.isView(s)&&this._setConstantAttribute(n,s)}_setConstantAttributeZero(t,e){if(_a.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const r=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(t,e){_a.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const r=this.values[e],s=this.accessors[e];if(!r)return;const{divisor:n}=s,c=n>0;if(t.isInstanced=t.isInstanced||c,r instanceof Hr){const l=r;if(c){const f=l.getVertexCount(s);t.instanceCount=Math.min(t.instanceCount,f)}else{const f=l.getVertexCount(s);t.vertexCount=Math.min(t.vertexCount,f)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return di.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function QB(i,t){const{maxElts:e=16,size:r=1}=t;let s="[";for(let c=0;c<i.length&&c<e;++c)c>0&&(s+=",".concat(c%r===0?" ":"")),s+=af(i[c],t);const n=i.length>e?"...":"]";return"".concat(s).concat(n)}function af(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:r=!1}=t;if(Array.isArray(i)||ArrayBuffer.isView(i))return QB(i,t);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<e)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const s=i.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function uw(i){let{header:t="Uniforms",program:e,uniforms:r,undefinedOnly:s=!1}=i;ti(e);const n=".*_.*",c=".*Matrix",l=e._uniformSetters,f={},y=Object.keys(l).sort();let A=0;for(const L of y)!L.match(n)&&!L.match(c)&&ey({table:f,header:t,uniforms:r,uniformName:L,undefinedOnly:s})&&A++;for(const L of y)L.match(c)&&ey({table:f,header:t,uniforms:r,uniformName:L,undefinedOnly:s})&&A++;for(const L of y)f[L]||ey({table:f,header:t,uniforms:r,uniformName:L,undefinedOnly:s})&&A++;let T=0;const P={};if(!s)for(const L in r){const D=r[L];f[L]||(T++,P[L]={Type:"NOT USED: ".concat(D),[t]:af(D)})}return{table:f,count:A,unusedTable:P,unusedCount:T}}function ey(i){let{table:t,header:e,uniforms:r,uniformName:s,undefinedOnly:n}=i;const c=r[s],l=t6(c);return!n||!l?(t[s]={[e]:l?af(c):"N/A","Uniform Type":l?c:"NOT PROVIDED"},!0):!1}function t6(i){return i!=null}function e6(i){let{vertexArray:t,header:e="Attributes"}=i;if(!t.configuration)return{};const r={};t.elements&&(r.ELEMENT_ARRAY_BUFFER=dw(t,t.elements,null,e));const s=t.values;for(const n in s){const c=t._getAttributeInfo(n);if(c){let l="".concat(n,": ").concat(c.name);const f=t.accessors[c.location];f&&(l="".concat(n,": ").concat(i6(c.name,f))),r[l]=dw(t,s[n],f,e)}}return r}function dw(i,t,e,r){const{gl:s}=i;if(!t)return{[r]:"null","Format ":"N/A"};let n="NOT PROVIDED",c=1,l=0,f=0,y,A,T;if(e&&(n=e.type,c=e.size,n=String(n).replace("Array",""),y=n.indexOf("nt")!==-1),t instanceof Hr){const P=t,{data:L,changed:D}=P.getDebugData();A=D?"*":"",T=L,f=P.byteLength,l=f/L.BYTES_PER_ELEMENT/c;let j;if(e){const X=e.divisor>0;j="".concat(X?"I ":"P "," ").concat(l," (x").concat(c,"=").concat(f," bytes ").concat(Vh(s,n),")")}else y=!0,j="".concat(f," bytes");return{[r]:"".concat(A).concat(af(T,{size:c,isInteger:y})),"Format ":j}}return T=t,c=t.length,n=String(t.constructor.name).replace("Array",""),y=n.indexOf("nt")!==-1,{[r]:"".concat(af(T,{size:c,isInteger:y})," (constant)"),"Format ":"".concat(c,"x").concat(n," (constant)")}}function i6(i,t){const{type:e,size:r}=t,s=r3(e,r);return s?"".concat(i," (").concat(s.name,")"):i}function r6(i){const t={},e="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const s=pw(r);t["in ".concat(s)]={[e]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const s=pw(r);t["out ".concat(s)]={[e]:JSON.stringify(r.accessor)}}return t}function pw(i){const{type:t,size:e}=i.accessor,r=r3(t,e);return r?"".concat(r.name," ").concat(i.name):i.name}const fw=$c()&&typeof document<"u";let s6=0;class n6{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=X=>HA(X),onAddHTML:r=null,onInitialize:s=()=>{},onRender:n=()=>{},onFinalize:c=()=>{},onError:l,gl:f=null,glOptions:y={},debug:A=!1,createFramebuffer:T=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:L=!0,stats:D=Su.get("animation-loop-".concat(s6++))}=t;let{useDevicePixels:j=!0}=t;"useDevicePixelRatio"in t&&(di.deprecated("useDevicePixelRatio","useDevicePixels")(),j=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:r,onInitialize:s,onRender:n,onFinalize:c,onError:l,gl:f,glOptions:y,debug:A,createFramebuffer:T},this.gl=f,this.needsRedraw=null,this.timeline=null,this.stats=D,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:L,useDevicePixels:j}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return ti(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=fm.isSupported(this.gl,["timers"])?new fm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(t);return r?Number(r.value):e}setViewParameters(){return di.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=fw?new Promise((t,e)=>{if(fw&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):dM(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):uM(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:r}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?P_(this.props.gl,t):this.onCreateContext(t),!km(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");K4(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const r=this.props.onAddHTML(e);r&&(e.innerHTML=r)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let r=1;const{canvas:s}=this.gl;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:t>0&&e>0&&(r=t/e),{width:t,height:e,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&rM(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ks(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const Ef="vs",R_="fs";function wa(i,t){if(!i)throw new Error(t||"shadertools: assertion failed.")}const iy={number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},array:{validate(i,t){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function o6(i){const t={};for(const e in i){const r=i[e],s=a6(r);t[e]=s}return t}function a6(i){let t=gw(i);return t==="object"?i?"type"in i?Object.assign({},i,iy[i.type]):"value"in i?(t=gw(i.value),Object.assign({type:t},i,iy[t])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:t,value:i},iy[t])}function gw(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const l6="vs",c6="fs";class mw{constructor(t){let{name:e,vs:r,fs:s,dependencies:n=[],uniforms:c,getUniforms:l,deprecations:f=[],defines:y={},inject:A={},vertexShader:T,fragmentShader:P}=t;wa(typeof e=="string"),this.name=e,this.vs=r||T,this.fs=s||P,this.getModuleUniforms=l,this.dependencies=n,this.deprecations=this._parseDeprecationDefinitions(f),this.defines=y,this.injections=h6(A),c&&(this.uniforms=o6(c))}getModuleSource(t){let e;switch(t){case l6:e=this.vs||"";break;case c6:e=this.fs||"";break;default:wa(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(r=>{r.regex.test(t)&&(r.deprecated?e.deprecated(r.old,r.new)():e.removed(r.old,r.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},r=this.uniforms;for(const s in r){const n=r[s];s in t&&!n.private?(n.validate&&wa(n.validate(t[s],n),"".concat(this.name,": invalid ").concat(s)),e[s]=t[s]):e[s]=n.value}return e}}function h6(i){const t={vs:{},fs:{}};for(const e in i){let r=i[e];const s=e.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),t[s][e]=r}return t}function u6(i){return d6(a3(i))}function d6(i){const t={},e={};return o3({modules:i,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((r,s)=>e[s]-e[r]).map(r=>t[r])}function o3(i){let{modules:t,level:e,moduleMap:r,moduleDepth:s}=i;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const n of t)r[n.name]=n,(s[n.name]===void 0||s[n.name]<e)&&(s[n.name]=e);for(const n of t)n.dependencies&&o3({modules:n.dependencies,level:e+1,moduleMap:r,moduleDepth:s})}function a3(i,t){return i.map(e=>(e instanceof mw||(wa(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),wa(e.name,"shader module has no name"),e=new mw(e),e.dependencies=a3(e.dependencies)),e))}function p6(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=i.userAgent||t.userAgent||"",r=e.indexOf("MSIE ")!==-1,s=e.indexOf("Trident/")!==-1;return r||s}const f6=7936,g6=7937,m6=7938,y6=35724,k_={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},vu={};Object.keys(k_).forEach(i=>{vu[i]=i});function _6(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function v6(i){const t=i.getExtension("WEBGL_debug_renderer_info"),e=i.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||f6),r=i.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||g6);return{gpuVendor:b6(e,r),vendor:e,renderer:r,version:i.getParameter(m6),shadingLanguageVersion:i.getParameter(y6)}}function b6(i,t){return i.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||t.match(/AMD/i)||i.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const ry={};function yw(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=k_[t];if(wa(r,t),!p6(e))return!0;if(t in ry)return ry[t];const s=r[0],n=e.behavior||"enable",c="#extension GL_".concat(s," : ").concat(n,`
void main(void) {}`),l=i.createShader(35633);i.shaderSource(l,c),i.compileShader(l);const f=i.getShaderParameter(l,35713);return i.deleteShader(l),ry[t]=f,f}function w6(i,t){const e=k_[t];wa(e,t);const r=_6(i)&&e[1]||e[0],s=typeof r=="string"?!!i.getExtension(r):r;return wa(s===!1||s===!0),s}function mg(i,t){return t=Array.isArray(t)?t:[t],t.every(e=>w6(i,e))}function x6(i){switch(v6(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function A6(i,t,e){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return mg(i,vu.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),mg(i,vu.GLSL_DERIVATIVES)&&yw(i,vu.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),mg(i,vu.GLSL_FRAG_DATA)&&yw(i,vu.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),mg(i,vu.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const S6=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,E6=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,C6={[Ef]:S6,[R_]:E6},qg="__LUMA_INJECT_DECLARATIONS__",_w=/void\s+main\s*\([^)]*\)\s*\{\n?/,vw=/}\n?[^{}]*$/,sy=[];function bw(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=t===Ef;for(const n in e){const c=e[n];c.sort((f,y)=>f.order-y.order),sy.length=c.length;for(let f=0,y=c.length;f<y;++f)sy[f]=c[f].injection;const l="".concat(sy.join(`
`),`
`);switch(n){case"vs:#decl":s&&(i=i.replace(qg,l));break;case"vs:#main-start":s&&(i=i.replace(_w,f=>f+l));break;case"vs:#main-end":s&&(i=i.replace(vw,f=>l+f));break;case"fs:#decl":s||(i=i.replace(qg,l));break;case"fs:#main-start":s||(i=i.replace(_w,f=>f+l));break;case"fs:#main-end":s||(i=i.replace(vw,f=>l+f));break;default:i=i.replace(n,f=>f+l)}}return i=i.replace(qg,""),r&&(i=i.replace(/\}\s*$/,n=>n+C6[t])),i}function g1(i){const t={};return wa(Array.isArray(i)&&i.length>1),i.forEach(e=>{for(const r in e)t[r]=t[r]?"".concat(t[r],`
`).concat(e[r]):e[r]}),t}function jd(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const l3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],T6=[...l3,[jd("attribute"),"in $1"],[jd("varying"),"out $1"]],P6=[...l3,[jd("varying"),"in $1"]],c3=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],I6=[...c3,[jd("in"),"attribute $1"],[jd("out"),"varying $1"]],L6=[...c3,[jd("in"),"varying $1"]],m1="gl_FragColor",y1=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,M6=/void\s+main\s*\([^)]*\)\s*\{\n?/;function B6(i,t,e){switch(t){case 300:return e?gm(i,T6):R6(i);case 100:return e?gm(i,I6):k6(i);default:throw new Error("unknown GLSL version ".concat(t))}}function gm(i,t){for(const[e,r]of t)i=i.replace(e,r);return i}function R6(i){i=gm(i,P6);const t=i.match(y1);if(t){const e=t[1];i=i.replace(new RegExp("\\b".concat(m1,"\\b"),"g"),e)}else{const e="fragmentColor";i=i.replace(M6,r=>"out vec4 ".concat(e,`;
`).concat(r)).replace(new RegExp("\\b".concat(m1,"\\b"),"g"),e)}return i}function k6(i){i=gm(i,L6);const t=i.match(y1);if(t){const e=t[1];i=i.replace(y1,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),m1)}return i}const O6=`

`.concat(qg,`

`),h3={[Ef]:"vertex",[R_]:"fragment"},F6=`precision highp float;

`;function N6(i,t){const{vs:e,fs:r}=t,s=u6(t.modules||[]);return{gl:i,vs:ww(i,Object.assign({},t,{source:e,type:Ef,modules:s})),fs:ww(i,Object.assign({},t,{source:r,type:R_,modules:s})),getUniforms:D6(s)}}function ww(i,t){let{id:e,source:r,type:s,modules:n,defines:c={},hookFunctions:l=[],inject:f={},transpileToGLSL100:y=!1,prologue:A=!0,log:T}=t;wa(typeof r=="string","shader source must be a string");const P=s===Ef,L=r.split(`
`);let D=100,j="",X=r;L[0].indexOf("#version ")===0?(D=300,j=L[0],X=L.slice(1).join(`
`)):j="#version ".concat(D);const Z={};n.forEach(Rt=>{Object.assign(Z,Rt.getDefines())}),Object.assign(Z,c);let $=A?"".concat(j,`
`).concat(U6({id:e,source:r,type:s}),`
`).concat(z6({type:s}),`
`).concat(x6(i),`
`).concat(A6(i),`
`).concat(j6(Z),`
`).concat(P?"":F6,`
`):"".concat(j,`
`);const ht=V6(l),_t={},Mt={},Nt={};for(const Rt in f){const xt=typeof f[Rt]=="string"?{injection:f[Rt],order:0}:f[Rt],qt=Rt.match(/^(v|f)s:(#)?([\w-]+)$/);if(qt){const zt=qt[2],ct=qt[3];zt?ct==="decl"?Mt[Rt]=[xt]:Nt[Rt]=[xt]:_t[Rt]=[xt]}else Nt[Rt]=[xt]}for(const Rt of n){T&&Rt.checkDeprecations(X,T);const xt=Rt.getModuleSource(s,D);$+=xt;const qt=Rt.injections[s];for(const zt in qt){const ct=zt.match(/^(v|f)s:#([\w-]+)$/);if(ct){const pt=ct[2]==="decl"?Mt:Nt;pt[zt]=pt[zt]||[],pt[zt].push(qt[zt])}else _t[zt]=_t[zt]||[],_t[zt].push(qt[zt])}}return $+=O6,$=bw($,s,Mt),$+=G6(ht[s],_t),$+=X,$=bw($,s,Nt),$=B6($,y?100:D,P),$}function D6(i){return function(t){const e={};for(const r of i){const s=r.getUniforms(t,e);Object.assign(e,s)}return e}}function z6(i){let{type:t}=i;return`
#define SHADER_TYPE_`.concat(h3[t].toUpperCase(),`
`)}function U6(i){let{id:t,source:e,type:r}=i;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(h3[r],`

`):""}function j6(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const r in i){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const s=i[r];(s||Number.isFinite(s))&&(e+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return t===0&&(e+=`
`),e}function G6(i,t){let e="";for(const r in i){const s=i[r];if(e+="void ".concat(s.signature,` {
`),s.header&&(e+="  ".concat(s.header)),t[r]){const n=t[r];n.sort((c,l)=>c.order-l.order);for(const c of n)e+="  ".concat(c.injection,`
`)}s.footer&&(e+="  ".concat(s.footer)),e+=`}
`}return e}function V6(i){const t={vs:{},fs:{}};return i.forEach(e=>{let r;typeof e!="string"?(r=e,e=r.hook):r={},e=e.trim();const[s,n]=e.split(":"),c=e.replace(/\(.+/,"");t[s][c]=Object.assign(r,{signature:n})}),t}const q6="void main() {gl_FragColor = vec4(0);}",u3=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,H6=`#version 300 es
`.concat(u3);function d3(i,t){t=Array.isArray(t)?t:[t];const e=i.replace(/^\s+/,"").split(/\s+/),[r,s,n]=e;if(!t.includes(r)||!s||!n)return null;const c=n.split(";")[0];return{qualifier:r,type:s,name:c}}function p3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:r,output:s}=i;if(!e)return t===300?H6:t>300?"#version ".concat(t,`
`).concat(u3):q6;const n=X6(e,r);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(r," ").concat(e,`;
out vec4 `).concat(s,`;
void main() {
  `).concat(s," = ").concat(n,`;
}`):"varying ".concat(r," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(n,`;
}`)}function W6(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return wa(!1),null}}function J6(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return wa(!1),null}}function X6(i,t){switch(t){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return wa(!1),null}}const Z6=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,$6={name:"fp32",vs:Z6,fs:null};function _l(i,t){if(!i)throw new Error("math.gl assertion ".concat(t))}const Y6=1/Math.PI*180,K6=1/180*Math.PI,Ys={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Q6(i){let{precision:t=Ys.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=rR(i),"".concat(parseFloat(i.toPrecision(t)))}function Jh(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function tR(i){return iR(i)}function eR(i){return jc(i)}function iR(i,t){return O_(i,e=>e*K6,t)}function jc(i,t){return O_(i,e=>e*Y6,t)}function Gc(i,t,e){return O_(i,r=>Math.max(t,Math.min(e,r)))}function mm(i,t,e){return Jh(i)?i.map((r,s)=>mm(r,t[s],e)):e*t+(1-e)*i}function xl(i,t,e){const r=Ys.EPSILON;e&&(Ys.EPSILON=e);try{if(i===t)return!0;if(Jh(i)&&Jh(t)){if(i.length!==t.length)return!1;for(let s=0;s<i.length;++s)if(!xl(i[s],t[s]))return!1;return!0}return i&&i.equals?i.equals(t):t&&t.equals?t.equals(i):typeof i=="number"&&typeof t=="number"?Math.abs(i-t)<=Ys.EPSILON*Math.max(1,Math.abs(i),Math.abs(t)):!1}finally{Ys.EPSILON=r}}function rR(i){return Math.round(i/Ys.EPSILON)*Ys.EPSILON}function sR(i){return i.clone?i.clone():new Array(i.length)}function O_(i,t,e){if(Jh(i)){const r=i;e=e||sR(r);for(let s=0;s<e.length&&s<r.length;++s)e[s]=t(i[s],s,e);return e}return t(i)}function nR(i){function t(){var e=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i,t}class F_ extends nR(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Jh(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ys)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+Q6(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!xl(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){if(r===void 0)return this.lerp(this,t,e);for(let s=0;s<this.ELEMENTS;++s){const n=t[s];this[s]=n+r*(e[s]-n)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=s[n];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=s[n];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(Ys.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}get elements(){return this}}function oR(i,t){if(i.length!==t)return!1;for(let e=0;e<i.length;++e)if(!Number.isFinite(i[e]))return!1;return!0}function Ir(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function Yp(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(Ys.debug&&!oR(i,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return i}class N_ extends F_{get x(){return this[0]}set x(t){this[0]=Ir(t)}get y(){return this[1]}set y(t){this[1]=Ir(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-t[r];e+=s*s}return Ir(e)}dot(t){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Ir(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=s[n];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=s[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return _l(t>=0&&t<this.ELEMENTS,"index is out of range"),Ir(this[t])}setComponent(t,e){return _l(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var Kp=1e-6,Al=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function aR(){var i=new Al(2);return Al!=Float32Array&&(i[0]=0,i[1]=0),i}function xw(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function lR(i,t){return i[0]=-t[0],i[1]=-t[1],i}function f3(i,t,e,r){var s=t[0],n=t[1];return i[0]=s+r*(e[0]-s),i[1]=n+r*(e[1]-n),i}function cR(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s,i[1]=e[1]*r+e[3]*s,i}function hR(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s+e[4],i[1]=e[1]*r+e[3]*s+e[5],i}function g3(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[3]*s+e[6],i[1]=e[1]*r+e[4]*s+e[7],i}function m3(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[4]*s+e[12],i[1]=e[1]*r+e[5]*s+e[13],i}(function(){var i=aR();return function(t,e,r,s,n,c){var l,f;for(e||(e=2),r||(r=0),s?f=Math.min(s*e+r,t.length):f=t.length,l=r;l<f;l+=e)i[0]=t[l],i[1]=t[l+1],n(i,i,c),t[l]=i[0],t[l+1]=i[1];return t}})();function y3(i,t,e){const r=t[0],s=t[1],n=e[3]*r+e[7]*s||1;return i[0]=(e[0]*r+e[4]*s)/n,i[1]=(e[1]*r+e[5]*s)/n,i}function _3(i,t,e){const r=t[0],s=t[1],n=t[2],c=e[3]*r+e[7]*s+e[11]*n||1;return i[0]=(e[0]*r+e[4]*s+e[8]*n)/c,i[1]=(e[1]*r+e[5]*s+e[9]*n)/c,i[2]=(e[2]*r+e[6]*s+e[10]*n)/c,i}function uR(i,t,e){const r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s,i[1]=e[1]*r+e[3]*s,i[2]=t[2],i}function dR(i,t,e){const r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s,i[1]=e[1]*r+e[3]*s,i[2]=t[2],i[3]=t[3],i}function v3(i,t,e){const r=t[0],s=t[1],n=t[2];return i[0]=e[0]*r+e[3]*s+e[6]*n,i[1]=e[1]*r+e[4]*s+e[7]*n,i[2]=e[2]*r+e[5]*s+e[8]*n,i[3]=t[3],i}class D_ extends N_{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),Jh(t)&&arguments.length===1?this.copy(t):(Ys.debug&&(Ir(t),Ir(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Ys.debug&&(Ir(t.x),Ir(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return m3(this,this,t),this.check()}transformAsVector(t){return y3(this,this,t),this.check()}transformByMatrix3(t){return g3(this,this,t),this.check()}transformByMatrix2x3(t){return hR(this,this,t),this.check()}transformByMatrix2(t){return cR(this,this,t),this.check()}}function b3(){var i=new Al(3);return Al!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function w3(i){var t=i[0],e=i[1],r=i[2];return Math.hypot(t,e,r)}function Aw(i,t,e){var r=new Al(3);return r[0]=i,r[1]=t,r[2]=e,r}function pR(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function fR(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function gR(i,t){var e=t[0],r=t[1],s=t[2],n=e*e+r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i}function z_(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function Hg(i,t,e){var r=t[0],s=t[1],n=t[2],c=e[0],l=e[1],f=e[2];return i[0]=s*f-n*l,i[1]=n*c-r*f,i[2]=r*l-s*c,i}function U_(i,t,e){var r=t[0],s=t[1],n=t[2],c=e[3]*r+e[7]*s+e[11]*n+e[15];return c=c||1,i[0]=(e[0]*r+e[4]*s+e[8]*n+e[12])/c,i[1]=(e[1]*r+e[5]*s+e[9]*n+e[13])/c,i[2]=(e[2]*r+e[6]*s+e[10]*n+e[14])/c,i}function x3(i,t,e){var r=t[0],s=t[1],n=t[2];return i[0]=r*e[0]+s*e[3]+n*e[6],i[1]=r*e[1]+s*e[4]+n*e[7],i[2]=r*e[2]+s*e[5]+n*e[8],i}function A3(i,t,e){var r=e[0],s=e[1],n=e[2],c=e[3],l=t[0],f=t[1],y=t[2],A=s*y-n*f,T=n*l-r*y,P=r*f-s*l,L=s*P-n*T,D=n*A-r*P,j=r*T-s*A,X=c*2;return A*=X,T*=X,P*=X,L*=2,D*=2,j*=2,i[0]=l+A+L,i[1]=f+T+D,i[2]=y+P+j,i}function mR(i,t,e,r){var s=[],n=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i}function yR(i,t,e,r){var s=[],n=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i}function _R(i,t,e,r){var s=[],n=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i}function vR(i,t){var e=i[0],r=i[1],s=i[2],n=t[0],c=t[1],l=t[2],f=Math.sqrt(e*e+r*r+s*s),y=Math.sqrt(n*n+c*c+l*l),A=f*y,T=A&&z_(i,t)/A;return Math.acos(Math.min(Math.max(T,-1),1))}var bR=pR,wR=w3;(function(){var i=b3();return function(t,e,r,s,n,c){var l,f;for(e||(e=3),r||(r=0),s?f=Math.min(s*e+r,t.length):f=t.length,l=r;l<f;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],n(i,i,c),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();const ny=[0,0,0];let yg;class te extends N_{static get ZERO(){return yg||(yg=new te(0,0,0),Object.freeze(yg)),yg}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&Jh(t)?this.copy(t):(Ys.debug&&(Ir(t),Ir(e),Ir(r)),this[0]=t,this[1]=e,this[2]=r)}set(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Ys.debug&&(Ir(t.x),Ir(t.y),Ir(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Ir(t)}angle(t){return vR(this,t)}cross(t){return Hg(this,this,t),this.check()}rotateX(t){let{radians:e,origin:r=ny}=t;return mR(this,this,r,e),this.check()}rotateY(t){let{radians:e,origin:r=ny}=t;return yR(this,this,r,e),this.check()}rotateZ(t){let{radians:e,origin:r=ny}=t;return _R(this,this,r,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return U_(this,this,t),this.check()}transformAsVector(t){return _3(this,this,t),this.check()}transformByMatrix3(t){return x3(this,this,t),this.check()}transformByMatrix2(t){return uR(this,this,t),this.check()}transformByQuaternion(t){return A3(this,this,t),this.check()}}let _g;class j_ extends N_{static get ZERO(){return _g||(_g=new j_(0,0,0,0),Object.freeze(_g)),_g}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),Jh(t)&&arguments.length===1?this.copy(t):(Ys.debug&&(Ir(t),Ir(e),Ir(r),Ir(s)),this[0]=t,this[1]=e,this[2]=r,this[3]=s)}set(t,e,r,s){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Ys.debug&&(Ir(t.x),Ir(t.y),Ir(t.z),Ir(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Ir(t)}get w(){return this[3]}set w(t){this[3]=Ir(t)}transform(t){return U_(this,this,t),this.check()}transformByMatrix3(t){return v3(this,this,t),this.check()}transformByMatrix2(t){return dR(this,this,t),this.check()}transformByQuaternion(t){return A3(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class S3 extends F_{toString(){let t="[";if(Ys.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=Ir(r),this}getColumn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const r=t*this.RANK;for(let s=0;s<this.RANK;++s)e[s]=this[r+s];return e}setColumn(t,e){const r=t*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=e[s];return this}}function xR(){var i=new Al(9);return Al!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function AR(i,t){if(i===t){var e=t[1],r=t[2],s=t[5];i[1]=t[3],i[2]=t[6],i[3]=e,i[5]=t[7],i[6]=r,i[7]=s}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i}function SR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=t[4],l=t[5],f=t[6],y=t[7],A=t[8],T=A*c-l*y,P=-A*n+l*f,L=y*n-c*f,D=e*T+r*P+s*L;return D?(D=1/D,i[0]=T*D,i[1]=(-A*r+s*y)*D,i[2]=(l*r-s*c)*D,i[3]=P*D,i[4]=(A*e-s*f)*D,i[5]=(-l*e+s*n)*D,i[6]=L*D,i[7]=(-y*e+r*f)*D,i[8]=(c*e-r*n)*D,i):null}function ER(i){var t=i[0],e=i[1],r=i[2],s=i[3],n=i[4],c=i[5],l=i[6],f=i[7],y=i[8];return t*(y*n-c*f)+e*(-y*s+c*l)+r*(f*s-n*l)}function Sw(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],A=t[7],T=t[8],P=e[0],L=e[1],D=e[2],j=e[3],X=e[4],Z=e[5],$=e[6],ht=e[7],_t=e[8];return i[0]=P*r+L*c+D*y,i[1]=P*s+L*l+D*A,i[2]=P*n+L*f+D*T,i[3]=j*r+X*c+Z*y,i[4]=j*s+X*l+Z*A,i[5]=j*n+X*f+Z*T,i[6]=$*r+ht*c+_t*y,i[7]=$*s+ht*l+_t*A,i[8]=$*n+ht*f+_t*T,i}function CR(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],A=t[7],T=t[8],P=e[0],L=e[1];return i[0]=r,i[1]=s,i[2]=n,i[3]=c,i[4]=l,i[5]=f,i[6]=P*r+L*c+y,i[7]=P*s+L*l+A,i[8]=P*n+L*f+T,i}function TR(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],A=t[7],T=t[8],P=Math.sin(e),L=Math.cos(e);return i[0]=L*r+P*c,i[1]=L*s+P*l,i[2]=L*n+P*f,i[3]=L*c-P*r,i[4]=L*l-P*s,i[5]=L*f-P*n,i[6]=y,i[7]=A,i[8]=T,i}function Ew(i,t,e){var r=e[0],s=e[1];return i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i[3]=s*t[3],i[4]=s*t[4],i[5]=s*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function PR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e+e,l=r+r,f=s+s,y=e*c,A=r*c,T=r*l,P=s*c,L=s*l,D=s*f,j=n*c,X=n*l,Z=n*f;return i[0]=1-T-D,i[3]=A-Z,i[6]=P+X,i[1]=A+Z,i[4]=1-y-D,i[7]=L-j,i[2]=P-X,i[5]=L+j,i[8]=1-y-T,i}var _1;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(_1||(_1={}));const IR=Object.freeze([1,0,0,0,1,0,0,0,1]);class Is extends S3{static get IDENTITY(){return MR()}static get ZERO(){return LR()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return _1}constructor(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(IR)}fromObject(t){return this.check()}fromQuaternion(t){return PR(this,t),this.check()}set(t,e,r,s,n,c,l,f,y){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this[4]=n,this[5]=c,this[6]=l,this[7]=f,this[8]=y,this.check()}setRowMajor(t,e,r,s,n,c,l,f,y){return this[0]=t,this[1]=s,this[2]=l,this[3]=e,this[4]=n,this[5]=f,this[6]=r,this[7]=c,this[8]=y,this.check()}determinant(){return ER(this)}transpose(){return AR(this,this),this.check()}invert(){return SR(this,this),this.check()}multiplyLeft(t){return Sw(this,t,this),this.check()}multiplyRight(t){return Sw(this,this,t),this.check()}rotate(t){return TR(this,this,t),this.check()}scale(t){return Array.isArray(t)?Ew(this,this,t):Ew(this,this,[t,t]),this.check()}translate(t){return CR(this,this,t),this.check()}transform(t,e){let r;switch(t.length){case 2:r=g3(e||[-0,-0],t,this);break;case 3:r=x3(e||[-0,-0,-0],t,this);break;case 4:r=v3(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Yp(r,t.length),r}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let vg,bg;function LR(){return vg||(vg=new Is([0,0,0,0,0,0,0,0,0]),Object.freeze(vg)),vg}function MR(){return bg||(bg=new Is,Object.freeze(bg)),bg}function BR(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function RR(i,t){if(i===t){var e=t[1],r=t[2],s=t[3],n=t[6],c=t[7],l=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=r,i[9]=n,i[11]=t[14],i[12]=s,i[13]=c,i[14]=l}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function v1(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=t[4],l=t[5],f=t[6],y=t[7],A=t[8],T=t[9],P=t[10],L=t[11],D=t[12],j=t[13],X=t[14],Z=t[15],$=e*l-r*c,ht=e*f-s*c,_t=e*y-n*c,Mt=r*f-s*l,Nt=r*y-n*l,Rt=s*y-n*f,xt=A*j-T*D,qt=A*X-P*D,zt=A*Z-L*D,ct=T*X-P*j,pt=T*Z-L*j,Bt=P*Z-L*X,bt=$*Bt-ht*pt+_t*ct+Mt*zt-Nt*qt+Rt*xt;return bt?(bt=1/bt,i[0]=(l*Bt-f*pt+y*ct)*bt,i[1]=(s*pt-r*Bt-n*ct)*bt,i[2]=(j*Rt-X*Nt+Z*Mt)*bt,i[3]=(P*Nt-T*Rt-L*Mt)*bt,i[4]=(f*zt-c*Bt-y*qt)*bt,i[5]=(e*Bt-s*zt+n*qt)*bt,i[6]=(X*_t-D*Rt-Z*ht)*bt,i[7]=(A*Rt-P*_t+L*ht)*bt,i[8]=(c*pt-l*zt+y*xt)*bt,i[9]=(r*zt-e*pt-n*xt)*bt,i[10]=(D*Nt-j*_t+Z*$)*bt,i[11]=(T*_t-A*Nt-L*$)*bt,i[12]=(l*qt-c*ct-f*xt)*bt,i[13]=(e*ct-r*qt+s*xt)*bt,i[14]=(j*ht-D*Mt-X*$)*bt,i[15]=(A*Mt-T*ht+P*$)*bt,i):null}function kR(i){var t=i[0],e=i[1],r=i[2],s=i[3],n=i[4],c=i[5],l=i[6],f=i[7],y=i[8],A=i[9],T=i[10],P=i[11],L=i[12],D=i[13],j=i[14],X=i[15],Z=t*c-e*n,$=t*l-r*n,ht=t*f-s*n,_t=e*l-r*c,Mt=e*f-s*c,Nt=r*f-s*l,Rt=y*D-A*L,xt=y*j-T*L,qt=y*X-P*L,zt=A*j-T*D,ct=A*X-P*D,pt=T*X-P*j;return Z*pt-$*ct+ht*zt+_t*qt-Mt*xt+Nt*Rt}function Iu(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],A=t[7],T=t[8],P=t[9],L=t[10],D=t[11],j=t[12],X=t[13],Z=t[14],$=t[15],ht=e[0],_t=e[1],Mt=e[2],Nt=e[3];return i[0]=ht*r+_t*l+Mt*T+Nt*j,i[1]=ht*s+_t*f+Mt*P+Nt*X,i[2]=ht*n+_t*y+Mt*L+Nt*Z,i[3]=ht*c+_t*A+Mt*D+Nt*$,ht=e[4],_t=e[5],Mt=e[6],Nt=e[7],i[4]=ht*r+_t*l+Mt*T+Nt*j,i[5]=ht*s+_t*f+Mt*P+Nt*X,i[6]=ht*n+_t*y+Mt*L+Nt*Z,i[7]=ht*c+_t*A+Mt*D+Nt*$,ht=e[8],_t=e[9],Mt=e[10],Nt=e[11],i[8]=ht*r+_t*l+Mt*T+Nt*j,i[9]=ht*s+_t*f+Mt*P+Nt*X,i[10]=ht*n+_t*y+Mt*L+Nt*Z,i[11]=ht*c+_t*A+Mt*D+Nt*$,ht=e[12],_t=e[13],Mt=e[14],Nt=e[15],i[12]=ht*r+_t*l+Mt*T+Nt*j,i[13]=ht*s+_t*f+Mt*P+Nt*X,i[14]=ht*n+_t*y+Mt*L+Nt*Z,i[15]=ht*c+_t*A+Mt*D+Nt*$,i}function ym(i,t,e){var r=e[0],s=e[1],n=e[2],c,l,f,y,A,T,P,L,D,j,X,Z;return t===i?(i[12]=t[0]*r+t[4]*s+t[8]*n+t[12],i[13]=t[1]*r+t[5]*s+t[9]*n+t[13],i[14]=t[2]*r+t[6]*s+t[10]*n+t[14],i[15]=t[3]*r+t[7]*s+t[11]*n+t[15]):(c=t[0],l=t[1],f=t[2],y=t[3],A=t[4],T=t[5],P=t[6],L=t[7],D=t[8],j=t[9],X=t[10],Z=t[11],i[0]=c,i[1]=l,i[2]=f,i[3]=y,i[4]=A,i[5]=T,i[6]=P,i[7]=L,i[8]=D,i[9]=j,i[10]=X,i[11]=Z,i[12]=c*r+A*s+D*n+t[12],i[13]=l*r+T*s+j*n+t[13],i[14]=f*r+P*s+X*n+t[14],i[15]=y*r+L*s+Z*n+t[15]),i}function G_(i,t,e){var r=e[0],s=e[1],n=e[2];return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*n,i[9]=t[9]*n,i[10]=t[10]*n,i[11]=t[11]*n,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function OR(i,t,e,r){var s=r[0],n=r[1],c=r[2],l=Math.hypot(s,n,c),f,y,A,T,P,L,D,j,X,Z,$,ht,_t,Mt,Nt,Rt,xt,qt,zt,ct,pt,Bt,bt,ne;return l<Kp?null:(l=1/l,s*=l,n*=l,c*=l,f=Math.sin(e),y=Math.cos(e),A=1-y,T=t[0],P=t[1],L=t[2],D=t[3],j=t[4],X=t[5],Z=t[6],$=t[7],ht=t[8],_t=t[9],Mt=t[10],Nt=t[11],Rt=s*s*A+y,xt=n*s*A+c*f,qt=c*s*A-n*f,zt=s*n*A-c*f,ct=n*n*A+y,pt=c*n*A+s*f,Bt=s*c*A+n*f,bt=n*c*A-s*f,ne=c*c*A+y,i[0]=T*Rt+j*xt+ht*qt,i[1]=P*Rt+X*xt+_t*qt,i[2]=L*Rt+Z*xt+Mt*qt,i[3]=D*Rt+$*xt+Nt*qt,i[4]=T*zt+j*ct+ht*pt,i[5]=P*zt+X*ct+_t*pt,i[6]=L*zt+Z*ct+Mt*pt,i[7]=D*zt+$*ct+Nt*pt,i[8]=T*Bt+j*bt+ht*ne,i[9]=P*Bt+X*bt+_t*ne,i[10]=L*Bt+Z*bt+Mt*ne,i[11]=D*Bt+$*bt+Nt*ne,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function E3(i,t,e){var r=Math.sin(e),s=Math.cos(e),n=t[4],c=t[5],l=t[6],f=t[7],y=t[8],A=t[9],T=t[10],P=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=n*s+y*r,i[5]=c*s+A*r,i[6]=l*s+T*r,i[7]=f*s+P*r,i[8]=y*s-n*r,i[9]=A*s-c*r,i[10]=T*s-l*r,i[11]=P*s-f*r,i}function FR(i,t,e){var r=Math.sin(e),s=Math.cos(e),n=t[0],c=t[1],l=t[2],f=t[3],y=t[8],A=t[9],T=t[10],P=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=n*s-y*r,i[1]=c*s-A*r,i[2]=l*s-T*r,i[3]=f*s-P*r,i[8]=n*r+y*s,i[9]=c*r+A*s,i[10]=l*r+T*s,i[11]=f*r+P*s,i}function C3(i,t,e){var r=Math.sin(e),s=Math.cos(e),n=t[0],c=t[1],l=t[2],f=t[3],y=t[4],A=t[5],T=t[6],P=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=n*s+y*r,i[1]=c*s+A*r,i[2]=l*s+T*r,i[3]=f*s+P*r,i[4]=y*s-n*r,i[5]=A*s-c*r,i[6]=T*s-l*r,i[7]=P*s-f*r,i}function NR(i,t){var e=t[0],r=t[1],s=t[2],n=t[4],c=t[5],l=t[6],f=t[8],y=t[9],A=t[10];return i[0]=Math.hypot(e,r,s),i[1]=Math.hypot(n,c,l),i[2]=Math.hypot(f,y,A),i}function DR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e+e,l=r+r,f=s+s,y=e*c,A=r*c,T=r*l,P=s*c,L=s*l,D=s*f,j=n*c,X=n*l,Z=n*f;return i[0]=1-T-D,i[1]=A+Z,i[2]=P-X,i[3]=0,i[4]=A-Z,i[5]=1-y-D,i[6]=L+j,i[7]=0,i[8]=P+X,i[9]=L-j,i[10]=1-y-T,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function zR(i,t,e,r,s,n,c){var l=1/(e-t),f=1/(s-r),y=1/(n-c);return i[0]=n*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n*2*f,i[6]=0,i[7]=0,i[8]=(e+t)*l,i[9]=(s+r)*f,i[10]=(c+n)*y,i[11]=-1,i[12]=0,i[13]=0,i[14]=c*n*2*y,i[15]=0,i}function UR(i,t,e,r,s){var n=1/Math.tan(t/2),c;return i[0]=n/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0?(c=1/(r-s),i[10]=(s+r)*c,i[14]=2*s*r*c):(i[10]=-1,i[14]=-2*r),i}var jR=UR;function GR(i,t,e,r,s,n,c){var l=1/(t-e),f=1/(r-s),y=1/(n-c);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*y,i[11]=0,i[12]=(t+e)*l,i[13]=(s+r)*f,i[14]=(c+n)*y,i[15]=1,i}var VR=GR;function qR(i,t,e,r){var s,n,c,l,f,y,A,T,P,L,D=t[0],j=t[1],X=t[2],Z=r[0],$=r[1],ht=r[2],_t=e[0],Mt=e[1],Nt=e[2];return Math.abs(D-_t)<Kp&&Math.abs(j-Mt)<Kp&&Math.abs(X-Nt)<Kp?BR(i):(A=D-_t,T=j-Mt,P=X-Nt,L=1/Math.hypot(A,T,P),A*=L,T*=L,P*=L,s=$*P-ht*T,n=ht*A-Z*P,c=Z*T-$*A,L=Math.hypot(s,n,c),L?(L=1/L,s*=L,n*=L,c*=L):(s=0,n=0,c=0),l=T*c-P*n,f=P*s-A*c,y=A*n-T*s,L=Math.hypot(l,f,y),L?(L=1/L,l*=L,f*=L,y*=L):(l=0,f=0,y=0),i[0]=s,i[1]=l,i[2]=A,i[3]=0,i[4]=n,i[5]=f,i[6]=T,i[7]=0,i[8]=c,i[9]=y,i[10]=P,i[11]=0,i[12]=-(s*D+n*j+c*X),i[13]=-(l*D+f*j+y*X),i[14]=-(A*D+T*j+P*X),i[15]=1,i)}function HR(){var i=new Al(4);return Al!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function WR(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function T3(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function JR(i){var t=i[0],e=i[1],r=i[2],s=i[3];return Math.hypot(t,e,r,s)}function XR(i){var t=i[0],e=i[1],r=i[2],s=i[3];return t*t+e*e+r*r+s*s}function ZR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e*e+r*r+s*s+n*n;return c>0&&(c=1/Math.sqrt(c)),i[0]=e*c,i[1]=r*c,i[2]=s*c,i[3]=n*c,i}function $R(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function YR(i,t,e,r){var s=t[0],n=t[1],c=t[2],l=t[3];return i[0]=s+r*(e[0]-s),i[1]=n+r*(e[1]-n),i[2]=c+r*(e[2]-c),i[3]=l+r*(e[3]-l),i}function Cf(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3];return i[0]=e[0]*r+e[4]*s+e[8]*n+e[12]*c,i[1]=e[1]*r+e[5]*s+e[9]*n+e[13]*c,i[2]=e[2]*r+e[6]*s+e[10]*n+e[14]*c,i[3]=e[3]*r+e[7]*s+e[11]*n+e[15]*c,i}function KR(i,t,e){var r=t[0],s=t[1],n=t[2],c=e[0],l=e[1],f=e[2],y=e[3],A=y*r+l*n-f*s,T=y*s+f*r-c*n,P=y*n+c*s-l*r,L=-c*r-l*s-f*n;return i[0]=A*y+L*-c+T*-f-P*-l,i[1]=T*y+L*-l+P*-c-A*-f,i[2]=P*y+L*-f+A*-l-T*-c,i[3]=t[3],i}(function(){var i=HR();return function(t,e,r,s,n,c){var l,f;for(e||(e=4),r||(r=0),s?f=Math.min(s*e+r,t.length):f=t.length,l=r;l<f;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],n(i,i,c),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();var b1;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(b1||(b1={}));const QR=45*Math.PI/180,tk=1,oy=.1,ay=500,ek=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class er extends S3{static get IDENTITY(){return rk()}static get ZERO(){return ik()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return b1}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,s,n,c,l,f,y,A,T,P,L,D,j,X){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this[4]=n,this[5]=c,this[6]=l,this[7]=f,this[8]=y,this[9]=A,this[10]=T,this[11]=P,this[12]=L,this[13]=D,this[14]=j,this[15]=X,this.check()}setRowMajor(t,e,r,s,n,c,l,f,y,A,T,P,L,D,j,X){return this[0]=t,this[1]=n,this[2]=y,this[3]=L,this[4]=e,this[5]=c,this[6]=A,this[7]=D,this[8]=r,this[9]=l,this[10]=T,this[11]=j,this[12]=s,this[13]=f,this[14]=P,this[15]=X,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(ek)}fromObject(t){return this.check()}fromQuaternion(t){return DR(this,t),this.check()}frustum(t){const{left:e,right:r,bottom:s,top:n,near:c=oy,far:l=ay}=t;return l===1/0?sk(this,e,r,s,n,c):zR(this,e,r,s,n,c,l),this.check()}lookAt(t){const{eye:e,center:r=[0,0,0],up:s=[0,1,0]}=t;return qR(this,e,r,s),this.check()}ortho(t){const{left:e,right:r,bottom:s,top:n,near:c=oy,far:l=ay}=t;return VR(this,e,r,s,n,c,l),this.check()}orthographic(t){const{fovy:e=QR,aspect:r=tk,focalDistance:s=1,near:n=oy,far:c=ay}=t;Cw(e);const l=e/2,f=s*Math.tan(l),y=f*r;return this.ortho({left:-y,right:y,bottom:-f,top:f,near:n,far:c})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:r=1,near:s=.1,far:n=500}=t;return Cw(e),jR(this,e,r,s,n),this.check()}determinant(){return kR(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const r=this.getScale(e),s=1/r[0],n=1/r[1],c=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*n,t[2]=this[2]*c,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*n,t[6]=this[6]*c,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*n,t[10]=this[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const r=this.getScale(e),s=1/r[0],n=1/r[1],c=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*n,t[2]=this[2]*c,t[3]=this[4]*s,t[4]=this[5]*n,t[5]=this[6]*c,t[6]=this[8]*s,t[7]=this[9]*n,t[8]=this[10]*c,t}transpose(){return RR(this,this),this.check()}invert(){return v1(this,this),this.check()}multiplyLeft(t){return Iu(this,t,this),this.check()}multiplyRight(t){return Iu(this,this,t),this.check()}rotateX(t){return E3(this,this,t),this.check()}rotateY(t){return FR(this,this,t),this.check()}rotateZ(t){return C3(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return OR(this,this,t,e),this.check()}scale(t){return G_(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return ym(this,this,t),this.check()}transform(t,e){return t.length===4?(e=Cf(e||[-0,-0,-0,-0],t,this),Yp(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;let s;switch(r){case 2:s=m3(e||[-0,-0],t,this);break;case 3:s=U_(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Yp(s,t.length),s}transformAsVector(t,e){let r;switch(t.length){case 2:r=y3(e||[-0,-0],t,this);break;case 3:r=_3(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Yp(r,t.length),r}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}}let wg,xg;function ik(){return wg||(wg=new er([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(wg)),wg}function rk(){return xg||(xg=new er,Object.freeze(xg)),xg}function Cw(i){if(i>Math.PI*2)throw Error("expected radians")}function sk(i,t,e,r,s,n){const c=2*n/(e-t),l=2*n/(s-r),f=(e+t)/(e-t),y=(s+r)/(s-r),A=-1,T=-1,P=-2*n;return i[0]=c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=f,i[9]=y,i[10]=A,i[11]=T,i[12]=0,i[13]=0,i[14]=P,i[15]=0,i}function Tw(){var i=new Al(4);return Al!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function nk(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function P3(i,t,e){e=e*.5;var r=Math.sin(e);return i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i[3]=Math.cos(e),i}function Pw(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=e[0],f=e[1],y=e[2],A=e[3];return i[0]=r*A+c*l+s*y-n*f,i[1]=s*A+c*f+n*l-r*y,i[2]=n*A+c*y+r*f-s*l,i[3]=c*A-r*l-s*f-n*y,i}function ok(i,t,e){e*=.5;var r=t[0],s=t[1],n=t[2],c=t[3],l=Math.sin(e),f=Math.cos(e);return i[0]=r*f+c*l,i[1]=s*f+n*l,i[2]=n*f-s*l,i[3]=c*f-r*l,i}function ak(i,t,e){e*=.5;var r=t[0],s=t[1],n=t[2],c=t[3],l=Math.sin(e),f=Math.cos(e);return i[0]=r*f-n*l,i[1]=s*f+c*l,i[2]=n*f+r*l,i[3]=c*f-s*l,i}function lk(i,t,e){e*=.5;var r=t[0],s=t[1],n=t[2],c=t[3],l=Math.sin(e),f=Math.cos(e);return i[0]=r*f+s*l,i[1]=s*f-r*l,i[2]=n*f+c*l,i[3]=c*f-n*l,i}function ck(i,t){var e=t[0],r=t[1],s=t[2];return i[0]=e,i[1]=r,i[2]=s,i[3]=Math.sqrt(Math.abs(1-e*e-r*r-s*s)),i}function Wg(i,t,e,r){var s=t[0],n=t[1],c=t[2],l=t[3],f=e[0],y=e[1],A=e[2],T=e[3],P,L,D,j,X;return L=s*f+n*y+c*A+l*T,L<0&&(L=-L,f=-f,y=-y,A=-A,T=-T),1-L>Kp?(P=Math.acos(L),D=Math.sin(P),j=Math.sin((1-r)*P)/D,X=Math.sin(r*P)/D):(j=1-r,X=r),i[0]=j*s+X*f,i[1]=j*n+X*y,i[2]=j*c+X*A,i[3]=j*l+X*T,i}function hk(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e*e+r*r+s*s+n*n,l=c?1/c:0;return i[0]=-e*l,i[1]=-r*l,i[2]=-s*l,i[3]=n*l,i}function uk(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function I3(i,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),i[3]=.5*r,r=.5/r,i[0]=(t[5]-t[7])*r,i[1]=(t[6]-t[2])*r,i[2]=(t[1]-t[3])*r;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);var n=(s+1)%3,c=(s+2)%3;r=Math.sqrt(t[s*3+s]-t[n*3+n]-t[c*3+c]+1),i[s]=.5*r,r=.5/r,i[3]=(t[n*3+c]-t[c*3+n])*r,i[n]=(t[n*3+s]+t[s*3+n])*r,i[c]=(t[c*3+s]+t[s*3+c])*r}return i}var dk=WR,pk=T3,fk=$R,gk=YR,mk=JR,yk=XR,L3=ZR,_k=function(){var i=b3(),t=Aw(1,0,0),e=Aw(0,1,0);return function(r,s,n){var c=z_(s,n);return c<-.999999?(Hg(i,t,s),wR(i)<1e-6&&Hg(i,e,s),gR(i,i),P3(r,i,Math.PI),r):c>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Hg(i,s,n),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+c,L3(r,r))}}();(function(){var i=Tw(),t=Tw();return function(e,r,s,n,c,l){return Wg(i,r,c,l),Wg(t,s,n,l),Wg(e,i,t,2*l*(1-l)),e}})();(function(){var i=xR();return function(t,e,r,s){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=s[0],i[4]=s[1],i[7]=s[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],L3(t,I3(t,i))}})();const vk=[0,0,0,1];class lf extends F_{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,r,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,r,s){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return I3(this,t),this.check()}fromAxisRotation(t,e){return P3(this,t,e),this.check()}identity(){return nk(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Ir(t)}get y(){return this[1]}set y(t){this[1]=Ir(t)}get z(){return this[2]}set z(t){this[2]=Ir(t)}get w(){return this[3]}set w(t){this[3]=Ir(t)}len(){return mk(this)}lengthSquared(){return yk(this)}dot(t){return fk(this,t)}rotationTo(t,e){return _k(this,t,e),this.check()}add(t){return dk(this,this,t),this.check()}calculateW(){return ck(this,this),this.check()}conjugate(){return uk(this,this),this.check()}invert(){return hk(this,this),this.check()}lerp(t,e,r){return r===void 0?this.lerp(this,t,e):(gk(this,t,e,r),this.check())}multiplyRight(t){return Pw(this,this,t),this.check()}multiplyLeft(t){return Pw(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return ok(this,this,t),this.check()}rotateY(t){return ak(this,this,t),this.check()}rotateZ(t){return lk(this,this,t),this.check()}scale(t){return pk(this,this,t),this.check()}slerp(t,e,r){let s,n,c;switch(arguments.length){case 1:({start:s=vk,target:n,ratio:c}=t);break;case 2:s=this,n=t,c=e;break;default:s=t,n=e,c=r}return Wg(this,s,n,c),this.check()}transformVector4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new j_;return KR(e,t,this),Yp(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const cf={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},Iw=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,bk={lightSources:{}};function ly(){let{color:i=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(e=>e*t/255)}function wk(i){let{ambientLight:t,pointLights:e=[],directionalLights:r=[]}=i;const s={};return t?s["lighting_uAmbientLight.color"]=ly(t):s["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((n,c)=>{s["lighting_uPointLight[".concat(c,"].color")]=ly(n),s["lighting_uPointLight[".concat(c,"].position")]=n.position,s["lighting_uPointLight[".concat(c,"].attenuation")]=n.attenuation||[1,0,0]}),s.lighting_uPointLightCount=e.length,r.forEach((n,c)=>{s["lighting_uDirectionalLight[".concat(c,"].color")]=ly(n),s["lighting_uDirectionalLight[".concat(c,"].direction")]=n.direction}),s.lighting_uDirectionalLightCount=r.length,s}function M3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:bk;if("lightSources"in i){const{ambientLight:t,pointLights:e,directionalLights:r}=i.lightSources||{};return t||e&&e.length>0||r&&r.length>0?Object.assign({},wk({ambientLight:t,pointLights:e,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const t={pointLights:[],directionalLights:[]};for(const e of i.lights||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights.push(e);break;case"point":t.pointLights.push(e);break}return M3({lightSources:t})}return{}}const V_={name:"lights",vs:Iw,fs:Iw,getUniforms:M3,defines:{MAX_LIGHTS:3}},xk=new Uint8Array([0,255,255,255]),Ak={pickingSelectedColor:null,pickingHighlightColor:xk,pickingActive:!1,pickingAttribute:!1};function Sk(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ak;const t={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=i.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(i.pickingHighlightColor){const e=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return i.pickingActive!==void 0&&(t.picking_uActive=!!i.pickingActive,t.picking_uAttribute=!!i.pickingAttribute),t}const Ek=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Ck=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Tk={name:"picking",vs:Ek,fs:Ck,getUniforms:Sk},B3=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Pk={};function Ik(i){const{ambient:t=.35,diffuse:e=.6,shininess:r=32,specularColor:s=[30,30,30]}=i;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:r,lighting_uSpecularColor:s.map(n=>n/255)}}function R3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Pk;if(!("material"in i))return{};const{material:t}=i;return t?Ik(t):{lighting_uEnabled:!1}}const Lk={name:"gouraud-lighting",dependencies:[V_],vs:B3,defines:{LIGHTING_VERTEX:1},getUniforms:R3},Mk={name:"phong-lighting",dependencies:[V_],fs:B3,defines:{LIGHTING_FRAGMENT:1},getUniforms:R3},Bk=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,Rk=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,q_={name:"pbr",vs:Bk,fs:Rk,defines:{LIGHTING_FRAGMENT:1},dependencies:[V_]},kk=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Ok={name:"transform",vs:kk,fs:null};class Tf{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new Tf(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:r="",defines:s={},inject:n={},varyings:c=[],bufferMode:l=35981,transpileToGLSL100:f=!1}=t,y=this._getModuleList(t.modules),A=this._getHash(e),T=this._getHash(r),P=y.map(ht=>this._getHash(ht.name)).sort(),L=c.map(ht=>this._getHash(ht)),D=Object.keys(s).sort(),j=Object.keys(n).sort(),X=[],Z=[];for(const ht of D)X.push(this._getHash(ht)),X.push(this._getHash(s[ht]));for(const ht of j)Z.push(this._getHash(ht)),Z.push(this._getHash(n[ht]));const $="".concat(A,"/").concat(T,"D").concat(X.join("/"),"M").concat(P.join("/"),"I").concat(Z.join("/"),"V").concat(L.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(f?"T":"");if(!this._programCache[$]){const ht=N6(this.gl,{vs:e,fs:r,modules:y,inject:n,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:f});this._programCache[$]=new s3(this.gl,{hash:$,vs:ht.vs,fs:ht.fs,varyings:c,bufferMode:l}),this._getUniforms[$]=ht.getUniforms||(_t=>{}),this._useCounts[$]=0}return this._useCounts[$]++,this._programCache[$]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),r={};let s=0;for(let n=0,c=this._defaultModules.length;n<c;++n){const l=this._defaultModules[n],f=l.name;e[s++]=l,r[f]=!0}for(let n=0,c=t.length;n<c;++n){const l=t[n],f=l.name;r[f]||(e[s++]=l,r[f]=!0)}return e.length=s,e}}const Fk={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Nk(i,t,e){const r={};let s=t.indices;for(const n in t.attributes){const c=t.attributes[n],l=Dk(n);if(n==="indices")s=c;else if(c.constant)r[l]=c.value;else{const f=c.value,y={...c};delete y.value,r[l]=[new Hr(i,f),y],zk(n,y)}}if(s){const n=s.value||s;ti(n instanceof Uint16Array||n instanceof Uint32Array,'attribute array for "indices" must be of integer type');const c={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};r.indices=[new Hr(i,{data:n,target:34963}),c]}return r}function Dk(i,t){const{attributeMap:e=Fk}={};return e&&e[i]||i}function zk(i,t){let e;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}ti(Number.isFinite(t.size),"attribute ".concat(i," needs size"))}const ld=2,Uk=1e4,jk="Model needs drawMode and vertexCount",Lw=()=>{},Gk={};class Gd{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=Xc("model")}=e;ti(km(t)),this.id=r,this.gl=t,this.id=e.id||Xc("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||Tf.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:A}=t;this.programProps={program:e,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:A},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},ti(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),jk)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:A}=t;this.programProps={program:e,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:A},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return ti(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return ti(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Nk(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zd(t))return this;const e={};for(const r in t){const s=t[r];e[r]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return L_(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:r,uniforms:s={},attributes:n={},transformFeedback:c=this.transformFeedback,parameters:l={},vertexArray:f=this.vertexArray}=t;this.setAttributes(n),this.updateModuleSettings(e),this.setUniforms(s);let y;di.priority>=ld&&(y=this._logDrawCallStart(ld));const A=this.vertexArray.getDrawParams(),{isIndexed:T=A.isIndexed,indexType:P=A.indexType,indexOffset:L=A.indexOffset,vertexArrayInstanced:D=A.isInstanced}=this.props;D&&!this.isInstanced&&di.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:j,instanceCount:X}=this,{onBeforeRender:Z=Lw,onAfterRender:$=Lw}=this.props;Z(),this.program.setUniforms(this.uniforms);const ht=this.program.draw(Object.assign(Gk,t,{logPriority:y,uniforms:null,framebuffer:r,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:f,transformFeedback:c,isIndexed:T,indexType:P,isInstanced:j,instanceCount:X,offset:T?L:0}));return $(),di.priority>=ld&&this._logDrawCallEnd(y,f,r),ht}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:r,unbindModels:s=[]}=t;let{parameters:n}=t;r&&this._setFeedbackBuffers(r),e&&(n=Object.assign({},n,{35977:e})),s.forEach(c=>c.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:n}))}finally{s.forEach(c=>c.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return di.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:r,modules:s,inject:n,defines:c,varyings:l,bufferMode:f,transpileToGLSL100:y}=this.programProps;t=this.programManager.get({vs:e,fs:r,modules:s,inject:n,defines:c,varyings:l,bufferMode:f,transpileToGLSL100:y}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ti(t instanceof s3,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new KB(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof Hr&&e.delete()}}_setAnimationProps(t){this.animated&&ti(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zd(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new n3(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:Uk;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),di.group(ld,">>> DRAWING MODEL ".concat(this.id),{collapsed:di.level<=2})(),t}_logDrawCallEnd(t,e,r,s){if(t===void 0)return;const n=e6({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:c,unusedTable:l,unusedCount:f}=uw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:y,count:A}=uw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});A>0&&di.log("MISSING UNIFORMS",Object.keys(y))(),f>0&&di.log("UNUSED UNIFORMS",Object.keys(l))();const T=r6(this.vertexArray.configuration);di.table(t,n)(),di.table(t,c)(),di.table(t+1,T)(),s&&s.log({logLevel:ld,message:"Rendered to ".concat(s.id)}),di.groupEnd(ld)()}}class Vk{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:s}=e;return{attributes:Object.assign({},r,t.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],r=t?e[t]:null;return r?r instanceof Hr?r:r.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,r=this.getBuffer(e);return r?r.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ti(Ki(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const s in this.feedbackMap){const n=this.feedbackMap[s];s in e&&(r[n]=s)}Object.assign(r,t.feedbackBuffers);for(const s in r){const n=r[s];if(typeof n=="string"){const c=e[n],{byteLength:l,usage:f,accessor:y}=c;r[s]=this._createNewBuffer(s,{byteLength:l,usage:f,accessor:y})}}return r}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const r=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:r})}_setupTransformFeedback(t,e){let{model:r}=e;const{program:s}=r;t.transformFeedback=new n3(this.gl,{program:s,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:e,feedbackBuffers:r})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),r=Object.assign({},t.feedbackBuffers);for(const s in this.feedbackMap){const n=this.feedbackMap[s];e[s]=t.feedbackBuffers[n],r[n]=t.sourceBuffers[s],ti(r[n]instanceof Hr)}return{sourceBuffers:e,feedbackBuffers:r}}_createNewBuffer(t,e){const r=new Hr(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const qk="transform_uSampler_",_m="transform_uSize_",Mw="transform_position";function Hk(i){let{vs:t,sourceTextureMap:e,targetTextureVarying:r,targetTexture:s}=i,n=Object.keys(e).length,c=null;const l={};let f=t,y={};if(n>0||r){const A=f.split(`
`),T=A.slice();if(A.forEach((P,L,D)=>{if(n>0){const j=$k(P,e);if(j){const{updatedLine:X,inject:Z}=j;T[L]=X,y=g1([y,Z]),Object.assign(l,j.samplerTextureMap),n--}}r&&!c&&(c=Zk(P,r))}),r){ti(s);const P="".concat(_m).concat(r),L="uniform vec2 ".concat(P,`;
`),D="     vec2 ".concat(Mw," = transform_getPos(").concat(P,`);
     gl_Position = vec4(`).concat(Mw,`, 0, 1.);
`);y=g1([y,{"vs:#decl":L,"vs:#main-start":D}])}f=T.join(`
`)}return{vs:f,targetTextureType:c,inject:y,samplerTextureMap:l}}function Wk(i){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:r}=i;const s={};let n,c;e&&({width:n,height:c}=r,s["".concat(_m).concat(e)]=[n,c]);for(const l in t)({width:n,height:c}=t[l]),s["".concat(_m).concat(l)]=[n,c];return s}function Jk(i){return d3(i,["attribute","in"])}function Xk(i){const t="".concat(qk).concat(i),e="".concat(_m).concat(i),r="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:r}}function Zk(i,t){const e=d3(i,["varying","out"]);return e&&e.name===t?e.type:null}function $k(i,t){const e={},r=Jk(i);if(!r)return null;const{type:s,name:n}=r;if(n&&t[n]){const c="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:f,uniformDeclerations:y}=Xk(n),A=W6(s),T="  ".concat(s," ").concat(n," = transform_getInput(").concat(l,", ").concat(f,").").concat(A,`;
`);return e[l]=n,{updatedLine:c,inject:{"vs:#decl":y,"vs:#main-start":T},samplerTextureMap:e}}return null}const Yk={10241:9728,10240:9728,10242:33071,10243:33071},Kk="transform_output";class Qk{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:r,framebuffer:s,targetTexture:n}=this.bindings[this.currentIndex],c=Object.assign({},e,t.attributes),l=Object.assign({},t.uniforms),f=Object.assign({},t.parameters);let y=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){c.transform_elementID=this.elementIDBuffer;for(const T in this.samplerTextureMap){const P=this.samplerTextureMap[T];l[T]=r[P]}this._setSourceTextureParameters();const A=Wk({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:n});Object.assign(l,A)}return this.hasTargetTexture&&(y=!1,f.viewport=[0,0,s.width,s.height]),{attributes:c,framebuffer:s,uniforms:l,discard:y,parameters:f}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],r=Fm(e);if(!t)return r;const s=r.constructor,n=J6(this.targetTextureType),c=new s(r.length*n/4);let l=0;for(let f=0;f<r.length;f+=4)for(let y=0;y<n;y++)c[l++]=r[f+y];return c}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:r}=t;this._swapTexture=r,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:r}=t;if(r instanceof xa)return r;const s=e[r];return s?(this._targetRefTexName=r,this._createNewTexture(s)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:r={},_targetTexture:s}=t,n=this._createTargetTexture({sourceTextures:r,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:r,targetTexture:n}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((r,s,n)=>{n[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new Hr(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:e,targetTexture:r})}}_updateBinding(t,e){const{sourceBuffers:r,sourceTextures:s,targetTexture:n}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,s),Object.assign(t.sourceBuffers,r),n){t.targetTexture=n;const{width:c,height:l}=n,{framebuffer:f}=t;f?(f.update({attachments:{36064:n},resizeAttachments:!1}),f.resize({width:c,height:l})):t.framebuffer=new Ks(this.gl,{id:"transform-framebuffer",width:c,height:l,attachments:{36064:n}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const r in e)e[r].setParameters(Yk)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const r=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:r}}_createNewTexture(t){const e=jM(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:r}=this.bindings[this.currentIndex],{vs:s,uniforms:n,targetTextureType:c,inject:l,samplerTextureMap:f}=Hk({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),y=g1([t.inject||{},l]);this.targetTextureType=c,this.samplerTextureMap=f;const A=t._fs||p3({version:i3(s),input:this.targetTextureVarying,inputType:c,output:Kk}),T=this.hasSourceTextures||this.targetTextureVarying?[Ok].concat(t.modules||[]):t.modules;return{vs:s,fs:A,modules:T,uniforms:n,inject:y}}}class H_{static isSupported(t){return Ki(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:r}=this;t&&t.delete(),e&&e.delete(),r&&r.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,r=this._updateDrawOptions(t);e&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e)t=t||r.swap();ti(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e){const s=r.getData(t);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e)r.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new Gd(e,Object.assign({},t,{fs:t.fs||p3({version:i3(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of r)e=s.updateModelProps(e);return e}_buildResourceTransforms(t,e){tO(e)&&(this.bufferTransform=new Vk(t,e)),eO(e)&&(this.textureTransform=new Qk(t,e)),ti(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of r)e=Object.assign(e,s.getDrawOptions(e));return e}}function tO(i){return!!(!zd(i.feedbackBuffers)||!zd(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function eO(i){return!!(!zd(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const Bw={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Qp{static get DRAW_MODE(){return Bw}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e=Xc("geometry"),drawMode:r=Bw.TRIANGLES,attributes:s={},indices:n=null,vertexCount:c=null}=t;this.id=e,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(s,n),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const r in t){let s=t[r];s=ArrayBuffer.isView(s)?{value:s}:s,ti(ArrayBuffer.isView(s.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!s.size&&(s.size=3),r==="indices"?(ti(!this.indices),this.indices=s):this.attributes[r]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let r=1/0;for(const s in t){const n=t[s],{value:c,size:l,constant:f}=n;!f&&c&&l>=1&&(r=Math.min(r,c.length/l))}return ti(Number.isFinite(r)),r}}let iO=1,rO=1;class k3{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:n=1}=t,c=iO++,l={time:0,delay:e,duration:r,rate:s,repeat:n};return this._setChannelTime(l,this.time),this.channels.set(c,l),c}removeChannel(t){this.channels.delete(t);for(const[e,r]of this.animations)r.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const s of e)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:n,channel:c}=s;n.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const r=rO++;return this.animations.set(r,{animation:t,channel:e}),t.setTime(this.getTime(e)),r}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const r=e-t.delay,s=t.duration*t.repeat;r>=s?t.time=t.duration*t.rate:(t.time=Math.max(0,r)%t.duration,t.time*=t.rate)}}const sO=[255,255,255],nO=1;let oO=0;class O3{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id",void 0),H(this,"color",void 0),H(this,"intensity",void 0),H(this,"type","ambient");const{color:e=sO}=t,{intensity:r=nO}=t;this.id=t.id||"ambient-".concat(oO++),this.color=e,this.intensity=r}}const aO=[255,255,255],lO=1,cO=[0,0,-1];let hO=0;class Rw{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id",void 0),H(this,"color",void 0),H(this,"intensity",void 0),H(this,"type","directional"),H(this,"direction",void 0),H(this,"shadow",void 0);const{color:e=aO}=t,{intensity:r=lO}=t,{direction:s=cO}=t,{_shadow:n=!1}=t;this.id=t.id||"directional-".concat(hO++),this.color=e,this.intensity=r,this.type="directional",this.direction=new te(s).normalize().toArray(),this.shadow=n}getProjectedLight(t){return this}}class uO{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};H(this,"id",void 0),H(this,"gl",void 0),H(this,"props",void 0);const{id:r}=e;this.id=r,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class W_ extends uO{constructor(){super(...arguments),H(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return Jc(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:r,viewports:s,views:n,onViewportActive:c,clearStack:l=!0,clearCanvas:f=!0}=t;t.pass=t.pass||"unknown";const y=this.gl;f&&pO(y,e),l&&(this._lastRenderIndex=-1);const A=[];for(const T of s){const P=n&&n[T.id];c==null||c(T);const L=this._getDrawLayerParams(T,t),D=T.subViewports||[T];for(const j of D){const X=this._drawLayersInViewport(y,{target:e,moduleParameters:r,viewport:j,view:P,pass:t.pass,layers:t.layers},L);A.push(X)}}return A}_getDrawLayerParams(t,e){let{layers:r,pass:s,isPicking:n=!1,layerFilter:c,cullRect:l,effects:f,moduleParameters:y}=e,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const T=[],P=F3(this._lastRenderIndex+1),L={layer:r[0],viewport:t,isPicking:n,renderPass:s,cullRect:l},D={};for(let j=0;j<r.length;j++){const X=r[j],Z=this._shouldDrawLayer(X,L,c,D),$={shouldDrawLayer:Z};Z&&!A&&($.layerRenderIndex=P(X,Z),$.moduleParameters=this._getModuleParameters(X,f,s,y),$.layerParameters=this.getLayerParameters(X,j,t)),T[j]=$}return T}_drawLayersInViewport(t,e,r){let{layers:s,moduleParameters:n,pass:c,target:l,viewport:f,view:y}=e;const A=dO(t,{moduleParameters:n,target:l,viewport:f});if(y&&y.props.clear){const P=y.props.clear===!0?{color:!0,depth:!0}:y.props.clear;wl(t,{scissorTest:!0,scissor:A},()=>L_(t,P))}const T={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};Jc(t,{viewport:A});for(let P=0;P<s.length;P++){const L=s[P],{shouldDrawLayer:D,layerRenderIndex:j,moduleParameters:X,layerParameters:Z}=r[P];if(D&&L.props.pickable&&T.pickableCount++,L.isComposite)T.compositeCount++;else if(D){T.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,j),X.viewport=f;try{L._drawLayer({moduleParameters:X,uniforms:{layerIndex:j},parameters:Z})}catch($){L.raiseError($,"drawing ".concat(L," to ").concat(c))}}}return T}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,r){return t.props.parameters}_shouldDrawLayer(t,e,r,s){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let n=t.parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(e))return!1;e.layer=n,n=n.parent}if(r){const c=e.layer.id;if(c in s||(s[c]=r(e)),!s[c])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,r,s){var n;const c=Object.assign(Object.create(((n=t.internalState)===null||n===void 0?void 0:n.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Dd(this.gl)});if(e)for(const f of e){var l;Object.assign(c,(l=f.getModuleParameters)===null||l===void 0?void 0:l.call(f,t))}return Object.assign(c,this.getModuleParameters(t,e),s)}}function F3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={},r=(s,n)=>{const c=s.props._offset,l=s.id,f=s.parent&&s.parent.id;let y;if(f&&!(f in t)&&r(s.parent,!1),f in e){const A=e[f]=e[f]||F3(t[f],t);y=A(s,n),e[l]=A}else Number.isFinite(c)?(y=c+(t[f]||0),e[l]=null):y=i;return n&&y>=i&&(i=y+1),t[l]=y,y};return r}function dO(i,t){let{moduleParameters:e,target:r,viewport:s}=t;const n=r&&r.id!=="default-framebuffer",c=e&&e.devicePixelRatio||Dd(i),l=n?r.height:i.drawingBufferHeight,f=s;return[f.x*c,l-(f.y+f.height)*c,f.width*c,f.height*c]}function pO(i,t){const e=t?t.width:i.drawingBufferWidth,r=t?t.height:i.drawingBufferHeight;Jc(i,{viewport:[0,0,e,r]}),i.clear(16640)}class fO extends W_{constructor(t,e){super(t,e),H(this,"shadowMap",void 0),H(this,"depthBuffer",void 0),H(this,"fbo",void 0),this.shadowMap=new xa(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new xd(t,{format:33189,width:1,height:1}),this.fbo=new Ks(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;wl(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=t.viewports[0],s=Dd(this.gl),n=r.width*s,c=r.height*s;(n!==e.width||c!==e.height)&&e.resize({width:n,height:c}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const N3="#define SMOOTH_EDGE_RADIUS 0.5",gO=`
`.concat(N3,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),mO=`
`.concat(N3,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),yO={name:"geometry",vs:gO,fs:mO},_O=Object.keys(lr).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(lr[i],";")).join(""),vO=Object.keys(oc).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(oc[i],";")).join(""),bO=Object.keys(h1).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(h1[i],";")).join(""),wO="".concat(_O,`
`).concat(vO,`
`).concat(bO,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function xO(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}return!1}function Pf(i){let t={},e;return r=>{for(const s in r)if(!xO(r[s],t[s])){e=i(r),t=r;break}return e}}const kw=[0,0,0,0],AO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],D3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],SO=[0,0,0],z3=[0,0,0],EO=Pf(PO);function U3(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:z3;e.length<3&&(e=[e[0],e[1],0]);let r=e,s,n=!0;switch(t===lr.LNGLAT_OFFSETS||t===lr.METER_OFFSETS?s=e:s=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case oc.WEB_MERCATOR:(t===lr.LNGLAT||t===lr.CARTESIAN)&&(s=[0,0,0],n=!1);break;case oc.WEB_MERCATOR_AUTO_OFFSET:t===lr.LNGLAT?r=s:t===lr.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],s=i.unprojectPosition(r),r[0]-=e[0],r[1]-=e[1],r[2]-=e[2]);break;case oc.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case oc.GLOBE:n=!1,s=null;break;default:n=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:n}}function CO(i,t,e){const{viewMatrixUncentered:r,projectionMatrix:s}=i;let{viewMatrix:n,viewProjectionMatrix:c}=i,l=kw,f=kw,y=i.cameraPosition;const{geospatialOrigin:A,shaderCoordinateOrigin:T,offsetMode:P}=U3(i,t,e);return P&&(f=i.projectPosition(A||T),y=[y[0]-f[0],y[1]-f[1],y[2]-f[2]],f[3]=1,l=Cf([],f,c),n=r||n,c=Iu([],s,n),c=Iu([],c,AO)),{viewMatrix:n,viewProjectionMatrix:c,projectionCenter:l,originCommon:f,cameraPosCommon:y,shaderCoordinateOrigin:T,geospatialOrigin:A}}function TO(i){let{viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:s=lr.DEFAULT,coordinateOrigin:n=z3,autoWrapLongitude:c=!1}=i;s===lr.DEFAULT&&(s=t.isGeospatial?lr.LNGLAT:lr.CARTESIAN);const l=EO({viewport:t,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:n});return l.project_uWrapLongitude=c,l.project_uModelMatrix=r||D3,l}function PO(i){let{viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s}=i;const{projectionCenter:n,viewProjectionMatrix:c,originCommon:l,cameraPosCommon:f,shaderCoordinateOrigin:y,geospatialOrigin:A}=CO(t,r,s),T=t.getDistanceScales(),P=[t.width*e,t.height*e],L=Cf([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,D={project_uCoordinateSystem:r,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:y,project_uCommonOrigin:l.slice(0,3),project_uCenter:n,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:P,project_uDevicePixelRatio:e,project_uFocalDistance:L,project_uCommonUnitsPerMeter:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:SO,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:D3,project_uCameraPosition:f};if(A){const j=t.getDistanceScales(A);switch(r){case lr.METER_OFFSETS:D.project_uCommonUnitsPerWorldUnit=j.unitsPerMeter,D.project_uCommonUnitsPerWorldUnit2=j.unitsPerMeter2;break;case lr.LNGLAT:case lr.LNGLAT_OFFSETS:t._pseudoMeters||(D.project_uCommonUnitsPerMeter=j.unitsPerMeter),D.project_uCommonUnitsPerWorldUnit=j.unitsPerDegree,D.project_uCommonUnitsPerWorldUnit2=j.unitsPerDegree2;break;case lr.CARTESIAN:D.project_uCommonUnitsPerWorldUnit=[1,1,j.unitsPerMeter[2]],D.project_uCommonUnitsPerWorldUnit2=[0,0,j.unitsPerMeter2[2]];break}}return D}const IO={};function LO(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:IO;return"viewport"in i?TO(i):{}}const J_={name:"project",dependencies:[$6,yO],vs:wO,getUniforms:LO};function MO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Pd(i,t){const e=Cf([],t,i);return T3(e,e,1/e[3]),e}function Ow(i,t){const e=i%t;return e<0?t+e:e}function w1(i,t,e){return i<t?t:i>e?e:i}function BO(i){return Math.log(i)*Math.LOG2E}const X_=Math.log2||BO;function Zc(i,t){if(!i)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const vl=Math.PI,j3=vl/4,Za=vl/180,x1=180/vl,Vd=512,vm=4003e4,Ag=85.051129,RO=1.5;function kO(i){return X_(i)}function hf(i){const[t,e]=i;Zc(Number.isFinite(t)),Zc(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const r=t*Za,s=e*Za,n=Vd*(r+vl)/(2*vl),c=Vd*(vl+Math.log(Math.tan(j3+s*.5)))/(2*vl);return[n,c]}function qd(i){const[t,e]=i,r=t/Vd*(2*vl)-vl,s=2*(Math.atan(Math.exp(e/Vd*(2*vl)-vl))-j3);return[r*x1,s*x1]}function OO(i){const{latitude:t}=i;Zc(Number.isFinite(t));const e=Math.cos(t*Za);return kO(vm*e)-9}function Jg(i){const t=Math.cos(i*Za);return Vd/vm/t}function A1(i){const{latitude:t,longitude:e,highPrecision:r=!1}=i;Zc(Number.isFinite(t)&&Number.isFinite(e));const s=Vd,n=Math.cos(t*Za),c=s/360,l=c/n,f=s/vm/n,y={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[c,l,f],degreesPerUnit:[1/c,1/l,1/f]};if(r){const A=Za*Math.tan(t*Za)/n,T=c*A/2,P=s/vm*A,L=P/l*f;y.unitsPerDegree2=[0,T,P],y.unitsPerMeter2=[L,0,L]}return y}function G3(i,t){const[e,r,s]=i,[n,c,l]=t,{unitsPerMeter:f,unitsPerMeter2:y}=A1({longitude:e,latitude:r,highPrecision:!0}),A=hf(i);A[0]+=n*(f[0]+y[0]*c),A[1]+=c*(f[1]+y[1]*c);const T=qd(A),P=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[T[0],T[1],P]:T}function FO(i){const{height:t,pitch:e,bearing:r,altitude:s,scale:n,center:c}=i,l=MO();ym(l,l,[0,0,-s]),E3(l,l,-e*Za),C3(l,l,r*Za);const f=n/t;return G_(l,l,[f,f,f]),c&&ym(l,l,fR([],c)),l}function NO(i){const{width:t,height:e,altitude:r,pitch:s=0,offset:n,center:c,scale:l,nearZMultiplier:f=1,farZMultiplier:y=1}=i;let{fovy:A=bm(RO)}=i;r!==void 0&&(A=bm(r));const T=A*Za,P=s*Za,L=V3(A);let D=L;c&&(D+=c[2]*l/Math.cos(P)/e);const j=T*(.5+(n?n[1]:0)/e),X=Math.sin(j)*D/Math.sin(w1(Math.PI/2-P-j,.01,Math.PI-.01)),Z=Math.sin(P)*X+D,$=D*10,ht=Math.min(Z*y,$);return{fov:T,aspect:t/e,focalDistance:L,near:f,far:ht}}function bm(i){return 2*Math.atan(.5/i)*x1}function V3(i){return .5/Math.tan(.5*i*Za)}function q3(i,t){const[e,r,s=0]=i;return Zc(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(s)),Pd(t,[e,r,s,1])}function Z_(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[r,s,n]=i;if(Zc(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(n))return Pd(t,[r,s,n,1]);const c=Pd(t,[r,s,0,1]),l=Pd(t,[r,s,1,1]),f=c[2],y=l[2],A=f===y?0:((e||0)-f)/(y-f);return f3([],c,l,A)}function DO(i){const{width:t,height:e,bounds:r,minExtent:s=0,maxZoom:n=24,offset:c=[0,0]}=i,[[l,f],[y,A]]=r,T=zO(i.padding),P=hf([l,w1(A,-Ag,Ag)]),L=hf([y,w1(f,-Ag,Ag)]),D=[Math.max(Math.abs(L[0]-P[0]),s),Math.max(Math.abs(L[1]-P[1]),s)],j=[t-T.left-T.right-Math.abs(c[0])*2,e-T.top-T.bottom-Math.abs(c[1])*2];Zc(j[0]>0&&j[1]>0);const X=j[0]/D[0],Z=j[1]/D[1],$=(T.right-T.left)/2/X,ht=(T.top-T.bottom)/2/Z,_t=[(L[0]+P[0])/2+$,(L[1]+P[1])/2+ht],Mt=qd(_t),Nt=Math.min(n,X_(Math.abs(Math.min(X,Z))));return Zc(Number.isFinite(Nt)),{longitude:Mt[0],latitude:Mt[1],zoom:Nt}}function zO(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(Zc(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const Fw=Math.PI/180;function UO(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:e,height:r,unproject:s}=i,n={targetZ:t},c=s([0,r],n),l=s([e,r],n);let f,y;const A=i.fovy?.5*i.fovy*Fw:Math.atan(.5/i.altitude),T=(90-i.pitch)*Fw;return A>T-.01?(f=Nw(i,0,t),y=Nw(i,e,t)):(f=s([0,0],n),y=s([e,0],n)),[c,l,y,f]}function Nw(i,t,e){const{pixelUnprojectionMatrix:r}=i,s=Pd(r,[t,0,1,1]),n=Pd(r,[t,i.height,1,1]),c=(e*i.distanceScales.unitsPerMeter[2]-s[2])/(n[2]-s[2]),l=f3([],s,n,c),f=qd(l);return f.push(e),f}const Dw=512;function jO(i){const{width:t,height:e,pitch:r=0}=i;let{longitude:s,latitude:n,zoom:c,bearing:l=0}=i;(s<-180||s>180)&&(s=Ow(s+180,360)-180),(l<-180||l>180)&&(l=Ow(l+180,360)-180);const f=X_(e/Dw);if(c<=f)c=f,n=0;else{const y=e/2/Math.pow(2,c),A=qd([0,y])[1];if(n<A)n=A;else{const T=qd([0,Dw-y])[1];n>T&&(n=T)}}return{width:t,height:e,longitude:s,latitude:n,zoom:c,pitch:r,bearing:l}}const GO=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,VO=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,qO=Pf(ZO),HO=Pf($O),WO=[0,0,0,1],JO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function XO(i,t){const[e,r,s]=i,n=Z_([e,r,s],t);return Number.isFinite(s)?n:[n[0],n[1],0]}function ZO(i){let{viewport:t,center:e}=i;return new er(t.viewProjectionMatrix).invert().transform(e)}function $O(i){let{viewport:t,shadowMatrices:e}=i;const r=[],s=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,c=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(l=>XO(l,s));for(const l of e){const f=l.clone().translate(new te(t.center).negate()),y=c.map(T=>f.transform(T)),A=new er().ortho({left:Math.min(...y.map(T=>T[0])),right:Math.max(...y.map(T=>T[0])),bottom:Math.min(...y.map(T=>T[1])),top:Math.max(...y.map(T=>T[1])),near:Math.min(...y.map(T=>-T[2])),far:Math.max(...y.map(T=>-T[2]))});r.push(A.multiplyRight(l))}return r}function YO(i,t){const{shadowEnabled:e=!0}=i;if(!e||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||WO,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},s=qO({viewport:i.viewport,center:t.project_uCenter}),n=[],c=HO({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let l=0;l<i.shadowMatrices.length;l++){const f=c[l],y=f.clone().translate(new te(i.viewport.center).negate());t.project_uCoordinateSystem===lr.LNGLAT&&t.project_uProjectionMode===oc.WEB_MERCATOR?(c[l]=y,n[l]=s):(c[l]=f.clone().multiplyRight(JO),n[l]=y.transform(s))}for(let l=0;l<c.length;l++)r["shadow_uViewProjectionMatrices[".concat(l,"]")]=c[l],r["shadow_uProjectCenters[".concat(l,"]")]=n[l],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(l)]=i.shadowMaps[l]:r["shadow_uShadowMap".concat(l)]=i.dummyShadowMap;return r}const cy={name:"shadow",dependencies:[J_],vs:GO,fs:VO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?YO(i,t):{}}},KO={color:[255,255,255],intensity:1},zw=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],QO=[0,0,0,200/255];class $_{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id","lighting-effect"),H(this,"props",void 0),H(this,"shadowColor",QO),H(this,"shadow",void 0),H(this,"ambientLight",void 0),H(this,"directionalLights",void 0),H(this,"pointLights",void 0),H(this,"shadowPasses",[]),H(this,"shadowMaps",[]),H(this,"dummyShadowMap",null),H(this,"programManager",void 0),H(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const r=t[e];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,e){let{layers:r,layerFilter:s,viewports:n,onViewportActive:c,views:l}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=Tf.getDefaultProgramManager(t),cy&&this.programManager.addDefaultModule(cy)),this.dummyShadowMap||(this.dummyShadowMap=new xa(t,{width:1,height:1}));for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:r,layerFilter:s,viewports:n,onViewportActive:c,views:l,moduleParameters:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:t})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(cy),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const r=new er().lookAt({eye:new te(e.direction).negate()});t.push(r)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const r=new fO(t);this.shadowPasses[e]=r,this.shadowMaps[e]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:r}=this;!t&&e.length===0&&r.length===0&&(this.ambientLight=new O3(KO),this.directionalLights.push(new Rw(zw[0]),new Rw(zw[1])))}}class t8{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"_pool",[]),H(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,r){let{size:s=1,type:n,padding:c=0,copy:l=!1,initialize:f=!1,maxCount:y}=r;const A=n||t&&t.constructor||Float32Array,T=e*s+c;if(ArrayBuffer.isView(t)){if(T<=t.length)return t;if(T*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new A(t.buffer,0,T)}let P=1/0;y&&(P=y*s+c);const L=this._allocate(A,T,f,P);return t&&l?L.set(t):f||L.fill(0,0,4),this._release(t),L}release(t){this._release(t)}_allocate(t,e,r,s){let n=Math.max(Math.ceil(e*this.opts.overAlloc),1);n>s&&(n=s);const c=this._pool,l=t.BYTES_PER_ELEMENT*n,f=c.findIndex(y=>y.byteLength>=l);if(f>=0){const y=new t(c.splice(f,1)[0],0,n);return r&&y.fill(0),y}return new t(n)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:r}=t,{byteLength:s}=r,n=e.findIndex(c=>c.byteLength>=s);n<0?e.push(r):(n>0||e.length<this.opts.poolSize)&&e.splice(n,0,r),e.length>this.opts.poolSize&&e.shift()}}const uf=new t8;function qp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function e8(i){return[i[12],i[13],i[14]]}function i8(i){return{left:cd(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:cd(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:cd(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:cd(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:cd(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:cd(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const Uw=new te;function cd(i,t,e,r){Uw.set(i,t,e);const s=Uw.len();return{distance:r/s,normal:new te(-i/s,-t/s,-e/s)}}function r8(i){return i-Math.fround(i)}let Mp;function hy(i,t){const{size:e=1,startIndex:r=0}=t,s=t.endIndex!==void 0?t.endIndex:i.length,n=(s-r)/e;Mp=uf.allocate(Mp,n,{type:Float32Array,size:e*2});let c=r,l=0;for(;c<s;){for(let f=0;f<e;f++){const y=i[c++];Mp[l+f]=y,Mp[l+f+e]=r8(y)}l+=e*2}return Mp.subarray(0,n*e*2)}function s8(i){let t=null,e=!1;for(const r of i)r&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}const n8=Math.PI/180,o8=qp(),jw=[0,0,0],a8={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function l8(i){let{width:t,height:e,orthographic:r,fovyRadians:s,focalDistance:n,padding:c,near:l,far:f}=i;const y=t/e,A=r?new er().orthographic({fovy:s,aspect:y,focalDistance:n,near:l,far:f}):new er().perspective({fovy:s,aspect:y,near:l,far:f});if(c){const{left:T=0,right:P=0,top:L=0,bottom:D=0}=c,j=Gc((T+t-P)/2,0,t)-t/2,X=Gc((L+e-D)/2,0,e)-e/2;A[8]-=j*2/t,A[9]+=X*2/e}return A}class $d{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id",void 0),H(this,"x",void 0),H(this,"y",void 0),H(this,"width",void 0),H(this,"height",void 0),H(this,"padding",void 0),H(this,"isGeospatial",void 0),H(this,"zoom",void 0),H(this,"focalDistance",void 0),H(this,"position",void 0),H(this,"modelMatrix",void 0),H(this,"distanceScales",void 0),H(this,"scale",void 0),H(this,"center",void 0),H(this,"cameraPosition",void 0),H(this,"projectionMatrix",void 0),H(this,"viewMatrix",void 0),H(this,"viewMatrixUncentered",void 0),H(this,"viewMatrixInverse",void 0),H(this,"viewProjectionMatrix",void 0),H(this,"pixelProjectionMatrix",void 0),H(this,"pixelUnprojectionMatrix",void 0),H(this,"resolution",void 0),H(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||a8,this.focalDistance=t.focalDistance||1,this.position=t.position||jw,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:r}=t;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?oc.WEB_MERCATOR:oc.WEB_MERCATOR_AUTO_OFFSET:oc.IDENTITY}equals(t){return t instanceof $d?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&xl(t.projectionMatrix,this.projectionMatrix)&&xl(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.projectPosition(t),s=q3(r,this.pixelProjectionMatrix),[n,c]=s,l=e?c:this.height-c;return t.length===2?[n,l]:[n,l,s[2]]}unproject(t){let{topLeft:e=!0,targetZ:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[s,n,c]=t,l=e?n:this.height-n,f=r&&r*this.distanceScales.unitsPerMeter[2],y=Z_([s,l,c],this.pixelUnprojectionMatrix,f),[A,T,P]=this.unprojectPosition(y);return Number.isFinite(c)?[A,T,P]:Number.isFinite(r)?[A,T,r]:[A,T]}projectPosition(t){const[e,r]=this.projectFlat(t),s=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,r,s]}unprojectPosition(t){const[e,r]=this.unprojectFlat(t),s=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,r,s]}projectFlat(t){if(this.isGeospatial){const e=hf(t);return e[1]=Gc(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?qd(t):t}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},e=this.unproject([0,0],t),r=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),n=this.unproject([this.width,this.height],t);return[Math.min(e[0],r[0],s[0],n[0]),Math.min(e[1],r[1],s[1],n[1]),Math.max(e[0],r[0],s[0],n[0]),Math.max(e[1],r[1],s[1],n[1])]}getDistanceScales(t){return t?A1({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:r,width:s=1,height:n=1}=t;return e<this.x+this.width&&this.x<e+s&&r<this.y+this.height&&this.y<r+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,i8(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,r=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=OO({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||A1({latitude:r,longitude:e}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:n,modelMatrix:c}=t;let l=jw;if(n&&(l=c?new er(c).transformAsVector(n,[]):n),this.isGeospatial){const f=this.projectPosition([e,r,0]);this.center=new te(l).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:e=o8,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:n,fovy:c=75,near:l=.1,far:f=1e3,padding:y=null,focalDistance:A=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new er().multiplyRight(e).translate(new te(this.center).negate()),this.projectionMatrix=r||l8({width:this.width,height:this.height,orthographic:s,fovyRadians:n||c*n8,focalDistance:A,padding:y,near:l,far:f});const T=qp();Iu(T,T,this.projectionMatrix),Iu(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=v1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=e8(this.viewMatrixInverse);const P=qp(),L=qp();G_(P,P,[this.width/2,-this.height/2,1]),ym(P,P,[1,-1,0]),Iu(L,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=v1(qp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||fr.warn("Pixel project matrix not invertible")()}}H($d,"displayName","Viewport");class Ru extends $d{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:e=0,longitude:r=0,zoom:s=0,pitch:n=0,bearing:c=0,nearZMultiplier:l=.1,farZMultiplier:f=1.01,nearZ:y,farZ:A,orthographic:T=!1,projectionMatrix:P,repeat:L=!1,worldOffset:D=0,position:j,padding:X,legacyMeterSizes:Z=!1}=t;let{width:$,height:ht,altitude:_t=1.5}=t;const Mt=Math.pow(2,s);$=$||1,ht=ht||1;let Nt,Rt=null;if(P)_t=P[5]/2,Nt=bm(_t);else{t.fovy?(Nt=t.fovy,_t=V3(Nt)):Nt=bm(_t);let qt;if(X){const{top:zt=0,bottom:ct=0}=X;qt=[0,Gc((zt+ht-ct)/2,0,ht)-ht/2]}Rt=NO({width:$,height:ht,scale:Mt,center:j&&[0,0,j[2]*Jg(e)],offset:qt,pitch:n,fovy:Nt,nearZMultiplier:l,farZMultiplier:f}),Number.isFinite(y)&&(Rt.near=y),Number.isFinite(A)&&(Rt.far=A)}let xt=FO({height:ht,pitch:n,bearing:c,scale:Mt,altitude:_t});D&&(xt=new er().translate([512*D,0,0]).multiplyLeft(xt)),super({...t,width:$,height:ht,viewMatrix:xt,longitude:r,latitude:e,zoom:s,...Rt,fovy:Nt,focalDistance:_t}),H(this,"longitude",void 0),H(this,"latitude",void 0),H(this,"pitch",void 0),H(this,"bearing",void 0),H(this,"altitude",void 0),H(this,"fovy",void 0),H(this,"orthographic",void 0),H(this,"_subViewports",void 0),H(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=r,this.zoom=s,this.pitch=n,this.bearing=c,this.altitude=_t,this.fovy=Nt,this.orthographic=T,this._subViewports=L?[]:null,this._pseudoMeters=Z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),r=Math.ceil((t[2]-180)/360);for(let s=e;s<=r;s++){const n=s?new Ru({...this,worldOffset:s}):this;this._subViewports.push(n)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,r]=this.projectFlat(t),s=(t[2]||0)*Jg(t[1]);return[e,r,s]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,r]=this.unprojectFlat(t),s=(t[2]||0)/Jg(r);return[e,r,s]}addMetersToLngLat(t,e){return G3(t,e)}panByPosition(t,e){const r=Z_(e,this.pixelUnprojectionMatrix),s=this.projectFlat(t),n=xw([],s,lR([],r)),c=xw([],this.center,n),[l,f]=this.unprojectFlat(c);return{longitude:l,latitude:f}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=UO(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:r,height:s}=this,{longitude:n,latitude:c,zoom:l}=DO({width:r,height:s,bounds:t,...e});return new Ru({width:r,height:s,longitude:n,latitude:c,zoom:l})}}H(Ru,"displayName","WebMercatorViewport");const Gw=[0,0,0];function uy(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=t.projectPosition(i);if(e&&t instanceof Ru){const[s,n,c=0]=i,l=t.getDistanceScales([s,n]);r[2]=c*l.unitsPerMeter[2]}return r}function c8(i){const{viewport:t,modelMatrix:e,coordinateOrigin:r}=i;let{coordinateSystem:s,fromCoordinateSystem:n,fromCoordinateOrigin:c}=i;return s===lr.DEFAULT&&(s=t.isGeospatial?lr.LNGLAT:lr.CARTESIAN),n===void 0&&(n=s),c===void 0&&(c=r),{viewport:t,coordinateSystem:s,coordinateOrigin:r,modelMatrix:e,fromCoordinateSystem:n,fromCoordinateOrigin:c}}function H3(i,t){let{viewport:e,modelMatrix:r,coordinateSystem:s,coordinateOrigin:n,offsetMode:c}=t,[l,f,y=0]=i;switch(r&&([l,f,y]=Cf([],[l,f,y,1],r)),s){case lr.LNGLAT:return uy([l,f,y],e,c);case lr.LNGLAT_OFFSETS:return uy([l+n[0],f+n[1],y+(n[2]||0)],e,c);case lr.METER_OFFSETS:return uy(G3(n,[l,f,y]),e,c);case lr.CARTESIAN:default:return e.isGeospatial?[l+n[0],f+n[1],y+n[2]]:e.projectPosition([l,f,y])}}function h8(i,t){const{viewport:e,coordinateSystem:r,coordinateOrigin:s,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:l}=c8(t),{autoOffset:f=!0}=t,{geospatialOrigin:y=Gw,shaderCoordinateOrigin:A=Gw,offsetMode:T=!1}=f?U3(e,r,s):{},P=H3(i,{viewport:e,modelMatrix:n,coordinateSystem:c,coordinateOrigin:l,offsetMode:T});if(T){const L=e.projectPosition(y||A);bR(P,P,L)}return P}const Vw={blendFunc:[1,0,32771,0],blendEquation:32774};class W3 extends W_{constructor(){super(...arguments),H(this,"pickZ",void 0),H(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:r,views:s,viewports:n,onViewportActive:c,pickingFBO:l,deviceRect:{x:f,y,width:A,height:T},cullRect:P,effects:L,pass:D="picking",pickZ:j,moduleParameters:X}=t;const Z=this.gl;this.pickZ=j;const $=this._resetColorEncoder(j),ht=wl(Z,{scissorTest:!0,scissor:[f,y,A,T],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Vw,blend:!j},()=>super.render({target:l,layers:e,layerFilter:r,views:s,viewports:n,onViewportActive:c,cullRect:P,effects:L==null?void 0:L.filter(_t=>_t.useInPicking),pass:D,isPicking:!0,moduleParameters:X}));return this._colorEncoderState=null,{decodePickingColor:$&&d8.bind(null,$),stats:ht}}shouldDrawLayer(t){const{pickable:e,operation:r}=t.props;return e&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,r){const s={...t.props.parameters},{pickable:n,operation:c}=t.props;return this._colorEncoderState?n&&c.includes("draw")&&(Object.assign(s,Vw),s.blend=!0,s.blendColor=u8(this._colorEncoderState,t,r)):s.blend=!1,c.includes("terrain")&&(s.blend=!1),s}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function u8(i,t,e){const{byLayer:r,byAlpha:s}=i;let n,c=r.get(t);return c?(c.viewports.push(e),n=c.a):(n=r.size+1,n<=255?(c={a:n,layer:t,viewports:[e]},r.set(t,c),s[n]=c):(fr.warn("Too many pickable layers, only picking the first 255")(),n=0)),[0,0,0,n/255]}function d8(i,t){const e=i.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const yd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},wm=Symbol.for("component"),qh=Symbol.for("propTypes"),dy=Symbol.for("deprecatedProps"),Id=Symbol.for("asyncPropDefaults"),ku=Symbol.for("asyncPropOriginal"),jh=Symbol.for("asyncPropResolved");function Nm(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(i)?J3(i,t,[]):t(i)?[i]:[]}function J3(i,t,e){let r=-1;for(;++r<i.length;){const s=i[r];Array.isArray(s)?J3(s,t,e):t(s)&&e.push(s)}return e}function p8(i){let{target:t,source:e,start:r=0,count:s=1}=i;const n=e.length,c=s*n;let l=0;for(let f=r;l<n;l++)t[f++]=e[l];for(;l<c;)l<c-l?(t.copyWithin(r+l,r,r+l),l*=2):(t.copyWithin(r+l,r,r+c-l),l=c);return t}class f8{constructor(t,e,r){H(this,"id",void 0),H(this,"context",void 0),H(this,"isLoaded",void 0),H(this,"persistent",void 0),H(this,"_loadCount",0),H(this,"_subscribers",new Set),H(this,"_data",void 0),H(this,"_loader",void 0),H(this,"_error",void 0),H(this,"_content",void 0),this.id=t,this.context=r,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const r=++this._loadCount;let s=t;typeof t=="string"&&(s=Wh(t)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(n=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=n)}).catch(n=>{this._loadCount===r&&(this.isLoaded=!0,this._error=n||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const n of this._subscribers)n.onChange(this.getData())}}class g8{constructor(t){let{gl:e,protocol:r}=t;H(this,"protocol",void 0),H(this,"_context",void 0),H(this,"_resources",void 0),H(this,"_consumers",void 0),H(this,"_pruneRequest",void 0),this.protocol=r||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:e,data:r,forceUpdate:s=!1,persistent:n=!0}=t,c=this._resources[e];c?c.setData(r,s):(c=new f8(e,r,this._context),this._resources[e]=c),c.persistent=n}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const r=this._consumers[e];if(r){for(const s in r){const n=r[s],c=this._resources[n.resourceId];c&&c.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:r,consumerId:s,requestId:n="default"}=t;const{_resources:c,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const f=c[e];if(this._track(s,n,f,r),f)return f.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,r,s){const n=this._consumers,c=n[t]=n[t]||{},l=c[e]||{},f=l.resourceId&&this._resources[l.resourceId];f&&(f.unsubscribe(l),this.prune()),r&&(c[e]=l,l.onChange=s,l.resourceId=r.id,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const m8=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Y_={name:"project32",dependencies:[J_],vs:m8},K_={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Tk},y8=[J_],_8=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function v8(i){const t=Tf.getDefaultProgramManager(i);for(const e of y8)t.addDefaultModule(e);for(const e of _8)t.addShaderHook(e);return t}const b8="layerManager.setLayers",w8="layerManager.activateViewport";class x8{constructor(t){let{deck:e,stats:r,viewport:s,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};H(this,"layers",void 0),H(this,"context",void 0),H(this,"resourceManager",void 0),H(this,"_lastRenderedLayers",[]),H(this,"_needsRedraw",!1),H(this,"_needsUpdate",!1),H(this,"_nextLayers",null),H(this,"_debug",!1),H(this,"activateViewport",c=>{Xn(w8,this,c),c&&(this.context.viewport=c)}),this.layers=[],this.resourceManager=new g8({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&v8(t),stats:r||new bf({id:"deck.gl"}),viewport:s||new $d({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:n||new k3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(t);e=e||s}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(e=>t.find(r=>e.id.indexOf(r)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){Xn(b8,this,e,t),this._lastRenderedLayers=t;const r=Nm(t,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,r){r.raiseError(e,"".concat(t," of ").concat(r))}_updateLayers(t,e){const r={};for(const c of t)r[c.id]?fr.warn("Multiple old layers with same id ".concat(c.id))():r[c.id]=c;const s=[];this._updateSublayersRecursively(e,r,s),this._finalizeOldLayers(r);let n=!1;for(const c of s)if(c.hasUniformTransition()){n="Uniform transition in ".concat(c);break}this._needsUpdate=n,this.layers=s}_updateSublayersRecursively(t,e,r){for(const s of t){s.context=this.context;const n=e[s.id];n===null&&fr.warn("Multiple new layers with same id ".concat(s.id))(),e[s.id]=null;let c=null;try{this._debug&&n!==s&&s.validateProps(),n?(this._transferLayerState(n,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),c=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}c&&this._updateSublayersRecursively(c,e,r)}}_finalizeOldLayers(t){for(const e in t){const r=t[e];r&&this._finalizeLayer(r)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=yd.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=yd.MATCHED,e!==t&&(t.lifecycle=yd.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=yd.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=yd.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function ac(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!ac(i[r],t[r],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const r=Object.keys(i),s=Object.keys(t);if(r.length!==s.length)return!1;for(const n of r)if(!t.hasOwnProperty(n)||!ac(i[n],t[n],e-1))return!1;return!0}return!1}class A8{constructor(t){H(this,"width",void 0),H(this,"height",void 0),H(this,"views",void 0),H(this,"viewState",void 0),H(this,"controllers",void 0),H(this,"timeline",void 0),H(this,"_viewports",void 0),H(this,"_viewportMap",void 0),H(this,"_isUpdating",void 0),H(this,"_needsRedraw",void 0),H(this,"_needsUpdate",void 0),H(this,"_eventManager",void 0),H(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,r=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(r):r}getViewport(t){return this._viewportMap[t]}unproject(t,e){const r=this.getViewports(),s={x:t[0],y:t[1]};for(let n=r.length-1;n>=0;--n){const c=r[n];if(c.containsPixel(s)){const l=t.slice();return l[0]-=c.x,l[1]-=c.y,c.unproject(l,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Nm(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!ac(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):fr.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const r=e.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var n;return(n=this.getView(t.id))===null||n===void 0?void 0:n.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(t,e,r,s){const n=t.controller;if(n&&r){const c={...e,...n,id:t.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==n.type)&&(s=this._createController(t,c)),s&&s.setProps(c),s}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=t.length;s--;){const n=t[s],c=this.getViewState(n),l=n.makeViewport({viewState:c,width:this.width,height:this.height});let f=e[n.id];const y=!!n.controller;y&&!f&&(r=!0),(r||!y)&&f&&(f.finalize(),f=null),this.controllers[n.id]=this._updateController(n,c,l,f),l&&this._viewports.unshift(l)}for(const s in e){const n=e[s];n&&!this.controllers[s]&&n.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((r,s)=>!t[s].equals(e[s]))}}const S8=/([0-9]+\.?[0-9]*)(%|px)/;function Mh(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const t=S8.exec(i);if(t&&t.length>=3){const e=t[2]==="%",r=parseFloat(t[1]);return{position:e?r/100:r,relative:e}}default:throw new Error("Could not parse position string ".concat(i))}}function Bh(i,t){return i.relative?Math.round(i.position*t):i.position}function Pn(i,t){if(!i)throw new Error(t||"deck.gl: assertion failed.")}class E8{constructor(t){H(this,"id",void 0),H(this,"viewportInstance",void 0),H(this,"_x",void 0),H(this,"_y",void 0),H(this,"_width",void 0),H(this,"_height",void 0),H(this,"_padding",void 0),H(this,"props",void 0);const{id:e,x:r=0,y:s=0,width:n="100%",height:c="100%",padding:l=null,viewportInstance:f}=t||{};Pn(!f||f instanceof $d),this.viewportInstance=f,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Mh(r),this._y=Mh(s),this._width=Mh(n),this._height=Mh(c),this._padding=l&&{left:Mh(l.left||0),right:Mh(l.right||0),top:Mh(l.top||0),bottom:Mh(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&ac(this.props,t.props,2)}makeViewport(t){let{width:e,height:r,viewState:s}=t;if(this.viewportInstance)return this.viewportInstance;s=this.filterViewState(s);const n=this.getDimensions({width:e,height:r});return!n.height||!n.width?null:new this.ViewportType({...s,...this.props,...n})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const r in this.props.viewState)r!=="id"&&(e[r]=this.props.viewState[r]);return e}return t}getDimensions(t){let{width:e,height:r}=t;const s={x:Bh(this._x,e),y:Bh(this._y,r),width:Bh(this._width,e),height:Bh(this._height,r)};return this._padding&&(s.padding={left:Bh(this._padding.left,e),top:Bh(this._padding.top,r),right:Bh(this._padding.right,e),bottom:Bh(this._padding.bottom,r)}),s}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class If{constructor(t){H(this,"_inProgress",void 0),H(this,"_handle",void 0),H(this,"_timeline",void 0),H(this,"time",void 0),H(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,r;this.cancel(),this.settings=t,this._inProgress=!0,(e=(r=this.settings).onStart)===null||e===void 0||e.call(r,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const qw=()=>{},S1={BREAK:1,SNAP_TO_END:2,IGNORE:3},C8=i=>i,T8=S1.BREAK;class P8{constructor(t){H(this,"getControllerState",void 0),H(this,"props",void 0),H(this,"propsInTransition",void 0),H(this,"transition",void 0),H(this,"onViewStateChange",void 0),H(this,"onStateChange",void 0),H(this,"_onTransitionUpdate",e=>{const{time:r,settings:{interpolator:s,startProps:n,endProps:c,duration:l,easing:f}}=e,y=f(r/l),A=s.interpolateProps(n,c,y);this.propsInTransition=this.getControllerState({...this.props,...A}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new If(t.timeline),this.onViewStateChange=t.onViewStateChange||qw,this.onStateChange=t.onStateChange||qw}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const r=this.props;if(this.props=t,!r||this._shouldIgnoreViewportChange(r,t))return!1;if(this._isTransitionEnabled(t)){let s=r;if(this.transition.inProgress){const{interruption:n,endProps:c}=this.transition.settings;s={...r,...n===S1.SNAP_TO_END?c:this.propsInTransition||r}}this._triggerTransition(s,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:r}=t;return(e>0||e==="auto")&&!!r}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===S1.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const r=this.getControllerState(t),s=this.getControllerState(e).shortestPathFrom(r),n=e.transitionInterpolator,c=n.getDuration?n.getDuration(t,e):e.transitionDuration;if(c===0)return;const l=n.initializeProps(t,s);this.propsInTransition={};const f={duration:c,easing:e.transitionEasing||C8,interpolator:n,interruption:e.transitionInterruption||T8,startProps:l.start,endProps:l.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class I8{constructor(t){H(this,"_propsToCompare",void 0),H(this,"_propsToExtract",void 0),H(this,"_requiredProps",void 0);const{compare:e,extract:r,required:s}=t;this._propsToCompare=e,this._propsToExtract=r||e,this._requiredProps=s}arePropsEqual(t,e){for(const r of this._propsToCompare)if(!(r in t)||!(r in e)||!xl(t[r],e[r]))return!1;return!0}initializeProps(t,e){const r={},s={};for(const n of this._propsToExtract)(n in t||n in e)&&(r[n]=t[n],s[n]=e[n]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const r=t[e];Pn(Number.isFinite(r)||Array.isArray(r),"".concat(e," is required for transition"))})}}const L8=["longitude","latitude","zoom","bearing","pitch"],M8=["longitude","latitude","zoom"];class X3 extends I8{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,r=Array.isArray(t)?{}:t;r.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:L8,required:M8},super(r.transitionProps),H(this,"opts",void 0),this.opts=r}initializeProps(t,e){const r=super.initializeProps(t,e),{makeViewport:s,around:n}=this.opts;if(s&&n){const c=s(t),l=s(e),f=c.unproject(n);r.start.around=n,Object.assign(r.end,{around:l.project(f),aroundPosition:f,width:e.width,height:e.height})}return r}interpolateProps(t,e,r){const s={};for(const n of this._propsToExtract)s[n]=mm(t[n]||0,e[n]||0,r);if(e.aroundPosition&&this.opts.makeViewport){const n=this.opts.makeViewport({...e,...s});Object.assign(s,n.panByPosition(e.aroundPosition,mm(t.around,e.around,r)))}return s}}const Rh={transitionDuration:0},B8=300,Sg=i=>1-(1-i)*(1-i),hd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},gu={};class R8{constructor(t){H(this,"props",void 0),H(this,"state",{}),H(this,"transitionManager",void 0),H(this,"eventManager",void 0),H(this,"onViewStateChange",void 0),H(this,"onStateChange",void 0),H(this,"makeViewport",void 0),H(this,"_controllerState",void 0),H(this,"_events",{}),H(this,"_interactionState",{isDragging:!1}),H(this,"_customEvents",[]),H(this,"_eventStartBlocked",null),H(this,"_panMove",!1),H(this,"invertPan",!1),H(this,"dragMode","rotate"),H(this,"inertia",0),H(this,"scrollZoom",!0),H(this,"dragPan",!0),H(this,"dragRotate",!0),H(this,"doubleClickZoom",!0),H(this,"touchZoom",!0),H(this,"touchRotate",!1),H(this,"keyboard",!0),this.transitionManager=new P8({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:r}=this.props,{offsetCenter:s}=t;return[s.x-e,s.y-r]}isPointInBounds(t,e){const{width:r,height:s}=this.props;if(e&&e.handled)return!1;const n=t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=s;return n&&e&&e.stopPropagation(),n}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?B8:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:n=!0,doubleClickZoom:c=!0,touchZoom:l=!0,touchRotate:f=!1,keyboard:y=!0}=t,A=!!this.onViewStateChange;this.toggleEvents(hd.WHEEL,A&&r),this.toggleEvents(hd.PAN,A),this.toggleEvents(hd.PINCH,A&&(l||f)),this.toggleEvents(hd.TRIPLE_PAN,A&&f),this.toggleEvents(hd.DOUBLE_TAP,A&&c),this.toggleEvents(hd.KEYBOARD,A&&y),this.scrollZoom=r,this.dragPan=s,this.dragRotate=n,this.doubleClickZoom=c,this.touchZoom=l,this.touchRotate=f,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(r=>{this._events[r]!==e&&(this._events[r]=e,e?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={...t.getViewportProps(),...e},n=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(r),n){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:c})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let r=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:e});return this._panMove=r,this.updateViewport(s,Rh,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),r=this.controllerState.pan({pos:e});return this.updateViewport(r,Rh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const r=this.getCenter(t),s=[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2],n=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Sg},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),r=this.controllerState.rotate({pos:e});return this.updateViewport(r,Rh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const r=this.getCenter(t),s=[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2],n=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Sg},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:n}=t;let c=2/(1+Math.exp(-Math.abs(n*r)));n<0&&c!==0&&(c=1/c);const l=this.controllerState.zoom({pos:e,scale:c});return this.updateViewport(l,{...this._getTransitionProps({around:e}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.controllerState.rotateStart({pos:e});return this.updateViewport(r,Rh,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const r=this.controllerState.rotate({pos:e});return this.updateViewport(r,Rh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const r=this.getCenter(t),s=[r[0],r[1]+=t.velocityY*e/2],n=this.controllerState.rotate({pos:s});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Sg},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return gu._startPinchRotation=t.rotation,gu._lastPinchEvent=t,this.updateViewport(r,Rh,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:r}=t,s=this.getCenter(t);e=e.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=t;e=e.rotate({deltaAngleX:gu._startPinchRotation-r})}return this.updateViewport(e,Rh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),gu._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:r}=gu;if(this.touchZoom&&e&&r&&t.scale!==r.scale){const s=this.getCenter(t);let n=this.controllerState.rotateEnd();const c=Math.log2(t.scale),l=(c-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),f=Math.pow(2,c+l*e/2);n=n.zoom({pos:s,scale:f}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:s}),transitionDuration:e,transitionEasing:Sg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return gu._startPinchRotation=null,gu._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:e,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:n,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let f;const y={};switch(t.srcEvent.code){case"Minus":f=e?l.zoomOut(r).zoomOut(r):l.zoomOut(r),y.isZooming=!0;break;case"Equal":f=e?l.zoomIn(r).zoomIn(r):l.zoomIn(r),y.isZooming=!0;break;case"ArrowLeft":e?(f=l.rotateLeft(n),y.isRotating=!0):(f=l.moveLeft(s),y.isPanning=!0);break;case"ArrowRight":e?(f=l.rotateRight(n),y.isRotating=!0):(f=l.moveRight(s),y.isPanning=!0);break;case"ArrowUp":e?(f=l.rotateUp(c),y.isRotating=!0):(f=l.moveUp(s),y.isPanning=!0);break;case"ArrowDown":e?(f=l.rotateDown(c),y.isRotating=!0):(f=l.moveDown(s),y.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),y),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?Rh:t?{...e,transitionInterpolator:new X3({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class k8{constructor(t,e){H(this,"_viewportProps",void 0),H(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Hw=5,O8=1.2;class F8 extends k8{constructor(t){const{width:e,height:r,latitude:s,longitude:n,zoom:c,bearing:l=0,pitch:f=0,altitude:y=1.5,position:A=[0,0,0],maxZoom:T=20,minZoom:P=0,maxPitch:L=60,minPitch:D=0,startPanLngLat:j,startZoomLngLat:X,startRotatePos:Z,startBearing:$,startPitch:ht,startZoom:_t,normalize:Mt=!0}=t;Pn(Number.isFinite(n)),Pn(Number.isFinite(s)),Pn(Number.isFinite(c)),super({width:e,height:r,latitude:s,longitude:n,zoom:c,bearing:l,pitch:f,altitude:y,maxZoom:T,minZoom:P,maxPitch:L,minPitch:D,normalize:Mt,position:A},{startPanLngLat:j,startZoomLngLat:X,startRotatePos:Z,startBearing:$,startPitch:ht,startZoom:_t}),H(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:r}=t;const s=this.getState().startPanLngLat||this._unproject(r);if(!s)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(s,e);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:r=0,deltaAngleY:s=0}=t;const{startRotatePos:n,startBearing:c,startPitch:l}=this.getState();if(!n||c===void 0||l===void 0)return this;let f;return e?f=this._getNewRotation(e,n,l,c):f={bearing:c+r,pitch:l+s},this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:r,scale:s}=t,{startZoom:n,startZoomLngLat:c}=this.getState();if(c||(n=this.getViewportProps().zoom,c=this._unproject(r)||this._unproject(e)),!c)return this;const{maxZoom:l,minZoom:f}=this.getViewportProps();let y=n+Math.log2(s);y=Gc(y,f,l);const A=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...A.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:n}=r;return Math.abs(s-e.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(n-e.longitude)>180&&(r.longitude=n<0?n+360:n-360),r}applyConstraints(t){const{maxZoom:e,minZoom:r,zoom:s}=t;t.zoom=Gc(s,r,e);const{maxPitch:n,minPitch:c,pitch:l}=t;t.pitch=Gc(l,c,n);const{normalize:f=!0}=t;return f&&Object.assign(t,jO(t)),t}_zoomFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.zoom({pos:[e/2,r/2],scale:t})}_panFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.pan({startPos:[e/2,r/2],pos:[e/2+t[0],r/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,r,s){const n=t[0]-e[0],c=t[1]-e[1],l=t[1],f=e[1],{width:y,height:A}=this.getViewportProps(),T=n/y;let P=0;c>0?Math.abs(A-f)>Hw&&(P=c/(f-A)*O8):c<0&&f>Hw&&(P=1-l/f),P=Gc(P,-1,1);const{minPitch:L,maxPitch:D}=this.getViewportProps(),j=s+180*T;let X=r;return P>0?X=r+P*(D-r):P<0&&(X=r-P*(L-r)),{pitch:X,bearing:j}}}class N8 extends R8{constructor(){super(...arguments),H(this,"ControllerState",F8),H(this,"transition",{transitionDuration:300,transitionInterpolator:new X3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),H(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class Q_ extends E8{get ViewportType(){return Ru}get ControllerType(){return N8}}H(Q_,"displayName","MapView");const D8=new $_;function z8(i,t){var e,r;const s=(e=i.order)!==null&&e!==void 0?e:1/0,n=(r=t.order)!==null&&r!==void 0?r:1/0;return s-n}class U8{constructor(){H(this,"effects",void 0),H(this,"_resolvedEffects",[]),H(this,"_defaultEffects",[]),H(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(r=>r.id===t.id)){const r=e.findIndex(s=>z8(s,t)>0);r<0?e.push(t):e.splice(r,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(ac(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const s of this.effects)e[s.id]=s;const r=[];for(const s of t){const n=e[s.id];n&&n!==s?n.setProps?(n.setProps(s.props),r.push(n)):(n.cleanup(),r.push(s)):r.push(s),delete e[s.id]}for(const s in e)e[s].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),t.some(s=>s instanceof $_)||this._resolvedEffects.push(D8),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class j8 extends W_{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const G8="deckRenderer.renderLayers";class V8{constructor(t){H(this,"gl",void 0),H(this,"layerFilter",void 0),H(this,"drawPickingColors",void 0),H(this,"drawLayersPass",void 0),H(this,"pickLayersPass",void 0),H(this,"renderCount",void 0),H(this,"_needsRedraw",void 0),H(this,"renderBuffers",void 0),H(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new j8(t),this.pickLayersPass=new W3(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||Ks.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,n=e.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,Xn(G8,this,n,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const r of t)e.preRenderStats[r.id]=r.preRender(this.gl,e),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new Ks(this.gl),new Ks(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:r}=this,s={...e,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const n of t)if(n.postRender){if(n.id===this.lastPostProcessEffect){s.target=e.target,n.postRender(this.gl,s);break}const c=n.postRender(this.gl,s);s.inputBuffer=c,s.swapBuffer=c===r[0]?r[1]:r[0]}}}const q8={pickedColor:null,pickedObjectIndex:-1};function H8(i){let{pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:s,deviceRadius:n,deviceRect:c}=i;const{x:l,y:f,width:y,height:A}=c;let T=n*n,P=-1,L=0;for(let D=0;D<A;D++){const j=D+f-s,X=j*j;if(X>T)L+=4*y;else for(let Z=0;Z<y;Z++){if(t[L+3]-1>=0){const $=Z+l-r,ht=$*$+X;ht<=T&&(T=ht,P=L)}L+=4}}if(P>=0){const D=t.slice(P,P+4),j=e(D);if(j){const X=Math.floor(P/4/y),Z=P/4-X*y;return{...j,pickedColor:D,pickedX:l+Z,pickedY:f+X}}fr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return q8}function W8(i){let{pickedColors:t,decodePickingColor:e}=i;const r=new Map;if(t){for(let s=0;s<t.length;s+=4)if(t[s+3]-1>=0){const n=t.slice(s,s+4),c=n.join(",");if(!r.has(c)){const l=e(n);l?r.set(c,{...l,color:n}):fr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function Z3(i){let{pickInfo:t,viewports:e,pixelRatio:r,x:s,y:n,z:c}=i,l=e[0];e.length>1&&(l=X8((t==null?void 0:t.pickedViewports)||e,{x:s,y:n}));let f;if(l){const y=[s-l.x,n-l.y];c!==void 0&&(y[2]=c),f=l.unproject(y)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:s,y:n,pixel:[s,n],coordinate:f,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function J8(i){const{pickInfo:t,lastPickedInfo:e,mode:r,layers:s}=i,{pickedColor:n,pickedLayer:c,pickedObjectIndex:l}=t,f=c?[c]:[];if(r==="hover"){const T=e.index,P=e.layerId,L=c?c.props.id:null;if(L!==P||l!==T){if(L!==P){const D=s.find(j=>j.props.id===P);D&&f.unshift(D)}e.layerId=L,e.index=l,e.info=null}}const y=Z3(i),A=new Map;return A.set(null,y),f.forEach(T=>{let P={...y};T===c&&(P.color=n,P.index=l,P.picked=!0),P=$3({layer:T,info:P,mode:r});const L=P.layer;T===c&&r==="hover"&&(e.info=P),A.set(L.id,P),r==="hover"&&L.updateAutoHighlight(P)}),A}function $3(i){let{layer:t,info:e,mode:r}=i;for(;t&&e;){const s=e.layer||null;e.sourceLayer=s,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:s}),t=t.parent}return e}function X8(i,t){for(let e=i.length-1;e>=0;e--){const r=i[e];if(r.containsPixel(t))return r}return i[0]}class Z8{constructor(t){H(this,"gl",void 0),H(this,"pickingFBO",void 0),H(this,"depthFBO",void 0),H(this,"pickLayersPass",void 0),H(this,"layerFilter",void 0),H(this,"lastPickedInfo",void 0),H(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new W3(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:r,layers:s,viewports:n}=t,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const l=c&&c.layer&&c.layer.id,f=c&&c.viewport&&c.viewport.id,y=l?s.find(P=>P.id===l):null,A=f&&n.find(P=>P.id===f)||n[0],T=A&&A.unproject([e-A.x,r-A.y]);return{...c,x:e,y:r,viewport:A,coordinate:T,layer:y}}_resizeBuffer(){var t,e;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ks(r),Ks.isSupported(r,{colorBufferFloat:!0}))){const s=new Ks(r);s.attach({36064:new xa(r,{format:Ki(r)?34836:6408,type:5126})}),this.depthFBO=s}(t=this.pickingFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return e.length?e:null}_pickClosestObject(t){let{layers:e,views:r,viewports:s,x:n,y:c,radius:l=0,depth:f=1,mode:y="query",unproject3D:A,onViewportActive:T,effects:P}=t;const L=this._getPickable(e),D=Dd(this.gl);if(!L)return{result:[],emptyInfo:Z3({viewports:s,x:n,y:c,pixelRatio:D})};this._resizeBuffer();const j=$0(this.gl,[n,c],!0),X=[j.x+Math.floor(j.width/2),j.y+Math.floor(j.height/2)],Z=Math.round(l*D),{width:$,height:ht}=this.pickingFBO,_t=this._getPickingRect({deviceX:X[0],deviceY:X[1],deviceRadius:Z,deviceWidth:$,deviceHeight:ht}),Mt={x:n-l,y:c-l,width:l*2+1,height:l*2+1};let Nt;const Rt=[],xt=new Set;for(let qt=0;qt<f;qt++){let zt;if(_t){const pt=this._drawAndSample({layers:L,views:r,viewports:s,onViewportActive:T,deviceRect:_t,cullRect:Mt,effects:P,pass:"picking:".concat(y)});zt=H8({...pt,deviceX:X[0],deviceY:X[1],deviceRadius:Z,deviceRect:_t})}else zt={pickedColor:null,pickedObjectIndex:-1};let ct;if(zt.pickedLayer&&A&&this.depthFBO){const{pickedColors:pt}=this._drawAndSample({layers:[zt.pickedLayer],views:r,viewports:s,onViewportActive:T,deviceRect:{x:zt.pickedX,y:zt.pickedY,width:1,height:1},cullRect:Mt,effects:P,pass:"picking:".concat(y,":z")},!0);pt[3]&&(ct=pt[0])}zt.pickedLayer&&qt+1<f&&(xt.add(zt.pickedLayer),zt.pickedLayer.disablePickingIndex(zt.pickedObjectIndex)),Nt=J8({pickInfo:zt,lastPickedInfo:this.lastPickedInfo,mode:y,layers:L,viewports:s,x:n,y:c,z:ct,pixelRatio:D});for(const pt of Nt.values())pt.layer&&Rt.push(pt);if(!zt.pickedColor)break}for(const qt of xt)qt.restorePickingColors();return{result:Rt,emptyInfo:Nt.get(null)}}_pickVisibleObjects(t){let{layers:e,views:r,viewports:s,x:n,y:c,width:l=1,height:f=1,mode:y="query",maxObjects:A=null,onViewportActive:T,effects:P}=t;const L=this._getPickable(e);if(!L)return[];this._resizeBuffer();const D=Dd(this.gl),j=$0(this.gl,[n,c],!0),X=j.x,Z=j.y+j.height,$=$0(this.gl,[n+l,c+f],!0),ht=$.x+$.width,_t=$.y,Mt={x:X,y:_t,width:ht-X,height:Z-_t},Nt=this._drawAndSample({layers:L,views:r,viewports:s,onViewportActive:T,deviceRect:Mt,cullRect:{x:n,y:c,width:l,height:f},effects:P,pass:"picking:".concat(y)}),Rt=W8(Nt),xt=new Map,qt=Number.isFinite(A);for(let ct=0;ct<Rt.length;ct++){var zt;if(qt&&A&&xt.size>=A)break;const pt=Rt[ct];let Bt={color:pt.pickedColor,layer:null,index:pt.pickedObjectIndex,picked:!0,x:n,y:c,pixelRatio:D};Bt=$3({layer:pt.pickedLayer,info:Bt,mode:y});const bt=(zt=Bt.object)!==null&&zt!==void 0?zt:"".concat(Bt.layer.id,"[").concat(Bt.index,"]");xt.has(bt)||xt.set(bt,Bt)}return Array.from(xt.values())}_drawAndSample(t){let{layers:e,views:r,viewports:s,onViewportActive:n,deviceRect:c,cullRect:l,effects:f,pass:y}=t,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const T=A?this.depthFBO:this.pickingFBO,P={layers:e,layerFilter:this.layerFilter,views:r,viewports:s,onViewportActive:n,pickingFBO:T,deviceRect:c,cullRect:l,effects:f,pass:y,pickZ:A,preRenderStats:{}};for(const ht of f)ht.useInPicking&&(P.preRenderStats[ht.id]=ht.preRender(this.gl,P));const{decodePickingColor:L}=this.pickLayersPass.render(P),{x:D,y:j,width:X,height:Z}=c,$=new(A?Float32Array:Uint8Array)(X*Z*4);return Fm(T,{sourceX:D,sourceY:j,sourceWidth:X,sourceHeight:Z,target:$}),{pickedColors:$,decodePickingColor:L}}_getPickingRect(t){let{deviceX:e,deviceY:r,deviceRadius:s,deviceWidth:n,deviceHeight:c}=t;const l=Math.max(0,e-s),f=Math.max(0,r-s),y=Math.min(n,e+s+1)-l,A=Math.min(c,r+s+1)-f;return y<=0||A<=0?null:{x:l,y:f,width:y,height:A}}}const $8={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Y8{constructor(t){H(this,"el",null),H(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,$8),e.appendChild(this.el))}setTooltip(t,e,r){const s=this.el;if(s){if(typeof t=="string")s.innerText=t;else if(t)t.text&&(s.innerText=t.text),t.html&&(s.innerHTML=t.html),t.className&&(s.className=t.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(e,"px, ").concat(r,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(s.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Y3={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(t,e,r,s){var n=["","webkit","Moz","MS","ms","o"],c=e.createElement("div"),l="function",f=Math.round,y=Math.abs,A=Date.now;function T(st,yt,Ot){return setTimeout(ht(st,Ot),yt)}function P(st,yt,Ot){return Array.isArray(st)?(L(st,Ot[yt],Ot),!0):!1}function L(st,yt,Ot){var ce;if(st)if(st.forEach)st.forEach(yt,Ot);else if(st.length!==s)for(ce=0;ce<st.length;)yt.call(Ot,st[ce],ce,st),ce++;else for(ce in st)st.hasOwnProperty(ce)&&yt.call(Ot,st[ce],ce,st)}function D(st,yt,Ot){var ce="DEPRECATED METHOD: "+yt+`
`+Ot+` AT 
`;return function(){var Ee=new Error("get-stack-trace"),hi=Ee&&Ee.stack?Ee.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ti=t.console&&(t.console.warn||t.console.log);return Ti&&Ti.call(t.console,ce,hi),st.apply(this,arguments)}}var j;typeof Object.assign!="function"?j=function(st){if(st===s||st===null)throw new TypeError("Cannot convert undefined or null to object");for(var yt=Object(st),Ot=1;Ot<arguments.length;Ot++){var ce=arguments[Ot];if(ce!==s&&ce!==null)for(var Ee in ce)ce.hasOwnProperty(Ee)&&(yt[Ee]=ce[Ee])}return yt}:j=Object.assign;var X=D(function(st,yt,Ot){for(var ce=Object.keys(yt),Ee=0;Ee<ce.length;)(!Ot||Ot&&st[ce[Ee]]===s)&&(st[ce[Ee]]=yt[ce[Ee]]),Ee++;return st},"extend","Use `assign`."),Z=D(function(st,yt){return X(st,yt,!0)},"merge","Use `assign`.");function $(st,yt,Ot){var ce=yt.prototype,Ee;Ee=st.prototype=Object.create(ce),Ee.constructor=st,Ee._super=ce,Ot&&j(Ee,Ot)}function ht(st,yt){return function(){return st.apply(yt,arguments)}}function _t(st,yt){return typeof st==l?st.apply(yt&&yt[0]||s,yt):st}function Mt(st,yt){return st===s?yt:st}function Nt(st,yt,Ot){L(zt(yt),function(ce){st.addEventListener(ce,Ot,!1)})}function Rt(st,yt,Ot){L(zt(yt),function(ce){st.removeEventListener(ce,Ot,!1)})}function xt(st,yt){for(;st;){if(st==yt)return!0;st=st.parentNode}return!1}function qt(st,yt){return st.indexOf(yt)>-1}function zt(st){return st.trim().split(/\s+/g)}function ct(st,yt,Ot){if(st.indexOf&&!Ot)return st.indexOf(yt);for(var ce=0;ce<st.length;){if(Ot&&st[ce][Ot]==yt||!Ot&&st[ce]===yt)return ce;ce++}return-1}function pt(st){return Array.prototype.slice.call(st,0)}function Bt(st,yt,Ot){for(var ce=[],Ee=[],hi=0;hi<st.length;){var Ti=st[hi][yt];ct(Ee,Ti)<0&&ce.push(st[hi]),Ee[hi]=Ti,hi++}return ce=ce.sort(function(cr,ls){return cr[yt]>ls[yt]}),ce}function bt(st,yt){for(var Ot,ce,Ee=yt[0].toUpperCase()+yt.slice(1),hi=0;hi<n.length;){if(Ot=n[hi],ce=Ot?Ot+Ee:yt,ce in st)return ce;hi++}return s}var ne=1;function oe(){return ne++}function le(st){var yt=st.ownerDocument||st;return yt.defaultView||yt.parentWindow||t}var Qt=/mobile|tablet|ip(ad|hone|od)|android/i,fe="ontouchstart"in t,de=bt(t,"PointerEvent")!==s,Me=fe&&Qt.test(navigator.userAgent),nt="touch",Et="pen",Lt="mouse",Gt="kinect",Wt=25,$t=1,ee=2,Kt=4,Ce=8,Ie=1,Re=2,Fe=4,Ze=8,he=16,ot=Re|Fe,mi=Ze|he,ri=ot|mi,_e=["x","y"],Se=["clientX","clientY"];function Le(st,yt){var Ot=this;this.manager=st,this.callback=yt,this.element=st.element,this.target=st.options.inputTarget,this.domHandler=function(ce){_t(st.options.enable,[st])&&Ot.handler(ce)},this.init()}Le.prototype={handler:function(){},init:function(){this.evEl&&Nt(this.element,this.evEl,this.domHandler),this.evTarget&&Nt(this.target,this.evTarget,this.domHandler),this.evWin&&Nt(le(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Rt(this.element,this.evEl,this.domHandler),this.evTarget&&Rt(this.target,this.evTarget,this.domHandler),this.evWin&&Rt(le(this.element),this.evWin,this.domHandler)}};function Ne(st){var yt,Ot=st.options.inputClass;return Ot?yt=Ot:de?yt=K:Me?yt=Jt:fe?yt=qe:yt=je,new yt(st,ci)}function ci(st,yt,Ot){var ce=Ot.pointers.length,Ee=Ot.changedPointers.length,hi=yt&$t&&ce-Ee===0,Ti=yt&(Kt|Ce)&&ce-Ee===0;Ot.isFirst=!!hi,Ot.isFinal=!!Ti,hi&&(st.session={}),Ot.eventType=yt,Ei(st,Ot),st.emit("hammer.input",Ot),st.recognize(Ot),st.session.prevInput=Ot}function Ei(st,yt){var Ot=st.session,ce=yt.pointers,Ee=ce.length;Ot.firstInput||(Ot.firstInput=Vi(yt)),Ee>1&&!Ot.firstMultiple?Ot.firstMultiple=Vi(yt):Ee===1&&(Ot.firstMultiple=!1);var hi=Ot.firstInput,Ti=Ot.firstMultiple,cr=Ti?Ti.center:hi.center,ls=yt.center=be(ce);yt.timeStamp=A(),yt.deltaTime=yt.timeStamp-hi.timeStamp,yt.angle=Lr(cr,ls),yt.distance=De(cr,ls),Ci(Ot,yt),yt.offsetDirection=Ai(yt.deltaX,yt.deltaY);var ds=ai(yt.deltaTime,yt.deltaX,yt.deltaY);yt.overallVelocityX=ds.x,yt.overallVelocityY=ds.y,yt.overallVelocity=y(ds.x)>y(ds.y)?ds.x:ds.y,yt.scale=Ti?vi(Ti.pointers,ce):1,yt.rotation=Ti?me(Ti.pointers,ce):0,yt.maxPointers=Ot.prevInput?yt.pointers.length>Ot.prevInput.maxPointers?yt.pointers.length:Ot.prevInput.maxPointers:yt.pointers.length,Ii(Ot,yt);var Qi=st.element;xt(yt.srcEvent.target,Qi)&&(Qi=yt.srcEvent.target),yt.target=Qi}function Ci(st,yt){var Ot=yt.center,ce=st.offsetDelta||{},Ee=st.prevDelta||{},hi=st.prevInput||{};(yt.eventType===$t||hi.eventType===Kt)&&(Ee=st.prevDelta={x:hi.deltaX||0,y:hi.deltaY||0},ce=st.offsetDelta={x:Ot.x,y:Ot.y}),yt.deltaX=Ee.x+(Ot.x-ce.x),yt.deltaY=Ee.y+(Ot.y-ce.y)}function Ii(st,yt){var Ot=st.lastInterval||yt,ce=yt.timeStamp-Ot.timeStamp,Ee,hi,Ti,cr;if(yt.eventType!=Ce&&(ce>Wt||Ot.velocity===s)){var ls=yt.deltaX-Ot.deltaX,ds=yt.deltaY-Ot.deltaY,Qi=ai(ce,ls,ds);hi=Qi.x,Ti=Qi.y,Ee=y(Qi.x)>y(Qi.y)?Qi.x:Qi.y,cr=Ai(ls,ds),st.lastInterval=yt}else Ee=Ot.velocity,hi=Ot.velocityX,Ti=Ot.velocityY,cr=Ot.direction;yt.velocity=Ee,yt.velocityX=hi,yt.velocityY=Ti,yt.direction=cr}function Vi(st){for(var yt=[],Ot=0;Ot<st.pointers.length;)yt[Ot]={clientX:f(st.pointers[Ot].clientX),clientY:f(st.pointers[Ot].clientY)},Ot++;return{timeStamp:A(),pointers:yt,center:be(yt),deltaX:st.deltaX,deltaY:st.deltaY}}function be(st){var yt=st.length;if(yt===1)return{x:f(st[0].clientX),y:f(st[0].clientY)};for(var Ot=0,ce=0,Ee=0;Ee<yt;)Ot+=st[Ee].clientX,ce+=st[Ee].clientY,Ee++;return{x:f(Ot/yt),y:f(ce/yt)}}function ai(st,yt,Ot){return{x:yt/st||0,y:Ot/st||0}}function Ai(st,yt){return st===yt?Ie:y(st)>=y(yt)?st<0?Re:Fe:yt<0?Ze:he}function De(st,yt,Ot){Ot||(Ot=_e);var ce=yt[Ot[0]]-st[Ot[0]],Ee=yt[Ot[1]]-st[Ot[1]];return Math.sqrt(ce*ce+Ee*Ee)}function Lr(st,yt,Ot){Ot||(Ot=_e);var ce=yt[Ot[0]]-st[Ot[0]],Ee=yt[Ot[1]]-st[Ot[1]];return Math.atan2(Ee,ce)*180/Math.PI}function me(st,yt){return Lr(yt[1],yt[0],Se)+Lr(st[1],st[0],Se)}function vi(st,yt){return De(yt[0],yt[1],Se)/De(st[0],st[1],Se)}var He={mousedown:$t,mousemove:ee,mouseup:Kt},Di="mousedown",Mr="mousemove mouseup";function je(){this.evEl=Di,this.evWin=Mr,this.pressed=!1,Le.apply(this,arguments)}$(je,Le,{handler:function(st){var yt=He[st.type];yt&$t&&st.button===0&&(this.pressed=!0),yt&ee&&st.which!==1&&(yt=Kt),this.pressed&&(yt&Kt&&(this.pressed=!1),this.callback(this.manager,yt,{pointers:[st],changedPointers:[st],pointerType:Lt,srcEvent:st}))}});var Ls={pointerdown:$t,pointermove:ee,pointerup:Kt,pointercancel:Ce,pointerout:Ce},ir={2:nt,3:Et,4:Lt,5:Gt},rr="pointerdown",vt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(rr="MSPointerDown",vt="MSPointerMove MSPointerUp MSPointerCancel");function K(){this.evEl=rr,this.evWin=vt,Le.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$(K,Le,{handler:function(st){var yt=this.store,Ot=!1,ce=st.type.toLowerCase().replace("ms",""),Ee=Ls[ce],hi=ir[st.pointerType]||st.pointerType,Ti=hi==nt,cr=ct(yt,st.pointerId,"pointerId");Ee&$t&&(st.button===0||Ti)?cr<0&&(yt.push(st),cr=yt.length-1):Ee&(Kt|Ce)&&(Ot=!0),!(cr<0)&&(yt[cr]=st,this.callback(this.manager,Ee,{pointers:yt,changedPointers:[st],pointerType:hi,srcEvent:st}),Ot&&yt.splice(cr,1))}});var Q={touchstart:$t,touchmove:ee,touchend:Kt,touchcancel:Ce},rt="touchstart",Ct="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=rt,this.evWin=Ct,this.started=!1,Le.apply(this,arguments)}$(kt,Le,{handler:function(st){var yt=Q[st.type];if(yt===$t&&(this.started=!0),!!this.started){var Ot=Ut.call(this,st,yt);yt&(Kt|Ce)&&Ot[0].length-Ot[1].length===0&&(this.started=!1),this.callback(this.manager,yt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:nt,srcEvent:st})}}});function Ut(st,yt){var Ot=pt(st.touches),ce=pt(st.changedTouches);return yt&(Kt|Ce)&&(Ot=Bt(Ot.concat(ce),"identifier")),[Ot,ce]}var Vt={touchstart:$t,touchmove:ee,touchend:Kt,touchcancel:Ce},St="touchstart touchmove touchend touchcancel";function Jt(){this.evTarget=St,this.targetIds={},Le.apply(this,arguments)}$(Jt,Le,{handler:function(st){var yt=Vt[st.type],Ot=ge.call(this,st,yt);Ot&&this.callback(this.manager,yt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:nt,srcEvent:st})}});function ge(st,yt){var Ot=pt(st.touches),ce=this.targetIds;if(yt&($t|ee)&&Ot.length===1)return ce[Ot[0].identifier]=!0,[Ot,Ot];var Ee,hi,Ti=pt(st.changedTouches),cr=[],ls=this.target;if(hi=Ot.filter(function(ds){return xt(ds.target,ls)}),yt===$t)for(Ee=0;Ee<hi.length;)ce[hi[Ee].identifier]=!0,Ee++;for(Ee=0;Ee<Ti.length;)ce[Ti[Ee].identifier]&&cr.push(Ti[Ee]),yt&(Kt|Ce)&&delete ce[Ti[Ee].identifier],Ee++;if(cr.length)return[Bt(hi.concat(cr),"identifier"),cr]}var ae=2500,se=25;function qe(){Le.apply(this,arguments);var st=ht(this.handler,this);this.touch=new Jt(this.manager,st),this.mouse=new je(this.manager,st),this.primaryTouch=null,this.lastTouches=[]}$(qe,Le,{handler:function(st,yt,Ot){var ce=Ot.pointerType==nt,Ee=Ot.pointerType==Lt;if(!(Ee&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(ce)$e.call(this,yt,Ot);else if(Ee&&si.call(this,Ot))return;this.callback(st,yt,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function $e(st,yt){st&$t?(this.primaryTouch=yt.changedPointers[0].identifier,wi.call(this,yt)):st&(Kt|Ce)&&wi.call(this,yt)}function wi(st){var yt=st.changedPointers[0];if(yt.identifier===this.primaryTouch){var Ot={x:yt.clientX,y:yt.clientY};this.lastTouches.push(Ot);var ce=this.lastTouches,Ee=function(){var hi=ce.indexOf(Ot);hi>-1&&ce.splice(hi,1)};setTimeout(Ee,ae)}}function si(st){for(var yt=st.srcEvent.clientX,Ot=st.srcEvent.clientY,ce=0;ce<this.lastTouches.length;ce++){var Ee=this.lastTouches[ce],hi=Math.abs(yt-Ee.x),Ti=Math.abs(Ot-Ee.y);if(hi<=se&&Ti<=se)return!0}return!1}var Si=bt(c.style,"touchAction"),ki=Si!==s,qi="compute",tr="auto",pi="manipulation",Fi="none",sr="pan-x",Ar="pan-y",Qr=Tl();function nr(st,yt){this.manager=st,this.set(yt)}nr.prototype={set:function(st){st==qi&&(st=this.compute()),ki&&this.manager.element.style&&Qr[st]&&(this.manager.element.style[Si]=st),this.actions=st.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var st=[];return L(this.manager.recognizers,function(yt){_t(yt.options.enable,[yt])&&(st=st.concat(yt.getTouchAction()))}),pn(st.join(" "))},preventDefaults:function(st){var yt=st.srcEvent,Ot=st.offsetDirection;if(this.manager.session.prevented){yt.preventDefault();return}var ce=this.actions,Ee=qt(ce,Fi)&&!Qr[Fi],hi=qt(ce,Ar)&&!Qr[Ar],Ti=qt(ce,sr)&&!Qr[sr];if(Ee){var cr=st.pointers.length===1,ls=st.distance<2,ds=st.deltaTime<250;if(cr&&ls&&ds)return}if(!(Ti&&hi)&&(Ee||hi&&Ot&ot||Ti&&Ot&mi))return this.preventSrc(yt)},preventSrc:function(st){this.manager.session.prevented=!0,st.preventDefault()}};function pn(st){if(qt(st,Fi))return Fi;var yt=qt(st,sr),Ot=qt(st,Ar);return yt&&Ot?Fi:yt||Ot?yt?sr:Ar:qt(st,pi)?pi:tr}function Tl(){if(!ki)return!1;var st={},yt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ot){st[Ot]=yt?t.CSS.supports("touch-action",Ot):!0}),st}var Wi=1,ms=2,Hs=4,Rr=8,kr=Rr,In=16,gr=32;function Or(st){this.options=j({},this.defaults,st||{}),this.id=oe(),this.manager=null,this.options.enable=Mt(this.options.enable,!0),this.state=Wi,this.simultaneous={},this.requireFail=[]}Or.prototype={defaults:{},set:function(st){return j(this.options,st),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(st){if(P(st,"recognizeWith",this))return this;var yt=this.simultaneous;return st=Sr(st,this),yt[st.id]||(yt[st.id]=st,st.recognizeWith(this)),this},dropRecognizeWith:function(st){return P(st,"dropRecognizeWith",this)?this:(st=Sr(st,this),delete this.simultaneous[st.id],this)},requireFailure:function(st){if(P(st,"requireFailure",this))return this;var yt=this.requireFail;return st=Sr(st,this),ct(yt,st)===-1&&(yt.push(st),st.requireFailure(this)),this},dropRequireFailure:function(st){if(P(st,"dropRequireFailure",this))return this;st=Sr(st,this);var yt=ct(this.requireFail,st);return yt>-1&&this.requireFail.splice(yt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(st){return!!this.simultaneous[st.id]},emit:function(st){var yt=this,Ot=this.state;function ce(Ee){yt.manager.emit(Ee,st)}Ot<Rr&&ce(yt.options.event+Ka(Ot)),ce(yt.options.event),st.additionalEvent&&ce(st.additionalEvent),Ot>=Rr&&ce(yt.options.event+Ka(Ot))},tryEmit:function(st){if(this.canEmit())return this.emit(st);this.state=gr},canEmit:function(){for(var st=0;st<this.requireFail.length;){if(!(this.requireFail[st].state&(gr|Wi)))return!1;st++}return!0},recognize:function(st){var yt=j({},st);if(!_t(this.options.enable,[this,yt])){this.reset(),this.state=gr;return}this.state&(kr|In|gr)&&(this.state=Wi),this.state=this.process(yt),this.state&(ms|Hs|Rr|In)&&this.tryEmit(yt)},process:function(st){},getTouchAction:function(){},reset:function(){}};function Ka(st){return st&In?"cancel":st&Rr?"end":st&Hs?"move":st&ms?"start":""}function Ms(st){return st==he?"down":st==Ze?"up":st==Re?"left":st==Fe?"right":""}function Sr(st,yt){var Ot=yt.manager;return Ot?Ot.get(st):st}function Ji(){Or.apply(this,arguments)}$(Ji,Or,{defaults:{pointers:1},attrTest:function(st){var yt=this.options.pointers;return yt===0||st.pointers.length===yt},process:function(st){var yt=this.state,Ot=st.eventType,ce=yt&(ms|Hs),Ee=this.attrTest(st);return ce&&(Ot&Ce||!Ee)?yt|In:ce||Ee?Ot&Kt?yt|Rr:yt&ms?yt|Hs:ms:gr}});function Ws(){Ji.apply(this,arguments),this.pX=null,this.pY=null}$(Ws,Ji,{defaults:{event:"pan",threshold:10,pointers:1,direction:ri},getTouchAction:function(){var st=this.options.direction,yt=[];return st&ot&&yt.push(Ar),st&mi&&yt.push(sr),yt},directionTest:function(st){var yt=this.options,Ot=!0,ce=st.distance,Ee=st.direction,hi=st.deltaX,Ti=st.deltaY;return Ee&yt.direction||(yt.direction&ot?(Ee=hi===0?Ie:hi<0?Re:Fe,Ot=hi!=this.pX,ce=Math.abs(st.deltaX)):(Ee=Ti===0?Ie:Ti<0?Ze:he,Ot=Ti!=this.pY,ce=Math.abs(st.deltaY))),st.direction=Ee,Ot&&ce>yt.threshold&&Ee&yt.direction},attrTest:function(st){return Ji.prototype.attrTest.call(this,st)&&(this.state&ms||!(this.state&ms)&&this.directionTest(st))},emit:function(st){this.pX=st.deltaX,this.pY=st.deltaY;var yt=Ms(st.direction);yt&&(st.additionalEvent=this.options.event+yt),this._super.emit.call(this,st)}});function mr(){Ji.apply(this,arguments)}$(mr,Ji,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Fi]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.scale-1)>this.options.threshold||this.state&ms)},emit:function(st){if(st.scale!==1){var yt=st.scale<1?"in":"out";st.additionalEvent=this.options.event+yt}this._super.emit.call(this,st)}});function Qs(){Or.apply(this,arguments),this._timer=null,this._input=null}$(Qs,Or,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[tr]},process:function(st){var yt=this.options,Ot=st.pointers.length===yt.pointers,ce=st.distance<yt.threshold,Ee=st.deltaTime>yt.time;if(this._input=st,!ce||!Ot||st.eventType&(Kt|Ce)&&!Ee)this.reset();else if(st.eventType&$t)this.reset(),this._timer=T(function(){this.state=kr,this.tryEmit()},yt.time,this);else if(st.eventType&Kt)return kr;return gr},reset:function(){clearTimeout(this._timer)},emit:function(st){this.state===kr&&(st&&st.eventType&Kt?this.manager.emit(this.options.event+"up",st):(this._input.timeStamp=A(),this.manager.emit(this.options.event,this._input)))}});function us(){Ji.apply(this,arguments)}$(us,Ji,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Fi]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.rotation)>this.options.threshold||this.state&ms)}});function wo(){Ji.apply(this,arguments)}$(wo,Ji,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ot|mi,pointers:1},getTouchAction:function(){return Ws.prototype.getTouchAction.call(this)},attrTest:function(st){var yt=this.options.direction,Ot;return yt&(ot|mi)?Ot=st.overallVelocity:yt&ot?Ot=st.overallVelocityX:yt&mi&&(Ot=st.overallVelocityY),this._super.attrTest.call(this,st)&&yt&st.offsetDirection&&st.distance>this.options.threshold&&st.maxPointers==this.options.pointers&&y(Ot)>this.options.velocity&&st.eventType&Kt},emit:function(st){var yt=Ms(st.offsetDirection);yt&&this.manager.emit(this.options.event+yt,st),this.manager.emit(this.options.event,st)}});function Fr(){Or.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$(Fr,Or,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pi]},process:function(st){var yt=this.options,Ot=st.pointers.length===yt.pointers,ce=st.distance<yt.threshold,Ee=st.deltaTime<yt.time;if(this.reset(),st.eventType&$t&&this.count===0)return this.failTimeout();if(ce&&Ee&&Ot){if(st.eventType!=Kt)return this.failTimeout();var hi=this.pTime?st.timeStamp-this.pTime<yt.interval:!0,Ti=!this.pCenter||De(this.pCenter,st.center)<yt.posThreshold;this.pTime=st.timeStamp,this.pCenter=st.center,!Ti||!hi?this.count=1:this.count+=1,this._input=st;var cr=this.count%yt.taps;if(cr===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=kr,this.tryEmit()},yt.interval,this),ms):kr}return gr},failTimeout:function(){return this._timer=T(function(){this.state=gr},this.options.interval,this),gr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Bs(st,yt){return yt=yt||{},yt.recognizers=Mt(yt.recognizers,Bs.defaults.preset),new Kn(st,yt)}Bs.VERSION="2.0.7",Bs.defaults={domEvents:!1,touchAction:qi,enable:!0,inputTarget:null,inputClass:null,preset:[[us,{enable:!1}],[mr,{enable:!1},["rotate"]],[wo,{direction:ot}],[Ws,{direction:ot},["swipe"]],[Fr],[Fr,{event:"doubletap",taps:2},["tap"]],[Qs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var rs=1,Hi=2;function Kn(st,yt){this.options=j({},Bs.defaults,yt||{}),this.options.inputTarget=this.options.inputTarget||st,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=st,this.input=Ne(this),this.touchAction=new nr(this,this.options.touchAction),Qn(this,!0),L(this.options.recognizers,function(Ot){var ce=this.add(new Ot[0](Ot[1]));Ot[2]&&ce.recognizeWith(Ot[2]),Ot[3]&&ce.requireFailure(Ot[3])},this)}Kn.prototype={set:function(st){return j(this.options,st),st.touchAction&&this.touchAction.update(),st.inputTarget&&(this.input.destroy(),this.input.target=st.inputTarget,this.input.init()),this},stop:function(st){this.session.stopped=st?Hi:rs},recognize:function(st){var yt=this.session;if(!yt.stopped){this.touchAction.preventDefaults(st);var Ot,ce=this.recognizers,Ee=yt.curRecognizer;(!Ee||Ee&&Ee.state&kr)&&(Ee=yt.curRecognizer=null);for(var hi=0;hi<ce.length;)Ot=ce[hi],yt.stopped!==Hi&&(!Ee||Ot==Ee||Ot.canRecognizeWith(Ee))?Ot.recognize(st):Ot.reset(),!Ee&&Ot.state&(ms|Hs|Rr)&&(Ee=yt.curRecognizer=Ot),hi++}},get:function(st){if(st instanceof Or)return st;for(var yt=this.recognizers,Ot=0;Ot<yt.length;Ot++)if(yt[Ot].options.event==st)return yt[Ot];return null},add:function(st){if(P(st,"add",this))return this;var yt=this.get(st.options.event);return yt&&this.remove(yt),this.recognizers.push(st),st.manager=this,this.touchAction.update(),st},remove:function(st){if(P(st,"remove",this))return this;if(st=this.get(st),st){var yt=this.recognizers,Ot=ct(yt,st);Ot!==-1&&(yt.splice(Ot,1),this.touchAction.update())}return this},on:function(st,yt){if(st!==s&&yt!==s){var Ot=this.handlers;return L(zt(st),function(ce){Ot[ce]=Ot[ce]||[],Ot[ce].push(yt)}),this}},off:function(st,yt){if(st!==s){var Ot=this.handlers;return L(zt(st),function(ce){yt?Ot[ce]&&Ot[ce].splice(ct(Ot[ce],yt),1):delete Ot[ce]}),this}},emit:function(st,yt){this.options.domEvents&&Aa(st,yt);var Ot=this.handlers[st]&&this.handlers[st].slice();if(!(!Ot||!Ot.length)){yt.type=st,yt.preventDefault=function(){yt.srcEvent.preventDefault()};for(var ce=0;ce<Ot.length;)Ot[ce](yt),ce++}},destroy:function(){this.element&&Qn(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Qn(st,yt){var Ot=st.element;if(Ot.style){var ce;L(st.options.cssProps,function(Ee,hi){ce=bt(Ot.style,hi),yt?(st.oldCssProps[ce]=Ot.style[ce],Ot.style[ce]=Ee):Ot.style[ce]=st.oldCssProps[ce]||""}),yt||(st.oldCssProps={})}}function Aa(st,yt){var Ot=e.createEvent("Event");Ot.initEvent(st,!0,!0),Ot.gesture=yt,yt.target.dispatchEvent(Ot)}j(Bs,{INPUT_START:$t,INPUT_MOVE:ee,INPUT_END:Kt,INPUT_CANCEL:Ce,STATE_POSSIBLE:Wi,STATE_BEGAN:ms,STATE_CHANGED:Hs,STATE_ENDED:Rr,STATE_RECOGNIZED:kr,STATE_CANCELLED:In,STATE_FAILED:gr,DIRECTION_NONE:Ie,DIRECTION_LEFT:Re,DIRECTION_RIGHT:Fe,DIRECTION_UP:Ze,DIRECTION_DOWN:he,DIRECTION_HORIZONTAL:ot,DIRECTION_VERTICAL:mi,DIRECTION_ALL:ri,Manager:Kn,Input:Le,TouchAction:nr,TouchInput:Jt,MouseInput:je,PointerEventInput:K,TouchMouseInput:qe,SingleTouchInput:kt,Recognizer:Or,AttrRecognizer:Ji,Tap:Fr,Pan:Ws,Swipe:wo,Pinch:mr,Rotate:us,Press:Qs,on:Nt,off:Rt,each:L,merge:Z,extend:X,assign:j,inherit:$,bindFn:ht,prefixed:bt});var Sa=typeof t<"u"?t:typeof self<"u"?self:{};Sa.Hammer=Bs,i.exports?i.exports=Bs:t[r]=Bs})(window,document,"Hammer")})(Y3);var Lf=Y3.exports;const K8=Im(Lf),tc=QT({__proto__:null,default:K8},[Lf]),K3=1,Q3=2,E1=4,Q8={mousedown:K3,mousemove:Q3,mouseup:E1};function tF(i,t){for(let e=0;e<i.length;e++)if(t(i[e]))return!0;return!1}function eF(i){const t=i.prototype.handler;i.prototype.handler=function(e){const r=this.store;e.button>0&&e.type==="pointerdown"&&(tF(r,s=>s.pointerId===e.pointerId)||r.push(e)),t.call(this,e)}}function iF(i){i.prototype.handler=function(t){let e=Q8[t.type];e&K3&&t.button>=0&&(this.pressed=!0),e&Q3&&t.which===0&&(e=E1),this.pressed&&(e&E1&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}eF(Lf.PointerEventInput);iF(Lf.MouseInput);const rF=Lf.Manager;class Dm{constructor(t,e,r){this.element=t,this.callback=e,this.options={enable:!0,...r}}}const sF=tc?[[tc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[tc.Rotate,{enable:!1}],[tc.Pinch,{enable:!1}],[tc.Swipe,{enable:!1}],[tc.Pan,{threshold:0,enable:!1}],[tc.Press,{enable:!1}],[tc.Tap,{event:"doubletap",taps:2,enable:!1}],[tc.Tap,{event:"anytap",enable:!1}],[tc.Tap,{enable:!1}]]:null,Ww={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},nF={doubletap:["tap"]},oF={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},tv={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},aF={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Jw={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},lF=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ad=typeof window<"u"?window:global;let C1=!1;try{const i={get passive(){return C1=!0,!0}};Ad.addEventListener("test",null,i),Ad.removeEventListener("test",null)}catch{C1=!1}const cF=lF.indexOf("firefox")!==-1,{WHEEL_EVENTS:hF}=tv,Xw="wheel",Zw=4.000244140625,uF=40,dF=.25;class pF extends Dm{constructor(t,e,r){super(t,e,r),this.handleEvent=s=>{if(!this.options.enable)return;let n=s.deltaY;Ad.WheelEvent&&(cF&&s.deltaMode===Ad.WheelEvent.DOM_DELTA_PIXEL&&(n/=Ad.devicePixelRatio),s.deltaMode===Ad.WheelEvent.DOM_DELTA_LINE&&(n*=uF)),n!==0&&n%Zw===0&&(n=Math.floor(n/Zw)),s.shiftKey&&n&&(n=n*dF),this.callback({type:Xw,center:{x:s.clientX,y:s.clientY},delta:-n,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(hF),this.events.forEach(s=>t.addEventListener(s,this.handleEvent,C1?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===Xw&&(this.options.enable=e)}}const{MOUSE_EVENTS:fF}=tv,$w="pointermove",Yw="pointerover",Kw="pointerout",Qw="pointerenter",tx="pointerleave";class gF extends Dm{constructor(t,e,r){super(t,e,r),this.handleEvent=n=>{this.handleOverEvent(n),this.handleOutEvent(n),this.handleEnterEvent(n),this.handleLeaveEvent(n),this.handleMoveEvent(n)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(fF),this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===$w&&(this.enableMoveEvent=e),t===Yw&&(this.enableOverEvent=e),t===Kw&&(this.enableOutEvent=e),t===Qw&&(this.enableEnterEvent=e),t===tx&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(Yw,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(Kw,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(Qw,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(tx,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit($w,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:mF}=tv,ex="keydown",ix="keyup";class yF extends Dm{constructor(t,e,r){super(t,e,r),this.handleEvent=s=>{const n=s.target||s.srcElement;n.tagName==="INPUT"&&n.type==="text"||n.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:ex,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:ix,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(mF),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===ex&&(this.enableDownEvent=e),t===ix&&(this.enableUpEvent=e)}}const rx="contextmenu";class _F extends Dm{constructor(t,e,r){super(t,e,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:rx,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===rx&&(this.options.enable=e)}}const T1=1,xm=2,P1=4,vF={pointerdown:T1,pointermove:xm,pointerup:P1,mousedown:T1,mousemove:xm,mouseup:P1},bF=1,wF=2,xF=3,AF=0,SF=1,EF=2,CF=1,TF=2,PF=4;function IF(i){const t=vF[i.srcEvent.type];if(!t)return null;const{buttons:e,button:r,which:s}=i.srcEvent;let n=!1,c=!1,l=!1;return t===P1||t===xm&&!Number.isFinite(e)?(n=s===bF,c=s===wF,l=s===xF):t===xm?(n=!!(e&CF),c=!!(e&PF),l=!!(e&TF)):t===T1&&(n=r===AF,c=r===SF,l=r===EF),{leftButton:n,middleButton:c,rightButton:l}}function LF(i,t){const e=i.center;if(!e)return null;const r=t.getBoundingClientRect(),s=r.width/t.offsetWidth||1,n=r.height/t.offsetHeight||1,c={x:(e.x-r.left-t.clientLeft)/s,y:(e.y-r.top-t.clientTop)/n};return{center:e,offsetCenter:c}}const py={srcElement:"root",priority:0};class MF{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const r=this._normalizeEvent(e);let s=e.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:c,handlersByElement:l}=this;let f=py;typeof r=="string"||r&&r.addEventListener?f={...py,srcElement:r}:r&&(f={...py,...r});let y=l.get(f.srcElement);y||(y=[],l.set(f.srcElement,y));const A={type:t,handler:e,srcElement:f.srcElement,priority:f.priority};s&&(A.once=!0),n&&(A.passive=!0),c.push(A),this._active=this._active||!A.passive;let T=y.length-1;for(;T>=0&&!(y[T].priority>=A.priority);)T--;y.splice(T+1,0,A)}remove(t,e){const{handlers:r,handlersByElement:s}=this;for(let n=r.length-1;n>=0;n--){const c=r[n];if(c.type===t&&c.handler===e){r.splice(n,1);const l=s.get(c.srcElement);l.splice(l.indexOf(c),1),l.length===0&&s.delete(c.srcElement)}}this._active=r.some(n=>!n.passive)}_emit(t,e){const r=this.handlersByElement.get(e);if(r){let s=!1;const n=()=>{t.handled=!0},c=()=>{t.handled=!0,s=!0},l=[];for(let f=0;f<r.length;f++){const{type:y,handler:A,once:T}=r[f];if(A({...t,type:y,stopPropagation:n,stopImmediatePropagation:c}),T&&l.push(r[f]),s)break}for(let f=0;f<l.length;f++){const{type:y,handler:A}=l[f];this.remove(y,A)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...IF(t),...LF(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const BF={events:null,recognizers:null,recognizerOptions:{},Manager:rF,touchAction:"none",tabIndex:0};class RF{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=s=>{const{srcEvent:n}=s,c=oF[n.type];c&&this.manager.emit(c,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...BF,...e},this.events=new Map,this.setElement(t);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,r=e.Manager;this.manager=new r(t,{touchAction:e.touchAction,recognizers:e.recognizers||sF}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(Ww).forEach(s=>{const n=this.manager.get(s);n&&Ww[s].forEach(c=>{n.recognizeWith(c)})});for(const s in e.recognizerOptions){const n=this.manager.get(s);if(n){const c=e.recognizerOptions[s];delete c.enable,n.set(c)}}this.wheelInput=new pF(t,this._onOtherEvent,{enable:!1}),this.moveInput=new gF(t,this._onOtherEvent,{enable:!1}),this.keyInput=new yF(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new _F(t,this._onOtherEvent,{enable:!1});for(const[s,n]of this.events)n.isEmpty()||(this._toggleRecognizer(n.recognizerName,!0),this.manager.on(s,n.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,r){this._addEventHandler(t,e,r,!1)}once(t,e,r){this._addEventHandler(t,e,r,!0)}watch(t,e,r){this._addEventHandler(t,e,r,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:r}=this;if(!r)return;const s=r.get(t);if(s&&s.options.enable!==e){s.set({enable:e});const n=nF[t];n&&!this.options.recognizers&&n.forEach(c=>{const l=r.get(c);e?(l.requireFailure(t),s.dropRequireFailure(c)):l.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,r,s,n){if(typeof t!="string"){r=e;for(const A in t)this._addEventHandler(A,t[A],r,s,n);return}const{manager:c,events:l}=this,f=Jw[t]||t;let y=l.get(f);y||(y=new MF(this),l.set(f,y),y.recognizerName=aF[f]||f,c&&c.on(f,y.handleEvent)),y.add(t,e,r,s,n),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const c in t)this._removeEventHandler(c,t[c]);return}const{events:r}=this,s=Jw[t]||t,n=r.get(s);if(n&&(n.remove(t,e),n.isEmpty())){const{recognizerName:c}=n;let l=!1;for(const f of r.values())if(f.recognizerName===c&&!f.isEmpty()){l=!0;break}l||this._toggleRecognizer(c,!1)}}}function mu(){}const kF=i=>{let{isDragging:t}=i;return t?"grabbing":"grab"},tS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:mu,onResize:mu,onViewStateChange:mu,onInteractionStateChange:mu,onBeforeRender:mu,onAfterRender:mu,onLoad:mu,onError:i=>fr.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:kF,getTooltip:null,debug:!1,drawPickingColors:!1};class ev{constructor(t){H(this,"props",void 0),H(this,"width",0),H(this,"height",0),H(this,"userData",{}),H(this,"canvas",null),H(this,"viewManager",null),H(this,"layerManager",null),H(this,"effectManager",null),H(this,"deckRenderer",null),H(this,"deckPicker",null),H(this,"eventManager",null),H(this,"tooltip",null),H(this,"metrics",void 0),H(this,"animationLoop",void 0),H(this,"stats",void 0),H(this,"viewState",void 0),H(this,"cursorState",void 0),H(this,"_needsRedraw",void 0),H(this,"_pickRequest",void 0),H(this,"_lastPointerDownInfo",null),H(this,"_metricsCounter",void 0),H(this,"_onPointerMove",e=>{const{_pickRequest:r}=this;if(e.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(e.leftButton||e.rightButton)return;{const s=e.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=e}),H(this,"_onEvent",e=>{const r=D2[e.type],s=e.offsetCenter;if(!r||!s||!this.layerManager)return;const n=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:n,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=c,f=l&&(l[r.handler]||l.props[r.handler]),y=this.props[r.handler];let A=!1;f&&(A=f.call(l,c,e)),!A&&y&&y(c,e)}),H(this,"_onPointerDown",e=>{const r=e.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={...tS,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&fr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),CA()==="IE"&&fr.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new bf({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&uf.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,r,s,n,c,l,f;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(s=this.effectManager)===null||s===void 0||s.finalize(),this.effectManager=null,(n=this.deckRenderer)===null||n===void 0||n.finalize(),this.deckRenderer=null,(c=this.deckPicker)===null||c===void 0||c.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(f=this.tooltip)===null||f===void 0||f.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var y;(y=this.canvas.parentElement)===null||y===void 0||y.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&fr.removed("onLayerHover","onHover")(),"onLayerClick"in t&&fr.removed("onLayerClick","onClick")(),t.initialViewState&&!ac(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(t),s=this.layerManager.needsRedraw(t),n=this.effectManager.needsRedraw(t),c=this.deckRenderer.needsRedraw(t);return e=e||r||s||n||c,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return Pn(this.viewManager),this.viewManager.views}getViewports(t){return Pn(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const r in t)this.layerManager.resourceManager.add({resourceId:r,data:t[r],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,r){Pn(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(e).timeStart();const n=this.deckPicker[t]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(e).timeEnd(),n}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),Pn(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:r}=t;if(e||e===0){const n=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=n}if(r||r===0){var s;const n=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((s=t.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var t,e;const{canvas:r}=this;if(!r)return;const s=(t=r.clientWidth)!==null&&t!==void 0?t:r.width,n=(e=r.clientHeight)!==null&&e!==void 0?e:r.height;if(s!==this.width||n!==this.height){var c,l;this.width=s,this.height=n,(c=this.viewManager)===null||c===void 0||c.setProps({width:s,height:n}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:n})}}_createAnimationLoop(t){const{width:e,height:r,gl:s,glOptions:n,debug:c,onError:l,onBeforeRender:f,onAfterRender:y,useDevicePixels:A}=t;return new n6({width:e,height:r,useDevicePixels:A,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,gl:s,onCreateContext:T=>HA({...n,...T,canvas:this.canvas,debug:c,onContextLost:()=>this._onContextLost()}),onInitialize:T=>this._setGLContext(T.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:f,onAfterRender:y,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new Q_({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:r,emptyInfo:s}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let n=s,c=!1;for(const l of r){var e;n=l,c=((e=l.layer)===null||e===void 0?void 0:e.onHover(l,t.event))||c}if(!c&&this.props.onHover&&this.props.onHover(n,t.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(n);this.tooltip.setTooltip(l,n.x,n.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,P_(t,{enable:!0,copyState:!0})),this.tooltip=new Y8(this.canvas),Jc(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new k3;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new RF(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in D2)this.eventManager.on(s,this._onEvent);this.viewManager=new A8({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new x8(t,{deck:this,stats:this.stats,viewport:r,timeline:e}),this.effectManager=new U8,this.deckRenderer=new V8(t),this.deckPicker=new Z8(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:r}=this.layerManager.context;Jc(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:r})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),fr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const r=Su.get("Memory Usage");t.bufferMemory=r.get("Buffer Memory").count,t.textureMemory=r.get("Texture Memory").count,t.renderbufferMemory=r.get("Renderbuffer Memory").count,t.gpuMemory=r.get("GPU Memory").count}}H(ev,"defaultProps",tS);H(ev,"VERSION",u4);class fy{constructor(t,e){H(this,"opts",void 0),H(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:r}=this.source,{size:s}=e;let n=r;if(r&&r.length!==s){n=new Float32Array(s);const c=e.elementOffset||0;for(let l=0;l<s;++l)n[l]=r[c+l]}return n}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function OF(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Xg(i){return i.stride||i.size*i.bytesPerElement}function eS(i,t){t.offset&&fr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=Xg(i),r=t.vertexOffset!==void 0?t.vertexOffset:i.vertexOffset||0,s=t.elementOffset||0,n=r*e+s*i.bytesPerElement+(i.offset||0);return{...t,offset:n,stride:e}}function FF(i,t){const e=eS(i,t);return{high:e,low:{...e,offset:e.offset+i.size*4}}}class NF{constructor(t,e,r){H(this,"gl",void 0),H(this,"id",void 0),H(this,"size",void 0),H(this,"settings",void 0),H(this,"value",void 0),H(this,"doublePrecision",void 0),H(this,"_buffer",void 0),H(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const s=e.logicalType||e.type,n=s===5130;let{defaultValue:c}=e;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let l;n?l=5126:!s&&e.isIndexed?l=t&&M_(t,is.ELEMENT_INDEX_UINT32)?5125:5123:l=s||5126;let f=OF(s||l||5126);this.doublePrecision=n,n&&e.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...e,defaultType:f,defaultValue:c,logicalType:s,type:l,size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new Hr(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Xg(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),uf.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const r={},s=this.value instanceof Float64Array,n=FF(this.getAccessor(),e||{});return r[t]=new fy(this,n.high),r["".concat(t,"64Low")]=s?new fy(this,n.low):new Float32Array(this.size),r}if(e){const r=eS(this.getAccessor(),e);return{[t]:new fy(this,r)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:r,size:s}=this,n=r*s;if(e&&n&&e.length>=n){const c=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let f=0;f<n;)for(let y=0;y<s;y++){const A=e[f++];A<c[y]&&(c[y]=A),A>l[y]&&(l[y]=A)}t=[c,l]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let r;ArrayBuffer.isView(t)?r={value:t}:t instanceof Hr?r={buffer:t}:r=t;const s={...this.settings,...r};if(e.bufferAccessor=s,e.bounds=null,r.constant){let n=r.value;if(n=this._normalizeValue(n,[],0),this.settings.normalized&&(n=this.normalizeConstant(n)),!(!e.constant||!this._areValuesEqual(n,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=n}else if(r.buffer){const n=r.buffer;e.externalBuffer=n,e.constant=!1,this.value=r.value||null;const c=r.value instanceof Float64Array;s.type=r.type||n.accessor.type,s.bytesPerElement=n.accessor.BYTES_PER_ELEMENT*(c?2:1),s.stride=Xg(s)}else if(r.value){this._checkExternalBuffer(r);let n=r.value;e.externalBuffer=null,e.constant=!1,this.value=n,s.bytesPerElement=n.BYTES_PER_ELEMENT,s.stride=Xg(s);const{buffer:c,byteOffset:l}=this;this.doublePrecision&&n instanceof Float64Array&&(n=hy(n,s));const f=n.byteLength+l+s.stride*2;c.byteLength<f&&c.reallocate(f),c.setAccessor(null),c.subData({data:n,offset:l}),s.type=r.type||c.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:r=0,endOffset:s}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?hy(e,{size:this.size,startIndex:r,endIndex:s}):e.subarray(r,s),offset:r*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:r}=this,s=r.allocatedValue,n=uf.allocate(s,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=n;const{buffer:c,byteOffset:l}=this;return c.byteLength<n.byteLength+l&&(c.reallocate(n.byteLength+l),e&&s&&c.subData({data:s instanceof Float64Array?hy(s,this):s,offset:l})),r.allocatedValue=n,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=e.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof r)&&this.settings.normalized&&!("normalized"in t)&&fr.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,r){const{defaultValue:s,size:n}=this.settings;if(Number.isFinite(t))return e[r]=t,e;if(!t){let c=n;for(;--c>=0;)e[r+c]=s[c];return e}switch(n){case 4:e[r+3]=Number.isFinite(t[3])?t[3]:s[3];case 3:e[r+2]=Number.isFinite(t[2])?t[2]:s[2];case 2:e[r+1]=Number.isFinite(t[1])?t[1]:s[1];case 1:e[r+0]=Number.isFinite(t[0])?t[0]:s[0];break;default:let c=n;for(;--c>=0;)e[r+c]=Number.isFinite(t[c])?t[c]:s[c]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(t[s]!==e[s])return!1;return!0}}const sx=[],nx=[];function iS(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,r=sx;const s={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(nx.length=i.length,r=nx):r=sx,(t>0||Number.isFinite(e))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,e),s.index=t-1),{iterable:r,objectInfo:s}}function rS(i){return i&&i[Symbol.asyncIterator]}function DF(i,t){const{size:e,stride:r,offset:s,startIndices:n,nested:c}=t,l=i.BYTES_PER_ELEMENT,f=r?r/l:e,y=s?s/l:0,A=Math.floor((i.length-y)/f);return(T,P)=>{let{index:L,target:D}=P;if(!n){const $=L*f+y;for(let ht=0;ht<e;ht++)D[ht]=i[$+ht];return D}const j=n[L],X=n[L+1]||A;let Z;if(c){Z=new Array(X-j);for(let $=j;$<X;$++){const ht=$*f+y;D=new Array(e);for(let _t=0;_t<e;_t++)D[_t]=i[ht+_t];Z[$-j]=D}}else if(f===e)Z=i.subarray(j*e+y,X*e+y);else{Z=new i.constructor((X-j)*e);let $=0;for(let ht=j;ht<X;ht++){const _t=ht*f+y;for(let Mt=0;Mt<e;Mt++)Z[$++]=i[_t+Mt]}}return Z}}const zF=[],Zg=[[0,1/0]];function UF(i,t){if(i===Zg||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return i;const e=[],r=i.length;let s=0;for(let n=0;n<r;n++){const c=i[n];c[1]<t[0]?(e.push(c),s=n+1):c[0]>t[1]?e.push(c):t=[Math.min(c[0],t[0]),Math.max(c[1],t[1])]}return e.splice(s,0,t),e}function gy(i){const{source:t,target:e,start:r=0,size:s,getData:n}=i,c=i.end||e.length,l=t.length,f=c-r;if(l>f){e.set(t.subarray(0,f),r);return}if(e.set(t,r),!n)return;let y=l;for(;y<f;){const A=n(y,t);for(let T=0;T<s;T++)e[r+y]=A[T]||0,y++}}function jF(i){let{source:t,target:e,size:r,getData:s,sourceStartIndices:n,targetStartIndices:c}=i;if(!Array.isArray(c))return gy({source:t,target:e,size:r,getData:s}),e;let l=0,f=0;const y=s&&((T,P)=>s(T+f,P)),A=Math.min(n.length,c.length);for(let T=1;T<A;T++){const P=n[T]*r,L=c[T]*r;gy({source:t.subarray(l,P),target:e,start:f,end:L,size:r,getData:y}),l=P,f=L}return f<e.length&&gy({source:[],target:e,start:f,size:r,getData:y}),e}const GF={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function sS(i,t){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const e=i.type||"interpolation";return{...GF[e],...t,...i,type:e}}function nS(i,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function oS(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function aS(i){i.push(i.shift())}function iv(i,t){const{doublePrecision:e,settings:r,value:s,size:n}=i,c=e&&s instanceof Float64Array?2:1;return(r.noAlloc?s.length:t*n)*c}function lS(i){let{buffer:t,numInstances:e,attribute:r,fromLength:s,fromStartIndices:n,getData:c=$=>$}=i;const l=r.doublePrecision&&r.value instanceof Float64Array?2:1,f=r.size*l,y=r.byteOffset,A=r.startIndices,T=n&&A,P=iv(r,e),L=r.isConstant;if(!T&&s>=P)return;const D=L?r.value:r.getBuffer().getData({srcByteOffset:y});if(r.settings.normalized&&!L){const $=c;c=(ht,_t)=>r.normalizeConstant($(ht,_t))}const j=L?($,ht)=>c(D,ht):($,ht)=>c(D.subarray($,$+f),ht),X=t.getData({length:s}),Z=new Float32Array(P);jF({source:X,target:Z,sourceStartIndices:n,targetStartIndices:A,size:f,getData:j}),t.byteLength<Z.byteLength+y&&t.reallocate(Z.byteLength+y),t.subData({data:Z,offset:y})}class rv extends NF{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Zg}),H(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,r=this.settings.transition,s=Array.isArray(e)?t[e.find(n=>t[n])]:t[e];return sS(s,r)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:r=0,endRow:s=1/0}=e;this.state.updateRanges=UF(this.state.updateRanges,[r,s])}else this.state.updateRanges=Zg}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=zF}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(t,e.updateRanges!==Zg),!0):!1}updateBuffer(t){let{numInstances:e,data:r,props:s,context:n}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:l,noAlloc:f}}=this;let y=!0;if(l){for(const[A,T]of c)l.call(n,this,{data:r,startRow:A,endRow:T,props:s,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[A,T]of c){const P=Number.isFinite(A)?this.getVertexOffset(A):0,L=Number.isFinite(T)?this.getVertexOffset(T):f||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:P,endOffset:L})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:r,settings:s}=this;if(!t)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===t)return this.clearNeedsUpdate(),!0;if(r.binaryValue=t,this.setNeedsRedraw(),s.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const n=t;Pn(ArrayBuffer.isView(n.value),"invalid ".concat(s.accessor));const c=!!n.size&&n.size!==this.size;return r.binaryAccessor=DF(n.value,{size:n.size||this.size,stride:n.stride,offset:n.offset,startIndices:e,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const r in t)Object.assign(e,super.getShaderAttributes(r,t[r]));return e}_autoUpdater(t,e){let{data:r,startRow:s,endRow:n,props:c,numInstances:l}=e;if(t.constant)return;const{settings:f,state:y,value:A,size:T,startIndices:P}=t,{accessor:L,transform:D}=f,j=y.binaryAccessor||(typeof L=="function"?L:c[L]);Pn(typeof j=="function",'accessor "'.concat(L,'" is not a function'));let X=t.getVertexOffset(s);const{iterable:Z,objectInfo:$}=iS(r,s,n);for(const ht of Z){$.index++;let _t=j(ht,$);if(D&&(_t=D.call(this,_t)),P){const Mt=($.index<P.length-1?P[$.index+1]:l)-P[$.index];if(_t&&Array.isArray(_t[0])){let Nt=X;for(const Rt of _t)t._normalizeValue(Rt,A,Nt),Nt+=T}else _t&&_t.length>T?A.set(_t,X):(t._normalizeValue(_t,$.target,0),p8({target:A,source:$.target,start:X,count:Mt}));X+=Mt*T}else t._normalizeValue(_t,A,X),X+=T}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let r=!0;switch(e){case 4:r=r&&Number.isFinite(t[3]);case 3:r=r&&Number.isFinite(t[2]);case 2:r=r&&Number.isFinite(t[1]);case 1:r=r&&Number.isFinite(t[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class VF{constructor(t){let{gl:e,attribute:r,timeline:s}=t;H(this,"gl",void 0),H(this,"type","interpolation"),H(this,"attributeInTransition",void 0),H(this,"settings",void 0),H(this,"attribute",void 0),H(this,"transition",void 0),H(this,"currentStartIndices",void 0),H(this,"currentLength",void 0),H(this,"transform",void 0),H(this,"buffers",void 0),this.gl=e,this.transition=new If(s),this.attribute=r,this.attributeInTransition=new rv(e,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=HF(e,r);const n={byteLength:0,usage:35050};this.buffers=[new Hr(e,n),new Hr(e,n)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:r,buffers:s,attribute:n}=this;aS(s);const c={numInstances:e,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const l of s)lS({buffer:l,...c});this.currentStartIndices=n.startIndices,this.currentLength=iv(n,e),this.attributeInTransition.setData({buffer:s[1],value:n.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aFrom:s[0],aTo:nS(r,n)},feedbackBuffers:{vCurrent:s[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:r}=this.settings,{time:s}=this.transition;let n=s/e;r&&(n=r(n)),this.transform.run({uniforms:{time:n}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const qF=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function HF(i,t){const e=oS(t.size);return new H_(i,{vs:qF,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class WF{constructor(t){let{gl:e,attribute:r,timeline:s}=t;H(this,"gl",void 0),H(this,"type","spring"),H(this,"attributeInTransition",void 0),H(this,"settings",void 0),H(this,"attribute",void 0),H(this,"transition",void 0),H(this,"currentStartIndices",void 0),H(this,"currentLength",void 0),H(this,"texture",void 0),H(this,"framebuffer",void 0),H(this,"transform",void 0),H(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new If(s),this.attribute=r,this.attributeInTransition=new rv(e,{...r.settings,normalized:!1}),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=XF(e),this.framebuffer=ZF(e,this.texture),this.transform=JF(e,r,this.framebuffer);const n={byteLength:0,usage:35050};this.buffers=[new Hr(e,n),new Hr(e,n),new Hr(e,n)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:r,buffers:s,attribute:n}=this,c={numInstances:e,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const l of s)lS({buffer:l,...c});this.settings=t,this.currentStartIndices=n.startIndices,this.currentLength=iv(n,e),this.attributeInTransition.setData({buffer:s[1],value:n.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aTo:nS(r,n)}})}update(){const{buffers:t,transform:e,framebuffer:r,transition:s}=this;if(!s.update())return!1;const n=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:n.stiffness,damping:n.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),aS(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),Fm(r)[0]>0||s.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function JF(i,t,e){const r=oS(t.size);return new H_(i,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function XF(i){return new xa(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function ZF(i,t){return new Ks(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const $F={interpolation:VF,spring:WF};class YF{constructor(t,e){let{id:r,timeline:s}=e;H(this,"id",void 0),H(this,"isSupported",void 0),H(this,"gl",void 0),H(this,"timeline",void 0),H(this,"transitions",void 0),H(this,"needsRedraw",void 0),H(this,"numInstances",void 0),this.id=r,this.gl=t,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=H_.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:r,numInstances:s}=t;this.numInstances=s||1;for(const n in e){const c=e[n],l=c.getTransitionSetting(r);l&&this._updateAttribute(n,c,l)}for(const n in this.transitions){const c=e[n];(!c||!c.getTransitionSetting(r))&&this._removeTransition(n)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const r=this.transitions[e];r.inProgress&&(t[e]=r.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,r){const s=this.transitions[t];let n=!s||s.type!==r.type;if(n){if(!this.isSupported){fr.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}s&&this._removeTransition(t);const c=$F[r.type];c?this.transitions[t]=new c({attribute:e,timeline:this.timeline,gl:this.gl}):(fr.error("unsupported transition type '".concat(r.type,"'"))(),n=!1)}(n||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(r,this.numInstances))}}const ox="attributeManager.invalidate",KF="attributeManager.updateStart",QF="attributeManager.updateEnd",tN="attribute.updateStart",eN="attribute.allocate",iN="attribute.updateEnd";class rN{constructor(t){let{id:e="attribute-manager",stats:r,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};H(this,"id",void 0),H(this,"gl",void 0),H(this,"attributes",void 0),H(this,"updateTriggers",void 0),H(this,"needsRedraw",void 0),H(this,"userData",void 0),H(this,"stats",void 0),H(this,"attributeTransitionManager",void 0),H(this,"mergeBoundsMemoized",Pf(s8)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new YF(t,{id:"".concat(e,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const r=this._invalidateTrigger(t,e);Xn(ox,this,t,r)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Xn(ox,this,"all")}update(t){let{data:e,numInstances:r,startIndices:s=null,transitions:n,props:c={},buffers:l={},context:f={}}=t,y=!1;Xn(KF,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const T=this.attributes[A],P=T.settings.accessor;T.startIndices=s,T.numInstances=r,c[A]&&fr.removed("props.".concat(A),"data.attributes.".concat(A))(),T.setExternalBuffer(l[A])||T.setBinaryValue(typeof P=="string"?l[P]:void 0,e.startIndices)||typeof P=="string"&&!l[P]&&T.setConstantValue(c[P])||T.needsUpdate()&&(y=!0,this._updateAttribute({attribute:T,numInstances:r,data:e,props:c,context:f})),this.needsRedraw=this.needsRedraw||T.needsRedraw()}y&&Xn(QF,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:n})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map(r=>{var s;return(s=this.attributes[r])===null||s===void 0?void 0:s.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const n in e){const c=e[n];c.needsRedraw(t)&&!r.hasAttribute(n)&&(s[n]=c)}return s}getShaderAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const r={};for(const s in t)e[s]||Object.assign(r,t[s].getShaderAttributes());return r}_add(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const r in t){const s=t[r];this.attributes[r]=this._createAttribute(r,s,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,r){const s={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:r.instanced?1:e.divisor||0};return new rv(this.gl,s)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(r=>{t[r]||(t[r]=[]),t[r].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:r,updateTriggers:s}=this,n=s[t];return n&&n.forEach(c=>{const l=r[c];l&&l.setNeedsUpdate(l.id,e)}),n}_updateAttribute(t){const{attribute:e,numInstances:r}=t;if(Xn(tN,e),e.constant){e.setConstantValue(e.value);return}e.allocate(r)&&Xn(eN,e,r),e.updateBuffer(t)&&(this.needsRedraw=!0,Xn(iN,e,r))}}class sN extends If{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:r,duration:s,easing:n}}=this,c=n(t/s);this._value=mm(e,r,c)}}const ax=1e-5;function lx(i,t,e,r,s){const n=t-i,c=(e-t)*s,l=-n*r;return c+l+n+t}function nN(i,t,e,r,s){if(Array.isArray(e)){const n=[];for(let c=0;c<e.length;c++)n[c]=lx(i[c],t[c],e[c],r,s);return n}return lx(i,t,e,r,s)}function cx(i,t){if(Array.isArray(i)){let e=0;for(let r=0;r<i.length;r++){const s=i[r]-t[r];e+=s*s}return Math.sqrt(e)}return Math.abs(i-t)}class oN extends If{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:r,stiffness:s}=this.settings,{_prevValue:n=t,_currValue:c=t}=this;let l=nN(n,c,e,r,s);const f=cx(l,e),y=cx(l,c);f<ax&&y<ax&&(l=e,this.end()),this._prevValue=c,this._currValue=l}}const aN={interpolation:sN,spring:oN};class lN{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,r,s){const{transitions:n}=this;if(n.has(t)){const f=n.get(t),{value:y=f.settings.fromValue}=f;e=y,this.remove(t)}if(s=sS(s),!s)return;const c=aN[s.type];if(!c){fr.error("unsupported transition type '".concat(s.type,"'"))();return}const l=new c(this.timeline);l.start({...s,fromValue:e,toValue:r}),n.set(t,l)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,r]of this.transitions)r.update(),t[e]=r.value,r.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function cN(i){const t=i[qh];for(const e in t){const r=t[e],{validate:s}=r;if(s&&!s(i[e],r))throw new Error("Invalid prop ".concat(e,": ").concat(i[e]))}}function hN(i,t){const e=cS({newProps:i,oldProps:t,propTypes:i[qh],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=dN(i,t);let s=!1;return r||(s=pN(i,t)),{dataChanged:r,propsChanged:e,updateTriggersChanged:s,extensionsChanged:fN(i,t),transitionsChanged:uN(i,t)}}function uN(i,t){if(!i.transitions)return!1;const e={},r=i[qh];let s=!1;for(const n in i.transitions){const c=r[n],l=c&&c.type;(l==="number"||l==="color"||l==="array")&&I1(i[n],t[n],c)&&(e[n]=!0,s=!0)}return s?e:!1}function cS(i){let{newProps:t,oldProps:e,ignoreProps:r={},propTypes:s={},triggerName:n="props"}=i;if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(n," changed shallowly");for(const c of Object.keys(t))if(!(c in r)){if(!(c in e))return"".concat(n,".").concat(c," added");const l=I1(t[c],e[c],s[c]);if(l)return"".concat(n,".").concat(c," ").concat(l)}for(const c of Object.keys(e))if(!(c in r)){if(!(c in t))return"".concat(n,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const l=I1(t[c],e[c],s[c]);if(l)return"".concat(n,".").concat(c," ").concat(l)}}return!1}function I1(i,t,e){let r=e&&e.equal;return r&&!r(i,t,e)||!r&&(r=i&&t&&i.equals,r&&!r.call(i,t))?"changed deeply":!r&&t!==i?"changed shallowly":null}function dN(i,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:r,_dataDiff:s}=i;return r?r(i.data,t.data)||(e="Data comparator detected a change"):i.data!==t.data&&(e="A new data container was supplied"),e&&s&&(e=s(i.data,t.data)||e),e}function pN(i,t){if(t===null)return{all:!0};if("all"in i.updateTriggers&&hx(i,t,"all"))return{all:!0};const e={};let r=!1;for(const s in i.updateTriggers)s!=="all"&&hx(i,t,s)&&(e[s]=!0,r=!0);return r?e:!1}function fN(i,t){if(t===null)return!0;const e=t.extensions,{extensions:r}=i;if(r===e)return!1;if(!e||!r||r.length!==e.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(e[s]))return!0;return!1}function hx(i,t,e){let r=i.updateTriggers[e];r=r??{};let s=t.updateTriggers[e];return s=s??{},cS({oldProps:s,newProps:r,triggerName:e})}const gN="count(): argument not an object",mN="count(): argument not a container";function yN(i){if(!vN(i))throw new Error(gN);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(_N(i))return Object.keys(i).length;throw new Error(mN)}function _N(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function vN(i){return i!==null&&typeof i=="object"}function bN(i,t){if(!t)return i;const e={...i,...t};if("defines"in t&&(e.defines={...i.defines,...t.defines}),"modules"in t&&(e.modules=(i.modules||[]).concat(t.modules),t.modules.some(r=>r.name==="project64"))){const r=e.modules.findIndex(s=>s.name==="project32");r>=0&&e.modules.splice(r,1)}if("inject"in t)if(!i.inject)e.inject=t.inject;else{const r={...i.inject};for(const s in t.inject)r[s]=(r[s]||"")+t.inject[s];e.inject=r}return e}const wN={10241:9987,10240:9729,10242:33071,10243:33071},L1={};function xN(i,t,e,r){if(e instanceof xa)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let s=null;e.compressed&&(s={10241:e.data.length>1?9985:9729});const n=new xa(t,{...e,parameters:{...wN,...s,...r}});return L1[n.id]=i,n}function AN(i,t){!t||!(t instanceof xa)||L1[t.id]===i&&(t.delete(),delete L1[t.id])}const SN={boolean:{validate(i,t){return!0},equal(i,t,e){return!!i==!!t}},number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},color:{validate(i,t){return t.optional&&!i||M1(i)&&(i.length===3||i.length===4)},equal(i,t,e){return ac(i,t,1)}},accessor:{validate(i,t){const e=Am(i);return e==="function"||e===Am(t.value)},equal(i,t,e){return typeof t=="function"?!0:ac(i,t,1)}},array:{validate(i,t){return t.optional&&!i||M1(i)},equal(i,t,e){const{compare:r}=e,s=Number.isInteger(r)?r:r?1:0;return r?ac(i,t,s):i===t}},object:{equal(i,t,e){if(e.ignore)return!0;const{compare:r}=e,s=Number.isInteger(r)?r:r?1:0;return r?ac(i,t,s):i===t}},function:{validate(i,t){return t.optional&&!i||typeof i=="function"},equal(i,t,e){return!e.compare&&e.ignore!==!1||i===t}},data:{transform:(i,t,e)=>{const{dataTransform:r}=e.props;return r&&i?r(i):i}},image:{transform:(i,t,e)=>{const r=e.context;return!r||!r.gl?null:xN(e.id,r.gl,i,{...t.parameters,...e.props.textureParameters})},release:(i,t,e)=>{AN(e.id,i)}}};function EN(i){const t={},e={},r={};for(const[s,n]of Object.entries(i)){const c=n==null?void 0:n.deprecatedFor;if(c)r[s]=Array.isArray(c)?c:[c];else{const l=CN(s,n);t[s]=l,e[s]=l.value}}return{propTypes:t,defaultProps:e,deprecatedProps:r}}function CN(i,t){switch(Am(t)){case"object":return Bp(i,t);case"array":return Bp(i,{type:"array",value:t,compare:!1});case"boolean":return Bp(i,{type:"boolean",value:t});case"number":return Bp(i,{type:"number",value:t});case"function":return Bp(i,{type:"function",value:t,compare:!0});default:return{name:i,type:"unknown",value:t}}}function Bp(i,t){return"type"in t?{name:i,...SN[t.type],...t}:"value"in t?{name:i,type:Am(t.value),...t}:{name:i,type:"object",value:t}}function M1(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function Am(i){return M1(i)?"array":i===null?"null":typeof i}function TN(i,t){let e;for(let n=t.length-1;n>=0;n--){const c=t[n];"extensions"in c&&(e=c.extensions)}const r=B1(i.constructor,e),s=Object.create(r);s[wm]=i,s[ku]={},s[jh]={};for(let n=0;n<t.length;++n){const c=t[n];for(const l in c)s[l]=c[l]}return Object.freeze(s),s}const PN="_mergedDefaultProps";function B1(i,t){let e=PN;if(t)for(const s of t){const n=s.constructor;n&&(e+=":".concat(n.extensionName||n.name))}return hS(i,e)||(i[e]=IN(i,t||[]))}function IN(i,t){if(!i.prototype)return null;const e=Object.getPrototypeOf(i),r=B1(e),s=hS(i,"defaultProps")||{},n=EN(s),c=Object.assign(Object.create(null),r,n.defaultProps),l=Object.assign(Object.create(null),r==null?void 0:r[qh],n.propTypes),f=Object.assign(Object.create(null),r==null?void 0:r[dy],n.deprecatedProps);for(const y of t){const A=B1(y.constructor);A&&(Object.assign(c,A),Object.assign(l,A[qh]),Object.assign(f,A[dy]))}return LN(c,i),BN(c,l),MN(c,f),c[qh]=l,c[dy]=f,t.length===0&&!sv(i,"_propTypes")&&(i._propTypes=l),c}function LN(i,t){const e=kN(t);Object.defineProperties(i,{id:{writable:!0,value:e}})}function MN(i,t){for(const e in t)Object.defineProperty(i,e,{enumerable:!1,set(r){const s="".concat(this.id,": ").concat(e);for(const n of t[e])sv(this,n)||(this[n]=r);fr.deprecated(s,t[e].join("/"))()}})}function BN(i,t){const e={},r={};for(const s in t){const n=t[s],{name:c,value:l}=n;n.async&&(e[c]=l,r[c]=RN(c))}i[Id]=e,i[ku]={},Object.defineProperties(i,r)}function RN(i){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||rS(t)?this[ku][i]=t:this[jh][i]=t},get(){if(this[jh]){if(i in this[jh])return this[jh][i]||this[Id][i];if(i in this[ku]){const t=this[wm]&&this[wm].internalState;if(t&&t.hasAsyncProp(i))return t.getAsyncProp(i)||this[Id][i]}}return this[Id][i]}}}function sv(i,t){return Object.prototype.hasOwnProperty.call(i,t)}function hS(i,t){return sv(i,t)&&i[t]}function kN(i){const t=i.componentName;return t||fr.warn("".concat(i.name,".componentName not specified"))(),t||i.name}let ON=0;class nv{constructor(){H(this,"id",void 0),H(this,"props",void 0),H(this,"count",void 0);for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.props=TN(this,e),this.id=this.props.id,this.count=ON++}clone(t){const{props:e}=this,r={};for(const s in e[Id])s in e[jh]?r[s]=e[jh][s]:s in e[ku]&&(r[s]=e[ku][s]);return new this.constructor({...e,...r,...t})}}H(nv,"componentName","Component");H(nv,"defaultProps",{});const FN=Object.freeze({});class NN{constructor(t){H(this,"component",void 0),H(this,"onAsyncPropUpdated",void 0),H(this,"asyncProps",void 0),H(this,"oldProps",void 0),H(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||FN}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[wm]||this.component;const e=t[jh]||{},r=t[ku]||t,s=t[Id]||{};for(const n in e){const c=e[n];this._createAsyncPropData(n,s[n]),this._updateAsyncProp(n,c),e[n]=this.getAsyncProp(n)}for(const n in r){const c=r[n];this._createAsyncPropData(n,s[n]),this._updateAsyncProp(n,c)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(rS(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const r=this.asyncProps[t];return e===r.resolvedValue||e===r.lastValue?!1:(r.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const r=this.asyncProps[t];r&&(e=this._postProcessValue(r,e),r.resolvedValue=e,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(t,e,r){const s=this.asyncProps[t];s&&r>=s.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=e,s.resolvedLoadCount=r,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const r=this.asyncProps[t];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;e.then(n=>{this.component&&(n=this._postProcessValue(r,n),this._setAsyncPropValue(t,n,s),this._onResolve(t,n))}).catch(n=>{this._onError(t,n)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const r=this.asyncProps[t];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let n=[],c=0;for await(const l of e){if(!this.component)return;const{dataTransform:f}=this.component.props;f?n=f(l,n):n=n.concat(l),Object.defineProperty(n,"__diff",{enumerable:!1,value:[{startRow:c,endRow:n.length}]}),c=n.length,this._setAsyncPropValue(t,n,s)}this._onResolve(t,n)}_postProcessValue(t,e){const r=t.type;return r&&this.component&&(r.release&&r.release(t.resolvedValue,r,this.component),r.transform)?r.transform(e,r,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const r=this.component&&this.component.props[qh];this.asyncProps[t]={type:r&&r[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class DN extends NN{constructor(t){let{attributeManager:e,layer:r}=t;super(r),H(this,"attributeManager",void 0),H(this,"needsRedraw",void 0),H(this,"needsUpdate",void 0),H(this,"subLayers",void 0),H(this,"usesPickingColorCache",void 0),H(this,"hasPickingBuffer",void 0),H(this,"changeFlags",void 0),H(this,"viewport",void 0),H(this,"uniformTransitions",void 0),H(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(e,{propName:t,layer:r}):super._fetch(t,e)}_onResolve(t,e){const r=this.layer;if(r){const s=r.props.onDataLoad;t==="data"&&s&&s(e,{propName:t,layer:r})}}_onError(t,e){const r=this.layer;r&&r.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const zN="layer.changeFlag",UN="layer.initialize",jN="layer.update",GN="layer.finalize",VN="layer.matched",ux=2**24-1,qN=Object.freeze([]),HN=Pf(i=>{let{oldViewport:t,viewport:e}=i;return t.equals(e)});let ec=new Uint8ClampedArray(0);const WN={data:{type:"data",value:qN,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,t)=>{let{propName:e,layer:r,loaders:s,loadOptions:n,signal:c}=t;const{resourceManager:l}=r.context;if(n=n||r.getLoadOptions(),s=s||r.props.loaders,c){var f;n={...n,fetch:{...(f=n)===null||f===void 0?void 0:f.fetch,signal:c}}}let y=l.contains(i);return!y&&!n&&(l.add({resourceId:i,data:Wh(i,s),persistent:!1}),y=!0),y?l.subscribe({resourceId:i,onChange:A=>{var T;return(T=r.internalState)===null||T===void 0?void 0:T.reloadAsyncProp(e,A)},consumerId:r.id,requestId:e}):Wh(i,s,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:lr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:i=>{let{layerIndex:t}=i;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Yd extends nv{constructor(){super(...arguments),H(this,"internalState",null),H(this,"lifecycle",yd.NO_STATE),H(this,"context",void 0),H(this,"state",void 0),H(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Pn(this.internalState);const e=this.internalState.viewport||this.context.viewport,r=H3(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,n,c]=q3(r,e.pixelProjectionMatrix);return t.length===2?[s,n]:[s,n,c]}unproject(t){return Pn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){Pn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return h8(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===lr.DEFAULT||t===lr.LNGLAT||t===lr.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Pn(t instanceof Uint8Array);const[e,r,s]=t;return e+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:yN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=bN(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:r}=t.changeFlags;if(r&&e)if(Array.isArray(r))for(const s of r)e.invalidateAll(s);else e.invalidateAll();if(e){const{props:s}=t,n=this.internalState.hasPickingBuffer,c=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(n!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:l,instancePickingColors:f}=e.attributes,y=l||f;y&&(c&&y.constant&&(y.constant=!1,e.invalidate(y.id)),!y.value&&!c&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(t){for(const r of this.getModels())r.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:r,sourceLayer:s}=t;const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(t,e){var r,s;if(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),!((r=(s=this.props).onError)!==null&&r!==void 0&&r.call(s,t))){var n,c;(n=this.context)===null||n===void 0||(c=n.onError)===null||c===void 0||c.call(n,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!HN({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,r=this.getNumInstances(),s=this.getStartIndices();t.update({data:e.data,numInstances:r,startIndices:s,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const n=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),r=Object.create(this.props);for(const s in e)Object.defineProperty(r,s,{value:e[s]});return r}return this.props}calculateInstancePickingColors(t,e){let{numInstances:r}=e;if(t.constant)return;const s=Math.floor(ec.length/3);if(this.internalState.usesPickingColorCache=!0,s<r){r>ux&&fr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ec=uf.allocate(ec,r,{size:3,copy:!0,maxCount:Math.max(r,ux)});const n=Math.floor(ec.length/3),c=[];for(let l=s;l<n;l++)this.encodePickingColor(l,c),ec[l*3+0]=c[0],ec[l*3+1]=c[1],ec[l*3+2]=c[2]}t.value=ec.subarray(0,r*3)}_setModelAttributes(t,e){const r=this.getAttributeManager(),s=t.userData.excludeAttributes||{},n=r.getShaderAttributes(e,s);t.setAttributes(n)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:r,instancePickingColors:s}=this.getAttributeManager().attributes,n=r||s,c=n&&e.attributes&&e.attributes[n.id];if(c&&c.value){const l=c.value,f=this.encodePickingColor(t);for(let y=0;y<e.length;y++){const A=n.getVertexOffset(y);l[A]===f[0]&&l[A+1]===f[1]&&l[A+2]===f[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,s=e||r;if(!s)return;const n=s.getVertexOffset(t),c=s.getVertexOffset(t+1);s.buffer.subData({data:new Uint8Array(c-n),offset:n})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,r=t||e;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==ec.buffer&&(r.value=ec.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Pn(!this.internalState),Pn(Number.isFinite(this.props.coordinateSystem)),Xn(UN,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new DN({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(fr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new lN(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Xn(VN,this,this===t);const{state:e,internalState:r}=t;this!==t&&(this.internalState=r,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Xn(jN,this,t),!t)return;const e=this.props,r=this.context,s=this.internalState,n=r.viewport,c=this._updateUniformTransition();s.propsInTransition=c,r.viewport=s.viewport||n,this.props=c;try{const l=this._getUpdateParams(),f=this.getModels();if(r.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const A of this.props.extensions)A.updateState.call(this,l,A);const y=this.getModels()[0]!==f[0];this._postUpdate(l,y)}finally{r.viewport=n,this.props=e,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Xn(GN,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:r={},parameters:s={}}=t;this._updateAttributeTransition();const n=this.props,c=this.context;this.props=this.internalState.propsInTransition||n;const l=this.props.opacity;r.opacity=Math.pow(l,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:f}=this.props,y=f&&f(r)||[0,0];Jc(c.gl,{polygonOffset:y}),wl(c.gl,s,()=>{const A={moduleParameters:e,uniforms:r,parameters:s,context:c};for(const T of this.props.extensions)T.draw.call(this,A,T);this.draw(A)})}finally{this.props=n}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const s in t)if(t[s]){let n=!1;switch(s){case"dataChanged":const c=t[s],l=e[s];c&&Array.isArray(l)&&(e.dataChanged=Array.isArray(c)?l.concat(c):c,n=!0);default:e[s]||(e[s]=t[s],n=!0)}n&&Xn(zN,this,s,t)}const r=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=r,e.somethingChanged=r||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const r=hN(t,e);if(r.updateTriggersChanged)for(const n in r.updateTriggersChanged)r.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(r.transitionsChanged)for(const n in r.transitionsChanged){var s;this.internalState.uniformTransitions.add(n,e[n],t[n],(s=t.transitions)===null||s===void 0?void 0:s[n])}return this.setChangeFlags(r)}validateProps(){cN(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:r}=this.props;t.picked&&typeof r=="function"&&(e.pickingHighlightColor=r(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new rN(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:r,oldProps:s}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:n}=this.state;n==null||n.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:l,highlightColor:f}=r;if(e||s.autoHighlight!==c||s.highlightedObjectIndex!==l||s.highlightColor!==f){const y={};c||(y.pickingSelectedColor=null),Array.isArray(f)&&(y.pickingHighlightColor=f),(e||l!==s.highlightedObjectIndex)&&(y.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(y)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(t):!1;if(e=e||s,e)for(const n of this.props.extensions)n.onNeedsRedraw.call(this,n);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}H(Yd,"defaultProps",WN);H(Yd,"layerName","Layer");const JN="compositeLayer.renderLayers";class uS extends Yd{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:r}=this.props;return r&&r[t]&&r[t].type||e}getSubLayerRow(t,e,r){return t.__source={parent:this,object:e,index:r},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(r,s)=>r&&r.__source?(e.index=r.__source.index,t(r.__source.object,e)):t(r,s)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;const{opacity:r,pickable:s,visible:n,parameters:c,getPolygonOffset:l,highlightedObjectIndex:f,autoHighlight:y,highlightColor:A,coordinateSystem:T,coordinateOrigin:P,wrapLongitude:L,positionFormat:D,modelMatrix:j,extensions:X,fetch:Z,operation:$,_subLayerProps:ht}=this.props,_t={id:"",updateTriggers:{},opacity:r,pickable:s,visible:n,parameters:c,getPolygonOffset:l,highlightedObjectIndex:f,autoHighlight:y,highlightColor:A,coordinateSystem:T,coordinateOrigin:P,wrapLongitude:L,positionFormat:D,modelMatrix:j,extensions:X,fetch:Z,operation:$},Mt=ht&&t.id&&ht[t.id],Nt=Mt&&Mt.updateTriggers,Rt=t.id||"sublayer";if(Mt){const xt=this.props[qh],qt=t.type?t.type._propTypes:{};for(const zt in Mt){const ct=qt[zt]||xt[zt];ct&&ct.type==="accessor"&&(Mt[zt]=this.getSubLayerAccessor(Mt[zt]))}}Object.assign(_t,t,Mt),_t.id="".concat(this.props.id,"-").concat(Rt),_t.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...Nt};for(const xt of X){const qt=xt.getSubLayerProps.call(this,xt);qt&&Object.assign(_t,qt,{updateTriggers:Object.assign(_t.updateTriggers,qt.updateTriggers)})}return _t}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let r=this.internalState.subLayers;const s=!r||this.needsUpdate();if(s){const n=this.renderLayers();r=Nm(n,Boolean),this.internalState.subLayers=r}Xn(JN,this,s,r);for(const n of r)n.parent=this}}H(uS,"layerName","CompositeLayer");const my=512,XN=Math.PI/180;function ZN(i){let{map:t,gl:e,deck:r}=i;if(t.__deck)return t.__deck;const s=r==null?void 0:r.props._customRender,n=r==null?void 0:r.props.onLoad,c=YN({...r==null?void 0:r.props,_customRender:()=>{t.triggerRepaint(),s==null||s("")}});let l;return(!r||r.props.gl===e)&&(Object.assign(c,{gl:e,width:null,height:null,touchAction:"unset",viewState:ov(t)}),r!=null&&r.isInitialized?dx(r,t):c.onLoad=()=>{n==null||n(),dx(l,t)}),r?(l=r,r.setProps(c),r.userData.isExternal=!0):(l=new ev(c),t.on("remove",()=>{$N(t)})),l.userData.mapboxLayers=new Set,t.__deck=l,t.on("render",()=>{l.isInitialized&&rD(l,t)}),l}function dx(i,t){const e=()=>{i.isInitialized?sD(i,t):t.off("move",e)};t.on("move",e)}function $N(i){var t;(t=i.__deck)===null||t===void 0||t.finalize(),i.__deck=null}function YN(i){return{...i,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new Q_({id:"mapbox"})]}}function KN(i,t){i.userData.mapboxLayers.add(t),av(i)}function QN(i,t){i.userData.mapboxLayers.delete(t),av(i)}function tD(i,t){av(i)}function eD(i,t,e){let{currentViewport:r}=i.userData,s=!1;r||(r=dS(i,t,!0),i.userData.currentViewport=r,s=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:n=>{let{layer:c}=n;return e.id===c.id||c.props.operation.includes("terrain")},clearStack:s,clearCanvas:!1})}function ov(i){var t;const{lng:e,lat:r}=i.getCenter(),s={longitude:(e+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(t=i.getTerrain)!==null&&t!==void 0&&t.call(i)&&iD(i,s),s}function iD(i,t){if(i.getFreeCameraOptions){const{position:e}=i.getFreeCameraOptions();if(!e||e.z===void 0)return;const r=i.transform.height,{longitude:s,latitude:n,pitch:c}=t,l=e.x*my,f=(1-e.y)*my,y=e.z*my,A=hf([s,n]),T=l-A[0],P=f-A[1],L=Math.sqrt(T*T+P*P),D=c*XN,j=1.5*r,X=D<.001?j*Math.cos(D)/y:j*Math.sin(D)/L;t.zoom=Math.log2(X);const Z=j*Math.cos(D)/X,$=y-Z;t.position=[0,0,$/Jg(n)]}else typeof i.transform.elevation=="number"&&(t.position=[0,0,i.transform.elevation])}function dS(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Ru({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...ov(t),nearZMultiplier:e?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function rD(i,t){const{mapboxLayers:e,isExternal:r}=i.userData;if(r){const s=Array.from(e,y=>y.id),n=Nm(i.props.layers,Boolean).some(y=>y&&!s.includes(y.id));let c=i.getViewports();const l=c.findIndex(y=>y.id==="mapbox"),f=c.length>1||l<0;(n||f)&&(l>=0&&(c=c.slice(),c[l]=dS(i,t,!1)),i._drawLayers("mapbox-repaint",{viewports:c,layerFilter:y=>(!i.props.layerFilter||i.props.layerFilter(y))&&(y.viewport.id!=="mapbox"||!s.includes(y.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function sD(i,t){i.setProps({viewState:ov(t)}),i.needsRedraw({clearRedrawFlags:!0})}function av(i){if(i.userData.isExternal)return;const t=[];i.userData.mapboxLayers.forEach(e=>{const r=e.props.type,s=new r(e.props);t.push(s)}),i.setProps({layers:t})}class nD{constructor(t){if(H(this,"id",void 0),H(this,"type",void 0),H(this,"renderingMode",void 0),H(this,"map",void 0),H(this,"deck",void 0),H(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=ZN({map:t,gl:e,deck:this.props.deck}),KN(this.deck,this)}onRemove(){this.deck&&QN(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&tD(this.deck)}render(){eD(this.deck,this.map,this)}}const oD=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,aD=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,pS=[0,0,0,255],fS=[0,0,1],lD={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:fS},getColor:{type:"accessor",value:pS},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function cD(i){const{header:t,attributes:e}=i;!t||!e||(i.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}class lv extends Yd{getShaders(){return super.getShaders({vs:oD,fs:aD,modules:[Y_,Lk,K_]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:fS},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:pS}})}updateState(t){const{changeFlags:e,props:r}=t;if(super.updateState(t),e.extensionsChanged){var s;const{gl:n}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(n),this.getAttributeManager().invalidateAll()}e.dataChanged&&cD(r.data)}draw(t){let{uniforms:e}=t;const{pointSize:r,sizeUnits:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:h1[s],radiusPixels:r}).draw()}_getModel(t){const e=[];for(let r=0;r<3;r++){const s=r/3*Math.PI*2;e.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new Gd(t,{...this.getShaders(),id:this.props.id,geometry:new Qp({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}H(lv,"layerName","PointCloudLayer");H(lv,"defaultProps",lD);const va={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new te;new te;const Rp=new te,px=new te;class Mf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;H(this,"center",void 0),H(this,"radius",void 0),this.radius=-0,this.center=new te,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Rp.from(e),this.center=new te().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Mf(this.center,this.radius)}union(t){const e=this.center,r=this.radius,s=t.center,n=t.radius,c=Rp.copy(s).subtract(e),l=c.magnitude();if(r>=l+n)return this.clone();if(n>=l+r)return t.clone();const f=(r+l+n)*.5;return px.copy(c).scale((-r+f)/l).add(e),this.center.copy(px),this.radius=f,this}expand(t){const e=Rp.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=NR(Rp,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=Rp.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,r=this.radius,s=t.normal.dot(e)+t.distance;return s<-r?va.OUTSIDE:s<r?va.INTERSECTING:va.INSIDE}}const hD=new te,uD=new te,Eg=new te,Cg=new te,Tg=new te,dD=new te,pD=new te,Fc={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Bf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];H(this,"center",void 0),H(this,"halfAxes",void 0),this.center=new te().from(t),this.halfAxes=new Is(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new te(t).len(),new te(e).len(),new te(r).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),s=new te(t).normalize(),n=new te(e).normalize(),c=new te(r).normalize();return new lf().fromMatrix3(new Is([...s,...n,...c]))}fromCenterHalfSizeQuaternion(t,e,r){const s=new lf(r),n=new Is().fromQuaternion(s);return n[0]=n[0]*e[0],n[1]=n[1]*e[0],n[2]=n[2]*e[0],n[3]=n[3]*e[1],n[4]=n[4]*e[1],n[5]=n[5]*e[1],n[6]=n[6]*e[2],n[7]=n[7]*e[2],n[8]=n[8]*e[2],this.center=new te().from(t),this.halfAxes=n,this}clone(){return new Bf(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Mf;const e=this.halfAxes,r=e.getColumn(0,Eg),s=e.getColumn(1,Cg),n=e.getColumn(2,Tg),c=hD.copy(r).add(s).add(n);return t.center.copy(this.center),t.radius=c.magnitude(),t}intersectPlane(t){const e=this.center,r=t.normal,s=this.halfAxes,n=r.x,c=r.y,l=r.z,f=Math.abs(n*s[Fc.COLUMN0ROW0]+c*s[Fc.COLUMN0ROW1]+l*s[Fc.COLUMN0ROW2])+Math.abs(n*s[Fc.COLUMN1ROW0]+c*s[Fc.COLUMN1ROW1]+l*s[Fc.COLUMN1ROW2])+Math.abs(n*s[Fc.COLUMN2ROW0]+c*s[Fc.COLUMN2ROW1]+l*s[Fc.COLUMN2ROW2]),y=r.dot(e)+t.distance;return y<=-f?va.OUTSIDE:y>=f?va.INSIDE:va.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=uD.from(t).subtract(this.center),r=this.halfAxes,s=r.getColumn(0,Eg),n=r.getColumn(1,Cg),c=r.getColumn(2,Tg),l=s.magnitude(),f=n.magnitude(),y=c.magnitude();s.normalize(),n.normalize(),c.normalize();let A=0,T;return T=Math.abs(e.dot(s))-l,T>0&&(A+=T*T),T=Math.abs(e.dot(n))-f,T>0&&(A+=T*T),T=Math.abs(e.dot(c))-y,T>0&&(A+=T*T),A}computePlaneDistances(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const c=this.center,l=this.halfAxes,f=l.getColumn(0,Eg),y=l.getColumn(1,Cg),A=l.getColumn(2,Tg),T=dD.copy(f).add(y).add(A).add(c),P=pD.copy(T).subtract(t);let L=e.dot(P);return s=Math.min(L,s),n=Math.max(L,n),T.copy(c).add(f).add(y).subtract(A),P.copy(T).subtract(t),L=e.dot(P),s=Math.min(L,s),n=Math.max(L,n),T.copy(c).add(f).subtract(y).add(A),P.copy(T).subtract(t),L=e.dot(P),s=Math.min(L,s),n=Math.max(L,n),T.copy(c).add(f).subtract(y).subtract(A),P.copy(T).subtract(t),L=e.dot(P),s=Math.min(L,s),n=Math.max(L,n),c.copy(T).subtract(f).add(y).add(A),P.copy(T).subtract(t),L=e.dot(P),s=Math.min(L,s),n=Math.max(L,n),c.copy(T).subtract(f).add(y).subtract(A),P.copy(T).subtract(t),L=e.dot(P),s=Math.min(L,s),n=Math.max(L,n),c.copy(T).subtract(f).subtract(y).add(A),P.copy(T).subtract(t),L=e.dot(P),s=Math.min(L,s),n=Math.max(L,n),c.copy(T).subtract(f).subtract(y).subtract(A),P.copy(T).subtract(t),L=e.dot(P),s=Math.min(L,s),n=Math.max(L,n),r[0]=s,r[1]=n,r}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Eg);e.transformAsPoint(t);const r=this.halfAxes.getColumn(1,Cg);r.transformAsPoint(t);const s=this.halfAxes.getColumn(2,Tg);return s.transformAsPoint(t),this.halfAxes=new Is([...e,...r,...s]),this}getTransform(){throw new Error("not implemented")}}const fx=new te,gx=new te;class yl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;H(this,"normal",void 0),H(this,"distance",void 0),this.normal=new te,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return _l(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=fx.from(t),this.normal.from(e).normalize();const r=-this.normal.dot(t);return this.distance=r,this}fromCoefficients(t,e,r,s){return this.normal.set(t,e,r),_l(xl(this.normal.len(),1)),this.distance=s,this}clone(){return new yl(this.normal,this.distance)}equals(t){return xl(this.distance,t.distance)&&xl(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=gx.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}projectPointOntoPlane(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=fx.from(t);const r=this.getPointDistance(t),s=gx.copy(this.normal).scale(r);return t.subtract(s).to(e)}}const mx=[new te([1,0,0]),new te([0,1,0]),new te([0,0,1])],yx=new te,fD=new te;new yl(new te(1,0,0),0);class Wa{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];H(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*mx.length;const e=t.center,r=t.radius;let s=0;for(const n of mx){let c=this.planes[s],l=this.planes[s+1];c||(c=this.planes[s]=new yl),l||(l=this.planes[s+1]=new yl);const f=yx.copy(n).scale(-r).add(e);-n.dot(f),c.fromPointNormal(f,n);const y=yx.copy(n).scale(r).add(e),A=fD.copy(n).negate();-A.dot(y),l.fromPointNormal(y,A),s+=2}return this}computeVisibility(t){let e=va.INSIDE;for(const r of this.planes)switch(t.intersectPlane(r)){case va.OUTSIDE:return va.OUTSIDE;case va.INTERSECTING:e=va.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(_l(Number.isFinite(e),"parentPlaneMask is required."),e===Wa.MASK_OUTSIDE||e===Wa.MASK_INSIDE)return e;let r=Wa.MASK_INSIDE;const s=this.planes;for(let n=0;n<this.planes.length;++n){const c=n<31?1<<n:0;if(n<31&&!(e&c))continue;const l=s[n],f=t.intersectPlane(l);if(f===va.OUTSIDE)return Wa.MASK_OUTSIDE;f===va.INTERSECTING&&(r|=c)}return r}}H(Wa,"MASK_OUTSIDE",4294967295);H(Wa,"MASK_INSIDE",0);H(Wa,"MASK_INDETERMINATE",2147483647);new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;const ic=new Is,gD=new Is,mD=new Is,Pg=new Is,_x=new Is;function yD(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=cf.EPSILON20,r=10;let s=0,n=0;const c=gD,l=mD;c.identity(),l.copy(i);const f=e*_D(l);for(;n<r&&vD(l)>f;)bD(l,Pg),_x.copy(Pg).transpose(),l.multiplyRight(Pg),l.multiplyLeft(_x),c.multiplyRight(Pg),++s>2&&(++n,s=0);return t.unitary=c.toTarget(t.unitary),t.diagonal=l.toTarget(t.diagonal),t}function _D(i){let t=0;for(let e=0;e<9;++e){const r=i[e];t+=r*r}return Math.sqrt(t)}const R1=[1,0,0],k1=[2,2,1];function vD(i){let t=0;for(let e=0;e<3;++e){const r=i[ic.getElementIndex(k1[e],R1[e])];t+=2*r*r}return Math.sqrt(t)}function bD(i,t){const e=cf.EPSILON15;let r=0,s=1;for(let y=0;y<3;++y){const A=Math.abs(i[ic.getElementIndex(k1[y],R1[y])]);A>r&&(s=y,r=A)}const n=R1[s],c=k1[s];let l=1,f=0;if(Math.abs(i[ic.getElementIndex(c,n)])>e){const y=i[ic.getElementIndex(c,c)],A=i[ic.getElementIndex(n,n)],T=i[ic.getElementIndex(c,n)],P=(y-A)/2/T;let L;P<0?L=-1/(-P+Math.sqrt(1+P*P)):L=1/(P+Math.sqrt(1+P*P)),l=1/Math.sqrt(1+L*L),f=L*l}return Is.IDENTITY.to(t),t[ic.getElementIndex(n,n)]=t[ic.getElementIndex(c,c)]=l,t[ic.getElementIndex(c,n)]=f,t[ic.getElementIndex(n,c)]=-f,t}const kh=new te,wD=new te,xD=new te,AD=new te,SD=new te,ED=new Is,CD={diagonal:new Is,unitary:new Is};function TD(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Bf;if(!i||i.length===0)return t.halfAxes=new Is([0,0,0,0,0,0,0,0,0]),t.center=new te,t;const e=i.length,r=new te(0,0,0);for(const qt of i)r.add(qt);const s=1/e;r.multiplyByScalar(s);let n=0,c=0,l=0,f=0,y=0,A=0;for(const qt of i){const zt=kh.copy(qt).subtract(r);n+=zt.x*zt.x,c+=zt.x*zt.y,l+=zt.x*zt.z,f+=zt.y*zt.y,y+=zt.y*zt.z,A+=zt.z*zt.z}n*=s,c*=s,l*=s,f*=s,y*=s,A*=s;const T=ED;T[0]=n,T[1]=c,T[2]=l,T[3]=c,T[4]=f,T[5]=y,T[6]=l,T[7]=y,T[8]=A;const{unitary:P}=yD(T,CD),L=t.halfAxes.copy(P);let D=L.getColumn(0,xD),j=L.getColumn(1,AD),X=L.getColumn(2,SD),Z=-Number.MAX_VALUE,$=-Number.MAX_VALUE,ht=-Number.MAX_VALUE,_t=Number.MAX_VALUE,Mt=Number.MAX_VALUE,Nt=Number.MAX_VALUE;for(const qt of i)kh.copy(qt),Z=Math.max(kh.dot(D),Z),$=Math.max(kh.dot(j),$),ht=Math.max(kh.dot(X),ht),_t=Math.min(kh.dot(D),_t),Mt=Math.min(kh.dot(j),Mt),Nt=Math.min(kh.dot(X),Nt);D=D.multiplyByScalar(.5*(_t+Z)),j=j.multiplyByScalar(.5*(Mt+$)),X=X.multiplyByScalar(.5*(Nt+ht)),t.center.copy(D).add(j).add(X);const Rt=wD.set(Z-_t,$-Mt,ht-Nt).multiplyByScalar(.5),xt=new Is([Rt[0],0,0,0,Rt[1],0,0,0,Rt[2]]);return t.halfAxes.multiplyRight(xt),t}const yy=Math.PI/180,Ig=new Float32Array(16),vx=new Float32Array(12);function bx(i,t,e){const r=t[0]*yy,s=t[1]*yy,n=t[2]*yy,c=Math.sin(n),l=Math.sin(r),f=Math.sin(s),y=Math.cos(n),A=Math.cos(r),T=Math.cos(s),P=e[0],L=e[1],D=e[2];i[0]=P*T*A,i[1]=P*f*A,i[2]=P*-l,i[3]=L*(-f*y+T*l*c),i[4]=L*(T*y+f*l*c),i[5]=L*A*c,i[6]=D*(f*c+T*l*y),i[7]=D*(-T*c+f*l*y),i[8]=D*A*y}function wx(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const gS={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,t){let{startRow:e,endRow:r}=t;const{data:s,getOrientation:n,getScale:c,getTranslation:l,getTransformMatrix:f}=this.props,y=Array.isArray(f),A=y&&f.length===16,T=Array.isArray(c),P=Array.isArray(n),L=Array.isArray(l),D=A||!y&&!!f(s[0]);D?i.constant=A:i.constant=P&&T&&L;const j=i.value;if(i.constant){let X;D?(Ig.set(f),X=wx(Ig)):(X=vx,bx(X,n,c),X.set(l,9)),i.value=new Float32Array(X)}else{let X=e*i.size;const{iterable:Z,objectInfo:$}=iS(s,e,r);for(const ht of Z){$.index++;let _t;if(D)Ig.set(A?f:f(ht,$)),_t=wx(Ig);else{_t=vx;const Mt=P?n:n(ht,$),Nt=T?c:c(ht,$);bx(_t,Mt,Nt),_t.set(L?l:l(ht,$),9)}j[X++]=_t[0],j[X++]=_t[1],j[X++]=_t[2],j[X++]=_t[3],j[X++]=_t[4],j[X++]=_t[5],j[X++]=_t[6],j[X++]=_t[7],j[X++]=_t[8],j[X++]=_t[9],j[X++]=_t[10],j[X++]=_t[11]}}}};function mS(i,t){return t===lr.CARTESIAN||t===lr.METER_OFFSETS||t===lr.DEFAULT&&!i.isGeospatial}const PD=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ID=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function yS(i){let t=1/0,e=1/0,r=1/0,s=-1/0,n=-1/0,c=-1/0;const l=i.POSITION?i.POSITION.value:[],f=l&&l.length;for(let y=0;y<f;y+=3){const A=l[y],T=l[y+1],P=l[y+2];t=A<t?A:t,e=T<e?T:e,r=P<r?P:r,s=A>s?A:s,n=T>n?T:n,c=P>c?P:c}return[[t,e,r],[s,n,c]]}function LD(i,t){if(!i)throw new Error("loader assertion failed.")}class Sd{constructor(t,e){H(this,"fields",void 0),H(this,"metadata",void 0),LD(Array.isArray(t)),MD(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];for(const c of r)t[c]=!0;const n=this.fields.filter(c=>t[c.name]);return new Sd(n,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const s=e.map(n=>this.fields[n]).filter(Boolean);return new Sd(s,this.metadata)}assign(t){let e,r=this.metadata;if(t instanceof Sd){const c=t;e=c.fields,r=xx(xx(new Map,this.metadata),c.metadata)}else e=t;const s=Object.create(null);for(const c of this.fields)s[c.name]=c;for(const c of e)s[c.name]=c;const n=Object.values(s);return new Sd(n,r)}}function MD(i){const t={};for(const e of i)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function xx(i,t){return new Map([...i||new Map,...t||new Map])}class Sm{constructor(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;H(this,"name",void 0),H(this,"type",void 0),H(this,"nullable",void 0),H(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=r,this.metadata=s}get typeId(){return this.type&&this.type.typeId}clone(){return new Sm(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Ts=function(i){return i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i}({}),_S,vS,bS;class cv{static isNull(t){return t&&t.typeId===Ts.Null}static isInt(t){return t&&t.typeId===Ts.Int}static isFloat(t){return t&&t.typeId===Ts.Float}static isBinary(t){return t&&t.typeId===Ts.Binary}static isUtf8(t){return t&&t.typeId===Ts.Utf8}static isBool(t){return t&&t.typeId===Ts.Bool}static isDecimal(t){return t&&t.typeId===Ts.Decimal}static isDate(t){return t&&t.typeId===Ts.Date}static isTime(t){return t&&t.typeId===Ts.Time}static isTimestamp(t){return t&&t.typeId===Ts.Timestamp}static isInterval(t){return t&&t.typeId===Ts.Interval}static isList(t){return t&&t.typeId===Ts.List}static isStruct(t){return t&&t.typeId===Ts.Struct}static isUnion(t){return t&&t.typeId===Ts.Union}static isFixedSizeBinary(t){return t&&t.typeId===Ts.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Ts.FixedSizeList}static isMap(t){return t&&t.typeId===Ts.Map}static isDictionary(t){return t&&t.typeId===Ts.Dictionary}get typeId(){return Ts.NONE}compareTo(t){return this===t}}_S=Symbol.toStringTag;class Kd extends cv{constructor(t,e){super(),H(this,"isSigned",void 0),H(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Ts.Int}get[_S](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class BD extends Kd{constructor(){super(!0,8)}}class RD extends Kd{constructor(){super(!0,16)}}class kD extends Kd{constructor(){super(!0,32)}}class OD extends Kd{constructor(){super(!1,8)}}class FD extends Kd{constructor(){super(!1,16)}}class ND extends Kd{constructor(){super(!1,32)}}const wS={HALF:16,SINGLE:32,DOUBLE:64};vS=Symbol.toStringTag;class xS extends cv{constructor(t){super(),H(this,"precision",void 0),this.precision=t}get typeId(){return Ts.Float}get[vS](){return"Float"}toString(){return"Float".concat(this.precision)}}class DD extends xS{constructor(){super(wS.SINGLE)}}class zD extends xS{constructor(){super(wS.DOUBLE)}}bS=Symbol.toStringTag;class UD extends cv{constructor(t,e){super(),H(this,"listSize",void 0),H(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Ts.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[bS](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function jD(i){switch(i.constructor){case Int8Array:return new BD;case Uint8Array:return new OD;case Int16Array:return new RD;case Uint16Array:return new FD;case Int32Array:return new kD;case Uint32Array:return new ND;case Float32Array:return new DD;case Float64Array:return new zD;default:throw new Error("array type not supported")}}function GD(i,t,e){const r=jD(t.value),s=e||VD(t);return new Sm(i,new UD(t.size,new Sm("value",r)),!1,s)}function VD(i){const t=new Map;return"byteOffset"in i&&t.set("byteOffset",i.byteOffset.toString(10)),"byteStride"in i&&t.set("byteStride",i.byteStride.toString(10)),"normalized"in i&&t.set("normalized",i.normalized.toString()),t}function Ax(i,t){(i.COLOR_0||i.colors)&&t||(i.colors={constant:!0,value:new Float32Array([1,1,1])}),fr.assert(i.positions||i.POSITION,'no "postions" or "POSITION" attribute in mesh')}function Sx(i,t){if(i.attributes)return Ax(i.attributes,t),i instanceof Qp?i:new Qp(i);if(i.positions||i.POSITION)return Ax(i,t),new Qp({attributes:i});throw Error("Invalid mesh")}const qD=[0,0,0,255],HD={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:qD},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class hv extends Yd{constructor(){super(...arguments),H(this,"state",void 0)}getShaders(){const t=!Ki(this.context.gl),e={};return M_(this.context.gl,is.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:PD,fs:ID,modules:[Y_,Mk,K_],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=(t=r.header)===null||t===void 0?void 0:t.boundingBox,!e){const{attributes:s}=Sx(r,this.props._useMeshColors);s.POSITION=s.POSITION||s.positions,e=yS(s)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:gS}),this.setState({emptyTexture:new xa(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:r,changeFlags:s}=t;if(e.mesh!==r.mesh||s.extensionsChanged){var n;if(this.state.positionBounds=null,(n=this.state.model)===null||n===void 0||n.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const c=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(c.NORMAL||c.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==r.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:e}=t;if(!this.state.model)return;const{viewport:r}=this.context,{sizeScale:s,coordinateSystem:n,_instanced:c}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:s,composeModelMatrix:!c||mS(r,n),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const e=new Gd(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:Sx(t,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:s}=this.state;return e.setUniforms({sampler:r||s,hasTexture:!!r}),e}setTexture(t){const{emptyTexture:e,model:r}=this.state;r&&r.setUniforms({sampler:t||e,hasTexture:!!t})}}H(hv,"defaultProps",HD);H(hv,"layerName","SimpleMeshLayer");class Ld{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e}=t;this.id=e||Xc(this.constructor.name),this.display=!0,this.position=new te,this.rotation=new te,this.scale=new te(1,1,1),this.matrix=new er,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return ti(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return ti(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return ti(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){!(arguments.length>1&&arguments[1]!==void 0)||arguments[1]?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:e,rotation:r,scale:s,update:n=!0}=t;return e&&this.setPosition(e),r&&this.setRotation(r),s&&this.setScale(s),n&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(r),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:e,rotation:r,scale:s}=t;return e&&this.setPosition(e),r&&this.setRotation(r),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(t,e){ti(t),e=e||this.matrix;const r=new er(t).multiplyRight(e),s=r.invert(),n=s.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:r,worldInverseMatrix:s,worldInverseTransposeMatrix:n}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class tf extends Ld{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;di.assert(e.every(r=>r instanceof Ld),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)Array.isArray(s)?this.add(...s):this.children.push(s);return this}remove(t){const e=this.children,r=e.indexOf(t);return r>-1&&e.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,r)=>{let{worldMatrix:s}=r;const n=e.getBounds();if(!n)return;const[c,l]=n,f=new te(c).add(l).divide([2,2,2]);s.transformAsPoint(f,f);const y=new te(l).subtract(c).divide([2,2,2]);s.transformAsVector(y,y);for(let A=0;A<8;A++){const T=new te(A&1?-1:1,A&2?-1:1,A&4?-1:1).multiply(y).add(f);for(let P=0;P<3;P++)t[0][P]=Math.min(t[0][P],T[P]),t[1][P]=Math.max(t[1][P],T[P])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new er}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new er(e).multiplyRight(this.matrix);for(const s of this.children)s instanceof tf?s.traverse(t,{worldMatrix:r}):t(s,{worldMatrix:r})}}const WD={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},JD={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Ex(i){if(!i._animation){const t=JD[i.componentType],e=WD[i.type],r=e*i.count,{buffer:s,byteOffset:n}=i.bufferView.data,c=new t(s,n+(i.byteOffset||0),r);if(e===1)i._animation=Array.from(c);else{const l=[];for(let f=0;f<c.length;f+=e)l.push(Array.from(c.slice(f,f+e)));i._animation=l}}return i._animation}const XD=new er;function ZD(i,t){if(t.matrix.identity(),i.translation&&t.matrix.translate(i.translation),i.rotation){const e=XD.fromQuaternion(i.rotation);t.matrix.multiplyRight(e)}i.scale&&t.matrix.scale(i.scale)}const _y=new lf;function $D(i,t,e,r,s){if(t==="rotation"){_y.slerp({start:e,target:r,ratio:s});for(let n=0;n<_y.length;n++)i[t][n]=_y[n]}else for(let n=0;n<e.length;n++)i[t][n]=s*r[n]+(1-s)*e[n]}function YD(i,t,e){let{p0:r,outTangent0:s,inTangent1:n,p1:c,tDiff:l,ratio:f}=e;for(let y=0;y<i[t].length;y++){const A=s[y]*l,T=n[y]*l;i[t][y]=(2*Math.pow(f,3)-3*Math.pow(f,2)+1)*r[y]+(Math.pow(f,3)-2*Math.pow(f,2)+f)*A+(-2*Math.pow(f,3)+3*Math.pow(f,2))*c[y]+(Math.pow(f,3)-Math.pow(f,2))*T}}function KD(i,t,e){for(let r=0;r<e.length;r++)i[t][r]=e[r]}function QD(i,t,e,r){let{input:s,interpolation:n,output:c}=t;const l=s[s.length-1],f=i%l,y=s.findIndex(L=>L>=f),A=Math.max(0,y-1);if(!Array.isArray(e[r]))switch(r){case"translation":e[r]=[0,0,0];break;case"rotation":e[r]=[0,0,0,1];break;case"scale":e[r]=[1,1,1];break;default:di.warn("Bad animation path ".concat(r))()}ti(e[r].length===c[A].length);const T=s[A],P=s[y];switch(n){case"STEP":KD(e,r,c[A]);break;case"LINEAR":if(P>T){const L=(f-T)/(P-T);$D(e,r,c[A],c[y],L)}break;case"CUBICSPLINE":if(P>T){const L=(f-T)/(P-T),D=P-T,j=c[3*A+1],X=c[3*A+2],Z=c[3*y+0],$=c[3*y+1];YD(e,r,{p0:j,outTangent0:X,inTangent1:Z,p1:$,tDiff:D,ratio:L})}break;default:di.warn("Interpolation ".concat(n," not supported"))();break}}class tz{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const e=(t/1e3-this.startTime)*this.speed;this.channels.forEach(r=>{let{sampler:s,target:n,path:c}=r;QD(e,s,n,c),ZD(n,n._node)})}}class ez{constructor(t){this.animations=t.animations.map((e,r)=>{const s=e.name||"Animation-".concat(r),n=e.samplers.map(l=>{let{input:f,interpolation:y="LINEAR",output:A}=l;return{input:Ex(t.accessors[f]),interpolation:y,output:Ex(t.accessors[A])}}),c=e.channels.map(l=>{let{sampler:f,target:y}=l;return{sampler:n[f],target:t.nodes[y.node],path:y.path}});return new tz({name:s,channels:c})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class iz extends Ld{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof Gd?(this.model=t,this._setModelNodeProps(e)):this.model=new Gd(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class AS{constructor(t,e){let{attributes:r,material:s,pbrDebug:n,imageBasedLightingEnvironment:c,lights:l,useTangents:f}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},M_(t,is.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],c&&(this.uniforms.u_DiffuseEnvSampler=c.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=c.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=c.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),n&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&f,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(c,"USE_IBL"),this.defineIfPresent(l,"USE_LIGHTS"),this.defineIfPresent(n,"PBR_DEBUG"),s&&this.parseMaterial(s)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const s=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},n=t.texture.source.image;let c,l={};n.compressed?(c=n,l={[this.gl.TEXTURE_MIN_FILTER]:n.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):c={data:n};const f=new xa(this.gl,{id:t.name||t.id,parameters:{...s,...l},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...c});this.uniforms[e]=f,this.defineIfPresent(r,r),this.generatedTextures.push(f)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:r=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,r]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else t.alphaMode==="BLEND"&&(di.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const rz=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,sz=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Cx(i,t){return Ki(i)?`#version 300 es
`.concat(t):t}function nz(i,t){const{id:e,drawMode:r,vertexCount:s,attributes:n,modelOptions:c}=t,l=new AS(i,t);di.info(4,"createGLTFModel defines: ",l.defines)();const f=[];f.push(...l.generatedTextures),f.push(...Object.values(n).map(A=>A.buffer));const y=new iz(i,{id:e,drawMode:r,vertexCount:s,modules:[q_],parameters:l.parameters,vs:Cx(i,rz),fs:Cx(i,sz),managedResources:f,...c,defines:{...l.defines,...c.defines}});return y.setProps({attributes:n}),y.setUniforms(l.uniforms),y}const oz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},az={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class lz{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},az,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(e=>this.createScene(e))}createAnimator(){return Array.isArray(this.gltf.animations)?new ez(this.gltf):null}createScene(t){const e=(t.nodes||[]).map(r=>this.createNode(r));return new tf({id:t.name||t.id,children:e})}createNode(t){if(!t._node){const e=(t.children||[]).map(s=>this.createNode(s));t.mesh&&e.push(this.createMesh(t.mesh));const r=new tf({id:t.name||t.id,children:e});if(t.matrix)r.setMatrix(t.matrix);else{if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){const s=new er().fromQuaternion(t.rotation);r.matrix.multiplyRight(s)}t.scale&&r.matrix.scale(t.scale)}t._node=r}return t._node}createMesh(t){if(!t._mesh){const e=(t.primitives||[]).map((s,n)=>this.createPrimitive(s,n,t)),r=new tf({id:t.name||t.id,children:e});t._mesh=r}return t._mesh}getVertexCount(t){di.warn("getVertexCount() not found")()}createPrimitive(t,e,r){const s=nz(this.gl,Object.assign({id:t.name||"".concat(r.name||r.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return s.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],s}createAttributes(t,e){const r={};return Object.keys(t).forEach(s=>{r[s]=this.createAccessor(t[s],this.createBuffer(t[s],this.gl.ARRAY_BUFFER))}),e&&(r.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),di.info(4,"glTF Attributes",{attributes:t,indices:e,generated:r})(),r}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:r}=t;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[e]||(r.lumaBuffers[e]=new Hr(this.gl,{id:"from-".concat(r.id),data:r.data||t.value,target:e})),r.lumaBuffers[e]}createAccessor(t,e){return new zo({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:oz[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function cz(i,t,e){const r=new lz(i,e),s=r.instantiate(t),n=r.createAnimator();return{scenes:s,animator:n}}const hz="3.4.15",uz="3.4.15",SS="3.4.15",dz="https://unpkg.com/@loaders.gl/textures@".concat(SS,"/dist/libs/basis_encoder.wasm"),pz="https://unpkg.com/@loaders.gl/textures@".concat(SS,"/dist/libs/basis_encoder.js");let vy;async function Tx(i){const t=i.modules||{};return t.basis?t.basis:(vy=vy||fz(i),await vy)}async function fz(i){let t=null,e=null;return[t,e]=await Promise.all([await Pu("basis_transcoder.js","textures",i),await Pu("basis_transcoder.wasm","textures",i)]),t=t||globalThis.BASIS,await gz(t,e)}function gz(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i(e).then(s=>{const{BasisFile:n,initializeBasis:c}=s;c(),r({BasisFile:n})})})}let by;async function Px(i){const t=i.modules||{};return t.basisEncoder?t.basisEncoder:(by=by||mz(i),await by)}async function mz(i){let t=null,e=null;return[t,e]=await Promise.all([await Pu(pz,"textures",i),await Pu(dz,"textures",i)]),t=t||globalThis.BASIS,await yz(t,e)}function yz(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i(e).then(s=>{const{BasisFile:n,KTX2File:c,initializeBasis:l,BasisEncoder:f}=s;l(),r({BasisFile:n,KTX2File:c,BasisEncoder:f})})})}const ud={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},_z=["","WEBKIT_","MOZ_"],Ix={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Lg=null;function vz(i){if(!Lg){i=i||bz()||void 0,Lg=new Set;for(const t of _z)for(const e in Ix)if(i&&i.getExtension("".concat(t).concat(e))){const r=Ix[e];Lg.add(r)}}return Lg}function bz(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Lx,Mx,Bx,Rx,kx,Ox,Fx,Nx;(function(i){i[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB"})(Lx||(Lx={})),function(i){i[i.BASICFORMAT=0]="BASICFORMAT"}(Mx||(Mx={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.ETC1S=163]="ETC1S",i[i.UASTC=166]="UASTC"}(Bx||(Bx={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB"}(Rx||(Rx={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.LINEAR=1]="LINEAR",i[i.SRGB=2]="SRGB",i[i.ITU=3]="ITU",i[i.NTSC=4]="NTSC",i[i.SLOG=5]="SLOG",i[i.SLOG2=6]="SLOG2"}(kx||(kx={})),function(i){i[i.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",i[i.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Ox||(Ox={})),function(i){i[i.RGB=0]="RGB",i[i.RRR=3]="RRR",i[i.GGG=4]="GGG",i[i.AAA=15]="AAA"}(Fx||(Fx={})),function(i){i[i.RGB=0]="RGB",i[i.RGBA=3]="RGBA",i[i.RRR=4]="RRR",i[i.RRRG=5]="RRRG"}(Nx||(Nx={}));const ga=[171,75,84,88,32,50,48,187,13,10,26,10];function wz(i){const t=new Uint8Array(i);return!(t.byteLength<ga.length||t[0]!==ga[0]||t[1]!==ga[1]||t[2]!==ga[2]||t[3]!==ga[3]||t[4]!==ga[4]||t[5]!==ga[5]||t[6]!==ga[6]||t[7]!==ga[7]||t[8]!==ga[8]||t[9]!==ga[9]||t[10]!==ga[10]||t[11]!==ga[11])}const xz={etc1:{basisFormat:0,compressed:!0,format:ud.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:ud.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:ud.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:ud.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:ud.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:ud.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Az(i,t){if(t.basis.containerFormat==="auto"){if(wz(i)){const r=await Px(t);return Dx(r.KTX2File,i,t)}const{BasisFile:e}=await Tx(t);return wy(e,i,t)}switch(t.basis.module){case"encoder":const e=await Px(t);switch(t.basis.containerFormat){case"ktx2":return Dx(e.KTX2File,i,t);case"basis":default:return wy(e.BasisFile,i,t)}case"transcoder":default:const{BasisFile:r}=await Tx(t);return wy(r,i,t)}}function wy(i,t,e){const r=new i(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const s=r.getNumImages(),n=[];for(let c=0;c<s;c++){const l=r.getNumLevels(c),f=[];for(let y=0;y<l;y++)f.push(Sz(r,c,y,e));n.push(f)}return n}finally{r.close(),r.delete()}}function Sz(i,t,e,r){const s=i.getImageWidth(t,e),n=i.getImageHeight(t,e),c=i.getHasAlpha(),{compressed:l,format:f,basisFormat:y}=ES(r,c),A=i.getImageTranscodedSizeInBytes(t,e,y),T=new Uint8Array(A);if(!i.transcodeImage(T,t,e,y,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:n,data:T,compressed:l,format:f,hasAlpha:c}}function Dx(i,t,e){const r=new i(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=r.getLevels(),n=[];for(let c=0;c<s;c++){n.push(Ez(r,c,e));break}return[n]}finally{r.close(),r.delete()}}function Ez(i,t,e){const{alphaFlag:r,height:s,width:n}=i.getImageLevelInfo(t,0,0),{compressed:c,format:l,basisFormat:f}=ES(e,r),y=i.getImageTranscodedSizeInBytes(t,0,0,f),A=new Uint8Array(y);if(!i.transcodeImage(A,t,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:n,height:s,data:A,compressed:c,levelSize:y,hasAlpha:r,format:l}}function ES(i,t){let e=i&&i.basis&&i.basis.format;return e==="auto"&&(e=CS()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),xz[e]}function CS(){const i=vz();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const Cz={name:"Basis",id:qc?"basis":"basis-nodejs",module:"textures",version:uz,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Tz={...Cz,parse:Az};function ba(i,t){if(!i)throw new Error(t||"assert failed: gltf")}function TS(i,t){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const e=t.baseUri||t.uri;if(!e)throw new Error("'baseUri' must be provided to resolve relative url ".concat(i));return e.substr(0,e.lastIndexOf("/")+1)+i}function Pz(i,t,e){const r=i.bufferViews[e];ba(r);const s=r.buffer,n=t[s];ba(n);const c=(r.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,c,r.byteLength)}const zx=["SCALAR","VEC2","VEC3","VEC4"],Iz=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Lz=new Map(Iz),Mz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Bz={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Rz={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function PS(i){return zx[i-1]||zx[0]}function IS(i){const t=Lz.get(i.constructor);if(!t)throw new Error("Illegal typed array");return t}function uv(i,t){const e=Rz[i.componentType],r=Mz[i.type],s=Bz[i.componentType],n=i.count*r,c=i.count*r*s;return ba(c>=0&&c<=t.byteLength),{ArrayType:e,length:n,byteLength:c}}function LS(i){let{images:t,bufferViews:e}=i;t=t||[],e=e||[];const r=t.map(c=>c.bufferView);e=e.filter(c=>!r.includes(c));const s=e.reduce((c,l)=>c+l.byteLength,0),n=t.reduce((c,l)=>{const{width:f,height:y}=l.image;return c+f*y},0);return s+Math.ceil(4*n*1.33)}const kz={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Go{constructor(t){H(this,"gltf",void 0),H(this,"sourceBuffers",void 0),H(this,"byteLength",void 0),this.gltf=t||{json:{...kz},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(s=>s===t),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return r}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,r=this.gltf.buffers[e];ba(r);const s=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,{ArrayType:s,length:n}=uv(t,e),c=e.byteOffset+t.byteOffset;return new s(r,c,n)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(r,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}setObjectExtension(t,e,r){const s=t.extensions||{};s[e]=r}removeObjectExtension(t,e){const r=t.extensions||{},s=r[e];return delete r[e],s}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ba(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ba(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:r}=t;this.json.nodes=this.json.nodes||[];const s={mesh:e};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:r,material:s,mode:n=4}=t,c={primitives:[{attributes:this._addAttributes(e),mode:n}]};if(r){const l=this._addIndices(r);c.primitives[0].indices=l}return Number.isFinite(s)&&(c.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const r=E_(t),s=e||(r==null?void 0:r.mimeType),n={bufferView:this.addBufferView(t),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(n),this.json.images.length-1}addBufferView(t){const e=t.byteLength;ba(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=vf(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:PS(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(t);let s={min:e.min,max:e.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(t,e.size));const n={size:e.size,componentType:IS(t),count:Math.round(t.length/e.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(n,e))}addTexture(t){const{imageIndex:e}=t,r={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const r=this.byteLength,s=new ArrayBuffer(r),n=new Uint8Array(s);let c=0;for(const l of this.sourceBuffers||[])c=iI(l,n,c);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=s,this.sourceBuffers=[s]}_removeStringFromArray(t,e){let r=!0;for(;r;){const s=t.indexOf(e);s>-1?t.splice(s,1):r=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const r in t){const s=t[r],n=this._getGltfAttributeName(r),c=this.addBinaryBuffer(s.value,s);e[n]=c}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];const s=t.subarray(0,e);for(const n of s)r.min.push(n),r.max.push(n);for(let n=e;n<t.length;n+=e)for(let c=0;c<e;c++)r.min[0+c]=Math.min(r.min[0+c],t[n+c]),r.max[0+c]=Math.max(r.max[0+c],t[n+c]);return r}}const Oz="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Fz="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Nz=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Dz=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),zz={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Uz={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function jz(i,t,e,r,s){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const c=await Gz();Hz(c,c.exports[Uz[s]],i,t,e,r,c.exports[zz[n||"NONE"]])}let xy;async function Gz(){return xy||(xy=Vz()),xy}async function Vz(){let i=Oz;WebAssembly.validate(Nz)&&(i=Fz,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(qz(i),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function qz(i){const t=new Uint8Array(i.length);for(let r=0;r<i.length;++r){const s=i.charCodeAt(r);t[r]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let e=0;for(let r=0;r<i.length;++r)t[e++]=t[r]<60?Dz[t[r]]:(t[r]-60)*64+t[++r];return t.buffer.slice(0,e)}function Hz(i,t,e,r,s,n,c){const l=i.exports.sbrk,f=r+3&-4,y=l(f*s),A=l(n.length),T=new Uint8Array(i.exports.memory.buffer);T.set(n,A);const P=t(y,r,s,A,n.length);if(P===0&&c&&c(y,f,s),e.set(T.subarray(y,y+r*s)),l(y-l(0)),P!==0)throw new Error("Malformed buffer data: ".concat(P))}const dv="EXT_meshopt_compression",Wz=dv;async function Jz(i,t){var e;const r=new Go(i);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes))return;const s=[];for(const n of i.json.bufferViews||[])s.push(Xz(r,n));await Promise.all(s),r.removeExtension(dv)}async function Xz(i,t){const e=i.getObjectExtension(t,dv);if(e){const{byteOffset:r=0,byteLength:s=0,byteStride:n,count:c,mode:l,filter:f="NONE",buffer:y}=e,A=i.gltf.buffers[y],T=new Uint8Array(A.arrayBuffer,A.byteOffset+r,s),P=new Uint8Array(i.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await jz(P,c,n,T,l,f),P}return null}const Zz=Object.freeze(Object.defineProperty({__proto__:null,decode:Jz,name:Wz},Symbol.toStringTag,{value:"Module"})),_d="EXT_texture_webp",$z=_d;function Yz(i,t){const e=new Go(i);if(!t4("image/webp")){if(e.getRequiredExtensions().includes(_d))throw new Error("gltf: Required extension ".concat(_d," not supported by browser"));return}const{json:r}=e;for(const s of r.textures||[]){const n=e.getObjectExtension(s,_d);n&&(s.source=n.source),e.removeObjectExtension(s,_d)}e.removeExtension(_d)}const Kz=Object.freeze(Object.defineProperty({__proto__:null,name:$z,preprocess:Yz},Symbol.toStringTag,{value:"Module"})),$g="KHR_texture_basisu",Qz=$g;function t7(i,t){const e=new Go(i),{json:r}=e;for(const s of r.textures||[]){const n=e.getObjectExtension(s,$g);n&&(s.source=n.source),e.removeObjectExtension(s,$g)}e.removeExtension($g)}const e7=Object.freeze(Object.defineProperty({__proto__:null,name:Qz,preprocess:t7},Symbol.toStringTag,{value:"Module"})),i7="3.4.15",r7={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},s7={name:"Draco",id:qc?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:i7,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:r7};function n7(i,t,e){const r=MS(t.metadata),s=[],n=o7(t.attributes);for(const c in i){const l=i[c],f=Ux(c,l,n[c]);s.push(f)}if(e){const c=Ux("indices",e);s.push(c)}return new Sd(s,r)}function o7(i){const t={};for(const e in i){const r=i[e];t[r.name||"undefined"]=r}return t}function Ux(i,t,e){const r=e?MS(e.metadata):void 0;return GD(i,t,r)}function MS(i){const t=new Map;for(const e in i)t.set("".concat(e,".string"),JSON.stringify(i[e]));return t}const jx={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},a7={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},l7=4;class c7{constructor(t){H(this,"draco",void 0),H(this,"decoder",void 0),H(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const s=this.decoder.GetEncodedGeometryType(r),n=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(s){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,n);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,n);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!n.ptr){const T="DRACO decompression failed: ".concat(c.error_msg());throw new Error(T)}const l=this._getDracoLoaderData(n,s,e),f=this._getMeshData(n,l,e),y=yS(f.attributes),A=n7(f.attributes,l,f.indices);return{loader:"draco",loaderData:l,header:{vertexCount:n.num_points(),boundingBox:y},...f,schema:A}}finally{this.draco.destroy(r),n&&this.draco.destroy(n)}}_getDracoLoaderData(t,e,r){const s=this._getTopLevelMetadata(t),n=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:s,attributes:n}}_getDracoAttributes(t,e){const r={};for(let s=0;s<t.num_attributes();s++){const n=this.decoder.GetAttribute(t,s),c=this._getAttributeMetadata(t,s);r[n.unique_id()]={unique_id:n.unique_id(),attribute_type:n.attribute_type(),data_type:n.data_type(),num_components:n.num_components(),byte_offset:n.byte_offset(),byte_stride:n.byte_stride(),normalized:n.normalized(),attribute_index:s,metadata:c};const l=this._getQuantizationTransform(n,e);l&&(r[n.unique_id()].quantization_transform=l);const f=this._getOctahedronTransform(n,e);f&&(r[n.unique_id()].octahedron_transform=f)}return r}_getMeshData(t,e,r){const s=this._getMeshAttributes(e,t,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(t,e,r){const s={};for(const n of Object.values(t.attributes)){const c=this._deduceAttributeName(n,r);n.name=c;const{value:l,size:f}=this._getAttributeValues(e,n);s[c]={value:l,size:f,byteOffset:n.byte_offset,byteStride:n.byte_stride,normalized:n.normalized}}return s}_getTriangleListIndices(t){const e=t.num_faces()*3,r=e*l7,s=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,s),new Uint32Array(this.draco.HEAPF32.buffer,s,e).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),d7(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const r=a7[e.data_type],s=e.num_components,n=t.num_points()*s,c=n*r.BYTES_PER_ELEMENT,l=h7(this.draco,r);let f;const y=this.draco._malloc(c);try{const A=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,A,l,c,y),f=new r(this.draco.HEAPF32.buffer,y,n).slice()}finally{this.draco._free(y)}return{value:f,size:s}}_deduceAttributeName(t,e){const r=t.unique_id;for(const[c,l]of Object.entries(e.extraAttributes||{}))if(l===r)return c;const s=t.attribute_type;for(const c in jx)if(this.draco[c]===s)return jx[c];const n=e.attributeNameEntry||"name";return t.metadata[n]?t.metadata[n].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},r=this.metadataQuerier.NumEntries(t);for(let s=0;s<r;s++){const n=this.metadataQuerier.GetEntryName(t,s);e[n]=this._getDracoMetadataField(t,n)}return e}_getDracoMetadataField(t,e){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);const s=u7(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:r=[]}=t,s=[...e,...r];for(const n of s)this.decoder.SkipAttributeTransform(this.draco[n])}_getQuantizationTransform(t,e){const{quantizedAttributes:r=[]}=e,s=t.attribute_type();if(r.map(n=>this.decoder[n]).includes(s)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(t))return{quantization_bits:n.quantization_bits(),range:n.range(),min_values:new Float32Array([1,2,3]).map(c=>n.min_value(c))}}finally{this.draco.destroy(n)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:r=[]}=e,s=t.attribute_type();if(r.map(n=>this.decoder[n]).includes(s)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(t))return{quantization_bits:n.quantization_bits()}}finally{this.draco.destroy(n)}}return null}}function h7(i,t){switch(t){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function u7(i){const t=i.size(),e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=i.GetValue(r);return e}function d7(i){const t=i.size(),e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=i.GetValue(r);return e}const p7="1.5.5",pv="https://www.gstatic.com/draco/versioned/decoders/".concat(p7),f7="".concat(pv,"/draco_decoder.js"),g7="".concat(pv,"/draco_wasm_wrapper.js"),m7="".concat(pv,"/draco_decoder.wasm");let kp;async function y7(i){const t=i.modules||{};return t.draco3d?kp=kp||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):kp=kp||_7(i),await kp}async function _7(i){let t,e;switch(i.draco&&i.draco.decoderType){case"js":t=await Pu(f7,"draco",i);break;case"wasm":default:[t,e]=await Promise.all([await Pu(g7,"draco",i),await Pu(m7,"draco",i)])}return t=t||globalThis.DracoDecoderModule,await v7(t,e)}function v7(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i({...e,onModuleLoaded:s=>r({draco:s})})})}const BS={...s7,parse:b7};async function b7(i,t){const{draco:e}=await y7(t),r=new c7(e);try{return r.parseSync(i,t==null?void 0:t.draco)}finally{r.destroy()}}function w7(i){const t={};for(const e in i){const r=i[e];if(e!=="indices"){const s=RS(r);t[e]=s}}return t}function RS(i){const{buffer:t,size:e,count:r}=x7(i);return{value:t,size:e,byteOffset:0,count:r,type:PS(e),componentType:IS(t)}}function x7(i){let t=i,e=1,r=0;return i&&i.value&&(t=i.value,e=i.size||1),t&&(ArrayBuffer.isView(t)||(t=A7(t,Float32Array)),r=t.length/e),{buffer:t,size:e,count:r}}function A7(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i?Array.isArray(i)?new t(i):e&&!(i instanceof t)?new t(i):i:null}const Ou="KHR_draco_mesh_compression",S7=Ou;function E7(i,t,e){const r=new Go(i);for(const s of kS(r))r.getObjectExtension(s,Ou)}async function C7(i,t,e){var r;if(!(t!=null&&(r=t.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const s=new Go(i),n=[];for(const c of kS(s))s.getObjectExtension(c,Ou)&&n.push(P7(s,c,t,e));await Promise.all(n),s.removeExtension(Ou)}function T7(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new Go(i);for(const r of e.json.meshes||[])I7(r,t),e.addRequiredExtension(Ou)}async function P7(i,t,e,r){const s=i.getObjectExtension(t,Ou);if(!s)return;const n=i.getTypedArrayForBufferView(s.bufferView),c=y_(n.buffer,n.byteOffset),{parse:l}=r,f={...e};delete f["3d-tiles"];const y=await l(c,BS,f,r),A=w7(y.attributes);for(const[T,P]of Object.entries(A))if(T in t.attributes){const L=t.attributes[T],D=i.getAccessor(L);D!=null&&D.min&&D!==null&&D!==void 0&&D.max&&(P.min=D.min,P.max=D.max)}t.attributes=A,y.indices&&(t.indices=RS(y.indices)),L7(t)}function I7(i,t){var e;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const c=s.DracoWriter.encodeSync({attributes:i}),l=n==null||(e=n.parseSync)===null||e===void 0?void 0:e.call(n,{attributes:i}),f=s._addFauxAttributes(l.attributes),y=s.addBufferView(c);return{primitives:[{attributes:f,mode:r,extensions:{[Ou]:{bufferView:y,attributes:f}}}]}}function L7(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*kS(i){for(const t of i.json.meshes||[])for(const e of t.primitives)yield e}const M7=Object.freeze(Object.defineProperty({__proto__:null,decode:C7,encode:T7,name:S7,preprocess:E7},Symbol.toStringTag,{value:"Module"})),B7={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},R7={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},fv="KHR_texture_transform",k7=fv,Mg=new te,O7=new Is,F7=new Is;async function N7(i,t){if(!new Go(i).getExtension(fv))return;const e=i.json.materials||[];for(let r=0;r<e.length;r++)D7(r,i)}function D7(i,t){var e,r,s;const n=[],c=(e=t.json.materials)===null||e===void 0?void 0:e[i],l=c==null||(r=c.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;l&&Op(t,i,l,n);const f=c==null?void 0:c.emissiveTexture;f&&Op(t,i,f,n);const y=c==null?void 0:c.normalTexture;y&&Op(t,i,y,n);const A=c==null?void 0:c.occlusionTexture;A&&Op(t,i,A,n);const T=c==null||(s=c.pbrMetallicRoughness)===null||s===void 0?void 0:s.metallicRoughnessTexture;T&&Op(t,i,T,n)}function Op(i,t,e,r){const s=z7(e,r);if(!s)return;const n=i.json.meshes||[];for(const c of n)for(const l of c.primitives){const f=l.material;Number.isFinite(f)&&t===f&&U7(i,l,s)}}function z7(i,t){var e;const r=(e=i.extensions)===null||e===void 0?void 0:e[fv],{texCoord:s=0}=i,{texCoord:n=s}=r;if(t.findIndex(c=>{let[l,f]=c;return l===s&&f===n})===-1){const c=V7(r);return s!==n&&(i.texCoord=n),t.push([s,n]),{originalTexCoord:s,texCoord:n,matrix:c}}return null}function U7(i,t,e){const{originalTexCoord:r,texCoord:s,matrix:n}=e,c=t.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(c)){var l;const y=(l=i.json.accessors)===null||l===void 0?void 0:l[c];if(y&&y.bufferView){var f;const A=(f=i.json.bufferViews)===null||f===void 0?void 0:f[y.bufferView];if(A){const{arrayBuffer:T,byteOffset:P}=i.buffers[A.buffer],L=(P||0)+(y.byteOffset||0)+(A.byteOffset||0),{ArrayType:D,length:j}=uv(y,A),X=R7[y.componentType],Z=B7[y.type],$=A.byteStride||X*Z,ht=new Float32Array(j);for(let _t=0;_t<y.count;_t++){const Mt=new D(T,L+_t*$,2);Mg.set(Mt[0],Mt[1],1),Mg.transformByMatrix3(n),ht.set([Mg[0],Mg[1]],_t*Z)}r===s?j7(y,A,i.buffers,ht):G7(s,y,t,i,ht)}}}}function j7(i,t,e,r){i.componentType=5126,e.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=r.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function G7(i,t,e,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const n=r.json.bufferViews;if(!n)return;n.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:(n==null?void 0:n.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(i)]=c.length-1)}function V7(i){const{offset:t=[0,0],rotation:e=0,scale:r=[1,1]}=i,s=new Is().set(1,0,0,0,1,0,t[0],t[1],1),n=O7.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),c=F7.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(n).multiplyRight(c)}const q7=Object.freeze(Object.defineProperty({__proto__:null,decode:N7,name:k7},Symbol.toStringTag,{value:"Module"})),Eu="KHR_lights_punctual",H7=Eu;async function W7(i){const t=new Go(i),{json:e}=t,r=t.getExtension(Eu);r&&(t.json.lights=r.lights,t.removeExtension(Eu));for(const s of e.nodes||[]){const n=t.getObjectExtension(s,Eu);n&&(s.light=n.light),t.removeObjectExtension(s,Eu)}}async function J7(i){const t=new Go(i),{json:e}=t;if(e.lights){const r=t.addExtension(Eu);ba(!r.lights),r.lights=e.lights,delete e.lights}if(t.json.lights){for(const r of t.json.lights){const s=r.node;t.addObjectExtension(s,Eu,r)}delete t.json.lights}}const X7=Object.freeze(Object.defineProperty({__proto__:null,decode:W7,encode:J7,name:H7},Symbol.toStringTag,{value:"Module"})),df="KHR_materials_unlit",Z7=df;async function $7(i){const t=new Go(i),{json:e}=t;for(const r of e.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,df);t.removeExtension(df)}function Y7(i){const t=new Go(i),{json:e}=t;if(t.materials)for(const r of e.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,df,{}),t.addExtension(df))}const K7=Object.freeze(Object.defineProperty({__proto__:null,decode:$7,encode:Y7,name:Z7},Symbol.toStringTag,{value:"Module"})),Hp="KHR_techniques_webgl",Q7=Hp;async function t9(i){const t=new Go(i),{json:e}=t,r=t.getExtension(Hp);if(r){const s=i9(r,t);for(const n of e.materials||[]){const c=t.getObjectExtension(n,Hp);c&&(n.technique=Object.assign({},c,s[c.technique]),n.technique.values=r9(n.technique,t)),t.removeObjectExtension(n,Hp)}t.removeExtension(Hp)}}async function e9(i,t){}function i9(i,t){const{programs:e=[],shaders:r=[],techniques:s=[]}=i,n=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=n.decode(t.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),s.forEach(c=>{c.program=e[c.program]}),s}function r9(i,t){const e=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(r=>{i.uniforms[r].value&&!(r in e)&&(e[r]=i.uniforms[r].value)}),Object.keys(e).forEach(r=>{typeof e[r]=="object"&&e[r].index!==void 0&&(e[r].texture=t.getTexture(e[r].index))}),e}const s9=Object.freeze(Object.defineProperty({__proto__:null,decode:t9,encode:e9,name:Q7},Symbol.toStringTag,{value:"Module"})),OS="EXT_feature_metadata",n9=OS;async function o9(i){const t=new Go(i);a9(t)}function a9(i){var t;const e=i.getExtension(OS),r=e==null||(t=e.schema)===null||t===void 0?void 0:t.classes,s=e==null?void 0:e.featureTables;if(e!=null&&e.featureTextures&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&s)for(const n in r){const c=r[n],l=h9(s,n);l&&l9(i,l,c)}}function l9(i,t,e){for(const s in e.properties){var r;const n=e.properties[s],c=t==null||(r=t.properties)===null||r===void 0?void 0:r[s],l=t.count;if(c){const f=c9(i,n,l,c);c.data=f}}}function c9(i,t,e,r){const s=r.bufferView;let n=i.getTypedArrayForBufferView(s);switch(t.type){case"STRING":{const c=r.stringOffsetBufferView,l=i.getTypedArrayForBufferView(c);n=u9(n,l,e);break}}return n}function h9(i,t){for(const e in i){const r=i[e];if(r.class===t)return r}return null}function u9(i,t,e){const r=[],s=new TextDecoder("utf8");let n=0;const c=4;for(let l=0;l<e;l++){const f=t[(l+1)*c]-t[l*c],y=i.subarray(n,f+n),A=s.decode(y);r.push(A),n+=f}return r}const d9=Object.freeze(Object.defineProperty({__proto__:null,decode:o9,name:n9},Symbol.toStringTag,{value:"Module"})),FS=[Zz,Kz,e7,M7,X7,K7,s9,q7,d9];function p9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=FS.filter(n=>NS(n.name,t));for(const n of r){var s;(s=n.preprocess)===null||s===void 0||s.call(n,i,t,e)}}async function f9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=FS.filter(n=>NS(n.name,t));for(const n of r){var s;await((s=n.decode)===null||s===void 0?void 0:s.call(n,i,t,e))}}function NS(i,t){var e;const r=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(i in r&&!r[i])}const Ay="KHR_binary_glTF";function g9(i){const t=new Go(i),{json:e}=t;for(const r of e.images||[]){const s=t.getObjectExtension(r,Ay);s&&Object.assign(r,s),t.removeObjectExtension(r,Ay)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(Ay)}const Gx={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},m9={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class y9{constructor(){H(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),H(this,"json",void 0)}normalize(t,e){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),g9(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in Gx)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const r=t[e];if(!(!r||Array.isArray(r))){t[e]=[];for(const s in r){const n=r[s];n.id=n.id||s;const c=t[e].length;t[e].push(n),this.idToIndexMap[e][s]=c}}}_convertObjectIdsToArrayIndices(t){for(const e in Gx)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:r,indices:s,material:n}=e;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");s&&(e.indices=this._convertIdToIndex(s,"accessor")),n&&(e.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const r of t[e])for(const s in r){const n=r[s],c=this._convertIdToIndex(n,s);r[s]=c}}_convertIdToIndex(t,e){const r=m9[e];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][t];if(!Number.isFinite(s))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return s}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const n of t.materials){var e,r,s;n.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const c=((e=n.values)===null||e===void 0?void 0:e.tex)||((r=n.values)===null||r===void 0?void 0:r.texture2d_0)||((s=n.values)===null||s===void 0?void 0:s.diffuseTex),l=t.textures.findIndex(f=>f.id===c);l!==-1&&(n.pbrMetallicRoughness.baseColorTexture={index:l})}}}function _9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new y9().normalize(i,t)}const v9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},b9={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},qa={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},w9={magFilter:qa.TEXTURE_MAG_FILTER,minFilter:qa.TEXTURE_MIN_FILTER,wrapS:qa.TEXTURE_WRAP_S,wrapT:qa.TEXTURE_WRAP_T},x9={[qa.TEXTURE_MAG_FILTER]:qa.LINEAR,[qa.TEXTURE_MIN_FILTER]:qa.NEAREST_MIPMAP_LINEAR,[qa.TEXTURE_WRAP_S]:qa.REPEAT,[qa.TEXTURE_WRAP_T]:qa.REPEAT};function A9(i){return b9[i]}function S9(i){return v9[i]}class E9{constructor(){H(this,"baseUri",""),H(this,"json",{}),H(this,"buffers",[]),H(this,"images",[])}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:s=[],images:n=[],baseUri:c=""}=t;return ba(r),this.baseUri=c,this.json=r,this.buffers=s,this.images=n,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((e,r)=>this._resolveBufferView(e,r))),t.images&&(t.images=t.images.map((e,r)=>this._resolveImage(e,r))),t.samplers&&(t.samplers=t.samplers.map((e,r)=>this._resolveSampler(e,r))),t.textures&&(t.textures=t.textures.map((e,r)=>this._resolveTexture(e,r))),t.accessors&&(t.accessors=t.accessors.map((e,r)=>this._resolveAccessor(e,r))),t.materials&&(t.materials=t.materials.map((e,r)=>this._resolveMaterial(e,r))),t.meshes&&(t.meshes=t.meshes.map((e,r)=>this._resolveMesh(e,r))),t.nodes&&(t.nodes=t.nodes.map((e,r)=>this._resolveNode(e,r))),t.skins&&(t.skins=t.skins.map((e,r)=>this._resolveSkin(e,r))),t.scenes&&(t.scenes=t.scenes.map((e,r)=>this._resolveScene(e,r))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];return r||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),r}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(r=>this.getNode(r)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(r=>this.getNode(r))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((r,s)=>{const n=this.getMesh(s);return r.id=n.id,r.primitives=r.primitives.concat(n.primitives),r},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(r=>{r={...r};const s=r.attributes;r.attributes={};for(const n in s)r.attributes[n]=this.getAccessor(s[n]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const r=t.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){if(t.id=t.id||"accessor-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=A9(t.componentType),t.components=S9(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const r=t.bufferView.buffer,{ArrayType:s,byteLength:n}=uv(t,t.bufferView),c=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+r.byteOffset;let l=r.arrayBuffer.slice(c,c+n);t.bufferView.byteStride&&(l=this._getValueFromInterleavedBuffer(r,c,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new s(l)}return t}_getValueFromInterleavedBuffer(t,e,r,s,n){const c=new Uint8Array(n*s);for(let l=0;l<n;l++){const f=e+l*r;c.set(new Uint8Array(t.arrayBuffer.slice(f,f+s)),l*s)}return c.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):x9,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const r in t){const s=this._enumSamplerParameter(r);s!==void 0&&(t.parameters[s]=t[r])}return t}_enumSamplerParameter(t){return w9[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const r=this.images[e];return r&&(t.image=r),t}_resolveBufferView(t,e){const r=t.buffer,s={id:"bufferView-".concat(e),...t,buffer:this.buffers[r]},n=this.buffers[r].arrayBuffer;let c=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(c+=t.byteOffset),s.data=new Uint8Array(n,c,t.byteLength),s}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}function C9(i,t){return new E9().postProcess(i,t)}const Vx=1735152710,gv=12,Em=8,T9=1313821514,P9=5130562,I9=0,L9=1,M9=0,Hd=!0;function B9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(i.getUint8(t+0))).concat(String.fromCharCode(i.getUint8(t+1))).concat(String.fromCharCode(i.getUint8(t+2))).concat(String.fromCharCode(i.getUint8(t+3)))}function R9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(i),{magic:s=Vx}=e,n=r.getUint32(t,!1);return n===s||n===Vx}function k9(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(t),s=B9(r,e+0),n=r.getUint32(e+4,Hd),c=r.getUint32(e+8,Hd);switch(Object.assign(i,{header:{byteOffset:e,byteLength:c,hasBinChunk:!1},type:s,version:n,json:{},binChunks:[]}),e+=gv,i.version){case 1:return O9(i,r,e);case 2:return F9(i,r,e,{});default:throw new Error("Invalid GLB version ".concat(i.version,". Only supports v1 and v2."))}}function O9(i,t,e){Kr(i.header.byteLength>gv+Em);const r=t.getUint32(e+0,Hd),s=t.getUint32(e+4,Hd);return e+=Em,Kr(s===M9),O1(i,t,e,r),e+=r,e+=F1(i,t,e,i.header.byteLength),e}function F9(i,t,e,r){return Kr(i.header.byteLength>gv+Em),N9(i,t,e,r),e+i.header.byteLength}function N9(i,t,e,r){for(;e+8<=i.header.byteLength;){const s=t.getUint32(e+0,Hd),n=t.getUint32(e+4,Hd);switch(e+=Em,n){case T9:O1(i,t,e,s);break;case P9:F1(i,t,e,s);break;case I9:r.strict||O1(i,t,e,s);break;case L9:r.strict||F1(i,t,e,s);break}e+=vf(s,4)}return e}function O1(i,t,e,r){const s=new Uint8Array(t.buffer,e,r),n=new TextDecoder("utf8").decode(s);return i.json=JSON.parse(n),vf(r,4)}function F1(i,t,e,r){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:e,byteLength:r,arrayBuffer:t.buffer}),vf(r,4)}async function D9(i,t){var e,r,s,n;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;z9(i,t,c,l),_9(i,{normalize:l==null||(e=l.gltf)===null||e===void 0?void 0:e.normalize}),p9(i,l,f);const y=[];if(l!=null&&(r=l.gltf)!==null&&r!==void 0&&r.loadBuffers&&i.json.buffers&&await U9(i,l,f),l!=null&&(s=l.gltf)!==null&&s!==void 0&&s.loadImages){const T=j9(i,l,f);y.push(T)}const A=f9(i,l,f);return y.push(A),await Promise.all(y),l!=null&&(n=l.gltf)!==null&&n!==void 0&&n.postProcess?C9(i,l):i}function z9(i,t,e,r){if(r.uri&&(i.baseUri=r.uri),t instanceof ArrayBuffer&&!R9(t,e,r)&&(t=new TextDecoder().decode(t)),typeof t=="string")i.json=QP(t);else if(t instanceof ArrayBuffer){const c={};e=k9(c,t,e,r.glb),ba(c.type==="glTF","Invalid GLB magic string ".concat(c.type)),i._glb=c,i.json=c.json}else ba(!1,"GLTF: must be ArrayBuffer or string");const s=i.json.buffers||[];if(i.buffers=new Array(s.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:c}=i._glb;i.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const n=i.json.images||[];i.images=new Array(n.length).fill({})}async function U9(i,t,e){const r=i.json.buffers||[];for(let c=0;c<r.length;++c){const l=r[c];if(l.uri){var s,n;const{fetch:f}=e;ba(f);const y=TS(l.uri,t),A=await(e==null||(s=e.fetch)===null||s===void 0?void 0:s.call(e,y)),T=await(A==null||(n=A.arrayBuffer)===null||n===void 0?void 0:n.call(A));i.buffers[c]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete l.uri}else i.buffers[c]===null&&(i.buffers[c]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function j9(i,t,e){const r=G9(i),s=i.json.images||[],n=[];for(const c of r)n.push(V9(i,s[c],c,t,e));return await Promise.all(n)}function G9(i){const t=new Set,e=i.json.textures||[];for(const r of e)r.source!==void 0&&t.add(r.source);return Array.from(t).sort()}async function V9(i,t,e,r,s){const{fetch:n,parse:c}=s;let l;if(t.uri&&!t.hasOwnProperty("bufferView")){const y=TS(t.uri,r);l=await(await n(y)).arrayBuffer(),t.bufferView={data:l}}if(Number.isFinite(t.bufferView)){const y=Pz(i.json,i.buffers,t.bufferView);l=y_(y.buffer,y.byteOffset,y.byteLength)}ba(l,"glTF image has no data");let f=await c(l,[zA,Tz],{mimeType:t.mimeType,basis:r.basis||{format:CS()}},s);f&&f[0]&&(f={compressed:!0,mipmaps:!1,width:f[0].width,height:f[0].height,data:f[0]}),i.images=i.images||[],i.images[e]=f}const pf={name:"glTF",id:"gltf",module:"gltf",version:hz,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:q9,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function q9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...pf.options,...t},t.gltf={...pf.options.gltf,...t.gltf};const{byteOffset:r=0}=t;return await D9({},i,r,t,e)}async function H9(i){const t=[];return i.scenes.forEach(e=>{e.traverse(r=>{Object.values(r.model.getUniforms()).forEach(s=>{s.loaded===!1&&t.push(s)})})}),await W9(()=>t.some(e=>!e.loaded))}async function W9(i){for(;i();)await new Promise(t=>requestAnimationFrame(t))}const J9=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,X9=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,DS=[255,255,255,255],Z9={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:DS},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[pf]};class mv extends Yd{constructor(){super(...arguments),H(this,"state",void 0)}getShaders(){const t=[Y_,K_];return this.props._lighting==="pbr"&&t.push(q_),super.getShaders({vs:J9,fs:X9,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:DS,transition:!0},instanceModelMatrix:gS})}updateState(t){super.updateState(t);const{props:e,oldProps:r}=t;e.scenegraph!==r.scenegraph?this._updateScenegraph():e._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let r=null;if(t.scenegraph instanceof Ld)r={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const l=t.scenegraph,f=cz(e,l,this._getModelOptions());r={gltf:l,...f},H9(f).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(fr.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=t.scenegraph);const s={layer:this,gl:e},n=t.getScene(r,s),c=t.getAnimator(r,s);n instanceof Ld?(this._deleteScenegraph(),this._applyAllAttributes(n),this._applyAnimationsProp(n,c,t._animations),this.setState({scenegraph:n,animator:c})):n!==null&&fr.warn("invalid scenegraph:",n)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(r=>{this._setModelAttributes(r.model,e)})}}_applyAnimationsProp(t,e,r){if(!t||!e||!r)return;const s=e.getAnimations();Object.keys(r).sort().forEach(n=>{const c=r[n];if(n==="*")s.forEach(l=>{Object.assign(l,c)});else if(Number.isFinite(Number(n))){const l=Number(n);l>=0&&l<s.length?Object.assign(s[l],c):fr.warn("animation ".concat(n," not found"))()}else{const l=s.find(f=>{let{name:y}=f;return y===n});l?Object.assign(l,c):fr.warn("animation ".concat(n," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof Ld&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!Ki(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw(t){let{moduleParameters:e=null,parameters:r={},context:s}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(s.timeline.getTime()),this.setNeedsRedraw());const{viewport:n}=this.context,{sizeScale:c,sizeMinPixels:l,sizeMaxPixels:f,opacity:y,coordinateSystem:A}=this.props,T=this.getNumInstances();this.state.scenegraph.traverse((P,L)=>{let{worldMatrix:D}=L;P.model.setInstanceCount(T),P.updateModuleSettings(e),P.draw({parameters:r,uniforms:{sizeScale:c,opacity:y,sizeMinPixels:l,sizeMaxPixels:f,composeModelMatrix:mS(n,A),sceneModelMatrix:D,u_Camera:P.model.getUniforms().project_uCameraPosition}})})}}H(mv,"defaultProps",Z9);H(mv,"layerName","ScenegraphLayer");const $9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Y9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function K9(i){i.COLOR_0||i.colors||(i.colors={constant:!0,value:new Float32Array([1,1,1])})}const Q9={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class yv extends hv{getShaders(){const t=super.getShaders();return t.modules.push(q_),{...t,vs:$9,fs:Y9}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:r}=t;e.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!e}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:r}=this.props,s=this.parseMaterial(r,t);this.setState({materialParser:s});const n=this.getShaders();return K9(t.attributes),new Gd(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...n.defines,...s==null?void 0:s.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:s==null?void 0:s.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:r}=this.props,s=this.parseMaterial(t,r);this.setState({materialParser:s}),e.setUniforms(s.uniforms)}}parseMaterial(t,e){var r;const s=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new AS(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:s,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,r=new Uint8ClampedArray(e.length*t.size),s=[];for(let n=0;n<e.length;n++)this.encodePickingColor(e[n],s),r[n*3]=s[0],r[n*3+1]=s[1],r[n*3+2]=s[2];t.value=r}finalizeState(t){var e;super.finalizeState(t),(e=this.state.materialParser)===null||e===void 0||e.delete(),this.setState({materialParser:null})}}H(yv,"layerName","MeshLayer");H(yv,"defaultProps",Q9);const tU=6378137,eU=6378137,iU=6356752314245179e-9;function zm(i){return i}new te;function rU(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:zm;return"longitude"in i?(t[0]=e(i.longitude),t[1]=e(i.latitude),t[2]=i.height):"x"in i?(t[0]=e(i.x),t[1]=e(i.y),t[2]=i.z):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function sU(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return rU(i,t,Ys._cartographicRadians?zm:tR)}function nU(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:zm;return"longitude"in t?(t.longitude=e(i[0]),t.latitude=e(i[1]),t.height=i[2]):"x"in t?(t.x=e(i[0]),t.y=e(i[1]),t.z=i[2]):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function oU(i,t){return nU(i,t,Ys._cartographicRadians?zm:eR)}const dd=new te,aU=new te,lU=new te;function cU(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:r,oneOverRadiiSquared:s,centerToleranceSquared:n}=t;dd.from(i);const c=dd.x,l=dd.y,f=dd.z,y=r.x,A=r.y,T=r.z,P=c*c*y*y,L=l*l*A*A,D=f*f*T*T,j=P+L+D,X=Math.sqrt(1/j);if(!Number.isFinite(X))return;const Z=aU;if(Z.copy(i).scale(X),j<n)return Z.to(e);const $=s.x,ht=s.y,_t=s.z,Mt=lU;Mt.set(Z.x*$*2,Z.y*ht*2,Z.z*_t*2);let Nt=(1-X)*dd.len()/(.5*Mt.len()),Rt=0,xt,qt,zt,ct;do{Nt-=Rt,xt=1/(1+Nt*$),qt=1/(1+Nt*ht),zt=1/(1+Nt*_t);const pt=xt*xt,Bt=qt*qt,bt=zt*zt,ne=pt*xt,oe=Bt*qt,le=bt*zt;ct=P*pt+L*Bt+D*bt-1;const Qt=-2*(P*ne*$+L*oe*ht+D*le*_t);Rt=ct/Qt}while(Math.abs(ct)>cf.EPSILON12);return dd.scale([xt,qt,zt]).to(e)}const qx=1e-14,hU=new te,Hx={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Sy={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Fp={east:new te,north:new te,up:new te,west:new te,south:new te,down:new te},uU=new te,dU=new te,pU=new te;function Wx(i,t,e,r,s,n){const c=Hx[t]&&Hx[t][e];_l(c&&(!r||r===c));let l,f,y;const A=hU.copy(s);if(xl(A.x,0,qx)&&xl(A.y,0,qx)){const T=Math.sign(A.z);l=uU.fromArray(Sy[t]),t!=="east"&&t!=="west"&&l.scale(T),f=dU.fromArray(Sy[e]),e!=="east"&&e!=="west"&&f.scale(T),y=pU.fromArray(Sy[r]),r!=="east"&&r!=="west"&&y.scale(T)}else{const{up:T,east:P,north:L}=Fp;P.set(-A.y,A.x,0).normalize(),i.geodeticSurfaceNormal(A,T),L.copy(T).cross(P);const{down:D,west:j,south:X}=Fp;D.copy(T).scale(-1),j.copy(P).scale(-1),X.copy(L).scale(-1),l=Fp[t],f=Fp[e],y=Fp[r]}return n[0]=l.x,n[1]=l.y,n[2]=l.z,n[3]=0,n[4]=f.x,n[5]=f.y,n[6]=f.z,n[7]=0,n[8]=y.x,n[9]=y.y,n[10]=y.z,n[11]=0,n[12]=A.x,n[13]=A.y,n[14]=A.z,n[15]=1,n}const Bg=new te,Jx=new te,fU=new te,dl=new te,gU=new te,Rg=new te;class gs{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;H(this,"radii",void 0),H(this,"radiiSquared",void 0),H(this,"radiiToTheFourth",void 0),H(this,"oneOverRadii",void 0),H(this,"oneOverRadiiSquared",void 0),H(this,"minimumRadius",void 0),H(this,"maximumRadius",void 0),H(this,"centerToleranceSquared",cf.EPSILON1),H(this,"squaredXOverSquaredZ",void 0),_l(t>=0),_l(e>=0),_l(r>=0),this.radii=new te(t,e,r),this.radiiSquared=new te(t*t,e*e,r*r),this.radiiToTheFourth=new te(t*t*t*t,e*e*e*e,r*r*r*r),this.oneOverRadii=new te(t===0?0:1/t,e===0?0:1/e,r===0?0:1/r),this.oneOverRadiiSquared=new te(t===0?0:1/(t*t),e===0?0:1/(e*e),r===0?0:1/(r*r)),this.minimumRadius=Math.min(t,e,r),this.maximumRadius=Math.max(t,e,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=Jx,s=fU,[,,n]=t;this.geodeticSurfaceNormalCartographic(t,r),s.copy(this.radiiSquared).scale(r);const c=Math.sqrt(r.dot(s));return s.scale(1/c),r.scale(n),s.add(r),s.to(e)}cartesianToCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Rg.from(t);const r=this.scaleToGeodeticSurface(Rg,dl);if(!r)return;const s=this.geodeticSurfaceNormal(r,Jx),n=gU;n.copy(Rg).subtract(r);const c=Math.atan2(s.y,s.x),l=Math.asin(s.z),f=Math.sign(z_(n,Rg))*w3(n);return oU([c,l,f],e)}eastNorthUpToFixedFrame(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new er;return Wx(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,r,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new er;return Wx(this,t,e,r,s,n)}geocentricSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Bg.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=sU(t),s=r[0],n=r[1],c=Math.cos(n);return Bg.set(c*Math.cos(s),c*Math.sin(s),Math.sin(n)).normalize(),Bg.to(e)}geodeticSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Bg.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return cU(t,this,e)}scaleToGeocentricSurface(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];dl.from(t);const r=dl.x,s=dl.y,n=dl.z,c=this.oneOverRadiiSquared,l=1/Math.sqrt(r*r*c.x+s*s*c.y+n*n*c.z);return dl.multiplyScalar(l).to(e)}transformPositionToScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return dl.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return dl.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];_l(xl(this.radii.x,this.radii.y,cf.EPSILON15)),_l(this.radii.z>0),dl.from(t);const s=dl.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-e))return dl.set(0,0,s).to(r)}}H(gs,"WGS84",new gs(tU,eU,iU));class mU{constructor(t,e,r){H(this,"item",void 0),H(this,"previous",void 0),H(this,"next",void 0),this.item=t,this.previous=e,this.next=r}}class yU{constructor(){H(this,"head",null),H(this,"tail",null),H(this,"_length",0)}get length(){return this._length}add(t){const e=new mU(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}}class _U{constructor(){H(this,"_list",void 0),H(this,"_sentinel",void 0),H(this,"_trimTiles",void 0),this._list=new yU,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,r){e._cacheNode||(e._cacheNode=this._list.add(e),r&&r(t,e))}unloadTile(t,e,r){const s=e._cacheNode;s&&(this._list.remove(s),e._cacheNode=null,r&&r(t,e))}unloadTiles(t,e){const r=this._trimTiles;this._trimTiles=!1;const s=this._list,n=t.maximumMemoryUsage*1024*1024,c=this._sentinel;let l=s.head;for(;l!==c&&(t.gpuMemoryUsageInBytes>n||r);){const f=l.item;l=l.next,this.unloadTile(t,f,e)}}trim(){this._trimTiles=!0}}function vU(i,t){Kr(i),Kr(t);const{rtcCenter:e,gltfUpAxis:r}=t,{computedTransform:s,boundingVolume:{center:n}}=i;let c=new er(s);switch(e&&c.translate(e),r){case"Z":break;case"Y":const A=new er().rotateX(Math.PI/2);c=c.multiplyRight(A);break;case"X":const T=new er().rotateY(-Math.PI/2);c=c.multiplyRight(T);break}t.isQuantized&&c.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const l=new te(n);t.cartesianModelMatrix=c,t.cartesianOrigin=l;const f=gs.WGS84.cartesianToCartographic(l,new te),y=gs.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=y.multiplyRight(c),t.cartographicOrigin=f,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const Xx=new te,Ey=new te,N1=new Wa([new yl,new yl,new yl,new yl,new yl,new yl]);function bU(i,t){const{cameraDirection:e,cameraUp:r,height:s}=i,{metersPerUnit:n}=i.distanceScales,c=Yg(i,i.center),l=gs.WGS84.eastNorthUpToFixedFrame(c),f=i.unprojectPosition(i.cameraPosition),y=gs.WGS84.cartographicToCartesian(f,new te),A=new te(l.transformAsVector(new te(e).scale(n))).normalize(),T=new te(l.transformAsVector(new te(r).scale(n))).normalize();xU(i);const P=i.constructor,{longitude:L,latitude:D,width:j,bearing:X,zoom:Z}=i,$=new P({longitude:L,latitude:D,height:s,width:j,bearing:X,zoom:Z,pitch:0});return{camera:{position:y,direction:A,up:T},viewport:i,topDownViewport:$,height:s,cullingVolume:N1,frameNumber:t,sseDenominator:1.15}}function wU(i,t,e){if(e===0||i.length<=e)return[i,[]];const r=[],{longitude:s,latitude:n}=t.viewport;for(const[y,A]of i.entries()){const[T,P]=A.header.mbs,L=Math.abs(s-T),D=Math.abs(n-P),j=Math.sqrt(D*D+L*L);r.push([y,j])}const c=r.sort((y,A)=>y[1]-A[1]),l=[];for(let y=0;y<e;y++)l.push(i[c[y][0]]);const f=[];for(let y=e;y<c.length;y++)f.push(i[c[y][0]]);return[l,f]}function xU(i){const t=i.getFrustumPlanes(),e=Zx(t.near,i.cameraPosition),r=Yg(i,e),s=Yg(i,i.cameraPosition,Ey);let n=0;N1.planes[n++].fromPointNormal(r,Xx.copy(r).subtract(s));for(const c in t){if(c==="near")continue;const l=t[c],f=Zx(l,e,Ey),y=Yg(i,f,Ey);N1.planes[n++].fromPointNormal(y,Xx.copy(r).subtract(y))}}function Zx(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new te;const r=i.normal.dot(t);return e.copy(i.normal).scale(i.distance-r).add(t),e}function Yg(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new te;const r=i.unprojectPosition(t);return gs.WGS84.cartographicToCartesian(r,e)}const AU=6378137,SU=6378137,D1=6356752314245179e-9,$x=new te;function EU(i,t){if(i instanceof Bf){const{halfAxes:e}=i,r=TU(e);return Math.log2(D1/(r+t[2]))}else if(i instanceof Mf){const{radius:e}=i;return Math.log2(D1/(e+t[2]))}else if(i.width&&i.height){const{width:e,height:r}=i,s=Math.log2(AU/e),n=Math.log2(SU/r);return(s+n)/2}return 1}function zS(i,t,e){const r=gs.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],new te),s=Math.sqrt(Math.pow(r[0]-e[0],2)+Math.pow(r[1]-e[1],2)+Math.pow(r[2]-e[2],2));return Math.log2(D1/(s+t[2]))}function CU(i,t,e){const[r,s,n,c]=i;return zS({xmin:r,xmax:n,ymin:s,ymax:c,zmin:0,zmax:0},t,e)}function TU(i){i.getColumn(0,$x);const t=i.getColumn(1),e=i.getColumn(2);return $x.add(t).add(e).len()}const ma={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Hc={ADD:1,REPLACE:2},Md={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Va={I3S:"I3S",TILES3D:"TILES3D"},Um={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},PU={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function US(i){return i!=null}const Zn=new te,Kg=new te,IU=new te,LU=new te;function Cy(i,t,e){if(Kr(i,"3D Tile: boundingVolume must be defined"),i.box)return BU(i.box,t,e);if(i.region){const[r,s,n,c,l,f]=i.region,y=gs.WGS84.cartographicToCartesian([jc(r),jc(c),l],IU),A=gs.WGS84.cartographicToCartesian([jc(n),jc(s),f],LU),T=new te().addVectors(y,A).multiplyScalar(.5),P=new te().subVectors(y,A).len()/2;return Yx([T[0],T[1],T[2],P],new er)}if(i.sphere)return Yx(i.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function MU(i,t){if(i.box)return RU(t);if(i.region){const[e,r,s,n,c,l]=i.region;return[[jc(e),jc(r),c],[jc(s),jc(n),l]]}if(i.sphere)return kU(t);throw new Error("Unkown boundingVolume type")}function BU(i,t,e){const r=new te(i[0],i[1],i[2]);t.transform(r,r);let s=[];if(i.length===10){const y=i.slice(3,6),A=new lf;A.fromArray(i,6);const T=new te([1,0,0]),P=new te([0,1,0]),L=new te([0,0,1]);T.transformByQuaternion(A),T.scale(y[0]),P.transformByQuaternion(A),P.scale(y[1]),L.transformByQuaternion(A),L.scale(y[2]),s=[...T.toArray(),...P.toArray(),...L.toArray()]}else s=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const n=t.transformAsVector(s.slice(0,3)),c=t.transformAsVector(s.slice(3,6)),l=t.transformAsVector(s.slice(6,9)),f=new Is([n[0],n[1],n[2],c[0],c[1],c[2],l[0],l[1],l[2]]);return US(e)?(e.center=r,e.halfAxes=f,e):new Bf(r,f)}function Yx(i,t,e){const r=new te(i[0],i[1],i[2]);t.transform(r,r);const s=t.getScale(Kg),n=Math.max(Math.max(s[0],s[1]),s[2]),c=i[3]*n;return US(e)?(e.center=r,e.radius=c,e):new Mf(r,c)}function RU(i){const t=jS(),{halfAxes:e}=i,r=new te(e.getColumn(0)),s=new te(e.getColumn(1)),n=new te(e.getColumn(2));for(let c=0;c<2;c++){for(let l=0;l<2;l++){for(let f=0;f<2;f++)Zn.copy(i.center),Zn.add(r),Zn.add(s),Zn.add(n),GS(t,Zn),n.negate();s.negate()}r.negate()}return t}function kU(i){const t=jS(),{center:e,radius:r}=i,s=gs.WGS84.scaleToGeodeticSurface(e,Zn);let n;s?n=gs.WGS84.geodeticSurfaceNormal(s):n=new te(0,0,1);let c=new te(n[2],-n[1],0);c.len()>0?c.normalize():c=new te(0,1,0);const l=c.clone().cross(n);for(const f of[c,l,n]){Kg.copy(f).scale(r);for(let y=0;y<2;y++)Zn.copy(e),Zn.add(Kg),GS(t,Zn),Kg.negate()}return t}function jS(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function GS(i,t){gs.WGS84.cartesianToCartographic(t,Zn),i[0][0]=Math.min(i[0][0],Zn[0]),i[0][1]=Math.min(i[0][1],Zn[1]),i[0][2]=Math.min(i[0][2],Zn[2]),i[1][0]=Math.max(i[1][0],Zn[0]),i[1][1]=Math.max(i[1][1],Zn[1]),i[1][2]=Math.max(i[1][2],Zn[2])}new te;new te;new er;new te;new te;new te;function OU(i,t){const e=i*t;return 1-Math.exp(-(e*e))}function FU(i,t){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const e=i.dynamicScreenSpaceErrorComputedDensity,r=i.dynamicScreenSpaceErrorFactor;return OU(t,e)*r}return 0}function NU(i,t,e){const r=i.tileset,s=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,n=e?s:i.lodMetricValue;if(n===0)return 0;const c=Math.max(i._distanceToCamera,1e-7),{height:l,sseDenominator:f}=t,{viewDistanceScale:y}=r.options;let A=n*l*(y||1)/(c*f);return A-=FU(r,c),A}const Ty=new te,Kx=new te,Oh=new te,Qx=new te,DU=new te,Py=new er,t5=new er;function zU(i,t){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const e=2*VS(i,t);return e<2?"OUT":!i.header.children||e<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function VS(i,t){const{topDownViewport:e}=t,r=i.header.mbs[1],s=i.header.mbs[0],n=i.header.mbs[2],c=i.header.mbs[3],l=[...i.boundingVolume.center],f=e.unprojectPosition(e.cameraPosition);gs.WGS84.cartographicToCartesian(f,Ty),Kx.copy(Ty).subtract(l).normalize(),gs.WGS84.eastNorthUpToFixedFrame(l,Py),t5.copy(Py).invert(),Oh.copy(Ty).transform(t5);const y=Math.sqrt(Oh[0]*Oh[0]+Oh[1]*Oh[1]),A=y*y/Oh[2];Qx.copy([Oh[0],Oh[1],A]);const T=Qx.transform(Py).subtract(l).normalize(),P=Kx.cross(T).normalize().scale(c).add(l),L=gs.WGS84.cartesianToCartographic(P),D=e.project([s,r,n]),j=e.project(L);return DU.copy(D).subtract(j).magnitude()}function UU(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class e5{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;H(this,"_map",new Map),H(this,"_array",void 0),H(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Kr(t<this._array.length),this._array[t]}set(t,e){Kr(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Kr(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Kr(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const jU={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class jm{traversalFinished(t){return!0}constructor(t){H(this,"options",void 0),H(this,"root",null),H(this,"selectedTiles",{}),H(this,"requestedTiles",{}),H(this,"emptyTiles",{}),H(this,"lastUpdate",new Date().getTime()),H(this,"updateDebounceTime",1e3),H(this,"_traversalStack",new e5),H(this,"_emptyTraversalStack",new e5),H(this,"_frameNumber",null),this.options={...jU,...t}}traverse(t,e,r){this.root=t,this.options={...this.options,...r},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const r=this._traversalStack;for(t._selectionDepth=1,r.push(t);r.length>0;){const n=r.pop();let c=!1;this.canTraverse(n,e)&&(this.updateChildTiles(n,e),c=this.updateAndPushChildren(n,e,r,n.hasRenderContent?n._selectionDepth+1:n._selectionDepth));const l=n.parent,f=!!(!l||l._shouldRefine),y=!c;n.hasRenderContent?n.refine===Hc.ADD?(this.loadTile(n,e),this.selectTile(n,e)):n.refine===Hc.REPLACE&&(this.loadTile(n,e),y&&this.selectTile(n,e)):(this.emptyTiles[n.id]=n,this.loadTile(n,e),y&&this.selectTile(n,e)),this.touchTile(n,e),n._shouldRefine=c&&f}const s=new Date().getTime();(this.traversalFinished(e)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const r=t.children;for(const s of r)this.updateTile(s,e)}updateAndPushChildren(t,e,r,s){const{loadSiblings:n,skipLevelOfDetail:c}=this.options,l=t.children;l.sort(this.compareDistanceToCamera.bind(this));const f=t.refine===Hc.REPLACE&&t.hasRenderContent&&!c;let y=!1,A=!0;for(const T of l)if(T._selectionDepth=s,T.isVisibleAndInRequestVolume?(r.find(T)&&r.delete(T),r.push(T),y=!0):(f||n)&&(this.loadTile(T,e),this.touchTile(T,e)),f){let P;if(T._inRequestVolume?T.hasRenderContent?P=T.contentAvailable:P=this.executeEmptyTraversal(T,e):P=!1,A=A&&P,!A)return!1}return y||(A=!1),A}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!s&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,e,r):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=t._screenSpaceError;return r&&(s=t.getScreenSpaceError(e,!0)),s>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const r=[];if(this.options.viewportTraversersMap)for(const s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===e.viewport.id&&r.push(s);else r.push(e.viewport.id);t.updateVisibility(e,r)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let r=!1;for(const s of t.children)s.updateVisibility(e),r=r||s.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(t,e){let r=!0;const s=this._emptyTraversalStack;for(s.push(t);s.length>0&&r;){const n=s.pop();if(this.updateTile(n,e),n.isVisibleAndInRequestVolume||this.loadTile(n,e),this.touchTile(n,e),!n.hasRenderContent&&this.canTraverse(n,e,!1,!0)){const c=n.children;for(const l of c)s.find(l)&&s.delete(l),s.push(l)}else!n.contentAvailable&&!n.hasEmptyContent&&(r=!1)}return r}}const i5=new te;function GU(i){return i!=null}class z1{constructor(t,e,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";H(this,"tileset",void 0),H(this,"header",void 0),H(this,"id",void 0),H(this,"url",void 0),H(this,"parent",void 0),H(this,"refine",void 0),H(this,"type",void 0),H(this,"contentUrl",void 0),H(this,"lodMetricType","geometricError"),H(this,"lodMetricValue",0),H(this,"boundingVolume",null),H(this,"content",null),H(this,"contentState",ma.UNLOADED),H(this,"gpuMemoryUsageInBytes",0),H(this,"children",[]),H(this,"depth",0),H(this,"viewportIds",[]),H(this,"transform",new er),H(this,"extensions",null),H(this,"implicitTiling",null),H(this,"userData",{}),H(this,"computedTransform",void 0),H(this,"hasEmptyContent",!1),H(this,"hasTilesetContent",!1),H(this,"traverser",new jm({})),H(this,"_cacheNode",null),H(this,"_frameNumber",null),H(this,"_expireDate",null),H(this,"_expiredContent",null),H(this,"_boundingBox",void 0),H(this,"_distanceToCamera",0),H(this,"_screenSpaceError",0),H(this,"_visibilityPlaneMask",void 0),H(this,"_visible",void 0),H(this,"_contentBoundingVolume",void 0),H(this,"_viewerRequestVolume",void 0),H(this,"_initialTransform",new er),H(this,"_priority",0),H(this,"_selectedFrame",0),H(this,"_requestedFrame",0),H(this,"_selectionDepth",0),H(this,"_touchedFrame",0),H(this,"_centerZDepth",0),H(this,"_shouldRefine",!1),H(this,"_stackLength",0),H(this,"_visitedFrame",0),H(this,"_inRequestVolume",!1),H(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=s||e.id,this.url=e.url,this.parent=r,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ma.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ma.UNLOADED}get contentExpired(){return this.contentState===ma.EXPIRED}get contentFailed(){return this.contentState===ma.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=MU(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case Va.I3S:return VS(this,t);case Va.TILES3D:return NU(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,r=this.refine===Hc.ADD||e;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ma.UNLOADED)return-1;const s=this.parent,n=s&&(!r||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,c=t.root?t.root._screenSpaceError:0;return Math.max(c-n,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ma.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ma.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,s={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Wh(e,r,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ma.READY,this._onContentLoaded(),!0}catch(e){throw this.contentState=ma.FAILED,e}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ma.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const r=this.parent,s=r?r._visibilityPlaneMask:Wa.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const n=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(n)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,s),this._visible=this._visibilityPlaneMask!==Wa.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:r}=t,{boundingVolume:s}=this;return r.computeVisibilityWithPlaneMask(s,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const r=this.boundingVolume;return i5.subVectors(r.center,e.position),e.direction.dot(i5)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(GU(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=ma.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new er(t.transform):new er;const e=this.parent,r=this.tileset,s=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new er(s).multiplyRight(this.transform);const n=e&&e._initialTransform?e._initialTransform.clone():new er;this._initialTransform=new er(n).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ma.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Wa.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Hc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Cy(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Cy(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Cy(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new er).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return UU(this.tileset.tileset)}}}class VU extends jm{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const c=t.children[0];this.updateTileVisibility(c,e),t._visible=c._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const s=t.refine===Hc.REPLACE,n=t._optimChildrenWithinParent===PU.USE_OPTIMIZATION;if(s&&n&&r&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:r}=t;return!r||r.hasTilesetContent||r.refine!==Hc.ADD?!1:!this.shouldRefine(t,e,!0)}}class qU{constructor(){H(this,"frameNumberMap",new Map)}register(t,e){const r=this.frameNumberMap.get(t)||new Map,s=r.get(e)||0;r.set(e,s+1),this.frameNumberMap.set(t,r)}deregister(t,e){const r=this.frameNumberMap.get(t);if(!r)return;const s=r.get(e)||1;r.set(e,s-1)}isZero(t,e){var r;return(((r=this.frameNumberMap.get(t))===null||r===void 0?void 0:r.get(e))||0)===0}}const Iy={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class HU{constructor(){H(this,"_statusMap",void 0),H(this,"pendingTilesRegister",new qU),this._statusMap={}}add(t,e,r,s){if(!this._statusMap[e]){const{frameNumber:n,viewport:{id:c}}=s;this._statusMap[e]={request:t,callback:r,key:e,frameState:s,status:Iy.REQUESTED},this.pendingTilesRegister.register(c,n),t().then(l=>{this._statusMap[e].status=Iy.COMPLETED;const{frameNumber:f,viewport:{id:y}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(y,f),this._statusMap[e].callback(l,s)}).catch(l=>{this._statusMap[e].status=Iy.ERROR;const{frameNumber:f,viewport:{id:y}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(y,f),r(l)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:r,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,r);const{frameNumber:n,viewport:{id:c}}=e;this.pendingTilesRegister.register(c,n),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class WU extends jm{constructor(t){super(t),H(this,"_tileManager",void 0),this._tileManager=new HU}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=zU(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const r=t.header.children||[],s=t.children,n=t.tileset;for(const c of r){const l="".concat(c.id,"-").concat(e.viewport.id),f=s&&s.find(y=>y.id===l);if(f)f&&this.updateTile(f,e);else{let y=()=>this._loadTile(c.id,n);this._tileManager.find(l)?this._tileManager.update(l,e):(n.tileset.nodePages&&(y=()=>n.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(y,l,A=>this._onTileLoad(A,t,l),e))}}return!1}async _loadTile(t,e){const{loader:r}=e,s=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),n={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await Wh(s,r,n)}_onTileLoad(t,e,r){const s=new z1(e.tileset,t,e,r);e.children.push(s);const n=this._tileManager.find(s.id).frameState;this.updateTile(s,n),this._frameNumber===n.frameNumber&&(this.traversalFinished(n)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,n)}}const JU={description:"",ellipsoid:gs.WGS84,modelMatrix:new er,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},kg="Tiles In Tileset(s)",Ly="Tiles In Memory",r5="Tiles In View",s5="Tiles To Render",n5="Tiles Loaded",My="Tiles Loading",o5="Tiles Unloaded",a5="Failed Tile Loads",l5="Points/Vertices",By="Tile Memory Use";class XU{constructor(t,e){H(this,"options",void 0),H(this,"loadOptions",void 0),H(this,"type",void 0),H(this,"tileset",void 0),H(this,"loader",void 0),H(this,"url",void 0),H(this,"basePath",void 0),H(this,"modelMatrix",void 0),H(this,"ellipsoid",void 0),H(this,"lodMetricType",void 0),H(this,"lodMetricValue",void 0),H(this,"refine",void 0),H(this,"root",null),H(this,"roots",{}),H(this,"asset",{}),H(this,"description",""),H(this,"properties",void 0),H(this,"extras",null),H(this,"attributions",{}),H(this,"credits",{}),H(this,"stats",void 0),H(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),H(this,"cartographicCenter",null),H(this,"cartesianCenter",null),H(this,"zoom",1),H(this,"boundingVolume",null),H(this,"dynamicScreenSpaceErrorComputedDensity",0),H(this,"maximumMemoryUsage",32),H(this,"gpuMemoryUsageInBytes",0),H(this,"_frameNumber",0),H(this,"_queryParams",{}),H(this,"_extensionsUsed",[]),H(this,"_tiles",{}),H(this,"_pendingCount",0),H(this,"selectedTiles",[]),H(this,"traverseCounter",0),H(this,"geometricError",0),H(this,"lastUpdatedVieports",null),H(this,"_requestedTiles",[]),H(this,"_emptyTiles",[]),H(this,"frameStateData",{}),H(this,"_traverser",void 0),H(this,"_cache",new _U),H(this,"_requestScheduler",void 0),H(this,"updatePromise",null),H(this,"tilesetInitializationPromise",void 0),this.options={...JU,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||__(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new hI({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new bf({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const r=[];for(const s of e){const n=s.id;this._needTraverse(n)?r.push(n):this.traverseCounter--}for(const s of e){const n=s.id;if(this.roots[n]||(this.roots[n]=this._initializeTileHeaders(this.tileset,null)),!r.includes(n))continue;const c=bU(s,this._frameNumber);this._traverser.traverse(this.roots[n],c,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[e],s=Object.values(this._traverser.selectedTiles),[n,c]=wU(s,t,this.options.maximumTilesSelected);r.selectedTiles=n;for(const l of c)l.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const r=new Set(t.map(c=>c.id)),s=new Set(e.map(c=>c.id));let n=t.filter(c=>!s.has(c.id)).length>0;return n=n||e.filter(c=>!r.has(c.id)).length>0,n}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(t++,r.content.pointCount?e+=r.content.pointCount:e+=r.content.vertexCount);this.stats.get(r5).count=this.selectedTiles.length,this.stats.get(s5).count=t,this.stats.get(l5).count=e}async _initializeTileSet(t){this.type===Va.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Va.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Va.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:s,xmax:n,ymin:c,ymax:l,zmin:f,zmax:y}=e;this.cartographicCenter=new te(s+(n-s)/2,c+(l-c)/2,f+(y-f)/2),this.cartesianCenter=gs.WGS84.cartographicToCartesian(this.cartographicCenter,new te),this.zoom=zS(e,this.cartographicCenter,this.cartesianCenter);return}const r=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(r){const[s,n,c,l]=r;this.cartographicCenter=new te(s+(c-s)/2,n+(l-n)/2,0),this.cartesianCenter=gs.WGS84.cartographicToCartesian(this.cartographicCenter,new te),this.zoom=CU(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new te,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new te,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?this.cartographicCenter=gs.WGS84.cartesianToCartographic(e,new te):this.cartographicCenter=new te(0,0,-gs.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=EU(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(kg),this.stats.get(My),this.stats.get(Ly),this.stats.get(r5),this.stats.get(s5),this.stats.get(n5),this.stats.get(o5),this.stats.get(a5),this.stats.get(l5),this.stats.get(By,"memory")}_initializeTileHeaders(t,e){const r=new z1(this,t.root,e);if(e&&(e.children.push(r),r.depth=e.depth+1),this.type===Va.TILES3D){const n=[];for(n.push(r);n.length>0;){const c=n.pop();this.stats.get(kg).incrementCount();const l=c.header.children||[];for(const f of l){var s;const y=new z1(this,f,c);if((s=y.contentUrl)!==null&&s!==void 0&&s.includes("?session=")){const A=new URL(y.contentUrl).searchParams.get("session");A&&(this._queryParams.session=A)}c.children.push(y),y.depth=c.depth+1,n.push(y)}}}return r}_initializeTraverser(){let t;switch(this.type){case Va.TILES3D:t=VU;break;case Va.I3S:t=WU;break;default:t=jm}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(r){this._onTileLoadError(t,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(a5).incrementCount();const r=e.message||e.toString(),s=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(r)),this.options.onTileError(t,r,s)}_onTileLoad(t,e){if(e){if(this.type===Va.I3S){var r,s;const n=((r=this.tileset)===null||r===void 0||(s=r.nodePagesTile)===null||s===void 0?void 0:s.nodesInNodePages)||0;this.stats.get(kg).reset(),this.stats.get(kg).addCount(n)}t&&t.content&&vU(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===Va.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Va.TILES3D){var e;const{extensionsRemoved:r=[]}=((e=t.content)===null||e===void 0?void 0:e.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(My).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(My).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(n5).incrementCount(),this.stats.get(Ly).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(By).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(Ly).decrementCount(),this.stats.get(o5).incrementCount(),this.stats.get(By).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const r of e.children)t.push(r);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();for(const s of t.children)r.push(s);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),r=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const qS="3.4.15",Np={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function HS(i,t,e){Kr(i instanceof ArrayBuffer);const r=new TextDecoder("utf8"),s=new Uint8Array(i,t,e);return r.decode(s)}function ZU(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(i);return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}const $U={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Vs={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},_r={...$U,...Vs},Ry={[Vs.DOUBLE]:Float64Array,[Vs.FLOAT]:Float32Array,[Vs.UNSIGNED_SHORT]:Uint16Array,[Vs.UNSIGNED_INT]:Uint32Array,[Vs.UNSIGNED_BYTE]:Uint8Array,[Vs.BYTE]:Int8Array,[Vs.SHORT]:Int16Array,[Vs.INT]:Int32Array},YU={DOUBLE:Vs.DOUBLE,FLOAT:Vs.FLOAT,UNSIGNED_SHORT:Vs.UNSIGNED_SHORT,UNSIGNED_INT:Vs.UNSIGNED_INT,UNSIGNED_BYTE:Vs.UNSIGNED_BYTE,BYTE:Vs.BYTE,SHORT:Vs.SHORT,INT:Vs.INT},ky="Failed to convert GL type";class lc{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in Ry)if(Ry[e]===t)return e;throw new Error(ky)}static fromName(t){const e=YU[t];if(!e)throw new Error(ky);return e}static getArrayType(t){switch(t){case Vs.UNSIGNED_SHORT_5_6_5:case Vs.UNSIGNED_SHORT_4_4_4_4:case Vs.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=Ry[t];if(!e)throw new Error(ky);return e}}static getByteSize(t){return lc.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!lc.getArrayType(t)}static createTypedArray(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;s===void 0&&(s=(e.byteLength-r)/lc.getByteSize(t));const n=lc.getArrayType(t);return new n(e,r,s)}}function KU(i,t){if(!i)throw new Error("math.gl assertion failed. ".concat(t))}function QU(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=i>>11&31,r=i>>5&63,s=i&31;return t[0]=e<<3,t[1]=r<<2,t[2]=s<<3,t}new D_;new te;new D_;new D_;function c5(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Gc(i,0,t)/t*2-1}function h5(i){return i<0?-1:1}function tj(i,t,e,r){if(KU(r),i<0||i>e||t<0||t>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(r.x=c5(i,e),r.y=c5(t,e),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const s=r.x;r.x=(1-Math.abs(r.y))*h5(s),r.y=(1-Math.abs(s))*h5(r.y)}return r.normalize()}function ej(i,t,e){return tj(i,t,255,e)}class _v{constructor(t,e){H(this,"json",void 0),H(this,"buffer",void 0),H(this,"featuresLength",0),H(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_r.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,s.byteOffset):s}getPropertyArray(t,e,r){const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(e=lc.fromName(s.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(t,e,s)}getProperty(t,e,r,s,n){const c=this.json[t];if(!c)return c;const l=this.getPropertyArray(t,e,r);if(r===1)return l[s];for(let f=0;f<r;++f)n[f]=l[r*s+f];return n}_getTypedArrayFromBinary(t,e,r,s,n){const c=this._cachedTypedArrays;let l=c[t];return l||(l=lc.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+n,s*r),c[t]=l),l}_getTypedArrayFromArray(t,e,r){const s=this._cachedTypedArrays;let n=s[t];return n||(n=lc.createTypedArray(e,r),s[t]=n),n}}const ij={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rj={SCALAR:(i,t)=>i[t],VEC2:(i,t)=>[i[2*t+0],i[2*t+1]],VEC3:(i,t)=>[i[3*t+0],i[3*t+1],i[3*t+2]],VEC4:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT2:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT3:(i,t)=>[i[9*t+0],i[9*t+1],i[9*t+2],i[9*t+3],i[9*t+4],i[9*t+5],i[9*t+6],i[9*t+7],i[9*t+8]],MAT4:(i,t)=>[i[16*t+0],i[16*t+1],i[16*t+2],i[16*t+3],i[16*t+4],i[16*t+5],i[16*t+6],i[16*t+7],i[16*t+8],i[16*t+9],i[16*t+10],i[16*t+11],i[16*t+12],i[16*t+13],i[16*t+14],i[16*t+15]]},sj={SCALAR:(i,t,e)=>{t[e]=i},VEC2:(i,t,e)=>{t[2*e+0]=i[0],t[2*e+1]=i[1]},VEC3:(i,t,e)=>{t[3*e+0]=i[0],t[3*e+1]=i[1],t[3*e+2]=i[2]},VEC4:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT2:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT3:(i,t,e)=>{t[9*e+0]=i[0],t[9*e+1]=i[1],t[9*e+2]=i[2],t[9*e+3]=i[3],t[9*e+4]=i[4],t[9*e+5]=i[5],t[9*e+6]=i[6],t[9*e+7]=i[7],t[9*e+8]=i[8],t[9*e+9]=i[9]},MAT4:(i,t,e)=>{t[16*e+0]=i[0],t[16*e+1]=i[1],t[16*e+2]=i[2],t[16*e+3]=i[3],t[16*e+4]=i[4],t[16*e+5]=i[5],t[16*e+6]=i[6],t[16*e+7]=i[7],t[16*e+8]=i[8],t[16*e+9]=i[9],t[16*e+10]=i[10],t[16*e+11]=i[11],t[16*e+12]=i[12],t[16*e+13]=i[13],t[16*e+14]=i[14],t[16*e+15]=i[15]}};function nj(i,t,e,r){const{componentType:s}=i;Kr(i.componentType);const n=typeof s=="string"?lc.fromName(s):s,c=ij[i.type],l=rj[i.type],f=sj[i.type];return e+=i.byteOffset,{values:lc.createTypedArray(n,t,e,c*r),type:n,size:c,unpacker:l,packer:f}}const nc=i=>i!==void 0;function oj(i,t,e){if(!t)return null;let r=i.getExtension("3DTILES_batch_table_hierarchy");const s=t.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,r=s),r?aj(r,e):null}function aj(i,t){let e,r,s;const n=i.instancesLength,c=i.classes;let l=i.classIds,f=i.parentCounts,y=i.parentIds,A=n;nc(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,n));let T;if(nc(f))for(nc(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,s=getBinaryAccessor(f),f=s.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,n)),T=new Uint16Array(n),A=0,e=0;e<n;++e)T[e]=A,A+=f[e];nc(y)&&nc(y.byteOffset)&&(y.componentType=defaultValue(y.componentType,GL.UNSIGNED_SHORT),y.type=AttributeType.SCALAR,s=getBinaryAccessor(y),y=s.createArrayBufferView(t.buffer,t.byteOffset+y.byteOffset,A));const P=c.length;for(e=0;e<P;++e){const X=c[e].length,Z=c[e].instances,$=getBinaryProperties(X,Z,t);c[e].instances=combine($,Z)}const L=new Array(P).fill(0),D=new Uint16Array(n);for(e=0;e<n;++e)r=l[e],D[e]=L[r],++L[r];const j={classes:c,classIds:l,classIndexes:D,parentCounts:f,parentIndexes:T,parentIds:y};return hj(j),j}function Dp(i,t,e){if(!i)return;const r=i.parentCounts;return i.parentIds?e(i,t):r>0?lj(i,t,e):cj(i,t,e)}function lj(i,t,e){const r=i.classIds,s=i.parentCounts,n=i.parentIds,c=i.parentIndexes,l=r.length,f=scratchVisited;f.length=Math.max(f.length,l);const y=++marker,A=scratchStack;for(A.length=0,A.push(t);A.length>0;){if(t=A.pop(),f[t]===y)continue;f[t]=y;const T=e(i,t);if(nc(T))return T;const P=s[t],L=c[t];for(let D=0;D<P;++D){const j=n[L+D];j!==t&&A.push(j)}}return null}function cj(i,t,e){let r=!0;for(;r;){const s=e(i,t);if(nc(s))return s;const n=i.parentIds[t];r=n!==t,t=n}throw new Error("traverseHierarchySingleParent")}function hj(i){const t=i.classIds.length;for(let e=0;e<t;++e)WS(i,e,stack)}function WS(i,t,e){const r=i.parentCounts,s=i.parentIds,n=i.parentIndexes,c=i.classIds.length;if(!nc(s))return;assert(t<c,"Parent index ".concat(t," exceeds the total number of instances: ").concat(c)),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const l=nc(r)?r[t]:1,f=nc(r)?n[t]:t;for(let y=0;y<l;++y){const A=s[f+y];A!==t&&WS(i,A,e)}e.pop(t)}function No(i){return i!=null}const Og=(i,t)=>i,uj={HIERARCHY:!0,extensions:!0,extras:!0};class JS{constructor(t,e,r){var s;let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};H(this,"json",void 0),H(this,"binary",void 0),H(this,"featureCount",void 0),H(this,"_extensions",void 0),H(this,"_properties",void 0),H(this,"_binaryProperties",void 0),H(this,"_hierarchy",void 0),Kr(r>=0),this.json=t||{},this.binary=e,this.featureCount=r,this._extensions=((s=this.json)===null||s===void 0?void 0:s.extensions)||{},this._properties={};for(const c in this.json)uj[c]||(this._properties[c]=this.json[c]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=oj(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),Kr(typeof e=="string",e),this._hierarchy){const r=Dp(this._hierarchy,t,(s,n)=>{const c=s.classIds[n];return s.classes[c].name===e});return No(r)}return!1}isExactClass(t,e){return Kr(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),Kr(typeof e=="string",e),No(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=No(e)?e:[],e.length=0;const r=Object.keys(this._properties);return e.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),Kr(typeof e=="string",e),this._binaryProperties){const s=this._binaryProperties[e];if(No(s))return this._getBinaryProperty(s,t)}const r=this._properties[e];if(No(r))return Og(r[t]);if(this._hierarchy){const s=this._getHierarchyProperty(t,e);if(No(s))return s}}setProperty(t,e,r){const s=this.featureCount;if(this._checkBatchId(t),Kr(typeof e=="string",e),this._binaryProperties){const c=this._binaryProperties[e];if(c){this._setBinaryProperty(c,t,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,r))return;let n=this._properties[e];No(n)||(this._properties[e]=new Array(s),n=this._properties[e]),n[t]=Og(r)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,r){t.pack(r,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const r=this._properties[e],s=this._initializeBinaryProperty(e,r);s&&(t=t||{},t[e]=s)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const r=e;Kr(this.binary,"Property ".concat(t," requires a batch table binary.")),Kr(r.type,"Property ".concat(t," requires a type."));const s=nj(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const r=Dp(this._hierarchy,t,(s,n)=>{const c=s.classIds[n],l=s.classes[c].instances;return No(l[e])});return No(r)}_getPropertyNamesInHierarchy(t,e){Dp(this._hierarchy,t,(r,s)=>{const n=r.classIds[s],c=r.classes[n].instances;for(const l in c)c.hasOwnProperty(l)&&e.indexOf(l)===-1&&e.push(l)})}_getHierarchyProperty(t,e){return Dp(this._hierarchy,t,(r,s)=>{const n=r.classIds[s],c=r.classes[n],l=r.classIndexes[s],f=c.instances[e];return No(f)?No(f.typedArray)?this._getBinaryProperty(f,l):Og(f[l]):null})}_setHierarchyProperty(t,e,r,s){const n=Dp(this._hierarchy,e,(c,l)=>{const f=c.classIds[l],y=c.classes[f],A=c.classIndexes[l],T=y.instances[r];return No(T)?(Kr(l===e,'Inherited property "'.concat(r,'" is read-only.')),No(T.typedArray)?this._setBinaryProperty(T,A,s):T[A]=Og(s),!0):!1});return No(n)}}const Oy=4;function Gm(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(t);if(i.magic=r.getUint32(e,!0),e+=Oy,i.version=r.getUint32(e,!0),e+=Oy,i.byteLength=r.getUint32(e,!0),e+=Oy,i.version!==1)throw new Error("3D Tile Version ".concat(i.version," not supported"));return e}const pd=4,u5="b3dm tile in legacy format.";function vv(i,t,e){const r=new DataView(t);let s;i.header=i.header||{};let n=r.getUint32(e,!0);e+=pd;let c=r.getUint32(e,!0);e+=pd;let l=r.getUint32(e,!0);e+=pd;let f=r.getUint32(e,!0);return e+=pd,l>=570425344?(e-=pd*2,s=n,l=c,f=0,n=0,c=0,console.warn(u5)):f>=570425344&&(e-=pd,s=l,l=n,f=c,n=0,c=0,console.warn(u5)),i.header.featureTableJsonByteLength=n,i.header.featureTableBinaryByteLength=c,i.header.batchTableJsonByteLength=l,i.header.batchTableBinaryByteLength=f,i.header.batchLength=s,e}function bv(i,t,e,r){return e=dj(i,t,e),e=pj(i,t,e),e}function dj(i,t,e,r){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:n,batchLength:c}=i.header;if(i.featureTableJson={BATCH_LENGTH:c||0},s>0){const l=HS(t,e,s);i.featureTableJson=JSON.parse(l)}return e+=s,i.featureTableBinary=new Uint8Array(t,e,n),e+=n,e}function pj(i,t,e,r){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:n}=i.header;if(s>0){const c=HS(t,e,s);i.batchTableJson=JSON.parse(c),e+=s,n>0&&(i.batchTableBinary=new Uint8Array(t,e,n),i.batchTableBinary=new Uint8Array(i.batchTableBinary),e+=n)}return e}function XS(i,t,e){if(!t&&(!i||!i.batchIds||!e))return null;const{batchIds:r,isRGB565:s,pointCount:n}=i;if(r&&e){const c=new Uint8ClampedArray(n*3);for(let l=0;l<n;l++){const f=r[l],y=e.getProperty(f,"dimensions").map(A=>A*255);c[l*3]=y[0],c[l*3+1]=y[1],c[l*3+2]=y[2]}return{type:_r.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}if(s){const c=new Uint8ClampedArray(n*3);for(let l=0;l<n;l++){const f=QU(t[l]);c[l*3]=f[0],c[l*3+1]=f[1],c[l*3+2]=f[2]}return{type:_r.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return t&&t.length===n*3?{type:_r.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:_r.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const d5=new te;function fj(i,t){if(!t)return null;if(i.isOctEncoded16P){const e=new Float32Array(i.pointsLength*3);for(let r=0;r<i.pointsLength;r++)ej(t[r*2],t[r*2+1],d5),d5.toArray(e,r*3);return{type:_r.FLOAT,size:2,value:e}}return{type:_r.FLOAT,size:2,value:t}}function gj(i,t,e){return i.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,mj(i,t)):{type:_r.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function mj(i,t){const e=new te,r=new Float32Array(i.pointCount*3);for(let s=0;s<i.pointCount;s++)e.set(t[s*3],t[s*3+1],t[s*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(r,s*3);return r}async function yj(i,t,e,r,s){e=Gm(i,t,e),e=vv(i,t,e),e=bv(i,t,e),_j(i);const{featureTable:n,batchTable:c}=vj(i);return await Sj(i,n,c,r,s),bj(i,n,r),wj(i,n,c),xj(i,n),e}function _j(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function vj(i){const t=new _v(i.featureTableJson,i.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,i.featuresLength=e,i.pointsLength=e,i.pointCount=e,i.rtcCenter=t.getGlobalProperty("RTC_CENTER",_r.FLOAT,3);const r=Aj(i,t);return{featureTable:t,batchTable:r}}function bj(i,t,e){if(!i.attributes.positions){if(t.hasProperty("POSITION"))i.attributes.positions=t.getPropertyArray("POSITION",_r.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const r=t.getPropertyArray("POSITION_QUANTIZED",_r.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_r.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_r.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=gj(i,r,e)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function wj(i,t,e){if(!i.attributes.colors){let r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",_r.UNSIGNED_BYTE,4),i.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",_r.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",_r.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=XS(i,r,e)}t.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",_r.UNSIGNED_BYTE,4))}function xj(i,t){if(!i.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",_r.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",_r.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=fj(i,e)}}function Aj(i,t){let e=null;if(!i.batchIds&&t.hasProperty("BATCH_ID")&&(i.batchIds=t.getPropertyArray("BATCH_ID",_r.UNSIGNED_SHORT,1),i.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:n}=i;e=new JS(s,n,r)}return e}async function Sj(i,t,e,r,s){let n,c,l;const f=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(l=f.properties);const y=t.getExtension("3DTILES_draco_point_compression");if(y){c=y.properties;const T=y.byteOffset,P=y.byteLength;if(!c||!Number.isFinite(T)||!P)throw new Error("Draco properties, byteOffset, and byteLength must be defined");n=i.featureTableBinary.slice(T,T+P),i.hasPositions=Number.isFinite(c.POSITION),i.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),i.hasNormals=Number.isFinite(c.NORMAL),i.hasBatchIds=Number.isFinite(c.BATCH_ID),i.isTranslucent=Number.isFinite(c.RGBA)}if(!n)return!0;const A={buffer:n,properties:{...c,...l},featureTableProperties:c,batchTableProperties:l,dequantizeInShader:!1};return await Ej(i,A,r,s)}async function Ej(i,t,e,r){const{parse:s}=r,n={...e,draco:{...e.draco,extraAttributes:t.batchTableProperties||{}}};delete n["3d-tiles"];const c=await s(t.buffer,BS,n),l=c.attributes.POSITION&&c.attributes.POSITION.value,f=c.attributes.COLOR_0&&c.attributes.COLOR_0.value,y=c.attributes.NORMAL&&c.attributes.NORMAL.value,A=c.attributes.BATCH_ID&&c.attributes.BATCH_ID.value,T=l&&c.attributes.POSITION.value.quantization,P=y&&c.attributes.NORMAL.value.quantization;if(T){const D=c.POSITION.data.quantization,j=D.range;i.quantizedVolumeScale=new te(j,j,j),i.quantizedVolumeOffset=new te(D.minValues),i.quantizedRange=(1<<D.quantizationBits)-1,i.isQuantizedDraco=!0}P&&(i.octEncodedRange=(1<<c.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const L={};if(t.batchTableProperties)for(const D of Object.keys(t.batchTableProperties))c.attributes[D]&&c.attributes[D].value&&(L[D.toLowerCase()]=c.attributes[D].value);i.attributes={positions:l,colors:XS(i,f,void 0),normals:y,batchIds:A,...L}}const U1={URI:0,EMBEDDED:1};function ZS(i,t,e,r){i.rotateYtoZ=!0;const s=i.byteOffset+i.byteLength-e;if(s===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=y_(t,e,s),i.gltfByteOffset=0,i.gltfByteLength=s,e%4===0||console.warn("".concat(i.type,": embedded glb is not aligned to a 4-byte boundary.")),i.byteOffset+i.byteLength}async function $S(i,t,e,r){const s=e["3d-tiles"]||{};if(Cj(i,t),s.loadGLTF){const{parse:n,fetch:c}=r;i.gltfUrl&&(i.gltfArrayBuffer=await c(i.gltfUrl,e),i.gltfByteOffset=0),i.gltfArrayBuffer&&(i.gltf=await n(i.gltfArrayBuffer,pf,e,r),i.gpuMemoryUsageInBytes=LS(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength)}}function Cj(i,t,e){switch(t){case U1.URI:const r=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),s=new TextDecoder().decode(r);i.gltfUrl=s.replace(/[\s\0]+$/,""),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case U1.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Tj(i,t,e,r,s){var n;e=Pj(i,t,e,r),await $S(i,U1.EMBEDDED,r,s);const c=i==null||(n=i.gltf)===null||n===void 0?void 0:n.extensions;return c&&c.CESIUM_RTC&&(i.rtcCenter=c.CESIUM_RTC.center),e}function Pj(i,t,e,r,s){e=Gm(i,t,e),e=vv(i,t,e),e=bv(i,t,e),e=ZS(i,t,e,r);const n=new _v(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=n.getGlobalProperty("RTC_CENTER",_r.FLOAT,3),e}async function Ij(i,t,e,r,s){return e=Lj(i,t,e,r),await $S(i,i.gltfFormat,r,s),e}function Lj(i,t,e,r,s){if(e=Gm(i,t,e),i.version!==1)throw new Error("Instanced 3D Model version ".concat(i.version," is not supported"));e=vv(i,t,e);const n=new DataView(t);if(i.gltfFormat=n.getUint32(e,!0),e+=4,e=bv(i,t,e),e=ZS(i,t,e,r),i.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const c=new _v(i.featureTableJson,i.featureTableBinary),l=c.getGlobalProperty("INSTANCES_LENGTH");if(c.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=c.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=c.getGlobalProperty("RTC_CENTER",_r.FLOAT,3);const f=new JS(i.batchTableJson,i.batchTableBinary,l);return Mj(i,c,f,l),e}function Mj(i,t,e,r){const s={instances:new Array(r),batchTable:i._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,n=new te;new te,new te,new te;const c=new Is,l=new lf,f=new te,y={},A=new er,T=[],P=[],L=new te,D=new te;for(let j=0;j<r;j++){let X;if(t.hasProperty("POSITION"))X=t.getProperty("POSITION",_r.FLOAT,3,j,n);else if(t.hasProperty("POSITION_QUANTIZED")){X=t.getProperty("POSITION_QUANTIZED",_r.UNSIGNED_SHORT,3,j,n);const Nt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",_r.FLOAT,3,L);if(!Nt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Rt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",_r.FLOAT,3,D);if(!Rt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const xt=65535;for(let qt=0;qt<3;qt++)X[qt]=X[qt]/xt*Rt[qt]+Nt[qt]}if(!X)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(n.copy(X),y.translation=n,i.normalUp=t.getProperty("NORMAL_UP",_r.FLOAT,3,j,T),i.normalRight=t.getProperty("NORMAL_RIGHT",_r.FLOAT,3,j,P),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",_r.UNSIGNED_SHORT,2,T),i.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",_r.UNSIGNED_SHORT,2,P),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(gs.WGS84.eastNorthUpToFixedFrame(n,A),A.getRotationMatrix3(c)):c.identity()}l.fromMatrix3(c),y.rotation=l,f.set(1,1,1);const Z=t.getProperty("SCALE",_r.FLOAT,1,j);Number.isFinite(Z)&&f.multiplyByScalar(Z);const $=t.getProperty("SCALE_NON_UNIFORM",_r.FLOAT,3,j,T);$&&f.scale($),y.scale=f;let ht=t.getProperty("BATCH_ID",_r.UNSIGNED_SHORT,1,j);ht===void 0&&(ht=j);const _t=new er().fromQuaternion(y.rotation);A.identity(),A.translate(y.translation),A.multiplyRight(_t),A.scale(y.scale);const Mt=A.clone();s[j]={modelMatrix:Mt,batchId:ht}}i.instances=s}async function Bj(i,t,e,r,s,n){e=Gm(i,t,e);const c=new DataView(t);for(i.tilesLength=c.getUint32(e,!0),e+=4,i.tiles=[];i.tiles.length<i.tilesLength&&i.byteLength-e>12;){const l={};i.tiles.push(l),e=await n(t,e,r,s,l)}return e}async function Rj(i,t,e,r){i.rotateYtoZ=!0,i.gltfUpAxis=e["3d-tiles"]&&e["3d-tiles"].assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y";const{parse:s}=r;i.gltf=await s(t,pf,e,r),i.gpuMemoryUsageInBytes=LS(i.gltf)}async function YS(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(s.byteOffset=t,s.type=ZU(i,t),s.type){case Np.COMPOSITE:return await Bj(s,i,t,e,r,YS);case Np.BATCHED_3D_MODEL:return await Tj(s,i,t,e,r);case Np.GLTF:return await Rj(s,i,e,r);case Np.INSTANCED_3D_MODEL:return await Ij(s,i,t,e,r);case Np.POINT_CLOUD:return await yj(s,i,t,e,r);default:throw new Error("3DTileLoader: unknown type ".concat(s.type))}}const kj=1952609651,Oj=1;async function Fj(i,t,e){if(new Uint32Array(i.slice(0,4))[0]!==kj)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==Oj)throw new Error("Wrong subtree file verson, must be 1");const r=p5(i.slice(8,16)),s=new Uint8Array(i,24,r),n=new TextDecoder("utf8").decode(s),c=JSON.parse(n),l=p5(i.slice(16,24));let f=new ArrayBuffer(0);return l&&(f=i.slice(24+r)),"bufferView"in c.tileAvailability&&(c.tileAvailability.explicitBitstream=await Fy(c,"tileAvailability",f,e)),"bufferView"in c.contentAvailability&&(c.contentAvailability.explicitBitstream=await Fy(c,"contentAvailability",f,e)),"bufferView"in c.childSubtreeAvailability&&(c.childSubtreeAvailability.explicitBitstream=await Fy(c,"childSubtreeAvailability",f,e)),c}function Nj(i,t){if(t.startsWith("http")){const s=new URL(i,t);return decodeURI(s.toString())}const e="http://".concat(t),r=new URL(i,e);return"/".concat(r.host).concat(r.pathname)}async function Fy(i,t,e,r){const s=i[t].bufferView,n=i.bufferViews[s],c=i.buffers[n.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(c.uri){const l=Nj(c.uri,r==null?void 0:r.url),f=await(await r.fetch(l)).arrayBuffer();return new Uint8Array(f,n.byteOffset,n.byteLength)}return new Uint8Array(e,n.byteOffset,n.byteLength)}function p5(i){const t=new DataView(i),e=t.getUint32(0,!0),r=t.getUint32(4,!0);return e+2**32*r}const KS={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:qS,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Fj,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ja=null;try{Ja=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function jr(i,t,e){this.low=i|0,this.high=t|0,this.unsigned=!!e}jr.prototype.__isLong__;Object.defineProperty(jr.prototype,"__isLong__",{value:!0});function $n(i){return(i&&i.__isLong__)===!0}function f5(i){var t=Math.clz32(i&-i);return i?31-t:t}jr.isLong=$n;var g5={},m5={};function zu(i,t){var e,r,s;return t?(i>>>=0,(s=0<=i&&i<256)&&(r=m5[i],r)?r:(e=xr(i,0,!0),s&&(m5[i]=e),e)):(i|=0,(s=-128<=i&&i<128)&&(r=g5[i],r)?r:(e=xr(i,i<0?-1:0,!1),s&&(g5[i]=e),e))}jr.fromInt=zu;function Xa(i,t){if(isNaN(i))return t?Vc:bl;if(t){if(i<0)return Vc;if(i>=QS)return iE}else{if(i<=-_5)return Uo;if(i+1>=_5)return eE}return i<0?Xa(-i,t).neg():xr(i%Wd|0,i/Wd|0,t)}jr.fromNumber=Xa;function xr(i,t,e){return new jr(i,t,e)}jr.fromBits=xr;var Cm=Math.pow;function wv(i,t,e){if(i.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return t?Vc:bl;if(e=e||10,e<2||36<e)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return wv(i.substring(1),t,e).neg();for(var s=Xa(Cm(e,8)),n=bl,c=0;c<i.length;c+=8){var l=Math.min(8,i.length-c),f=parseInt(i.substring(c,c+l),e);if(l<8){var y=Xa(Cm(e,l));n=n.mul(y).add(Xa(f))}else n=n.mul(s),n=n.add(Xa(f))}return n.unsigned=t,n}jr.fromString=wv;function Sl(i,t){return typeof i=="number"?Xa(i,t):typeof i=="string"?wv(i,t):xr(i.low,i.high,typeof t=="boolean"?t:i.unsigned)}jr.fromValue=Sl;var y5=65536,Dj=1<<24,Wd=y5*y5,QS=Wd*Wd,_5=QS/2,v5=zu(Dj),bl=zu(0);jr.ZERO=bl;var Vc=zu(0,!0);jr.UZERO=Vc;var Ed=zu(1);jr.ONE=Ed;var tE=zu(1,!0);jr.UONE=tE;var j1=zu(-1);jr.NEG_ONE=j1;var eE=xr(-1,2147483647,!1);jr.MAX_VALUE=eE;var iE=xr(-1,-1,!0);jr.MAX_UNSIGNED_VALUE=iE;var Uo=xr(0,-2147483648,!1);jr.MIN_VALUE=Uo;var Be=jr.prototype;Be.toInt=function(){return this.unsigned?this.low>>>0:this.low};Be.toNumber=function(){return this.unsigned?(this.high>>>0)*Wd+(this.low>>>0):this.high*Wd+(this.low>>>0)};Be.toString=function(i){if(i=i||10,i<2||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Uo)){var t=Xa(i),e=this.div(t),r=e.mul(t).sub(this);return e.toString(i)+r.toInt().toString(i)}else return"-"+this.neg().toString(i);for(var s=Xa(Cm(i,6),this.unsigned),n=this,c="";;){var l=n.div(s),f=n.sub(l.mul(s)).toInt()>>>0,y=f.toString(i);if(n=l,n.isZero())return y+c;for(;y.length<6;)y="0"+y;c=""+y+c}};Be.getHighBits=function(){return this.high};Be.getHighBitsUnsigned=function(){return this.high>>>0};Be.getLowBits=function(){return this.low};Be.getLowBitsUnsigned=function(){return this.low>>>0};Be.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Uo)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,t=31;t>0&&!(i&1<<t);t--);return this.high!=0?t+33:t+1};Be.isZero=function(){return this.high===0&&this.low===0};Be.eqz=Be.isZero;Be.isNegative=function(){return!this.unsigned&&this.high<0};Be.isPositive=function(){return this.unsigned||this.high>=0};Be.isOdd=function(){return(this.low&1)===1};Be.isEven=function(){return(this.low&1)===0};Be.equals=function(i){return $n(i)||(i=Sl(i)),this.unsigned!==i.unsigned&&this.high>>>31===1&&i.high>>>31===1?!1:this.high===i.high&&this.low===i.low};Be.eq=Be.equals;Be.notEquals=function(i){return!this.eq(i)};Be.neq=Be.notEquals;Be.ne=Be.notEquals;Be.lessThan=function(i){return this.comp(i)<0};Be.lt=Be.lessThan;Be.lessThanOrEqual=function(i){return this.comp(i)<=0};Be.lte=Be.lessThanOrEqual;Be.le=Be.lessThanOrEqual;Be.greaterThan=function(i){return this.comp(i)>0};Be.gt=Be.greaterThan;Be.greaterThanOrEqual=function(i){return this.comp(i)>=0};Be.gte=Be.greaterThanOrEqual;Be.ge=Be.greaterThanOrEqual;Be.compare=function(i){if($n(i)||(i=Sl(i)),this.eq(i))return 0;var t=this.isNegative(),e=i.isNegative();return t&&!e?-1:!t&&e?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1};Be.comp=Be.compare;Be.negate=function(){return!this.unsigned&&this.eq(Uo)?Uo:this.not().add(Ed)};Be.neg=Be.negate;Be.add=function(i){$n(i)||(i=Sl(i));var t=this.high>>>16,e=this.high&65535,r=this.low>>>16,s=this.low&65535,n=i.high>>>16,c=i.high&65535,l=i.low>>>16,f=i.low&65535,y=0,A=0,T=0,P=0;return P+=s+f,T+=P>>>16,P&=65535,T+=r+l,A+=T>>>16,T&=65535,A+=e+c,y+=A>>>16,A&=65535,y+=t+n,y&=65535,xr(T<<16|P,y<<16|A,this.unsigned)};Be.subtract=function(i){return $n(i)||(i=Sl(i)),this.add(i.neg())};Be.sub=Be.subtract;Be.multiply=function(i){if(this.isZero())return this;if($n(i)||(i=Sl(i)),Ja){var t=Ja.mul(this.low,this.high,i.low,i.high);return xr(t,Ja.get_high(),this.unsigned)}if(i.isZero())return this.unsigned?Vc:bl;if(this.eq(Uo))return i.isOdd()?Uo:bl;if(i.eq(Uo))return this.isOdd()?Uo:bl;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(v5)&&i.lt(v5))return Xa(this.toNumber()*i.toNumber(),this.unsigned);var e=this.high>>>16,r=this.high&65535,s=this.low>>>16,n=this.low&65535,c=i.high>>>16,l=i.high&65535,f=i.low>>>16,y=i.low&65535,A=0,T=0,P=0,L=0;return L+=n*y,P+=L>>>16,L&=65535,P+=s*y,T+=P>>>16,P&=65535,P+=n*f,T+=P>>>16,P&=65535,T+=r*y,A+=T>>>16,T&=65535,T+=s*f,A+=T>>>16,T&=65535,T+=n*l,A+=T>>>16,T&=65535,A+=e*y+r*f+s*l+n*c,A&=65535,xr(P<<16|L,A<<16|T,this.unsigned)};Be.mul=Be.multiply;Be.divide=function(i){if($n(i)||(i=Sl(i)),i.isZero())throw Error("division by zero");if(Ja){if(!this.unsigned&&this.high===-2147483648&&i.low===-1&&i.high===-1)return this;var t=(this.unsigned?Ja.div_u:Ja.div_s)(this.low,this.high,i.low,i.high);return xr(t,Ja.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Vc:bl;var e,r,s;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return Vc;if(i.gt(this.shru(1)))return tE;s=Vc}else{if(this.eq(Uo)){if(i.eq(Ed)||i.eq(j1))return Uo;if(i.eq(Uo))return Ed;var n=this.shr(1);return e=n.div(i).shl(1),e.eq(bl)?i.isNegative()?Ed:j1:(r=this.sub(i.mul(e)),s=e.add(r.div(i)),s)}else if(i.eq(Uo))return this.unsigned?Vc:bl;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();s=bl}for(r=this;r.gte(i);){e=Math.max(1,Math.floor(r.toNumber()/i.toNumber()));for(var c=Math.ceil(Math.log(e)/Math.LN2),l=c<=48?1:Cm(2,c-48),f=Xa(e),y=f.mul(i);y.isNegative()||y.gt(r);)e-=l,f=Xa(e,this.unsigned),y=f.mul(i);f.isZero()&&(f=Ed),s=s.add(f),r=r.sub(y)}return s};Be.div=Be.divide;Be.modulo=function(i){if($n(i)||(i=Sl(i)),Ja){var t=(this.unsigned?Ja.rem_u:Ja.rem_s)(this.low,this.high,i.low,i.high);return xr(t,Ja.get_high(),this.unsigned)}return this.sub(this.div(i).mul(i))};Be.mod=Be.modulo;Be.rem=Be.modulo;Be.not=function(){return xr(~this.low,~this.high,this.unsigned)};Be.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Be.clz=Be.countLeadingZeros;Be.countTrailingZeros=function(){return this.low?f5(this.low):f5(this.high)+32};Be.ctz=Be.countTrailingZeros;Be.and=function(i){return $n(i)||(i=Sl(i)),xr(this.low&i.low,this.high&i.high,this.unsigned)};Be.or=function(i){return $n(i)||(i=Sl(i)),xr(this.low|i.low,this.high|i.high,this.unsigned)};Be.xor=function(i){return $n(i)||(i=Sl(i)),xr(this.low^i.low,this.high^i.high,this.unsigned)};Be.shiftLeft=function(i){return $n(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?xr(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):xr(0,this.low<<i-32,this.unsigned)};Be.shl=Be.shiftLeft;Be.shiftRight=function(i){return $n(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?xr(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):xr(this.high>>i-32,this.high>=0?0:-1,this.unsigned)};Be.shr=Be.shiftRight;Be.shiftRightUnsigned=function(i){return $n(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?xr(this.low>>>i|this.high<<32-i,this.high>>>i,this.unsigned):i===32?xr(this.high,0,this.unsigned):xr(this.high>>>i-32,0,this.unsigned)};Be.shru=Be.shiftRightUnsigned;Be.shr_u=Be.shiftRightUnsigned;Be.rotateLeft=function(i){var t;return $n(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?xr(this.high,this.low,this.unsigned):i<32?(t=32-i,xr(this.low<<i|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)):(i-=32,t=32-i,xr(this.high<<i|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned))};Be.rotl=Be.rotateLeft;Be.rotateRight=function(i){var t;return $n(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?xr(this.high,this.low,this.unsigned):i<32?(t=32-i,xr(this.high<<t|this.low>>>i,this.low<<t|this.high>>>i,this.unsigned)):(i-=32,t=32-i,xr(this.low<<t|this.high>>>i,this.high<<t|this.low>>>i,this.unsigned))};Be.rotr=Be.rotateRight;Be.toSigned=function(){return this.unsigned?xr(this.low,this.high,!1):this};Be.toUnsigned=function(){return this.unsigned?this:xr(this.low,this.high,!0)};Be.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()};Be.toBytesLE=function(){var i=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,i&255,i>>>8&255,i>>>16&255,i>>>24]};Be.toBytesBE=function(){var i=this.high,t=this.low;return[i>>>24,i>>>16&255,i>>>8&255,i&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};jr.fromBytes=function(i,t,e){return e?jr.fromBytesLE(i,t):jr.fromBytesBE(i,t)};jr.fromBytesLE=function(i,t){return new jr(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,t)};jr.fromBytesBE=function(i,t){return new jr(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],t)};const zj=16;function rE(i){i==="X"&&(i="");const t=i.padEnd(zj,"0");return jr.fromString(t,!0,16)}function Uj(i){if(i.isZero())return"X";let t=i.countTrailingZeros();const e=t%4;t=(t-e)/4;const r=t;t*=4;const s=i.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-r-s.length).join("0")+s}function jj(i,t){const e=Gj(i).shiftRightUnsigned(2);return i.add(jr.fromNumber(2*t+1-4).multiply(e))}function Gj(i){return i.and(i.not().add(1))}const Vj=3,qj=30,Hj=2*qj+1,b5=180/Math.PI;function Wj(i){if(i.length===0)throw new Error("Invalid Hilbert quad key ".concat(i));const t=i.split("/"),e=parseInt(t[0],10),r=t[1],s=r.length;let n=0;const c=[0,0];for(let l=s-1;l>=0;l--){n=s-l;const f=r[l];let y=0,A=0;f==="1"?A=1:f==="2"?(y=1,A=1):f==="3"&&(y=1);const T=Math.pow(2,n-1);Xj(T,c,y,A),c[0]+=T*y,c[1]+=T*A}if(e%2===1){const l=c[0];c[0]=c[1],c[1]=l}return{face:e,ij:c,level:n}}function Jj(i){if(i.isZero())return"";let t=i.toString(2);for(;t.length<Vj+Hj;)t="0"+t;const e=t.lastIndexOf("1"),r=t.substring(0,3),s=t.substring(3,e),n=s.length/2,c=jr.fromString(r,!0,2).toString(10);let l="";if(n!==0)for(l=jr.fromString(s,!0,2).toString(4);l.length<n;)l="0"+l;return"".concat(c,"/").concat(l)}function sE(i,t,e){const r=1<<t;return[(i[0]+e[0])/r,(i[1]+e[1])/r]}function w5(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function nE(i){return[w5(i[0]),w5(i[1])]}function oE(i,t){let[e,r]=t;switch(i){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function aE(i){let[t,e,r]=i;const s=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*b5,s*b5]}function Xj(i,t,e,r){if(r===0){e===1&&(t[0]=i-1-t[0],t[1]=i-1-t[1]);const s=t[0];t[0]=t[1],t[1]=s}}function Zj(i){const t=sE(i.ij,i.level,[.5,.5]),e=nE(t),r=oE(i.face,e);return aE(r)}const $j=100;function x5(i){const{face:t,ij:e,level:r}=i,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil($j*Math.pow(2,-r))),c=new Float64Array(4*n*2+2);let l=0,f=0;for(let y=0;y<4;y++){const A=s[y].slice(0),T=s[y+1],P=(T[0]-A[0])/n,L=(T[1]-A[1])/n;for(let D=0;D<n;D++){A[0]+=P,A[1]+=L;const j=sE(e,r,A),X=nE(j),Z=oE(t,X),$=aE(Z);Math.abs($[1])>89.999&&($[0]=f);const ht=$[0]-f;$[0]+=ht>180?-360:ht<-180?360:0,c[l++]=$[0],c[l++]=$[1],f=$[0]}}return c[l++]=c[0],c[l++]=c[1],c}function xv(i){const t=Yj(i);return Wj(t)}function Yj(i){if(i.indexOf("/")>0)return i;const t=rE(i);return Jj(t)}function Kj(i){const t=xv(i);return Zj(t)}function Qj(i){let t;if(i.face===2||i.face===5){let e=null,r=0;for(let s=0;s<4;s++){const n="".concat(i.face,"/").concat(s),c=xv(n),l=x5(c);(typeof e>"u"||e===null)&&(e=new Float64Array(4*l.length)),e.set(l,r),r+=l.length}t=A5(e)}else{const e=x5(i);t=A5(e)}return t}function A5(i){if(i.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let r=0;r<i.length;r+=2)t.push(i[r]),e.push(i[r+1]);return t.sort((r,s)=>r-s),e.sort((r,s)=>r-s),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function tG(i,t){const e=(t==null?void 0:t.minimumHeight)||0,r=(t==null?void 0:t.maximumHeight)||0,s=xv(i),n=Qj(s),c=n.west,l=n.south,f=n.east,y=n.north,A=[];return A.push(new te(c,y,e)),A.push(new te(f,y,e)),A.push(new te(f,l,e)),A.push(new te(c,l,e)),A.push(new te(c,y,r)),A.push(new te(f,y,r)),A.push(new te(f,l,r)),A.push(new te(c,l,r)),A}function lE(i){const t=i.token,e={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},r=tG(t,e),s=Kj(t),n=s[0],c=s[1],l=gs.WGS84.cartographicToCartesian([n,c,e.maximumHeight]),f=new te(l[0],l[1],l[2]);r.push(f);const y=TD(r);return[...y.center,...y.halfAxes]}const eG=4,iG=8,rG={QUADTREE:eG,OCTREE:iG};function sG(i,t,e){if(i!=null&&i.box){const r=rE(i.s2VolumeInfo.token),s=jj(r,t),n=Uj(s),c={...i.s2VolumeInfo};switch(c.token=n,e){case"OCTREE":const l=i.s2VolumeInfo,f=l.maximumHeight-l.minimumHeight,y=f/2,A=l.minimumHeight+f/2;l.minimumHeight=A-y,l.maximumHeight=A+y;break}return{box:lE(c),s2VolumeInfo:c}}}async function cE(i){const{options:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:s={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:n}=i;let{subtree:c,level:l=0}=i;const{subdivisionScheme:f,subtreeLevels:y,maximumLevel:A,contentUrlTemplate:T,subtreesUriTemplate:P,basePath:L}=t,D={children:[],lodMetricValue:0,contentUrl:""},j=rG[f],X=r&1,Z=r>>1&1,$=r>>2&1,ht=(j**l-1)/(j-1);let _t=yu(e.mortonIndex,r),Mt=ht+_t,Nt=yu(e.x,X),Rt=yu(e.y,Z),xt=yu(e.z,$),qt=!1;l+1>y&&(qt=Ny(c.childSubtreeAvailability,_t));const zt=yu(s.x,Nt),ct=yu(s.y,Rt),pt=yu(s.z,xt),Bt=l+s.level;if(qt){const oe="".concat(L,"/").concat(P),le=G1(oe,Bt,zt,ct,pt);c=await Wh(le,KS),s.mortonIndex=_t,s.x=Nt,s.y=Rt,s.z=xt,s.level=l,_t=0,Mt=0,Nt=0,Rt=0,xt=0,l=0}if(!Ny(c.tileAvailability,Mt)||l>A)return D;Ny(c.contentAvailability,Mt)&&(D.contentUrl=G1(T,Bt,zt,ct,pt));const bt=l+1,ne={mortonIndex:_t,x:Nt,y:Rt,z:xt};for(let oe=0;oe<j;oe++){const le=sG(n,oe,f),Qt=await cE({subtree:c,options:t,parentData:ne,childIndex:oe,level:bt,globalData:s,s2VolumeBox:le});if(Qt.contentUrl||Qt.children.length){const fe=Bt+1,de=nG(Qt,fe,{childTileX:Nt,childTileY:Rt,childTileZ:xt},t,n);D.children.push(de)}}return D}function Ny(i,t){return"constant"in i?!!i.constant:i.explicitBitstream?lG(t,i.explicitBitstream):!1}function nG(i,t,e,r,s){const{basePath:n,refine:c,getRefine:l,lodMetricType:f,getTileType:y,rootLodMetricValue:A,rootBoundingVolume:T}=r,P=i.contentUrl&&i.contentUrl.replace("".concat(n,"/"),""),L=A/2**t,D=s!=null&&s.box?{box:s.box}:T,j=oG(t,D,e);return{children:i.children,contentUrl:i.contentUrl,content:{uri:P},id:i.contentUrl,refine:l(c),type:y(i),lodMetricType:f,lodMetricValue:L,geometricError:L,transform:i.transform,boundingVolume:j}}function oG(i,t,e){if(t.region){const{childTileX:r,childTileY:s,childTileZ:n}=e,[c,l,f,y,A,T]=t.region,P=2**i,L=(f-c)/P,D=(y-l)/P,j=(T-A)/P,[X,Z]=[c+L*r,c+L*(r+1)],[$,ht]=[l+D*s,l+D*(s+1)],[_t,Mt]=[A+j*n,A+j*(n+1)];return{region:[X,$,Z,ht,_t,Mt]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function yu(i,t){return parseInt(i.toString(2)+t.toString(2),2)}function G1(i,t,e,r,s){const n=aG({level:t,x:e,y:r,z:s});return i.replace(/{level}|{x}|{y}|{z}/gi,c=>n[c])}function aG(i){const t={};for(const e in i)t["{".concat(e,"}")]=i[e];return t}function lG(i,t){const e=Math.floor(i/8),r=i%8;return(t[e]>>r&1)===1}function Av(i){if(!i.contentUrl)return Md.EMPTY;const t=i.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return Md.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Md.SCENEGRAPH;default:return t}}function Sv(i){switch(i){case"REPLACE":case"replace":return Hc.REPLACE;case"ADD":case"add":return Hc.ADD;default:return i}}function V1(i,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const e=new URL(i,"".concat(t,"/"));return decodeURI(e.toString())}else if(i.startsWith("/"))return i;return"".concat(t,"/").concat(i)}function S5(i,t){if(!i)return null;if(i.content){const e=i.content.uri||i.content.url;i.contentUrl=V1(e,t.basePath)}return i.id=i.contentUrl,i.lodMetricType=Um.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform,i.type=Av(i),i.refine=Sv(i.refine),i}async function cG(i,t){const e=i.basePath;let r;const s=C5(i==null?void 0:i.root);s&&i.root?r=await E5(i.root,i,s,t):r=S5(i.root,i);const n=[];for(n.push(r);n.length>0;){const c=(n.pop()||{}).children||[];for(let l of c){const f=C5(l);f?l=await E5(l,i,f,t):S5(l,{basePath:e}),n.push(l)}}return r}async function E5(i,t,e,r){var s,n;const c=t.basePath,{subdivisionScheme:l,maximumLevel:f,subtreeLevels:y,subtrees:{uri:A}}=e,T=G1(A,0,0,0,0),P=V1(T,c),L=await Wh(P,KS,r),D=V1(i.content.uri,c),j=t==null||(s=t.root)===null||s===void 0?void 0:s.refine,X=i.geometricError,Z=(n=i.boundingVolume.extensions)===null||n===void 0?void 0:n["3DTILES_bounding_volume_S2"];if(Z){const _t={box:lE(Z),s2VolumeInfo:Z};i.boundingVolume=_t}const $=i.boundingVolume,ht={contentUrlTemplate:D,subtreesUriTemplate:A,subdivisionScheme:l,subtreeLevels:y,maximumLevel:f,refine:j,basePath:c,lodMetricType:Um.GEOMETRIC_ERROR,rootLodMetricValue:X,rootBoundingVolume:$,getTileType:Av,getRefine:Sv};return await hG(i,L,ht)}async function hG(i,t,e){if(!i)return null;i.lodMetricType=Um.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform;const{children:r,contentUrl:s}=await cE({subtree:t,options:e,s2VolumeBox:i});return s&&(i.contentUrl=s,i.content={uri:s.replace("".concat(e.basePath,"/"),"")}),i.refine=Sv(i.refine),i.type=Av(i),i.children=r,i.id=i.contentUrl,i}function C5(i){var t;return(i==null||(t=i.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(i==null?void 0:i.implicitTiling)}const Ev={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:qS,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:fG,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function uG(i){return __(i.url)}async function dG(i,t,e){const r={content:{featureIds:null}};return await YS(i,0,t,e,r.content),r.content}async function pG(i,t,e){var r;const s=JSON.parse(new TextDecoder().decode(i));return s.loader=t.loader||Ev,s.url=e.url,s.queryString=e.queryString,s.basePath=uG(s),s.root=await cG(s,t),s.type=Va.TILES3D,s.lodMetricType=Um.GEOMETRIC_ERROR,s.lodMetricValue=((r=s.root)===null||r===void 0?void 0:r.lodMetricValue)||0,s}async function fG(i,t,e){const r=t["3d-tiles"]||{};let s;return r.isTileset==="auto"?s=e.url&&e.url.indexOf(".json")!==-1:s=r.isTileset,s?i=await pG(i,t,e):i=await dG(i,t,e),i}const T5=[0],gG={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Ev,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,t,e)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class Cv extends uS{constructor(){super(...arguments),H(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&fr.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,e;return!!(!((t=this.state)===null||t===void 0||(e=t.tileset3d)===null||e===void 0)&&e.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){let{props:e,oldProps:r,changeFlags:s}=t;if(e.data&&e.data!==r.data&&this._loadTileset(e.data),s.viewportChanged){const{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(s.propsChanged){const{layerMap:n}=this.state;for(const c in n)n[c].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:r}=this.state;this.internalState.viewport=t,e[t.id]=t;const s=r==null?void 0:r[t.id];(!s||!t.equals(s))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:e,sourceLayer:r}=t;const s=r&&r.props.tile;return e.picked&&(e.object=s),e.sourceTile=s,e}filterSubLayer(t){let{layer:e,viewport:r}=t;const{tile:s}=e.props,{id:n}=r;return s.selected&&s.viewportIds.includes(n)}_updateAutoHighlight(t){const e=t.sourceTile,r=this.state.layerMap[e==null?void 0:e.id];r&&r.layer&&r.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const s={loadOptions:{...e}};let n=t;if(r.preload){const f=await r.preload(t,e);f.url&&(n=f.url),f.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:f.headers}),Object.assign(s,f)}const c=await Wh(n,r,s.loadOptions),l=new XU(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:l,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(l)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:r}=this.context,s=Object.keys(t).length;!r||!s||!e||e.selectTiles(Object.values(t)).then(n=>{this.state.frameNumber!==n&&this.setState({frameNumber:n})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case Md.POINTCLOUD:return this._makePointCloudLayer(t,e);case Md.SCENEGRAPH:return this._make3DModelLayer(t);case Md.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:r,pointCount:s,constantRGBA:n,cartographicOrigin:c,modelMatrix:l}=t.content,{positions:f,normals:y,colors:A}=r;if(!f)return null;const T=e&&e.props.data||{header:{vertexCount:s},attributes:{POSITION:f,NORMAL:y,COLOR_0:A}},{pointSize:P,getPointColor:L}=this.props,D=this.getSubLayerClass("pointcloud",lv);return new D({pointSize:P},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:T,coordinateSystem:lr.METER_OFFSETS,coordinateOrigin:c,modelMatrix:l,getColor:n||L,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:r,cartographicOrigin:s,modelMatrix:n}=t.content,c=this.getSubLayerClass("scenegraph",mv);return new c({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:r||T5,scenegraph:e,coordinateSystem:lr.METER_OFFSETS,coordinateOrigin:s,modelMatrix:n,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const r=t.content,{attributes:s,indices:n,modelMatrix:c,cartographicOrigin:l,coordinateSystem:f=lr.METER_OFFSETS,material:y,featureIds:A}=r,{_getMeshColor:T}=this.props,P=e&&e.props.mesh||new Qp({drawMode:4,attributes:mG(s),indices:n}),L=this.getSubLayerClass("mesh",yv);return new L(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:P,data:T5,getColor:T(t),pbrMaterial:y,modelMatrix:c,coordinateOrigin:l,coordinateSystem:f,featureIds:A,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(r=>{const s=e[r.id]=e[r.id]||{tile:r};let{layer:n}=s;return r.selected&&(n?s.needsUpdate&&(n=this._getSubLayer(r,n),s.needsUpdate=!1):n=this._getSubLayer(r)),s.layer=n,n}).filter(Boolean):null}}H(Cv,"defaultProps",gG);H(Cv,"layerName","Tile3DLayer");function mG(i){const t={};return t.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(t.normals=i.normals),i.texCoords&&(t.texCoords=i.texCoords),i.colors&&(t.colors=i.colors),i.uvRegions&&(t.uvRegions=i.uvRegions),t}var yG=Object.defineProperty,_G=(i,t,e)=>t in i?yG(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,wr=(i,t,e)=>(_G(i,typeof t!="symbol"?t+"":t,e),e);class vG{constructor(t){wr(this,"map"),wr(this,"width"),wr(this,"height"),wr(this,"svgCanvas"),wr(this,"xLine"),wr(this,"yLine"),wr(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,e;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(e=this.map)==null?void 0:e.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,e=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${e}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${e}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="relative",e.setAttribute("width",`${this.width}px`),e.setAttribute("height",`${this.height}px`);const r=this.width/2,s=this.height/2;this.yLine=e.appendChild(this.createLine(r,0,r,this.height,this.color,"2px")),this.xLine=e.appendChild(this.createLine(0,s,this.width,s,this.color,"2px")),t==null||t.appendChild(e),this.svgCanvas=e}}createLine(t,e,r,s,n,c){const l=document.createElementNS("http://www.w3.org/2000/svg","line");return l.setAttribute("x1",t),l.setAttribute("y1",e),l.setAttribute("x2",r),l.setAttribute("y2",s),l.setAttribute("stroke-dasharray","5,5"),l.setAttribute("stroke",n),l.setAttribute("stroke-width",c),l}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const q1={72:72,96:96,200:200,300:300,400:400},zc={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},Wp={Landscape:"landscape",Portrait:"portrait"},Cu={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Jd={in:"in",mm:"mm"};class bG{constructor(t){wr(this,"map"),wr(this,"width"),wr(this,"height"),wr(this,"unit"),wr(this,"svgCanvas"),wr(this,"svgPath");var e,r,s;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const n=(e=this.map)==null?void 0:e.getCanvas().clientWidth,c=(r=this.map)==null?void 0:r.getCanvas().clientHeight,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.setAttribute("width",`${n}px`),l.setAttribute("height",`${c}px`);const f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("style","fill:#888888;stroke-width:0"),f.setAttribute("fill-opacity","0.5"),l.append(f),(s=this.map)==null||s.getCanvasContainer().appendChild(l),this.svgCanvas=l,this.svgPath=f}mapResize(){this.generateCutOut()}updateArea(t,e){this.width=t,this.height=e,this.unit=Jd.mm,this.generateCutOut()}generateCutOut(){var t,e;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const r=this.toPixels(this.width),s=this.toPixels(this.height),n=(t=this.map)==null?void 0:t.getCanvas().clientWidth,c=(e=this.map)==null?void 0:e.getCanvas().clientHeight,l=n/2-r/2,f=l+r,y=c/2-s/2,A=y+s;this.svgCanvas.setAttribute("width",`${n}px`),this.svgCanvas.setAttribute("height",`${c}px`),this.svgPath.setAttribute("d",`M 0 0 L ${n} 0 L ${n} ${c} L 0 ${c} M ${l} ${y} L ${l} ${A} L ${f} ${A} L ${f} ${y}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Jd.mm&&(e/=25.4),e*t}}const hE={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},wG={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"Français",LanguageCode:"fr"},xG={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},AG={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},SG={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},EG={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Española",LanguageCode:"es"},CG={PageSize:"Mida",PageOrientation:"Orientació",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},TG={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Tiếng Việt",LanguageCode:"vi"},PG={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"українська",LanguageCode:"uk"},IG={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"简体字",LanguageCode:"zhHans"},LG={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"繁体字",LanguageCode:"zhHant"},MG={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"日本語",LanguageCode:"ja"},BG={PageSize:"Tamanho da página",PageOrientation:"Orientação da página",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Português",LanguageCode:"pt"},RG=[hE,wG,xG,AG,SG,EG,CG,TG,PG,IG,LG,MG,BG],kG=i=>RG.find(t=>t.LanguageCode===i)??hE;(function(i){var t={};function e(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return i[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=i,e.c=t,e.d=function(r,s,n){e.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:n})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,s){if(1&s&&(r=e(r)),8&s||4&s&&typeof r=="object"&&r&&r.__esModule)return r;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&s&&typeof r!="string")for(var c in r)e.d(n,c,(function(l){return r[l]}).bind(null,c));return n},e.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(s,"a",s),s},e.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},e.p="",e(e.s=0)})([function(i,t,e){i.exports=e(1)},function(i,t){function e(s,n){for(var c=0;c<n.length;c++){var l=n[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}var r=function(){function s(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,s),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var n,c;return n=s,(c=[{key:"show",value:function(l){this.setOptions(l),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var l=document.getElementById("loading-overlay-stylesheet");l&&(l.disabled=!0,l.parentNode.removeChild(l),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(l){if(l!==void 0)for(var f in l)this.options[f]=l[f]}},{key:"generateAndAddOverlayElement",value:function(){var l="50%";this.options.offsetX!==0&&(l="calc(50% + "+this.options.offsetX+")");var f="50%";if(this.options.offsetY!==0&&(f="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var y='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(f,"; left: ").concat(l,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),A=document.getElementById(this.options.containerID);return A.style.position="relative",void A.insertAdjacentHTML("beforeend",y)}var T='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(f,"; left: ").concat(l,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",T)}},{key:"generateSpinnerElement",value:function(){var l=this,f=Object.keys(this.numberOfEmptyDivForSpinner).find(function(A){return A===l.options.spinnerIcon}),y=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[f]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(y,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var l=document.createElement("link");l.setAttribute("id","loading-overlay-stylesheet"),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(l)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(l){for(var f="",y=1;y<=l;y++)f+="<div></div>";return f}}])&&e(n.prototype,c),s}();window.JsLoadingOverlay=new r,i.exports=JsLoadingOverlay}]);function Ur(i){"@babel/helpers - typeof";return Ur=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ur(i)}var jo=Uint8Array,bo=Uint16Array,ff=Uint32Array,Vm=new jo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),qm=new jo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),H1=new jo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),uE=function(i,t){for(var e=new bo(31),r=0;r<31;++r)e[r]=t+=1<<i[r-1];for(var s=new ff(e[30]),r=1;r<30;++r)for(var n=e[r];n<e[r+1];++n)s[n]=n-e[r]<<5|r;return[e,s]},dE=uE(Vm,2),pE=dE[0],W1=dE[1];pE[28]=258,W1[258]=28;var fE=uE(qm,0),OG=fE[0],P5=fE[1],J1=new bo(32768);for(var as=0;as<32768;++as){var Fh=(as&43690)>>>1|(as&21845)<<1;Fh=(Fh&52428)>>>2|(Fh&13107)<<2,Fh=(Fh&61680)>>>4|(Fh&3855)<<4,J1[as]=((Fh&65280)>>>8|(Fh&255)<<8)>>>1}var uc=function(i,t,e){for(var r=i.length,s=0,n=new bo(t);s<r;++s)++n[i[s]-1];var c=new bo(t);for(s=0;s<t;++s)c[s]=c[s-1]+n[s-1]<<1;var l;if(e){l=new bo(1<<t);var f=15-t;for(s=0;s<r;++s)if(i[s])for(var y=s<<4|i[s],A=t-i[s],T=c[i[s]-1]++<<A,P=T|(1<<A)-1;T<=P;++T)l[J1[T]>>>f]=y}else for(l=new bo(r),s=0;s<r;++s)l[s]=J1[c[i[s]-1]++]>>>15-i[s];return l},Xh=new jo(288);for(var as=0;as<144;++as)Xh[as]=8;for(var as=144;as<256;++as)Xh[as]=9;for(var as=256;as<280;++as)Xh[as]=7;for(var as=280;as<288;++as)Xh[as]=8;var gf=new jo(32);for(var as=0;as<32;++as)gf[as]=5;var FG=uc(Xh,9,0),NG=uc(Xh,9,1),DG=uc(gf,5,0),zG=uc(gf,5,1),Dy=function(i){for(var t=i[0],e=1;e<i.length;++e)i[e]>t&&(t=i[e]);return t},pl=function(i,t,e){var r=t/8>>0;return(i[r]|i[r+1]<<8)>>>(t&7)&e},zy=function(i,t){var e=t/8>>0;return(i[e]|i[e+1]<<8|i[e+2]<<16)>>>(t&7)},Tv=function(i){return(i/8>>0)+(i&7&&1)},gE=function(i,t,e){(e==null||e>i.length)&&(e=i.length);var r=new(i instanceof bo?bo:i instanceof ff?ff:jo)(e-t);return r.set(i.subarray(t,e)),r},UG=function(i,t,e){var r=i.length,s=!t||e,n=!e||e.i;e||(e={}),t||(t=new jo(r*3));var c=function(Wt){var $t=t.length;if(Wt>$t){var ee=new jo(Math.max($t*2,Wt));ee.set(t),t=ee}},l=e.f||0,f=e.p||0,y=e.b||0,A=e.l,T=e.d,P=e.m,L=e.n,D=r*8;do{if(!A){e.f=l=pl(i,f,1);var j=pl(i,f+1,3);if(f+=3,j)if(j==1)A=NG,T=zG,P=9,L=5;else if(j==2){var X=pl(i,f,31)+257,Z=pl(i,f+10,15)+4,$=X+pl(i,f+5,31)+1;f+=14;for(var ht=new jo($),_t=new jo(19),Mt=0;Mt<Z;++Mt)_t[H1[Mt]]=pl(i,f+Mt*3,7);f+=Z*3;var Nt=Dy(_t),Rt=(1<<Nt)-1;if(!n&&f+$*(Nt+7)>D)break;for(var xt=uc(_t,Nt,1),Mt=0;Mt<$;){var qt=xt[pl(i,f,Rt)];f+=qt&15;var zt=qt>>>4;if(zt<16)ht[Mt++]=zt;else{var ct=0,pt=0;for(zt==16?(pt=3+pl(i,f,3),f+=2,ct=ht[Mt-1]):zt==17?(pt=3+pl(i,f,7),f+=3):zt==18&&(pt=11+pl(i,f,127),f+=7);pt--;)ht[Mt++]=ct}}var Bt=ht.subarray(0,X),bt=ht.subarray(X);P=Dy(Bt),L=Dy(bt),A=uc(Bt,P,1),T=uc(bt,L,1)}else throw"invalid block type";else{var zt=Tv(f)+4,ne=i[zt-4]|i[zt-3]<<8,oe=zt+ne;if(oe>r){if(n)throw"unexpected EOF";break}s&&c(y+ne),t.set(i.subarray(zt,oe),y),e.b=y+=ne,e.p=f=oe*8;continue}if(f>D)throw"unexpected EOF"}s&&c(y+131072);for(var le=(1<<P)-1,Qt=(1<<L)-1,fe=P+L+18;n||f+fe<D;){var ct=A[zy(i,f)&le],de=ct>>>4;if(f+=ct&15,f>D)throw"unexpected EOF";if(!ct)throw"invalid length/literal";if(de<256)t[y++]=de;else if(de==256){A=null;break}else{var Me=de-254;if(de>264){var Mt=de-257,nt=Vm[Mt];Me=pl(i,f,(1<<nt)-1)+pE[Mt],f+=nt}var Et=T[zy(i,f)&Qt],Lt=Et>>>4;if(!Et)throw"invalid distance";f+=Et&15;var bt=OG[Lt];if(Lt>3){var nt=qm[Lt];bt+=zy(i,f)&(1<<nt)-1,f+=nt}if(f>D)throw"unexpected EOF";s&&c(y+131072);for(var Gt=y+Me;y<Gt;y+=4)t[y]=t[y-bt],t[y+1]=t[y+1-bt],t[y+2]=t[y+2-bt],t[y+3]=t[y+3-bt];y=Gt}}e.l=A,e.p=f,e.b=y,A&&(l=1,e.m=P,e.d=T,e.n=L)}while(!l);return y==t.length?t:gE(t,0,y)},Nc=function(i,t,e){e<<=t&7;var r=t/8>>0;i[r]|=e,i[r+1]|=e>>>8},zp=function(i,t,e){e<<=t&7;var r=t/8>>0;i[r]|=e,i[r+1]|=e>>>8,i[r+2]|=e>>>16},Uy=function(i,t){for(var e=[],r=0;r<i.length;++r)i[r]&&e.push({s:r,f:i[r]});var s=e.length,n=e.slice();if(!s)return[new jo(0),0];if(s==1){var c=new jo(e[0].s+1);return c[e[0].s]=1,[c,1]}e.sort(function(Mt,Nt){return Mt.f-Nt.f}),e.push({s:-1,f:25001});var l=e[0],f=e[1],y=0,A=1,T=2;for(e[0]={s:-1,f:l.f+f.f,l,r:f};A!=s-1;)l=e[e[y].f<e[T].f?y++:T++],f=e[y!=A&&e[y].f<e[T].f?y++:T++],e[A++]={s:-1,f:l.f+f.f,l,r:f};for(var P=n[0].s,r=1;r<s;++r)n[r].s>P&&(P=n[r].s);var L=new bo(P+1),D=X1(e[A-1],L,0);if(D>t){var r=0,j=0,X=D-t,Z=1<<X;for(n.sort(function(Nt,Rt){return L[Rt.s]-L[Nt.s]||Nt.f-Rt.f});r<s;++r){var $=n[r].s;if(L[$]>t)j+=Z-(1<<D-L[$]),L[$]=t;else break}for(j>>>=X;j>0;){var ht=n[r].s;L[ht]<t?j-=1<<t-L[ht]++-1:++r}for(;r>=0&&j;--r){var _t=n[r].s;L[_t]==t&&(--L[_t],++j)}D=t}return[new jo(L),D]},X1=function(i,t,e){return i.s==-1?Math.max(X1(i.l,t,e+1),X1(i.r,t,e+1)):t[i.s]=e},I5=function(i){for(var t=i.length;t&&!i[--t];);for(var e=new bo(++t),r=0,s=i[0],n=1,c=function(f){e[r++]=f},l=1;l<=t;++l)if(i[l]==s&&l!=t)++n;else{if(!s&&n>2){for(;n>138;n-=138)c(32754);n>2&&(c(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(c(s),--n;n>6;n-=6)c(8304);n>2&&(c(n-3<<5|8208),n=0)}for(;n--;)c(s);n=1,s=i[l]}return[e.subarray(0,r),t]},Up=function(i,t){for(var e=0,r=0;r<t.length;++r)e+=i[r]*t[r];return e},Z1=function(i,t,e){var r=e.length,s=Tv(t+2);i[s]=r&255,i[s+1]=r>>>8,i[s+2]=i[s]^255,i[s+3]=i[s+1]^255;for(var n=0;n<r;++n)i[s+n+4]=e[n];return(s+4+r)*8},L5=function(i,t,e,r,s,n,c,l,f,y,A){Nc(t,A++,e),++s[256];for(var T=Uy(s,15),P=T[0],L=T[1],D=Uy(n,15),j=D[0],X=D[1],Z=I5(P),$=Z[0],ht=Z[1],_t=I5(j),Mt=_t[0],Nt=_t[1],Rt=new bo(19),xt=0;xt<$.length;++xt)Rt[$[xt]&31]++;for(var xt=0;xt<Mt.length;++xt)Rt[Mt[xt]&31]++;for(var qt=Uy(Rt,7),zt=qt[0],ct=qt[1],pt=19;pt>4&&!zt[H1[pt-1]];--pt);var Bt=y+5<<3,bt=Up(s,Xh)+Up(n,gf)+c,ne=Up(s,P)+Up(n,j)+c+14+3*pt+Up(Rt,zt)+(2*Rt[16]+3*Rt[17]+7*Rt[18]);if(Bt<=bt&&Bt<=ne)return Z1(t,A,i.subarray(f,f+y));var oe,le,Qt,fe;if(Nc(t,A,1+(ne<bt)),A+=2,ne<bt){oe=uc(P,L,0),le=P,Qt=uc(j,X,0),fe=j;var de=uc(zt,ct,0);Nc(t,A,ht-257),Nc(t,A+5,Nt-1),Nc(t,A+10,pt-4),A+=14;for(var xt=0;xt<pt;++xt)Nc(t,A+3*xt,zt[H1[xt]]);A+=3*pt;for(var Me=[$,Mt],nt=0;nt<2;++nt)for(var Et=Me[nt],xt=0;xt<Et.length;++xt){var Lt=Et[xt]&31;Nc(t,A,de[Lt]),A+=zt[Lt],Lt>15&&(Nc(t,A,Et[xt]>>>5&127),A+=Et[xt]>>>12)}}else oe=FG,le=Xh,Qt=DG,fe=gf;for(var xt=0;xt<l;++xt)if(r[xt]>255){var Lt=r[xt]>>>18&31;zp(t,A,oe[Lt+257]),A+=le[Lt+257],Lt>7&&(Nc(t,A,r[xt]>>>23&31),A+=Vm[Lt]);var Gt=r[xt]&31;zp(t,A,Qt[Gt]),A+=fe[Gt],Gt>3&&(zp(t,A,r[xt]>>>5&8191),A+=qm[Gt])}else zp(t,A,oe[r[xt]]),A+=le[r[xt]];return zp(t,A,oe[256]),A+le[256]},jG=new ff([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),GG=function(i,t,e,r,s,n){var c=i.length,l=new jo(r+c+5*(1+Math.floor(c/7e3))+s),f=l.subarray(r,l.length-s),y=0;if(!t||c<8)for(var A=0;A<=c;A+=65535){var T=A+65535;T<c?y=Z1(f,y,i.subarray(A,T)):(f[A]=n,y=Z1(f,y,i.subarray(A,c)))}else{for(var P=jG[t-1],L=P>>>13,D=P&8191,j=(1<<e)-1,X=new bo(32768),Z=new bo(j+1),$=Math.ceil(e/3),ht=2*$,_t=function(Ze){return(i[Ze]^i[Ze+1]<<$^i[Ze+2]<<ht)&j},Mt=new ff(25e3),Nt=new bo(288),Rt=new bo(32),xt=0,qt=0,A=0,zt=0,ct=0,pt=0;A<c;++A){var Bt=_t(A),bt=A&32767,ne=Z[Bt];if(X[bt]=ne,Z[Bt]=bt,ct<=A){var oe=c-A;if((xt>7e3||zt>24576)&&oe>423){y=L5(i,f,0,Mt,Nt,Rt,qt,zt,pt,A-pt,y),zt=xt=qt=0,pt=A;for(var le=0;le<286;++le)Nt[le]=0;for(var le=0;le<30;++le)Rt[le]=0}var Qt=2,fe=0,de=D,Me=bt-ne&32767;if(oe>2&&Bt==_t(A-Me))for(var nt=Math.min(L,oe)-1,Et=Math.min(32767,A),Lt=Math.min(258,oe);Me<=Et&&--de&&bt!=ne;){if(i[A+Qt]==i[A+Qt-Me]){for(var Gt=0;Gt<Lt&&i[A+Gt]==i[A+Gt-Me];++Gt);if(Gt>Qt){if(Qt=Gt,fe=Me,Gt>nt)break;for(var Wt=Math.min(Me,Gt-2),$t=0,le=0;le<Wt;++le){var ee=A-Me+le+32768&32767,Kt=X[ee],Ce=ee-Kt+32768&32767;Ce>$t&&($t=Ce,ne=ee)}}}bt=ne,ne=X[bt],Me+=bt-ne+32768&32767}if(fe){Mt[zt++]=268435456|W1[Qt]<<18|P5[fe];var Ie=W1[Qt]&31,Re=P5[fe]&31;qt+=Vm[Ie]+qm[Re],++Nt[257+Ie],++Rt[Re],ct=A+Qt,++xt}else Mt[zt++]=i[A],++Nt[i[A]]}}y=L5(i,f,n,Mt,Nt,Rt,qt,zt,pt,A-pt,y)}return gE(l,0,r+Tv(y)+s)},VG=function(){var i=1,t=0;return{p:function(e){for(var r=i,s=t,n=e.length,c=0;c!=n;){for(var l=Math.min(c+5552,n);c<l;++c)r+=e[c],s+=r;r%=65521,s%=65521}i=r,t=s},d:function(){return(i>>>8<<16|(t&255)<<8|t>>>8)+((i&255)<<23)*2}}},qG=function(i,t,e,r,s){return GG(i,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+t.mem,e,r,!s)},HG=function(i,t,e){for(;e;++t)i[t]=e,e>>>=8},WG=function(i,t){var e=t.level,r=e==0?0:e<6?1:e==9?3:2;i[0]=120,i[1]=r<<6|(r?32-2*r:1)},JG=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function $1(i,t){t===void 0&&(t={});var e=VG();e.p(i);var r=qG(i,t,2,4);return WG(r,t),HG(r,r.length-4,e.d()),r}function XG(i,t){return UG((JG(i),i.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Ri=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function jy(){Ri.console&&typeof Ri.console.log=="function"&&Ri.console.log.apply(Ri.console,arguments)}var Yr={log:jy,warn:function(i){Ri.console&&(typeof Ri.console.warn=="function"?Ri.console.warn.apply(Ri.console,arguments):jy.call(null,arguments))},error:function(i){Ri.console&&(typeof Ri.console.error=="function"?Ri.console.error.apply(Ri.console,arguments):jy(i))}};function Gy(i,t,e){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){bu(r.response,t,e)},r.onerror=function(){Yr.error("could not download file")},r.send()}function M5(i){var t=new XMLHttpRequest;t.open("HEAD",i,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Fg(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(t)}}var ef,Y1,bu=Ri.saveAs||((typeof window>"u"?"undefined":Ur(window))!=="object"||window!==Ri?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,t,e){var r=Ri.URL||Ri.webkitURL,s=document.createElement("a");t=t||i.name||"download",s.download=t,s.rel="noopener",typeof i=="string"?(s.href=i,s.origin!==location.origin?M5(s.href)?Gy(i,t,e):Fg(s,s.target="_blank"):Fg(s)):(s.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(s.href)},4e4),setTimeout(function(){Fg(s)},0))}:"msSaveOrOpenBlob"in navigator?function(i,t,e){if(t=t||i.name||"download",typeof i=="string")if(M5(i))Gy(i,t,e);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){Fg(r)})}else navigator.msSaveOrOpenBlob(function(s,n){return n===void 0?n={autoBom:!1}:Ur(n)!=="object"&&(Yr.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}(i,e),t)}:function(i,t,e,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return Gy(i,t,e);var s=i.type==="application/octet-stream",n=/constructor/i.test(Ri.HTMLElement)||Ri.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&n)&&(typeof FileReader>"u"?"undefined":Ur(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var A=l.result;A=c?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=A:location=A,r=null},l.readAsDataURL(i)}else{var f=Ri.URL||Ri.webkitURL,y=f.createObjectURL(i);r?r.location=y:location.href=y,r=null,setTimeout(function(){f.revokeObjectURL(y)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function mE(i){var t;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],r=0;r<e.length;r++){var s=e[r].re,n=e[r].process,c=s.exec(i);c&&(t=n(c),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),f=this.g.toString(16),y=this.b.toString(16);return l.length==1&&(l="0"+l),f.length==1&&(f="0"+f),y.length==1&&(y="0"+y),"#"+l+f+y}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function Vy(i,t){var e=i[0],r=i[1],s=i[2],n=i[3];e=qn(e,r,s,n,t[0],7,-680876936),n=qn(n,e,r,s,t[1],12,-389564586),s=qn(s,n,e,r,t[2],17,606105819),r=qn(r,s,n,e,t[3],22,-1044525330),e=qn(e,r,s,n,t[4],7,-176418897),n=qn(n,e,r,s,t[5],12,1200080426),s=qn(s,n,e,r,t[6],17,-1473231341),r=qn(r,s,n,e,t[7],22,-45705983),e=qn(e,r,s,n,t[8],7,1770035416),n=qn(n,e,r,s,t[9],12,-1958414417),s=qn(s,n,e,r,t[10],17,-42063),r=qn(r,s,n,e,t[11],22,-1990404162),e=qn(e,r,s,n,t[12],7,1804603682),n=qn(n,e,r,s,t[13],12,-40341101),s=qn(s,n,e,r,t[14],17,-1502002290),e=Hn(e,r=qn(r,s,n,e,t[15],22,1236535329),s,n,t[1],5,-165796510),n=Hn(n,e,r,s,t[6],9,-1069501632),s=Hn(s,n,e,r,t[11],14,643717713),r=Hn(r,s,n,e,t[0],20,-373897302),e=Hn(e,r,s,n,t[5],5,-701558691),n=Hn(n,e,r,s,t[10],9,38016083),s=Hn(s,n,e,r,t[15],14,-660478335),r=Hn(r,s,n,e,t[4],20,-405537848),e=Hn(e,r,s,n,t[9],5,568446438),n=Hn(n,e,r,s,t[14],9,-1019803690),s=Hn(s,n,e,r,t[3],14,-187363961),r=Hn(r,s,n,e,t[8],20,1163531501),e=Hn(e,r,s,n,t[13],5,-1444681467),n=Hn(n,e,r,s,t[2],9,-51403784),s=Hn(s,n,e,r,t[7],14,1735328473),e=Wn(e,r=Hn(r,s,n,e,t[12],20,-1926607734),s,n,t[5],4,-378558),n=Wn(n,e,r,s,t[8],11,-2022574463),s=Wn(s,n,e,r,t[11],16,1839030562),r=Wn(r,s,n,e,t[14],23,-35309556),e=Wn(e,r,s,n,t[1],4,-1530992060),n=Wn(n,e,r,s,t[4],11,1272893353),s=Wn(s,n,e,r,t[7],16,-155497632),r=Wn(r,s,n,e,t[10],23,-1094730640),e=Wn(e,r,s,n,t[13],4,681279174),n=Wn(n,e,r,s,t[0],11,-358537222),s=Wn(s,n,e,r,t[3],16,-722521979),r=Wn(r,s,n,e,t[6],23,76029189),e=Wn(e,r,s,n,t[9],4,-640364487),n=Wn(n,e,r,s,t[12],11,-421815835),s=Wn(s,n,e,r,t[15],16,530742520),e=Jn(e,r=Wn(r,s,n,e,t[2],23,-995338651),s,n,t[0],6,-198630844),n=Jn(n,e,r,s,t[7],10,1126891415),s=Jn(s,n,e,r,t[14],15,-1416354905),r=Jn(r,s,n,e,t[5],21,-57434055),e=Jn(e,r,s,n,t[12],6,1700485571),n=Jn(n,e,r,s,t[3],10,-1894986606),s=Jn(s,n,e,r,t[10],15,-1051523),r=Jn(r,s,n,e,t[1],21,-2054922799),e=Jn(e,r,s,n,t[8],6,1873313359),n=Jn(n,e,r,s,t[15],10,-30611744),s=Jn(s,n,e,r,t[6],15,-1560198380),r=Jn(r,s,n,e,t[13],21,1309151649),e=Jn(e,r,s,n,t[4],6,-145523070),n=Jn(n,e,r,s,t[11],10,-1120210379),s=Jn(s,n,e,r,t[2],15,718787259),r=Jn(r,s,n,e,t[9],21,-343485551),i[0]=Gh(e,i[0]),i[1]=Gh(r,i[1]),i[2]=Gh(s,i[2]),i[3]=Gh(n,i[3])}function Hm(i,t,e,r,s,n){return t=Gh(Gh(t,i),Gh(r,n)),Gh(t<<s|t>>>32-s,e)}function qn(i,t,e,r,s,n,c){return Hm(t&e|~t&r,i,t,s,n,c)}function Hn(i,t,e,r,s,n,c){return Hm(t&r|e&~r,i,t,s,n,c)}function Wn(i,t,e,r,s,n,c){return Hm(t^e^r,i,t,s,n,c)}function Jn(i,t,e,r,s,n,c){return Hm(e^(t|~r),i,t,s,n,c)}function yE(i){var t,e=i.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=i.length;t+=64)Vy(r,ZG(i.substring(t-64,t)));i=i.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i.length;t++)s[t>>2]|=i.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(Vy(r,s),t=0;t<16;t++)s[t]=0;return s[14]=8*e,Vy(r,s),r}function ZG(i){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=i.charCodeAt(t)+(i.charCodeAt(t+1)<<8)+(i.charCodeAt(t+2)<<16)+(i.charCodeAt(t+3)<<24);return e}ef=Ri.atob.bind(Ri),Y1=Ri.btoa.bind(Ri);var B5="0123456789abcdef".split("");function $G(i){for(var t="",e=0;e<4;e++)t+=B5[i>>8*e+4&15]+B5[i>>8*e&15];return t}function YG(i){return String.fromCharCode((255&i)>>0,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function K1(i){return yE(i).map(YG).join("")}var KG=function(i){for(var t=0;t<i.length;t++)i[t]=$G(i[t]);return i.join("")}(yE("hello"))!="5d41402abc4b2a76b9719d911017c592";function Gh(i,t){if(KG){var e=(65535&i)+(65535&t);return(i>>16)+(t>>16)+(e>>16)<<16|65535&e}return i+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function Q1(i,t){var e,r,s,n;if(i!==e){for(var c=(s=i,n=1+(256/i.length>>0),new Array(n+1).join(s)),l=[],f=0;f<256;f++)l[f]=f;var y=0;for(f=0;f<256;f++){var A=l[f];y=(y+A+c.charCodeAt(f))%256,l[f]=l[y],l[y]=A}e=i,r=l}else l=r;var T=t.length,P=0,L=0,D="";for(f=0;f<T;f++)L=(L+(A=l[P=(P+1)%256]))%256,l[P]=l[L],l[L]=A,c=l[(l[P]+l[L])%256],D+=String.fromCharCode(t.charCodeAt(f)^c);return D}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var R5={print:4,modify:8,copy:16,"annot-forms":32};function vd(i,t,e,r){this.v=1,this.r=2;var s=192;i.forEach(function(l){if(R5.perm!==void 0)throw new Error("Invalid permission: "+l);s+=R5[l]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var n=(t+this.padding).substr(0,32),c=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(n,c),this.P=-(1+(255^s)),this.encryptionKey=K1(n+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=Q1(this.encryptionKey,this.padding)}function bd(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var t="",e=i.length,r=0;r<e;r++){var s=i.charCodeAt(r);s<33||s===35||s===37||s===40||s===41||s===47||s===60||s===62||s===91||s===93||s===123||s===125||s>126?t+="#"+("0"+s.toString(16)).slice(-2):t+=i[r]}return t}function k5(i){if(Ur(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,r,s){if(s=s||!1,typeof e!="string"||typeof r!="function"||typeof s!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var n=Math.random().toString(35);return t[e][n]=[r,!!s],n},this.unsubscribe=function(e){for(var r in t)if(t[r][e])return delete t[r][e],Object.keys(t[r]).length===0&&delete t[r],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var r=Array.prototype.slice.call(arguments,1),s=[];for(var n in t[e]){var c=t[e][n];try{c[0].apply(i,r)}catch(l){Ri.console&&Yr.error("jsPDF PubSub Error",l.message,l)}c[1]&&s.push(n)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function Tm(i){if(!(this instanceof Tm))return new Tm(i);var t="opacity,stroke-opacity".split(",");for(var e in i)i.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=i[e]);this.id="",this.objectNumber=-1}function _E(i,t){this.gState=i,this.matrix=t,this.id="",this.objectNumber=-1}function Au(i,t,e,r,s){if(!(this instanceof Au))return new Au(i,t,e,r,s);this.type=i==="axial"?2:3,this.coords=t,this.colors=e,_E.call(this,r,s)}function Cd(i,t,e,r,s){if(!(this instanceof Cd))return new Cd(i,t,e,r,s);this.boundingBox=i,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,_E.call(this,r,s)}function Bi(i){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],s=arguments[2],n=arguments[3],c=[],l=1,f=16,y="S",A=null;Ur(i=i||{})==="object"&&(e=i.orientation,r=i.unit||r,s=i.format||s,n=i.compress||i.compressPdf||n,(A=i.encryption||null)!==null&&(A.userPassword=A.userPassword||"",A.ownerPassword=A.ownerPassword||"",A.userPermissions=A.userPermissions||[]),l=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(t=i.precision),i.floatPrecision!==void 0&&(f=i.floatPrecision),y=i.defaultPathOperation||"S"),c=i.filters||(n===!0?["FlateEncode"]:c),r=r||"mm",e=(""+(e||"P")).toLowerCase();var T=i.putOnlyUsedFonts||!1,P={},L={internal:{},__private__:{}};L.__private__.PubSub=k5;var D="1.3",j=L.__private__.getPdfVersion=function(){return D};L.__private__.setPdfVersion=function(F){D=F};var X={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};L.__private__.getPageFormats=function(){return X};var Z=L.__private__.getPageFormat=function(F){return X[F]};s=s||"a4";var $={COMPAT:"compat",ADVANCED:"advanced"},ht=$.COMPAT;function _t(){this.saveGraphicsState(),ot(new St(De,0,0,-De,0,Ia()*De).toString()+" cm"),this.setFontSize(this.getFontSize()/De),y="n",ht=$.ADVANCED}function Mt(){this.restoreGraphicsState(),y="S",ht=$.COMPAT}var Nt=L.__private__.combineFontStyleAndFontWeight=function(F,et){if(F=="bold"&&et=="normal"||F=="bold"&&et==400||F=="normal"&&et=="italic"||F=="bold"&&et=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return et&&(F=et==400||et==="normal"?F==="italic"?"italic":"normal":et!=700&&et!=="bold"||F!=="normal"?(et==700?"bold":et)+""+F:"bold"),F};L.advancedAPI=function(F){var et=ht===$.COMPAT;return et&&_t.call(this),typeof F!="function"||(F(this),et&&Mt.call(this)),this},L.compatAPI=function(F){var et=ht===$.ADVANCED;return et&&Mt.call(this),typeof F!="function"||(F(this),et&&_t.call(this)),this},L.isAdvancedAPI=function(){return ht===$.ADVANCED};var Rt,xt=function(F){if(ht!==$.ADVANCED)throw new Error(F+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},qt=L.roundToPrecision=L.__private__.roundToPrecision=function(F,et){var Pt=t||et;if(isNaN(F)||isNaN(Pt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return F.toFixed(Pt).replace(/0+$/,"")};Rt=L.hpf=L.__private__.hpf=typeof f=="number"?function(F){if(isNaN(F))throw new Error("Invalid argument passed to jsPDF.hpf");return qt(F,f)}:f==="smart"?function(F){if(isNaN(F))throw new Error("Invalid argument passed to jsPDF.hpf");return qt(F,F>-1&&F<1?16:5)}:function(F){if(isNaN(F))throw new Error("Invalid argument passed to jsPDF.hpf");return qt(F,16)};var zt=L.f2=L.__private__.f2=function(F){if(isNaN(F))throw new Error("Invalid argument passed to jsPDF.f2");return qt(F,2)},ct=L.__private__.f3=function(F){if(isNaN(F))throw new Error("Invalid argument passed to jsPDF.f3");return qt(F,3)},pt=L.scale=L.__private__.scale=function(F){if(isNaN(F))throw new Error("Invalid argument passed to jsPDF.scale");return ht===$.COMPAT?F*De:ht===$.ADVANCED?F:void 0},Bt=function(F){return ht===$.COMPAT?Ia()-F:ht===$.ADVANCED?F:void 0},bt=function(F){return pt(Bt(F))};L.__private__.setPrecision=L.setPrecision=function(F){typeof parseInt(F,10)=="number"&&(t=parseInt(F,10))};var ne,oe="00000000000000000000000000000000",le=L.__private__.getFileId=function(){return oe},Qt=L.__private__.setFileId=function(F){return oe=F!==void 0&&/^[a-fA-F0-9]{32}$/.test(F)?F.toUpperCase():oe.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),A!==null&&(Qi=new vd(A.userPermissions,A.userPassword,A.ownerPassword,oe)),oe};L.setFileId=function(F){return Qt(F),this},L.getFileId=function(){return le()};var fe=L.__private__.convertDateToPDFDate=function(F){var et=F.getTimezoneOffset(),Pt=et<0?"+":"-",jt=Math.floor(Math.abs(et/60)),Yt=Math.abs(et%60),pe=[Pt,Lt(jt),"'",Lt(Yt),"'"].join("");return["D:",F.getFullYear(),Lt(F.getMonth()+1),Lt(F.getDate()),Lt(F.getHours()),Lt(F.getMinutes()),Lt(F.getSeconds()),pe].join("")},de=L.__private__.convertPDFDateToDate=function(F){var et=parseInt(F.substr(2,4),10),Pt=parseInt(F.substr(6,2),10)-1,jt=parseInt(F.substr(8,2),10),Yt=parseInt(F.substr(10,2),10),pe=parseInt(F.substr(12,2),10),Te=parseInt(F.substr(14,2),10);return new Date(et,Pt,jt,Yt,pe,Te,0)},Me=L.__private__.setCreationDate=function(F){var et;if(F===void 0&&(F=new Date),F instanceof Date)et=fe(F);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(F))throw new Error("Invalid argument passed to jsPDF.setCreationDate");et=F}return ne=et},nt=L.__private__.getCreationDate=function(F){var et=ne;return F==="jsDate"&&(et=de(ne)),et};L.setCreationDate=function(F){return Me(F),this},L.getCreationDate=function(F){return nt(F)};var Et,Lt=L.__private__.padd2=function(F){return("0"+parseInt(F)).slice(-2)},Gt=L.__private__.padd2Hex=function(F){return("00"+(F=F.toString())).substr(F.length)},Wt=0,$t=[],ee=[],Kt=0,Ce=[],Ie=[],Re=!1,Fe=ee,Ze=function(){Wt=0,Kt=0,ee=[],$t=[],Ce=[],si=qe(),Si=qe()};L.__private__.setCustomOutputDestination=function(F){Re=!0,Fe=F};var he=function(F){Re||(Fe=F)};L.__private__.resetCustomOutputDestination=function(){Re=!1,Fe=ee};var ot=L.__private__.out=function(F){return F=F.toString(),Kt+=F.length+1,Fe.push(F),Fe},mi=L.__private__.write=function(F){return ot(arguments.length===1?F.toString():Array.prototype.join.call(arguments," "))},ri=L.__private__.getArrayBuffer=function(F){for(var et=F.length,Pt=new ArrayBuffer(et),jt=new Uint8Array(Pt);et--;)jt[et]=F.charCodeAt(et);return Pt},_e=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];L.__private__.getStandardFonts=function(){return _e};var Se=i.fontSize||16;L.__private__.setFontSize=L.setFontSize=function(F){return Se=ht===$.ADVANCED?F/De:F,this};var Le,Ne=L.__private__.getFontSize=L.getFontSize=function(){return ht===$.COMPAT?Se:Se*De},ci=i.R2L||!1;L.__private__.setR2L=L.setR2L=function(F){return ci=F,this},L.__private__.getR2L=L.getR2L=function(){return ci};var Ei,Ci=L.__private__.setZoomMode=function(F){var et=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(F))Le=F;else if(isNaN(F)){if(et.indexOf(F)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+F+'" is not recognized.');Le=F}else Le=parseInt(F,10)};L.__private__.getZoomMode=function(){return Le};var Ii,Vi=L.__private__.setPageMode=function(F){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(F)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+F+'" is not recognized.');Ei=F};L.__private__.getPageMode=function(){return Ei};var be=L.__private__.setLayoutMode=function(F){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(F)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+F+'" is not recognized.');Ii=F};L.__private__.getLayoutMode=function(){return Ii},L.__private__.setDisplayMode=L.setDisplayMode=function(F,et,Pt){return Ci(F),be(et),Vi(Pt),this};var ai={title:"",subject:"",author:"",keywords:"",creator:""};L.__private__.getDocumentProperty=function(F){if(Object.keys(ai).indexOf(F)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ai[F]},L.__private__.getDocumentProperties=function(){return ai},L.__private__.setDocumentProperties=L.setProperties=L.setDocumentProperties=function(F){for(var et in ai)ai.hasOwnProperty(et)&&F[et]&&(ai[et]=F[et]);return this},L.__private__.setDocumentProperty=function(F,et){if(Object.keys(ai).indexOf(F)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ai[F]=et};var Ai,De,Lr,me,vi,He={},Di={},Mr=[],je={},Ls={},ir={},rr={},vt=null,K=0,Q=[],rt=new k5(L),Ct=i.hotfixes||[],kt={},Ut={},Vt=[],St=function F(et,Pt,jt,Yt,pe,Te){if(!(this instanceof F))return new F(et,Pt,jt,Yt,pe,Te);isNaN(et)&&(et=1),isNaN(Pt)&&(Pt=0),isNaN(jt)&&(jt=0),isNaN(Yt)&&(Yt=1),isNaN(pe)&&(pe=0),isNaN(Te)&&(Te=0),this._matrix=[et,Pt,jt,Yt,pe,Te]};Object.defineProperty(St.prototype,"sx",{get:function(){return this._matrix[0]},set:function(F){this._matrix[0]=F}}),Object.defineProperty(St.prototype,"shy",{get:function(){return this._matrix[1]},set:function(F){this._matrix[1]=F}}),Object.defineProperty(St.prototype,"shx",{get:function(){return this._matrix[2]},set:function(F){this._matrix[2]=F}}),Object.defineProperty(St.prototype,"sy",{get:function(){return this._matrix[3]},set:function(F){this._matrix[3]=F}}),Object.defineProperty(St.prototype,"tx",{get:function(){return this._matrix[4]},set:function(F){this._matrix[4]=F}}),Object.defineProperty(St.prototype,"ty",{get:function(){return this._matrix[5]},set:function(F){this._matrix[5]=F}}),Object.defineProperty(St.prototype,"a",{get:function(){return this._matrix[0]},set:function(F){this._matrix[0]=F}}),Object.defineProperty(St.prototype,"b",{get:function(){return this._matrix[1]},set:function(F){this._matrix[1]=F}}),Object.defineProperty(St.prototype,"c",{get:function(){return this._matrix[2]},set:function(F){this._matrix[2]=F}}),Object.defineProperty(St.prototype,"d",{get:function(){return this._matrix[3]},set:function(F){this._matrix[3]=F}}),Object.defineProperty(St.prototype,"e",{get:function(){return this._matrix[4]},set:function(F){this._matrix[4]=F}}),Object.defineProperty(St.prototype,"f",{get:function(){return this._matrix[5]},set:function(F){this._matrix[5]=F}}),Object.defineProperty(St.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(St.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(St.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(St.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),St.prototype.join=function(F){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Rt).join(F)},St.prototype.multiply=function(F){var et=F.sx*this.sx+F.shy*this.shx,Pt=F.sx*this.shy+F.shy*this.sy,jt=F.shx*this.sx+F.sy*this.shx,Yt=F.shx*this.shy+F.sy*this.sy,pe=F.tx*this.sx+F.ty*this.shx+this.tx,Te=F.tx*this.shy+F.ty*this.sy+this.ty;return new St(et,Pt,jt,Yt,pe,Te)},St.prototype.decompose=function(){var F=this.sx,et=this.shy,Pt=this.shx,jt=this.sy,Yt=this.tx,pe=this.ty,Te=Math.sqrt(F*F+et*et),Ye=(F/=Te)*Pt+(et/=Te)*jt;Pt-=F*Ye,jt-=et*Ye;var bi=Math.sqrt(Pt*Pt+jt*jt);return Ye/=bi,F*(jt/=bi)<et*(Pt/=bi)&&(F=-F,et=-et,Ye=-Ye,Te=-Te),{scale:new St(Te,0,0,bi,0,0),translate:new St(1,0,0,1,Yt,pe),rotate:new St(F,et,-et,F,0,0),skew:new St(1,0,Ye,1,0,0)}},St.prototype.toString=function(F){return this.join(" ")},St.prototype.inversed=function(){var F=this.sx,et=this.shy,Pt=this.shx,jt=this.sy,Yt=this.tx,pe=this.ty,Te=1/(F*jt-et*Pt),Ye=jt*Te,bi=-et*Te,Li=-Pt*Te,ui=F*Te;return new St(Ye,bi,Li,ui,-Ye*Yt-Li*pe,-bi*Yt-ui*pe)},St.prototype.applyToPoint=function(F){var et=F.x*this.sx+F.y*this.shx+this.tx,Pt=F.x*this.shy+F.y*this.sy+this.ty;return new Mn(et,Pt)},St.prototype.applyToRectangle=function(F){var et=this.applyToPoint(F),Pt=this.applyToPoint(new Mn(F.x+F.w,F.y+F.h));return new Dl(et.x,et.y,Pt.x-et.x,Pt.y-et.y)},St.prototype.clone=function(){var F=this.sx,et=this.shy,Pt=this.shx,jt=this.sy,Yt=this.tx,pe=this.ty;return new St(F,et,Pt,jt,Yt,pe)},L.Matrix=St;var Jt=L.matrixMult=function(F,et){return et.multiply(F)},ge=new St(1,0,0,1,0,0);L.unitMatrix=L.identityMatrix=ge;var ae=function(F,et){if(!Ls[F]){var Pt=(et instanceof Au?"Sh":"P")+(Object.keys(je).length+1).toString(10);et.id=Pt,Ls[F]=Pt,je[Pt]=et,rt.publish("addPattern",et)}};L.ShadingPattern=Au,L.TilingPattern=Cd,L.addShadingPattern=function(F,et){return xt("addShadingPattern()"),ae(F,et),this},L.beginTilingPattern=function(F){xt("beginTilingPattern()"),eh(F.boundingBox[0],F.boundingBox[1],F.boundingBox[2]-F.boundingBox[0],F.boundingBox[3]-F.boundingBox[1],F.matrix)},L.endTilingPattern=function(F,et){xt("endTilingPattern()"),et.stream=Ie[Et].join(`
`),ae(F,et),rt.publish("endTilingPattern",et),Vt.pop().restore()};var se=L.__private__.newObject=function(){var F=qe();return $e(F,!0),F},qe=L.__private__.newObjectDeferred=function(){return Wt++,$t[Wt]=function(){return Kt},Wt},$e=function(F,et){return et=typeof et=="boolean"&&et,$t[F]=Kt,et&&ot(F+" 0 obj"),F},wi=L.__private__.newAdditionalObject=function(){var F={objId:qe(),content:""};return Ce.push(F),F},si=qe(),Si=qe(),ki=L.__private__.decodeColorString=function(F){var et=F.split(" ");if(et.length!==2||et[1]!=="g"&&et[1]!=="G")et.length===5&&(et[4]==="k"||et[4]==="K")&&(et=[(1-et[0])*(1-et[3]),(1-et[1])*(1-et[3]),(1-et[2])*(1-et[3]),"r"]);else{var Pt=parseFloat(et[0]);et=[Pt,Pt,Pt,"r"]}for(var jt="#",Yt=0;Yt<3;Yt++)jt+=("0"+Math.floor(255*parseFloat(et[Yt])).toString(16)).slice(-2);return jt},qi=L.__private__.encodeColorString=function(F){var et;typeof F=="string"&&(F={ch1:F});var Pt=F.ch1,jt=F.ch2,Yt=F.ch3,pe=F.ch4,Te=F.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Pt=="string"&&Pt.charAt(0)!=="#"){var Ye=new mE(Pt);if(Ye.ok)Pt=Ye.toHex();else if(!/^\d*\.?\d*$/.test(Pt))throw new Error('Invalid color "'+Pt+'" passed to jsPDF.encodeColorString.')}if(typeof Pt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Pt)&&(Pt="#"+Pt[1]+Pt[1]+Pt[2]+Pt[2]+Pt[3]+Pt[3]),typeof Pt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Pt)){var bi=parseInt(Pt.substr(1),16);Pt=bi>>16&255,jt=bi>>8&255,Yt=255&bi}if(jt===void 0||pe===void 0&&Pt===jt&&jt===Yt)if(typeof Pt=="string")et=Pt+" "+Te[0];else switch(F.precision){case 2:et=zt(Pt/255)+" "+Te[0];break;case 3:default:et=ct(Pt/255)+" "+Te[0]}else if(pe===void 0||Ur(pe)==="object"){if(pe&&!isNaN(pe.a)&&pe.a===0)return et=["1.","1.","1.",Te[1]].join(" ");if(typeof Pt=="string")et=[Pt,jt,Yt,Te[1]].join(" ");else switch(F.precision){case 2:et=[zt(Pt/255),zt(jt/255),zt(Yt/255),Te[1]].join(" ");break;default:case 3:et=[ct(Pt/255),ct(jt/255),ct(Yt/255),Te[1]].join(" ")}}else if(typeof Pt=="string")et=[Pt,jt,Yt,pe,Te[2]].join(" ");else switch(F.precision){case 2:et=[zt(Pt),zt(jt),zt(Yt),zt(pe),Te[2]].join(" ");break;case 3:default:et=[ct(Pt),ct(jt),ct(Yt),ct(pe),Te[2]].join(" ")}return et},tr=L.__private__.getFilters=function(){return c},pi=L.__private__.putStream=function(F){var et=(F=F||{}).data||"",Pt=F.filters||tr(),jt=F.alreadyAppliedFilters||[],Yt=F.addLength1||!1,pe=et.length,Te=F.objectId,Ye=function(zi){return zi};if(A!==null&&Te===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");A!==null&&(Ye=Qi.encryptor(Te,0));var bi={};Pt===!0&&(Pt=["FlateEncode"]);var Li=F.additionalKeyValues||[],ui=(bi=Bi.API.processDataByFilters!==void 0?Bi.API.processDataByFilters(et,Pt):{data:et,reverseChain:[]}).reverseChain+(Array.isArray(jt)?jt.join(" "):jt.toString());if(bi.data.length!==0&&(Li.push({key:"Length",value:bi.data.length}),Yt===!0&&Li.push({key:"Length1",value:pe})),ui.length!=0)if(ui.split("/").length-1==1)Li.push({key:"Filter",value:ui});else{Li.push({key:"Filter",value:"["+ui+"]"});for(var Xi=0;Xi<Li.length;Xi+=1)if(Li[Xi].key==="DecodeParms"){for(var ni=[],Nr=0;Nr<bi.reverseChain.split("/").length-1;Nr+=1)ni.push("null");ni.push(Li[Xi].value),Li[Xi].value="["+ni.join(" ")+"]"}}ot("<<");for(var Oi=0;Oi<Li.length;Oi++)ot("/"+Li[Oi].key+" "+Li[Oi].value);ot(">>"),bi.data.length!==0&&(ot("stream"),ot(Ye(bi.data)),ot("endstream"))},Fi=L.__private__.putPage=function(F){var et=F.number,Pt=F.data,jt=F.objId,Yt=F.contentsObjId;$e(jt,!0),ot("<</Type /Page"),ot("/Parent "+F.rootDictionaryObjId+" 0 R"),ot("/Resources "+F.resourceDictionaryObjId+" 0 R"),ot("/MediaBox ["+parseFloat(Rt(F.mediaBox.bottomLeftX))+" "+parseFloat(Rt(F.mediaBox.bottomLeftY))+" "+Rt(F.mediaBox.topRightX)+" "+Rt(F.mediaBox.topRightY)+"]"),F.cropBox!==null&&ot("/CropBox ["+Rt(F.cropBox.bottomLeftX)+" "+Rt(F.cropBox.bottomLeftY)+" "+Rt(F.cropBox.topRightX)+" "+Rt(F.cropBox.topRightY)+"]"),F.bleedBox!==null&&ot("/BleedBox ["+Rt(F.bleedBox.bottomLeftX)+" "+Rt(F.bleedBox.bottomLeftY)+" "+Rt(F.bleedBox.topRightX)+" "+Rt(F.bleedBox.topRightY)+"]"),F.trimBox!==null&&ot("/TrimBox ["+Rt(F.trimBox.bottomLeftX)+" "+Rt(F.trimBox.bottomLeftY)+" "+Rt(F.trimBox.topRightX)+" "+Rt(F.trimBox.topRightY)+"]"),F.artBox!==null&&ot("/ArtBox ["+Rt(F.artBox.bottomLeftX)+" "+Rt(F.artBox.bottomLeftY)+" "+Rt(F.artBox.topRightX)+" "+Rt(F.artBox.topRightY)+"]"),typeof F.userUnit=="number"&&F.userUnit!==1&&ot("/UserUnit "+F.userUnit),rt.publish("putPage",{objId:jt,pageContext:Q[et],pageNumber:et,page:Pt}),ot("/Contents "+Yt+" 0 R"),ot(">>"),ot("endobj");var pe=Pt.join(`
`);return ht===$.ADVANCED&&(pe+=`
Q`),$e(Yt,!0),pi({data:pe,filters:tr(),objectId:Yt}),ot("endobj"),jt},sr=L.__private__.putPages=function(){var F,et,Pt=[];for(F=1;F<=K;F++)Q[F].objId=qe(),Q[F].contentsObjId=qe();for(F=1;F<=K;F++)Pt.push(Fi({number:F,data:Ie[F],objId:Q[F].objId,contentsObjId:Q[F].contentsObjId,mediaBox:Q[F].mediaBox,cropBox:Q[F].cropBox,bleedBox:Q[F].bleedBox,trimBox:Q[F].trimBox,artBox:Q[F].artBox,userUnit:Q[F].userUnit,rootDictionaryObjId:si,resourceDictionaryObjId:Si}));$e(si,!0),ot("<</Type /Pages");var jt="/Kids [";for(et=0;et<K;et++)jt+=Pt[et]+" 0 R ";ot(jt+"]"),ot("/Count "+K),ot(">>"),ot("endobj"),rt.publish("postPutPages")},Ar=function(F){rt.publish("putFont",{font:F,out:ot,newObject:se,putStream:pi}),F.isAlreadyPutted!==!0&&(F.objectNumber=se(),ot("<<"),ot("/Type /Font"),ot("/BaseFont /"+bd(F.postScriptName)),ot("/Subtype /Type1"),typeof F.encoding=="string"&&ot("/Encoding /"+F.encoding),ot("/FirstChar 32"),ot("/LastChar 255"),ot(">>"),ot("endobj"))},Qr=function(){for(var F in He)He.hasOwnProperty(F)&&(T===!1||T===!0&&P.hasOwnProperty(F))&&Ar(He[F])},nr=function(F){F.objectNumber=se();var et=[];et.push({key:"Type",value:"/XObject"}),et.push({key:"Subtype",value:"/Form"}),et.push({key:"BBox",value:"["+[Rt(F.x),Rt(F.y),Rt(F.x+F.width),Rt(F.y+F.height)].join(" ")+"]"}),et.push({key:"Matrix",value:"["+F.matrix.toString()+"]"});var Pt=F.pages[1].join(`
`);pi({data:Pt,additionalKeyValues:et,objectId:F.objectNumber}),ot("endobj")},pn=function(){for(var F in kt)kt.hasOwnProperty(F)&&nr(kt[F])},Tl=function(F,et){var Pt,jt=[],Yt=1/(et-1);for(Pt=0;Pt<1;Pt+=Yt)jt.push(Pt);if(jt.push(1),F[0].offset!=0){var pe={offset:0,color:F[0].color};F.unshift(pe)}if(F[F.length-1].offset!=1){var Te={offset:1,color:F[F.length-1].color};F.push(Te)}for(var Ye="",bi=0,Li=0;Li<jt.length;Li++){for(Pt=jt[Li];Pt>F[bi+1].offset;)bi++;var ui=F[bi].offset,Xi=(Pt-ui)/(F[bi+1].offset-ui),ni=F[bi].color,Nr=F[bi+1].color;Ye+=Gt(Math.round((1-Xi)*ni[0]+Xi*Nr[0]).toString(16))+Gt(Math.round((1-Xi)*ni[1]+Xi*Nr[1]).toString(16))+Gt(Math.round((1-Xi)*ni[2]+Xi*Nr[2]).toString(16))}return Ye.trim()},Wi=function(F,et){et||(et=21);var Pt=se(),jt=Tl(F.colors,et),Yt=[];Yt.push({key:"FunctionType",value:"0"}),Yt.push({key:"Domain",value:"[0.0 1.0]"}),Yt.push({key:"Size",value:"["+et+"]"}),Yt.push({key:"BitsPerSample",value:"8"}),Yt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Yt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),pi({data:jt,additionalKeyValues:Yt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Pt}),ot("endobj"),F.objectNumber=se(),ot("<< /ShadingType "+F.type),ot("/ColorSpace /DeviceRGB");var pe="/Coords ["+Rt(parseFloat(F.coords[0]))+" "+Rt(parseFloat(F.coords[1]))+" ";F.type===2?pe+=Rt(parseFloat(F.coords[2]))+" "+Rt(parseFloat(F.coords[3])):pe+=Rt(parseFloat(F.coords[2]))+" "+Rt(parseFloat(F.coords[3]))+" "+Rt(parseFloat(F.coords[4]))+" "+Rt(parseFloat(F.coords[5])),ot(pe+="]"),F.matrix&&ot("/Matrix ["+F.matrix.toString()+"]"),ot("/Function "+Pt+" 0 R"),ot("/Extend [true true]"),ot(">>"),ot("endobj")},ms=function(F,et){var Pt=qe(),jt=se();et.push({resourcesOid:Pt,objectOid:jt}),F.objectNumber=jt;var Yt=[];Yt.push({key:"Type",value:"/Pattern"}),Yt.push({key:"PatternType",value:"1"}),Yt.push({key:"PaintType",value:"1"}),Yt.push({key:"TilingType",value:"1"}),Yt.push({key:"BBox",value:"["+F.boundingBox.map(Rt).join(" ")+"]"}),Yt.push({key:"XStep",value:Rt(F.xStep)}),Yt.push({key:"YStep",value:Rt(F.yStep)}),Yt.push({key:"Resources",value:Pt+" 0 R"}),F.matrix&&Yt.push({key:"Matrix",value:"["+F.matrix.toString()+"]"}),pi({data:F.stream,additionalKeyValues:Yt,objectId:F.objectNumber}),ot("endobj")},Hs=function(F){var et;for(et in je)je.hasOwnProperty(et)&&(je[et]instanceof Au?Wi(je[et]):je[et]instanceof Cd&&ms(je[et],F))},Rr=function(F){for(var et in F.objectNumber=se(),ot("<<"),F)switch(et){case"opacity":ot("/ca "+zt(F[et]));break;case"stroke-opacity":ot("/CA "+zt(F[et]))}ot(">>"),ot("endobj")},kr=function(){var F;for(F in ir)ir.hasOwnProperty(F)&&Rr(ir[F])},In=function(){for(var F in ot("/XObject <<"),kt)kt.hasOwnProperty(F)&&kt[F].objectNumber>=0&&ot("/"+F+" "+kt[F].objectNumber+" 0 R");rt.publish("putXobjectDict"),ot(">>")},gr=function(){Qi.oid=se(),ot("<<"),ot("/Filter /Standard"),ot("/V "+Qi.v),ot("/R "+Qi.r),ot("/U <"+Qi.toHexString(Qi.U)+">"),ot("/O <"+Qi.toHexString(Qi.O)+">"),ot("/P "+Qi.P),ot(">>"),ot("endobj")},Or=function(){for(var F in ot("/Font <<"),He)He.hasOwnProperty(F)&&(T===!1||T===!0&&P.hasOwnProperty(F))&&ot("/"+F+" "+He[F].objectNumber+" 0 R");ot(">>")},Ka=function(){if(Object.keys(je).length>0){for(var F in ot("/Shading <<"),je)je.hasOwnProperty(F)&&je[F]instanceof Au&&je[F].objectNumber>=0&&ot("/"+F+" "+je[F].objectNumber+" 0 R");rt.publish("putShadingPatternDict"),ot(">>")}},Ms=function(F){if(Object.keys(je).length>0){for(var et in ot("/Pattern <<"),je)je.hasOwnProperty(et)&&je[et]instanceof L.TilingPattern&&je[et].objectNumber>=0&&je[et].objectNumber<F&&ot("/"+et+" "+je[et].objectNumber+" 0 R");rt.publish("putTilingPatternDict"),ot(">>")}},Sr=function(){if(Object.keys(ir).length>0){var F;for(F in ot("/ExtGState <<"),ir)ir.hasOwnProperty(F)&&ir[F].objectNumber>=0&&ot("/"+F+" "+ir[F].objectNumber+" 0 R");rt.publish("putGStateDict"),ot(">>")}},Ji=function(F){$e(F.resourcesOid,!0),ot("<<"),ot("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Or(),Ka(),Ms(F.objectOid),Sr(),In(),ot(">>"),ot("endobj")},Ws=function(){var F=[];Qr(),kr(),pn(),Hs(F),rt.publish("putResources"),F.forEach(Ji),Ji({resourcesOid:Si,objectOid:Number.MAX_SAFE_INTEGER}),rt.publish("postPutResources")},mr=function(){rt.publish("putAdditionalObjects");for(var F=0;F<Ce.length;F++){var et=Ce[F];$e(et.objId,!0),ot(et.content),ot("endobj")}rt.publish("postPutAdditionalObjects")},Qs=function(F){Di[F.fontName]=Di[F.fontName]||{},Di[F.fontName][F.fontStyle]=F.id},us=function(F,et,Pt,jt,Yt){var pe={id:"F"+(Object.keys(He).length+1).toString(10),postScriptName:F,fontName:et,fontStyle:Pt,encoding:jt,isStandardFont:Yt||!1,metadata:{}};return rt.publish("addFont",{font:pe,instance:this}),He[pe.id]=pe,Qs(pe),pe.id},wo=function(F){for(var et=0,Pt=_e.length;et<Pt;et++){var jt=us.call(this,F[et][0],F[et][1],F[et][2],_e[et][3],!0);T===!1&&(P[jt]=!0);var Yt=F[et][0].split("-");Qs({id:jt,fontName:Yt[0],fontStyle:Yt[1]||""})}rt.publish("addFonts",{fonts:He,dictionary:Di})},Fr=function(F){return F.foo=function(){try{return F.apply(this,arguments)}catch(jt){var et=jt.stack||"";~et.indexOf(" at ")&&(et=et.split(" at ")[1]);var Pt="Error in function "+et.split(`
`)[0].split("<")[0]+": "+jt.message;if(!Ri.console)throw new Error(Pt);Ri.console.error(Pt,jt),Ri.alert&&alert(Pt)}},F.foo.bar=F,F.foo},Bs=function(F,et){var Pt,jt,Yt,pe,Te,Ye,bi,Li,ui;if(Yt=(et=et||{}).sourceEncoding||"Unicode",Te=et.outputEncoding,(et.autoencode||Te)&&He[Ai].metadata&&He[Ai].metadata[Yt]&&He[Ai].metadata[Yt].encoding&&(pe=He[Ai].metadata[Yt].encoding,!Te&&He[Ai].encoding&&(Te=He[Ai].encoding),!Te&&pe.codePages&&(Te=pe.codePages[0]),typeof Te=="string"&&(Te=pe[Te]),Te)){for(bi=!1,Ye=[],Pt=0,jt=F.length;Pt<jt;Pt++)(Li=Te[F.charCodeAt(Pt)])?Ye.push(String.fromCharCode(Li)):Ye.push(F[Pt]),Ye[Pt].charCodeAt(0)>>8&&(bi=!0);F=Ye.join("")}for(Pt=F.length;bi===void 0&&Pt!==0;)F.charCodeAt(Pt-1)>>8&&(bi=!0),Pt--;if(!bi)return F;for(Ye=et.noBOM?[]:[254,255],Pt=0,jt=F.length;Pt<jt;Pt++){if((ui=(Li=F.charCodeAt(Pt))>>8)>>8)throw new Error("Character at position "+Pt+" of string '"+F+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Ye.push(ui),Ye.push(Li-(ui<<8))}return String.fromCharCode.apply(void 0,Ye)},rs=L.__private__.pdfEscape=L.pdfEscape=function(F,et){return Bs(F,et).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Hi=L.__private__.beginPage=function(F){Ie[++K]=[],Q[K]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(F[0]),topRightY:Number(F[1])}},Aa(K),he(Ie[Et])},Kn=function(F,et){var Pt,jt,Yt;switch(e=et||e,typeof F=="string"&&(Pt=Z(F.toLowerCase()),Array.isArray(Pt)&&(jt=Pt[0],Yt=Pt[1])),Array.isArray(F)&&(jt=F[0]*De,Yt=F[1]*De),isNaN(jt)&&(jt=s[0],Yt=s[1]),(jt>14400||Yt>14400)&&(Yr.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),jt=Math.min(14400,jt),Yt=Math.min(14400,Yt)),s=[jt,Yt],e.substr(0,1)){case"l":Yt>jt&&(s=[Yt,jt]);break;case"p":jt>Yt&&(s=[Yt,jt])}Hi(s),Yi(Jo),ot(eo),Fl!==0&&ot(Fl+" J"),Nl!==0&&ot(Nl+" j"),rt.publish("addPage",{pageNumber:K})},Qn=function(F){F>0&&F<=K&&(Ie.splice(F,1),Q.splice(F,1),K--,Et>K&&(Et=K),this.setPage(Et))},Aa=function(F){F>0&&F<=K&&(Et=F)},Sa=L.__private__.getNumberOfPages=L.getNumberOfPages=function(){return Ie.length-1},st=function(F,et,Pt){var jt,Yt=void 0;return Pt=Pt||{},F=F!==void 0?F:He[Ai].fontName,et=et!==void 0?et:He[Ai].fontStyle,jt=F.toLowerCase(),Di[jt]!==void 0&&Di[jt][et]!==void 0?Yt=Di[jt][et]:Di[F]!==void 0&&Di[F][et]!==void 0?Yt=Di[F][et]:Pt.disableWarning===!1&&Yr.warn("Unable to look up font label for font '"+F+"', '"+et+"'. Refer to getFontList() for available fonts."),Yt||Pt.noFallback||(Yt=Di.times[et])==null&&(Yt=Di.times.normal),Yt},yt=L.__private__.putInfo=function(){var F=se(),et=function(jt){return jt};for(var Pt in A!==null&&(et=Qi.encryptor(F,0)),ot("<<"),ot("/Producer ("+rs(et("jsPDF "+Bi.version))+")"),ai)ai.hasOwnProperty(Pt)&&ai[Pt]&&ot("/"+Pt.substr(0,1).toUpperCase()+Pt.substr(1)+" ("+rs(et(ai[Pt]))+")");ot("/CreationDate ("+rs(et(ne))+")"),ot(">>"),ot("endobj")},Ot=L.__private__.putCatalog=function(F){var et=(F=F||{}).rootDictionaryObjId||si;switch(se(),ot("<<"),ot("/Type /Catalog"),ot("/Pages "+et+" 0 R"),Le||(Le="fullwidth"),Le){case"fullwidth":ot("/OpenAction [3 0 R /FitH null]");break;case"fullheight":ot("/OpenAction [3 0 R /FitV null]");break;case"fullpage":ot("/OpenAction [3 0 R /Fit]");break;case"original":ot("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Pt=""+Le;Pt.substr(Pt.length-1)==="%"&&(Le=parseInt(Le)/100),typeof Le=="number"&&ot("/OpenAction [3 0 R /XYZ null null "+zt(Le)+"]")}switch(Ii||(Ii="continuous"),Ii){case"continuous":ot("/PageLayout /OneColumn");break;case"single":ot("/PageLayout /SinglePage");break;case"two":case"twoleft":ot("/PageLayout /TwoColumnLeft");break;case"tworight":ot("/PageLayout /TwoColumnRight")}Ei&&ot("/PageMode /"+Ei),rt.publish("putCatalog"),ot(">>"),ot("endobj")},ce=L.__private__.putTrailer=function(){ot("trailer"),ot("<<"),ot("/Size "+(Wt+1)),ot("/Root "+Wt+" 0 R"),ot("/Info "+(Wt-1)+" 0 R"),A!==null&&ot("/Encrypt "+Qi.oid+" 0 R"),ot("/ID [ <"+oe+"> <"+oe+"> ]"),ot(">>")},Ee=L.__private__.putHeader=function(){ot("%PDF-"+D),ot("%ºß¬à")},hi=L.__private__.putXRef=function(){var F="0000000000";ot("xref"),ot("0 "+(Wt+1)),ot("0000000000 65535 f ");for(var et=1;et<=Wt;et++)typeof $t[et]=="function"?ot((F+$t[et]()).slice(-10)+" 00000 n "):$t[et]!==void 0?ot((F+$t[et]).slice(-10)+" 00000 n "):ot("0000000000 00000 n ")},Ti=L.__private__.buildDocument=function(){Ze(),he(ee),rt.publish("buildDocument"),Ee(),sr(),mr(),Ws(),A!==null&&gr(),yt(),Ot();var F=Kt;return hi(),ce(),ot("startxref"),ot(""+F),ot("%%EOF"),he(Ie[Et]),ee.join(`
`)},cr=L.__private__.getBlob=function(F){return new Blob([ri(F)],{type:"application/pdf"})},ls=L.output=L.__private__.output=Fr(function(F,et){switch(typeof(et=et||{})=="string"?et={filename:et}:et.filename=et.filename||"generated.pdf",F){case void 0:return Ti();case"save":L.save(et.filename);break;case"arraybuffer":return ri(Ti());case"blob":return cr(Ti());case"bloburi":case"bloburl":if(Ri.URL!==void 0&&typeof Ri.URL.createObjectURL=="function")return Ri.URL&&Ri.URL.createObjectURL(cr(Ti()))||void 0;Yr.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Pt="",jt=Ti();try{Pt=Y1(jt)}catch{Pt=Y1(unescape(encodeURIComponent(jt)))}return"data:application/pdf;filename="+et.filename+";base64,"+Pt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Ri)==="[object Window]"){var Yt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",pe=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';et.pdfObjectUrl&&(Yt=et.pdfObjectUrl,pe="");var Te='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Yt+'"'+pe+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(et)+");<\/script></body></html>",Ye=Ri.open();return Ye!==null&&Ye.document.write(Te),Ye}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Ri)==="[object Window]"){var bi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(et.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+et.filename+'" width="500px" height="400px" /></body></html>',Li=Ri.open();if(Li!==null){Li.document.write(bi);var ui=this;Li.document.documentElement.querySelector("#pdfViewer").onload=function(){Li.document.title=et.filename,Li.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(ui.output("bloburl"))}}return Li}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Ri)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Xi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",et)+'"></iframe></body></html>',ni=Ri.open();if(ni!==null&&(ni.document.write(Xi),ni.document.title=et.filename),ni||typeof safari>"u")return ni;break;case"datauri":case"dataurl":return Ri.document.location.href=this.output("datauristring",et);default:return null}}),ds=function(F){return Array.isArray(Ct)===!0&&Ct.indexOf(F)>-1};switch(r){case"pt":De=1;break;case"mm":De=72/25.4;break;case"cm":De=72/2.54;break;case"in":De=72;break;case"px":De=ds("px_scaling")==1?.75:96/72;break;case"pc":case"em":De=12;break;case"ex":De=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);De=r}var Qi=null;Me(),Qt();var Pl=function(F){return A!==null?Qi.encryptor(F,0):function(et){return et}},ys=L.__private__.getPageInfo=L.getPageInfo=function(F){if(isNaN(F)||F%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Q[F].objId,pageNumber:F,pageContext:Q[F]}},yi=L.__private__.getPageInfoByObjId=function(F){if(isNaN(F)||F%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var et in Q)if(Q[et].objId===F)break;return ys(et)},gc=L.__private__.getCurrentPageInfo=L.getCurrentPageInfo=function(){return{objId:Q[Et].objId,pageNumber:Et,pageContext:Q[Et]}};L.addPage=function(){return Kn.apply(this,arguments),this},L.setPage=function(){return Aa.apply(this,arguments),he.call(this,Ie[Et]),this},L.insertPage=function(F){return this.addPage(),this.movePage(Et,F),this},L.movePage=function(F,et){var Pt,jt;if(F>et){Pt=Ie[F],jt=Q[F];for(var Yt=F;Yt>et;Yt--)Ie[Yt]=Ie[Yt-1],Q[Yt]=Q[Yt-1];Ie[et]=Pt,Q[et]=jt,this.setPage(et)}else if(F<et){Pt=Ie[F],jt=Q[F];for(var pe=F;pe<et;pe++)Ie[pe]=Ie[pe+1],Q[pe]=Q[pe+1];Ie[et]=Pt,Q[et]=jt,this.setPage(et)}return this},L.deletePage=function(){return Qn.apply(this,arguments),this},L.__private__.text=L.text=function(F,et,Pt,jt,Yt){var pe,Te,Ye,bi,Li,ui,Xi,ni,Nr,Oi=(jt=jt||{}).scope||this;if(typeof F=="number"&&typeof et=="number"&&(typeof Pt=="string"||Array.isArray(Pt))){var zi=Pt;Pt=et,et=F,F=zi}if(arguments[3]instanceof St?(xt("The transform parameter of text() with a Matrix value"),Nr=Yt):(Ye=arguments[4],bi=arguments[5],Ur(Xi=arguments[3])==="object"&&Xi!==null||(typeof Ye=="string"&&(bi=Ye,Ye=null),typeof Xi=="string"&&(bi=Xi,Xi=null),typeof Xi=="number"&&(Ye=Xi,Xi=null),jt={flags:Xi,angle:Ye,align:bi})),isNaN(et)||isNaN(Pt)||F==null)throw new Error("Invalid arguments passed to jsPDF.text");if(F.length===0)return Oi;var ss="",Bn=!1,gn=typeof jt.lineHeightFactor=="number"?jt.lineHeightFactor:Wo,Zo=Oi.internal.scaleFactor;function bc(vr){return vr=vr.split("	").join(Array(jt.TabLen||9).join(" ")),rs(vr,Xi)}function La(vr){for(var hr,Xr=vr.concat(),Gr=[],oo=Xr.length;oo--;)typeof(hr=Xr.shift())=="string"?Gr.push(hr):Array.isArray(vr)&&(hr.length===1||hr[1]===void 0&&hr[2]===void 0)?Gr.push(hr[0]):Gr.push([hr[0],hr[1],hr[2]]);return Gr}function $o(vr,hr){var Xr;if(typeof vr=="string")Xr=hr(vr)[0];else if(Array.isArray(vr)){for(var Gr,oo,ao=vr.concat(),sl=[],lo=ao.length;lo--;)typeof(Gr=ao.shift())=="string"?sl.push(hr(Gr)[0]):Array.isArray(Gr)&&typeof Gr[0]=="string"&&(oo=hr(Gr[0],Gr[1],Gr[2]),sl.push([oo[0],oo[1],oo[2]]));Xr=sl}return Xr}var Eo=!1,Ma=!0;if(typeof F=="string")Eo=!0;else if(Array.isArray(F)){var Rn=F.concat();Te=[];for(var mn,Dr=Rn.length;Dr--;)(typeof(mn=Rn.shift())!="string"||Array.isArray(mn)&&typeof mn[0]!="string")&&(Ma=!1);Eo=Ma}if(Eo===!1)throw new Error('Type of text must be string or Array. "'+F+'" is not recognized.');typeof F=="string"&&(F=F.match(/[\r?\n]/)?F.split(/\r\n|\r|\n/g):[F]);var el=Se/Oi.internal.scaleFactor,il=el*(gn-1);switch(jt.baseline){case"bottom":Pt-=il;break;case"top":Pt+=el-il;break;case"hanging":Pt+=el-2*il;break;case"middle":Pt+=el/2-il}if((ui=jt.maxWidth||0)>0&&(typeof F=="string"?F=Oi.splitTextToSize(F,ui):Object.prototype.toString.call(F)==="[object Array]"&&(F=F.reduce(function(vr,hr){return vr.concat(Oi.splitTextToSize(hr,ui))},[]))),pe={text:F,x:et,y:Pt,options:jt,mutex:{pdfEscape:rs,activeFontKey:Ai,fonts:He,activeFontSize:Se}},rt.publish("preProcessText",pe),F=pe.text,Ye=(jt=pe.options).angle,!(Nr instanceof St)&&Ye&&typeof Ye=="number"){Ye*=Math.PI/180,jt.rotationDirection===0&&(Ye=-Ye),ht===$.ADVANCED&&(Ye=-Ye);var Ba=Math.cos(Ye),io=Math.sin(Ye);Nr=new St(Ba,io,-io,Ba,0,0)}else Ye&&Ye instanceof St&&(Nr=Ye);ht!==$.ADVANCED||Nr||(Nr=ge),(Li=jt.charSpace||Ta)!==void 0&&(ss+=Rt(pt(Li))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(ni=jt.horizontalScale)!==void 0&&(ss+=Rt(100*ni)+` Tz
`),jt.lang;var Rs=-1,zl=jt.renderingMode!==void 0?jt.renderingMode:jt.stroke,Yo=Oi.internal.getCurrentPageInfo().pageContext;switch(zl){case 0:case!1:case"fill":Rs=0;break;case 1:case!0:case"stroke":Rs=1;break;case 2:case"fillThenStroke":Rs=2;break;case 3:case"invisible":Rs=3;break;case 4:case"fillAndAddForClipping":Rs=4;break;case 5:case"strokeAndAddPathForClipping":Rs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Rs=6;break;case 7:case"addToPathForClipping":Rs=7}var Ra=Yo.usedRenderingMode!==void 0?Yo.usedRenderingMode:-1;Rs!==-1?ss+=Rs+` Tr
`:Ra!==-1&&(ss+=`0 Tr
`),Rs!==-1&&(Yo.usedRenderingMode=Rs),bi=jt.align||"left";var yn,_n=Se*gn,ka=Oi.internal.pageSize.getWidth(),wc=He[Ai];Li=jt.charSpace||Ta,ui=jt.maxWidth||0,Xi=Object.assign({autoencode:!0,noBOM:!0},jt.flags);var Co=[];if(Object.prototype.toString.call(F)==="[object Array]"){var Pi;Te=La(F),bi!=="left"&&(yn=Te.map(function(vr){return Oi.getStringUnitWidth(vr,{font:wc,charSpace:Li,fontSize:Se,doKerning:!1})*Se/Zo}));var ks,ro=0;if(bi==="right"){et-=yn[0],F=[],Dr=Te.length;for(var kn=0;kn<Dr;kn++)kn===0?(ks=Xo(et),Pi=to(Pt)):(ks=pt(ro-yn[kn]),Pi=-_n),F.push([Te[kn],ks,Pi]),ro=yn[kn]}else if(bi==="center"){et-=yn[0]/2,F=[],Dr=Te.length;for(var Js=0;Js<Dr;Js++)Js===0?(ks=Xo(et),Pi=to(Pt)):(ks=pt((ro-yn[Js])/2),Pi=-_n),F.push([Te[Js],ks,Pi]),ro=yn[Js]}else if(bi==="left"){F=[],Dr=Te.length;for(var rl=0;rl<Dr;rl++)F.push(Te[rl])}else{if(bi!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');F=[],Dr=Te.length,ui=ui!==0?ui:ka;for(var On=0;On<Dr;On++)Pi=On===0?to(Pt):-_n,ks=On===0?Xo(et):0,On<Dr-1?Co.push(Rt(pt((ui-yn[On])/(Te[On].split(" ").length-1)))):Co.push(0),F.push([Te[On],ks,Pi])}}var To=typeof jt.R2L=="boolean"?jt.R2L:ci;To===!0&&(F=$o(F,function(vr,hr,Xr){return[vr.split("").reverse().join(""),hr,Xr]})),pe={text:F,x:et,y:Pt,options:jt,mutex:{pdfEscape:rs,activeFontKey:Ai,fonts:He,activeFontSize:Se}},rt.publish("postProcessText",pe),F=pe.text,Bn=pe.mutex.isHex||!1;var xc=He[Ai].encoding;xc!=="WinAnsiEncoding"&&xc!=="StandardEncoding"||(F=$o(F,function(vr,hr,Xr){return[bc(vr),hr,Xr]})),Te=La(F),F=[];for(var Po,tn,Fn,Ko=0,so=1,no=Array.isArray(Te[0])?so:Ko,Jr="",Nn=function(vr,hr,Xr){var Gr="";return Xr instanceof St?(Xr=typeof jt.angle=="number"?Jt(Xr,new St(1,0,0,1,vr,hr)):Jt(new St(1,0,0,1,vr,hr),Xr),ht===$.ADVANCED&&(Xr=Jt(new St(1,0,0,-1,0,0),Xr)),Gr=Xr.join(" ")+` Tm
`):Gr=Rt(vr)+" "+Rt(hr)+` Td
`,Gr},Xs=0;Xs<Te.length;Xs++){switch(Jr="",no){case so:Fn=(Bn?"<":"(")+Te[Xs][0]+(Bn?">":")"),Po=parseFloat(Te[Xs][1]),tn=parseFloat(Te[Xs][2]);break;case Ko:Fn=(Bn?"<":"(")+Te[Xs]+(Bn?">":")"),Po=Xo(et),tn=to(Pt)}Co!==void 0&&Co[Xs]!==void 0&&(Jr=Co[Xs]+` Tw
`),Xs===0?F.push(Jr+Nn(Po,tn,Nr)+Fn):no===Ko?F.push(Jr+Fn):no===so&&F.push(Jr+Nn(Po,tn,Nr)+Fn)}F=no===Ko?F.join(` Tj
T* `):F.join(` Tj
`),F+=` Tj
`;var Qo=`BT
/`;return Qo+=Ai+" "+Se+` Tf
`,Qo+=Rt(Se*gn)+` TL
`,Qo+=Qa+`
`,Qo+=ss,Qo+=F,ot(Qo+="ET"),P[Ai]=!0,Oi};var Il=L.__private__.clip=L.clip=function(F){return ot(F==="evenodd"?"W*":"W"),this};L.clipEvenOdd=function(){return Il("evenodd")},L.__private__.discardPath=L.discardPath=function(){return ot("n"),this};var Ln=L.__private__.isValidStyle=function(F){var et=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(F)!==-1&&(et=!0),et};L.__private__.setDefaultPathOperation=L.setDefaultPathOperation=function(F){return Ln(F)&&(y=F),this};var Ll=L.__private__.getStyle=L.getStyle=function(F){var et=y;switch(F){case"D":case"S":et="S";break;case"F":et="f";break;case"FD":case"DF":et="B";break;case"f":case"f*":case"B":case"B*":et=F}return et},Ho=L.close=function(){return ot("h"),this};L.stroke=function(){return ot("S"),this},L.fill=function(F){return Ml("f",F),this},L.fillEvenOdd=function(F){return Ml("f*",F),this},L.fillStroke=function(F){return Ml("B",F),this},L.fillStrokeEvenOdd=function(F){return Ml("B*",F),this};var Ml=function(F,et){Ur(et)==="object"?$h(et,F):ot(F)},Bl=function(F){F===null||ht===$.ADVANCED&&F===void 0||(F=Ll(F),ot(F))};function Kc(F,et,Pt,jt,Yt){var pe=new Cd(et||this.boundingBox,Pt||this.xStep,jt||this.yStep,this.gState,Yt||this.matrix);pe.stream=this.stream;var Te=F+"$$"+this.cloneIndex+++"$$";return ae(Te,pe),pe}var $h=function(F,et){var Pt=Ls[F.key],jt=je[Pt];if(jt instanceof Au)ot("q"),ot(Yh(et)),jt.gState&&L.setGState(jt.gState),ot(F.matrix.toString()+" cm"),ot("/"+Pt+" sh"),ot("Q");else if(jt instanceof Cd){var Yt=new St(1,0,0,-1,0,Ia());F.matrix&&(Yt=Yt.multiply(F.matrix||ge),Pt=Kc.call(jt,F.key,F.boundingBox,F.xStep,F.yStep,Yt).id),ot("q"),ot("/Pattern cs"),ot("/"+Pt+" scn"),jt.gState&&L.setGState(jt.gState),ot(et),ot("Q")}},Yh=function(F){switch(F){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},mc=L.moveTo=function(F,et){return ot(Rt(pt(F))+" "+Rt(bt(et))+" m"),this},xo=L.lineTo=function(F,et){return ot(Rt(pt(F))+" "+Rt(bt(et))+" l"),this},Ao=L.curveTo=function(F,et,Pt,jt,Yt,pe){return ot([Rt(pt(F)),Rt(bt(et)),Rt(pt(Pt)),Rt(bt(jt)),Rt(pt(Yt)),Rt(bt(pe)),"c"].join(" ")),this};L.__private__.line=L.line=function(F,et,Pt,jt,Yt){if(isNaN(F)||isNaN(et)||isNaN(Pt)||isNaN(jt)||!Ln(Yt))throw new Error("Invalid arguments passed to jsPDF.line");return ht===$.COMPAT?this.lines([[Pt-F,jt-et]],F,et,[1,1],Yt||"S"):this.lines([[Pt-F,jt-et]],F,et,[1,1]).stroke()},L.__private__.lines=L.lines=function(F,et,Pt,jt,Yt,pe){var Te,Ye,bi,Li,ui,Xi,ni,Nr,Oi,zi,ss,Bn;if(typeof F=="number"&&(Bn=Pt,Pt=et,et=F,F=Bn),jt=jt||[1,1],pe=pe||!1,isNaN(et)||isNaN(Pt)||!Array.isArray(F)||!Array.isArray(jt)||!Ln(Yt)||typeof pe!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(mc(et,Pt),Te=jt[0],Ye=jt[1],Li=F.length,zi=et,ss=Pt,bi=0;bi<Li;bi++)(ui=F[bi]).length===2?(zi=ui[0]*Te+zi,ss=ui[1]*Ye+ss,xo(zi,ss)):(Xi=ui[0]*Te+zi,ni=ui[1]*Ye+ss,Nr=ui[2]*Te+zi,Oi=ui[3]*Ye+ss,zi=ui[4]*Te+zi,ss=ui[5]*Ye+ss,Ao(Xi,ni,Nr,Oi,zi,ss));return pe&&Ho(),Bl(Yt),this},L.path=function(F){for(var et=0;et<F.length;et++){var Pt=F[et],jt=Pt.c;switch(Pt.op){case"m":mc(jt[0],jt[1]);break;case"l":xo(jt[0],jt[1]);break;case"c":Ao.apply(this,jt);break;case"h":Ho()}}return this},L.__private__.rect=L.rect=function(F,et,Pt,jt,Yt){if(isNaN(F)||isNaN(et)||isNaN(Pt)||isNaN(jt)||!Ln(Yt))throw new Error("Invalid arguments passed to jsPDF.rect");return ht===$.COMPAT&&(jt=-jt),ot([Rt(pt(F)),Rt(bt(et)),Rt(pt(Pt)),Rt(pt(jt)),"re"].join(" ")),Bl(Yt),this},L.__private__.triangle=L.triangle=function(F,et,Pt,jt,Yt,pe,Te){if(isNaN(F)||isNaN(et)||isNaN(Pt)||isNaN(jt)||isNaN(Yt)||isNaN(pe)||!Ln(Te))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Pt-F,jt-et],[Yt-Pt,pe-jt],[F-Yt,et-pe]],F,et,[1,1],Te,!0),this},L.__private__.roundedRect=L.roundedRect=function(F,et,Pt,jt,Yt,pe,Te){if(isNaN(F)||isNaN(et)||isNaN(Pt)||isNaN(jt)||isNaN(Yt)||isNaN(pe)||!Ln(Te))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Ye=4/3*(Math.SQRT2-1);return Yt=Math.min(Yt,.5*Pt),pe=Math.min(pe,.5*jt),this.lines([[Pt-2*Yt,0],[Yt*Ye,0,Yt,pe-pe*Ye,Yt,pe],[0,jt-2*pe],[0,pe*Ye,-Yt*Ye,pe,-Yt,pe],[2*Yt-Pt,0],[-Yt*Ye,0,-Yt,-pe*Ye,-Yt,-pe],[0,2*pe-jt],[0,-pe*Ye,Yt*Ye,-pe,Yt,-pe]],F+Yt,et,[1,1],Te,!0),this},L.__private__.ellipse=L.ellipse=function(F,et,Pt,jt,Yt){if(isNaN(F)||isNaN(et)||isNaN(Pt)||isNaN(jt)||!Ln(Yt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var pe=4/3*(Math.SQRT2-1)*Pt,Te=4/3*(Math.SQRT2-1)*jt;return mc(F+Pt,et),Ao(F+Pt,et-Te,F+pe,et-jt,F,et-jt),Ao(F-pe,et-jt,F-Pt,et-Te,F-Pt,et),Ao(F-Pt,et+Te,F-pe,et+jt,F,et+jt),Ao(F+pe,et+jt,F+Pt,et+Te,F+Pt,et),Bl(Yt),this},L.__private__.circle=L.circle=function(F,et,Pt,jt){if(isNaN(F)||isNaN(et)||isNaN(Pt)||!Ln(jt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(F,et,Pt,Pt,jt)},L.setFont=function(F,et,Pt){return Pt&&(et=Nt(et,Pt)),Ai=st(F,et,{disableWarning:!1}),this};var Rl=L.__private__.getFont=L.getFont=function(){return He[st.apply(L,arguments)]};L.__private__.getFontList=L.getFontList=function(){var F,et,Pt={};for(F in Di)if(Di.hasOwnProperty(F))for(et in Pt[F]=[],Di[F])Di[F].hasOwnProperty(et)&&Pt[F].push(et);return Pt},L.addFont=function(F,et,Pt,jt,Yt){var pe=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&pe.indexOf(arguments[3])!==-1?Yt=arguments[3]:arguments[3]&&pe.indexOf(arguments[3])==-1&&(Pt=Nt(Pt,jt)),Yt=Yt||"Identity-H",us.call(this,F,et,Pt,Yt)};var Wo,Jo=i.lineWidth||.200025,_s=L.__private__.getLineWidth=L.getLineWidth=function(){return Jo},Yi=L.__private__.setLineWidth=L.setLineWidth=function(F){return Jo=F,ot(Rt(pt(F))+" w"),this};L.__private__.setLineDash=Bi.API.setLineDash=Bi.API.setLineDashPattern=function(F,et){if(F=F||[],et=et||0,isNaN(et)||!Array.isArray(F))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return F=F.map(function(Pt){return Rt(pt(Pt))}).join(" "),et=Rt(pt(et)),ot("["+F+"] "+et+" d"),this};var kl=L.__private__.getLineHeight=L.getLineHeight=function(){return Se*Wo};L.__private__.getLineHeight=L.getLineHeight=function(){return Se*Wo};var Ea=L.__private__.setLineHeightFactor=L.setLineHeightFactor=function(F){return typeof(F=F||1.15)=="number"&&(Wo=F),this},Ca=L.__private__.getLineHeightFactor=L.getLineHeightFactor=function(){return Wo};Ea(i.lineHeight);var Xo=L.__private__.getHorizontalCoordinate=function(F){return pt(F)},to=L.__private__.getVerticalCoordinate=function(F){return ht===$.ADVANCED?F:Q[Et].mediaBox.topRightY-Q[Et].mediaBox.bottomLeftY-pt(F)},Kh=L.__private__.getHorizontalCoordinateString=L.getHorizontalCoordinateString=function(F){return Rt(Xo(F))},fn=L.__private__.getVerticalCoordinateString=L.getVerticalCoordinateString=function(F){return Rt(to(F))},eo=i.strokeColor||"0 G";L.__private__.getStrokeColor=L.getDrawColor=function(){return ki(eo)},L.__private__.setStrokeColor=L.setDrawColor=function(F,et,Pt,jt){return eo=qi({ch1:F,ch2:et,ch3:Pt,ch4:jt,pdfColorType:"draw",precision:2}),ot(eo),this};var Ol=i.fillColor||"0 g";L.__private__.getFillColor=L.getFillColor=function(){return ki(Ol)},L.__private__.setFillColor=L.setFillColor=function(F,et,Pt,jt){return Ol=qi({ch1:F,ch2:et,ch3:Pt,ch4:jt,pdfColorType:"fill",precision:2}),ot(Ol),this};var Qa=i.textColor||"0 g",Qc=L.__private__.getTextColor=L.getTextColor=function(){return ki(Qa)};L.__private__.setTextColor=L.setTextColor=function(F,et,Pt,jt){return Qa=qi({ch1:F,ch2:et,ch3:Pt,ch4:jt,pdfColorType:"text",precision:3}),this};var Ta=i.charSpace,th=L.__private__.getCharSpace=L.getCharSpace=function(){return parseFloat(Ta||0)};L.__private__.setCharSpace=L.setCharSpace=function(F){if(isNaN(F))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Ta=F,this};var Fl=0;L.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},L.__private__.setLineCap=L.setLineCap=function(F){var et=L.CapJoinStyles[F];if(et===void 0)throw new Error("Line cap style of '"+F+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Fl=et,ot(et+" J"),this};var Nl=0;L.__private__.setLineJoin=L.setLineJoin=function(F){var et=L.CapJoinStyles[F];if(et===void 0)throw new Error("Line join style of '"+F+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Nl=et,ot(et+" j"),this},L.__private__.setLineMiterLimit=L.__private__.setMiterLimit=L.setLineMiterLimit=L.setMiterLimit=function(F){if(F=F||0,isNaN(F))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return ot(Rt(pt(F))+" M"),this},L.GState=Tm,L.setGState=function(F){(F=typeof F=="string"?ir[rr[F]]:yc(null,F)).equals(vt)||(ot("/"+F.id+" gs"),vt=F)};var yc=function(F,et){if(!F||!rr[F]){var Pt=!1;for(var jt in ir)if(ir.hasOwnProperty(jt)&&ir[jt].equals(et)){Pt=!0;break}if(Pt)et=ir[jt];else{var Yt="GS"+(Object.keys(ir).length+1).toString(10);ir[Yt]=et,et.id=Yt}return F&&(rr[F]=et.id),rt.publish("addGState",et),et}};L.addGState=function(F,et){return yc(F,et),this},L.saveGraphicsState=function(){return ot("q"),Mr.push({key:Ai,size:Se,color:Qa}),this},L.restoreGraphicsState=function(){ot("Q");var F=Mr.pop();return Ai=F.key,Se=F.size,Qa=F.color,vt=null,this},L.setCurrentTransformationMatrix=function(F){return ot(F.toString()+" cm"),this},L.comment=function(F){return ot("#"+F),this};var Mn=function(F,et){var Pt=F||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Pt},set:function(pe){isNaN(pe)||(Pt=parseFloat(pe))}});var jt=et||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return jt},set:function(pe){isNaN(pe)||(jt=parseFloat(pe))}});var Yt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Yt},set:function(pe){Yt=pe.toString()}}),this},Dl=function(F,et,Pt,jt){Mn.call(this,F,et),this.type="rect";var Yt=Pt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Yt},set:function(Te){isNaN(Te)||(Yt=parseFloat(Te))}});var pe=jt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return pe},set:function(Te){isNaN(Te)||(pe=parseFloat(Te))}}),this},_c=function(){this.page=K,this.currentPage=Et,this.pages=Ie.slice(0),this.pagesContext=Q.slice(0),this.x=Lr,this.y=me,this.matrix=vi,this.width=tl(Et),this.height=Ia(Et),this.outputDestination=Fe,this.id="",this.objectNumber=-1};_c.prototype.restore=function(){K=this.page,Et=this.currentPage,Q=this.pagesContext,Ie=this.pages,Lr=this.x,me=this.y,vi=this.matrix,Pa(Et,this.width),vc(Et,this.height),Fe=this.outputDestination};var eh=function(F,et,Pt,jt,Yt){Vt.push(new _c),K=Et=0,Ie=[],Lr=F,me=et,vi=Yt,Hi([Pt,jt])},ih=function(F){if(Ut[F])Vt.pop().restore();else{var et=new _c,Pt="Xo"+(Object.keys(kt).length+1).toString(10);et.id=Pt,Ut[F]=Pt,kt[Pt]=et,rt.publish("addFormObject",et),Vt.pop().restore()}};for(var So in L.beginFormObject=function(F,et,Pt,jt,Yt){return eh(F,et,Pt,jt,Yt),this},L.endFormObject=function(F){return ih(F),this},L.doFormObject=function(F,et){var Pt=kt[Ut[F]];return ot("q"),ot(et.toString()+" cm"),ot("/"+Pt.id+" Do"),ot("Q"),this},L.getFormObject=function(F){var et=kt[Ut[F]];return{x:et.x,y:et.y,width:et.width,height:et.height,matrix:et.matrix}},L.save=function(F,et){return F=F||"generated.pdf",(et=et||{}).returnPromise=et.returnPromise||!1,et.returnPromise===!1?(bu(cr(Ti()),F),typeof bu.unload=="function"&&Ri.setTimeout&&setTimeout(bu.unload,911),this):new Promise(function(Pt,jt){try{var Yt=bu(cr(Ti()),F);typeof bu.unload=="function"&&Ri.setTimeout&&setTimeout(bu.unload,911),Pt(Yt)}catch(pe){jt(pe.message)}})},Bi.API)Bi.API.hasOwnProperty(So)&&(So==="events"&&Bi.API.events.length?function(F,et){var Pt,jt,Yt;for(Yt=et.length-1;Yt!==-1;Yt--)Pt=et[Yt][0],jt=et[Yt][1],F.subscribe.apply(F,[Pt].concat(typeof jt=="function"?[jt]:jt))}(rt,Bi.API.events):L[So]=Bi.API[So]);var tl=L.getPageWidth=function(F){return(Q[F=F||Et].mediaBox.topRightX-Q[F].mediaBox.bottomLeftX)/De},Pa=L.setPageWidth=function(F,et){Q[F].mediaBox.topRightX=et*De+Q[F].mediaBox.bottomLeftX},Ia=L.getPageHeight=function(F){return(Q[F=F||Et].mediaBox.topRightY-Q[F].mediaBox.bottomLeftY)/De},vc=L.setPageHeight=function(F,et){Q[F].mediaBox.topRightY=et*De+Q[F].mediaBox.bottomLeftY};return L.internal={pdfEscape:rs,getStyle:Ll,getFont:Rl,getFontSize:Ne,getCharSpace:th,getTextColor:Qc,getLineHeight:kl,getLineHeightFactor:Ca,getLineWidth:_s,write:mi,getHorizontalCoordinate:Xo,getVerticalCoordinate:to,getCoordinateString:Kh,getVerticalCoordinateString:fn,collections:{},newObject:se,newAdditionalObject:wi,newObjectDeferred:qe,newObjectDeferredBegin:$e,getFilters:tr,putStream:pi,events:rt,scaleFactor:De,pageSize:{getWidth:function(){return tl(Et)},setWidth:function(F){Pa(Et,F)},getHeight:function(){return Ia(Et)},setHeight:function(F){vc(Et,F)}},encryptionOptions:A,encryption:Qi,getEncryptor:Pl,output:ls,getNumberOfPages:Sa,pages:Ie,out:ot,f2:zt,f3:ct,getPageInfo:ys,getPageInfoByObjId:yi,getCurrentPageInfo:gc,getPDFVersion:j,Point:Mn,Rectangle:Dl,Matrix:St,hasHotfix:ds},Object.defineProperty(L.internal.pageSize,"width",{get:function(){return tl(Et)},set:function(F){Pa(Et,F)},enumerable:!0,configurable:!0}),Object.defineProperty(L.internal.pageSize,"height",{get:function(){return Ia(Et)},set:function(F){vc(Et,F)},enumerable:!0,configurable:!0}),wo.call(L,_e),Ai="F1",Kn(s,e),rt.publish("initialized"),L}vd.prototype.lsbFirstWord=function(i){return String.fromCharCode(i>>0&255,i>>8&255,i>>16&255,i>>24&255)},vd.prototype.toHexString=function(i){return i.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},vd.prototype.hexToBytes=function(i){for(var t=[],e=0;e<i.length;e+=2)t.push(String.fromCharCode(parseInt(i.substr(e,2),16)));return t.join("")},vd.prototype.processOwnerPassword=function(i,t){return Q1(K1(t).substr(0,5),i)},vd.prototype.encryptor=function(i,t){var e=K1(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&t,t>>8&255)).substr(0,10);return function(r){return Q1(e,r)}},Tm.prototype.equals=function(i){var t,e="id,objectNumber,equals";if(!i||Ur(i)!==Ur(this))return!1;var r=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!i.hasOwnProperty(t)||this[t]!==i[t])return!1;r++}for(t in i)i.hasOwnProperty(t)&&e.indexOf(t)<0&&r--;return r===0},Bi.API={events:[]},Bi.version="2.5.1";var Ps=Bi.API,Pv=1,Uu=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},fd=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Gi=function(i){return i.toFixed(2)},Nh=function(i){return i.toFixed(5)};Ps.__acroform__={};var Vo=function(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i},O5=function(i){return i*Pv},rc=function(i){var t=new bE,e=fi.internal.getHeight(i)||0,r=fi.internal.getWidth(i)||0;return t.BBox=[0,0,Number(Gi(r)),Number(Gi(e))],t},QG=Ps.__acroform__.setBit=function(i,t){if(i=i||0,t=t||0,isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|=1<<t},tV=Ps.__acroform__.clearBit=function(i,t){if(i=i||0,t=t||0,isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&=~(1<<t)},eV=Ps.__acroform__.getBit=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<t?1:0},zs=Ps.__acroform__.getBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return eV(i,t-1)},Us=Ps.__acroform__.setBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return QG(i,t-1)},js=Ps.__acroform__.clearBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return tV(i,t-1)},iV=Ps.__acroform__.calculateCoordinates=function(i,t){var e=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,s=i[0],n=i[1],c=i[2],l=i[3],f={};return f.lowerLeft_X=e(s)||0,f.lowerLeft_Y=r(n+l)||0,f.upperRight_X=e(s+c)||0,f.upperRight_Y=r(n)||0,[Number(Gi(f.lowerLeft_X)),Number(Gi(f.lowerLeft_Y)),Number(Gi(f.upperRight_X)),Number(Gi(f.upperRight_Y))]},rV=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var t=[],e=i._V||i.DV,r=t_(i,e),s=i.scope.internal.getFont(i.fontName,i.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(i.scope.__private__.encodeColorString(i.color)),t.push("/"+s+" "+Gi(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var n=rc(i);return n.scope=i.scope,n.stream=t.join(`
`),n}},t_=function(i,t){var e=i.fontSize===0?i.maxFontSize:i.fontSize,r={text:"",fontSize:""},s=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");s=i.multiline?s.map(function(ct){return ct.split(`
`)}):s.map(function(ct){return[ct]});var n=e,c=fi.internal.getHeight(i)||0;c=c<0?-c:c;var l=fi.internal.getWidth(i)||0;l=l<0?-l:l;var f=function(ct,pt,Bt){if(ct+1<s.length){var bt=pt+" "+s[ct+1][0];return Ng(bt,i,Bt).width<=l-4}return!1};n++;t:for(;n>0;){t="",n--;var y,A,T=Ng("3",i,n).height,P=i.multiline?c-n:(c-T)/2,L=P+=2,D=0,j=0,X=0;if(n<=0){t=`(...) Tj
`,t+="% Width of Text: "+Ng(t,i,n=12).width+", FieldWidth:"+l+`
`;break}for(var Z="",$=0,ht=0;ht<s.length;ht++)if(s.hasOwnProperty(ht)){var _t=!1;if(s[ht].length!==1&&X!==s[ht].length-1){if((T+2)*($+2)+2>c)continue t;Z+=s[ht][X],_t=!0,j=ht,ht--}else{Z=(Z+=s[ht][X]+" ").substr(Z.length-1)==" "?Z.substr(0,Z.length-1):Z;var Mt=parseInt(ht),Nt=f(Mt,Z,n),Rt=ht>=s.length-1;if(Nt&&!Rt){Z+=" ",X=0;continue}if(Nt||Rt){if(Rt)j=Mt;else if(i.multiline&&(T+2)*($+2)+2>c)continue t}else{if(!i.multiline||(T+2)*($+2)+2>c)continue t;j=Mt}}for(var xt="",qt=D;qt<=j;qt++){var zt=s[qt];if(i.multiline){if(qt===j){xt+=zt[X]+" ",X=(X+1)%zt.length;continue}if(qt===D){xt+=zt[zt.length-1]+" ";continue}}xt+=zt[0]+" "}switch(xt=xt.substr(xt.length-1)==" "?xt.substr(0,xt.length-1):xt,A=Ng(xt,i,n).width,i.textAlign){case"right":y=l-A-2;break;case"center":y=(l-A)/2;break;case"left":default:y=2}t+=Gi(y)+" "+Gi(L)+` Td
`,t+="("+Uu(xt)+`) Tj
`,t+=-Gi(y)+` 0 Td
`,L=-(n+2),A=0,D=_t?j:j+1,$++,Z=""}break}return r.text=t,r.fontSize=n,r},Ng=function(i,t,e){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),s=t.scope.getStringUnitWidth(i,{font:r,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:s}},sV={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},nV=function(i,t){var e={type:"reference",object:i};t.internal.getPageInfo(i.page).pageContext.annotations.find(function(r){return r.type===e.type&&r.object===e.object})===void 0&&t.internal.getPageInfo(i.page).pageContext.annotations.push(e)},oV=function(i,t){for(var e in i)if(i.hasOwnProperty(e)){var r=e,s=i[e];t.internal.newObjectDeferredBegin(s.objId,!0),Ur(s)==="object"&&typeof s.putStream=="function"&&s.putStream(),delete i[r]}},aV=function(i,t){if(t.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(El.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(sV)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Pv=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new wE,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var s in r)if(r.hasOwnProperty(s)){var n=r[s];n.objId=void 0,n.hasAnnotation&&nV(n,e)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(e){(function(r,s){var n=!r;for(var c in r||(s.internal.newObjectDeferredBegin(s.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),s.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||s.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(c)){var l=r[c],f=[],y=l.Rect;if(l.Rect&&(l.Rect=iV(l.Rect,s)),s.internal.newObjectDeferredBegin(l.objId,!0),l.DA=fi.createDefaultAppearanceStream(l),Ur(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(f=l.getKeyValueListForStream()),l.Rect=y,l.hasAppearanceStream&&!l.appearanceStreamContent){var A=rV(l);f.push({key:"AP",value:"<</N "+A+">>"}),s.internal.acroformPlugin.xForms.push(A)}if(l.appearanceStreamContent){var T="";for(var P in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(P)){var L=l.appearanceStreamContent[P];if(T+="/"+P+" ",T+="<<",Object.keys(L).length>=1||Array.isArray(L)){for(var c in L)if(L.hasOwnProperty(c)){var D=L[c];typeof D=="function"&&(D=D.call(s,l)),T+="/"+c+" "+D+" ",s.internal.acroformPlugin.xForms.indexOf(D)>=0||s.internal.acroformPlugin.xForms.push(D)}}else typeof(D=L)=="function"&&(D=D.call(s,l)),T+="/"+c+" "+D,s.internal.acroformPlugin.xForms.indexOf(D)>=0||s.internal.acroformPlugin.xForms.push(D);T+=">>"}f.push({key:"AP",value:`<<
`+T+">>"})}s.internal.putStream({additionalKeyValues:f,objectId:l.objId}),s.internal.out("endobj")}n&&oV(s.internal.acroformPlugin.xForms,s)})(e,i)}),i.internal.acroformPlugin.isInitialized=!0}},vE=Ps.__acroform__.arrayToPdfArray=function(i,t,e){var r=function(c){return c};if(Array.isArray(i)){for(var s="[",n=0;n<i.length;n++)switch(n!==0&&(s+=" "),Ur(i[n])){case"boolean":case"number":case"object":s+=i[n].toString();break;case"string":i[n].substr(0,1)!=="/"?(t!==void 0&&e&&(r=e.internal.getEncryptor(t)),s+="("+Uu(r(i[n].toString()))+")"):s+=i[n].toString()}return s+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},qy=function(i,t,e){var r=function(s){return s};return t!==void 0&&e&&(r=e.internal.getEncryptor(t)),(i=i||"").toString(),i="("+Uu(r(i))+")"},cc=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};cc.prototype.toString=function(){return this.objId+" 0 R"},cc.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},cc.prototype.getKeyValueListForStream=function(){var i=[],t=Object.getOwnPropertyNames(this).filter(function(n){return n!="content"&&n!="appearanceStreamContent"&&n!="scope"&&n!="objId"&&n.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var r=t[e],s=this[r];s&&(Array.isArray(s)?i.push({key:r,value:vE(s,this.objId,this.scope)}):s instanceof cc?(s.scope=this.scope,i.push({key:r,value:s.objId+" 0 R"})):typeof s!="function"&&i.push({key:r,value:s}))}return i};var bE=function(){cc.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){i=e.trim()},get:function(){return i||null}})};Vo(bE,cc);var wE=function(){cc.call(this);var i,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var e=function(r){return r};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Uu(e(i))+")"}},set:function(e){i=e}})};Vo(wE,cc);var El=function i(){cc.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(Z){if(isNaN(Z))throw new Error('Invalid value "'+Z+'" for attribute F supplied.');t=Z}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!zs(t,3)},set:function(Z){Z?this.F=Us(t,3):this.F=js(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(Z){if(isNaN(Z))throw new Error('Invalid value "'+Z+'" for attribute Ff supplied.');e=Z}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(Z){r=Z!==void 0?Z:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(Z){r[0]=Z}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(Z){r[1]=Z}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(Z){r[2]=Z}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(Z){r[3]=Z}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(Z){switch(Z){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=Z;break;default:throw new Error('Invalid value "'+Z+'" for attribute FT supplied.')}}});var n=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!n||n.length<1){if(this instanceof Pm)return;n="FieldObject"+i.FieldNum++}var Z=function($){return $};return this.scope&&(Z=this.scope.internal.getEncryptor(this.objId)),"("+Uu(Z(n))+")"},set:function(Z){n=Z.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return n},set:function(Z){n=Z}});var c="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return c},set:function(Z){c=Z}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(Z){l=Z}});var f=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return f},set:function(Z){f=Z}});var y=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return y===void 0?50/Pv:y},set:function(Z){y=Z}});var A="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return A},set:function(Z){A=Z}});var T="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!T||this instanceof Pm||this instanceof Lu))return qy(T,this.objId,this.scope)},set:function(Z){Z=Z.toString(),T=Z}});var P=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(P)return this instanceof hn?P:qy(P,this.objId,this.scope)},set:function(Z){Z=Z.toString(),P=this instanceof hn?Z:Z.substr(0,1)==="("?fd(Z.substr(1,Z.length-2)):fd(Z)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof hn?fd(P.substr(1,P.length-1)):P},set:function(Z){Z=Z.toString(),P=this instanceof hn?"/"+Z:Z}});var L=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(L)return L},set:function(Z){this.V=Z}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(L)return this instanceof hn?L:qy(L,this.objId,this.scope)},set:function(Z){Z=Z.toString(),L=this instanceof hn?Z:Z.substr(0,1)==="("?fd(Z.substr(1,Z.length-2)):fd(Z)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof hn?fd(L.substr(1,L.length-1)):L},set:function(Z){Z=Z.toString(),L=this instanceof hn?"/"+Z:Z}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var D,j=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return j},set:function(Z){Z=!!Z,j=Z}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(D)return D},set:function(Z){D=Z}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,1)},set:function(Z){Z?this.Ff=Us(this.Ff,1):this.Ff=js(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,2)},set:function(Z){Z?this.Ff=Us(this.Ff,2):this.Ff=js(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,3)},set:function(Z){Z?this.Ff=Us(this.Ff,3):this.Ff=js(this.Ff,3)}});var X=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(X!==null)return X},set:function(Z){if([0,1,2].indexOf(Z)===-1)throw new Error('Invalid value "'+Z+'" for attribute Q supplied.');X=Z}}),Object.defineProperty(this,"textAlign",{get:function(){var Z;switch(X){case 0:default:Z="left";break;case 1:Z="center";break;case 2:Z="right"}return Z},configurable:!0,enumerable:!0,set:function(Z){switch(Z){case"right":case 2:X=2;break;case"center":case 1:X=1;break;case"left":case 0:default:X=0}}})};Vo(El,cc);var Bd=function(){El.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){i=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return vE(t,this.objId,this.scope)},set:function(e){var r,s;s=[],typeof(r=e)=="string"&&(s=function(n,c,l){l||(l=1);for(var f,y=[];f=c.exec(n);)y.push(f[l]);return y}(r,/\((.*?)\)/g)),t=s}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,r){for(r=r||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,18)},set:function(e){e?this.Ff=Us(this.Ff,18):this.Ff=js(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Us(this.Ff,19):this.Ff=js(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,20)},set:function(e){e?(this.Ff=Us(this.Ff,20),t.sort()):this.Ff=js(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,22)},set:function(e){e?this.Ff=Us(this.Ff,22):this.Ff=js(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,23)},set:function(e){e?this.Ff=Us(this.Ff,23):this.Ff=js(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,27)},set:function(e){e?this.Ff=Us(this.Ff,27):this.Ff=js(this.Ff,27)}}),this.hasAppearanceStream=!1};Vo(Bd,El);var Rd=function(){Bd.call(this),this.fontName="helvetica",this.combo=!1};Vo(Rd,Bd);var kd=function(){Rd.call(this),this.combo=!0};Vo(kd,Rd);var Qg=function(){kd.call(this),this.edit=!0};Vo(Qg,kd);var hn=function(){El.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,15)},set:function(e){e?this.Ff=Us(this.Ff,15):this.Ff=js(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,16)},set:function(e){e?this.Ff=Us(this.Ff,16):this.Ff=js(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,17)},set:function(e){e?this.Ff=Us(this.Ff,17):this.Ff=js(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,26)},set:function(e){e?this.Ff=Us(this.Ff,26):this.Ff=js(this.Ff,26)}});var i,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(n){return n};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var r,s=[];for(r in s.push("<<"),t)s.push("/"+r+" ("+Uu(e(t[r]))+")");return s.push(">>"),s.join(`
`)}},set:function(e){Ur(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(e){i="/"+e}})};Vo(hn,El);var tm=function(){hn.call(this),this.pushButton=!0};Vo(tm,hn);var Od=function(){hn.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t!==void 0?t:[]}})};Vo(Od,hn);var Pm=function(){var i,t;El.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(s){i=s}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(s){t=s}});var e,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(l){return l};this.scope&&(s=this.scope.internal.getEncryptor(this.objId));var n,c=[];for(n in c.push("<<"),r)c.push("/"+n+" ("+Uu(s(r[n]))+")");return c.push(">>"),c.join(`
`)},set:function(s){Ur(s)==="object"&&(r=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(s){typeof s=="string"&&(r.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(s){e=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(s){e="/"+s}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=fi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Vo(Pm,El),Od.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=i.createAppearanceStream(e.optionName),e.caption=i.getCA()}},Od.prototype.createOption=function(i){var t=new Pm;return t.Parent=this,t.optionName=i,this.Kids.push(t),lV.call(this.scope,t),t};var em=function(){hn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=fi.CheckBox.createAppearanceStream()};Vo(em,hn);var Lu=function(){El.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,13)},set:function(t){t?this.Ff=Us(this.Ff,13):this.Ff=js(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,21)},set:function(t){t?this.Ff=Us(this.Ff,21):this.Ff=js(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,23)},set:function(t){t?this.Ff=Us(this.Ff,23):this.Ff=js(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,24)},set:function(t){t?this.Ff=Us(this.Ff,24):this.Ff=js(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,25)},set:function(t){t?this.Ff=Us(this.Ff,25):this.Ff=js(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,26)},set:function(t){t?this.Ff=Us(this.Ff,26):this.Ff=js(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){Number.isInteger(t)&&(i=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Vo(Lu,El);var im=function(){Lu.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!zs(this.Ff,14)},set:function(i){i?this.Ff=Us(this.Ff,14):this.Ff=js(this.Ff,14)}}),this.password=!0};Vo(im,Lu);var fi={CheckBox:{createAppearanceStream:function(){return{N:{On:fi.CheckBox.YesNormal},D:{On:fi.CheckBox.YesPushDown,Off:fi.CheckBox.OffPushDown}}},YesPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=i.scope.internal.getFont(i.fontName,i.fontStyle).id,s=i.scope.__private__.encodeColorString(i.color),n=t_(i,i.caption);return e.push("0.749023 g"),e.push("0 0 "+Gi(fi.internal.getWidth(i))+" "+Gi(fi.internal.getHeight(i))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+r+" "+Gi(n.fontSize)+" Tf "+s),e.push("BT"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(i){var t=rc(i);t.scope=i.scope;var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),s=[],n=fi.internal.getHeight(i),c=fi.internal.getWidth(i),l=t_(i,i.caption);return s.push("1 g"),s.push("0 0 "+Gi(c)+" "+Gi(n)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+Gi(c-1)+" "+Gi(n-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+e+" "+Gi(l.fontSize)+" Tf "+r),s.push(l.text),s.push("ET"),s.push("Q"),t.stream=s.join(`
`),t},OffPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Gi(fi.internal.getWidth(i))+" "+Gi(fi.internal.getHeight(i))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(i){var t={D:{Off:fi.RadioButton.Circle.OffPushDown},N:{}};return t.N[i]=fi.RadioButton.Circle.YesNormal,t.D[i]=fi.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.getWidth(i)<=fi.internal.getHeight(i)?fi.internal.getWidth(i)/4:fi.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var s=fi.internal.Bezier_C,n=Number((r*s).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+Nh(fi.internal.getWidth(i)/2)+" "+Nh(fi.internal.getHeight(i)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+n+" "+n+" "+r+" 0 "+r+" c"),e.push("-"+n+" "+r+" -"+r+" "+n+" -"+r+" 0 c"),e.push("-"+r+" -"+n+" -"+n+" -"+r+" 0 -"+r+" c"),e.push(n+" -"+r+" "+r+" -"+n+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.getWidth(i)<=fi.internal.getHeight(i)?fi.internal.getWidth(i)/4:fi.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),n=Number((s*fi.internal.Bezier_C).toFixed(5)),c=Number((r*fi.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Nh(fi.internal.getWidth(i)/2)+" "+Nh(fi.internal.getHeight(i)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+n+" "+n+" "+s+" 0 "+s+" c"),e.push("-"+n+" "+s+" -"+s+" "+n+" -"+s+" 0 c"),e.push("-"+s+" -"+n+" -"+n+" -"+s+" 0 -"+s+" c"),e.push(n+" -"+s+" "+s+" -"+n+" "+s+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+Nh(fi.internal.getWidth(i)/2)+" "+Nh(fi.internal.getHeight(i)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+c+" "+c+" "+r+" 0 "+r+" c"),e.push("-"+c+" "+r+" -"+r+" "+c+" -"+r+" 0 c"),e.push("-"+r+" -"+c+" -"+c+" -"+r+" 0 -"+r+" c"),e.push(c+" -"+r+" "+r+" -"+c+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.getWidth(i)<=fi.internal.getHeight(i)?fi.internal.getWidth(i)/4:fi.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),n=Number((s*fi.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Nh(fi.internal.getWidth(i)/2)+" "+Nh(fi.internal.getHeight(i)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+n+" "+n+" "+s+" 0 "+s+" c"),e.push("-"+n+" "+s+" -"+s+" "+n+" -"+s+" 0 c"),e.push("-"+s+" -"+n+" -"+n+" -"+s+" 0 -"+s+" c"),e.push(n+" -"+s+" "+s+" -"+n+" "+s+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(i){var t={D:{Off:fi.RadioButton.Cross.OffPushDown},N:{}};return t.N[i]=fi.RadioButton.Cross.YesNormal,t.D[i]=fi.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.calculateCross(i);return e.push("q"),e.push("1 1 "+Gi(fi.internal.getWidth(i)-2)+" "+Gi(fi.internal.getHeight(i)-2)+" re"),e.push("W"),e.push("n"),e.push(Gi(r.x1.x)+" "+Gi(r.x1.y)+" m"),e.push(Gi(r.x2.x)+" "+Gi(r.x2.y)+" l"),e.push(Gi(r.x4.x)+" "+Gi(r.x4.y)+" m"),e.push(Gi(r.x3.x)+" "+Gi(r.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=fi.internal.calculateCross(i),r=[];return r.push("0.749023 g"),r.push("0 0 "+Gi(fi.internal.getWidth(i))+" "+Gi(fi.internal.getHeight(i))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Gi(fi.internal.getWidth(i)-2)+" "+Gi(fi.internal.getHeight(i)-2)+" re"),r.push("W"),r.push("n"),r.push(Gi(e.x1.x)+" "+Gi(e.x1.y)+" m"),r.push(Gi(e.x2.x)+" "+Gi(e.x2.y)+" l"),r.push(Gi(e.x4.x)+" "+Gi(e.x4.y)+" m"),r.push(Gi(e.x3.x)+" "+Gi(e.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Gi(fi.internal.getWidth(i))+" "+Gi(fi.internal.getHeight(i))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(i){var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,e=i.scope.__private__.encodeColorString(i.color);return"/"+t+" "+i.fontSize+" Tf "+e}};fi.internal={Bezier_C:.551915024494,calculateCross:function(i){var t=fi.internal.getWidth(i),e=fi.internal.getHeight(i),r=Math.min(t,e);return{x1:{x:(t-r)/2,y:(e-r)/2+r},x2:{x:(t-r)/2+r,y:(e-r)/2},x3:{x:(t-r)/2,y:(e-r)/2},x4:{x:(t-r)/2+r,y:(e-r)/2+r}}}},fi.internal.getWidth=function(i){var t=0;return Ur(i)==="object"&&(t=O5(i.Rect[2])),t},fi.internal.getHeight=function(i){var t=0;return Ur(i)==="object"&&(t=O5(i.Rect[3])),t};var lV=Ps.addField=function(i){if(aV(this,i),!(i instanceof El))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=i).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Ps.AcroFormChoiceField=Bd,Ps.AcroFormListBox=Rd,Ps.AcroFormComboBox=kd,Ps.AcroFormEditBox=Qg,Ps.AcroFormButton=hn,Ps.AcroFormPushButton=tm,Ps.AcroFormRadioButton=Od,Ps.AcroFormCheckBox=em,Ps.AcroFormTextField=Lu,Ps.AcroFormPasswordField=im,Ps.AcroFormAppearance=fi,Ps.AcroForm={ChoiceField:Bd,ListBox:Rd,ComboBox:kd,EditBox:Qg,Button:hn,PushButton:tm,RadioButton:Od,CheckBox:em,TextField:Lu,PasswordField:im,Appearance:fi},Bi.AcroForm={ChoiceField:Bd,ListBox:Rd,ComboBox:kd,EditBox:Qg,Button:hn,PushButton:tm,RadioButton:Od,CheckBox:em,TextField:Lu,PasswordField:im,Appearance:fi};function xE(i){return i.reduce(function(t,e,r){return t[e]=r,t},{})}(function(i){i.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(ct,pt){var Bt,bt,ne,oe,le,Qt=t;if((pt=pt||t)==="RGBA"||ct.data!==void 0&&ct.data instanceof Uint8ClampedArray&&"height"in ct&&"width"in ct)return"RGBA";if(Nt(ct))for(le in e)for(ne=e[le],Bt=0;Bt<ne.length;Bt+=1){for(oe=!0,bt=0;bt<ne[Bt].length;bt+=1)if(ne[Bt][bt]!==void 0&&ne[Bt][bt]!==ct[bt]){oe=!1;break}if(oe===!0){Qt=le;break}}else for(le in e)for(ne=e[le],Bt=0;Bt<ne.length;Bt+=1){for(oe=!0,bt=0;bt<ne[Bt].length;bt+=1)if(ne[Bt][bt]!==void 0&&ne[Bt][bt]!==ct.charCodeAt(bt)){oe=!1;break}if(oe===!0){Qt=le;break}}return Qt===t&&pt!==t&&(Qt=pt),Qt},s=function ct(pt){for(var Bt=this.internal.write,bt=this.internal.putStream,ne=(0,this.internal.getFilters)();ne.indexOf("FlateEncode")!==-1;)ne.splice(ne.indexOf("FlateEncode"),1);pt.objectId=this.internal.newObject();var oe=[];if(oe.push({key:"Type",value:"/XObject"}),oe.push({key:"Subtype",value:"/Image"}),oe.push({key:"Width",value:pt.width}),oe.push({key:"Height",value:pt.height}),pt.colorSpace===X.INDEXED?oe.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(pt.palette.length/3-1)+" "+("sMask"in pt&&pt.sMask!==void 0?pt.objectId+2:pt.objectId+1)+" 0 R]"}):(oe.push({key:"ColorSpace",value:"/"+pt.colorSpace}),pt.colorSpace===X.DEVICE_CMYK&&oe.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),oe.push({key:"BitsPerComponent",value:pt.bitsPerComponent}),"decodeParameters"in pt&&pt.decodeParameters!==void 0&&oe.push({key:"DecodeParms",value:"<<"+pt.decodeParameters+">>"}),"transparency"in pt&&Array.isArray(pt.transparency)){for(var le="",Qt=0,fe=pt.transparency.length;Qt<fe;Qt++)le+=pt.transparency[Qt]+" "+pt.transparency[Qt]+" ";oe.push({key:"Mask",value:"["+le+"]"})}pt.sMask!==void 0&&oe.push({key:"SMask",value:pt.objectId+1+" 0 R"});var de=pt.filter!==void 0?["/"+pt.filter]:void 0;if(bt({data:pt.data,additionalKeyValues:oe,alreadyAppliedFilters:de,objectId:pt.objectId}),Bt("endobj"),"sMask"in pt&&pt.sMask!==void 0){var Me="/Predictor "+pt.predictor+" /Colors 1 /BitsPerComponent "+pt.bitsPerComponent+" /Columns "+pt.width,nt={width:pt.width,height:pt.height,colorSpace:"DeviceGray",bitsPerComponent:pt.bitsPerComponent,decodeParameters:Me,data:pt.sMask};"filter"in pt&&(nt.filter=pt.filter),ct.call(this,nt)}if(pt.colorSpace===X.INDEXED){var Et=this.internal.newObject();bt({data:xt(new Uint8Array(pt.palette)),objectId:Et}),Bt("endobj")}},n=function(){var ct=this.internal.collections.addImage_images;for(var pt in ct)s.call(this,ct[pt])},c=function(){var ct,pt=this.internal.collections.addImage_images,Bt=this.internal.write;for(var bt in pt)Bt("/I"+(ct=pt[bt]).index,ct.objectId,"0","R")},l=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",n),this.internal.events.subscribe("putXobjectDict",c))},f=function(){var ct=this.internal.collections.addImage_images;return l.call(this),ct},y=function(){return Object.keys(this.internal.collections.addImage_images).length},A=function(ct){return typeof i["process"+ct.toUpperCase()]=="function"},T=function(ct){return Ur(ct)==="object"&&ct.nodeType===1},P=function(ct,pt){if(ct.nodeName==="IMG"&&ct.hasAttribute("src")){var Bt=""+ct.getAttribute("src");if(Bt.indexOf("data:image/")===0)return ef(unescape(Bt).split("base64,").pop());var bt=i.loadFile(Bt,!0);if(bt!==void 0)return bt}if(ct.nodeName==="CANVAS"){if(ct.width===0||ct.height===0)throw new Error("Given canvas must have data. Canvas width: "+ct.width+", height: "+ct.height);var ne;switch(pt){case"PNG":ne="image/png";break;case"WEBP":ne="image/webp";break;case"JPEG":case"JPG":default:ne="image/jpeg"}return ef(ct.toDataURL(ne,1).split("base64,").pop())}},L=function(ct){var pt=this.internal.collections.addImage_images;if(pt){for(var Bt in pt)if(ct===pt[Bt].alias)return pt[Bt]}},D=function(ct,pt,Bt){return ct||pt||(ct=-96,pt=-96),ct<0&&(ct=-1*Bt.width*72/ct/this.internal.scaleFactor),pt<0&&(pt=-1*Bt.height*72/pt/this.internal.scaleFactor),ct===0&&(ct=pt*Bt.width/Bt.height),pt===0&&(pt=ct*Bt.height/Bt.width),[ct,pt]},j=function(ct,pt,Bt,bt,ne,oe){var le=D.call(this,Bt,bt,ne),Qt=this.internal.getCoordinateString,fe=this.internal.getVerticalCoordinateString,de=f.call(this);if(Bt=le[0],bt=le[1],de[ne.index]=ne,oe){oe*=Math.PI/180;var Me=Math.cos(oe),nt=Math.sin(oe),Et=function(Gt){return Gt.toFixed(4)},Lt=[Et(Me),Et(nt),Et(-1*nt),Et(Me),0,0,"cm"]}this.internal.write("q"),oe?(this.internal.write([1,"0","0",1,Qt(ct),fe(pt+bt),"cm"].join(" ")),this.internal.write(Lt.join(" ")),this.internal.write([Qt(Bt),"0","0",Qt(bt),"0","0","cm"].join(" "))):this.internal.write([Qt(Bt),"0","0",Qt(bt),Qt(ct),fe(pt+bt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+ne.index+" Do"),this.internal.write("Q")},X=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var Z=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},$=i.__addimage__.sHashCode=function(ct){var pt,Bt,bt=0;if(typeof ct=="string")for(Bt=ct.length,pt=0;pt<Bt;pt++)bt=(bt<<5)-bt+ct.charCodeAt(pt),bt|=0;else if(Nt(ct))for(Bt=ct.byteLength/2,pt=0;pt<Bt;pt++)bt=(bt<<5)-bt+ct[pt],bt|=0;return bt},ht=i.__addimage__.validateStringAsBase64=function(ct){(ct=ct||"").toString().trim();var pt=!0;return ct.length===0&&(pt=!1),ct.length%4!=0&&(pt=!1),/^[A-Za-z0-9+/]+$/.test(ct.substr(0,ct.length-2))===!1&&(pt=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(ct.substr(-2))===!1&&(pt=!1),pt},_t=i.__addimage__.extractImageFromDataUrl=function(ct){var pt=(ct=ct||"").split("base64,"),Bt=null;if(pt.length===2){var bt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(pt[0]);Array.isArray(bt)&&(Bt={mimeType:bt[1],charset:bt[2],data:pt[1]})}return Bt},Mt=i.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};i.__addimage__.isArrayBuffer=function(ct){return Mt()&&ct instanceof ArrayBuffer};var Nt=i.__addimage__.isArrayBufferView=function(ct){return Mt()&&typeof Uint32Array<"u"&&(ct instanceof Int8Array||ct instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&ct instanceof Uint8ClampedArray||ct instanceof Int16Array||ct instanceof Uint16Array||ct instanceof Int32Array||ct instanceof Uint32Array||ct instanceof Float32Array||ct instanceof Float64Array)},Rt=i.__addimage__.binaryStringToUint8Array=function(ct){for(var pt=ct.length,Bt=new Uint8Array(pt),bt=0;bt<pt;bt++)Bt[bt]=ct.charCodeAt(bt);return Bt},xt=i.__addimage__.arrayBufferToBinaryString=function(ct){for(var pt="",Bt=Nt(ct)?ct:new Uint8Array(ct),bt=0;bt<Bt.length;bt+=8192)pt+=String.fromCharCode.apply(null,Bt.subarray(bt,bt+8192));return pt};i.addImage=function(){var ct,pt,Bt,bt,ne,oe,le,Qt,fe;if(typeof arguments[1]=="number"?(pt=t,Bt=arguments[1],bt=arguments[2],ne=arguments[3],oe=arguments[4],le=arguments[5],Qt=arguments[6],fe=arguments[7]):(pt=arguments[1],Bt=arguments[2],bt=arguments[3],ne=arguments[4],oe=arguments[5],le=arguments[6],Qt=arguments[7],fe=arguments[8]),Ur(ct=arguments[0])==="object"&&!T(ct)&&"imageData"in ct){var de=ct;ct=de.imageData,pt=de.format||pt||t,Bt=de.x||Bt||0,bt=de.y||bt||0,ne=de.w||de.width||ne,oe=de.h||de.height||oe,le=de.alias||le,Qt=de.compression||Qt,fe=de.rotation||de.angle||fe}var Me=this.internal.getFilters();if(Qt===void 0&&Me.indexOf("FlateEncode")!==-1&&(Qt="SLOW"),isNaN(Bt)||isNaN(bt))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var nt=qt.call(this,ct,pt,le,Qt);return j.call(this,Bt,bt,ne,oe,nt,fe),this};var qt=function(ct,pt,Bt,bt){var ne,oe,le;if(typeof ct=="string"&&r(ct)===t){ct=unescape(ct);var Qt=zt(ct,!1);(Qt!==""||(Qt=i.loadFile(ct,!0))!==void 0)&&(ct=Qt)}if(T(ct)&&(ct=P(ct,pt)),pt=r(ct,pt),!A(pt))throw new Error("addImage does not support files of type '"+pt+"', please ensure that a plugin for '"+pt+"' support is added.");if(((le=Bt)==null||le.length===0)&&(Bt=function(fe){return typeof fe=="string"||Nt(fe)?$(fe):Nt(fe.data)?$(fe.data):null}(ct)),(ne=L.call(this,Bt))||(Mt()&&(ct instanceof Uint8Array||pt==="RGBA"||(oe=ct,ct=Rt(ct))),ne=this["process"+pt.toUpperCase()](ct,y.call(this),Bt,function(fe){return fe&&typeof fe=="string"&&(fe=fe.toUpperCase()),fe in i.image_compression?fe:Z.NONE}(bt),oe)),!ne)throw new Error("An unknown error occurred whilst processing the image.");return ne},zt=i.__addimage__.convertBase64ToBinaryString=function(ct,pt){var Bt;pt=typeof pt!="boolean"||pt;var bt,ne="";if(typeof ct=="string"){bt=(Bt=_t(ct))!==null?Bt.data:ct;try{ne=ef(bt)}catch(oe){if(pt)throw ht(bt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+oe.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return ne};i.getImageProperties=function(ct){var pt,Bt,bt="";if(T(ct)&&(ct=P(ct)),typeof ct=="string"&&r(ct)===t&&((bt=zt(ct,!1))===""&&(bt=i.loadFile(ct)||""),ct=bt),Bt=r(ct),!A(Bt))throw new Error("addImage does not support files of type '"+Bt+"', please ensure that a plugin for '"+Bt+"' support is added.");if(!Mt()||ct instanceof Uint8Array||(ct=Rt(ct)),!(pt=this["process"+Bt.toUpperCase()](ct)))throw new Error("An unknown error occurred whilst processing the image");return pt.fileType=Bt,pt}})(Bi.API),function(i){var t=function(e){if(e!==void 0&&e!="")return!0};Bi.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(e){for(var r,s,n,c=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,f=this.internal.getPageInfoByObjId(e.objId),y=e.pageContext.annotations,A=!1,T=0;T<y.length&&!A;T++)switch((r=y[T]).type){case"link":(t(r.options.url)||t(r.options.pageNumber))&&(A=!0);break;case"reference":case"text":case"freetext":A=!0}if(A!=0){this.internal.write("/Annots [");for(var P=0;P<y.length;P++){r=y[P];var L=this.internal.pdfEscape,D=this.internal.getEncryptor(e.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var j=this.internal.newAdditionalObject(),X=this.internal.newAdditionalObject(),Z=this.internal.getEncryptor(j.objId),$=r.title||"Note";n="<</Type /Annot /Subtype /Text "+(s="/Rect ["+c(r.bounds.x)+" "+l(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y)+"] ")+"/Contents ("+L(Z(r.contents))+")",n+=" /Popup "+X.objId+" 0 R",n+=" /P "+f.objId+" 0 R",n+=" /T ("+L(Z($))+") >>",j.content=n;var ht=j.objId+" 0 R";n="<</Type /Annot /Subtype /Popup "+(s="/Rect ["+c(r.bounds.x+30)+" "+l(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w+30)+" "+l(r.bounds.y)+"] ")+" /Parent "+ht,r.open&&(n+=" /Open true"),n+=" >>",X.content=n,this.internal.write(j.objId,"0 R",X.objId,"0 R");break;case"freetext":s="/Rect ["+c(r.bounds.x)+" "+l(r.bounds.y)+" "+c(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y+r.bounds.h)+"] ";var _t=r.color||"#000000";n="<</Type /Annot /Subtype /FreeText "+s+"/Contents ("+L(D(r.contents))+")",n+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+_t+")",n+=" /Border [0 0 0]",n+=" >>",this.internal.write(n);break;case"link":if(r.options.name){var Mt=this.annotations._nameMap[r.options.name];r.options.pageNumber=Mt.page,r.options.top=Mt.y}else r.options.top||(r.options.top=0);if(s="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",n="",r.options.url)n="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /A <</S /URI /URI ("+L(D(r.options.url))+") >>";else if(r.options.pageNumber)switch(n="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":n+=" /Fit]";break;case"FitH":n+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,n+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var Nt=l(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),n+=" /XYZ "+r.options.left+" "+Nt+" "+r.options.zoom+"]"}n!=""&&(n+=" >>",this.internal.write(n))}}this.internal.write("]")}}]),i.createAnnotation=function(e){var r=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":r.pageContext.annotations.push(e)}},i.link=function(e,r,s,n,c){var l=this.internal.getCurrentPageInfo(),f=this.internal.getCoordinateString,y=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:f(e),y:y(r),w:f(e+s),h:y(r+n)},options:c,type:"link"})},i.textWithLink=function(e,r,s,n){var c,l,f=this.getTextWidth(e),y=this.internal.getLineHeight()/this.internal.scaleFactor;if(n.maxWidth!==void 0){l=n.maxWidth;var A=this.splitTextToSize(e,l).length;c=Math.ceil(y*A)}else l=f,c=y;return this.text(e,r,s,n),s+=.2*y,n.align==="center"&&(r-=f/2),n.align==="right"&&(r-=f),this.link(r,s-y,l,c,n),f},i.getTextWidth=function(e){var r=this.internal.getFontSize();return this.getStringUnitWidth(e)*r/this.internal.scaleFactor}}(Bi.API),function(i){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];i.__arabicParser__={};var n=i.__arabicParser__.isInArabicSubstitutionA=function(j){return t[j.charCodeAt(0)]!==void 0},c=i.__arabicParser__.isArabicLetter=function(j){return typeof j=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(j)},l=i.__arabicParser__.isArabicEndLetter=function(j){return c(j)&&n(j)&&t[j.charCodeAt(0)].length<=2},f=i.__arabicParser__.isArabicAlfLetter=function(j){return c(j)&&s.indexOf(j.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function(j){return c(j)&&n(j)&&t[j.charCodeAt(0)].length>=1};var y=i.__arabicParser__.arabicLetterHasFinalForm=function(j){return c(j)&&n(j)&&t[j.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function(j){return c(j)&&n(j)&&t[j.charCodeAt(0)].length>=3};var A=i.__arabicParser__.arabicLetterHasMedialForm=function(j){return c(j)&&n(j)&&t[j.charCodeAt(0)].length==4},T=i.__arabicParser__.resolveLigatures=function(j){var X=0,Z=e,$="",ht=0;for(X=0;X<j.length;X+=1)Z[j.charCodeAt(X)]!==void 0?(ht++,typeof(Z=Z[j.charCodeAt(X)])=="number"&&($+=String.fromCharCode(Z),Z=e,ht=0),X===j.length-1&&(Z=e,$+=j.charAt(X-(ht-1)),X-=ht-1,ht=0)):(Z=e,$+=j.charAt(X-ht),X-=ht,ht=0);return $};i.__arabicParser__.isArabicDiacritic=function(j){return j!==void 0&&r[j.charCodeAt(0)]!==void 0};var P=i.__arabicParser__.getCorrectForm=function(j,X,Z){return c(j)?n(j)===!1?-1:!y(j)||!c(X)&&!c(Z)||!c(Z)&&l(X)||l(j)&&!c(X)||l(j)&&f(X)||l(j)&&l(X)?0:A(j)&&c(X)&&!l(X)&&c(Z)&&y(Z)?3:l(j)||!c(Z)?1:2:-1},L=function(j){var X=0,Z=0,$=0,ht="",_t="",Mt="",Nt=(j=j||"").split("\\s+"),Rt=[];for(X=0;X<Nt.length;X+=1){for(Rt.push(""),Z=0;Z<Nt[X].length;Z+=1)ht=Nt[X][Z],_t=Nt[X][Z-1],Mt=Nt[X][Z+1],c(ht)?($=P(ht,_t,Mt),Rt[X]+=$!==-1?String.fromCharCode(t[ht.charCodeAt(0)][$]):ht):Rt[X]+=ht;Rt[X]=T(Rt[X])}return Rt.join(" ")},D=i.__arabicParser__.processArabic=i.processArabic=function(){var j,X=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,Z=[];if(Array.isArray(X)){var $=0;for(Z=[],$=0;$<X.length;$+=1)Array.isArray(X[$])?Z.push([L(X[$][0]),X[$][1],X[$][2]]):Z.push([L(X[$])]);j=Z}else j=L(X);return typeof arguments[0]=="string"?j:(arguments[0].text=j,arguments[0])};i.events.push(["preProcessText",D])}(Bi.API),Bi.API.autoPrint=function(i){var t;switch((i=i||{}).variant=i.variant||"non-conform",i.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(i){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(l){e=l}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var s=300;Object.defineProperty(this,"height",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=s+1)}});var n=[];Object.defineProperty(this,"childNodes",{get:function(){return n},set:function(l){n=l}});var c={};Object.defineProperty(this,"style",{get:function(){return c},set:function(l){c=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,r){var s;if((e=e||"2d")!=="2d")return null;for(s in r)this.pdf.context2d.hasOwnProperty(s)&&(this.pdf.context2d[s]=r[s]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Bi.API),function(i){var t={left:0,top:0,bottom:0,right:0},e=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new n,this.internal.__cell__.pages=1},n=function(){var f=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return f},set:function(j){f=j}});var y=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return y},set:function(j){y=j}});var A=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return A},set:function(j){A=j}});var T=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return T},set:function(j){T=j}});var P=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return P},set:function(j){P=j}});var L=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return L},set:function(j){L=j}});var D=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return D},set:function(j){D=j}}),this};n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},n.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(f){return r.call(this),this.internal.__cell__.headerFunction=typeof f=="function"?f:void 0,this},i.getTextDimensions=function(f,y){r.call(this);var A=(y=y||{}).fontSize||this.getFontSize(),T=y.font||this.getFont(),P=y.scaleFactor||this.internal.scaleFactor,L=0,D=0,j=0,X=this;if(!Array.isArray(f)&&typeof f!="string"){if(typeof f!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");f=String(f)}var Z=y.maxWidth;Z>0?typeof f=="string"?f=this.splitTextToSize(f,Z):Object.prototype.toString.call(f)==="[object Array]"&&(f=f.reduce(function(ht,_t){return ht.concat(X.splitTextToSize(_t,Z))},[])):f=Array.isArray(f)?f:[f];for(var $=0;$<f.length;$++)L<(j=this.getStringUnitWidth(f[$],{font:T})*A)&&(L=j);return L!==0&&(D=f.length),{w:L/=P,h:Math.max((D*A*this.getLineHeightFactor()-A*(this.getLineHeightFactor()-1))/P,0)}},i.cellAddPage=function(){r.call(this),this.addPage();var f=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new n(f.left,f.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var c=i.cell=function(){var f;f=arguments[0]instanceof n?arguments[0]:new n(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var y=this.internal.__cell__.lastCell,A=this.internal.__cell__.padding,T=this.internal.__cell__.margins||t,P=this.internal.__cell__.tableHeaderRow,L=this.internal.__cell__.printHeaders;return y.lineNumber!==void 0&&(y.lineNumber===f.lineNumber?(f.x=(y.x||0)+(y.width||0),f.y=y.y||0):y.y+y.height+f.height+T.bottom>this.getPageHeight()?(this.cellAddPage(),f.y=T.top,L&&P&&(this.printHeaderRow(f.lineNumber,!0),f.y+=P[0].height)):f.y=y.y+y.height||f.y),f.text[0]!==void 0&&(this.rect(f.x,f.y,f.width,f.height,e===!0?"FD":void 0),f.align==="right"?this.text(f.text,f.x+f.width-A,f.y+A,{align:"right",baseline:"top"}):f.align==="center"?this.text(f.text,f.x+f.width/2,f.y+A,{align:"center",baseline:"top",maxWidth:f.width-A-A}):this.text(f.text,f.x+A,f.y+A,{align:"left",baseline:"top",maxWidth:f.width-A-A})),this.internal.__cell__.lastCell=f,this};i.table=function(f,y,A,T,P){if(r.call(this),!A)throw new Error("No data for PDF table.");var L,D,j,X,Z=[],$=[],ht=[],_t={},Mt={},Nt=[],Rt=[],xt=(P=P||{}).autoSize||!1,qt=P.printHeaders!==!1,zt=P.css&&P.css["font-size"]!==void 0?16*P.css["font-size"]:P.fontSize||12,ct=P.margins||Object.assign({width:this.getPageWidth()},t),pt=typeof P.padding=="number"?P.padding:3,Bt=P.headerBackgroundColor||"#c8c8c8",bt=P.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=qt,this.internal.__cell__.margins=ct,this.internal.__cell__.table_font_size=zt,this.internal.__cell__.padding=pt,this.internal.__cell__.headerBackgroundColor=Bt,this.internal.__cell__.headerTextColor=bt,this.setFontSize(zt),T==null)$=Z=Object.keys(A[0]),ht=Z.map(function(){return"left"});else if(Array.isArray(T)&&Ur(T[0])==="object")for(Z=T.map(function(de){return de.name}),$=T.map(function(de){return de.prompt||de.name||""}),ht=T.map(function(de){return de.align||"left"}),L=0;L<T.length;L+=1)Mt[T[L].name]=T[L].width*(19.049976/25.4);else Array.isArray(T)&&typeof T[0]=="string"&&($=Z=T,ht=Z.map(function(){return"left"}));if(xt||Array.isArray(T)&&typeof T[0]=="string")for(L=0;L<Z.length;L+=1){for(_t[X=Z[L]]=A.map(function(de){return de[X]}),this.setFont(void 0,"bold"),Nt.push(this.getTextDimensions($[L],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),D=_t[X],this.setFont(void 0,"normal"),j=0;j<D.length;j+=1)Nt.push(this.getTextDimensions(D[j],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Mt[X]=Math.max.apply(null,Nt)+pt+pt,Nt=[]}if(qt){var ne={};for(L=0;L<Z.length;L+=1)ne[Z[L]]={},ne[Z[L]].text=$[L],ne[Z[L]].align=ht[L];var oe=l.call(this,ne,Mt);Rt=Z.map(function(de){return new n(f,y,Mt[de],oe,ne[de].text,void 0,ne[de].align)}),this.setTableHeaderRow(Rt),this.printHeaderRow(1,!1)}var le=T.reduce(function(de,Me){return de[Me.name]=Me.align,de},{});for(L=0;L<A.length;L+=1){"rowStart"in P&&P.rowStart instanceof Function&&P.rowStart({row:L,data:A[L]},this);var Qt=l.call(this,A[L],Mt);for(j=0;j<Z.length;j+=1){var fe=A[L][Z[j]];"cellStart"in P&&P.cellStart instanceof Function&&P.cellStart({row:L,col:j,data:fe},this),c.call(this,new n(f,y,Mt[Z[j]],Qt,fe,L+2,le[Z[j]]))}}return this.internal.__cell__.table_x=f,this.internal.__cell__.table_y=y,this};var l=function(f,y){var A=this.internal.__cell__.padding,T=this.internal.__cell__.table_font_size,P=this.internal.scaleFactor;return Object.keys(f).map(function(L){var D=f[L];return this.splitTextToSize(D.hasOwnProperty("text")?D.text:D,y[L]-A-A)},this).map(function(L){return this.getLineHeightFactor()*L.length*T/P+A+A},this).reduce(function(L,D){return Math.max(L,D)},0)};i.setTableHeaderRow=function(f){r.call(this),this.internal.__cell__.tableHeaderRow=f},i.printHeaderRow=function(f,y){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var A;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var T=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new n(T[0],T[1],T[2],T[3],void 0,-1)}this.setFont(void 0,"bold");for(var P=[],L=0;L<this.internal.__cell__.tableHeaderRow.length;L+=1){A=this.internal.__cell__.tableHeaderRow[L].clone(),y&&(A.y=this.internal.__cell__.margins.top||0,P.push(A)),A.lineNumber=f;var D=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),c.call(this,A),this.setTextColor(D)}P.length>0&&this.setTableHeaderRow(P),this.setFont(void 0,"normal"),e=!1}}(Bi.API);var AE={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},SE=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],e_=xE(SE),EE=[100,200,300,400,500,600,700,800,900],cV=xE(EE);function i_(i){var t=i.family.replace(/"|'/g,"").toLowerCase(),e=function(n){return AE[n=n||"normal"]?n:"normal"}(i.style),r=function(n){if(!n)return 400;if(typeof n=="number")return n>=100&&n<=900&&n%100==0?n:400;if(/^\d00$/.test(n))return parseInt(n);switch(n){case"bold":return 700;case"normal":default:return 400}}(i.weight),s=function(n){return typeof e_[n=n||"normal"]=="number"?n:"normal"}(i.stretch);return{family:t,style:e,weight:r,stretch:s,src:i.src||[],ref:i.ref||{name:t,style:[s,e,r].join(" ")}}}function F5(i,t,e,r){var s;for(s=e;s>=0&&s<t.length;s+=r)if(i[t[s]])return i[t[s]];for(s=e;s>=0&&s<t.length;s-=r)if(i[t[s]])return i[t[s]]}var hV={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},N5={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function D5(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function uV(i,t,e){for(var r=(e=e||{}).defaultFontFamily||"times",s=Object.assign({},hV,e.genericFontFamilies||{}),n=null,c=null,l=0;l<t.length;++l)if(s[(n=i_(t[l])).family]&&(n.family=s[n.family]),i.hasOwnProperty(n.family)){c=i[n.family];break}if(!(c=c||i[r]))throw new Error("Could not find a font-family for the rule '"+D5(n)+"' and default family '"+r+"'.");if(c=function(f,y){if(y[f])return y[f];var A=e_[f],T=A<=e_.normal?-1:1,P=F5(y,SE,A,T);if(!P)throw new Error("Could not find a matching font-stretch value for "+f);return P}(n.stretch,c),c=function(f,y){if(y[f])return y[f];for(var A=AE[f],T=0;T<A.length;++T)if(y[A[T]])return y[A[T]];throw new Error("Could not find a matching font-style for "+f)}(n.style,c),!(c=function(f,y){if(y[f])return y[f];if(f===400&&y[500])return y[500];if(f===500&&y[400])return y[400];var A=cV[f],T=F5(y,EE,A,f<400?-1:1);if(!T)throw new Error("Could not find a matching font-weight for value "+f);return T}(n.weight,c)))throw new Error("Failed to resolve a font for the rule '"+D5(n)+"'.");return c}function z5(i){return i.trimLeft()}function dV(i,t){for(var e=0;e<i.length;){if(i.charAt(e)===t)return[i.substring(0,e),i.substring(e+1)];e+=1}return null}function pV(i){var t=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],i.substring(t[0].length)]}var Dg,U5,j5,G5=["times"];(function(i){var t,e,r,s,n,c,l,f,y,A=function(nt){return nt=nt||{},this.isStrokeTransparent=nt.isStrokeTransparent||!1,this.strokeOpacity=nt.strokeOpacity||1,this.strokeStyle=nt.strokeStyle||"#000000",this.fillStyle=nt.fillStyle||"#000000",this.isFillTransparent=nt.isFillTransparent||!1,this.fillOpacity=nt.fillOpacity||1,this.font=nt.font||"10px sans-serif",this.textBaseline=nt.textBaseline||"alphabetic",this.textAlign=nt.textAlign||"left",this.lineWidth=nt.lineWidth||1,this.lineJoin=nt.lineJoin||"miter",this.lineCap=nt.lineCap||"butt",this.path=nt.path||[],this.transform=nt.transform!==void 0?nt.transform.clone():new f,this.globalCompositeOperation=nt.globalCompositeOperation||"normal",this.globalAlpha=nt.globalAlpha||1,this.clip_path=nt.clip_path||[],this.currentPoint=nt.currentPoint||new c,this.miterLimit=nt.miterLimit||10,this.lastPoint=nt.lastPoint||new c,this.lineDashOffset=nt.lineDashOffset||0,this.lineDash=nt.lineDash||[],this.margin=nt.margin||[0,0,0,0],this.prevPageLastElemOffset=nt.prevPageLastElemOffset||0,this.ignoreClearRect=typeof nt.ignoreClearRect!="boolean"||nt.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new T(this),t=this.internal.f2,e=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,n=this.internal.getVerticalCoordinate,c=this.internal.Point,l=this.internal.Rectangle,f=this.internal.Matrix,y=new A}]);var T=function(nt){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Et=nt;Object.defineProperty(this,"pdf",{get:function(){return Et}});var Lt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Lt},set:function(he){Lt=!!he}});var Gt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Gt},set:function(he){Gt=!!he}});var Wt=0;Object.defineProperty(this,"posX",{get:function(){return Wt},set:function(he){isNaN(he)||(Wt=he)}});var $t=0;Object.defineProperty(this,"posY",{get:function(){return $t},set:function(he){isNaN(he)||($t=he)}}),Object.defineProperty(this,"margin",{get:function(){return y.margin},set:function(he){var ot;typeof he=="number"?ot=[he,he,he,he]:((ot=new Array(4))[0]=he[0],ot[1]=he.length>=2?he[1]:ot[0],ot[2]=he.length>=3?he[2]:ot[0],ot[3]=he.length>=4?he[3]:ot[1]),y.margin=ot}});var ee=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ee},set:function(he){ee=he}});var Kt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Kt},set:function(he){Kt=he}});var Ce=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ce},set:function(he){Ce=he}}),Object.defineProperty(this,"ctx",{get:function(){return y},set:function(he){he instanceof A&&(y=he)}}),Object.defineProperty(this,"path",{get:function(){return y.path},set:function(he){y.path=he}});var Ie=[];Object.defineProperty(this,"ctxStack",{get:function(){return Ie},set:function(he){Ie=he}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(he){var ot;ot=P(he),this.ctx.fillStyle=ot.style,this.ctx.isFillTransparent=ot.a===0,this.ctx.fillOpacity=ot.a,this.pdf.setFillColor(ot.r,ot.g,ot.b,{a:ot.a}),this.pdf.setTextColor(ot.r,ot.g,ot.b,{a:ot.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(he){var ot=P(he);this.ctx.strokeStyle=ot.style,this.ctx.isStrokeTransparent=ot.a===0,this.ctx.strokeOpacity=ot.a,ot.a===0?this.pdf.setDrawColor(255,255,255):(ot.a,this.pdf.setDrawColor(ot.r,ot.g,ot.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(he){["butt","round","square"].indexOf(he)!==-1&&(this.ctx.lineCap=he,this.pdf.setLineCap(he))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(he){isNaN(he)||(this.ctx.lineWidth=he,this.pdf.setLineWidth(he))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(he){["bevel","round","miter"].indexOf(he)!==-1&&(this.ctx.lineJoin=he,this.pdf.setLineJoin(he))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(he){isNaN(he)||(this.ctx.miterLimit=he,this.pdf.setMiterLimit(he))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(he){this.ctx.textBaseline=he}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(he){["right","end","center","left","start"].indexOf(he)!==-1&&(this.ctx.textAlign=he)}});var Re=null;function Fe(he,ot){if(Re===null){var mi=function(ri){var _e=[];return Object.keys(ri).forEach(function(Se){ri[Se].forEach(function(Le){var Ne=null;switch(Le){case"bold":Ne={family:Se,weight:"bold"};break;case"italic":Ne={family:Se,style:"italic"};break;case"bolditalic":Ne={family:Se,weight:"bold",style:"italic"};break;case"":case"normal":Ne={family:Se}}Ne!==null&&(Ne.ref={name:Se,style:Le},_e.push(Ne))})}),_e}(he.getFontList());Re=function(ri){for(var _e={},Se=0;Se<ri.length;++Se){var Le=i_(ri[Se]),Ne=Le.family,ci=Le.stretch,Ei=Le.style,Ci=Le.weight;_e[Ne]=_e[Ne]||{},_e[Ne][ci]=_e[Ne][ci]||{},_e[Ne][ci][Ei]=_e[Ne][ci][Ei]||{},_e[Ne][ci][Ei][Ci]=Le}return _e}(mi.concat(ot))}return Re}var Ze=null;Object.defineProperty(this,"fontFaces",{get:function(){return Ze},set:function(he){Re=null,Ze=he}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(he){var ot;if(this.ctx.font=he,(ot=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(he))!==null){var mi=ot[1],ri=(ot[2],ot[3]),_e=ot[4],Se=(ot[5],ot[6]),Le=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(_e)[2];_e=Math.floor(Le==="px"?parseFloat(_e)*this.pdf.internal.scaleFactor:Le==="em"?parseFloat(_e)*this.pdf.getFontSize():parseFloat(_e)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(_e);var Ne=function(ai){var Ai,De,Lr=[],me=ai.trim();if(me==="")return G5;if(me in N5)return[N5[me]];for(;me!=="";){switch(De=null,Ai=(me=z5(me)).charAt(0)){case'"':case"'":De=dV(me.substring(1),Ai);break;default:De=pV(me)}if(De===null||(Lr.push(De[0]),(me=z5(De[1]))!==""&&me.charAt(0)!==","))return G5;me=me.replace(/^,/,"")}return Lr}(Se);if(this.fontFaces){var ci=uV(Fe(this.pdf,this.fontFaces),Ne.map(function(ai){return{family:ai,stretch:"normal",weight:ri,style:mi}}));this.pdf.setFont(ci.ref.name,ci.ref.style)}else{var Ei="";(ri==="bold"||parseInt(ri,10)>=700||mi==="bold")&&(Ei="bold"),mi==="italic"&&(Ei+="italic"),Ei.length===0&&(Ei="normal");for(var Ci="",Ii={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Vi=0;Vi<Ne.length;Vi++){if(this.pdf.internal.getFont(Ne[Vi],Ei,{noFallback:!0,disableWarning:!0})!==void 0){Ci=Ne[Vi];break}if(Ei==="bolditalic"&&this.pdf.internal.getFont(Ne[Vi],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ci=Ne[Vi],Ei="bold";else if(this.pdf.internal.getFont(Ne[Vi],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ci=Ne[Vi],Ei="normal";break}}if(Ci===""){for(var be=0;be<Ne.length;be++)if(Ii[Ne[be]]){Ci=Ii[Ne[be]];break}}Ci=Ci===""?"Times":Ci,this.pdf.setFont(Ci,Ei)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(he){this.ctx.globalCompositeOperation=he}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(he){this.ctx.globalAlpha=he}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(he){this.ctx.lineDashOffset=he,Me.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(he){this.ctx.lineDash=he,Me.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(he){this.ctx.ignoreClearRect=!!he}})};T.prototype.setLineDash=function(nt){this.lineDash=nt},T.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},T.prototype.fill=function(){_t.call(this,"fill",!1)},T.prototype.stroke=function(){_t.call(this,"stroke",!1)},T.prototype.beginPath=function(){this.path=[{type:"begin"}]},T.prototype.moveTo=function(nt,Et){if(isNaN(nt)||isNaN(Et))throw Yr.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Lt=this.ctx.transform.applyToPoint(new c(nt,Et));this.path.push({type:"mt",x:Lt.x,y:Lt.y}),this.ctx.lastPoint=new c(nt,Et)},T.prototype.closePath=function(){var nt=new c(0,0),Et=0;for(Et=this.path.length-1;Et!==-1;Et--)if(this.path[Et].type==="begin"&&Ur(this.path[Et+1])==="object"&&typeof this.path[Et+1].x=="number"){nt=new c(this.path[Et+1].x,this.path[Et+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new c(nt.x,nt.y)},T.prototype.lineTo=function(nt,Et){if(isNaN(nt)||isNaN(Et))throw Yr.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Lt=this.ctx.transform.applyToPoint(new c(nt,Et));this.path.push({type:"lt",x:Lt.x,y:Lt.y}),this.ctx.lastPoint=new c(Lt.x,Lt.y)},T.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),_t.call(this,null,!0)},T.prototype.quadraticCurveTo=function(nt,Et,Lt,Gt){if(isNaN(Lt)||isNaN(Gt)||isNaN(nt)||isNaN(Et))throw Yr.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Wt=this.ctx.transform.applyToPoint(new c(Lt,Gt)),$t=this.ctx.transform.applyToPoint(new c(nt,Et));this.path.push({type:"qct",x1:$t.x,y1:$t.y,x:Wt.x,y:Wt.y}),this.ctx.lastPoint=new c(Wt.x,Wt.y)},T.prototype.bezierCurveTo=function(nt,Et,Lt,Gt,Wt,$t){if(isNaN(Wt)||isNaN($t)||isNaN(nt)||isNaN(Et)||isNaN(Lt)||isNaN(Gt))throw Yr.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ee=this.ctx.transform.applyToPoint(new c(Wt,$t)),Kt=this.ctx.transform.applyToPoint(new c(nt,Et)),Ce=this.ctx.transform.applyToPoint(new c(Lt,Gt));this.path.push({type:"bct",x1:Kt.x,y1:Kt.y,x2:Ce.x,y2:Ce.y,x:ee.x,y:ee.y}),this.ctx.lastPoint=new c(ee.x,ee.y)},T.prototype.arc=function(nt,Et,Lt,Gt,Wt,$t){if(isNaN(nt)||isNaN(Et)||isNaN(Lt)||isNaN(Gt)||isNaN(Wt))throw Yr.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if($t=!!$t,!this.ctx.transform.isIdentity){var ee=this.ctx.transform.applyToPoint(new c(nt,Et));nt=ee.x,Et=ee.y;var Kt=this.ctx.transform.applyToPoint(new c(0,Lt)),Ce=this.ctx.transform.applyToPoint(new c(0,0));Lt=Math.sqrt(Math.pow(Kt.x-Ce.x,2)+Math.pow(Kt.y-Ce.y,2))}Math.abs(Wt-Gt)>=2*Math.PI&&(Gt=0,Wt=2*Math.PI),this.path.push({type:"arc",x:nt,y:Et,radius:Lt,startAngle:Gt,endAngle:Wt,counterclockwise:$t})},T.prototype.arcTo=function(nt,Et,Lt,Gt,Wt){throw new Error("arcTo not implemented.")},T.prototype.rect=function(nt,Et,Lt,Gt){if(isNaN(nt)||isNaN(Et)||isNaN(Lt)||isNaN(Gt))throw Yr.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(nt,Et),this.lineTo(nt+Lt,Et),this.lineTo(nt+Lt,Et+Gt),this.lineTo(nt,Et+Gt),this.lineTo(nt,Et),this.lineTo(nt+Lt,Et),this.lineTo(nt,Et)},T.prototype.fillRect=function(nt,Et,Lt,Gt){if(isNaN(nt)||isNaN(Et)||isNaN(Lt)||isNaN(Gt))throw Yr.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!L.call(this)){var Wt={};this.lineCap!=="butt"&&(Wt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Wt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(nt,Et,Lt,Gt),this.fill(),Wt.hasOwnProperty("lineCap")&&(this.lineCap=Wt.lineCap),Wt.hasOwnProperty("lineJoin")&&(this.lineJoin=Wt.lineJoin)}},T.prototype.strokeRect=function(nt,Et,Lt,Gt){if(isNaN(nt)||isNaN(Et)||isNaN(Lt)||isNaN(Gt))throw Yr.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");D.call(this)||(this.beginPath(),this.rect(nt,Et,Lt,Gt),this.stroke())},T.prototype.clearRect=function(nt,Et,Lt,Gt){if(isNaN(nt)||isNaN(Et)||isNaN(Lt)||isNaN(Gt))throw Yr.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(nt,Et,Lt,Gt))},T.prototype.save=function(nt){nt=typeof nt!="boolean"||nt;for(var Et=this.pdf.internal.getCurrentPageInfo().pageNumber,Lt=0;Lt<this.pdf.internal.getNumberOfPages();Lt++)this.pdf.setPage(Lt+1),this.pdf.internal.out("q");if(this.pdf.setPage(Et),nt){this.ctx.fontSize=this.pdf.internal.getFontSize();var Gt=new A(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Gt}},T.prototype.restore=function(nt){nt=typeof nt!="boolean"||nt;for(var Et=this.pdf.internal.getCurrentPageInfo().pageNumber,Lt=0;Lt<this.pdf.internal.getNumberOfPages();Lt++)this.pdf.setPage(Lt+1),this.pdf.internal.out("Q");this.pdf.setPage(Et),nt&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},T.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var P=function(nt){var Et,Lt,Gt,Wt;if(nt.isCanvasGradient===!0&&(nt=nt.getColor()),!nt)return{r:0,g:0,b:0,a:0,style:nt};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(nt))Et=0,Lt=0,Gt=0,Wt=0;else{var $t=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(nt);if($t!==null)Et=parseInt($t[1]),Lt=parseInt($t[2]),Gt=parseInt($t[3]),Wt=1;else if(($t=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(nt))!==null)Et=parseInt($t[1]),Lt=parseInt($t[2]),Gt=parseInt($t[3]),Wt=parseFloat($t[4]);else{if(Wt=1,typeof nt=="string"&&nt.charAt(0)!=="#"){var ee=new mE(nt);nt=ee.ok?ee.toHex():"#000000"}nt.length===4?(Et=nt.substring(1,2),Et+=Et,Lt=nt.substring(2,3),Lt+=Lt,Gt=nt.substring(3,4),Gt+=Gt):(Et=nt.substring(1,3),Lt=nt.substring(3,5),Gt=nt.substring(5,7)),Et=parseInt(Et,16),Lt=parseInt(Lt,16),Gt=parseInt(Gt,16)}}return{r:Et,g:Lt,b:Gt,a:Wt,style:nt}},L=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},D=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};T.prototype.fillText=function(nt,Et,Lt,Gt){if(isNaN(Et)||isNaN(Lt)||typeof nt!="string")throw Yr.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Gt=isNaN(Gt)?void 0:Gt,!L.call(this)){var Wt=Qt(this.ctx.transform.rotation),$t=this.ctx.transform.scaleX;pt.call(this,{text:nt,x:Et,y:Lt,scale:$t,angle:Wt,align:this.textAlign,maxWidth:Gt})}},T.prototype.strokeText=function(nt,Et,Lt,Gt){if(isNaN(Et)||isNaN(Lt)||typeof nt!="string")throw Yr.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!D.call(this)){Gt=isNaN(Gt)?void 0:Gt;var Wt=Qt(this.ctx.transform.rotation),$t=this.ctx.transform.scaleX;pt.call(this,{text:nt,x:Et,y:Lt,scale:$t,renderingMode:"stroke",angle:Wt,align:this.textAlign,maxWidth:Gt})}},T.prototype.measureText=function(nt){if(typeof nt!="string")throw Yr.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Et=this.pdf,Lt=this.pdf.internal.scaleFactor,Gt=Et.internal.getFontSize(),Wt=Et.getStringUnitWidth(nt)*Gt/Et.internal.scaleFactor,$t=function(ee){var Kt=(ee=ee||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Kt}}),this};return new $t({width:Wt*=Math.round(96*Lt/72*1e4)/1e4})},T.prototype.scale=function(nt,Et){if(isNaN(nt)||isNaN(Et))throw Yr.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Lt=new f(nt,0,0,Et,0,0);this.ctx.transform=this.ctx.transform.multiply(Lt)},T.prototype.rotate=function(nt){if(isNaN(nt))throw Yr.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Et=new f(Math.cos(nt),Math.sin(nt),-Math.sin(nt),Math.cos(nt),0,0);this.ctx.transform=this.ctx.transform.multiply(Et)},T.prototype.translate=function(nt,Et){if(isNaN(nt)||isNaN(Et))throw Yr.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Lt=new f(1,0,0,1,nt,Et);this.ctx.transform=this.ctx.transform.multiply(Lt)},T.prototype.transform=function(nt,Et,Lt,Gt,Wt,$t){if(isNaN(nt)||isNaN(Et)||isNaN(Lt)||isNaN(Gt)||isNaN(Wt)||isNaN($t))throw Yr.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ee=new f(nt,Et,Lt,Gt,Wt,$t);this.ctx.transform=this.ctx.transform.multiply(ee)},T.prototype.setTransform=function(nt,Et,Lt,Gt,Wt,$t){nt=isNaN(nt)?1:nt,Et=isNaN(Et)?0:Et,Lt=isNaN(Lt)?0:Lt,Gt=isNaN(Gt)?1:Gt,Wt=isNaN(Wt)?0:Wt,$t=isNaN($t)?0:$t,this.ctx.transform=new f(nt,Et,Lt,Gt,Wt,$t)};var j=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};T.prototype.drawImage=function(nt,Et,Lt,Gt,Wt,$t,ee,Kt,Ce){var Ie=this.pdf.getImageProperties(nt),Re=1,Fe=1,Ze=1,he=1;Gt!==void 0&&Kt!==void 0&&(Ze=Kt/Gt,he=Ce/Wt,Re=Ie.width/Gt*Kt/Gt,Fe=Ie.height/Wt*Ce/Wt),$t===void 0&&($t=Et,ee=Lt,Et=0,Lt=0),Gt!==void 0&&Kt===void 0&&(Kt=Gt,Ce=Wt),Gt===void 0&&Kt===void 0&&(Kt=Ie.width,Ce=Ie.height);for(var ot,mi=this.ctx.transform.decompose(),ri=Qt(mi.rotate.shx),_e=new f,Se=(_e=(_e=(_e=_e.multiply(mi.translate)).multiply(mi.skew)).multiply(mi.scale)).applyToRectangle(new l($t-Et*Ze,ee-Lt*he,Gt*Re,Wt*Fe)),Le=X.call(this,Se),Ne=[],ci=0;ci<Le.length;ci+=1)Ne.indexOf(Le[ci])===-1&&Ne.push(Le[ci]);if(ht(Ne),this.autoPaging)for(var Ei=Ne[0],Ci=Ne[Ne.length-1],Ii=Ei;Ii<Ci+1;Ii++){this.pdf.setPage(Ii);var Vi=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],be=Ii===1?this.posY+this.margin[0]:this.margin[0],ai=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ai=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],De=Ii===1?0:ai+(Ii-2)*Ai;if(this.ctx.clip_path.length!==0){var Lr=this.path;ot=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(ot,this.posX+this.margin[3],-De+be+this.ctx.prevPageLastElemOffset),Mt.call(this,"fill",!0),this.path=Lr}var me=JSON.parse(JSON.stringify(Se));me=$([me],this.posX+this.margin[3],-De+be+this.ctx.prevPageLastElemOffset)[0];var vi=(Ii>Ei||Ii<Ci)&&j.call(this);vi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Vi,Ai,null).clip().discardPath()),this.pdf.addImage(nt,"JPEG",me.x,me.y,me.w,me.h,null,null,ri),vi&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(nt,"JPEG",Se.x,Se.y,Se.w,Se.h,null,null,ri)};var X=function(nt,Et,Lt){var Gt=[];Et=Et||this.pdf.internal.pageSize.width,Lt=Lt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Wt=this.posY+this.ctx.prevPageLastElemOffset;switch(nt.type){default:case"mt":case"lt":Gt.push(Math.floor((nt.y+Wt)/Lt)+1);break;case"arc":Gt.push(Math.floor((nt.y+Wt-nt.radius)/Lt)+1),Gt.push(Math.floor((nt.y+Wt+nt.radius)/Lt)+1);break;case"qct":var $t=fe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,nt.x1,nt.y1,nt.x,nt.y);Gt.push(Math.floor(($t.y+Wt)/Lt)+1),Gt.push(Math.floor(($t.y+$t.h+Wt)/Lt)+1);break;case"bct":var ee=de(this.ctx.lastPoint.x,this.ctx.lastPoint.y,nt.x1,nt.y1,nt.x2,nt.y2,nt.x,nt.y);Gt.push(Math.floor((ee.y+Wt)/Lt)+1),Gt.push(Math.floor((ee.y+ee.h+Wt)/Lt)+1);break;case"rect":Gt.push(Math.floor((nt.y+Wt)/Lt)+1),Gt.push(Math.floor((nt.y+nt.h+Wt)/Lt)+1)}for(var Kt=0;Kt<Gt.length;Kt+=1)for(;this.pdf.internal.getNumberOfPages()<Gt[Kt];)Z.call(this);return Gt},Z=function(){var nt=this.fillStyle,Et=this.strokeStyle,Lt=this.font,Gt=this.lineCap,Wt=this.lineWidth,$t=this.lineJoin;this.pdf.addPage(),this.fillStyle=nt,this.strokeStyle=Et,this.font=Lt,this.lineCap=Gt,this.lineWidth=Wt,this.lineJoin=$t},$=function(nt,Et,Lt){for(var Gt=0;Gt<nt.length;Gt++)switch(nt[Gt].type){case"bct":nt[Gt].x2+=Et,nt[Gt].y2+=Lt;case"qct":nt[Gt].x1+=Et,nt[Gt].y1+=Lt;case"mt":case"lt":case"arc":default:nt[Gt].x+=Et,nt[Gt].y+=Lt}return nt},ht=function(nt){return nt.sort(function(Et,Lt){return Et-Lt})},_t=function(nt,Et){for(var Lt,Gt,Wt=this.fillStyle,$t=this.strokeStyle,ee=this.lineCap,Kt=this.lineWidth,Ce=Math.abs(Kt*this.ctx.transform.scaleX),Ie=this.lineJoin,Re=JSON.parse(JSON.stringify(this.path)),Fe=JSON.parse(JSON.stringify(this.path)),Ze=[],he=0;he<Fe.length;he++)if(Fe[he].x!==void 0)for(var ot=X.call(this,Fe[he]),mi=0;mi<ot.length;mi+=1)Ze.indexOf(ot[mi])===-1&&Ze.push(ot[mi]);for(var ri=0;ri<Ze.length;ri++)for(;this.pdf.internal.getNumberOfPages()<Ze[ri];)Z.call(this);if(ht(Ze),this.autoPaging)for(var _e=Ze[0],Se=Ze[Ze.length-1],Le=_e;Le<Se+1;Le++){this.pdf.setPage(Le),this.fillStyle=Wt,this.strokeStyle=$t,this.lineCap=ee,this.lineWidth=Ce,this.lineJoin=Ie;var Ne=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ci=Le===1?this.posY+this.margin[0]:this.margin[0],Ei=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ci=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ii=Le===1?0:Ei+(Le-2)*Ci;if(this.ctx.clip_path.length!==0){var Vi=this.path;Lt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(Lt,this.posX+this.margin[3],-Ii+ci+this.ctx.prevPageLastElemOffset),Mt.call(this,nt,!0),this.path=Vi}if(Gt=JSON.parse(JSON.stringify(Re)),this.path=$(Gt,this.posX+this.margin[3],-Ii+ci+this.ctx.prevPageLastElemOffset),Et===!1||Le===0){var be=(Le>_e||Le<Se)&&j.call(this);be&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ne,Ci,null).clip().discardPath()),Mt.call(this,nt,Et),be&&this.pdf.restoreGraphicsState()}this.lineWidth=Kt}else this.lineWidth=Ce,Mt.call(this,nt,Et),this.lineWidth=Kt;this.path=Re},Mt=function(nt,Et){if((nt!=="stroke"||Et||!D.call(this))&&(nt==="stroke"||Et||!L.call(this))){for(var Lt,Gt,Wt=[],$t=this.path,ee=0;ee<$t.length;ee++){var Kt=$t[ee];switch(Kt.type){case"begin":Wt.push({begin:!0});break;case"close":Wt.push({close:!0});break;case"mt":Wt.push({start:Kt,deltas:[],abs:[]});break;case"lt":var Ce=Wt.length;if($t[ee-1]&&!isNaN($t[ee-1].x)&&(Lt=[Kt.x-$t[ee-1].x,Kt.y-$t[ee-1].y],Ce>0)){for(;Ce>=0;Ce--)if(Wt[Ce-1].close!==!0&&Wt[Ce-1].begin!==!0){Wt[Ce-1].deltas.push(Lt),Wt[Ce-1].abs.push(Kt);break}}break;case"bct":Lt=[Kt.x1-$t[ee-1].x,Kt.y1-$t[ee-1].y,Kt.x2-$t[ee-1].x,Kt.y2-$t[ee-1].y,Kt.x-$t[ee-1].x,Kt.y-$t[ee-1].y],Wt[Wt.length-1].deltas.push(Lt);break;case"qct":var Ie=$t[ee-1].x+2/3*(Kt.x1-$t[ee-1].x),Re=$t[ee-1].y+2/3*(Kt.y1-$t[ee-1].y),Fe=Kt.x+2/3*(Kt.x1-Kt.x),Ze=Kt.y+2/3*(Kt.y1-Kt.y),he=Kt.x,ot=Kt.y;Lt=[Ie-$t[ee-1].x,Re-$t[ee-1].y,Fe-$t[ee-1].x,Ze-$t[ee-1].y,he-$t[ee-1].x,ot-$t[ee-1].y],Wt[Wt.length-1].deltas.push(Lt);break;case"arc":Wt.push({deltas:[],abs:[],arc:!0}),Array.isArray(Wt[Wt.length-1].abs)&&Wt[Wt.length-1].abs.push(Kt)}}Gt=Et?null:nt==="stroke"?"stroke":"fill";for(var mi=!1,ri=0;ri<Wt.length;ri++)if(Wt[ri].arc)for(var _e=Wt[ri].abs,Se=0;Se<_e.length;Se++){var Le=_e[Se];Le.type==="arc"?xt.call(this,Le.x,Le.y,Le.radius,Le.startAngle,Le.endAngle,Le.counterclockwise,void 0,Et,!mi):Bt.call(this,Le.x,Le.y),mi=!0}else if(Wt[ri].close===!0)this.pdf.internal.out("h"),mi=!1;else if(Wt[ri].begin!==!0){var Ne=Wt[ri].start.x,ci=Wt[ri].start.y;bt.call(this,Wt[ri].deltas,Ne,ci),mi=!0}Gt&&qt.call(this,Gt),Et&&zt.call(this)}},Nt=function(nt){var Et=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Lt=Et*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return nt-Lt;case"top":return nt+Et-Lt;case"hanging":return nt+Et-2*Lt;case"middle":return nt+Et/2-Lt;case"ideographic":return nt;case"alphabetic":default:return nt}},Rt=function(nt){return nt+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};T.prototype.createLinearGradient=function(){var nt=function(){};return nt.colorStops=[],nt.addColorStop=function(Et,Lt){this.colorStops.push([Et,Lt])},nt.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},nt.isCanvasGradient=!0,nt},T.prototype.createPattern=function(){return this.createLinearGradient()},T.prototype.createRadialGradient=function(){return this.createLinearGradient()};var xt=function(nt,Et,Lt,Gt,Wt,$t,ee,Kt,Ce){for(var Ie=oe.call(this,Lt,Gt,Wt,$t),Re=0;Re<Ie.length;Re++){var Fe=Ie[Re];Re===0&&(Ce?ct.call(this,Fe.x1+nt,Fe.y1+Et):Bt.call(this,Fe.x1+nt,Fe.y1+Et)),ne.call(this,nt,Et,Fe.x2,Fe.y2,Fe.x3,Fe.y3,Fe.x4,Fe.y4)}Kt?zt.call(this):qt.call(this,ee)},qt=function(nt){switch(nt){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},zt=function(){this.pdf.clip(),this.pdf.discardPath()},ct=function(nt,Et){this.pdf.internal.out(e(nt)+" "+r(Et)+" m")},pt=function(nt){var Et;switch(nt.align){case"right":case"end":Et="right";break;case"center":Et="center";break;case"left":case"start":default:Et="left"}var Lt=this.pdf.getTextDimensions(nt.text),Gt=Nt.call(this,nt.y),Wt=Rt.call(this,Gt)-Lt.h,$t=this.ctx.transform.applyToPoint(new c(nt.x,Gt)),ee=this.ctx.transform.decompose(),Kt=new f;Kt=(Kt=(Kt=Kt.multiply(ee.translate)).multiply(ee.skew)).multiply(ee.scale);for(var Ce,Ie,Re,Fe=this.ctx.transform.applyToRectangle(new l(nt.x,Gt,Lt.w,Lt.h)),Ze=Kt.applyToRectangle(new l(nt.x,Wt,Lt.w,Lt.h)),he=X.call(this,Ze),ot=[],mi=0;mi<he.length;mi+=1)ot.indexOf(he[mi])===-1&&ot.push(he[mi]);if(ht(ot),this.autoPaging)for(var ri=ot[0],_e=ot[ot.length-1],Se=ri;Se<_e+1;Se++){this.pdf.setPage(Se);var Le=Se===1?this.posY+this.margin[0]:this.margin[0],Ne=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ci=this.pdf.internal.pageSize.height-this.margin[2],Ei=ci-this.margin[0],Ci=this.pdf.internal.pageSize.width-this.margin[1],Ii=Ci-this.margin[3],Vi=Se===1?0:Ne+(Se-2)*Ei;if(this.ctx.clip_path.length!==0){var be=this.path;Ce=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(Ce,this.posX+this.margin[3],-1*Vi+Le),Mt.call(this,"fill",!0),this.path=be}var ai=$([JSON.parse(JSON.stringify(Ze))],this.posX+this.margin[3],-Vi+Le+this.ctx.prevPageLastElemOffset)[0];nt.scale>=.01&&(Ie=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ie*nt.scale),Re=this.lineWidth,this.lineWidth=Re*nt.scale);var Ai=this.autoPaging!=="text";if(Ai||ai.y+ai.h<=ci){if(Ai||ai.y>=Le&&ai.x<=Ci){var De=Ai?nt.text:this.pdf.splitTextToSize(nt.text,nt.maxWidth||Ci-ai.x)[0],Lr=$([JSON.parse(JSON.stringify(Fe))],this.posX+this.margin[3],-Vi+Le+this.ctx.prevPageLastElemOffset)[0],me=Ai&&(Se>ri||Se<_e)&&j.call(this);me&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ii,Ei,null).clip().discardPath()),this.pdf.text(De,Lr.x,Lr.y,{angle:nt.angle,align:Et,renderingMode:nt.renderingMode}),me&&this.pdf.restoreGraphicsState()}}else ai.y<ci&&(this.ctx.prevPageLastElemOffset+=ci-ai.y);nt.scale>=.01&&(this.pdf.setFontSize(Ie),this.lineWidth=Re)}else nt.scale>=.01&&(Ie=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ie*nt.scale),Re=this.lineWidth,this.lineWidth=Re*nt.scale),this.pdf.text(nt.text,$t.x+this.posX,$t.y+this.posY,{angle:nt.angle,align:Et,renderingMode:nt.renderingMode,maxWidth:nt.maxWidth}),nt.scale>=.01&&(this.pdf.setFontSize(Ie),this.lineWidth=Re)},Bt=function(nt,Et,Lt,Gt){Lt=Lt||0,Gt=Gt||0,this.pdf.internal.out(e(nt+Lt)+" "+r(Et+Gt)+" l")},bt=function(nt,Et,Lt){return this.pdf.lines(nt,Et,Lt,null,null)},ne=function(nt,Et,Lt,Gt,Wt,$t,ee,Kt){this.pdf.internal.out([t(s(Lt+nt)),t(n(Gt+Et)),t(s(Wt+nt)),t(n($t+Et)),t(s(ee+nt)),t(n(Kt+Et)),"c"].join(" "))},oe=function(nt,Et,Lt,Gt){for(var Wt=2*Math.PI,$t=Math.PI/2;Et>Lt;)Et-=Wt;var ee=Math.abs(Lt-Et);ee<Wt&&Gt&&(ee=Wt-ee);for(var Kt=[],Ce=Gt?-1:1,Ie=Et;ee>1e-5;){var Re=Ie+Ce*Math.min(ee,$t);Kt.push(le.call(this,nt,Ie,Re)),ee-=Math.abs(Re-Ie),Ie=Re}return Kt},le=function(nt,Et,Lt){var Gt=(Lt-Et)/2,Wt=nt*Math.cos(Gt),$t=nt*Math.sin(Gt),ee=Wt,Kt=-$t,Ce=ee*ee+Kt*Kt,Ie=Ce+ee*Wt+Kt*$t,Re=4/3*(Math.sqrt(2*Ce*Ie)-Ie)/(ee*$t-Kt*Wt),Fe=ee-Re*Kt,Ze=Kt+Re*ee,he=Fe,ot=-Ze,mi=Gt+Et,ri=Math.cos(mi),_e=Math.sin(mi);return{x1:nt*Math.cos(Et),y1:nt*Math.sin(Et),x2:Fe*ri-Ze*_e,y2:Fe*_e+Ze*ri,x3:he*ri-ot*_e,y3:he*_e+ot*ri,x4:nt*Math.cos(Lt),y4:nt*Math.sin(Lt)}},Qt=function(nt){return 180*nt/Math.PI},fe=function(nt,Et,Lt,Gt,Wt,$t){var ee=nt+.5*(Lt-nt),Kt=Et+.5*(Gt-Et),Ce=Wt+.5*(Lt-Wt),Ie=$t+.5*(Gt-$t),Re=Math.min(nt,Wt,ee,Ce),Fe=Math.max(nt,Wt,ee,Ce),Ze=Math.min(Et,$t,Kt,Ie),he=Math.max(Et,$t,Kt,Ie);return new l(Re,Ze,Fe-Re,he-Ze)},de=function(nt,Et,Lt,Gt,Wt,$t,ee,Kt){var Ce,Ie,Re,Fe,Ze,he,ot,mi,ri,_e,Se,Le,Ne,ci,Ei=Lt-nt,Ci=Gt-Et,Ii=Wt-Lt,Vi=$t-Gt,be=ee-Wt,ai=Kt-$t;for(Ie=0;Ie<41;Ie++)ri=(ot=(Re=nt+(Ce=Ie/40)*Ei)+Ce*((Ze=Lt+Ce*Ii)-Re))+Ce*(Ze+Ce*(Wt+Ce*be-Ze)-ot),_e=(mi=(Fe=Et+Ce*Ci)+Ce*((he=Gt+Ce*Vi)-Fe))+Ce*(he+Ce*($t+Ce*ai-he)-mi),Ie==0?(Se=ri,Le=_e,Ne=ri,ci=_e):(Se=Math.min(Se,ri),Le=Math.min(Le,_e),Ne=Math.max(Ne,ri),ci=Math.max(ci,_e));return new l(Math.round(Se),Math.round(Le),Math.round(Ne-Se),Math.round(ci-Le))},Me=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var nt,Et,Lt=(nt=this.ctx.lineDash,Et=this.ctx.lineDashOffset,JSON.stringify({lineDash:nt,lineDashOffset:Et}));this.prevLineDash!==Lt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Lt)}}})(Bi.API),function(i){var t=function(n){var c,l,f,y,A,T,P,L,D,j;for(l=[],f=0,y=(n+=c="\0\0\0\0".slice(n.length%4||4)).length;y>f;f+=4)(A=(n.charCodeAt(f)<<24)+(n.charCodeAt(f+1)<<16)+(n.charCodeAt(f+2)<<8)+n.charCodeAt(f+3))!==0?(T=(A=((A=((A=((A=(A-(j=A%85))/85)-(D=A%85))/85)-(L=A%85))/85)-(P=A%85))/85)%85,l.push(T+33,P+33,L+33,D+33,j+33)):l.push(122);return function(X,Z){for(var $=Z;$>0;$--)X.pop()}(l,c.length),String.fromCharCode.apply(String,l)+"~>"},e=function(n){var c,l,f,y,A,T=String,P="length",L=255,D="charCodeAt",j="slice",X="replace";for(n[j](-2),n=n[j](0,-2)[X](/\s/g,"")[X]("z","!!!!!"),f=[],y=0,A=(n+=c="uuuuu"[j](n[P]%5||5))[P];A>y;y+=5)l=52200625*(n[D](y)-33)+614125*(n[D](y+1)-33)+7225*(n[D](y+2)-33)+85*(n[D](y+3)-33)+(n[D](y+4)-33),f.push(L&l>>24,L&l>>16,L&l>>8,L&l);return function(Z,$){for(var ht=$;ht>0;ht--)Z.pop()}(f,c[P]),T.fromCharCode.apply(T,f)},r=function(n){var c=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((n=n.replace(/\s/g,"")).indexOf(">")!==-1&&(n=n.substr(0,n.indexOf(">"))),n.length%2&&(n+="0"),c.test(n)===!1)return"";for(var l="",f=0;f<n.length;f+=2)l+=String.fromCharCode("0x"+(n[f]+n[f+1]));return l},s=function(n){for(var c=new Uint8Array(n.length),l=n.length;l--;)c[l]=n.charCodeAt(l);return n=(c=$1(c)).reduce(function(f,y){return f+String.fromCharCode(y)},"")};i.processDataByFilters=function(n,c){var l=0,f=n||"",y=[];for(typeof(c=c||[])=="string"&&(c=[c]),l=0;l<c.length;l+=1)switch(c[l]){case"ASCII85Decode":case"/ASCII85Decode":f=e(f),y.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":f=t(f),y.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":f=r(f),y.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":f=f.split("").map(function(A){return("0"+A.charCodeAt().toString(16)).slice(-2)}).join("")+">",y.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":f=s(f),y.push("/FlateDecode");break;default:throw new Error('The filter: "'+c[l]+'" is not implemented')}return{data:f,reverseChain:y.reverse().join(" ")}}}(Bi.API),function(i){i.loadFile=function(t,e,r){return function(s,n,c){n=n!==!1,c=typeof c=="function"?c:function(){};var l=void 0;try{l=function(f,y,A){var T=new XMLHttpRequest,P=0,L=function(D){var j=D.length,X=[],Z=String.fromCharCode;for(P=0;P<j;P+=1)X.push(Z(255&D.charCodeAt(P)));return X.join("")};if(T.open("GET",f,!y),T.overrideMimeType("text/plain; charset=x-user-defined"),y===!1&&(T.onload=function(){T.status===200?A(L(this.responseText)):A(void 0)}),T.send(null),y&&T.status===200)return L(T.responseText)}(s,n,c)}catch{}return l}(t,e,r)},i.loadImageFile=i.loadFile}(Bi.API),function(i){function t(){return(Ri.html2canvas?Promise.resolve(Ri.html2canvas):Yy(()=>import("./html2canvas.esm-CKxSAI8P-DSC9_HHp-xkYPgEOG.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load html2canvas: "+c))}).then(function(c){return c.default?c.default:c})}function e(){return(Ri.DOMPurify?Promise.resolve(Ri.DOMPurify):Yy(()=>import("./purify.es-CLxMp-4V-DmiRgNNX-D3ozuLpM.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load dompurify: "+c))}).then(function(c){return c.default?c.default:c})}var r=function(c){var l=Ur(c);return l==="undefined"?"undefined":l==="string"||c instanceof String?"string":l==="number"||c instanceof Number?"number":l==="function"||c instanceof Function?"function":c&&c.constructor===Array?"array":c&&c.nodeType===1?"element":l==="object"?"object":"unknown"},s=function(c,l){var f=document.createElement(c);for(var y in l.className&&(f.className=l.className),l.innerHTML&&l.dompurify&&(f.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)f.style[y]=l.style[y];return f},n=function c(l){var f=Object.assign(c.convert(Promise.resolve()),JSON.parse(JSON.stringify(c.template))),y=c.convert(Promise.resolve(),f);return y=(y=y.setProgress(1,c,1,[c])).set(l)};(n.prototype=Object.create(Promise.prototype)).constructor=n,n.convert=function(c,l){return c.__proto__=l||n.prototype,c},n.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},n.prototype.from=function(c,l){return this.then(function(){switch(l=l||function(f){switch(r(f)){case"string":return"string";case"element":return f.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(c)){case"string":return this.then(e).then(function(f){return this.set({src:s("div",{innerHTML:c,dompurify:f})})});case"element":return this.set({src:c});case"canvas":return this.set({canvas:c});case"img":return this.set({img:c});default:return this.error("Unknown source type.")}})},n.prototype.to=function(c){switch(c){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},n.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var c={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=function f(y,A){for(var T=y.nodeType===3?document.createTextNode(y.nodeValue):y.cloneNode(!1),P=y.firstChild;P;P=P.nextSibling)A!==!0&&P.nodeType===1&&P.nodeName==="SCRIPT"||T.appendChild(f(P,A));return y.nodeType===1&&(y.nodeName==="CANVAS"?(T.width=y.width,T.height=y.height,T.getContext("2d").drawImage(y,0,0)):y.nodeName!=="TEXTAREA"&&y.nodeName!=="SELECT"||(T.value=y.value),T.addEventListener("load",function(){T.scrollTop=y.scrollTop,T.scrollLeft=y.scrollLeft},!0)),T}(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(c.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:c}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},n.prototype.toCanvas=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(l){var f=Object.assign({},this.opt.html2canvas);return delete f.onrendered,l(this.prop.container,f)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},n.prototype.toContext2d=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(l){var f=this.opt.jsPDF,y=this.opt.fontFaces,A=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,T=Object.assign({async:!0,allowTaint:!0,scale:A,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete T.onrendered,f.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,f.context2d.posX=this.opt.x,f.context2d.posY=this.opt.y,f.context2d.margin=this.opt.margin,f.context2d.fontFaces=y,y)for(var P=0;P<y.length;++P){var L=y[P],D=L.src.find(function(j){return j.format==="truetype"});D&&f.addFont(D.url,L.ref.name,L.ref.style)}return T.windowHeight=T.windowHeight||0,T.windowHeight=T.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):T.windowHeight,f.context2d.save(!0),l(this.prop.container,T)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},n.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var c=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=c})},n.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},n.prototype.output=function(c,l,f){return(f=f||"pdf").toLowerCase()==="img"||f.toLowerCase()==="image"?this.outputImg(c,l):this.outputPdf(c,l)},n.prototype.outputPdf=function(c,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(c,l)})},n.prototype.outputImg=function(c){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(c){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+c+'" is not supported.'}})},n.prototype.save=function(c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(c?{filename:c}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},n.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},n.prototype.set=function(c){if(r(c)!=="object")return this;var l=Object.keys(c||{}).map(function(f){if(f in n.template.prop)return function(){this.prop[f]=c[f]};switch(f){case"margin":return this.setMargin.bind(this,c.margin);case"jsPDF":return function(){return this.opt.jsPDF=c.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,c.pageSize);default:return function(){this.opt[f]=c[f]}}},this);return this.then(function(){return this.thenList(l)})},n.prototype.get=function(c,l){return this.then(function(){var f=c in n.template.prop?this.prop[c]:this.opt[c];return l?l(f):f})},n.prototype.setMargin=function(c){return this.then(function(){switch(r(c)){case"number":c=[c,c,c,c];case"array":if(c.length===2&&(c=[c[0],c[1],c[0],c[1]]),c.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=c}).then(this.setPageSize)},n.prototype.setPageSize=function(c){function l(f,y){return Math.floor(f*y/72*96)}return this.then(function(){(c=c||Bi.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(c.inner={width:c.width-this.opt.margin[1]-this.opt.margin[3],height:c.height-this.opt.margin[0]-this.opt.margin[2]},c.inner.px={width:l(c.inner.width,c.k),height:l(c.inner.height,c.k)},c.inner.ratio=c.inner.height/c.inner.width),this.prop.pageSize=c})},n.prototype.setProgress=function(c,l,f,y){return c!=null&&(this.progress.val=c),l!=null&&(this.progress.state=l),f!=null&&(this.progress.n=f),y!=null&&(this.progress.stack=y),this.progress.ratio=this.progress.val/this.progress.state,this},n.prototype.updateProgress=function(c,l,f,y){return this.setProgress(c?this.progress.val+c:null,l||null,f?this.progress.n+f:null,y?this.progress.stack.concat(y):null)},n.prototype.then=function(c,l){var f=this;return this.thenCore(c,l,function(y,A){return f.updateProgress(null,null,1,[y]),Promise.prototype.then.call(this,function(T){return f.updateProgress(null,y),T}).then(y,A).then(function(T){return f.updateProgress(1),T})})},n.prototype.thenCore=function(c,l,f){f=f||Promise.prototype.then,c&&(c=c.bind(this)),l&&(l=l.bind(this));var y=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:n.convert(Object.assign({},this),Promise.prototype),A=f.call(y,c,l);return n.convert(A,this.__proto__)},n.prototype.thenExternal=function(c,l){return Promise.prototype.then.call(this,c,l)},n.prototype.thenList=function(c){var l=this;return c.forEach(function(f){l=l.thenCore(f)}),l},n.prototype.catch=function(c){c&&(c=c.bind(this));var l=Promise.prototype.catch.call(this,c);return n.convert(l,this)},n.prototype.catchExternal=function(c){return Promise.prototype.catch.call(this,c)},n.prototype.error=function(c){return this.then(function(){throw new Error(c)})},n.prototype.using=n.prototype.set,n.prototype.saveAs=n.prototype.save,n.prototype.export=n.prototype.output,n.prototype.run=n.prototype.then,Bi.getPageSize=function(c,l,f){if(Ur(c)==="object"){var y=c;c=y.orientation,l=y.unit||l,f=y.format||f}l=l||"mm",f=f||"a4",c=(""+(c||"P")).toLowerCase();var A,T=(""+f).toLowerCase(),P={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":A=1;break;case"mm":A=72/25.4;break;case"cm":A=72/2.54;break;case"in":A=72;break;case"px":A=.75;break;case"pc":case"em":A=12;break;case"ex":A=6;break;default:throw"Invalid unit: "+l}var L,D=0,j=0;if(P.hasOwnProperty(T))D=P[T][1]/A,j=P[T][0]/A;else try{D=f[1],j=f[0]}catch{throw new Error("Invalid format: "+f)}if(c==="p"||c==="portrait")c="p",j>D&&(L=j,j=D,D=L);else{if(c!=="l"&&c!=="landscape")throw"Invalid orientation: "+c;c="l",D>j&&(L=j,j=D,D=L)}return{width:j,height:D,unit:l,k:A,orientation:c}},i.html=function(c,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(i_):null;var f=new n(l);return l.worker?f:f.from(c).doCallback()}}(Bi.API),Bi.API.addJS=function(i){return j5=i,this.internal.events.subscribe("postPutResources",function(){Dg=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Dg+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),U5=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+j5+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Dg!==void 0&&U5!==void 0&&this.internal.out("/Names <</JavaScript "+Dg+" 0 R>>")}),this},function(i){var t;i.events.push(["postPutResources",function(){var e=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var s=e.outline.render().split(/\r\n/),n=0;n<s.length;n++){var c=s[n],l=r.exec(c);if(l!=null){var f=l[1];e.internal.newObjectDeferredBegin(f,!1)}e.internal.write(c)}if(this.outline.createNamedDestinations){var y=this.internal.pages.length,A=[];for(n=0;n<y;n++){var T=e.internal.newObject();A.push(T);var P=e.internal.getPageInfo(n+1);e.internal.write("<< /D["+P.objId+" 0 R /XYZ null null null]>> endobj")}var L=e.internal.newObject();for(e.internal.write("<< /Names [ "),n=0;n<A.length;n++)e.internal.write("(page_"+(n+1)+")"+A[n]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+L+" 0 R"),e.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),i.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(r,s,n){var c={title:s,options:n,children:[]};return r==null&&(r=this.root),r.children.push(c),c},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(r){r.id=e.internal.newObjectDeferred();for(var s=0;s<r.children.length;s++)this.genIds_r(r.children[s])},e.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},e.outline.renderItems=function(r){for(var s=this.ctx.pdf.internal.getVerticalCoordinateString,n=0;n<r.children.length;n++){var c=r.children[n];this.objStart(c),this.line("/Title "+this.makeString(c.title)),this.line("/Parent "+this.makeRef(r)),n>0&&this.line("/Prev "+this.makeRef(r.children[n-1])),n<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[n+1])),c.children.length>0&&(this.line("/First "+this.makeRef(c.children[0])),this.line("/Last "+this.makeRef(c.children[c.children.length-1])));var l=this.count=this.count_r({count:0},c);if(l>0&&this.line("/Count "+l),c.options&&c.options.pageNumber){var f=e.internal.getPageInfo(c.options.pageNumber);this.line("/Dest ["+f.objId+" 0 R /XYZ 0 "+s(0)+" 0]")}this.objEnd()}for(var y=0;y<r.children.length;y++)this.renderItems(r.children[y])},e.outline.line=function(r){this.ctx.val+=r+`\r
`},e.outline.makeRef=function(r){return r.id+" 0 R"},e.outline.makeString=function(r){return"("+e.internal.pdfEscape(r)+")"},e.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(r,s){for(var n=0;n<s.children.length;n++)r.count++,this.count_r(r,s.children[n]);return r.count}}])}(Bi.API),function(i){var t=[192,193,194,195,196,197,198,199];i.processJPEG=function(e,r,s,n,c,l){var f,y=this.decode.DCT_DECODE,A=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=c||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(f=function(T){for(var P,L=256*T.charCodeAt(4)+T.charCodeAt(5),D=T.length,j={width:0,height:0,numcomponents:1},X=4;X<D;X+=2){if(X+=L,t.indexOf(T.charCodeAt(X+1))!==-1){P=256*T.charCodeAt(X+5)+T.charCodeAt(X+6),j={width:256*T.charCodeAt(X+7)+T.charCodeAt(X+8),height:P,numcomponents:T.charCodeAt(X+9)};break}L=256*T.charCodeAt(X+2)+T.charCodeAt(X+3)}return j}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}A={data:e,width:f.width,height:f.height,colorSpace:l,bitsPerComponent:8,filter:y,index:r,alias:s}}return A}}(Bi.API);var gd,zg,V5,q5,H5,fV=function(){var i,t,e;function r(n){var c,l,f,y,A,T,P,L,D,j,X,Z,$,ht;for(this.data=n,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},T=null;;){switch(c=this.readUInt32(),D=(function(){var _t,Mt;for(Mt=[],_t=0;_t<4;++_t)Mt.push(String.fromCharCode(this.data[this.pos++]));return Mt}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(c);break;case"fcTL":T&&this.animation.frames.push(T),this.pos+=4,T={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},A=this.readUInt16(),y=this.readUInt16()||100,T.delay=1e3*A/y,T.disposeOp=this.data[this.pos++],T.blendOp=this.data[this.pos++],T.data=[];break;case"IDAT":case"fdAT":for(D==="fdAT"&&(this.pos+=4,c-=4),n=(T!=null?T.data:void 0)||this.imgData,Z=0;0<=c?Z<c:Z>c;0<=c?++Z:--Z)n.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(f=this.palette.length/3,this.transparency.indexed=this.read(c),this.transparency.indexed.length>f)throw new Error("More transparent colors than palette size");if((j=f-this.transparency.indexed.length)>0)for($=0;0<=j?$<j:$>j;0<=j?++$:--$)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case"tEXt":P=(X=this.read(c)).indexOf(0),L=String.fromCharCode.apply(String,X.slice(0,P)),this.text[L]=String.fromCharCode.apply(String,X.slice(P+1));break;case"IEND":return T&&this.animation.frames.push(T),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(ht=this.colorType)===4||ht===6,l=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*l,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=c}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(n){var c,l;for(l=[],c=0;0<=n?c<n:c>n;0<=n?++c:--c)l.push(this.data[this.pos++]);return l},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(n){var c=this.pixelBitlength/8,l=new Uint8Array(this.width*this.height*c),f=0,y=this;if(n==null&&(n=this.imgData),n.length===0)return new Uint8Array(0);function A(T,P,L,D){var j,X,Z,$,ht,_t,Mt,Nt,Rt,xt,qt,zt,ct,pt,Bt,bt,ne,oe,le,Qt,fe,de=Math.ceil((y.width-T)/L),Me=Math.ceil((y.height-P)/D),nt=y.width==de&&y.height==Me;for(pt=c*de,zt=nt?l:new Uint8Array(pt*Me),_t=n.length,ct=0,X=0;ct<Me&&f<_t;){switch(n[f++]){case 0:for($=ne=0;ne<pt;$=ne+=1)zt[X++]=n[f++];break;case 1:for($=oe=0;oe<pt;$=oe+=1)j=n[f++],ht=$<c?0:zt[X-c],zt[X++]=(j+ht)%256;break;case 2:for($=le=0;le<pt;$=le+=1)j=n[f++],Z=($-$%c)/c,Bt=ct&&zt[(ct-1)*pt+Z*c+$%c],zt[X++]=(Bt+j)%256;break;case 3:for($=Qt=0;Qt<pt;$=Qt+=1)j=n[f++],Z=($-$%c)/c,ht=$<c?0:zt[X-c],Bt=ct&&zt[(ct-1)*pt+Z*c+$%c],zt[X++]=(j+Math.floor((ht+Bt)/2))%256;break;case 4:for($=fe=0;fe<pt;$=fe+=1)j=n[f++],Z=($-$%c)/c,ht=$<c?0:zt[X-c],ct===0?Bt=bt=0:(Bt=zt[(ct-1)*pt+Z*c+$%c],bt=Z&&zt[(ct-1)*pt+(Z-1)*c+$%c]),Mt=ht+Bt-bt,Nt=Math.abs(Mt-ht),xt=Math.abs(Mt-Bt),qt=Math.abs(Mt-bt),Rt=Nt<=xt&&Nt<=qt?ht:xt<=qt?Bt:bt,zt[X++]=(j+Rt)%256;break;default:throw new Error("Invalid filter algorithm: "+n[f-1])}if(!nt){var Et=((P+ct*D)*y.width+T)*c,Lt=ct*pt;for($=0;$<de;$+=1){for(var Gt=0;Gt<c;Gt+=1)l[Et++]=zt[Lt++];Et+=(L-1)*c}}ct++}}return n=XG(n),y.interlaceMethod==1?(A(0,0,8,8),A(4,0,8,8),A(0,4,4,8),A(2,0,4,4),A(0,2,2,4),A(1,0,2,2),A(0,1,1,2)):A(0,0,1,1),l},r.prototype.decodePalette=function(){var n,c,l,f,y,A,T,P,L;for(l=this.palette,A=this.transparency.indexed||[],y=new Uint8Array((A.length||0)+l.length),f=0,n=0,c=T=0,P=l.length;T<P;c=T+=3)y[f++]=l[c],y[f++]=l[c+1],y[f++]=l[c+2],y[f++]=(L=A[n++])!=null?L:255;return y},r.prototype.copyToImageData=function(n,c){var l,f,y,A,T,P,L,D,j,X,Z;if(f=this.colors,j=null,l=this.hasAlphaChannel,this.palette.length&&(j=(Z=this._decodedPalette)!=null?Z:this._decodedPalette=this.decodePalette(),f=4,l=!0),D=(y=n.data||n).length,T=j||c,A=P=0,f===1)for(;A<D;)L=j?4*c[A/4]:P,X=T[L++],y[A++]=X,y[A++]=X,y[A++]=X,y[A++]=l?T[L++]:255,P=L;else for(;A<D;)L=j?4*c[A/4]:P,y[A++]=T[L++],y[A++]=T[L++],y[A++]=T[L++],y[A++]=l?T[L++]:255,P=L},r.prototype.decode=function(){var n;return n=new Uint8Array(this.width*this.height*4),this.copyToImageData(n,this.decodePixels()),n};var s=function(){if(Object.prototype.toString.call(Ri)==="[object Window]"){try{t=Ri.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return s(),i=function(n){var c;if(s()===!0)return e.width=n.width,e.height=n.height,e.clearRect(0,0,n.width,n.height),e.putImageData(n,0,0),(c=new Image).src=t.toDataURL(),c;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(n){var c,l,f,y,A,T,P,L;if(this.animation){for(L=[],l=A=0,T=(P=this.animation.frames).length;A<T;l=++A)c=P[l],f=n.createImageData(c.width,c.height),y=this.decodePixels(new Uint8Array(c.data)),this.copyToImageData(f,y),c.imageData=f,L.push(c.image=i(f));return L}},r.prototype.renderFrame=function(n,c){var l,f,y;return l=(f=this.animation.frames)[c],y=f[c-1],c===0&&n.clearRect(0,0,this.width,this.height),(y!=null?y.disposeOp:void 0)===1?n.clearRect(y.xOffset,y.yOffset,y.width,y.height):(y!=null?y.disposeOp:void 0)===2&&n.putImageData(y.imageData,y.xOffset,y.yOffset),l.blendOp===0&&n.clearRect(l.xOffset,l.yOffset,l.width,l.height),n.drawImage(l.image,l.xOffset,l.yOffset)},r.prototype.animate=function(n){var c,l,f,y,A,T,P=this;return l=0,T=this.animation,y=T.numFrames,f=T.frames,A=T.numPlays,(c=function(){var L,D;if(L=l++%y,D=f[L],P.renderFrame(n,L),y>1&&l/y<A)return P.animation._timeout=setTimeout(c,D.delay)})()},r.prototype.stopAnimation=function(){var n;return clearTimeout((n=this.animation)!=null?n._timeout:void 0)},r.prototype.render=function(n){var c,l;return n._png&&n._png.stopAnimation(),n._png=this,n.width=this.width,n.height=this.height,c=n.getContext("2d"),this.animation?(this.decodeFrames(c),this.animate(c)):(l=c.createImageData(this.width,this.height),this.copyToImageData(l,this.decodePixels()),c.putImageData(l,0,0))},r}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function gV(i){var t=0;if(i[t++]!==71||i[t++]!==73||i[t++]!==70||i[t++]!==56||(i[t++]+1&253)!=56||i[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=i[t++]|i[t++]<<8,r=i[t++]|i[t++]<<8,s=i[t++],n=s>>7,c=1<<(7&s)+1;i[t++],i[t++];var l=null,f=null;n&&(l=t,f=c,t+=3*c);var y=!0,A=[],T=0,P=null,L=0,D=null;for(this.width=e,this.height=r;y&&t<i.length;)switch(i[t++]){case 33:switch(i[t++]){case 255:if(i[t]!==11||i[t+1]==78&&i[t+2]==69&&i[t+3]==84&&i[t+4]==83&&i[t+5]==67&&i[t+6]==65&&i[t+7]==80&&i[t+8]==69&&i[t+9]==50&&i[t+10]==46&&i[t+11]==48&&i[t+12]==3&&i[t+13]==1&&i[t+16]==0)t+=14,D=i[t++]|i[t++]<<8,t++;else for(t+=12;;){if(!((ct=i[t++])>=0))throw Error("Invalid block size");if(ct===0)break;t+=ct}break;case 249:if(i[t++]!==4||i[t+4]!==0)throw new Error("Invalid graphics extension block.");var j=i[t++];T=i[t++]|i[t++]<<8,P=i[t++],!(1&j)&&(P=null),L=j>>2&7,t++;break;case 254:for(;;){if(!((ct=i[t++])>=0))throw Error("Invalid block size");if(ct===0)break;t+=ct}break;default:throw new Error("Unknown graphic control label: 0x"+i[t-1].toString(16))}break;case 44:var X=i[t++]|i[t++]<<8,Z=i[t++]|i[t++]<<8,$=i[t++]|i[t++]<<8,ht=i[t++]|i[t++]<<8,_t=i[t++],Mt=_t>>6&1,Nt=1<<(7&_t)+1,Rt=l,xt=f,qt=!1;_t>>7&&(qt=!0,Rt=t,xt=Nt,t+=3*Nt);var zt=t;for(t++;;){var ct;if(!((ct=i[t++])>=0))throw Error("Invalid block size");if(ct===0)break;t+=ct}A.push({x:X,y:Z,width:$,height:ht,has_local_palette:qt,palette_offset:Rt,palette_size:xt,data_offset:zt,data_length:t-zt,transparent_index:P,interlaced:!!Mt,delay:T,disposal:L});break;case 59:y=!1;break;default:throw new Error("Unknown gif block: 0x"+i[t-1].toString(16))}this.numFrames=function(){return A.length},this.loopCount=function(){return D},this.frameInfo=function(pt){if(pt<0||pt>=A.length)throw new Error("Frame index out of range.");return A[pt]},this.decodeAndBlitFrameBGRA=function(pt,Bt){var bt=this.frameInfo(pt),ne=bt.width*bt.height,oe=new Uint8Array(ne);W5(i,bt.data_offset,oe,ne);var le=bt.palette_offset,Qt=bt.transparent_index;Qt===null&&(Qt=256);var fe=bt.width,de=e-fe,Me=fe,nt=4*(bt.y*e+bt.x),Et=4*((bt.y+bt.height)*e+bt.x),Lt=nt,Gt=4*de;bt.interlaced===!0&&(Gt+=4*e*7);for(var Wt=8,$t=0,ee=oe.length;$t<ee;++$t){var Kt=oe[$t];if(Me===0&&(Me=fe,(Lt+=Gt)>=Et&&(Gt=4*de+4*e*(Wt-1),Lt=nt+(fe+de)*(Wt<<1),Wt>>=1)),Kt===Qt)Lt+=4;else{var Ce=i[le+3*Kt],Ie=i[le+3*Kt+1],Re=i[le+3*Kt+2];Bt[Lt++]=Re,Bt[Lt++]=Ie,Bt[Lt++]=Ce,Bt[Lt++]=255}--Me}},this.decodeAndBlitFrameRGBA=function(pt,Bt){var bt=this.frameInfo(pt),ne=bt.width*bt.height,oe=new Uint8Array(ne);W5(i,bt.data_offset,oe,ne);var le=bt.palette_offset,Qt=bt.transparent_index;Qt===null&&(Qt=256);var fe=bt.width,de=e-fe,Me=fe,nt=4*(bt.y*e+bt.x),Et=4*((bt.y+bt.height)*e+bt.x),Lt=nt,Gt=4*de;bt.interlaced===!0&&(Gt+=4*e*7);for(var Wt=8,$t=0,ee=oe.length;$t<ee;++$t){var Kt=oe[$t];if(Me===0&&(Me=fe,(Lt+=Gt)>=Et&&(Gt=4*de+4*e*(Wt-1),Lt=nt+(fe+de)*(Wt<<1),Wt>>=1)),Kt===Qt)Lt+=4;else{var Ce=i[le+3*Kt],Ie=i[le+3*Kt+1],Re=i[le+3*Kt+2];Bt[Lt++]=Ce,Bt[Lt++]=Ie,Bt[Lt++]=Re,Bt[Lt++]=255}--Me}}}function W5(i,t,e,r){for(var s=i[t++],n=1<<s,c=n+1,l=c+1,f=s+1,y=(1<<f)-1,A=0,T=0,P=0,L=i[t++],D=new Int32Array(4096),j=null;;){for(;A<16&&L!==0;)T|=i[t++]<<A,A+=8,L===1?L=i[t++]:--L;if(A<f)break;var X=T&y;if(T>>=f,A-=f,X!==n){if(X===c)break;for(var Z=X<l?X:j,$=0,ht=Z;ht>n;)ht=D[ht]>>8,++$;var _t=ht;if(P+$+(Z!==X?1:0)>r)return void Yr.log("Warning, gif stream longer than expected.");e[P++]=_t;var Mt=P+=$;for(Z!==X&&(e[P++]=_t),ht=Z;$--;)ht=D[ht],e[--Mt]=255&ht,ht>>=8;j!==null&&l<4096&&(D[l++]=j<<8|_t,l>=y+1&&f<12&&(++f,y=y<<1|1)),j=X}else l=c+1,y=(1<<(f=s+1))-1,j=null}return P!==r&&Yr.log("Warning, gif stream shorter than expected."),e}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Hy(i){var t,e,r,s,n,c=Math.floor,l=new Array(64),f=new Array(64),y=new Array(64),A=new Array(64),T=new Array(65535),P=new Array(65535),L=new Array(64),D=new Array(64),j=[],X=0,Z=7,$=new Array(64),ht=new Array(64),_t=new Array(64),Mt=new Array(256),Nt=new Array(2048),Rt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],xt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],qt=[0,1,2,3,4,5,6,7,8,9,10,11],zt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ct=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],pt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Bt=[0,1,2,3,4,5,6,7,8,9,10,11],bt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],ne=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function oe(nt,Et){for(var Lt=0,Gt=0,Wt=new Array,$t=1;$t<=16;$t++){for(var ee=1;ee<=nt[$t];ee++)Wt[Et[Gt]]=[],Wt[Et[Gt]][0]=Lt,Wt[Et[Gt]][1]=$t,Gt++,Lt++;Lt*=2}return Wt}function le(nt){for(var Et=nt[0],Lt=nt[1]-1;Lt>=0;)Et&1<<Lt&&(X|=1<<Z),Lt--,--Z<0&&(X==255?(Qt(255),Qt(0)):Qt(X),Z=7,X=0)}function Qt(nt){j.push(nt)}function fe(nt){Qt(nt>>8&255),Qt(255&nt)}function de(nt,Et,Lt,Gt,Wt){for(var $t,ee=Wt[0],Kt=Wt[240],Ce=function(_e,Se){var Le,Ne,ci,Ei,Ci,Ii,Vi,be,ai,Ai,De=0;for(ai=0;ai<8;++ai){Le=_e[De],Ne=_e[De+1],ci=_e[De+2],Ei=_e[De+3],Ci=_e[De+4],Ii=_e[De+5],Vi=_e[De+6];var Lr=Le+(be=_e[De+7]),me=Le-be,vi=Ne+Vi,He=Ne-Vi,Di=ci+Ii,Mr=ci-Ii,je=Ei+Ci,Ls=Ei-Ci,ir=Lr+je,rr=Lr-je,vt=vi+Di,K=vi-Di;_e[De]=ir+vt,_e[De+4]=ir-vt;var Q=.707106781*(K+rr);_e[De+2]=rr+Q,_e[De+6]=rr-Q;var rt=.382683433*((ir=Ls+Mr)-(K=He+me)),Ct=.5411961*ir+rt,kt=1.306562965*K+rt,Ut=.707106781*(vt=Mr+He),Vt=me+Ut,St=me-Ut;_e[De+5]=St+Ct,_e[De+3]=St-Ct,_e[De+1]=Vt+kt,_e[De+7]=Vt-kt,De+=8}for(De=0,ai=0;ai<8;++ai){Le=_e[De],Ne=_e[De+8],ci=_e[De+16],Ei=_e[De+24],Ci=_e[De+32],Ii=_e[De+40],Vi=_e[De+48];var Jt=Le+(be=_e[De+56]),ge=Le-be,ae=Ne+Vi,se=Ne-Vi,qe=ci+Ii,$e=ci-Ii,wi=Ei+Ci,si=Ei-Ci,Si=Jt+wi,ki=Jt-wi,qi=ae+qe,tr=ae-qe;_e[De]=Si+qi,_e[De+32]=Si-qi;var pi=.707106781*(tr+ki);_e[De+16]=ki+pi,_e[De+48]=ki-pi;var Fi=.382683433*((Si=si+$e)-(tr=se+ge)),sr=.5411961*Si+Fi,Ar=1.306562965*tr+Fi,Qr=.707106781*(qi=$e+se),nr=ge+Qr,pn=ge-Qr;_e[De+40]=pn+sr,_e[De+24]=pn-sr,_e[De+8]=nr+Ar,_e[De+56]=nr-Ar,De++}for(ai=0;ai<64;++ai)Ai=_e[ai]*Se[ai],L[ai]=Ai>0?Ai+.5|0:Ai-.5|0;return L}(nt,Et),Ie=0;Ie<64;++Ie)D[Rt[Ie]]=Ce[Ie];var Re=D[0]-Lt;Lt=D[0],Re==0?le(Gt[0]):(le(Gt[P[$t=32767+Re]]),le(T[$t]));for(var Fe=63;Fe>0&&D[Fe]==0;)Fe--;if(Fe==0)return le(ee),Lt;for(var Ze,he=1;he<=Fe;){for(var ot=he;D[he]==0&&he<=Fe;)++he;var mi=he-ot;if(mi>=16){Ze=mi>>4;for(var ri=1;ri<=Ze;++ri)le(Kt);mi&=15}$t=32767+D[he],le(Wt[(mi<<4)+P[$t]]),le(T[$t]),he++}return Fe!=63&&le(ee),Lt}function Me(nt){nt=Math.min(Math.max(nt,1),100),n!=nt&&(function(Et){for(var Lt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Gt=0;Gt<64;Gt++){var Wt=c((Lt[Gt]*Et+50)/100);Wt=Math.min(Math.max(Wt,1),255),l[Rt[Gt]]=Wt}for(var $t=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ee=0;ee<64;ee++){var Kt=c(($t[ee]*Et+50)/100);Kt=Math.min(Math.max(Kt,1),255),f[Rt[ee]]=Kt}for(var Ce=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ie=0,Re=0;Re<8;Re++)for(var Fe=0;Fe<8;Fe++)y[Ie]=1/(l[Rt[Ie]]*Ce[Re]*Ce[Fe]*8),A[Ie]=1/(f[Rt[Ie]]*Ce[Re]*Ce[Fe]*8),Ie++}(nt<50?Math.floor(5e3/nt):Math.floor(200-2*nt)),n=nt)}this.encode=function(nt,Et){Et&&Me(Et),j=new Array,X=0,Z=7,fe(65496),fe(65504),fe(16),Qt(74),Qt(70),Qt(73),Qt(70),Qt(0),Qt(1),Qt(1),Qt(0),fe(1),fe(1),Qt(0),Qt(0),function(){fe(65499),fe(132),Qt(0);for(var Ne=0;Ne<64;Ne++)Qt(l[Ne]);Qt(1);for(var ci=0;ci<64;ci++)Qt(f[ci])}(),function(Ne,ci){fe(65472),fe(17),Qt(8),fe(ci),fe(Ne),Qt(3),Qt(1),Qt(17),Qt(0),Qt(2),Qt(17),Qt(1),Qt(3),Qt(17),Qt(1)}(nt.width,nt.height),function(){fe(65476),fe(418),Qt(0);for(var Ne=0;Ne<16;Ne++)Qt(xt[Ne+1]);for(var ci=0;ci<=11;ci++)Qt(qt[ci]);Qt(16);for(var Ei=0;Ei<16;Ei++)Qt(zt[Ei+1]);for(var Ci=0;Ci<=161;Ci++)Qt(ct[Ci]);Qt(1);for(var Ii=0;Ii<16;Ii++)Qt(pt[Ii+1]);for(var Vi=0;Vi<=11;Vi++)Qt(Bt[Vi]);Qt(17);for(var be=0;be<16;be++)Qt(bt[be+1]);for(var ai=0;ai<=161;ai++)Qt(ne[ai])}(),fe(65498),fe(12),Qt(3),Qt(1),Qt(0),Qt(2),Qt(17),Qt(3),Qt(17),Qt(0),Qt(63),Qt(0);var Lt=0,Gt=0,Wt=0;X=0,Z=7,this.encode.displayName="_encode_";for(var $t,ee,Kt,Ce,Ie,Re,Fe,Ze,he,ot=nt.data,mi=nt.width,ri=nt.height,_e=4*mi,Se=0;Se<ri;){for($t=0;$t<_e;){for(Ie=_e*Se+$t,Fe=-1,Ze=0,he=0;he<64;he++)Re=Ie+(Ze=he>>3)*_e+(Fe=4*(7&he)),Se+Ze>=ri&&(Re-=_e*(Se+1+Ze-ri)),$t+Fe>=_e&&(Re-=$t+Fe-_e+4),ee=ot[Re++],Kt=ot[Re++],Ce=ot[Re++],$[he]=(Nt[ee]+Nt[Kt+256>>0]+Nt[Ce+512>>0]>>16)-128,ht[he]=(Nt[ee+768>>0]+Nt[Kt+1024>>0]+Nt[Ce+1280>>0]>>16)-128,_t[he]=(Nt[ee+1280>>0]+Nt[Kt+1536>>0]+Nt[Ce+1792>>0]>>16)-128;Lt=de($,y,Lt,t,r),Gt=de(ht,A,Gt,e,s),Wt=de(_t,A,Wt,e,s),$t+=32}Se+=8}if(Z>=0){var Le=[];Le[1]=Z+1,Le[0]=(1<<Z+1)-1,le(Le)}return fe(65497),new Uint8Array(j)},i=i||50,function(){for(var nt=String.fromCharCode,Et=0;Et<256;Et++)Mt[Et]=nt(Et)}(),t=oe(xt,qt),e=oe(pt,Bt),r=oe(zt,ct),s=oe(bt,ne),function(){for(var nt=1,Et=2,Lt=1;Lt<=15;Lt++){for(var Gt=nt;Gt<Et;Gt++)P[32767+Gt]=Lt,T[32767+Gt]=[],T[32767+Gt][1]=Lt,T[32767+Gt][0]=Gt;for(var Wt=-(Et-1);Wt<=-nt;Wt++)P[32767+Wt]=Lt,T[32767+Wt]=[],T[32767+Wt][1]=Lt,T[32767+Wt][0]=Et-1+Wt;nt<<=1,Et<<=1}}(),function(){for(var nt=0;nt<256;nt++)Nt[nt]=19595*nt,Nt[nt+256>>0]=38470*nt,Nt[nt+512>>0]=7471*nt+32768,Nt[nt+768>>0]=-11059*nt,Nt[nt+1024>>0]=-21709*nt,Nt[nt+1280>>0]=32768*nt+8421375,Nt[nt+1536>>0]=-27439*nt,Nt[nt+1792>>0]=-5329*nt}(),Me(i)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function fl(i,t){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function J5(i){function t(xt){if(!xt)throw Error("assert :P")}function e(xt,qt,zt){for(var ct=0;4>ct;ct++)if(xt[qt+ct]!=zt.charCodeAt(ct))return!0;return!1}function r(xt,qt,zt,ct,pt){for(var Bt=0;Bt<pt;Bt++)xt[qt+Bt]=zt[ct+Bt]}function s(xt,qt,zt,ct){for(var pt=0;pt<ct;pt++)xt[qt+pt]=zt}function n(xt){return new Int32Array(xt)}function c(xt,qt){for(var zt=[],ct=0;ct<xt;ct++)zt.push(new qt);return zt}function l(xt,qt){var zt=[];return function ct(pt,Bt,bt){for(var ne=bt[Bt],oe=0;oe<ne&&(pt.push(bt.length>Bt+1?[]:new qt),!(bt.length<Bt+1));oe++)ct(pt[oe],Bt+1,bt)}(zt,0,xt),zt}var f=function(){var xt=this;function qt(g,b){for(var C=1<<b-1>>>0;g&C;)C>>>=1;return C?(g&C-1)+C:g}function zt(g,b,C,M,O){t(!(M%C));do g[b+(M-=C)]=O;while(0<M)}function ct(g,b,C,M,O){if(t(2328>=O),512>=O)var z=n(512);else if((z=n(O))==null)return 0;return function(U,V,G,J,lt,tt){var ut,dt,Tt=V,wt=1<<G,gt=n(16),mt=n(16);for(t(lt!=0),t(J!=null),t(U!=null),t(0<G),dt=0;dt<lt;++dt){if(15<J[dt])return 0;++gt[J[dt]]}if(gt[0]==lt)return 0;for(mt[1]=0,ut=1;15>ut;++ut){if(gt[ut]>1<<ut)return 0;mt[ut+1]=mt[ut]+gt[ut]}for(dt=0;dt<lt;++dt)ut=J[dt],0<J[dt]&&(tt[mt[ut]++]=dt);if(mt[15]==1)return(J=new pt).g=0,J.value=tt[0],zt(U,Tt,1,wt,J),wt;var Dt,Xt=-1,ie=wt-1,re=0,ue=1,Pe=1,xe=1<<G;for(dt=0,ut=1,lt=2;ut<=G;++ut,lt<<=1){if(ue+=Pe<<=1,0>(Pe-=gt[ut]))return 0;for(;0<gt[ut];--gt[ut])(J=new pt).g=ut,J.value=tt[dt++],zt(U,Tt+re,lt,xe,J),re=qt(re,ut)}for(ut=G+1,lt=2;15>=ut;++ut,lt<<=1){if(ue+=Pe<<=1,0>(Pe-=gt[ut]))return 0;for(;0<gt[ut];--gt[ut]){if(J=new pt,(re&ie)!=Xt){for(Tt+=xe,Dt=1<<(Xt=ut)-G;15>Xt&&!(0>=(Dt-=gt[Xt]));)++Xt,Dt<<=1;wt+=xe=1<<(Dt=Xt-G),U[V+(Xt=re&ie)].g=Dt+G,U[V+Xt].value=Tt-V-Xt}J.g=ut-G,J.value=tt[dt++],zt(U,Tt+(re>>G),lt,xe,J),re=qt(re,ut)}}return ue!=2*mt[15]-1?0:wt}(g,b,C,M,O,z)}function pt(){this.value=this.g=0}function Bt(){this.value=this.g=0}function bt(){this.G=c(5,pt),this.H=n(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=c(Dr,Bt)}function ne(g,b,C,M){t(g!=null),t(b!=null),t(2147483648>M),g.Ca=254,g.I=0,g.b=-8,g.Ka=0,g.oa=b,g.pa=C,g.Jd=b,g.Yc=C+M,g.Zc=4<=M?C+M-4+1:C,$t(g)}function oe(g,b){for(var C=0;0<b--;)C|=Kt(g,128)<<b;return C}function le(g,b){var C=oe(g,b);return ee(g)?-C:C}function Qt(g,b,C,M){var O,z=0;for(t(g!=null),t(b!=null),t(4294967288>M),g.Sb=M,g.Ra=0,g.u=0,g.h=0,4<M&&(M=4),O=0;O<M;++O)z+=b[C+O]<<8*O;g.Ra=z,g.bb=M,g.oa=b,g.pa=C}function fe(g){for(;8<=g.u&&g.bb<g.Sb;)g.Ra>>>=8,g.Ra+=g.oa[g.pa+g.bb]<<Ba-8>>>0,++g.bb,g.u-=8;Lt(g)&&(g.h=1,g.u=0)}function de(g,b){if(t(0<=b),!g.h&&b<=il){var C=Et(g)&el[b];return g.u+=b,fe(g),C}return g.h=1,g.u=0}function Me(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function nt(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Et(g){return g.Ra>>>(g.u&Ba-1)>>>0}function Lt(g){return t(g.bb<=g.Sb),g.h||g.bb==g.Sb&&g.u>Ba}function Gt(g,b){g.u=b,g.h=Lt(g)}function Wt(g){g.u>=io&&(t(g.u>=io),fe(g))}function $t(g){t(g!=null&&g.oa!=null),g.pa<g.Zc?(g.I=(g.oa[g.pa++]|g.I<<8)>>>0,g.b+=8):(t(g!=null&&g.oa!=null),g.pa<g.Yc?(g.b+=8,g.I=g.oa[g.pa++]|g.I<<8):g.Ka?g.b=0:(g.I<<=8,g.b+=8,g.Ka=1))}function ee(g){return oe(g,1)}function Kt(g,b){var C=g.Ca;0>g.b&&$t(g);var M=g.b,O=C*b>>>8,z=(g.I>>>M>O)+0;for(z?(C-=O,g.I-=O+1<<M>>>0):C=O+1,M=C,O=0;256<=M;)O+=8,M>>=8;return M=7^O+Rs[M],g.b-=M,g.Ca=(C<<M)-1,z}function Ce(g,b,C){g[b+0]=C>>24&255,g[b+1]=C>>16&255,g[b+2]=C>>8&255,g[b+3]=C>>0&255}function Ie(g,b){return g[b+0]<<0|g[b+1]<<8}function Re(g,b){return Ie(g,b)|g[b+2]<<16}function Fe(g,b){return Ie(g,b)|Ie(g,b+2)<<16}function Ze(g,b){var C=1<<b;return t(g!=null),t(0<b),g.X=n(C),g.X==null?0:(g.Mb=32-b,g.Xa=b,1)}function he(g,b){t(g!=null),t(b!=null),t(g.Xa==b.Xa),r(b.X,0,g.X,0,1<<b.Xa)}function ot(){this.X=[],this.Xa=this.Mb=0}function mi(g,b,C,M){t(C!=null),t(M!=null);var O=C[0],z=M[0];return O==0&&(O=(g*z+b/2)/b),z==0&&(z=(b*O+g/2)/g),0>=O||0>=z?0:(C[0]=O,M[0]=z,1)}function ri(g,b){return g+(1<<b)-1>>>b}function _e(g,b){return((4278255360&g)+(4278255360&b)>>>0&4278255360)+((16711935&g)+(16711935&b)>>>0&16711935)>>>0}function Se(g,b){xt[b]=function(C,M,O,z,U,V,G){var J;for(J=0;J<U;++J){var lt=xt[g](V[G+J-1],O,z+J);V[G+J]=_e(C[M+J],lt)}}}function Le(){this.ud=this.hd=this.jd=0}function Ne(g,b){return((4278124286&(g^b))>>>1)+(g&b)>>>0}function ci(g){return 0<=g&&256>g?g:0>g?0:255<g?255:void 0}function Ei(g,b){return ci(g+(g-b+.5>>1))}function Ci(g,b,C){return Math.abs(b-C)-Math.abs(g-C)}function Ii(g,b,C,M,O,z,U){for(M=z[U-1],C=0;C<O;++C)z[U+C]=M=_e(g[b+C],M)}function Vi(g,b,C,M,O){var z;for(z=0;z<C;++z){var U=g[b+z],V=U>>8&255,G=16711935&(G=(G=16711935&U)+((V<<16)+V));M[O+z]=(4278255360&U)+G>>>0}}function be(g,b){b.jd=g>>0&255,b.hd=g>>8&255,b.ud=g>>16&255}function ai(g,b,C,M,O,z){var U;for(U=0;U<M;++U){var V=b[C+U],G=V>>>8,J=V,lt=255&(lt=(lt=V>>>16)+((g.jd<<24>>24)*(G<<24>>24)>>>5));J=255&(J=(J=J+((g.hd<<24>>24)*(G<<24>>24)>>>5))+((g.ud<<24>>24)*(lt<<24>>24)>>>5)),O[z+U]=(4278255360&V)+(lt<<16)+J}}function Ai(g,b,C,M,O){xt[b]=function(z,U,V,G,J,lt,tt,ut,dt){for(G=tt;G<ut;++G)for(tt=0;tt<dt;++tt)J[lt++]=O(V[M(z[U++])])},xt[g]=function(z,U,V,G,J,lt,tt){var ut=8>>z.b,dt=z.Ea,Tt=z.K[0],wt=z.w;if(8>ut)for(z=(1<<z.b)-1,wt=(1<<ut)-1;U<V;++U){var gt,mt=0;for(gt=0;gt<dt;++gt)gt&z||(mt=M(G[J++])),lt[tt++]=O(Tt[mt&wt]),mt>>=ut}else xt["VP8LMapColor"+C](G,J,Tt,wt,lt,tt,U,V,dt)}}function De(g,b,C,M,O){for(C=b+C;b<C;){var z=g[b++];M[O++]=z>>16&255,M[O++]=z>>8&255,M[O++]=z>>0&255}}function Lr(g,b,C,M,O){for(C=b+C;b<C;){var z=g[b++];M[O++]=z>>16&255,M[O++]=z>>8&255,M[O++]=z>>0&255,M[O++]=z>>24&255}}function me(g,b,C,M,O){for(C=b+C;b<C;){var z=(U=g[b++])>>16&240|U>>12&15,U=U>>0&240|U>>28&15;M[O++]=z,M[O++]=U}}function vi(g,b,C,M,O){for(C=b+C;b<C;){var z=(U=g[b++])>>16&248|U>>13&7,U=U>>5&224|U>>3&31;M[O++]=z,M[O++]=U}}function He(g,b,C,M,O){for(C=b+C;b<C;){var z=g[b++];M[O++]=z>>0&255,M[O++]=z>>8&255,M[O++]=z>>16&255}}function Di(g,b,C,M,O,z){if(z==0)for(C=b+C;b<C;)Ce(M,((z=g[b++])[0]>>24|z[1]>>8&65280|z[2]<<8&16711680|z[3]<<24)>>>0),O+=32;else r(M,O,g,b,C)}function Mr(g,b){xt[b][0]=xt[g+"0"],xt[b][1]=xt[g+"1"],xt[b][2]=xt[g+"2"],xt[b][3]=xt[g+"3"],xt[b][4]=xt[g+"4"],xt[b][5]=xt[g+"5"],xt[b][6]=xt[g+"6"],xt[b][7]=xt[g+"7"],xt[b][8]=xt[g+"8"],xt[b][9]=xt[g+"9"],xt[b][10]=xt[g+"10"],xt[b][11]=xt[g+"11"],xt[b][12]=xt[g+"12"],xt[b][13]=xt[g+"13"],xt[b][14]=xt[g+"0"],xt[b][15]=xt[g+"0"]}function je(g){return g==ia||g==Sc||g==jl||g==Ec}function Ls(){this.eb=[],this.size=this.A=this.fb=0}function ir(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function rr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Ls,this.f.kb=new ir,this.sd=null}function vt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function K(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Q(g){return alert("todo:WebPSamplerProcessPlane"),g.T}function rt(g,b){var C=g.T,M=b.ba.f.RGBA,O=M.eb,z=M.fb+g.ka*M.A,U=bn[b.ba.S],V=g.y,G=g.O,J=g.f,lt=g.N,tt=g.ea,ut=g.W,dt=b.cc,Tt=b.dc,wt=b.Mc,gt=b.Nc,mt=g.ka,Dt=g.ka+g.T,Xt=g.U,ie=Xt+1>>1;for(mt==0?U(V,G,null,null,J,lt,tt,ut,J,lt,tt,ut,O,z,null,null,Xt):(U(b.ec,b.fc,V,G,dt,Tt,wt,gt,J,lt,tt,ut,O,z-M.A,O,z,Xt),++C);mt+2<Dt;mt+=2)dt=J,Tt=lt,wt=tt,gt=ut,lt+=g.Rc,ut+=g.Rc,z+=2*M.A,U(V,(G+=2*g.fa)-g.fa,V,G,dt,Tt,wt,gt,J,lt,tt,ut,O,z-M.A,O,z,Xt);return G+=g.fa,g.j+Dt<g.o?(r(b.ec,b.fc,V,G,Xt),r(b.cc,b.dc,J,lt,ie),r(b.Mc,b.Nc,tt,ut,ie),C--):1&Dt||U(V,G,null,null,J,lt,tt,ut,J,lt,tt,ut,O,z+M.A,null,null,Xt),C}function Ct(g,b,C){var M=g.F,O=[g.J];if(M!=null){var z=g.U,U=b.ba.S,V=U==Ul||U==jl;b=b.ba.f.RGBA;var G=[0],J=g.ka;G[0]=g.T,g.Kb&&(J==0?--G[0]:(--J,O[0]-=g.width),g.j+g.ka+g.T==g.o&&(G[0]=g.o-g.j-J));var lt=b.eb;J=b.fb+J*b.A,g=lo(M,O[0],g.width,z,G,lt,J+(V?0:3),b.A),t(C==G),g&&je(U)&&ao(lt,J,V,z,G,b.A)}return 0}function kt(g){var b=g.ma,C=b.ba.S,M=11>C,O=C==nl||C==ol||C==Ul||C==ah||C==12||je(C);if(b.memory=null,b.Ib=null,b.Jb=null,b.Nd=null,!Ma(b.Oa,g,O?11:12))return 0;if(O&&je(C)&&Te(),g.da)alert("todo:use_scaling");else{if(M){if(b.Ib=Q,g.Kb){if(C=g.U+1>>1,b.memory=n(g.U+2*C),b.memory==null)return 0;b.ec=b.memory,b.fc=0,b.cc=b.ec,b.dc=b.fc+g.U,b.Mc=b.cc,b.Nc=b.dc+C,b.Ib=rt,Te()}}else alert("todo:EmitYUV");O&&(b.Jb=Ct,M&&Yt())}if(M&&!Ju){for(g=0;256>g;++g)Bo[g]=89858*(g-128)+Mo>>br,w[g]=-22014*(g-128)+Mo,oi[g]=-45773*(g-128),Tc[g]=113618*(g-128)+Mo>>br;for(g=co;g<dh;++g)b=76283*(g-16)+Mo>>br,a[g-co]=gn(b,255),d[g-co]=gn(b+8>>4,15);Ju=1}return 1}function Ut(g){var b=g.ma,C=g.U,M=g.T;return t(!(1&g.ka)),0>=C||0>=M?0:(C=b.Ib(g,b),b.Jb!=null&&b.Jb(g,b,C),b.Dc+=C,1)}function Vt(g){g.ma.memory=null}function St(g,b,C,M){return de(g,8)!=47?0:(b[0]=de(g,14)+1,C[0]=de(g,14)+1,M[0]=de(g,1),de(g,3)!=0?0:!g.h)}function Jt(g,b){if(4>g)return g+1;var C=g-2>>1;return(2+(1&g)<<C)+de(b,C)+1}function ge(g,b){return 120<b?b-120:1<=(C=((C=tu[b-1])>>4)*g+(8-(15&C)))?C:1;var C}function ae(g,b,C){var M=Et(C),O=g[b+=255&M].g-8;return 0<O&&(Gt(C,C.u+8),M=Et(C),b+=g[b].value,b+=M&(1<<O)-1),Gt(C,C.u+g[b].g),g[b].value}function se(g,b,C){return C.g+=g.g,C.value+=g.value<<b>>>0,t(8>=C.g),g.g}function qe(g,b,C){var M=g.xc;return t((b=M==0?0:g.vc[g.md*(C>>M)+(b>>M)])<g.Wb),g.Ya[b]}function $e(g,b,C,M){var O=g.ab,z=g.c*b,U=g.C;b=U+b;var V=C,G=M;for(M=g.Ta,C=g.Ua;0<O--;){var J=g.gc[O],lt=U,tt=b,ut=V,dt=G,Tt=(G=M,V=C,J.Ea);switch(t(lt<tt),t(tt<=J.nc),J.hc){case 2:Ra(ut,dt,(tt-lt)*Tt,G,V);break;case 0:var wt=lt,gt=tt,mt=G,Dt=V,Xt=(xe=J).Ea;wt==0&&(zl(ut,dt,null,null,1,mt,Dt),Ii(ut,dt+1,0,0,Xt-1,mt,Dt+1),dt+=Xt,Dt+=Xt,++wt);for(var ie=1<<xe.b,re=ie-1,ue=ri(Xt,xe.b),Pe=xe.K,xe=xe.w+(wt>>xe.b)*ue;wt<gt;){var Oe=Pe,Xe=xe,We=1;for(Yo(ut,dt,mt,Dt-Xt,1,mt,Dt);We<Xt;){var _i=(We&~re)+ie;_i>Xt&&(_i=Xt),(0,Co[Oe[Xe++]>>8&15])(ut,dt+ +We,mt,Dt+We-Xt,_i-We,mt,Dt+We),We=_i}dt+=Xt,Dt+=Xt,++wt&re||(xe+=ue)}tt!=J.nc&&r(G,V-Tt,G,V+(tt-lt-1)*Tt,Tt);break;case 1:for(Tt=ut,gt=dt,Xt=(ut=J.Ea)-(Dt=ut&~(mt=(dt=1<<J.b)-1)),wt=ri(ut,J.b),ie=J.K,J=J.w+(lt>>J.b)*wt;lt<tt;){for(re=ie,ue=J,Pe=new Le,xe=gt+Dt,Oe=gt+ut;gt<xe;)be(re[ue++],Pe),Pi(Pe,Tt,gt,dt,G,V),gt+=dt,V+=dt;gt<Oe&&(be(re[ue++],Pe),Pi(Pe,Tt,gt,Xt,G,V),gt+=Xt,V+=Xt),++lt&mt||(J+=wt)}break;case 3:if(ut==G&&dt==V&&0<J.b){for(gt=G,ut=Tt=V+(tt-lt)*Tt-(Dt=(tt-lt)*ri(J.Ea,J.b)),dt=G,mt=V,wt=[],Dt=(Xt=Dt)-1;0<=Dt;--Dt)wt[Dt]=dt[mt+Dt];for(Dt=Xt-1;0<=Dt;--Dt)gt[ut+Dt]=wt[Dt];yn(J,lt,tt,G,Tt,G,V)}else yn(J,lt,tt,ut,dt,G,V)}V=M,G=C}G!=C&&r(M,C,V,G,z)}function wi(g,b){var C=g.V,M=g.Ba+g.c*g.C,O=b-g.C;if(t(b<=g.l.o),t(16>=O),0<O){var z=g.l,U=g.Ta,V=g.Ua,G=z.width;if($e(g,O,C,M),O=V=[V],t((C=g.C)<(M=b)),t(z.v<z.va),M>z.o&&(M=z.o),C<z.j){var J=z.j-C;C=z.j,O[0]+=J*G}if(C>=M?C=0:(O[0]+=4*z.v,z.ka=C-z.j,z.U=z.va-z.v,z.T=M-C,C=1),C){if(V=V[0],11>(C=g.ca).S){var lt=C.f.RGBA,tt=(M=C.S,O=z.U,z=z.T,J=lt.eb,lt.A),ut=z;for(lt=lt.fb+g.Ma*lt.A;0<ut--;){var dt=U,Tt=V,wt=O,gt=J,mt=lt;switch(M){case ea:ks(dt,Tt,wt,gt,mt);break;case nl:ro(dt,Tt,wt,gt,mt);break;case ia:ro(dt,Tt,wt,gt,mt),ao(gt,mt,0,wt,1,0);break;case oh:rl(dt,Tt,wt,gt,mt);break;case ol:Di(dt,Tt,wt,gt,mt,1);break;case Sc:Di(dt,Tt,wt,gt,mt,1),ao(gt,mt,0,wt,1,0);break;case Ul:Di(dt,Tt,wt,gt,mt,0);break;case jl:Di(dt,Tt,wt,gt,mt,0),ao(gt,mt,1,wt,1,0);break;case ah:kn(dt,Tt,wt,gt,mt);break;case Ec:kn(dt,Tt,wt,gt,mt),sl(gt,mt,wt,1,0);break;case lh:Js(dt,Tt,wt,gt,mt);break;default:t(0)}V+=G,lt+=tt}g.Ma+=z}else alert("todo:EmitRescaledRowsYUVA");t(g.Ma<=C.height)}}g.C=b,t(g.C<=g.i)}function si(g){var b;if(0<g.ua)return 0;for(b=0;b<g.Wb;++b){var C=g.Ya[b].G,M=g.Ya[b].H;if(0<C[1][M[1]+0].g||0<C[2][M[2]+0].g||0<C[3][M[3]+0].g)return 0}return 1}function Si(g,b,C,M,O,z){if(g.Z!=0){var U=g.qd,V=g.rd;for(t(Lo[g.Z]!=null);b<C;++b)Lo[g.Z](U,V,M,O,M,O,z),U=M,V=O,O+=z;g.qd=U,g.rd=V}}function ki(g,b){var C=g.l.ma,M=C.Z==0||C.Z==1?g.l.j:g.C;if(M=g.C<M?M:g.C,t(b<=g.l.o),b>M){var O=g.l.width,z=C.ca,U=C.tb+O*M,V=g.V,G=g.Ba+g.c*M,J=g.gc;t(g.ab==1),t(J[0].hc==3),ka(J[0],M,b,V,G,z,U),Si(C,M,b,z,U,O)}g.C=g.Ma=b}function qi(g,b,C,M,O,z,U){var V=g.$/M,G=g.$%M,J=g.m,lt=g.s,tt=C+g.$,ut=tt;O=C+M*O;var dt=C+M*z,Tt=280+lt.ua,wt=g.Pb?V:16777216,gt=0<lt.ua?lt.Wa:null,mt=lt.wc,Dt=tt<dt?qe(lt,G,V):null;t(g.C<z),t(dt<=O);var Xt=!1;t:for(;;){for(;Xt||tt<dt;){var ie=0;if(V>=wt){var re=tt-C;t((wt=g).Pb),wt.wd=wt.m,wt.xd=re,0<wt.s.ua&&he(wt.s.Wa,wt.s.vb),wt=V+Io}if(G&mt||(Dt=qe(lt,G,V)),t(Dt!=null),Dt.Qb&&(b[tt]=Dt.qb,Xt=!0),!Xt)if(Wt(J),Dt.jc){ie=J,re=b;var ue=tt,Pe=Dt.pd[Et(ie)&Dr-1];t(Dt.jc),256>Pe.g?(Gt(ie,ie.u+Pe.g),re[ue]=Pe.value,ie=0):(Gt(ie,ie.u+Pe.g-256),t(256<=Pe.value),ie=Pe.value),ie==0&&(Xt=!0)}else ie=ae(Dt.G[0],Dt.H[0],J);if(J.h)break;if(Xt||256>ie){if(!Xt)if(Dt.nd)b[tt]=(Dt.qb|ie<<8)>>>0;else{if(Wt(J),Xt=ae(Dt.G[1],Dt.H[1],J),Wt(J),re=ae(Dt.G[2],Dt.H[2],J),ue=ae(Dt.G[3],Dt.H[3],J),J.h)break;b[tt]=(ue<<24|Xt<<16|ie<<8|re)>>>0}if(Xt=!1,++tt,++G>=M&&(G=0,++V,U!=null&&V<=z&&!(V%16)&&U(g,V),gt!=null))for(;ut<tt;)ie=b[ut++],gt.X[(506832829*ie&4294967295)>>>gt.Mb]=ie}else if(280>ie){if(ie=Jt(ie-256,J),re=ae(Dt.G[4],Dt.H[4],J),Wt(J),re=ge(M,re=Jt(re,J)),J.h)break;if(tt-C<re||O-tt<ie)break t;for(ue=0;ue<ie;++ue)b[tt+ue]=b[tt+ue-re];for(tt+=ie,G+=ie;G>=M;)G-=M,++V,U!=null&&V<=z&&!(V%16)&&U(g,V);if(t(tt<=O),G&mt&&(Dt=qe(lt,G,V)),gt!=null)for(;ut<tt;)ie=b[ut++],gt.X[(506832829*ie&4294967295)>>>gt.Mb]=ie}else{if(!(ie<Tt))break t;for(Xt=ie-280,t(gt!=null);ut<tt;)ie=b[ut++],gt.X[(506832829*ie&4294967295)>>>gt.Mb]=ie;ie=tt,t(!(Xt>>>(re=gt).Xa)),b[ie]=re.X[Xt],Xt=!0}Xt||t(J.h==Lt(J))}if(g.Pb&&J.h&&tt<O)t(g.m.h),g.a=5,g.m=g.wd,g.$=g.xd,0<g.s.ua&&he(g.s.vb,g.s.Wa);else{if(J.h)break t;U!=null&&U(g,V>z?z:V),g.a=0,g.$=tt-C}return 1}return g.a=3,0}function tr(g){t(g!=null),g.vc=null,g.yc=null,g.Ya=null;var b=g.Wa;b!=null&&(b.X=null),g.vb=null,t(g!=null)}function pi(){var g=new ih;return g==null?null:(g.a=0,g.xb=ze,Mr("Predictor","VP8LPredictors"),Mr("Predictor","VP8LPredictors_C"),Mr("PredictorAdd","VP8LPredictorsAdd"),Mr("PredictorAdd","VP8LPredictorsAdd_C"),Ra=Vi,Pi=ai,ks=De,ro=Lr,kn=me,Js=vi,rl=He,xt.VP8LMapColor32b=_n,xt.VP8LMapColor8b=wc,g)}function Fi(g,b,C,M,O){var z=1,U=[g],V=[b],G=M.m,J=M.s,lt=null,tt=0;t:for(;;){if(C)for(;z&&de(G,1);){var ut=U,dt=V,Tt=M,wt=1,gt=Tt.m,mt=Tt.gc[Tt.ab],Dt=de(gt,2);if(Tt.Oc&1<<Dt)z=0;else{switch(Tt.Oc|=1<<Dt,mt.hc=Dt,mt.Ea=ut[0],mt.nc=dt[0],mt.K=[null],++Tt.ab,t(4>=Tt.ab),Dt){case 0:case 1:mt.b=de(gt,3)+2,wt=Fi(ri(mt.Ea,mt.b),ri(mt.nc,mt.b),0,Tt,mt.K),mt.K=mt.K[0];break;case 3:var Xt,ie=de(gt,8)+1,re=16<ie?0:4<ie?1:2<ie?2:3;if(ut[0]=ri(mt.Ea,re),mt.b=re,Xt=wt=Fi(ie,1,0,Tt,mt.K)){var ue,Pe=ie,xe=mt,Oe=1<<(8>>xe.b),Xe=n(Oe);if(Xe==null)Xt=0;else{var We=xe.K[0],_i=xe.w;for(Xe[0]=xe.K[0][0],ue=1;ue<1*Pe;++ue)Xe[ue]=_e(We[_i+ue],Xe[ue-1]);for(;ue<4*Oe;++ue)Xe[ue]=0;xe.K[0]=null,xe.K[0]=Xe,Xt=1}}wt=Xt;break;case 2:break;default:t(0)}z=wt}}if(U=U[0],V=V[0],z&&de(G,1)&&!(z=1<=(tt=de(G,4))&&11>=tt)){M.a=3;break t}var xi;if(xi=z)e:{var Ui,gi,Ni,Er=M,ur=U,Zr=V,Zi=tt,bs=C,ps=Er.m,Vr=Er.s,or=[null],dr=1,Br=0,sn=rn[Zi];i:for(;;){if(bs&&de(ps,1)){var $i=de(ps,3)+2,ar=ri(ur,$i),ws=ri(Zr,$i),qr=ar*ws;if(!Fi(ar,ws,0,Er,or))break i;for(or=or[0],Vr.xc=$i,Ui=0;Ui<qr;++Ui){var Na=or[Ui]>>8&65535;or[Ui]=Na,Na>=dr&&(dr=Na+1)}}if(ps.h)break i;for(gi=0;5>gi;++gi){var $r=ch[gi];!gi&&0<Zi&&($r+=1<<Zi),Br<$r&&(Br=$r)}var su=c(dr*sn,pt),al=dr,fh=c(al,bt);if(fh==null)var gh=null;else t(65536>=al),gh=fh;var Ro=n(Br);if(gh==null||Ro==null||su==null){Er.a=1;break i}var ns=su;for(Ui=Ni=0;Ui<dr;++Ui){var wn=gh[Ui],ko=wn.G,ho=wn.H,mh=0,Hl=1,ip=0;for(gi=0;5>gi;++gi){$r=ch[gi],ko[gi]=ns,ho[gi]=Ni,!gi&&0<Zi&&($r+=1<<Zi);s:{var nu,rp=$r,yh=Er,Wl=Ro,Ff=ns,sp=Ni,_h=0,zn=yh.m,Xu=de(zn,1);if(s(Wl,0,0,rp),Xu){var Nf=de(zn,1)+1,Df=de(zn,1),zf=de(zn,Df==0?1:8);Wl[zf]=1,Nf==2&&(Wl[zf=de(zn,8)]=1);var vh=1}else{var bh=n(19),Pc=de(zn,4)+4;if(19<Pc){yh.a=3;var Oo=0;break s}for(nu=0;nu<Pc;++nu)bh[Gl[nu]]=de(zn,3);var uo=void 0,Fo=void 0,np=yh,Ic=bh,Zu=rp,op=Wl,ts=0,Da=np.m,ap=8,Jl=c(128,pt);r:for(;ct(Jl,0,7,Ic,19);){if(de(Da,1)){var Lc=2+2*de(Da,3);if((uo=2+de(Da,Lc))>Zu)break r}else uo=Zu;for(Fo=0;Fo<Zu&&uo--;){Wt(Da);var ou=Jl[0+(127&Et(Da))];Gt(Da,Da.u+ou.g);var Xl=ou.value;if(16>Xl)op[Fo++]=Xl,Xl!=0&&(ap=Xl);else{var Uf=Xl==16,jf=Xl-16,Gf=Gu[jf],Vf=de(Da,ju[jf])+Gf;if(Fo+Vf>Zu)break r;for(var lp=Uf?ap:0;0<Vf--;)op[Fo++]=lp}}ts=1;break r}ts||(np.a=3),vh=ts}(vh=vh&&!zn.h)&&(_h=ct(Ff,sp,8,Wl,rp)),vh&&_h!=0?Oo=_h:(yh.a=3,Oo=0)}if(Oo==0)break i;if(Hl&&Qh[gi]==1&&(Hl=ns[Ni].g==0),mh+=ns[Ni].g,Ni+=Oo,3>=gi){var au,lu=Ro[0];for(au=1;au<$r;++au)Ro[au]>lu&&(lu=Ro[au]);ip+=lu}}if(wn.nd=Hl,wn.Qb=0,Hl&&(wn.qb=(ko[3][ho[3]+0].value<<24|ko[1][ho[1]+0].value<<16|ko[2][ho[2]+0].value)>>>0,mh==0&&256>ko[0][ho[0]+0].value&&(wn.Qb=1,wn.qb+=ko[0][ho[0]+0].value<<8)),wn.jc=!wn.Qb&&6>ip,wn.jc){var cu,za=wn;for(cu=0;cu<Dr;++cu){var po=cu,Zl=za.pd[po],$l=za.G[0][za.H[0]+po];256<=$l.value?(Zl.g=$l.g+256,Zl.value=$l.value):(Zl.g=0,Zl.value=0,po>>=se($l,8,Zl),po>>=se(za.G[1][za.H[1]+po],16,Zl),po>>=se(za.G[2][za.H[2]+po],0,Zl),se(za.G[3][za.H[3]+po],24,Zl))}}}Vr.vc=or,Vr.Wb=dr,Vr.Ya=gh,Vr.yc=su,xi=1;break e}xi=0}if(!(z=xi)){M.a=3;break t}if(0<tt){if(J.ua=1<<tt,!Ze(J.Wa,tt)){M.a=1,z=0;break t}}else J.ua=0;var wh=M,hu=U,qf=V,$u=wh.s,cp=$u.xc;if(wh.c=hu,wh.i=qf,$u.md=ri(hu,cp),$u.wc=cp==0?-1:(1<<cp)-1,C){M.xb=Wu;break t}if((lt=n(U*V))==null){M.a=1,z=0;break t}z=(z=qi(M,lt,0,U,V,V,null))&&!G.h;break t}return z?(O!=null?O[0]=lt:(t(lt==null),t(C)),M.$=0,C||tr(J)):tr(J),z}function sr(g,b){var C=g.c*g.i,M=C+b+16*b;return t(g.c<=b),g.V=n(M),g.V==null?(g.Ta=null,g.Ua=0,g.a=1,0):(g.Ta=g.V,g.Ua=g.Ba+C+b,1)}function Ar(g,b){var C=g.C,M=b-C,O=g.V,z=g.Ba+g.c*C;for(t(b<=g.l.o);0<M;){var U=16<M?16:M,V=g.l.ma,G=g.l.width,J=G*U,lt=V.ca,tt=V.tb+G*C,ut=g.Ta,dt=g.Ua;$e(g,U,O,z),rh(ut,dt,lt,tt,J),Si(V,C,C+U,lt,tt,G),M-=U,O+=U*g.c,C+=U}t(C==b),g.C=g.Ma=b}function Qr(){this.ub=this.yd=this.td=this.Rb=0}function nr(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function pn(){this.Fb=this.Bb=this.Cb=0,this.Zb=n(4),this.Lb=n(4)}function Tl(){this.Yb=function(){var g=[];return function b(C,M,O){for(var z=O[M],U=0;U<z&&(C.push(O.length>M+1?[]:0),!(O.length<M+1));U++)b(C[U],M+1,O)}(g,0,[3,11]),g}()}function Wi(){this.jb=n(3),this.Wc=l([4,8],Tl),this.Xc=l([4,17],Tl)}function ms(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new n(4),this.od=new n(4)}function Hs(){this.ld=this.La=this.dd=this.tc=0}function Rr(){this.Na=this.la=0}function kr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function In(){this.ad=n(384),this.Za=0,this.Ob=n(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function gr(){this.uc=this.M=this.Nb=0,this.wa=Array(new Hs),this.Y=0,this.ya=Array(new In),this.aa=0,this.l=new Ms}function Or(){this.y=n(16),this.f=n(8),this.ea=n(8)}function Ka(){this.cb=this.a=0,this.sc="",this.m=new Me,this.Od=new Qr,this.Kc=new nr,this.ed=new ms,this.Qa=new pn,this.Ic=this.$c=this.Aa=0,this.D=new gr,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=c(8,Me),this.ia=0,this.pb=c(4,kr),this.Pa=new Wi,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Or),this.Hd=0,this.rb=Array(new Rr),this.sb=0,this.wa=Array(new Hs),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new In),this.L=this.aa=0,this.gd=l([4,2],Hs),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ms(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Sr(){var g=new Ka;return g!=null&&(g.a=0,g.sc="OK",g.cb=0,g.Xb=0,ra||(ra=Qs)),g}function Ji(g,b,C){return g.a==0&&(g.a=b,g.sc=C,g.cb=0),0}function Ws(g,b,C){return 3<=C&&g[b+0]==157&&g[b+1]==1&&g[b+2]==42}function mr(g,b){if(g==null)return 0;if(g.a=0,g.sc="OK",b==null)return Ji(g,2,"null VP8Io passed to VP8GetHeaders()");var C=b.data,M=b.w,O=b.ha;if(4>O)return Ji(g,7,"Truncated header.");var z=C[M+0]|C[M+1]<<8|C[M+2]<<16,U=g.Od;if(U.Rb=!(1&z),U.td=z>>1&7,U.yd=z>>4&1,U.ub=z>>5,3<U.td)return Ji(g,3,"Incorrect keyframe parameters.");if(!U.yd)return Ji(g,4,"Frame not displayable.");M+=3,O-=3;var V=g.Kc;if(U.Rb){if(7>O)return Ji(g,7,"cannot parse picture header");if(!Ws(C,M,O))return Ji(g,3,"Bad code word");V.c=16383&(C[M+4]<<8|C[M+3]),V.Td=C[M+4]>>6,V.i=16383&(C[M+6]<<8|C[M+5]),V.Ud=C[M+6]>>6,M+=7,O-=7,g.za=V.c+15>>4,g.Ub=V.i+15>>4,b.width=V.c,b.height=V.i,b.Da=0,b.j=0,b.v=0,b.va=b.width,b.o=b.height,b.da=0,b.ib=b.width,b.hb=b.height,b.U=b.width,b.T=b.height,s((z=g.Pa).jb,0,255,z.jb.length),t((z=g.Qa)!=null),z.Cb=0,z.Bb=0,z.Fb=1,s(z.Zb,0,0,z.Zb.length),s(z.Lb,0,0,z.Lb)}if(U.ub>O)return Ji(g,7,"bad partition length");ne(z=g.m,C,M,U.ub),M+=U.ub,O-=U.ub,U.Rb&&(V.Ld=ee(z),V.Kd=ee(z)),V=g.Qa;var G,J=g.Pa;if(t(z!=null),t(V!=null),V.Cb=ee(z),V.Cb){if(V.Bb=ee(z),ee(z)){for(V.Fb=ee(z),G=0;4>G;++G)V.Zb[G]=ee(z)?le(z,7):0;for(G=0;4>G;++G)V.Lb[G]=ee(z)?le(z,6):0}if(V.Bb)for(G=0;3>G;++G)J.jb[G]=ee(z)?oe(z,8):255}else V.Bb=0;if(z.Ka)return Ji(g,3,"cannot parse segment header");if((V=g.ed).zd=ee(z),V.Tb=oe(z,6),V.wb=oe(z,3),V.Pc=ee(z),V.Pc&&ee(z)){for(J=0;4>J;++J)ee(z)&&(V.vd[J]=le(z,6));for(J=0;4>J;++J)ee(z)&&(V.od[J]=le(z,6))}if(g.L=V.Tb==0?0:V.zd?1:2,z.Ka)return Ji(g,3,"cannot parse filter header");var lt=O;if(O=G=M,M=G+lt,V=lt,g.Xb=(1<<oe(g.m,2))-1,lt<3*(J=g.Xb))C=7;else{for(G+=3*J,V-=3*J,lt=0;lt<J;++lt){var tt=C[O+0]|C[O+1]<<8|C[O+2]<<16;tt>V&&(tt=V),ne(g.Jc[+lt],C,G,tt),G+=tt,V-=tt,O+=3}ne(g.Jc[+J],C,G,V),C=G<M?0:5}if(C!=0)return Ji(g,C,"cannot parse partitions");for(C=oe(G=g.m,7),O=ee(G)?le(G,4):0,M=ee(G)?le(G,4):0,V=ee(G)?le(G,4):0,J=ee(G)?le(G,4):0,G=ee(G)?le(G,4):0,lt=g.Qa,tt=0;4>tt;++tt){if(lt.Cb){var ut=lt.Zb[tt];lt.Fb||(ut+=C)}else{if(0<tt){g.pb[tt]=g.pb[0];continue}ut=C}var dt=g.pb[tt];dt.Sc[0]=Vl[gn(ut+O,127)],dt.Sc[1]=Dn[gn(ut+0,127)],dt.Eb[0]=2*Vl[gn(ut+M,127)],dt.Eb[1]=101581*Dn[gn(ut+V,127)]>>16,8>dt.Eb[1]&&(dt.Eb[1]=8),dt.Qc[0]=Vl[gn(ut+J,117)],dt.Qc[1]=Dn[gn(ut+G,127)],dt.lc=ut+G}if(!U.Rb)return Ji(g,4,"Not a key frame.");for(ee(z),U=g.Pa,C=0;4>C;++C){for(O=0;8>O;++O)for(M=0;3>M;++M)for(V=0;11>V;++V)J=Kt(z,Fa[C][O][M][V])?oe(z,8):Hu[C][O][M][V],U.Wc[C][O].Yb[M][V]=J;for(O=0;17>O;++O)U.Xc[C][O]=U.Wc[C][Je[O]]}return g.kc=ee(z),g.kc&&(g.Bd=oe(z,8)),g.cb=1}function Qs(g,b,C,M,O,z,U){var V=b[O].Yb[C];for(C=0;16>O;++O){if(!Kt(g,V[C+0]))return O;for(;!Kt(g,V[C+1]);)if(V=b[++O].Yb[0],C=0,O==16)return 16;var G=b[O+1].Yb;if(Kt(g,V[C+2])){var J=g,lt=0;if(Kt(J,(ut=V)[(tt=C)+3]))if(Kt(J,ut[tt+6])){for(V=0,tt=2*(lt=Kt(J,ut[tt+8]))+(ut=Kt(J,ut[tt+9+lt])),lt=0,ut=Vu[tt];ut[V];++V)lt+=lt+Kt(J,ut[V]);lt+=3+(8<<tt)}else Kt(J,ut[tt+7])?(lt=7+2*Kt(J,165),lt+=Kt(J,145)):lt=5+Kt(J,159);else lt=Kt(J,ut[tt+4])?3+Kt(J,ut[tt+5]):2;V=G[2]}else lt=1,V=G[1];G=U+qu[O],0>(J=g).b&&$t(J);var tt,ut=J.b,dt=(tt=J.Ca>>1)-(J.I>>ut)>>31;--J.b,J.Ca+=dt,J.Ca|=1,J.I-=(tt+1&dt)<<ut,z[G]=((lt^dt)-dt)*M[(0<O)+0]}return 16}function us(g){var b=g.rb[g.sb-1];b.la=0,b.Na=0,s(g.zc,0,0,g.zc.length),g.ja=0}function wo(g,b){if(g==null)return 0;if(b==null)return Ji(g,2,"NULL VP8Io parameter in VP8Decode().");if(!g.cb&&!mr(g,b))return 0;if(t(g.cb),b.ac==null||b.ac(b)){b.ob&&(g.L=0);var C=v[g.L];if(g.L==2?(g.yb=0,g.zb=0):(g.yb=b.v-C>>4,g.zb=b.j-C>>4,0>g.yb&&(g.yb=0),0>g.zb&&(g.zb=0)),g.Va=b.o+15+C>>4,g.Hb=b.va+15+C>>4,g.Hb>g.za&&(g.Hb=g.za),g.Va>g.Ub&&(g.Va=g.Ub),0<g.L){var M=g.ed;for(C=0;4>C;++C){var O;if(g.Qa.Cb){var z=g.Qa.Lb[C];g.Qa.Fb||(z+=M.Tb)}else z=M.Tb;for(O=0;1>=O;++O){var U=g.gd[C][O],V=z;if(M.Pc&&(V+=M.vd[0],O&&(V+=M.od[0])),0<(V=0>V?0:63<V?63:V)){var G=V;0<M.wb&&(G=4<M.wb?G>>2:G>>1)>9-M.wb&&(G=9-M.wb),1>G&&(G=1),U.dd=G,U.tc=2*V+G,U.ld=40<=V?2:15<=V?1:0}else U.tc=0;U.La=O}}}C=0}else Ji(g,6,"Frame setup failed"),C=g.a;if(C=C==0){if(C){g.$c=0,0<g.Aa||(g.Ic=B);t:{C=g.Ic,M=4*(G=g.za);var J=32*G,lt=G+1,tt=0<g.L?G*(0<g.Aa?2:1):0,ut=(g.Aa==2?2:1)*G;if((U=M+832+(O=3*(16*C+v[g.L])/2*J)+(z=g.Fa!=null&&0<g.Fa.length?g.Kc.c*g.Kc.i:0))!=U)C=0;else{if(U>g.Vb){if(g.Vb=0,g.Ec=n(U),g.Fc=0,g.Ec==null){C=Ji(g,1,"no memory during frame initialization.");break t}g.Vb=U}U=g.Ec,V=g.Fc,g.Ac=U,g.Bc=V,V+=M,g.Gd=c(J,Or),g.Hd=0,g.rb=c(lt+1,Rr),g.sb=1,g.wa=tt?c(tt,Hs):null,g.Y=0,g.D.Nb=0,g.D.wa=g.wa,g.D.Y=g.Y,0<g.Aa&&(g.D.Y+=G),t(!0),g.oc=U,g.pc=V,V+=832,g.ya=c(ut,In),g.aa=0,g.D.ya=g.ya,g.D.aa=g.aa,g.Aa==2&&(g.D.aa+=G),g.R=16*G,g.B=8*G,G=(J=v[g.L])*g.R,J=J/2*g.B,g.sa=U,g.ta=V+G,g.qa=g.sa,g.ra=g.ta+16*C*g.R+J,g.Ha=g.qa,g.Ia=g.ra+8*C*g.B+J,g.$c=0,V+=O,g.mb=z?U:null,g.nb=z?V:null,t(V+z<=g.Fc+g.Vb),us(g),s(g.Ac,g.Bc,0,M),C=1}}if(C){if(b.ka=0,b.y=g.sa,b.O=g.ta,b.f=g.qa,b.N=g.ra,b.ea=g.Ha,b.Vd=g.Ia,b.fa=g.R,b.Rc=g.B,b.F=null,b.J=0,!en){for(C=-255;255>=C;++C)sh[255+C]=0>C?-C:C;for(C=-1020;1020>=C;++C)nh[1020+C]=-128>C?-128:127<C?127:C;for(C=-112;112>=C;++C)zr[112+C]=-16>C?-16:15<C?15:C;for(C=-255;510>=C;++C)ta[255+C]=0>C?0:255<C?255:C;en=1}On=yt,To=Qn,Po=Aa,tn=Sa,Fn=st,xc=Kn,Ko=Ol,so=Qa,no=th,Jr=Fl,Nn=Qc,Xs=Ta,Qo=Nl,vr=yc,hr=Ca,Xr=Xo,Gr=to,oo=Kh,cs[0]=Ln,cs[1]=ce,cs[2]=gc,cs[3]=Il,cs[4]=Ll,cs[5]=Ml,cs[6]=Ho,cs[7]=Bl,cs[8]=$h,cs[9]=Kc,sa[0]=ds,sa[1]=hi,sa[2]=Ti,sa[3]=cr,sa[4]=Qi,sa[5]=Pl,sa[6]=ys,vn[0]=Ao,vn[1]=Ee,vn[2]=Yh,vn[3]=mc,vn[4]=Wo,vn[5]=Rl,vn[6]=Jo,C=1}else C=0}C&&(C=function(dt,Tt){for(dt.M=0;dt.M<dt.Va;++dt.M){var wt,gt=dt.Jc[dt.M&dt.Xb],mt=dt.m,Dt=dt;for(wt=0;wt<Dt.za;++wt){var Xt=mt,ie=Dt,re=ie.Ac,ue=ie.Bc+4*wt,Pe=ie.zc,xe=ie.ya[ie.aa+wt];if(ie.Qa.Bb?xe.$b=Kt(Xt,ie.Pa.jb[0])?2+Kt(Xt,ie.Pa.jb[2]):Kt(Xt,ie.Pa.jb[1]):xe.$b=0,ie.kc&&(xe.Ad=Kt(Xt,ie.Bd)),xe.Za=!Kt(Xt,145)+0,xe.Za){var Oe=xe.Ob,Xe=0;for(ie=0;4>ie;++ie){var We,_i=Pe[0+ie];for(We=0;4>We;++We){_i=Cc[re[ue+We]][_i];for(var xi=eu[Kt(Xt,_i[0])];0<xi;)xi=eu[2*xi+Kt(Xt,_i[xi])];_i=-xi,re[ue+We]=_i}r(Oe,Xe,re,ue,4),Xe+=4,Pe[0+ie]=_i}}else _i=Kt(Xt,156)?Kt(Xt,128)?1:3:Kt(Xt,163)?2:0,xe.Ob[0]=_i,s(re,ue,_i,4),s(Pe,0,_i,4);xe.Dd=Kt(Xt,142)?Kt(Xt,114)?Kt(Xt,183)?1:3:2:0}if(Dt.m.Ka)return Ji(dt,7,"Premature end-of-partition0 encountered.");for(;dt.ja<dt.za;++dt.ja){if(Dt=gt,Xt=(mt=dt).rb[mt.sb-1],re=mt.rb[mt.sb+mt.ja],wt=mt.ya[mt.aa+mt.ja],ue=mt.kc?wt.Ad:0)Xt.la=re.la=0,wt.Za||(Xt.Na=re.Na=0),wt.Hc=0,wt.Gc=0,wt.ia=0;else{var Ui,gi;if(Xt=re,re=Dt,ue=mt.Pa.Xc,Pe=mt.ya[mt.aa+mt.ja],xe=mt.pb[Pe.$b],ie=Pe.ad,Oe=0,Xe=mt.rb[mt.sb-1],_i=We=0,s(ie,Oe,0,384),Pe.Za)var Ni=0,Er=ue[3];else{xi=n(16);var ur=Xt.Na+Xe.Na;if(ur=ra(re,ue[1],ur,xe.Eb,0,xi,0),Xt.Na=Xe.Na=(0<ur)+0,1<ur)On(xi,0,ie,Oe);else{var Zr=xi[0]+3>>3;for(xi=0;256>xi;xi+=16)ie[Oe+xi]=Zr}Ni=1,Er=ue[0]}var Zi=15&Xt.la,bs=15&Xe.la;for(xi=0;4>xi;++xi){var ps=1&bs;for(Zr=gi=0;4>Zr;++Zr)Zi=Zi>>1|(ps=(ur=ra(re,Er,ur=ps+(1&Zi),xe.Sc,Ni,ie,Oe))>Ni)<<7,gi=gi<<2|(3<ur?3:1<ur?2:ie[Oe+0]!=0),Oe+=16;Zi>>=4,bs=bs>>1|ps<<7,We=(We<<8|gi)>>>0}for(Er=Zi,Ni=bs>>4,Ui=0;4>Ui;Ui+=2){for(gi=0,Zi=Xt.la>>4+Ui,bs=Xe.la>>4+Ui,xi=0;2>xi;++xi){for(ps=1&bs,Zr=0;2>Zr;++Zr)ur=ps+(1&Zi),Zi=Zi>>1|(ps=0<(ur=ra(re,ue[2],ur,xe.Qc,0,ie,Oe)))<<3,gi=gi<<2|(3<ur?3:1<ur?2:ie[Oe+0]!=0),Oe+=16;Zi>>=2,bs=bs>>1|ps<<5}_i|=gi<<4*Ui,Er|=Zi<<4<<Ui,Ni|=(240&bs)<<Ui}Xt.la=Er,Xe.la=Ni,Pe.Hc=We,Pe.Gc=_i,Pe.ia=43690&_i?0:xe.ia,ue=!(We|_i)}if(0<mt.L&&(mt.wa[mt.Y+mt.ja]=mt.gd[wt.$b][wt.Za],mt.wa[mt.Y+mt.ja].La|=!ue),Dt.Ka)return Ji(dt,7,"Premature end-of-file encountered.")}if(us(dt),mt=Tt,Dt=1,wt=(gt=dt).D,Xt=0<gt.L&&gt.M>=gt.zb&&gt.M<=gt.Va,gt.Aa==0)t:{if(wt.M=gt.M,wt.uc=Xt,$o(gt,wt),Dt=1,wt=(gi=gt.D).Nb,Xt=(_i=v[gt.L])*gt.R,re=_i/2*gt.B,xi=16*wt*gt.R,Zr=8*wt*gt.B,ue=gt.sa,Pe=gt.ta-Xt+xi,xe=gt.qa,ie=gt.ra-re+Zr,Oe=gt.Ha,Xe=gt.Ia-re+Zr,bs=(Zi=gi.M)==0,We=Zi>=gt.Va-1,gt.Aa==2&&$o(gt,gi),gi.uc)for(ps=(ur=gt).D.M,t(ur.D.uc),gi=ur.yb;gi<ur.Hb;++gi){Ni=gi,Er=ps;var Vr=(or=($r=ur).D).Nb;Ui=$r.R;var or=or.wa[or.Y+Ni],dr=$r.sa,Br=$r.ta+16*Vr*Ui+16*Ni,sn=or.dd,$i=or.tc;if($i!=0)if(t(3<=$i),$r.L==1)0<Ni&&Xr(dr,Br,Ui,$i+4),or.La&&oo(dr,Br,Ui,$i),0<Er&&hr(dr,Br,Ui,$i+4),or.La&&Gr(dr,Br,Ui,$i);else{var ar=$r.B,ws=$r.qa,qr=$r.ra+8*Vr*ar+8*Ni,Na=$r.Ha,$r=$r.Ia+8*Vr*ar+8*Ni;Vr=or.ld,0<Ni&&(so(dr,Br,Ui,$i+4,sn,Vr),Jr(ws,qr,Na,$r,ar,$i+4,sn,Vr)),or.La&&(Xs(dr,Br,Ui,$i,sn,Vr),vr(ws,qr,Na,$r,ar,$i,sn,Vr)),0<Er&&(Ko(dr,Br,Ui,$i+4,sn,Vr),no(ws,qr,Na,$r,ar,$i+4,sn,Vr)),or.La&&(Nn(dr,Br,Ui,$i,sn,Vr),Qo(ws,qr,Na,$r,ar,$i,sn,Vr))}}if(gt.ia&&alert("todo:DitherRow"),mt.put!=null){if(gi=16*Zi,Zi=16*(Zi+1),bs?(mt.y=gt.sa,mt.O=gt.ta+xi,mt.f=gt.qa,mt.N=gt.ra+Zr,mt.ea=gt.Ha,mt.W=gt.Ia+Zr):(gi-=_i,mt.y=ue,mt.O=Pe,mt.f=xe,mt.N=ie,mt.ea=Oe,mt.W=Xe),We||(Zi-=_i),Zi>mt.o&&(Zi=mt.o),mt.F=null,mt.J=null,gt.Fa!=null&&0<gt.Fa.length&&gi<Zi&&(mt.J=vc(gt,mt,gi,Zi-gi),mt.F=gt.mb,mt.F==null&&mt.F.length==0)){Dt=Ji(gt,3,"Could not decode alpha data.");break t}gi<mt.j&&(_i=mt.j-gi,gi=mt.j,t(!(1&_i)),mt.O+=gt.R*_i,mt.N+=gt.B*(_i>>1),mt.W+=gt.B*(_i>>1),mt.F!=null&&(mt.J+=mt.width*_i)),gi<Zi&&(mt.O+=mt.v,mt.N+=mt.v>>1,mt.W+=mt.v>>1,mt.F!=null&&(mt.J+=mt.v),mt.ka=gi-mt.j,mt.U=mt.va-mt.v,mt.T=Zi-gi,Dt=mt.put(mt))}wt+1!=gt.Ic||We||(r(gt.sa,gt.ta-Xt,ue,Pe+16*gt.R,Xt),r(gt.qa,gt.ra-re,xe,ie+8*gt.B,re),r(gt.Ha,gt.Ia-re,Oe,Xe+8*gt.B,re))}if(!Dt)return Ji(dt,6,"Output aborted.")}return 1}(g,b)),b.bc!=null&&b.bc(b),C&=1}return C?(g.cb=0,C):0}function Fr(g,b,C,M,O){O=g[b+C+32*M]+(O>>3),g[b+C+32*M]=-256&O?0>O?0:255:O}function Bs(g,b,C,M,O,z){Fr(g,b,0,C,M+O),Fr(g,b,1,C,M+z),Fr(g,b,2,C,M-z),Fr(g,b,3,C,M-O)}function rs(g){return(20091*g>>16)+g}function Hi(g,b,C,M){var O,z=0,U=n(16);for(O=0;4>O;++O){var V=g[b+0]+g[b+8],G=g[b+0]-g[b+8],J=(35468*g[b+4]>>16)-rs(g[b+12]),lt=rs(g[b+4])+(35468*g[b+12]>>16);U[z+0]=V+lt,U[z+1]=G+J,U[z+2]=G-J,U[z+3]=V-lt,z+=4,b++}for(O=z=0;4>O;++O)V=(g=U[z+0]+4)+U[z+8],G=g-U[z+8],J=(35468*U[z+4]>>16)-rs(U[z+12]),Fr(C,M,0,0,V+(lt=rs(U[z+4])+(35468*U[z+12]>>16))),Fr(C,M,1,0,G+J),Fr(C,M,2,0,G-J),Fr(C,M,3,0,V-lt),z++,M+=32}function Kn(g,b,C,M){var O=g[b+0]+4,z=35468*g[b+4]>>16,U=rs(g[b+4]),V=35468*g[b+1]>>16;Bs(C,M,0,O+U,g=rs(g[b+1]),V),Bs(C,M,1,O+z,g,V),Bs(C,M,2,O-z,g,V),Bs(C,M,3,O-U,g,V)}function Qn(g,b,C,M,O){Hi(g,b,C,M),O&&Hi(g,b+16,C,M+4)}function Aa(g,b,C,M){To(g,b+0,C,M,1),To(g,b+32,C,M+128,1)}function Sa(g,b,C,M){var O;for(g=g[b+0]+4,O=0;4>O;++O)for(b=0;4>b;++b)Fr(C,M,b,O,g)}function st(g,b,C,M){g[b+0]&&tn(g,b+0,C,M),g[b+16]&&tn(g,b+16,C,M+4),g[b+32]&&tn(g,b+32,C,M+128),g[b+48]&&tn(g,b+48,C,M+128+4)}function yt(g,b,C,M){var O,z=n(16);for(O=0;4>O;++O){var U=g[b+0+O]+g[b+12+O],V=g[b+4+O]+g[b+8+O],G=g[b+4+O]-g[b+8+O],J=g[b+0+O]-g[b+12+O];z[0+O]=U+V,z[8+O]=U-V,z[4+O]=J+G,z[12+O]=J-G}for(O=0;4>O;++O)U=(g=z[0+4*O]+3)+z[3+4*O],V=z[1+4*O]+z[2+4*O],G=z[1+4*O]-z[2+4*O],J=g-z[3+4*O],C[M+0]=U+V>>3,C[M+16]=J+G>>3,C[M+32]=U-V>>3,C[M+48]=J-G>>3,M+=64}function Ot(g,b,C){var M,O=b-32,z=Os,U=255-g[O-1];for(M=0;M<C;++M){var V,G=z,J=U+g[b-1];for(V=0;V<C;++V)g[b+V]=G[J+g[O+V]];b+=32}}function ce(g,b){Ot(g,b,4)}function Ee(g,b){Ot(g,b,8)}function hi(g,b){Ot(g,b,16)}function Ti(g,b){var C;for(C=0;16>C;++C)r(g,b+32*C,g,b-32,16)}function cr(g,b){var C;for(C=16;0<C;--C)s(g,b,g[b-1],16),b+=32}function ls(g,b,C){var M;for(M=0;16>M;++M)s(b,C+32*M,g,16)}function ds(g,b){var C,M=16;for(C=0;16>C;++C)M+=g[b-1+32*C]+g[b+C-32];ls(M>>5,g,b)}function Qi(g,b){var C,M=8;for(C=0;16>C;++C)M+=g[b-1+32*C];ls(M>>4,g,b)}function Pl(g,b){var C,M=8;for(C=0;16>C;++C)M+=g[b+C-32];ls(M>>4,g,b)}function ys(g,b){ls(128,g,b)}function yi(g,b,C){return g+2*b+C+2>>2}function gc(g,b){var C,M=b-32;for(M=new Uint8Array([yi(g[M-1],g[M+0],g[M+1]),yi(g[M+0],g[M+1],g[M+2]),yi(g[M+1],g[M+2],g[M+3]),yi(g[M+2],g[M+3],g[M+4])]),C=0;4>C;++C)r(g,b+32*C,M,0,M.length)}function Il(g,b){var C=g[b-1],M=g[b-1+32],O=g[b-1+64],z=g[b-1+96];Ce(g,b+0,16843009*yi(g[b-1-32],C,M)),Ce(g,b+32,16843009*yi(C,M,O)),Ce(g,b+64,16843009*yi(M,O,z)),Ce(g,b+96,16843009*yi(O,z,z))}function Ln(g,b){var C,M=4;for(C=0;4>C;++C)M+=g[b+C-32]+g[b-1+32*C];for(M>>=3,C=0;4>C;++C)s(g,b+32*C,M,4)}function Ll(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],z=g[b-1-32],U=g[b+0-32],V=g[b+1-32],G=g[b+2-32],J=g[b+3-32];g[b+0+96]=yi(M,O,g[b-1+96]),g[b+1+96]=g[b+0+64]=yi(C,M,O),g[b+2+96]=g[b+1+64]=g[b+0+32]=yi(z,C,M),g[b+3+96]=g[b+2+64]=g[b+1+32]=g[b+0+0]=yi(U,z,C),g[b+3+64]=g[b+2+32]=g[b+1+0]=yi(V,U,z),g[b+3+32]=g[b+2+0]=yi(G,V,U),g[b+3+0]=yi(J,G,V)}function Ho(g,b){var C=g[b+1-32],M=g[b+2-32],O=g[b+3-32],z=g[b+4-32],U=g[b+5-32],V=g[b+6-32],G=g[b+7-32];g[b+0+0]=yi(g[b+0-32],C,M),g[b+1+0]=g[b+0+32]=yi(C,M,O),g[b+2+0]=g[b+1+32]=g[b+0+64]=yi(M,O,z),g[b+3+0]=g[b+2+32]=g[b+1+64]=g[b+0+96]=yi(O,z,U),g[b+3+32]=g[b+2+64]=g[b+1+96]=yi(z,U,V),g[b+3+64]=g[b+2+96]=yi(U,V,G),g[b+3+96]=yi(V,G,G)}function Ml(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],z=g[b-1-32],U=g[b+0-32],V=g[b+1-32],G=g[b+2-32],J=g[b+3-32];g[b+0+0]=g[b+1+64]=z+U+1>>1,g[b+1+0]=g[b+2+64]=U+V+1>>1,g[b+2+0]=g[b+3+64]=V+G+1>>1,g[b+3+0]=G+J+1>>1,g[b+0+96]=yi(O,M,C),g[b+0+64]=yi(M,C,z),g[b+0+32]=g[b+1+96]=yi(C,z,U),g[b+1+32]=g[b+2+96]=yi(z,U,V),g[b+2+32]=g[b+3+96]=yi(U,V,G),g[b+3+32]=yi(V,G,J)}function Bl(g,b){var C=g[b+0-32],M=g[b+1-32],O=g[b+2-32],z=g[b+3-32],U=g[b+4-32],V=g[b+5-32],G=g[b+6-32],J=g[b+7-32];g[b+0+0]=C+M+1>>1,g[b+1+0]=g[b+0+64]=M+O+1>>1,g[b+2+0]=g[b+1+64]=O+z+1>>1,g[b+3+0]=g[b+2+64]=z+U+1>>1,g[b+0+32]=yi(C,M,O),g[b+1+32]=g[b+0+96]=yi(M,O,z),g[b+2+32]=g[b+1+96]=yi(O,z,U),g[b+3+32]=g[b+2+96]=yi(z,U,V),g[b+3+64]=yi(U,V,G),g[b+3+96]=yi(V,G,J)}function Kc(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],z=g[b-1+96];g[b+0+0]=C+M+1>>1,g[b+2+0]=g[b+0+32]=M+O+1>>1,g[b+2+32]=g[b+0+64]=O+z+1>>1,g[b+1+0]=yi(C,M,O),g[b+3+0]=g[b+1+32]=yi(M,O,z),g[b+3+32]=g[b+1+64]=yi(O,z,z),g[b+3+64]=g[b+2+64]=g[b+0+96]=g[b+1+96]=g[b+2+96]=g[b+3+96]=z}function $h(g,b){var C=g[b-1+0],M=g[b-1+32],O=g[b-1+64],z=g[b-1+96],U=g[b-1-32],V=g[b+0-32],G=g[b+1-32],J=g[b+2-32];g[b+0+0]=g[b+2+32]=C+U+1>>1,g[b+0+32]=g[b+2+64]=M+C+1>>1,g[b+0+64]=g[b+2+96]=O+M+1>>1,g[b+0+96]=z+O+1>>1,g[b+3+0]=yi(V,G,J),g[b+2+0]=yi(U,V,G),g[b+1+0]=g[b+3+32]=yi(C,U,V),g[b+1+32]=g[b+3+64]=yi(M,C,U),g[b+1+64]=g[b+3+96]=yi(O,M,C),g[b+1+96]=yi(z,O,M)}function Yh(g,b){var C;for(C=0;8>C;++C)r(g,b+32*C,g,b-32,8)}function mc(g,b){var C;for(C=0;8>C;++C)s(g,b,g[b-1],8),b+=32}function xo(g,b,C){var M;for(M=0;8>M;++M)s(b,C+32*M,g,8)}function Ao(g,b){var C,M=8;for(C=0;8>C;++C)M+=g[b+C-32]+g[b-1+32*C];xo(M>>4,g,b)}function Rl(g,b){var C,M=4;for(C=0;8>C;++C)M+=g[b+C-32];xo(M>>3,g,b)}function Wo(g,b){var C,M=4;for(C=0;8>C;++C)M+=g[b-1+32*C];xo(M>>3,g,b)}function Jo(g,b){xo(128,g,b)}function _s(g,b,C){var M=g[b-C],O=g[b+0],z=3*(O-M)+Ac[1020+g[b-2*C]-g[b+C]],U=Oa[112+(z+4>>3)];g[b-C]=Os[255+M+Oa[112+(z+3>>3)]],g[b+0]=Os[255+O-U]}function Yi(g,b,C,M){var O=g[b+0],z=g[b+C];return vs[255+g[b-2*C]-g[b-C]]>M||vs[255+z-O]>M}function kl(g,b,C,M){return 4*vs[255+g[b-C]-g[b+0]]+vs[255+g[b-2*C]-g[b+C]]<=M}function Ea(g,b,C,M,O){var z=g[b-3*C],U=g[b-2*C],V=g[b-C],G=g[b+0],J=g[b+C],lt=g[b+2*C],tt=g[b+3*C];return 4*vs[255+V-G]+vs[255+U-J]>M?0:vs[255+g[b-4*C]-z]<=O&&vs[255+z-U]<=O&&vs[255+U-V]<=O&&vs[255+tt-lt]<=O&&vs[255+lt-J]<=O&&vs[255+J-G]<=O}function Ca(g,b,C,M){var O=2*M+1;for(M=0;16>M;++M)kl(g,b+M,C,O)&&_s(g,b+M,C)}function Xo(g,b,C,M){var O=2*M+1;for(M=0;16>M;++M)kl(g,b+M*C,1,O)&&_s(g,b+M*C,1)}function to(g,b,C,M){var O;for(O=3;0<O;--O)Ca(g,b+=4*C,C,M)}function Kh(g,b,C,M){var O;for(O=3;0<O;--O)Xo(g,b+=4,C,M)}function fn(g,b,C,M,O,z,U,V){for(z=2*z+1;0<O--;){if(Ea(g,b,C,z,U))if(Yi(g,b,C,V))_s(g,b,C);else{var G=g,J=b,lt=C,tt=G[J-2*lt],ut=G[J-lt],dt=G[J+0],Tt=G[J+lt],wt=G[J+2*lt],gt=27*(Dt=Ac[1020+3*(dt-ut)+Ac[1020+tt-Tt]])+63>>7,mt=18*Dt+63>>7,Dt=9*Dt+63>>7;G[J-3*lt]=Os[255+G[J-3*lt]+Dt],G[J-2*lt]=Os[255+tt+mt],G[J-lt]=Os[255+ut+gt],G[J+0]=Os[255+dt-gt],G[J+lt]=Os[255+Tt-mt],G[J+2*lt]=Os[255+wt-Dt]}b+=M}}function eo(g,b,C,M,O,z,U,V){for(z=2*z+1;0<O--;){if(Ea(g,b,C,z,U))if(Yi(g,b,C,V))_s(g,b,C);else{var G=g,J=b,lt=C,tt=G[J-lt],ut=G[J+0],dt=G[J+lt],Tt=Oa[112+((wt=3*(ut-tt))+4>>3)],wt=Oa[112+(wt+3>>3)],gt=Tt+1>>1;G[J-2*lt]=Os[255+G[J-2*lt]+gt],G[J-lt]=Os[255+tt+wt],G[J+0]=Os[255+ut-Tt],G[J+lt]=Os[255+dt-gt]}b+=M}}function Ol(g,b,C,M,O,z){fn(g,b,C,1,16,M,O,z)}function Qa(g,b,C,M,O,z){fn(g,b,1,C,16,M,O,z)}function Qc(g,b,C,M,O,z){var U;for(U=3;0<U;--U)eo(g,b+=4*C,C,1,16,M,O,z)}function Ta(g,b,C,M,O,z){var U;for(U=3;0<U;--U)eo(g,b+=4,1,C,16,M,O,z)}function th(g,b,C,M,O,z,U,V){fn(g,b,O,1,8,z,U,V),fn(C,M,O,1,8,z,U,V)}function Fl(g,b,C,M,O,z,U,V){fn(g,b,1,O,8,z,U,V),fn(C,M,1,O,8,z,U,V)}function Nl(g,b,C,M,O,z,U,V){eo(g,b+4*O,O,1,8,z,U,V),eo(C,M+4*O,O,1,8,z,U,V)}function yc(g,b,C,M,O,z,U,V){eo(g,b+4,1,O,8,z,U,V),eo(C,M+4,1,O,8,z,U,V)}function Mn(){this.ba=new rr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new K,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Dl(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function _c(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function eh(){this.ua=0,this.Wa=new ot,this.vb=new ot,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new bt,this.yc=new pt}function ih(){this.xb=this.a=0,this.l=new Ms,this.ca=new rr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new nt,this.Pb=0,this.wd=new nt,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new eh,this.ab=0,this.gc=c(4,_c),this.Oc=0}function So(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ms,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function tl(g,b,C,M,O,z,U){for(g=g==null?0:g[b+0],b=0;b<U;++b)O[z+b]=g+C[M+b]&255,g=O[z+b]}function Pa(g,b,C,M,O,z,U){var V;if(g==null)tl(null,null,C,M,O,z,U);else for(V=0;V<U;++V)O[z+V]=g[b+V]+C[M+V]&255}function Ia(g,b,C,M,O,z,U){if(g==null)tl(null,null,C,M,O,z,U);else{var V,G=g[b+0],J=G,lt=G;for(V=0;V<U;++V)J=lt+(G=g[b+V])-J,lt=C[M+V]+(-256&J?0>J?0:255:J)&255,J=G,O[z+V]=lt}}function vc(g,b,C,M){var O=b.width,z=b.o;if(t(g!=null&&b!=null),0>C||0>=M||C+M>z)return null;if(!g.Cc){if(g.ga==null){var U;if(g.ga=new So,(U=g.ga==null)||(U=b.width*b.o,t(g.Gb.length==0),g.Gb=n(U),g.Uc=0,g.Gb==null?U=0:(g.mb=g.Gb,g.nb=g.Uc,g.rc=null,U=1),U=!U),!U){U=g.ga;var V=g.Fa,G=g.P,J=g.qc,lt=g.mb,tt=g.nb,ut=G+1,dt=J-1,Tt=U.l;if(t(V!=null&&lt!=null&&b!=null),Lo[0]=null,Lo[1]=tl,Lo[2]=Pa,Lo[3]=Ia,U.ca=lt,U.tb=tt,U.c=b.width,U.i=b.height,t(0<U.c&&0<U.i),1>=J)b=0;else if(U.$a=V[G+0]>>0&3,U.Z=V[G+0]>>2&3,U.Lc=V[G+0]>>4&3,G=V[G+0]>>6&3,0>U.$a||1<U.$a||4<=U.Z||1<U.Lc||G)b=0;else if(Tt.put=Ut,Tt.ac=kt,Tt.bc=Vt,Tt.ma=U,Tt.width=b.width,Tt.height=b.height,Tt.Da=b.Da,Tt.v=b.v,Tt.va=b.va,Tt.j=b.j,Tt.o=b.o,U.$a)t:{t(U.$a==1),b=pi();e:for(;;){if(b==null){b=0;break t}if(t(U!=null),U.mc=b,b.c=U.c,b.i=U.i,b.l=U.l,b.l.ma=U,b.l.width=U.c,b.l.height=U.i,b.a=0,Qt(b.m,V,ut,dt),!Fi(U.c,U.i,1,b,null)||(b.ab==1&&b.gc[0].hc==3&&si(b.s)?(U.ic=1,V=b.c*b.i,b.Ta=null,b.Ua=0,b.V=n(V),b.Ba=0,b.V==null?(b.a=1,b=0):b=1):(U.ic=0,b=sr(b,U.c)),!b))break e;b=1;break t}U.mc=null,b=0}else b=dt>=U.c*U.i;U=!b}if(U)return null;g.ga.Lc!=1?g.Ga=0:M=z-C}t(g.ga!=null),t(C+M<=z);t:{if(b=(V=g.ga).c,z=V.l.o,V.$a==0){if(ut=g.rc,dt=g.Vc,Tt=g.Fa,G=g.P+1+C*b,J=g.mb,lt=g.nb+C*b,t(G<=g.P+g.qc),V.Z!=0)for(t(Lo[V.Z]!=null),U=0;U<M;++U)Lo[V.Z](ut,dt,Tt,G,J,lt,b),ut=J,dt=lt,lt+=b,G+=b;else for(U=0;U<M;++U)r(J,lt,Tt,G,b),ut=J,dt=lt,lt+=b,G+=b;g.rc=ut,g.Vc=dt}else{if(t(V.mc!=null),b=C+M,t((U=V.mc)!=null),t(b<=U.i),U.C>=b)b=1;else if(V.ic||Yt(),V.ic){V=U.V,ut=U.Ba,dt=U.c;var wt=U.i,gt=(Tt=1,G=U.$/dt,J=U.$%dt,lt=U.m,tt=U.s,U.$),mt=dt*wt,Dt=dt*b,Xt=tt.wc,ie=gt<Dt?qe(tt,J,G):null;t(gt<=mt),t(b<=wt),t(si(tt));e:for(;;){for(;!lt.h&&gt<Dt;){if(J&Xt||(ie=qe(tt,J,G)),t(ie!=null),Wt(lt),256>(wt=ae(ie.G[0],ie.H[0],lt)))V[ut+gt]=wt,++gt,++J>=dt&&(J=0,++G<=b&&!(G%16)&&ki(U,G));else{if(!(280>wt)){Tt=0;break e}wt=Jt(wt-256,lt);var re,ue=ae(ie.G[4],ie.H[4],lt);if(Wt(lt),!(gt>=(ue=ge(dt,ue=Jt(ue,lt)))&&mt-gt>=wt)){Tt=0;break e}for(re=0;re<wt;++re)V[ut+gt+re]=V[ut+gt+re-ue];for(gt+=wt,J+=wt;J>=dt;)J-=dt,++G<=b&&!(G%16)&&ki(U,G);gt<Dt&&J&Xt&&(ie=qe(tt,J,G))}t(lt.h==Lt(lt))}ki(U,G>b?b:G);break e}!Tt||lt.h&&gt<mt?(Tt=0,U.a=lt.h?5:3):U.$=gt,b=Tt}else b=qi(U,U.V,U.Ba,U.c,U.i,b,Ar);if(!b){M=0;break t}}C+M>=z&&(g.Cc=1),M=1}if(!M)return null;if(g.Cc&&((M=g.ga)!=null&&(M.mc=null),g.ga=null,0<g.Ga))return alert("todo:WebPDequantizeLevels"),null}return g.nb+C*O}function F(g,b,C,M,O,z){for(;0<O--;){var U,V=g,G=b+(C?1:0),J=g,lt=b+(C?0:3);for(U=0;U<M;++U){var tt=J[lt+4*U];tt!=255&&(tt*=32897,V[G+4*U+0]=V[G+4*U+0]*tt>>23,V[G+4*U+1]=V[G+4*U+1]*tt>>23,V[G+4*U+2]=V[G+4*U+2]*tt>>23)}b+=z}}function et(g,b,C,M,O){for(;0<M--;){var z;for(z=0;z<C;++z){var U=g[b+2*z+0],V=15&(J=g[b+2*z+1]),G=4369*V,J=(240&J|J>>4)*G>>16;g[b+2*z+0]=(240&U|U>>4)*G>>16&240|(15&U|U<<4)*G>>16>>4&15,g[b+2*z+1]=240&J|V}b+=O}}function Pt(g,b,C,M,O,z,U,V){var G,J,lt=255;for(J=0;J<O;++J){for(G=0;G<M;++G){var tt=g[b+G];z[U+4*G]=tt,lt&=tt}b+=C,U+=V}return lt!=255}function jt(g,b,C,M,O){var z;for(z=0;z<O;++z)C[M+z]=g[b+z]>>8}function Yt(){ao=F,sl=et,lo=Pt,rh=jt}function pe(g,b,C){xt[g]=function(M,O,z,U,V,G,J,lt,tt,ut,dt,Tt,wt,gt,mt,Dt,Xt){var ie,re=Xt-1>>1,ue=V[G+0]|J[lt+0]<<16,Pe=tt[ut+0]|dt[Tt+0]<<16;t(M!=null);var xe=3*ue+Pe+131074>>2;for(b(M[O+0],255&xe,xe>>16,wt,gt),z!=null&&(xe=3*Pe+ue+131074>>2,b(z[U+0],255&xe,xe>>16,mt,Dt)),ie=1;ie<=re;++ie){var Oe=V[G+ie]|J[lt+ie]<<16,Xe=tt[ut+ie]|dt[Tt+ie]<<16,We=ue+Oe+Pe+Xe+524296,_i=We+2*(Oe+Pe)>>3;xe=_i+ue>>1,ue=(We=We+2*(ue+Xe)>>3)+Oe>>1,b(M[O+2*ie-1],255&xe,xe>>16,wt,gt+(2*ie-1)*C),b(M[O+2*ie-0],255&ue,ue>>16,wt,gt+(2*ie-0)*C),z!=null&&(xe=We+Pe>>1,ue=_i+Xe>>1,b(z[U+2*ie-1],255&xe,xe>>16,mt,Dt+(2*ie-1)*C),b(z[U+2*ie+0],255&ue,ue>>16,mt,Dt+(2*ie+0)*C)),ue=Oe,Pe=Xe}1&Xt||(xe=3*ue+Pe+131074>>2,b(M[O+Xt-1],255&xe,xe>>16,wt,gt+(Xt-1)*C),z!=null&&(xe=3*Pe+ue+131074>>2,b(z[U+Xt-1],255&xe,xe>>16,mt,Dt+(Xt-1)*C)))}}function Te(){bn[ea]=ep,bn[nl]=na,bn[oh]=iu,bn[ol]=hh,bn[Ul]=uh,bn[ah]=ru,bn[lh]=oa,bn[ia]=na,bn[Sc]=hh,bn[jl]=uh,bn[Ec]=ru}function Ye(g){return g&~ql?0>g?0:255:g>>ph}function bi(g,b){return Ye((19077*g>>8)+(26149*b>>8)-14234)}function Li(g,b,C){return Ye((19077*g>>8)-(6419*b>>8)-(13320*C>>8)+8708)}function ui(g,b){return Ye((19077*g>>8)+(33050*b>>8)-17685)}function Xi(g,b,C,M,O){M[O+0]=bi(g,C),M[O+1]=Li(g,b,C),M[O+2]=ui(g,b)}function ni(g,b,C,M,O){M[O+0]=ui(g,b),M[O+1]=Li(g,b,C),M[O+2]=bi(g,C)}function Nr(g,b,C,M,O){var z=Li(g,b,C);b=z<<3&224|ui(g,b)>>3,M[O+0]=248&bi(g,C)|z>>5,M[O+1]=b}function Oi(g,b,C,M,O){var z=240&ui(g,b)|15;M[O+0]=240&bi(g,C)|Li(g,b,C)>>4,M[O+1]=z}function zi(g,b,C,M,O){M[O+0]=255,Xi(g,b,C,M,O+1)}function ss(g,b,C,M,O){ni(g,b,C,M,O),M[O+3]=255}function Bn(g,b,C,M,O){Xi(g,b,C,M,O),M[O+3]=255}function gn(g,b){return 0>g?0:g>b?b:g}function Zo(g,b,C){xt[g]=function(M,O,z,U,V,G,J,lt,tt){for(var ut=lt+(-2&tt)*C;lt!=ut;)b(M[O+0],z[U+0],V[G+0],J,lt),b(M[O+1],z[U+0],V[G+0],J,lt+C),O+=2,++U,++G,lt+=2*C;1&tt&&b(M[O+0],z[U+0],V[G+0],J,lt)}}function bc(g,b,C){return C==0?g==0?b==0?6:5:b==0?4:0:C}function La(g,b,C,M,O){switch(g>>>30){case 3:To(b,C,M,O,0);break;case 2:xc(b,C,M,O);break;case 1:tn(b,C,M,O)}}function $o(g,b){var C,M,O=b.M,z=b.Nb,U=g.oc,V=g.pc+40,G=g.oc,J=g.pc+584,lt=g.oc,tt=g.pc+600;for(C=0;16>C;++C)U[V+32*C-1]=129;for(C=0;8>C;++C)G[J+32*C-1]=129,lt[tt+32*C-1]=129;for(0<O?U[V-1-32]=G[J-1-32]=lt[tt-1-32]=129:(s(U,V-32-1,127,21),s(G,J-32-1,127,9),s(lt,tt-32-1,127,9)),M=0;M<g.za;++M){var ut=b.ya[b.aa+M];if(0<M){for(C=-1;16>C;++C)r(U,V+32*C-4,U,V+32*C+12,4);for(C=-1;8>C;++C)r(G,J+32*C-4,G,J+32*C+4,4),r(lt,tt+32*C-4,lt,tt+32*C+4,4)}var dt=g.Gd,Tt=g.Hd+M,wt=ut.ad,gt=ut.Hc;if(0<O&&(r(U,V-32,dt[Tt].y,0,16),r(G,J-32,dt[Tt].f,0,8),r(lt,tt-32,dt[Tt].ea,0,8)),ut.Za){var mt=U,Dt=V-32+16;for(0<O&&(M>=g.za-1?s(mt,Dt,dt[Tt].y[15],4):r(mt,Dt,dt[Tt+1].y,0,4)),C=0;4>C;C++)mt[Dt+128+C]=mt[Dt+256+C]=mt[Dt+384+C]=mt[Dt+0+C];for(C=0;16>C;++C,gt<<=2)mt=U,Dt=V+m[C],cs[ut.Ob[C]](mt,Dt),La(gt,wt,16*+C,mt,Dt)}else if(mt=bc(M,O,ut.Ob[0]),sa[mt](U,V),gt!=0)for(C=0;16>C;++C,gt<<=2)La(gt,wt,16*+C,U,V+m[C]);for(C=ut.Gc,mt=bc(M,O,ut.Dd),vn[mt](G,J),vn[mt](lt,tt),gt=wt,mt=G,Dt=J,255&(ut=C>>0)&&(170&ut?Po(gt,256,mt,Dt):Fn(gt,256,mt,Dt)),ut=lt,gt=tt,255&(C>>=8)&&(170&C?Po(wt,320,ut,gt):Fn(wt,320,ut,gt)),O<g.Ub-1&&(r(dt[Tt].y,0,U,V+480,16),r(dt[Tt].f,0,G,J+224,8),r(dt[Tt].ea,0,lt,tt+224,8)),C=8*z*g.B,dt=g.sa,Tt=g.ta+16*M+16*z*g.R,wt=g.qa,ut=g.ra+8*M+C,gt=g.Ha,mt=g.Ia+8*M+C,C=0;16>C;++C)r(dt,Tt+C*g.R,U,V+32*C,16);for(C=0;8>C;++C)r(wt,ut+C*g.B,G,J+32*C,8),r(gt,mt+C*g.B,lt,tt+32*C,8)}}function Eo(g,b,C,M,O,z,U,V,G){var J=[0],lt=[0],tt=0,ut=G!=null?G.kd:0,dt=G??new Dl;if(g==null||12>C)return 7;dt.data=g,dt.w=b,dt.ha=C,b=[b],C=[C],dt.gb=[dt.gb];t:{var Tt=b,wt=C,gt=dt.gb;if(t(g!=null),t(wt!=null),t(gt!=null),gt[0]=0,12<=wt[0]&&!e(g,Tt[0],"RIFF")){if(e(g,Tt[0]+8,"WEBP")){gt=3;break t}var mt=Fe(g,Tt[0]+4);if(12>mt||4294967286<mt){gt=3;break t}if(ut&&mt>wt[0]-8){gt=7;break t}gt[0]=mt,Tt[0]+=12,wt[0]-=12}gt=0}if(gt!=0)return gt;for(mt=0<dt.gb[0],C=C[0];;){t:{var Dt=g;wt=b,gt=C;var Xt=J,ie=lt,re=Tt=[0];if((xe=tt=[tt])[0]=0,8>gt[0])gt=7;else{if(!e(Dt,wt[0],"VP8X")){if(Fe(Dt,wt[0]+4)!=10){gt=3;break t}if(18>gt[0]){gt=7;break t}var ue=Fe(Dt,wt[0]+8),Pe=1+Re(Dt,wt[0]+12);if(2147483648<=Pe*(Dt=1+Re(Dt,wt[0]+15))){gt=3;break t}re!=null&&(re[0]=ue),Xt!=null&&(Xt[0]=Pe),ie!=null&&(ie[0]=Dt),wt[0]+=18,gt[0]-=18,xe[0]=1}gt=0}}if(tt=tt[0],Tt=Tt[0],gt!=0)return gt;if(wt=!!(2&Tt),!mt&&tt)return 3;if(z!=null&&(z[0]=!!(16&Tt)),U!=null&&(U[0]=wt),V!=null&&(V[0]=0),U=J[0],Tt=lt[0],tt&&wt&&G==null){gt=0;break}if(4>C){gt=7;break}if(mt&&tt||!mt&&!tt&&!e(g,b[0],"ALPH")){C=[C],dt.na=[dt.na],dt.P=[dt.P],dt.Sa=[dt.Sa];t:{ue=g,gt=b,mt=C;var xe=dt.gb;Xt=dt.na,ie=dt.P,re=dt.Sa,Pe=22,t(ue!=null),t(mt!=null),Dt=gt[0];var Oe=mt[0];for(t(Xt!=null),t(re!=null),Xt[0]=null,ie[0]=null,re[0]=0;;){if(gt[0]=Dt,mt[0]=Oe,8>Oe){gt=7;break t}var Xe=Fe(ue,Dt+4);if(4294967286<Xe){gt=3;break t}var We=8+Xe+1&-2;if(Pe+=We,0<xe&&Pe>xe){gt=3;break t}if(!e(ue,Dt,"VP8 ")||!e(ue,Dt,"VP8L")){gt=0;break t}if(Oe[0]<We){gt=7;break t}e(ue,Dt,"ALPH")||(Xt[0]=ue,ie[0]=Dt+8,re[0]=Xe),Dt+=We,Oe-=We}}if(C=C[0],dt.na=dt.na[0],dt.P=dt.P[0],dt.Sa=dt.Sa[0],gt!=0)break}C=[C],dt.Ja=[dt.Ja],dt.xa=[dt.xa];t:if(xe=g,gt=b,mt=C,Xt=dt.gb[0],ie=dt.Ja,re=dt.xa,ue=gt[0],Dt=!e(xe,ue,"VP8 "),Pe=!e(xe,ue,"VP8L"),t(xe!=null),t(mt!=null),t(ie!=null),t(re!=null),8>mt[0])gt=7;else{if(Dt||Pe){if(xe=Fe(xe,ue+4),12<=Xt&&xe>Xt-12){gt=3;break t}if(ut&&xe>mt[0]-8){gt=7;break t}ie[0]=xe,gt[0]+=8,mt[0]-=8,re[0]=Pe}else re[0]=5<=mt[0]&&xe[ue+0]==47&&!(xe[ue+4]>>5),ie[0]=mt[0];gt=0}if(C=C[0],dt.Ja=dt.Ja[0],dt.xa=dt.xa[0],b=b[0],gt!=0)break;if(4294967286<dt.Ja)return 3;if(V==null||wt||(V[0]=dt.xa?2:1),U=[U],Tt=[Tt],dt.xa){if(5>C){gt=7;break}V=U,ut=Tt,wt=z,g==null||5>C?g=0:5<=C&&g[b+0]==47&&!(g[b+4]>>5)?(mt=[0],xe=[0],Xt=[0],Qt(ie=new nt,g,b,C),St(ie,mt,xe,Xt)?(V!=null&&(V[0]=mt[0]),ut!=null&&(ut[0]=xe[0]),wt!=null&&(wt[0]=Xt[0]),g=1):g=0):g=0}else{if(10>C){gt=7;break}V=Tt,g==null||10>C||!Ws(g,b+3,C-3)?g=0:(ut=g[b+0]|g[b+1]<<8|g[b+2]<<16,wt=16383&(g[b+7]<<8|g[b+6]),g=16383&(g[b+9]<<8|g[b+8]),1&ut||3<(ut>>1&7)||!(ut>>4&1)||ut>>5>=dt.Ja||!wt||!g?g=0:(U&&(U[0]=wt),V&&(V[0]=g),g=1))}if(!g||(U=U[0],Tt=Tt[0],tt&&(J[0]!=U||lt[0]!=Tt)))return 3;G!=null&&(G[0]=dt,G.offset=b-G.w,t(4294967286>b-G.w),t(G.offset==G.ha-C));break}return gt==0||gt==7&&tt&&G==null?(z!=null&&(z[0]|=dt.na!=null&&0<dt.na.length),M!=null&&(M[0]=U),O!=null&&(O[0]=Tt),0):gt}function Ma(g,b,C){var M=b.width,O=b.height,z=0,U=0,V=M,G=O;if(b.Da=g!=null&&0<g.Da,b.Da&&(V=g.cd,G=g.bd,z=g.v,U=g.j,11>C||(z&=-2,U&=-2),0>z||0>U||0>=V||0>=G||z+V>M||U+G>O))return 0;if(b.v=z,b.j=U,b.va=z+V,b.o=U+G,b.U=V,b.T=G,b.da=g!=null&&0<g.da,b.da){if(!mi(V,G,C=[g.ib],z=[g.hb]))return 0;b.ib=C[0],b.hb=z[0]}return b.ob=g!=null&&g.ob,b.Kb=g==null||!g.Sd,b.da&&(b.ob=b.ib<3*M/4&&b.hb<3*O/4,b.Kb=0),1}function Rn(g){if(g==null)return 2;if(11>g.S){var b=g.f.RGBA;b.fb+=(g.height-1)*b.A,b.A=-b.A}else b=g.f.kb,g=g.height,b.O+=(g-1)*b.fa,b.fa=-b.fa,b.N+=(g-1>>1)*b.Ab,b.Ab=-b.Ab,b.W+=(g-1>>1)*b.Db,b.Db=-b.Db,b.F!=null&&(b.J+=(g-1)*b.lb,b.lb=-b.lb);return 0}function mn(g,b,C,M){if(M==null||0>=g||0>=b)return 2;if(C!=null){if(C.Da){var O=C.cd,z=C.bd,U=-2&C.v,V=-2&C.j;if(0>U||0>V||0>=O||0>=z||U+O>g||V+z>b)return 2;g=O,b=z}if(C.da){if(!mi(g,b,O=[C.ib],z=[C.hb]))return 2;g=O[0],b=z[0]}}M.width=g,M.height=b;t:{var G=M.width,J=M.height;if(g=M.S,0>=G||0>=J||!(g>=ea&&13>g))g=2;else{if(0>=M.Rd&&M.sd==null){U=z=O=b=0;var lt=(V=G*k[g])*J;if(11>g||(z=(J+1)/2*(b=(G+1)/2),g==12&&(U=(O=G)*J)),(J=n(lt+2*z+U))==null){g=1;break t}M.sd=J,11>g?((G=M.f.RGBA).eb=J,G.fb=0,G.A=V,G.size=lt):((G=M.f.kb).y=J,G.O=0,G.fa=V,G.Fd=lt,G.f=J,G.N=0+lt,G.Ab=b,G.Cd=z,G.ea=J,G.W=0+lt+z,G.Db=b,G.Ed=z,g==12&&(G.F=J,G.J=0+lt+2*z),G.Tc=U,G.lb=O)}if(b=1,O=M.S,z=M.width,U=M.height,O>=ea&&13>O)if(11>O)g=M.f.RGBA,b&=(V=Math.abs(g.A))*(U-1)+z<=g.size,b&=V>=z*k[O],b&=g.eb!=null;else{g=M.f.kb,V=(z+1)/2,lt=(U+1)/2,G=Math.abs(g.fa),J=Math.abs(g.Ab);var tt=Math.abs(g.Db),ut=Math.abs(g.lb),dt=ut*(U-1)+z;b&=G*(U-1)+z<=g.Fd,b&=J*(lt-1)+V<=g.Cd,b=(b&=tt*(lt-1)+V<=g.Ed)&G>=z&J>=V&tt>=V,b&=g.y!=null,b&=g.f!=null,b&=g.ea!=null,O==12&&(b&=ut>=z,b&=dt<=g.Tc,b&=g.F!=null)}else b=0;g=b?0:2}}return g!=0||C!=null&&C.fd&&(g=Rn(M)),g}var Dr=64,el=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],il=24,Ba=32,io=8,Rs=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Se("Predictor0","PredictorAdd0"),xt.Predictor0=function(){return 4278190080},xt.Predictor1=function(g){return g},xt.Predictor2=function(g,b,C){return b[C+0]},xt.Predictor3=function(g,b,C){return b[C+1]},xt.Predictor4=function(g,b,C){return b[C-1]},xt.Predictor5=function(g,b,C){return Ne(Ne(g,b[C+1]),b[C+0])},xt.Predictor6=function(g,b,C){return Ne(g,b[C-1])},xt.Predictor7=function(g,b,C){return Ne(g,b[C+0])},xt.Predictor8=function(g,b,C){return Ne(b[C-1],b[C+0])},xt.Predictor9=function(g,b,C){return Ne(b[C+0],b[C+1])},xt.Predictor10=function(g,b,C){return Ne(Ne(g,b[C-1]),Ne(b[C+0],b[C+1]))},xt.Predictor11=function(g,b,C){var M=b[C+0];return 0>=Ci(M>>24&255,g>>24&255,(b=b[C-1])>>24&255)+Ci(M>>16&255,g>>16&255,b>>16&255)+Ci(M>>8&255,g>>8&255,b>>8&255)+Ci(255&M,255&g,255&b)?M:g},xt.Predictor12=function(g,b,C){var M=b[C+0];return(ci((g>>24&255)+(M>>24&255)-((b=b[C-1])>>24&255))<<24|ci((g>>16&255)+(M>>16&255)-(b>>16&255))<<16|ci((g>>8&255)+(M>>8&255)-(b>>8&255))<<8|ci((255&g)+(255&M)-(255&b)))>>>0},xt.Predictor13=function(g,b,C){var M=b[C-1];return(Ei((g=Ne(g,b[C+0]))>>24&255,M>>24&255)<<24|Ei(g>>16&255,M>>16&255)<<16|Ei(g>>8&255,M>>8&255)<<8|Ei(g>>0&255,M>>0&255))>>>0};var zl=xt.PredictorAdd0;xt.PredictorAdd1=Ii,Se("Predictor2","PredictorAdd2"),Se("Predictor3","PredictorAdd3"),Se("Predictor4","PredictorAdd4"),Se("Predictor5","PredictorAdd5"),Se("Predictor6","PredictorAdd6"),Se("Predictor7","PredictorAdd7"),Se("Predictor8","PredictorAdd8"),Se("Predictor9","PredictorAdd9"),Se("Predictor10","PredictorAdd10"),Se("Predictor11","PredictorAdd11"),Se("Predictor12","PredictorAdd12"),Se("Predictor13","PredictorAdd13");var Yo=xt.PredictorAdd2;Ai("ColorIndexInverseTransform","MapARGB","32b",function(g){return g>>8&255},function(g){return g}),Ai("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(g){return g},function(g){return g>>8&255});var Ra,yn=xt.ColorIndexInverseTransform,_n=xt.MapARGB,ka=xt.VP8LColorIndexInverseTransformAlpha,wc=xt.MapAlpha,Co=xt.VP8LPredictorsAdd=[];Co.length=16,(xt.VP8LPredictors=[]).length=16,(xt.VP8LPredictorsAdd_C=[]).length=16,(xt.VP8LPredictors_C=[]).length=16;var Pi,ks,ro,kn,Js,rl,On,To,xc,Po,tn,Fn,Ko,so,no,Jr,Nn,Xs,Qo,vr,hr,Xr,Gr,oo,ao,sl,lo,rh,sh=n(511),nh=n(2041),zr=n(225),ta=n(767),en=0,Ac=nh,Oa=zr,Os=ta,vs=sh,ea=0,nl=1,oh=2,ol=3,Ul=4,ah=5,lh=6,ia=7,Sc=8,jl=9,Ec=10,ju=[2,3,7],Gu=[3,3,11],ch=[280,256,256,256,40],Qh=[0,1,1,1,0],Gl=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],tu=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],rn=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Io=8,Vl=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Dn=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ra=null,Vu=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],qu=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],eu=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Hu=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Cc=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Fa=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Je=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],sa=[],cs=[],vn=[],Wu=1,ze=2,Lo=[],bn=[];pe("UpsampleRgbLinePair",Xi,3),pe("UpsampleBgrLinePair",ni,3),pe("UpsampleRgbaLinePair",Bn,4),pe("UpsampleBgraLinePair",ss,4),pe("UpsampleArgbLinePair",zi,4),pe("UpsampleRgba4444LinePair",Oi,2),pe("UpsampleRgb565LinePair",Nr,2);var ep=xt.UpsampleRgbLinePair,iu=xt.UpsampleBgrLinePair,na=xt.UpsampleRgbaLinePair,hh=xt.UpsampleBgraLinePair,uh=xt.UpsampleArgbLinePair,ru=xt.UpsampleRgba4444LinePair,oa=xt.UpsampleRgb565LinePair,br=16,Mo=1<<br-1,co=-227,dh=482,ph=6,ql=(256<<ph)-1,Ju=0,Bo=n(256),Tc=n(256),oi=n(256),w=n(256),a=n(dh-co),d=n(dh-co);Zo("YuvToRgbRow",Xi,3),Zo("YuvToBgrRow",ni,3),Zo("YuvToRgbaRow",Bn,4),Zo("YuvToBgraRow",ss,4),Zo("YuvToArgbRow",zi,4),Zo("YuvToRgba4444Row",Oi,2),Zo("YuvToRgb565Row",Nr,2);var m=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],v=[0,2,8],E=[8,7,6,4,4,2,2,2,1,1,1,1],B=1;this.WebPDecodeRGBA=function(g,b,C,M,O){var z=nl,U=new Mn,V=new rr;U.ba=V,V.S=z,V.width=[V.width],V.height=[V.height];var G=V.width,J=V.height,lt=new vt;if(lt==null||g==null)var tt=2;else t(lt!=null),tt=Eo(g,b,C,lt.width,lt.height,lt.Pd,lt.Qd,lt.format,null);if(tt!=0?G=0:(G!=null&&(G[0]=lt.width[0]),J!=null&&(J[0]=lt.height[0]),G=1),G){V.width=V.width[0],V.height=V.height[0],M!=null&&(M[0]=V.width),O!=null&&(O[0]=V.height);t:{if(M=new Ms,(O=new Dl).data=g,O.w=b,O.ha=C,O.kd=1,b=[0],t(O!=null),((g=Eo(O.data,O.w,O.ha,null,null,null,b,null,O))==0||g==7)&&b[0]&&(g=4),(b=g)==0){if(t(U!=null),M.data=O.data,M.w=O.w+O.offset,M.ha=O.ha-O.offset,M.put=Ut,M.ac=kt,M.bc=Vt,M.ma=U,O.xa){if((g=pi())==null){U=1;break t}if(function(ut,dt){var Tt=[0],wt=[0],gt=[0];e:for(;;){if(ut==null)return 0;if(dt==null)return ut.a=2,0;if(ut.l=dt,ut.a=0,Qt(ut.m,dt.data,dt.w,dt.ha),!St(ut.m,Tt,wt,gt)){ut.a=3;break e}if(ut.xb=ze,dt.width=Tt[0],dt.height=wt[0],!Fi(Tt[0],wt[0],1,ut,null))break e;return 1}return t(ut.a!=0),0}(g,M)){if(M=(b=mn(M.width,M.height,U.Oa,U.ba))==0){e:{M=g;i:for(;;){if(M==null){M=0;break e}if(t(M.s.yc!=null),t(M.s.Ya!=null),t(0<M.s.Wb),t((C=M.l)!=null),t((O=C.ma)!=null),M.xb!=0){if(M.ca=O.ba,M.tb=O.tb,t(M.ca!=null),!Ma(O.Oa,C,ol)){M.a=2;break i}if(!sr(M,C.width)||C.da)break i;if((C.da||je(M.ca.S))&&Yt(),11>M.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),M.ca.f.kb.F!=null&&Yt()),M.Pb&&0<M.s.ua&&M.s.vb.X==null&&!Ze(M.s.vb,M.s.Wa.Xa)){M.a=1;break i}M.xb=0}if(!qi(M,M.V,M.Ba,M.c,M.i,C.o,wi))break i;O.Dc=M.Ma,M=1;break e}t(M.a!=0),M=0}M=!M}M&&(b=g.a)}else b=g.a}else{if((g=new Sr)==null){U=1;break t}if(g.Fa=O.na,g.P=O.P,g.qc=O.Sa,mr(g,M)){if((b=mn(M.width,M.height,U.Oa,U.ba))==0){if(g.Aa=0,C=U.Oa,t((O=g)!=null),C!=null){if(0<(G=0>(G=C.Md)?0:100<G?255:255*G/100)){for(J=lt=0;4>J;++J)12>(tt=O.pb[J]).lc&&(tt.ia=G*E[0>tt.lc?0:tt.lc]>>3),lt|=tt.ia;lt&&(alert("todo:VP8InitRandom"),O.ia=1)}O.Ga=C.Id,100<O.Ga?O.Ga=100:0>O.Ga&&(O.Ga=0)}wo(g,M)||(b=g.a)}}else b=g.a}b==0&&U.Oa!=null&&U.Oa.fd&&(b=Rn(U.ba))}U=b}z=U!=0?null:11>z?V.f.RGBA.eb:V.f.kb.y}else z=null;return z};var k=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function y(xt,qt){for(var zt="",ct=0;ct<4;ct++)zt+=String.fromCharCode(xt[qt++]);return zt}function A(xt,qt){return(xt[qt+0]<<0|xt[qt+1]<<8|xt[qt+2]<<16)>>>0}function T(xt,qt){return(xt[qt+0]<<0|xt[qt+1]<<8|xt[qt+2]<<16|xt[qt+3]<<24)>>>0}new f;var P=[0],L=[0],D=[],j=new f,X=i,Z=function(xt,qt){var zt={},ct=0,pt=!1,Bt=0,bt=0;if(zt.frames=[],!function(Et,Lt,Gt,Wt){for(var $t=0;$t<Wt;$t++)if(Et[Lt+$t]!=Gt.charCodeAt($t))return!0;return!1}(xt,qt,"RIFF",4)){var ne,oe;for(T(xt,qt+=4),qt+=8;qt<xt.length;){var le=y(xt,qt),Qt=T(xt,qt+=4);qt+=4;var fe=Qt+(1&Qt);switch(le){case"VP8 ":case"VP8L":zt.frames[ct]===void 0&&(zt.frames[ct]={}),(nt=zt.frames[ct]).src_off=pt?bt:qt-8,nt.src_size=Bt+Qt+8,ct++,pt&&(pt=!1,Bt=0,bt=0);break;case"VP8X":(nt=zt.header={}).feature_flags=xt[qt];var de=qt+4;nt.canvas_width=1+A(xt,de),de+=3,nt.canvas_height=1+A(xt,de),de+=3;break;case"ALPH":pt=!0,Bt=fe+8,bt=qt-8;break;case"ANIM":(nt=zt.header).bgcolor=T(xt,qt),de=qt+4,nt.loop_count=(ne=xt)[(oe=de)+0]<<0|ne[oe+1]<<8,de+=2;break;case"ANMF":var Me,nt;(nt=zt.frames[ct]={}).offset_x=2*A(xt,qt),qt+=3,nt.offset_y=2*A(xt,qt),qt+=3,nt.width=1+A(xt,qt),qt+=3,nt.height=1+A(xt,qt),qt+=3,nt.duration=A(xt,qt),qt+=3,Me=xt[qt++],nt.dispose=1&Me,nt.blend=Me>>1&1}le!="ANMF"&&(qt+=fe)}return zt}}(X,0);Z.response=X,Z.rgbaoutput=!0,Z.dataurl=!1;var $=Z.header?Z.header:null,ht=Z.frames?Z.frames:null;if($){$.loop_counter=$.loop_count,P=[$.canvas_height],L=[$.canvas_width];for(var _t=0;_t<ht.length&&ht[_t].blend!=0;_t++);}var Mt=ht[0],Nt=j.WebPDecodeRGBA(X,Mt.src_off,Mt.src_size,L,P);Mt.rgba=Nt,Mt.imgwidth=L[0],Mt.imgheight=P[0];for(var Rt=0;Rt<L[0]*P[0]*4;Rt++)D[Rt]=Nt[Rt];return this.width=L,this.height=P,this.data=D,this}(function(i){var t=function(){return typeof $1=="function"},e=function(P,L,D,j){var X=4,Z=c;switch(j){case i.image_compression.FAST:X=1,Z=n;break;case i.image_compression.MEDIUM:X=6,Z=l;break;case i.image_compression.SLOW:X=9,Z=f}P=r(P,L,D,Z);var $=$1(P,{level:X});return i.__addimage__.arrayBufferToBinaryString($)},r=function(P,L,D,j){for(var X,Z,$,ht=P.length/L,_t=new Uint8Array(P.length+ht),Mt=A(),Nt=0;Nt<ht;Nt+=1){if($=Nt*L,X=P.subarray($,$+L),j)_t.set(j(X,D,Z),$+Nt);else{for(var Rt,xt=Mt.length,qt=[];Rt<xt;Rt+=1)qt[Rt]=Mt[Rt](X,D,Z);var zt=T(qt.concat());_t.set(qt[zt],$+Nt)}Z=X}return _t},s=function(P){var L=Array.apply([],P);return L.unshift(0),L},n=function(P,L){var D,j=[],X=P.length;j[0]=1;for(var Z=0;Z<X;Z+=1)D=P[Z-L]||0,j[Z+1]=P[Z]-D+256&255;return j},c=function(P,L,D){var j,X=[],Z=P.length;X[0]=2;for(var $=0;$<Z;$+=1)j=D&&D[$]||0,X[$+1]=P[$]-j+256&255;return X},l=function(P,L,D){var j,X,Z=[],$=P.length;Z[0]=3;for(var ht=0;ht<$;ht+=1)j=P[ht-L]||0,X=D&&D[ht]||0,Z[ht+1]=P[ht]+256-(j+X>>>1)&255;return Z},f=function(P,L,D){var j,X,Z,$,ht=[],_t=P.length;ht[0]=4;for(var Mt=0;Mt<_t;Mt+=1)j=P[Mt-L]||0,X=D&&D[Mt]||0,Z=D&&D[Mt-L]||0,$=y(j,X,Z),ht[Mt+1]=P[Mt]-$+256&255;return ht},y=function(P,L,D){if(P===L&&L===D)return P;var j=Math.abs(L-D),X=Math.abs(P-D),Z=Math.abs(P+L-D-D);return j<=X&&j<=Z?P:X<=Z?L:D},A=function(){return[s,n,c,l,f]},T=function(P){var L=P.map(function(D){return D.reduce(function(j,X){return j+Math.abs(X)},0)});return L.indexOf(Math.min.apply(null,L))};i.processPNG=function(P,L,D,j){var X,Z,$,ht,_t,Mt,Nt,Rt,xt,qt,zt,ct,pt,Bt,bt,ne=this.decode.FLATE_DECODE,oe="";if(this.__addimage__.isArrayBuffer(P)&&(P=new Uint8Array(P)),this.__addimage__.isArrayBufferView(P)){if(P=($=new fV(P)).imgData,Z=$.bits,X=$.colorSpace,_t=$.colors,[4,6].indexOf($.colorType)!==-1){if($.bits===8){xt=(Rt=$.pixelBitlength==32?new Uint32Array($.decodePixels().buffer):$.pixelBitlength==16?new Uint16Array($.decodePixels().buffer):new Uint8Array($.decodePixels().buffer)).length,zt=new Uint8Array(xt*$.colors),qt=new Uint8Array(xt);var le,Qt=$.pixelBitlength-$.bits;for(Bt=0,bt=0;Bt<xt;Bt++){for(pt=Rt[Bt],le=0;le<Qt;)zt[bt++]=pt>>>le&255,le+=$.bits;qt[Bt]=pt>>>le&255}}if($.bits===16){xt=(Rt=new Uint32Array($.decodePixels().buffer)).length,zt=new Uint8Array(xt*(32/$.pixelBitlength)*$.colors),qt=new Uint8Array(xt*(32/$.pixelBitlength)),ct=$.colors>1,Bt=0,bt=0;for(var fe=0;Bt<xt;)pt=Rt[Bt++],zt[bt++]=pt>>>0&255,ct&&(zt[bt++]=pt>>>16&255,pt=Rt[Bt++],zt[bt++]=pt>>>0&255),qt[fe++]=pt>>>16&255;Z=8}j!==i.image_compression.NONE&&t()?(P=e(zt,$.width*$.colors,$.colors,j),Nt=e(qt,$.width,1,j)):(P=zt,Nt=qt,ne=void 0)}if($.colorType===3&&(X=this.color_spaces.INDEXED,Mt=$.palette,$.transparency.indexed)){var de=$.transparency.indexed,Me=0;for(Bt=0,xt=de.length;Bt<xt;++Bt)Me+=de[Bt];if((Me/=255)===xt-1&&de.indexOf(0)!==-1)ht=[de.indexOf(0)];else if(Me!==xt){for(Rt=$.decodePixels(),qt=new Uint8Array(Rt.length),Bt=0,xt=Rt.length;Bt<xt;Bt++)qt[Bt]=de[Rt[Bt]];Nt=e(qt,$.width,1)}}var nt=function(Et){var Lt;switch(Et){case i.image_compression.FAST:Lt=11;break;case i.image_compression.MEDIUM:Lt=13;break;case i.image_compression.SLOW:Lt=14;break;default:Lt=12}return Lt}(j);return ne===this.decode.FLATE_DECODE&&(oe="/Predictor "+nt+" "),oe+="/Colors "+_t+" /BitsPerComponent "+Z+" /Columns "+$.width,(this.__addimage__.isArrayBuffer(P)||this.__addimage__.isArrayBufferView(P))&&(P=this.__addimage__.arrayBufferToBinaryString(P)),(Nt&&this.__addimage__.isArrayBuffer(Nt)||this.__addimage__.isArrayBufferView(Nt))&&(Nt=this.__addimage__.arrayBufferToBinaryString(Nt)),{alias:D,data:P,index:L,filter:ne,decodeParameters:oe,transparency:ht,palette:Mt,sMask:Nt,predictor:nt,width:$.width,height:$.height,bitsPerComponent:Z,colorSpace:X}}}})(Bi.API),function(i){i.processGIF89A=function(t,e,r,s){var n=new gV(t),c=n.width,l=n.height,f=[];n.decodeAndBlitFrameRGBA(0,f);var y={data:f,width:c,height:l},A=new Hy(100).encode(y,100);return i.processJPEG.call(this,A,e,r,s)},i.processGIF87A=i.processGIF89A}(Bi.API),fl.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var t=0;t<i;t++){var e=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:s,green:r,blue:e,quad:n}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},fl.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[i]()}catch(e){Yr.log("bit decode error:"+e)}},fl.prototype.bit1=function(){var i,t=Math.ceil(this.width/8),e=t%4;for(i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,s=0;s<t;s++)for(var n=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+8*s*4,l=0;l<8&&8*s+l<this.width;l++){var f=this.palette[n>>7-l&1];this.data[c+4*l]=f.blue,this.data[c+4*l+1]=f.green,this.data[c+4*l+2]=f.red,this.data[c+4*l+3]=255}e!==0&&(this.pos+=4-e)}},fl.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),t=i%4,e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,s=0;s<i;s++){var n=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+2*s*4,l=n>>4,f=15&n,y=this.palette[l];if(this.data[c]=y.blue,this.data[c+1]=y.green,this.data[c+2]=y.red,this.data[c+3]=255,2*s+1>=this.width)break;y=this.palette[f],this.data[c+4]=y.blue,this.data[c+4+1]=y.green,this.data[c+4+2]=y.red,this.data[c+4+3]=255}t!==0&&(this.pos+=4-t)}},fl.prototype.bit8=function(){for(var i=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var s=this.datav.getUint8(this.pos++,!0),n=e*this.width*4+4*r;if(s<this.palette.length){var c=this.palette[s];this.data[n]=c.red,this.data[n+1]=c.green,this.data[n+2]=c.blue,this.data[n+3]=255}else this.data[n]=255,this.data[n+1]=255,this.data[n+2]=255,this.data[n+3]=255}i!==0&&(this.pos+=4-i)}},fl.prototype.bit15=function(){for(var i=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,s=0;s<this.width;s++){var n=this.datav.getUint16(this.pos,!0);this.pos+=2;var c=(n&t)/t*255|0,l=(n>>5&t)/t*255|0,f=(n>>10&t)/t*255|0,y=n>>15?255:0,A=r*this.width*4+4*s;this.data[A]=f,this.data[A+1]=l,this.data[A+2]=c,this.data[A+3]=y}this.pos+=i}},fl.prototype.bit16=function(){for(var i=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var s=this.bottom_up?r:this.height-1-r,n=0;n<this.width;n++){var c=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(c&t)/t*255|0,f=(c>>5&e)/e*255|0,y=(c>>11)/t*255|0,A=s*this.width*4+4*n;this.data[A]=y,this.data[A+1]=f,this.data[A+2]=l,this.data[A+3]=255}this.pos+=i}},fl.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var t=this.bottom_up?i:this.height-1-i,e=0;e<this.width;e++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),c=t*this.width*4+4*e;this.data[c]=n,this.data[c+1]=s,this.data[c+2]=r,this.data[c+3]=255}this.pos+=this.width%4}},fl.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var t=this.bottom_up?i:this.height-1-i,e=0;e<this.width;e++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*e;this.data[l]=n,this.data[l+1]=s,this.data[l+2]=r,this.data[l+3]=c}},fl.prototype.getData=function(){return this.data},function(i){i.processBMP=function(t,e,r,s){var n=new fl(t,!1),c=n.width,l=n.height,f={data:n.getData(),width:c,height:l},y=new Hy(100).encode(f,100);return i.processJPEG.call(this,y,e,r,s)}}(Bi.API),J5.prototype.getData=function(){return this.data},function(i){i.processWEBP=function(t,e,r,s){var n=new J5(t),c=n.width,l=n.height,f={data:n.getData(),width:c,height:l},y=new Hy(100).encode(f,100);return i.processJPEG.call(this,y,e,r,s)}}(Bi.API),Bi.API.processRGBA=function(i,t,e){for(var r=i.data,s=r.length,n=new Uint8Array(s/4*3),c=new Uint8Array(s/4),l=0,f=0,y=0;y<s;y+=4){var A=r[y],T=r[y+1],P=r[y+2],L=r[y+3];n[l++]=A,n[l++]=T,n[l++]=P,c[f++]=L}var D=this.__addimage__.arrayBufferToBinaryString(n);return{alpha:this.__addimage__.arrayBufferToBinaryString(c),data:D,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},Bi.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},gd=Bi.API,zg=gd.getCharWidthsArray=function(i,t){var e,r,s=(t=t||{}).font||this.internal.getFont(),n=t.fontSize||this.internal.getFontSize(),c=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:s.metadata.Unicode.widths,f=l.fof?l.fof:1,y=t.kerning?t.kerning:s.metadata.Unicode.kerning,A=y.fof?y.fof:1,T=t.doKerning!==!1,P=0,L=i.length,D=0,j=l[0]||f,X=[];for(e=0;e<L;e++)r=i.charCodeAt(e),typeof s.metadata.widthOfString=="function"?X.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(r))+c*(1e3/n)||0)/1e3):(P=T&&Ur(y[r])==="object"&&!isNaN(parseInt(y[r][D],10))?y[r][D]/A:0,X.push((l[r]||j)/f+P)),D=r;return X},V5=gd.getStringUnitWidth=function(i,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),s=t.charSpace||this.internal.getCharSpace();return gd.processArabic&&(i=gd.processArabic(i)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(i,e,s)/e:zg.apply(this,arguments).reduce(function(n,c){return n+c},0)},q5=function(i,t,e,r){for(var s=[],n=0,c=i.length,l=0;n!==c&&l+t[n]<e;)l+=t[n],n++;s.push(i.slice(0,n));var f=n;for(l=0;n!==c;)l+t[n]>r&&(s.push(i.slice(f,n)),l=0,f=n),l+=t[n],n++;return f!==n&&s.push(i.slice(f,n)),s},H5=function(i,t,e){e||(e={});var r,s,n,c,l,f,y,A=[],T=[A],P=e.textIndent||0,L=0,D=0,j=i.split(" "),X=zg.apply(this,[" ",e])[0];if(f=e.lineIndent===-1?j[0].length+2:e.lineIndent||0){var Z=Array(f).join(" "),$=[];j.map(function(_t){(_t=_t.split(/\s*\n/)).length>1?$=$.concat(_t.map(function(Mt,Nt){return(Nt&&Mt.length?`
`:"")+Mt})):$.push(_t[0])}),j=$,f=V5.apply(this,[Z,e])}for(n=0,c=j.length;n<c;n++){var ht=0;if(r=j[n],f&&r[0]==`
`&&(r=r.substr(1),ht=1),P+L+(D=(s=zg.apply(this,[r,e])).reduce(function(_t,Mt){return _t+Mt},0))>t||ht){if(D>t){for(l=q5.apply(this,[r,s,t-(P+L),t]),A.push(l.shift()),A=[l.pop()];l.length;)T.push([l.shift()]);D=s.slice(r.length-(A[0]?A[0].length:0)).reduce(function(_t,Mt){return _t+Mt},0)}else A=[r];T.push(A),P=D+f,L=X}else A.push(r),P+=L+D,L=X}return y=f?function(_t,Mt){return(Mt?Z:"")+_t.join(" ")}:function(_t){return _t.join(" ")},T.map(y)},gd.splitTextToSize=function(i,t,e){var r,s=(e=e||{}).fontSize||this.internal.getFontSize(),n=(function(A){if(A.widths&&A.kerning)return{widths:A.widths,kerning:A.kerning};var T=this.internal.getFont(A.fontName,A.fontStyle);return T.metadata.Unicode?{widths:T.metadata.Unicode.widths||{0:1},kerning:T.metadata.Unicode.kerning||{}}:{font:T.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);r=Array.isArray(i)?i:String(i).split(/\r?\n/);var c=1*this.internal.scaleFactor*t/s;n.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/s:0,n.lineIndent=e.lineIndent;var l,f,y=[];for(l=0,f=r.length;l<f;l++)y=y.concat(H5.apply(this,[r[l],c,n]));return y},function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},r={},s=0;s<t.length;s++)e[t[s]]="0123456789abcdef"[s],r["0123456789abcdef"[s]]=t[s];var n=function(T){return"0x"+parseInt(T,10).toString(16)},c=i.__fontmetrics__.compress=function(T){var P,L,D,j,X=["{"];for(var Z in T){if(P=T[Z],isNaN(parseInt(Z,10))?L="'"+Z+"'":(Z=parseInt(Z,10),L=(L=n(Z).slice(2)).slice(0,-1)+r[L.slice(-1)]),typeof P=="number")P<0?(D=n(P).slice(3),j="-"):(D=n(P).slice(2),j=""),D=j+D.slice(0,-1)+r[D.slice(-1)];else{if(Ur(P)!=="object")throw new Error("Don't know what to do with value type "+Ur(P)+".");D=c(P)}X.push(L+D)}return X.push("}"),X.join("")},l=i.__fontmetrics__.uncompress=function(T){if(typeof T!="string")throw new Error("Invalid argument passed to uncompress.");for(var P,L,D,j,X={},Z=1,$=X,ht=[],_t="",Mt="",Nt=T.length-1,Rt=1;Rt<Nt;Rt+=1)(j=T[Rt])=="'"?P?(D=P.join(""),P=void 0):P=[]:P?P.push(j):j=="{"?(ht.push([$,D]),$={},D=void 0):j=="}"?((L=ht.pop())[0][L[1]]=$,D=void 0,$=L[0]):j=="-"?Z=-1:D===void 0?e.hasOwnProperty(j)?(_t+=e[j],D=parseInt(_t,16)*Z,Z=1,_t=""):_t+=j:e.hasOwnProperty(j)?(Mt+=e[j],$[D]=parseInt(Mt,16)*Z,Z=1,D=void 0,Mt=""):Mt+=j;return X},f={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},y={Unicode:{Courier:f,"Courier-Bold":f,"Courier-BoldOblique":f,"Courier-Oblique":f,Helvetica:f,"Helvetica-Bold":f,"Helvetica-BoldOblique":f,"Helvetica-Oblique":f,"Times-Roman":f,"Times-Bold":f,"Times-BoldItalic":f,"Times-Italic":f}},A={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(T){var P=T.font,L=A.Unicode[P.postScriptName];L&&(P.metadata.Unicode={},P.metadata.Unicode.widths=L.widths,P.metadata.Unicode.kerning=L.kerning);var D=y.Unicode[P.postScriptName];D&&(P.metadata.Unicode.encoding=D,P.encoding=D.codePages[0])}])}(Bi.API),function(i){var t=function(e){for(var r=e.length,s=new Uint8Array(r),n=0;n<r;n++)s[n]=e.charCodeAt(n);return s};i.API.events.push(["addFont",function(e){var r=void 0,s=e.font,n=e.instance;if(!s.isStandardFont){if(n===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if(typeof(r=n.existsFileInVFS(s.postScriptName)===!1?n.loadFile(s.postScriptName):n.getFileFromVFS(s.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");(function(c,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(ef(l)),c.metadata=i.API.TTFFont.open(l),c.metadata.Unicode=c.metadata.Unicode||{encoding:{},kerning:{},widths:[]},c.metadata.glyIdsUsed=[0]})(s,r)}}])}(Bi),function(i){function t(){return(Ri.canvg?Promise.resolve(Ri.canvg):Yy(()=>import("./index.es-BWyxJuJN-CymjIt7T-Bk9D95Jk.js"),[])).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}Bi.API.addSvgAsImage=function(e,r,s,n,c,l,f,y){if(isNaN(r)||isNaN(s))throw Yr.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(c))throw Yr.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var A=document.createElement("canvas");A.width=n,A.height=c;var T=A.getContext("2d");T.fillStyle="#fff",T.fillRect(0,0,A.width,A.height);var P={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},L=this;return t().then(function(D){return D.fromString(T,e,P)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(D){return D.render(P)}).then(function(){L.addImage(A.toDataURL("image/jpeg",1),r,s,n,c,f,y)})}}(),Bi.API.putTotalPages=function(i){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(i,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var s=0;s<this.internal.pages[r].length;s++)this.internal.pages[r][s]=this.internal.pages[r][s].replace(t,e);return this},Bi.API.viewerPreferences=function(i,t){var e;i=i||{},t=t||!1;var r,s,n,c={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(c),f=[],y=0,A=0,T=0;function P(D,j){var X,Z=!1;for(X=0;X<D.length;X+=1)D[X]===j&&(Z=!0);return Z}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(c)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,i==="reset"||t===!0){var L=l.length;for(T=0;T<L;T+=1)e[l[T]].value=e[l[T]].defaultValue,e[l[T]].explicitSet=!1}if(Ur(i)==="object"){for(s in i)if(n=i[s],P(l,s)&&n!==void 0){if(e[s].type==="boolean"&&typeof n=="boolean")e[s].value=n;else if(e[s].type==="name"&&P(e[s].valueSet,n))e[s].value=n;else if(e[s].type==="integer"&&Number.isInteger(n))e[s].value=n;else if(e[s].type==="array"){for(y=0;y<n.length;y+=1)if(r=!0,n[y].length===1&&typeof n[y][0]=="number")f.push(String(n[y]-1));else if(n[y].length>1){for(A=0;A<n[y].length;A+=1)typeof n[y][A]!="number"&&(r=!1);r===!0&&f.push([n[y][0]-1,n[y][1]-1].join(" "))}e[s].value="["+f.join(" ")+"]"}else e[s].value=e[s].defaultValue;e[s].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var D,j=[];for(D in e)e[D].explicitSet===!0&&(e[D].type==="name"?j.push("/"+D+" /"+e[D].value):j.push("/"+D+" "+e[D].value));j.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+j.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(i){var t=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',s=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(r)),c=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),f=unescape(encodeURIComponent("</x:xmpmeta>")),y=n.length+c.length+l.length+s.length+f.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+y+" >>"),this.internal.write("stream"),this.internal.write(s+n+c+l+f),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(r,s){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:s||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(Bi.API),function(i){var t=i.API,e=t.pdfEscape16=function(n,c){for(var l,f=c.metadata.Unicode.widths,y=["","0","00","000","0000"],A=[""],T=0,P=n.length;T<P;++T){if(l=c.metadata.characterToGlyph(n.charCodeAt(T)),c.metadata.glyIdsUsed.push(l),c.metadata.toUnicode[l]=n.charCodeAt(T),f.indexOf(l)==-1&&(f.push(l),f.push([parseInt(c.metadata.widthOfGlyph(l),10)])),l=="0")return A.join("");l=l.toString(16),A.push(y[4-l.length],l)}return A.join("")},r=function(n){var c,l,f,y,A,T,P;for(A=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,f=[],T=0,P=(l=Object.keys(n).sort(function(L,D){return L-D})).length;T<P;T++)c=l[T],f.length>=100&&(A+=`
`+f.length+` beginbfchar
`+f.join(`
`)+`
endbfchar`,f=[]),n[c]!==void 0&&n[c]!==null&&typeof n[c].toString=="function"&&(y=("0000"+n[c].toString(16)).slice(-4),c=("0000"+(+c).toString(16)).slice(-4),f.push("<"+c+"><"+y+">"));return f.length&&(A+=`
`+f.length+` beginbfchar
`+f.join(`
`)+`
endbfchar
`),A+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(n){(function(c){var l=c.font,f=c.out,y=c.newObject,A=c.putStream;if(l.metadata instanceof i.API.TTFFont&&l.encoding==="Identity-H"){for(var T=l.metadata.Unicode.widths,P=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),L="",D=0;D<P.length;D++)L+=String.fromCharCode(P[D]);var j=y();A({data:L,addLength1:!0,objectId:j}),f("endobj");var X=y();A({data:r(l.metadata.toUnicode),addLength1:!0,objectId:X}),f("endobj");var Z=y();f("<<"),f("/Type /FontDescriptor"),f("/FontName /"+bd(l.fontName)),f("/FontFile2 "+j+" 0 R"),f("/FontBBox "+i.API.PDFObject.convert(l.metadata.bbox)),f("/Flags "+l.metadata.flags),f("/StemV "+l.metadata.stemV),f("/ItalicAngle "+l.metadata.italicAngle),f("/Ascent "+l.metadata.ascender),f("/Descent "+l.metadata.decender),f("/CapHeight "+l.metadata.capHeight),f(">>"),f("endobj");var $=y();f("<<"),f("/Type /Font"),f("/BaseFont /"+bd(l.fontName)),f("/FontDescriptor "+Z+" 0 R"),f("/W "+i.API.PDFObject.convert(T)),f("/CIDToGIDMap /Identity"),f("/DW 1000"),f("/Subtype /CIDFontType2"),f("/CIDSystemInfo"),f("<<"),f("/Supplement 0"),f("/Registry (Adobe)"),f("/Ordering ("+l.encoding+")"),f(">>"),f(">>"),f("endobj"),l.objectNumber=y(),f("<<"),f("/Type /Font"),f("/Subtype /Type0"),f("/ToUnicode "+X+" 0 R"),f("/BaseFont /"+bd(l.fontName)),f("/Encoding /"+l.encoding),f("/DescendantFonts ["+$+" 0 R]"),f(">>"),f("endobj"),l.isAlreadyPutted=!0}})(n)}]),t.events.push(["putFont",function(n){(function(c){var l=c.font,f=c.out,y=c.newObject,A=c.putStream;if(l.metadata instanceof i.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var T=l.metadata.rawData,P="",L=0;L<T.length;L++)P+=String.fromCharCode(T[L]);var D=y();A({data:P,addLength1:!0,objectId:D}),f("endobj");var j=y();A({data:r(l.metadata.toUnicode),addLength1:!0,objectId:j}),f("endobj");var X=y();f("<<"),f("/Descent "+l.metadata.decender),f("/CapHeight "+l.metadata.capHeight),f("/StemV "+l.metadata.stemV),f("/Type /FontDescriptor"),f("/FontFile2 "+D+" 0 R"),f("/Flags 96"),f("/FontBBox "+i.API.PDFObject.convert(l.metadata.bbox)),f("/FontName /"+bd(l.fontName)),f("/ItalicAngle "+l.metadata.italicAngle),f("/Ascent "+l.metadata.ascender),f(">>"),f("endobj"),l.objectNumber=y();for(var Z=0;Z<l.metadata.hmtx.widths.length;Z++)l.metadata.hmtx.widths[Z]=parseInt(l.metadata.hmtx.widths[Z]*(1e3/l.metadata.head.unitsPerEm));f("<</Subtype/TrueType/Type/Font/ToUnicode "+j+" 0 R/BaseFont/"+bd(l.fontName)+"/FontDescriptor "+X+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),f("endobj"),l.isAlreadyPutted=!0}})(n)}]);var s=function(n){var c,l=n.text||"",f=n.x,y=n.y,A=n.options||{},T=n.mutex||{},P=T.pdfEscape,L=T.activeFontKey,D=T.fonts,j=L,X="",Z=0,$="",ht=D[j].encoding;if(D[j].encoding!=="Identity-H")return{text:l,x:f,y,options:A,mutex:T};for($=l,j=L,Array.isArray(l)&&($=l[0]),Z=0;Z<$.length;Z+=1)D[j].metadata.hasOwnProperty("cmap")&&(c=D[j].metadata.cmap.unicode.codeMap[$[Z].charCodeAt(0)]),c||$[Z].charCodeAt(0)<256&&D[j].metadata.hasOwnProperty("Unicode")?X+=$[Z]:X+="";var _t="";return parseInt(j.slice(1))<14||ht==="WinAnsiEncoding"?_t=P(X,j).split("").map(function(Mt){return Mt.charCodeAt(0).toString(16)}).join(""):ht==="Identity-H"&&(_t=e(X,D[j])),T.isHex=!0,{text:_t,x:f,y,options:A,mutex:T}};t.events.push(["postProcessText",function(n){var c=n.text||"",l=[],f={text:c,x:n.x,y:n.y,options:n.options,mutex:n.mutex};if(Array.isArray(c)){var y=0;for(y=0;y<c.length;y+=1)Array.isArray(c[y])&&c[y].length===3?l.push([s(Object.assign({},f,{text:c[y][0]})).text,c[y][1],c[y][2]]):l.push(s(Object.assign({},f,{text:c[y]})).text);n.text=l}else n.text=s(Object.assign({},f,{text:c})).text}])}(Bi),function(i){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},i.addFileToVFS=function(e,r){return t.call(this),this.internal.vFS[e]=r,this},i.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(Bi.API),function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(r){var s,n,c,l,f,y,A,T=t,P=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],L=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],D={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},j={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},X=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],Z=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),$=!1,ht=0;this.__bidiEngine__={};var _t=function(ct){var pt=ct.charCodeAt(),Bt=pt>>8,bt=j[Bt];return bt!==void 0?T[256*bt+(255&pt)]:Bt===252||Bt===253?"AL":Z.test(Bt)?"L":Bt===8?"R":"N"},Mt=function(ct){for(var pt,Bt=0;Bt<ct.length;Bt++){if((pt=_t(ct.charAt(Bt)))==="L")return!1;if(pt==="R")return!0}return!1},Nt=function(ct,pt,Bt,bt){var ne,oe,le,Qt,fe=pt[bt];switch(fe){case"L":case"R":$=!1;break;case"N":case"AN":break;case"EN":$&&(fe="AN");break;case"AL":$=!0,fe="R";break;case"WS":fe="N";break;case"CS":bt<1||bt+1>=pt.length||(ne=Bt[bt-1])!=="EN"&&ne!=="AN"||(oe=pt[bt+1])!=="EN"&&oe!=="AN"?fe="N":$&&(oe="AN"),fe=oe===ne?oe:"N";break;case"ES":fe=(ne=bt>0?Bt[bt-1]:"B")==="EN"&&bt+1<pt.length&&pt[bt+1]==="EN"?"EN":"N";break;case"ET":if(bt>0&&Bt[bt-1]==="EN"){fe="EN";break}if($){fe="N";break}for(le=bt+1,Qt=pt.length;le<Qt&&pt[le]==="ET";)le++;fe=le<Qt&&pt[le]==="EN"?"EN":"N";break;case"NSM":if(c&&!l){for(Qt=pt.length,le=bt+1;le<Qt&&pt[le]==="NSM";)le++;if(le<Qt){var de=ct[bt],Me=de>=1425&&de<=2303||de===64286;if(ne=pt[le],Me&&(ne==="R"||ne==="AL")){fe="R";break}}}fe=bt<1||(ne=pt[bt-1])==="B"?"N":Bt[bt-1];break;case"B":$=!1,s=!0,fe=ht;break;case"S":n=!0,fe="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":$=!1;break;case"BN":fe="N"}return fe},Rt=function(ct,pt,Bt){var bt=ct.split("");return Bt&&xt(bt,Bt,{hiLevel:ht}),bt.reverse(),pt&&pt.reverse(),bt.join("")},xt=function(ct,pt,Bt){var bt,ne,oe,le,Qt,fe=-1,de=ct.length,Me=0,nt=[],Et=ht?L:P,Lt=[];for($=!1,s=!1,n=!1,ne=0;ne<de;ne++)Lt[ne]=_t(ct[ne]);for(oe=0;oe<de;oe++){if(Qt=Me,nt[oe]=Nt(ct,Lt,nt,oe),bt=240&(Me=Et[Qt][D[nt[oe]]]),Me&=15,pt[oe]=le=Et[Me][5],bt>0)if(bt===16){for(ne=fe;ne<oe;ne++)pt[ne]=1;fe=-1}else fe=-1;if(Et[Me][6])fe===-1&&(fe=oe);else if(fe>-1){for(ne=fe;ne<oe;ne++)pt[ne]=le;fe=-1}Lt[oe]==="B"&&(pt[oe]=0),Bt.hiLevel|=le}n&&function(Gt,Wt,$t){for(var ee=0;ee<$t;ee++)if(Gt[ee]==="S"){Wt[ee]=ht;for(var Kt=ee-1;Kt>=0&&Gt[Kt]==="WS";Kt--)Wt[Kt]=ht}}(Lt,pt,de)},qt=function(ct,pt,Bt,bt,ne){if(!(ne.hiLevel<ct)){if(ct===1&&ht===1&&!s)return pt.reverse(),void(Bt&&Bt.reverse());for(var oe,le,Qt,fe,de=pt.length,Me=0;Me<de;){if(bt[Me]>=ct){for(Qt=Me+1;Qt<de&&bt[Qt]>=ct;)Qt++;for(fe=Me,le=Qt-1;fe<le;fe++,le--)oe=pt[fe],pt[fe]=pt[le],pt[le]=oe,Bt&&(oe=Bt[fe],Bt[fe]=Bt[le],Bt[le]=oe);Me=Qt}Me++}}},zt=function(ct,pt,Bt){var bt=ct.split(""),ne={hiLevel:ht};return Bt||(Bt=[]),xt(bt,Bt,ne),function(oe,le,Qt){if(Qt.hiLevel!==0&&A)for(var fe,de=0;de<oe.length;de++)le[de]===1&&(fe=X.indexOf(oe[de]))>=0&&(oe[de]=X[fe+1])}(bt,Bt,ne),qt(2,bt,pt,Bt,ne),qt(1,bt,pt,Bt,ne),bt.join("")};return this.__bidiEngine__.doBidiReorder=function(ct,pt,Bt){if(function(ne,oe){if(oe)for(var le=0;le<ne.length;le++)oe[le]=le;l===void 0&&(l=Mt(ne)),y===void 0&&(y=Mt(ne))}(ct,pt),c||!f||y)if(c&&f&&l^y)ht=l?1:0,ct=Rt(ct,pt,Bt);else if(!c&&f&&y)ht=l?1:0,ct=zt(ct,pt,Bt),ct=Rt(ct,pt);else if(!c||l||f||y){if(c&&!f&&l^y)ct=Rt(ct,pt),l?(ht=0,ct=zt(ct,pt,Bt)):(ht=1,ct=zt(ct,pt,Bt),ct=Rt(ct,pt));else if(c&&l&&!f&&y)ht=1,ct=zt(ct,pt,Bt),ct=Rt(ct,pt);else if(!c&&!f&&l^y){var bt=A;l?(ht=1,ct=zt(ct,pt,Bt),ht=0,A=!1,ct=zt(ct,pt,Bt),A=bt):(ht=0,ct=zt(ct,pt,Bt),ct=Rt(ct,pt),ht=1,A=!1,ct=zt(ct,pt,Bt),A=bt,ct=Rt(ct,pt))}}else ht=0,ct=zt(ct,pt,Bt);else ht=l?1:0,ct=zt(ct,pt,Bt);return ct},this.__bidiEngine__.setOptions=function(ct){ct&&(c=ct.isInputVisual,f=ct.isOutputVisual,l=ct.isInputRtl,y=ct.isOutputRtl,A=ct.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(r){var s=r.text,n=(r.x,r.y,r.options||{}),c=(r.mutex,n.lang,[]);if(n.isInputVisual=typeof n.isInputVisual!="boolean"||n.isInputVisual,e.setOptions(n),Object.prototype.toString.call(s)==="[object Array]"){var l=0;for(c=[],l=0;l<s.length;l+=1)Object.prototype.toString.call(s[l])==="[object Array]"?c.push([e.doBidiReorder(s[l][0]),s[l][1],s[l][2]]):c.push([e.doBidiReorder(s[l])]);r.text=c}else r.text=e.doBidiReorder(s);e.setOptions({isInputVisual:!0})}])}(Bi),Bi.API.TTFFont=function(){function i(t){var e;if(this.rawData=t,e=this.contents=new Zh(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new LV(this),this.registerTTF()}return i.open=function(t){return new i(t)},i.prototype.parse=function(){return this.directory=new mV(this.contents),this.head=new _V(this),this.name=new AV(this),this.cmap=new CE(this),this.toUnicode={},this.hhea=new vV(this),this.maxp=new SV(this),this.hmtx=new EV(this),this.post=new wV(this),this.os2=new bV(this),this.loca=new IV(this),this.glyf=new CV(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var t,e,r,s,n;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var c,l,f,y;for(y=[],c=0,l=(f=this.bbox).length;c<l;c++)t=f[c],y.push(Math.round(t*this.scaleFactor));return y}).call(this),this.stemV=0,this.post.exists?(r=255&(s=this.post.italic_angle),32768&(e=s>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(n=this.familyClass)===1||n===2||n===3||n===4||n===5||n===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},i.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},i.prototype.widthOfString=function(t,e,r){var s,n,c,l;for(c=0,n=0,l=(t=""+t).length;0<=l?n<l:n>l;n=0<=l?++n:--n)s=t.charCodeAt(n),c+=this.widthOfGlyph(this.characterToGlyph(s))+r*(1e3/e)||0;return c*(e/1e3)},i.prototype.lineHeight=function(t,e){var r;return e==null&&(e=!1),r=e?this.lineGap:0,(this.ascender+r-this.decender)/1e3*t},i}();var Cl,Zh=function(){function i(t){this.data=t??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(t){return this.data[this.pos++]=t},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},i.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},i.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},i.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},i.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},i.prototype.readString=function(t){var e,r;for(r=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)r[e]=String.fromCharCode(this.readByte());return r.join("")},i.prototype.writeString=function(t){var e,r,s;for(s=[],e=0,r=t.length;0<=r?e<r:e>r;e=0<=r?++e:--e)s.push(this.writeByte(t.charCodeAt(e)));return s},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(t){return this.writeInt16(t)},i.prototype.readLongLong=function(){var t,e,r,s,n,c,l,f;return t=this.readByte(),e=this.readByte(),r=this.readByte(),s=this.readByte(),n=this.readByte(),c=this.readByte(),l=this.readByte(),f=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^r)+4294967296*(255^s)+16777216*(255^n)+65536*(255^c)+256*(255^l)+(255^f)+1):72057594037927940*t+281474976710656*e+1099511627776*r+4294967296*s+16777216*n+65536*c+256*l+f},i.prototype.writeLongLong=function(t){var e,r;return e=Math.floor(t/4294967296),r=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(t){return this.writeInt32(t)},i.prototype.read=function(t){var e,r;for(e=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)e.push(this.readByte());return e},i.prototype.write=function(t){var e,r,s,n;for(n=[],r=0,s=t.length;r<s;r++)e=t[r],n.push(this.writeByte(e));return n},i}(),mV=function(){var i;function t(e){var r,s,n;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},s=0,n=this.tableCount;0<=n?s<n:s>n;s=0<=n?++s:--s)r={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[r.tag]=r}return t.prototype.encode=function(e){var r,s,n,c,l,f,y,A,T,P,L,D,j;for(j in L=Object.keys(e).length,f=Math.log(2),T=16*Math.floor(Math.log(L)/f),c=Math.floor(T/f),A=16*L-T,(s=new Zh).writeInt(this.scalarType),s.writeShort(L),s.writeShort(T),s.writeShort(c),s.writeShort(A),n=16*L,y=s.pos+n,l=null,D=[],e)for(P=e[j],s.writeString(j),s.writeInt(i(P)),s.writeInt(y),s.writeInt(P.length),D=D.concat(P),j==="head"&&(l=y),y+=P.length;y%4;)D.push(0),y++;return s.write(D),r=2981146554-i(s.data),s.pos=l+8,s.writeUInt32(r),s.data},i=function(e){var r,s,n,c;for(e=TE.call(e);e.length%4;)e.push(0);for(n=new Zh(e),s=0,r=0,c=e.length;r<c;r=r+=4)s+=n.readUInt32();return 4294967295&s},t}(),yV={}.hasOwnProperty,pc=function(i,t){for(var e in t)yV.call(t,e)&&(i[e]=t[e]);function r(){this.constructor=i}return r.prototype=t.prototype,i.prototype=new r,i.__super__=t.prototype,i};Cl=function(){function i(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i}();var _V=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var r;return(r=new Zh).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(e),r.writeShort(this.glyphDataFormat),r.data},t}(),X5=function(){function i(t,e){var r,s,n,c,l,f,y,A,T,P,L,D,j,X,Z,$,ht;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),T=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(f=0;f<256;++f)this.codeMap[f]=t.readByte();break;case 4:for(L=t.readUInt16(),P=L/2,t.pos+=6,n=function(){var _t,Mt;for(Mt=[],f=_t=0;0<=P?_t<P:_t>P;f=0<=P?++_t:--_t)Mt.push(t.readUInt16());return Mt}(),t.pos+=2,j=function(){var _t,Mt;for(Mt=[],f=_t=0;0<=P?_t<P:_t>P;f=0<=P?++_t:--_t)Mt.push(t.readUInt16());return Mt}(),y=function(){var _t,Mt;for(Mt=[],f=_t=0;0<=P?_t<P:_t>P;f=0<=P?++_t:--_t)Mt.push(t.readUInt16());return Mt}(),A=function(){var _t,Mt;for(Mt=[],f=_t=0;0<=P?_t<P:_t>P;f=0<=P?++_t:--_t)Mt.push(t.readUInt16());return Mt}(),s=(this.length-t.pos+this.offset)/2,l=function(){var _t,Mt;for(Mt=[],f=_t=0;0<=s?_t<s:_t>s;f=0<=s?++_t:--_t)Mt.push(t.readUInt16());return Mt}(),f=Z=0,ht=n.length;Z<ht;f=++Z)for(X=n[f],r=$=D=j[f];D<=X?$<=X:$>=X;r=D<=X?++$:--$)A[f]===0?c=r+y[f]:(c=l[A[f]/2+(r-D)-(P-f)]||0)!==0&&(c+=y[f]),this.codeMap[r]=65535&c}t.pos=T}return i.encode=function(t,e){var r,s,n,c,l,f,y,A,T,P,L,D,j,X,Z,$,ht,_t,Mt,Nt,Rt,xt,qt,zt,ct,pt,Bt,bt,ne,oe,le,Qt,fe,de,Me,nt,Et,Lt,Gt,Wt,$t,ee,Kt,Ce,Ie,Re;switch(bt=new Zh,c=Object.keys(t).sort(function(Fe,Ze){return Fe-Ze}),e){case"macroman":for(j=0,X=function(){var Fe=[];for(D=0;D<256;++D)Fe.push(0);return Fe}(),$={0:0},n={},ne=0,fe=c.length;ne<fe;ne++)$[Kt=t[s=c[ne]]]==null&&($[Kt]=++j),n[s]={old:t[s],new:$[t[s]]},X[s]=$[t[s]];return bt.writeUInt16(1),bt.writeUInt16(0),bt.writeUInt32(12),bt.writeUInt16(0),bt.writeUInt16(262),bt.writeUInt16(0),bt.write(X),{charMap:n,subtable:bt.data,maxGlyphID:j+1};case"unicode":for(pt=[],T=[],ht=0,$={},r={},Z=y=null,oe=0,de=c.length;oe<de;oe++)$[Mt=t[s=c[oe]]]==null&&($[Mt]=++ht),r[s]={old:Mt,new:$[Mt]},l=$[Mt]-s,Z!=null&&l===y||(Z&&T.push(Z),pt.push(s),y=l),Z=s;for(Z&&T.push(Z),T.push(65535),pt.push(65535),zt=2*(qt=pt.length),xt=2*Math.pow(Math.log(qt)/Math.LN2,2),P=Math.log(xt/2)/Math.LN2,Rt=2*qt-xt,f=[],Nt=[],L=[],D=le=0,Me=pt.length;le<Me;D=++le){if(ct=pt[D],A=T[D],ct===65535){f.push(0),Nt.push(0);break}if(ct-(Bt=r[ct].new)>=32768)for(f.push(0),Nt.push(2*(L.length+qt-D)),s=Qt=ct;ct<=A?Qt<=A:Qt>=A;s=ct<=A?++Qt:--Qt)L.push(r[s].new);else f.push(Bt-ct),Nt.push(0)}for(bt.writeUInt16(3),bt.writeUInt16(1),bt.writeUInt32(12),bt.writeUInt16(4),bt.writeUInt16(16+8*qt+2*L.length),bt.writeUInt16(0),bt.writeUInt16(zt),bt.writeUInt16(xt),bt.writeUInt16(P),bt.writeUInt16(Rt),$t=0,nt=T.length;$t<nt;$t++)s=T[$t],bt.writeUInt16(s);for(bt.writeUInt16(0),ee=0,Et=pt.length;ee<Et;ee++)s=pt[ee],bt.writeUInt16(s);for(Ce=0,Lt=f.length;Ce<Lt;Ce++)l=f[Ce],bt.writeUInt16(l);for(Ie=0,Gt=Nt.length;Ie<Gt;Ie++)_t=Nt[Ie],bt.writeUInt16(_t);for(Re=0,Wt=L.length;Re<Wt;Re++)j=L[Re],bt.writeUInt16(j);return{charMap:r,subtable:bt.data,maxGlyphID:ht+1}}},i}(),CE=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="cmap",t.prototype.parse=function(e){var r,s,n;for(e.pos=this.offset,this.version=e.readUInt16(),n=e.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)r=new X5(e,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},t.encode=function(e,r){var s,n;return r==null&&(r="macroman"),s=X5.encode(e,r),(n=new Zh).writeUInt16(0),n.writeUInt16(1),s.table=n.data.concat(s.subtable),s},t}(),vV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),bV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var r,s;for(s=[],r=0;r<10;++r)s.push(e.readByte());return s}(),this.charRange=function(){var r,s;for(s=[],r=0;r<4;++r)s.push(e.readInt());return s}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var r,s;for(s=[],r=0;r<2;r=++r)s.push(e.readInt());return s}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),wV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="post",t.prototype.parse=function(e){var r,s,n;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var c;for(s=e.readUInt16(),this.glyphNameIndex=[],c=0;0<=s?c<s:c>s;c=0<=s?++c:--c)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],n=[];e.pos<this.offset+this.length;)r=e.readByte(),n.push(this.names.push(e.readString(r)));return n;case 151552:return s=e.readUInt16(),this.offsets=e.read(s);case 196608:break;case 262144:return this.map=(function(){var l,f,y;for(y=[],c=l=0,f=this.file.maxp.numGlyphs;0<=f?l<f:l>f;c=0<=f?++l:--l)y.push(e.readUInt32());return y}).call(this)}},t}(),xV=function(i,t){this.raw=i,this.length=i.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},AV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="name",t.prototype.parse=function(e){var r,s,n,c,l,f,y,A,T,P,L;for(e.pos=this.offset,e.readShort(),r=e.readShort(),f=e.readShort(),s=[],c=0;0<=r?c<r:c>r;c=0<=r?++c:--c)s.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+f+e.readShort()});for(y={},c=T=0,P=s.length;T<P;c=++T)n=s[c],e.pos=n.offset,A=e.readString(n.length),l=new xV(A,n),y[L=n.nameID]==null&&(y[L]=[]),y[n.nameID].push(l);this.strings=y,this.copyright=y[0],this.fontFamily=y[1],this.fontSubfamily=y[2],this.uniqueSubfamily=y[3],this.fontName=y[4],this.version=y[5];try{this.postscriptName=y[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=y[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=y[7],this.manufacturer=y[8],this.designer=y[9],this.description=y[10],this.vendorUrl=y[11],this.designerUrl=y[12],this.license=y[13],this.licenseUrl=y[14],this.preferredFamily=y[15],this.preferredSubfamily=y[17],this.compatibleFull=y[18],this.sampleText=y[19]},t}(),SV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),EV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="hmtx",t.prototype.parse=function(e){var r,s,n,c,l,f,y;for(e.pos=this.offset,this.metrics=[],r=0,f=this.file.hhea.numberOfMetrics;0<=f?r<f:r>f;r=0<=f?++r:--r)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(n=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var A,T;for(T=[],r=A=0;0<=n?A<n:A>n;r=0<=n?++A:--A)T.push(e.readInt16());return T}(),this.widths=(function(){var A,T,P,L;for(L=[],A=0,T=(P=this.metrics).length;A<T;A++)c=P[A],L.push(c.advance);return L}).call(this),s=this.widths[this.widths.length-1],y=[],r=l=0;0<=n?l<n:l>n;r=0<=n?++l:--l)y.push(this.widths.push(s));return y},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),TE=[].slice,CV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var r,s,n,c,l,f,y,A,T,P;return e in this.cache?this.cache[e]:(c=this.file.loca,r=this.file.contents,s=c.indexOf(e),(n=c.lengthOf(e))===0?this.cache[e]=null:(r.pos=this.offset+s,l=(f=new Zh(r.read(n))).readShort(),A=f.readShort(),P=f.readShort(),y=f.readShort(),T=f.readShort(),this.cache[e]=l===-1?new PV(f,A,P,y,T):new TV(f,l,A,P,y,T),this.cache[e]))},t.prototype.encode=function(e,r,s){var n,c,l,f,y;for(l=[],c=[],f=0,y=r.length;f<y;f++)n=e[r[f]],c.push(l.length),n&&(l=l.concat(n.encode(s)));return c.push(l.length),{table:l,offsets:c}},t}(),TV=function(){function i(t,e,r,s,n,c){this.raw=t,this.numberOfContours=e,this.xMin=r,this.yMin=s,this.xMax=n,this.yMax=c,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i}(),PV=function(){function i(t,e,r,s,n){var c,l;for(this.raw=t,this.xMin=e,this.yMin=r,this.xMax=s,this.yMax=n,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],c=this.raw;l=c.readShort(),this.glyphOffsets.push(c.pos),this.glyphIDs.push(c.readUInt16()),32&l;)c.pos+=1&l?4:2,128&l?c.pos+=8:64&l?c.pos+=4:8&l&&(c.pos+=2)}return i.prototype.encode=function(){var t,e,r;for(e=new Zh(TE.call(this.raw.data)),t=0,r=this.glyphIDs.length;t<r;++t)e.pos=this.glyphOffsets[t];return e.data},i}(),IV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Cl),t.prototype.tag="loca",t.prototype.parse=function(e){var r,s;return e.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var n,c;for(c=[],s=0,n=this.length;s<n;s+=2)c.push(2*e.readUInt16());return c}).call(this):(function(){var n,c;for(c=[],s=0,n=this.length;s<n;s+=4)c.push(e.readUInt32());return c}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,r){for(var s=new Uint32Array(this.offsets.length),n=0,c=0,l=0;l<s.length;++l)if(s[l]=n,c<r.length&&r[c]==l){++c,s[l]=n;var f=this.offsets[l],y=this.offsets[l+1]-f;y>0&&(n+=y)}for(var A=new Array(4*s.length),T=0;T<s.length;++T)A[4*T+3]=255&s[T],A[4*T+2]=(65280&s[T])>>8,A[4*T+1]=(16711680&s[T])>>16,A[4*T]=(4278190080&s[T])>>24;return A},t}(),LV=function(){function i(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var t,e,r,s,n;for(e in s=this.font.cmap.tables[0].codeMap,t={},n=this.subset)r=n[e],t[e]=s[r];return t},i.prototype.glyphsFor=function(t){var e,r,s,n,c,l,f;for(s={},c=0,l=t.length;c<l;c++)s[n=t[c]]=this.font.glyf.glyphFor(n);for(n in e=[],s)(r=s[n])!=null&&r.compound&&e.push.apply(e,r.glyphIDs);if(e.length>0)for(n in f=this.glyphsFor(e))r=f[n],s[n]=r;return s},i.prototype.encode=function(t,e){var r,s,n,c,l,f,y,A,T,P,L,D,j,X,Z;for(s in r=CE.encode(this.generateCmap(),"unicode"),c=this.glyphsFor(t),L={0:0},Z=r.charMap)L[(f=Z[s]).old]=f.new;for(D in P=r.maxGlyphID,c)D in L||(L[D]=P++);return A=function($){var ht,_t;for(ht in _t={},$)_t[$[ht]]=ht;return _t}(L),T=Object.keys(A).sort(function($,ht){return $-ht}),j=function(){var $,ht,_t;for(_t=[],$=0,ht=T.length;$<ht;$++)l=T[$],_t.push(A[l]);return _t}(),n=this.font.glyf.encode(c,j,L),y=this.font.loca.encode(n.offsets,j),X={cmap:this.font.cmap.raw(),glyf:n.table,loca:y,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(X["OS/2"]=this.font.os2.raw()),this.font.directory.encode(X)},i}();Bi.API.PDFObject=function(){var i;function t(){}return i=function(e,r){return(Array(r+1).join("0")+e).slice(-r)},t.convert=function(e){var r,s,n,c;if(Array.isArray(e))return"["+function(){var l,f,y;for(y=[],l=0,f=e.length;l<f;l++)r=e[l],y.push(t.convert(r));return y}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+i(e.getUTCFullYear(),4)+i(e.getUTCMonth(),2)+i(e.getUTCDate(),2)+i(e.getUTCHours(),2)+i(e.getUTCMinutes(),2)+i(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(s in n=["<<"],e)c=e[s],n.push("/"+s+" "+t.convert(c));return n.push(">>"),n.join(`
`)}return""+e},t}();const Iv={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},Lv={textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]};class MV{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cu.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:zc.PNG,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Jd.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Iv,y=arguments.length>8&&arguments[8]!==void 0?arguments[8]:"maplibregl-ctrl-attrib-inner",A=arguments.length>9&&arguments[9]!==void 0?arguments[9]:Lv;wr(this,"map"),wr(this,"width"),wr(this,"height"),wr(this,"dpi"),wr(this,"format"),wr(this,"unit"),wr(this,"fileName"),wr(this,"markerClassName"),wr(this,"markerCirclePaint"),wr(this,"attributionClassName"),wr(this,"attributionStyle"),this.map=t,this.width=e[0],this.height=e[1],this.dpi=r,this.format=s,this.unit=n,this.fileName=c,this.markerClassName=l,this.markerCirclePaint=f,this.attributionClassName=y,this.attributionStyle=A}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const e=this.getMarkers();for(let r=0;r<e.length;r++){const s=e.item(r);if(!s)continue;const n=s.getAttribute("style");if(!n)continue;const c=/translate\(([^,]+)px,\s*([^,]+)px\)/,l=n.match(c);if(!l)continue;const f=parseInt(l[1]),y=parseInt(l[2]),A=this.map.unproject([f,y]),T=`point${r}`;t.addSource(T,{type:"geojson",data:{type:"Point",coordinates:[A.lng,A.lat]}}),t.addLayer({id:T,source:T,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const e=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const r=document.createElement("div");r.className="hidden-map",document.body.appendChild(r);const s=document.createElement("div");s.style.width=this.toPixels(this.width),s.style.height=this.toPixels(this.height),r.appendChild(s);const n=this.map.getStyle();if(n&&n.sources){const l=n.sources;Object.keys(l).forEach(f=>{const y=l[f];Object.keys(y).forEach(A=>{y[A]||delete y[A]})})}let c=this.getRenderedMap(s,n);c.once("idle",()=>{this.addAttributions(c)?c.once("idle",()=>{c=this.renderMapPost(c),this.getMarkers().length===0?this.exportImage(c,r,e):(c=this.renderMarkers(c),c.once("idle",()=>{this.exportImage(c,r,e)}))}):(c=this.renderMapPost(c),this.getMarkers().length===0?this.exportImage(c,r,e):(c=this.renderMarkers(c),c.once("idle",()=>{this.exportImage(c,r,e)})))})}stripHtml(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}addAttributions(t){if(!this.map.getStyle().glyphs)return!1;const e=t.getContainer(),r=parseInt(e.style.width.replace("px",""))-5,s=parseInt(e.style.height.replace("px",""))-5,n=[r,s],c=t.unproject(n),l=e.getElementsByClassName(this.attributionClassName),f=[];if((l==null?void 0:l.length)>0){const L=l.item(0);if(L)for(let D=0;D<L.children.length;D++){const j=L.children.item(D);j&&f.push(this.stripHtml(j.outerHTML))}}else{const L=this.map.getStyle().sources;Object.keys(L).forEach(D=>{const j=L[D];if("attribution"in j){const X=j.attribution;f.push(this.stripHtml(X))}})}if(f.length===0)return!1;const y=f.join(" | "),A="attribution";t.addSource(A,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[c.lng,c.lat]},properties:{attribution:y}}});const T=this.map.getStyle().layers.filter(L=>L.type==="symbol"&&L.layout&&"text-font"in L.layout),P=T.length>0&&T[0].layout?T[0].layout["text-font"]:this.attributionStyle.fallbackTextFont;return t.addLayer({id:A,source:A,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":P,"text-max-width":parseInt(`${r/this.attributionStyle.textSize}`),"text-anchor":"bottom-right","text-justify":"right","text-size":this.attributionStyle.textSize},paint:{"text-halo-color":this.attributionStyle.textHaloColor,"text-halo-width":this.attributionStyle.textHaloWidth,"text-color":this.attributionStyle.textColor}}),!0}exportImage(t,e,r){var s;const n=t.getCanvas(),c=`${this.fileName}.${this.format}`;switch(this.format){case zc.PNG:this.toPNG(n,c);break;case zc.JPEG:this.toJPEG(n,c);break;case zc.PDF:this.toPDF(t,c);break;case zc.SVG:this.toSVG(n,c);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(s=e.parentNode)==null||s.removeChild(e),Object.defineProperty(window,"devicePixelRatio",{get(){return r}}),e.remove(),JsLoadingOverlay.hide()}toPNG(t,e){const r=document.createElement("a");r.href=t.toDataURL(),r.download=e,r.click(),r.remove()}toJPEG(t,e){const r=t.toDataURL("image/jpeg",.85),s=document.createElement("a");s.href=r,s.download=e,s.click(),s.remove()}toPDF(t,e){const r=t.getCanvas(),s=new Bi({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});s.addImage(r.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:n,lat:c}=t.getCenter();s.setProperties({title:t.getStyle().name,subject:`center: [${n}, ${c}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),s.save(e)}toSVG(t,e){const r=t.toDataURL("image/png"),s=Number(this.toPixels(this.width,this.dpi).replace("px","")),n=Number(this.toPixels(this.height,this.dpi).replace("px","")),c=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${s}" 
      height="${n}" 
      viewBox="0 0 ${s} ${n}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${r}" width="${s}" height="${n}"></image>
    </svg>`,l=document.createElement("a");l.href=`data:application/xml,${encodeURIComponent(c)}`,l.download=e,l.click(),l.remove()}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Jd.mm&&(e/=25.4),`${e*t}px`}}class BV extends MV{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cu.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:zc.PNG,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Jd.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Iv,f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Lv;super(t,e,r,s,n,c,"maplibregl-marker",l,"maplibregl-ctrl-attrib-inner",f)}getRenderedMap(t,e){const r=new fA.Map({container:t,style:e,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(r.setMaxPitch(85),r.setPitch(this.map.getPitch()));const s=(this.map.style.imageManager||{}).images||[];return Object.keys(s).forEach(n=>{r.addImage(n,s[n].data)}),r}renderMapPost(t){const e=this.map.getTerrain();return e&&t.setTerrain({source:e.source,exaggeration:e.exaggeration}),t}}class RV{constructor(t){wr(this,"controlContainer"),wr(this,"exportContainer"),wr(this,"crosshair"),wr(this,"printableArea"),wr(this,"map"),wr(this,"exportButton"),wr(this,"options",{PageSize:Cu.A4,PageOrientation:Wp.Landscape,Format:zc.PDF,DPI:q1[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Cu),Filename:"map",markerCirclePaint:Iv,attributionStyle:Lv}),wr(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return kG(t)}onAdd(t){var e;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const r=document.createElement("TABLE");r.className="print-table";const s={};(e=this.options.AllowedSizes)==null||e.forEach(A=>{Cu[A]&&(s[A]=Cu[A])});const n=this.createSelection(s,this.getTranslation().PageSize,"page-size",this.options.PageSize,(A,T)=>JSON.stringify(A[T]));r.appendChild(n);const c=this.createSelection(Wp,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(A,T)=>A[T]);r.appendChild(c);const l=this.createSelection(zc,this.getTranslation().Format,"format-type",this.options.Format,(A,T)=>A[T]);r.appendChild(l);const f=this.createSelection(q1,this.getTranslation().DPI,"dpi-type",this.options.DPI,(A,T)=>A[T]);r.appendChild(f),this.exportContainer.appendChild(r);const y=document.createElement("button");return y.type="button",y.textContent=this.getTranslation().Generate,y.classList.add("generate-button"),y.addEventListener("click",()=>{const A=document.getElementById("mapbox-gl-export-page-size"),T=document.getElementById("mapbox-gl-export-page-orientation"),P=document.getElementById("mapbox-gl-export-format-type"),L=document.getElementById("mapbox-gl-export-dpi-type"),D=T.value;let j=JSON.parse(A.value);D===Wp.Portrait&&(j=j.reverse()),this.generateMap(t,j,Number(L.value),P.value,Jd.mm,this.options.Filename)}),this.exportContainer.appendChild(y),this.controlContainer}generateMap(t,e,r,s,n,c){new BV(t,e,r,s,n,c,this.options.markerCirclePaint,this.options.attributionStyle).generate()}createSelection(t,e,r,s,n){const c=document.createElement("label");c.textContent=e;const l=document.createElement("select");l.setAttribute("id",`mapbox-gl-export-${r}`),l.style.width="100%",Object.keys(t).forEach(T=>{const P=document.createElement("option");P.setAttribute("value",n(t,T)),P.appendChild(document.createTextNode(T)),P.setAttribute("name",r),s===t[T]&&(P.selected=!0),l.appendChild(P)}),l.addEventListener("change",()=>{this.updatePrintableArea()});const f=document.createElement("TR"),y=document.createElement("TD"),A=document.createElement("TD");return y.appendChild(c),A.appendChild(l),f.appendChild(y),f.appendChild(A),f}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new vG(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new bG(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),e=document.getElementById("mapbox-gl-export-page-orientation").value;let r=JSON.parse(t.value);e===Wp.Portrait&&(r=r.reverse()),this.printableArea.updateArea(r[0],r[1])}}var PE=OV,kV=Object.prototype.hasOwnProperty;function OV(){for(var i={},t=0;t<arguments.length;t++){var e=arguments[t];for(var r in e)kV.call(e,r)&&(i[r]=e[r])}return i}var IE={exports:{}};(function(i,t){(function(){var e={};i.exports=e,e.simpleFilter=function(r,s){return s.filter(function(n){return e.test(r,n)})},e.test=function(r,s){return e.match(r,s)!==null},e.match=function(r,s,n){n=n||{};var c=0,l=[],f=s.length,y=0,A=0,T=n.pre||"",P=n.post||"",L=n.caseSensitive&&s||s.toLowerCase(),D;r=n.caseSensitive&&r||r.toLowerCase();for(var j=0;j<f;j++)D=s[j],L[j]===r[c]?(D=T+D+P,c+=1,A+=1+A):A=0,y+=A,l[l.length]=D;return c===r.length?(y=L===r?1/0:y,{rendered:l.join(""),score:y}):null},e.filter=function(r,s,n){return!s||s.length===0?[]:typeof r!="string"?s:(n=n||{},s.reduce(function(c,l,f,y){var A=l;n.extract&&(A=n.extract(l));var T=e.match(r,A,n);return T!=null&&(c[c.length]={string:T.rendered,score:T.score,index:f,original:l}),c},[]).sort(function(c,l){var f=l.score-c.score;return f||c.index-l.index}))}})()})(IE);var FV=IE.exports,qo=function(i){return this.component=i,this.items=[],this.active=i.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};qo.prototype.show=function(){this.element.style.display="block"};qo.prototype.hide=function(){this.element.style.display="none"};qo.prototype.add=function(i){this.items.push(i)};qo.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0};qo.prototype.isEmpty=function(){return!this.items.length};qo.prototype.isVisible=function(){return this.element.style.display==="block"};qo.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()};qo.prototype.drawItem=function(i,t){var e=document.createElement("li"),r=document.createElement("a");t&&(e.className+=" active"),r.innerHTML=i.string,e.appendChild(r),this.element.appendChild(e),e.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),e.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,i)}).bind(this))};qo.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()};qo.prototype.move=function(i){this.active=i,this.draw()};qo.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)};qo.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)};qo.prototype.drawError=function(i){var t=document.createElement("li");t.innerHTML=i,this.element.appendChild(t),this.show()};var NV=qo,DV=PE,zV=FV,UV=NV,Yn=function(i,t,e){return e=e||{},this.options=DV({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},e),this.el=i,this.data=t||[],this.list=new UV(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode,r)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Yn.prototype.handleKeyUp=function(i,t){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}};Yn.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Yn.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Yn.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(i.target.value)},100)}};Yn.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}).bind(this))};Yn.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Yn.prototype.update=function(i){this.data=i,this.handleKeyUp()};Yn.prototype.clear=function(){this.data=[],this.list.clear()};Yn.prototype.normalize=function(i){return i=i.toLowerCase(),i};Yn.prototype.match=function(i,t){return i.indexOf(t)>-1};Yn.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Yn.prototype.getCandidates=function(i){var t={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},e;this.options.filter?(e=zV.filter(this.query,this.data,t),e=e.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):e=this.data.map((function(r){var s=this.render(r);return{original:r,string:s}}).bind(this)),i(e)};Yn.prototype.getItemValue=function(i){return i};Yn.prototype.render=function(i,t){if(t)return t;for(var e=i.original?this.getItemValue(i.original):this.getItemValue(i),r=this.normalize(e),s=r.lastIndexOf(this.query);s>-1;){var n=s+this.query.length;e=e.slice(0,s)+"<strong>"+e.slice(s,n)+"</strong>"+e.slice(n),s=r.slice(0,s).lastIndexOf(this.query)}return e};Yn.prototype.renderError=function(i){this.list.drawError(i)};var jV=Yn,LE=jV,GV=LE;typeof window<"u"&&(window.Suggestions=LE);var VV="Expected a function",Z5=NaN,qV="[object Symbol]",HV=/^\s+|\s+$/g,WV=/^[-+]0x[0-9a-f]+$/i,JV=/^0b[01]+$/i,XV=/^0o[0-7]+$/i,ZV=parseInt,$V=typeof wd=="object"&&wd&&wd.Object===Object&&wd,YV=typeof self=="object"&&self&&self.Object===Object&&self,KV=$V||YV||Function("return this")(),QV=Object.prototype,tq=QV.toString,eq=Math.max,iq=Math.min,Wy=function(){return KV.Date.now()};function rq(i,t,e){var r,s,n,c,l,f,y=0,A=!1,T=!1,P=!0;if(typeof i!="function")throw new TypeError(VV);t=$5(t)||0,r_(e)&&(A=!!e.leading,T="maxWait"in e,n=T?eq($5(e.maxWait)||0,t):n,P="trailing"in e?!!e.trailing:P);function L(Nt){var Rt=r,xt=s;return r=s=void 0,y=Nt,c=i.apply(xt,Rt),c}function D(Nt){return y=Nt,l=setTimeout(Z,t),A?L(Nt):c}function j(Nt){var Rt=Nt-f,xt=Nt-y,qt=t-Rt;return T?iq(qt,n-xt):qt}function X(Nt){var Rt=Nt-f,xt=Nt-y;return f===void 0||Rt>=t||Rt<0||T&&xt>=n}function Z(){var Nt=Wy();if(X(Nt))return $(Nt);l=setTimeout(Z,j(Nt))}function $(Nt){return l=void 0,P&&r?L(Nt):(r=s=void 0,c)}function ht(){l!==void 0&&clearTimeout(l),y=0,r=f=s=l=void 0}function _t(){return l===void 0?c:$(Wy())}function Mt(){var Nt=Wy(),Rt=X(Nt);if(r=arguments,s=this,f=Nt,Rt){if(l===void 0)return D(f);if(T)return l=setTimeout(Z,t),L(f)}return l===void 0&&(l=setTimeout(Z,t)),c}return Mt.cancel=ht,Mt.flush=_t,Mt}function r_(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function sq(i){return!!i&&typeof i=="object"}function nq(i){return typeof i=="symbol"||sq(i)&&tq.call(i)==qV}function $5(i){if(typeof i=="number")return i;if(nq(i))return Z5;if(r_(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=r_(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(HV,"");var e=JV.test(i);return e||XV.test(i)?ZV(i.slice(2),e?2:8):WV.test(i)?Z5:+i}var oq=rq,Mv={exports:{}},Fd=typeof Reflect=="object"?Reflect:null,Y5=Fd&&typeof Fd.apply=="function"?Fd.apply:function(i,t,e){return Function.prototype.apply.call(i,t,e)},rm;Fd&&typeof Fd.ownKeys=="function"?rm=Fd.ownKeys:Object.getOwnPropertySymbols?rm=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:rm=function(i){return Object.getOwnPropertyNames(i)};function aq(i){console&&console.warn&&console.warn(i)}var ME=Number.isNaN||function(i){return i!==i};function Wr(){Wr.init.call(this)}Mv.exports=Wr;Mv.exports.once=uq;Wr.EventEmitter=Wr;Wr.prototype._events=void 0;Wr.prototype._eventsCount=0;Wr.prototype._maxListeners=void 0;var K5=10;function Wm(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Wr,"defaultMaxListeners",{enumerable:!0,get:function(){return K5},set:function(i){if(typeof i!="number"||i<0||ME(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");K5=i}});Wr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Wr.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||ME(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function BE(i){return i._maxListeners===void 0?Wr.defaultMaxListeners:i._maxListeners}Wr.prototype.getMaxListeners=function(){return BE(this)};Wr.prototype.emit=function(i){for(var t=[],e=1;e<arguments.length;e++)t.push(arguments[e]);var r=i==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var n;if(t.length>0&&(n=t[0]),n instanceof Error)throw n;var c=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw c.context=n,c}var l=s[i];if(l===void 0)return!1;if(typeof l=="function")Y5(l,this,t);else for(var f=l.length,y=NE(l,f),e=0;e<f;++e)Y5(y[e],this,t);return!0};function RE(i,t,e,r){var s,n,c;if(Wm(e),n=i._events,n===void 0?(n=i._events=Object.create(null),i._eventsCount=0):(n.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),n=i._events),c=n[t]),c===void 0)c=n[t]=e,++i._eventsCount;else if(typeof c=="function"?c=n[t]=r?[e,c]:[c,e]:r?c.unshift(e):c.push(e),s=BE(i),s>0&&c.length>s&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=i,l.type=t,l.count=c.length,aq(l)}return i}Wr.prototype.addListener=function(i,t){return RE(this,i,t,!1)};Wr.prototype.on=Wr.prototype.addListener;Wr.prototype.prependListener=function(i,t){return RE(this,i,t,!0)};function lq(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function kE(i,t,e){var r={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},s=lq.bind(r);return s.listener=e,r.wrapFn=s,s}Wr.prototype.once=function(i,t){return Wm(t),this.on(i,kE(this,i,t)),this};Wr.prototype.prependOnceListener=function(i,t){return Wm(t),this.prependListener(i,kE(this,i,t)),this};Wr.prototype.removeListener=function(i,t){var e,r,s,n,c;if(Wm(t),r=this._events,r===void 0)return this;if(e=r[i],e===void 0)return this;if(e===t||e.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[i],r.removeListener&&this.emit("removeListener",i,e.listener||t));else if(typeof e!="function"){for(s=-1,n=e.length-1;n>=0;n--)if(e[n]===t||e[n].listener===t){c=e[n].listener,s=n;break}if(s<0)return this;s===0?e.shift():cq(e,s),e.length===1&&(r[i]=e[0]),r.removeListener!==void 0&&this.emit("removeListener",i,c||t)}return this};Wr.prototype.off=Wr.prototype.removeListener;Wr.prototype.removeAllListeners=function(i){var t,e,r;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[i]),this;if(arguments.length===0){var s=Object.keys(e),n;for(r=0;r<s.length;++r)n=s[r],n!=="removeListener"&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=e[i],typeof t=="function")this.removeListener(i,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(i,t[r]);return this};function OE(i,t,e){var r=i._events;if(r===void 0)return[];var s=r[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?hq(s):NE(s,s.length)}Wr.prototype.listeners=function(i){return OE(this,i,!0)};Wr.prototype.rawListeners=function(i){return OE(this,i,!1)};Wr.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):FE.call(i,t)};Wr.prototype.listenerCount=FE;function FE(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Wr.prototype.eventNames=function(){return this._eventsCount>0?rm(this._events):[]};function NE(i,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=i[r];return e}function cq(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function hq(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function uq(i,t){return new Promise(function(e,r){function s(c){i.removeListener(t,n),r(c)}function n(){typeof i.removeListener=="function"&&i.removeListener("error",s),e([].slice.call(arguments))}DE(i,t,n,{once:!0}),t!=="error"&&dq(i,s,{once:!0})})}function dq(i,t,e){typeof i.on=="function"&&DE(i,"error",t,e)}function DE(i,t,e,r){if(typeof i.on=="function")r.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function s(n){r.once&&i.removeEventListener(t,s),e(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var zE=Mv.exports,pq={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},fq={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},gq={placeholder:fq},UE={exports:{}};(function(i){(function(t,e,r){i.exports?i.exports=r():t[e]=r()})(wd,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(f){return f.match(e)||[]}function s(f){return r(f).filter(function(y,A){return y&&A})}function n(f){return f=r(f),{language:f[1]||t,extlang:f[2]||t,script:f[3]||t,region:f[4]||t}}function c(f,y,A){Object.defineProperty(f,y,{value:A,enumerable:!0})}function l(f,y,A){function T(P){return r(P)[f]||t}c(T,"pattern",y),c(n,A,T)}return l(1,/^[a-zA-Z]{2,3}$/,"language"),l(2,/^[a-zA-Z]{3}$/,"extlang"),l(3,/^[a-zA-Z]{4}$/,"script"),l(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),c(n,"split",s),n})})(UE);var mq=UE.exports,yq=GV,_q=oq,ya=PE,vq=zE.EventEmitter,Q5=pq,bq=gq,wq=mq;function jE(i,t){this._eventEmitter=new vq,this.options=ya({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=i}jE.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(i){return i.text!==void 0?i.text:i.place_name},render:function(i){if(i.geometry){var t=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+t.splice(1,t.length).join(",")+"</div></div></div>"}else{var e=i.text,r=e.toLowerCase().indexOf(this.query.toLowerCase()),s=this.query.length,n=e.substring(0,r),c=e.substring(r,r+s),l=e.substring(r+s);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+n+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+c+"</span>"+l+"</div></div></div>"}},popupRender:function(i){var t=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(i){function t(r,s){if(!document.body.contains(s))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var n=r.onAdd();s.appendChild(n)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)t(this,i);else if(typeof i=="string"){var e=document.querySelectorAll(i);if(e.length===0)throw new Error("Element ",i,"not found.");if(e.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,e[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var e=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",_q(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),t.appendChild(e),t.appendChild(this._inputEl),t.appendChild(r),this._typeahead=new yq(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(i,t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+i),e.setAttribute("viewBox","0 0 18 18"),e.setAttribute("xml:space","preserve"),e.setAttribute("width",18),e.setAttribute("height",18),"innerHTML"in e)e.innerHTML=t;else{var r=document.createElement("div");r.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var s=r.firstChild,n=s.firstChild;e.appendChild(n)}return e},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(i){var t=(i.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(i){var t=27,e=9;if(i.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var r=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,s=r?r.value:"";if(!s)return this.fresh=!0,i.keyCode!==e&&this.clear(i),this._clearEl.style.display="none";if(!(i.metaKey||[e,t,37,39,38,40].indexOf(i.keyCode)!==-1)){if(i.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(r.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(r.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}r.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;if(i&&!i.geometry)i.placeId?this._geocode(i.placeId,!0,!0):this._geocode(i.text,!0);else if(i&&JSON.stringify(i)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),i.properties&&Q5[i.properties.short_code])t=ya({},this.options.flyTo),this._map&&this._map.fitBounds(Q5[i.properties.short_code].bbox,t);else if(i.bbox){var e=i.bbox;t=ya({},this.options.flyTo),this._map&&this._map.fitBounds([[e[0],e[1]],[e[2],e[3]]],t)}else{var r={zoom:this.options.zoom};t=ya({},r,this.options.flyTo),i.center?t.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(t.center=i.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:i})}},_getConfigForRequest:function(){var i=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,e=i.reduce(function(r,s){return t.options[s]&&(["countries","types","language"].indexOf(s)>-1?r[s]=t.options[s].split(/[\s,]+/):r[s]=t.options[s],s==="proximity"&&t.options[s]&&typeof t.options[s].longitude=="number"&&typeof t.options[s].latitude=="number"&&(r[s]=[t.options[s].longitude,t.options[s].latitude])),r},{});return e},_geocode:function(i,t,e){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:i}),this.inputString=i;var r=null,s=this._getConfigForRequest(),n;if(this.options.localGeocoderOnly)n=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(i)){var c=i.split(/[\s(,)?]+/).map(function(y){return parseFloat(y,10)}).reverse();s.types&&s.types[0],s=ya(s,{query:c,limit:1}),"proximity"in s&&delete s.proximity,n=this.geocoderApi.reverseGeocode(s)}else s=ya(s,{query:i}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&e?n=this.geocoderApi.searchByPlaceId(s):n=this.geocoderApi.forwardGeocode(s):n=this.geocoderApi.getSuggestions(s):n=this.geocoderApi.forwardGeocode(s);var l=[];this.options.localGeocoder&&(l=this.options.localGeocoder(i),l||(l=[]));var f=[];return n.catch((function(y){r=y}).bind(this)).then((function(y){this._loadingEl.style.display="none";var A={};return y?A=y:A={type:"FeatureCollection",features:[]},A.config=s,this.fresh&&(this.fresh=!1),A.features=A.features?l.concat(A.features):l,this.options.externalGeocoder?(f=this.options.externalGeocoder(i,A.features,s)||[],f.then(function(T){return A.features=A.features?T.concat(A.features):T,A},function(){return A})):A}).bind(this)).then((function(y){if(r)throw r;this.options.filter&&y.features.length&&(y.features=y.features.filter(this.options.filter));var A=[];y.suggestions?A=y.suggestions:y.place?A=[y.place]:A=y.features,A.length?(this._clearEl.style.display="block",this._typeahead.update(A),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(y.features.length>0||y.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",y)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",y))}).bind(this)).catch((function(y){this._loadingEl.style.display="none",l.length&&this.options.localGeocoder||f.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(l)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:l}),this._eventEmitter.emit("error",{error:y})}).bind(this)),n},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var t=this;i.relatedTarget&&t._clear(i)},_onQueryResult:function(i){var t=i;if(t.features.length){var e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],t=wq.language(i),e=bq.placeholder[t];if(e)return e}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var i=this._typeahead.data.filter(function(s){return typeof s!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},e=ya({},t,this.options.flyTo),r=new this._maplibregl.LngLatBounds;i.forEach(function(s){r.extend(s.geometry.coordinates)}),this._map.fitBounds(r.toArray(),e)}return i.length>0&&this._maplibregl&&this._handleResultMarkers(i),this}},setInput:function(i){return this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i),this},setProximity:function(i){return this.options.proximity=i,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setGeocoderApi:function(i){return this.geocoderApi=i,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(i){if(this._map){this._removeMarker();var t={color:"#4668F2"},e=ya({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(e);var r;if(this.options.popup){var s={},n=ya({},s,this.options.popup);r=new this._maplibregl.Popup(n).setHTML(this.options.popupRender(i))}return i.center?(this.mapMarker.setLngLat(i.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(i){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},e=ya({},t,this.options.showResultMarkers);return i.forEach((function(r){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var s=this.options.showResultMarkers.element.cloneNode(!0);e=ya(e,{element:s})}var n=new this._maplibregl.Marker(ya({},e,{element:s})),c;if(this.options.popup){var l={},f=ya({},l,this.options.popup);c=new this._maplibregl.Popup(f).setHTML(this.options.popupRender(r))}r.center?(n.setLngLat(r.center).addTo(this._map),this.options.popup&&n.setPopup(c)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(n.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&n.setPopup(c)),this.resultMarkers.push(n)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(i){i.remove()}),this.resultMarkers=[])},on:function(i,t){return this._eventEmitter.on(i,t),this},off:function(i,t){return this._eventEmitter.removeListener(i,t),this}};var xq=jE;const Aq=Im(xq),Sq={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogràfic i Geològic de Catalunya",logoWidth:100},logoGencatOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensals2023",key:"districtes_censals_2023"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensals2023",key:"seccions_censals_2023"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Eq={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},Cq={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Tq={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensals2023:"districtes_censals_2023",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensals2023:"seccions_censals_2023",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},Tu={defaultOptions:Sq,Styles:Eq,Terrains:Cq,Layers:Tq};class Pq{constructor(t){this.options=t||{}}onAdd(t){let e=Tu.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?e.logoIcgcOptions.logoUrlColor:e.logoIcgcOptions.logoUrlWhite,this._img1.width=e.logoIcgcOptions.logoWidth,this._img1.title=e.logoIcgcOptions.logoTitle,this.link1=document.createElement("a"),this.link1.href=e.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${e.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?e.logoGencatOptions.logoUrlColor:e.logoGencatOptions.logoUrlWhite,this._img2.width=e.logoGencatOptions.logoWidth,this._img2.title=e.logoGencatOptions.logoTitle,this.link2=document.createElement("a"),this.link2.href=e.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${e.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class Iq{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const e=document.createElement("label");return e.classList.add("maplibregl-legend-title-label"),e.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(e),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var Qd=GE.prototype,s_="WGS 84";function GE(i){i!==void 0&&(s_=i),this.setEllipsoid(s_)}Qd.convertLatLngToUtm=function(i,t,e){var r;if(this.status)return"No ecclipsoid data associated with unknown datum: "+s_;if(!Number.isInteger(e))return"Precision is not integer number.";i=parseFloat(i),t=parseFloat(t);var s=t,n=this.toRadians(i),c=this.toRadians(s);s>=8&&s<=13&&i>54.5&&i<58||i>=56&&i<64&&s>=3&&s<12?r=32:(r=(s+180)/6+1,i>=72&&i<84&&(s>=0&&s<9?r=31:s>=9&&s<21?r=33:s>=21&&s<33?r=35:s>=33&&s<42&&(r=37))),r=parseInt(r);var l=(r-1)*6-180+3,f=this.toRadians(l),y=this.getUtmLetterDesignator(i),A=this.eccSquared/(1-this.eccSquared),T=this.a/Math.sqrt(1-this.eccSquared*Math.sin(n)*Math.sin(n)),P=Math.tan(n)*Math.tan(n),L=A*Math.cos(n)*Math.cos(n),D=Math.cos(n)*(c-f),j=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*n-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*n)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*n)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*n)),X=parseFloat(.9996*T*(D+(1-P+L)*D*D*D/6+(5-18*P+P*P+72*L-58*A)*D*D*D*D*D/120)+5e5),Z=parseFloat(.9996*(j+T*Math.tan(n)*(D*D/2+(5-P+9*L+4*L*L)*D*D*D*D/24+(61-58*P+P*P+600*L-330*A)*D*D*D*D*D*D/720)));return i<0&&(Z+=1e7),Z=tA(Z,e),X=tA(X,e),{Easting:X,Northing:Z,ZoneNumber:parseInt(r),ZoneLetter:y}};Qd.convertUtmToLatLng=function(i,t,e,r){var s=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),n=i-5e5,c=t,l=e,f=r;if(i===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(e===void 0)return"Please pass the UTMZoneNumber!";if(r===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(f)!==-1||(c-=1e7);var y=(l-1)*6-180+3,A=this.eccSquared/(1-this.eccSquared),T=c/.9996,P=T/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),L=P+(3*s/2-27*s*s*s/32)*Math.sin(2*P)+(21*s*s/16-55*s*s*s*s/32)*Math.sin(4*P)+151*s*s*s/96*Math.sin(6*P);this.toDegrees(L);var D=this.a/Math.sqrt(1-this.eccSquared*Math.sin(L)*Math.sin(L)),j=Math.tan(L)*Math.tan(L),X=A*Math.cos(L)*Math.cos(L),Z=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(L)*Math.sin(L),1.5),$=n/(D*.9996),ht=L-D*Math.tan(L)/Z*($*$/2-(5+3*j+10*X-4*X*X-9*A)*$*$*$*$/24+(61+90*j+298*X+45*j*j-252*A-3*X*X)*$*$*$*$*$*$/720);ht=this.toDegrees(ht);var _t=($-(1+2*j+X)*$*$*$/6+(5-2*X+28*j-3*X*X+8*A+24*j*j)*$*$*$*$*$/120)/Math.cos(L);return _t=y+this.toDegrees(_t),{lat:ht,lng:_t}};Qd.getUtmLetterDesignator=function(i){return i=parseFloat(i),84>=i&&i>=72?"X":72>i&&i>=64?"W":64>i&&i>=56?"V":56>i&&i>=48?"U":48>i&&i>=40?"T":40>i&&i>=32?"S":32>i&&i>=24?"R":24>i&&i>=16?"Q":16>i&&i>=8?"P":8>i&&i>=0?"N":0>i&&i>=-8?"M":-8>i&&i>=-16?"L":-16>i&&i>=-24?"K":-24>i&&i>=-32?"J":-32>i&&i>=-40?"H":-40>i&&i>=-48?"G":-48>i&&i>=-56?"F":-56>i&&i>=-64?"E":-64>i&&i>=-72?"D":-72>i&&i>=-80?"C":"Z"};Qd.setEllipsoid=function(i){switch(i){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}};Qd.toDegrees=function(i){return i/Math.PI*180};Qd.toRadians=function(i){return i*Math.PI/180};function tA(i,t){var e=Math.pow(10,t);return Math.round(i*e)/e}var Lq=GE;const Mq=Im(Lq);class Bq{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const e=new Mq;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",r=>{const s=r.lngLat.lat,n=r.lngLat.lng;let c="",l="";const f=e.convertLatLngToUtm(s,n,2),y=s>0?"N":"S";this.options.utm&&(c=`ETRS89 UTM ${f.ZoneNumber}${y} X:<b> ${f.Easting}</b> Y:<b> ${f.Northing}</b> <br>`),this.options.lonlat&&(l=`WGS 84 Lon:<b> ${n.toFixed(5)}</b>  Lat:<b> ${s.toFixed(5)}</b>`);const A=`${c}${l}`;this._container.innerHTML=A}),this._container}_lookUTM31(t,e){var r=0,s=0,n=6,c=84;return t>=r&&t<=n&&e>=s&&e<=c}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function VE(i,t){return function(){return i.apply(t,arguments)}}const{toString:Rq}=Object.prototype,{getPrototypeOf:Bv}=Object,Jm=(i=>t=>{const e=Rq.call(t);return i[e]||(i[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),fc=i=>(i=i.toLowerCase(),t=>Jm(t)===i),Xm=i=>t=>typeof t===i,{isArray:tp}=Array,mf=Xm("undefined");function kq(i){return i!==null&&!mf(i)&&i.constructor!==null&&!mf(i.constructor)&&$a(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const qE=fc("ArrayBuffer");function Oq(i){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(i):t=i&&i.buffer&&qE(i.buffer),t}const Fq=Xm("string"),$a=Xm("function"),HE=Xm("number"),Zm=i=>i!==null&&typeof i=="object",Nq=i=>i===!0||i===!1,sm=i=>{if(Jm(i)!=="object")return!1;const t=Bv(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},Dq=fc("Date"),zq=fc("File"),Uq=fc("Blob"),jq=fc("FileList"),Gq=i=>Zm(i)&&$a(i.pipe),Vq=i=>{let t;return i&&(typeof FormData=="function"&&i instanceof FormData||$a(i.append)&&((t=Jm(i))==="formdata"||t==="object"&&$a(i.toString)&&i.toString()==="[object FormData]"))},qq=fc("URLSearchParams"),Hq=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rf(i,t){let{allOwnKeys:e=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(i===null||typeof i>"u")return;let r,s;if(typeof i!="object"&&(i=[i]),tp(i))for(r=0,s=i.length;r<s;r++)t.call(null,i[r],r,i);else{const n=e?Object.getOwnPropertyNames(i):Object.keys(i),c=n.length;let l;for(r=0;r<c;r++)l=n[r],t.call(null,i[l],l,i)}}function WE(i,t){t=t.toLowerCase();const e=Object.keys(i);let r=e.length,s;for(;r-- >0;)if(s=e[r],t===s.toLowerCase())return s;return null}const JE=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,XE=i=>!mf(i)&&i!==JE;function n_(){const{caseless:i}=XE(this)&&this||{},t={},e=(r,s)=>{const n=i&&WE(t,s)||s;sm(t[n])&&sm(r)?t[n]=n_(t[n],r):sm(r)?t[n]=n_({},r):tp(r)?t[n]=r.slice():t[n]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Rf(arguments[r],e);return t}const Wq=function(i,t,e){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Rf(t,(s,n)=>{e&&$a(s)?i[n]=VE(s,e):i[n]=s},{allOwnKeys:r}),i},Jq=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),Xq=(i,t,e,r)=>{i.prototype=Object.create(t.prototype,r),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:t.prototype}),e&&Object.assign(i.prototype,e)},Zq=(i,t,e,r)=>{let s,n,c;const l={};if(t=t||{},i==null)return t;do{for(s=Object.getOwnPropertyNames(i),n=s.length;n-- >0;)c=s[n],(!r||r(c,i,t))&&!l[c]&&(t[c]=i[c],l[c]=!0);i=e!==!1&&Bv(i)}while(i&&(!e||e(i,t))&&i!==Object.prototype);return t},$q=(i,t,e)=>{i=String(i),(e===void 0||e>i.length)&&(e=i.length),e-=t.length;const r=i.indexOf(t,e);return r!==-1&&r===e},Yq=i=>{if(!i)return null;if(tp(i))return i;let t=i.length;if(!HE(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=i[t];return e},Kq=(i=>t=>i&&t instanceof i)(typeof Uint8Array<"u"&&Bv(Uint8Array)),Qq=(i,t)=>{const e=(i&&i[Symbol.iterator]).call(i);let r;for(;(r=e.next())&&!r.done;){const s=r.value;t.call(i,s[0],s[1])}},tH=(i,t)=>{let e;const r=[];for(;(e=i.exec(t))!==null;)r.push(e);return r},eH=fc("HTMLFormElement"),iH=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,e,r){return e.toUpperCase()+r}),eA=(i=>{let{hasOwnProperty:t}=i;return(e,r)=>t.call(e,r)})(Object.prototype),rH=fc("RegExp"),ZE=(i,t)=>{const e=Object.getOwnPropertyDescriptors(i),r={};Rf(e,(s,n)=>{let c;(c=t(s,n,i))!==!1&&(r[n]=c||s)}),Object.defineProperties(i,r)},sH=i=>{ZE(i,(t,e)=>{if($a(i)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=i[e];if($a(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},nH=(i,t)=>{const e={},r=s=>{s.forEach(n=>{e[n]=!0})};return tp(i)?r(i):r(String(i).split(t)),e},oH=()=>{},aH=(i,t)=>(i=+i,Number.isFinite(i)?i:t),Jy="abcdefghijklmnopqrstuvwxyz",iA="0123456789",$E={DIGIT:iA,ALPHA:Jy,ALPHA_DIGIT:Jy+Jy.toUpperCase()+iA},lH=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$E.ALPHA_DIGIT,e="";const{length:r}=t;for(;i--;)e+=t[Math.random()*r|0];return e};function cH(i){return!!(i&&$a(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const hH=i=>{const t=new Array(10),e=(r,s)=>{if(Zm(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[s]=r;const n=tp(r)?[]:{};return Rf(r,(c,l)=>{const f=e(c,s+1);!mf(f)&&(n[l]=f)}),t[s]=void 0,n}}return r};return e(i,0)},uH=fc("AsyncFunction"),dH=i=>i&&(Zm(i)||$a(i))&&$a(i.then)&&$a(i.catch),Ae={isArray:tp,isArrayBuffer:qE,isBuffer:kq,isFormData:Vq,isArrayBufferView:Oq,isString:Fq,isNumber:HE,isBoolean:Nq,isObject:Zm,isPlainObject:sm,isUndefined:mf,isDate:Dq,isFile:zq,isBlob:Uq,isRegExp:rH,isFunction:$a,isStream:Gq,isURLSearchParams:qq,isTypedArray:Kq,isFileList:jq,forEach:Rf,merge:n_,extend:Wq,trim:Hq,stripBOM:Jq,inherits:Xq,toFlatObject:Zq,kindOf:Jm,kindOfTest:fc,endsWith:$q,toArray:Yq,forEachEntry:Qq,matchAll:tH,isHTMLForm:eH,hasOwnProperty:eA,hasOwnProp:eA,reduceDescriptors:ZE,freezeMethods:sH,toObjectSet:nH,toCamelCase:iH,noop:oH,toFiniteNumber:aH,findKey:WE,global:JE,isContextDefined:XE,ALPHABET:$E,generateString:lH,isSpecCompliantForm:cH,toJSONObject:hH,isAsyncFn:uH,isThenable:dH};function pr(i,t,e,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),r&&(this.request=r),s&&(this.response=s)}Ae.inherits(pr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ae.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const YE=pr.prototype,KE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{KE[i]={value:i}});Object.defineProperties(pr,KE);Object.defineProperty(YE,"isAxiosError",{value:!0});pr.from=(i,t,e,r,s,n)=>{const c=Object.create(YE);return Ae.toFlatObject(i,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),pr.call(c,i.message,t,e,r,s),c.cause=i,c.name=i.name,n&&Object.assign(c,n),c};const pH=null;function o_(i){return Ae.isPlainObject(i)||Ae.isArray(i)}function QE(i){return Ae.endsWith(i,"[]")?i.slice(0,-2):i}function rA(i,t,e){return i?i.concat(t).map(function(r,s){return r=QE(r),!e&&s?"["+r+"]":r}).join(e?".":""):t}function fH(i){return Ae.isArray(i)&&!i.some(o_)}const gH=Ae.toFlatObject(Ae,{},null,function(i){return/^is[A-Z]/.test(i)});function $m(i,t,e){if(!Ae.isObject(i))throw new TypeError("target must be an object");t=t||new FormData,e=Ae.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(L,D){return!Ae.isUndefined(D[L])});const r=e.metaTokens,s=e.visitor||y,n=e.dots,c=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&Ae.isSpecCompliantForm(t);if(!Ae.isFunction(s))throw new TypeError("visitor must be a function");function f(L){if(L===null)return"";if(Ae.isDate(L))return L.toISOString();if(!l&&Ae.isBlob(L))throw new pr("Blob is not supported. Use a Buffer instead.");return Ae.isArrayBuffer(L)||Ae.isTypedArray(L)?l&&typeof Blob=="function"?new Blob([L]):Buffer.from(L):L}function y(L,D,j){let X=L;if(L&&!j&&typeof L=="object"){if(Ae.endsWith(D,"{}"))D=r?D:D.slice(0,-2),L=JSON.stringify(L);else if(Ae.isArray(L)&&fH(L)||(Ae.isFileList(L)||Ae.endsWith(D,"[]"))&&(X=Ae.toArray(L)))return D=QE(D),X.forEach(function(Z,$){!(Ae.isUndefined(Z)||Z===null)&&t.append(c===!0?rA([D],$,n):c===null?D:D+"[]",f(Z))}),!1}return o_(L)?!0:(t.append(rA(j,D,n),f(L)),!1)}const A=[],T=Object.assign(gH,{defaultVisitor:y,convertValue:f,isVisitable:o_});function P(L,D){if(!Ae.isUndefined(L)){if(A.indexOf(L)!==-1)throw Error("Circular reference detected in "+D.join("."));A.push(L),Ae.forEach(L,function(j,X){(!(Ae.isUndefined(j)||j===null)&&s.call(t,j,Ae.isString(X)?X.trim():X,D,T))===!0&&P(j,D?D.concat(X):[X])}),A.pop()}}if(!Ae.isObject(i))throw new TypeError("data must be an object");return P(i),t}function sA(i){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Rv(i,t){this._pairs=[],i&&$m(i,this,t)}const tC=Rv.prototype;tC.append=function(i,t){this._pairs.push([i,t])};tC.toString=function(i){const t=i?function(e){return i.call(this,e,sA)}:sA;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};function mH(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eC(i,t,e){if(!t)return i;const r=e&&e.encode||mH,s=e&&e.serialize;let n;if(s?n=s(t,e):n=Ae.isURLSearchParams(t)?t.toString():new Rv(t,e).toString(r),n){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+n}return i}class nA{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Ae.forEach(this.handlers,function(e){e!==null&&t(e)})}}const iC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yH=typeof URLSearchParams<"u"?URLSearchParams:Rv,_H=typeof FormData<"u"?FormData:null,vH=typeof Blob<"u"?Blob:null,bH={isBrowser:!0,classes:{URLSearchParams:yH,FormData:_H,Blob:vH},protocols:["http","https","file","blob","url","data"]},rC=typeof window<"u"&&typeof document<"u",wH=(i=>rC&&["ReactNative","NativeScript","NS"].indexOf(i)<0)(typeof navigator<"u"&&navigator.product),xH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",AH=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:rC,hasStandardBrowserEnv:wH,hasStandardBrowserWebWorkerEnv:xH},Symbol.toStringTag,{value:"Module"})),hc={...AH,...bH};function SH(i,t){return $m(i,new hc.classes.URLSearchParams,Object.assign({visitor:function(e,r,s,n){return hc.isNode&&Ae.isBuffer(e)?(this.append(r,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function EH(i){return Ae.matchAll(/\w+|\[(\w*)]/g,i).map(t=>t[0]==="[]"?"":t[1]||t[0])}function CH(i){const t={},e=Object.keys(i);let r;const s=e.length;let n;for(r=0;r<s;r++)n=e[r],t[n]=i[n];return t}function sC(i){function t(e,r,s,n){let c=e[n++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),f=n>=e.length;return c=!c&&Ae.isArray(s)?s.length:c,f?(Ae.hasOwnProp(s,c)?s[c]=[s[c],r]:s[c]=r,!l):((!s[c]||!Ae.isObject(s[c]))&&(s[c]=[]),t(e,r,s[c],n)&&Ae.isArray(s[c])&&(s[c]=CH(s[c])),!l)}if(Ae.isFormData(i)&&Ae.isFunction(i.entries)){const e={};return Ae.forEachEntry(i,(r,s)=>{t(EH(r),s,e,0)}),e}return null}function TH(i,t,e){if(Ae.isString(i))try{return(t||JSON.parse)(i),Ae.trim(i)}catch(r){if(r.name!=="SyntaxError")throw r}return(e||JSON.stringify)(i)}const kf={transitional:iC,adapter:["xhr","http"],transformRequest:[function(i,t){const e=t.getContentType()||"",r=e.indexOf("application/json")>-1,s=Ae.isObject(i);if(s&&Ae.isHTMLForm(i)&&(i=new FormData(i)),Ae.isFormData(i))return r?JSON.stringify(sC(i)):i;if(Ae.isArrayBuffer(i)||Ae.isBuffer(i)||Ae.isStream(i)||Ae.isFile(i)||Ae.isBlob(i))return i;if(Ae.isArrayBufferView(i))return i.buffer;if(Ae.isURLSearchParams(i))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let n;if(s){if(e.indexOf("application/x-www-form-urlencoded")>-1)return SH(i,this.formSerializer).toString();if((n=Ae.isFileList(i))||e.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return $m(n?{"files[]":i}:i,c&&new c,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),TH(i)):i}],transformResponse:[function(i){const t=this.transitional||kf.transitional,e=t&&t.forcedJSONParsing,r=this.responseType==="json";if(i&&Ae.isString(i)&&(e&&!this.responseType||r)){const s=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(i)}catch(n){if(s)throw n.name==="SyntaxError"?pr.from(n,pr.ERR_BAD_RESPONSE,this,null,this.response):n}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:hc.classes.FormData,Blob:hc.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ae.forEach(["delete","get","head","post","put","patch"],i=>{kf.headers[i]={}});const PH=Ae.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),IH=i=>{const t={};let e,r,s;return i&&i.split(`
`).forEach(function(n){s=n.indexOf(":"),e=n.substring(0,s).trim().toLowerCase(),r=n.substring(s+1).trim(),!(!e||t[e]&&PH[e])&&(e==="set-cookie"?t[e]?t[e].push(r):t[e]=[r]:t[e]=t[e]?t[e]+", "+r:r)}),t},oA=Symbol("internals");function jp(i){return i&&String(i).trim().toLowerCase()}function nm(i){return i===!1||i==null?i:Ae.isArray(i)?i.map(nm):String(i)}function LH(i){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(i);)t[r[1]]=r[2];return t}const MH=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Xy(i,t,e,r,s){if(Ae.isFunction(r))return r.call(this,t,e);if(s&&(t=e),!!Ae.isString(t)){if(Ae.isString(r))return t.indexOf(r)!==-1;if(Ae.isRegExp(r))return r.test(t)}}function BH(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,r)=>e.toUpperCase()+r)}function RH(i,t){const e=Ae.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(i,r+e,{value:function(s,n,c){return this[r].call(this,t,s,n,c)},configurable:!0})})}class Ya{constructor(t){t&&this.set(t)}set(t,e,r){const s=this;function n(l,f,y){const A=jp(f);if(!A)throw new Error("header name must be a non-empty string");const T=Ae.findKey(s,A);(!T||s[T]===void 0||y===!0||y===void 0&&s[T]!==!1)&&(s[T||f]=nm(l))}const c=(l,f)=>Ae.forEach(l,(y,A)=>n(y,A,f));return Ae.isPlainObject(t)||t instanceof this.constructor?c(t,e):Ae.isString(t)&&(t=t.trim())&&!MH(t)?c(IH(t),e):t!=null&&n(e,t,r),this}get(t,e){if(t=jp(t),t){const r=Ae.findKey(this,t);if(r){const s=this[r];if(!e)return s;if(e===!0)return LH(s);if(Ae.isFunction(e))return e.call(this,s,r);if(Ae.isRegExp(e))return e.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=jp(t),t){const r=Ae.findKey(this,t);return!!(r&&this[r]!==void 0&&(!e||Xy(this,this[r],r,e)))}return!1}delete(t,e){const r=this;let s=!1;function n(c){if(c=jp(c),c){const l=Ae.findKey(r,c);l&&(!e||Xy(r,r[l],l,e))&&(delete r[l],s=!0)}}return Ae.isArray(t)?t.forEach(n):n(t),s}clear(t){const e=Object.keys(this);let r=e.length,s=!1;for(;r--;){const n=e[r];(!t||Xy(this,this[n],n,t,!0))&&(delete this[n],s=!0)}return s}normalize(t){const e=this,r={};return Ae.forEach(this,(s,n)=>{const c=Ae.findKey(r,n);if(c){e[c]=nm(s),delete e[n];return}const l=t?BH(n):String(n).trim();l!==n&&delete e[n],e[l]=nm(s),r[l]=!0}),this}concat(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.constructor.concat(this,...e)}toJSON(t){const e=Object.create(null);return Ae.forEach(this,(r,s)=>{r!=null&&r!==!1&&(e[s]=t&&Ae.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[e,r]=t;return e+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const e=new this(t);for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];return s.forEach(c=>e.set(c)),e}static accessor(t){const e=(this[oA]=this[oA]={accessors:{}}).accessors,r=this.prototype;function s(n){const c=jp(n);e[c]||(RH(r,n),e[c]=!0)}return Ae.isArray(t)?t.forEach(s):s(t),this}}Ya.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ae.reduceDescriptors(Ya.prototype,(i,t)=>{let{value:e}=i,r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[r]=s}}});Ae.freezeMethods(Ya);function Zy(i,t){const e=this||kf,r=t||e,s=Ya.from(r.headers);let n=r.data;return Ae.forEach(i,function(c){n=c.call(e,n,s.normalize(),t?t.status:void 0)}),s.normalize(),n}function nC(i){return!!(i&&i.__CANCEL__)}function Of(i,t,e){pr.call(this,i??"canceled",pr.ERR_CANCELED,t,e),this.name="CanceledError"}Ae.inherits(Of,pr,{__CANCEL__:!0});function kH(i,t,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?i(e):t(new pr("Request failed with status code "+e.status,[pr.ERR_BAD_REQUEST,pr.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}const OH=hc.hasStandardBrowserEnv?{write(i,t,e,r,s,n){const c=[i+"="+encodeURIComponent(t)];Ae.isNumber(e)&&c.push("expires="+new Date(e).toGMTString()),Ae.isString(r)&&c.push("path="+r),Ae.isString(s)&&c.push("domain="+s),n===!0&&c.push("secure"),document.cookie=c.join("; ")},read(i){const t=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function FH(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function NH(i,t){return t?i.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):i}function oC(i,t){return i&&!FH(t)?NH(i,t):t}const DH=hc.hasStandardBrowserEnv?function(){const i=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let e;function r(s){let n=s;return i&&(t.setAttribute("href",n),n=t.href),t.setAttribute("href",n),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return e=r(window.location.href),function(s){const n=Ae.isString(s)?r(s):s;return n.protocol===e.protocol&&n.host===e.host}}():function(){return function(){return!0}}();function zH(i){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return t&&t[1]||""}function UH(i,t){i=i||10;const e=new Array(i),r=new Array(i);let s=0,n=0,c;return t=t!==void 0?t:1e3,function(l){const f=Date.now(),y=r[n];c||(c=f),e[s]=l,r[s]=f;let A=n,T=0;for(;A!==s;)T+=e[A++],A=A%i;if(s=(s+1)%i,s===n&&(n=(n+1)%i),f-c<t)return;const P=y&&f-y;return P?Math.round(T*1e3/P):void 0}}function aA(i,t){let e=0;const r=UH(50,250);return s=>{const n=s.loaded,c=s.lengthComputable?s.total:void 0,l=n-e,f=r(l),y=n<=c;e=n;const A={loaded:n,total:c,progress:c?n/c:void 0,bytes:l,rate:f||void 0,estimated:f&&c&&y?(c-n)/f:void 0,event:s};A[t?"download":"upload"]=!0,i(A)}}const jH=typeof XMLHttpRequest<"u",GH=jH&&function(i){return new Promise(function(t,e){let r=i.data;const s=Ya.from(i.headers).normalize();let{responseType:n,withXSRFToken:c}=i,l;function f(){i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let y;if(Ae.isFormData(r)){if(hc.hasStandardBrowserEnv||hc.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((y=s.getContentType())!==!1){const[D,...j]=y?y.split(";").map(X=>X.trim()).filter(Boolean):[];s.setContentType([D||"multipart/form-data",...j].join("; "))}}let A=new XMLHttpRequest;if(i.auth){const D=i.auth.username||"",j=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";s.set("Authorization","Basic "+btoa(D+":"+j))}const T=oC(i.baseURL,i.url);A.open(i.method.toUpperCase(),eC(T,i.params,i.paramsSerializer),!0),A.timeout=i.timeout;function P(){if(!A)return;const D=Ya.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),j={data:!n||n==="text"||n==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:D,config:i,request:A};kH(function(X){t(X),f()},function(X){e(X),f()},j),A=null}if("onloadend"in A?A.onloadend=P:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(P)},A.onabort=function(){A&&(e(new pr("Request aborted",pr.ECONNABORTED,i,A)),A=null)},A.onerror=function(){e(new pr("Network Error",pr.ERR_NETWORK,i,A)),A=null},A.ontimeout=function(){let D=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const j=i.transitional||iC;i.timeoutErrorMessage&&(D=i.timeoutErrorMessage),e(new pr(D,j.clarifyTimeoutError?pr.ETIMEDOUT:pr.ECONNABORTED,i,A)),A=null},hc.hasStandardBrowserEnv&&(c&&Ae.isFunction(c)&&(c=c(i)),c||c!==!1&&DH(T))){const D=i.xsrfHeaderName&&i.xsrfCookieName&&OH.read(i.xsrfCookieName);D&&s.set(i.xsrfHeaderName,D)}r===void 0&&s.setContentType(null),"setRequestHeader"in A&&Ae.forEach(s.toJSON(),function(D,j){A.setRequestHeader(j,D)}),Ae.isUndefined(i.withCredentials)||(A.withCredentials=!!i.withCredentials),n&&n!=="json"&&(A.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&A.addEventListener("progress",aA(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&A.upload&&A.upload.addEventListener("progress",aA(i.onUploadProgress)),(i.cancelToken||i.signal)&&(l=D=>{A&&(e(!D||D.type?new Of(null,i,A):D),A.abort(),A=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const L=zH(T);if(L&&hc.protocols.indexOf(L)===-1){e(new pr("Unsupported protocol "+L+":",pr.ERR_BAD_REQUEST,i));return}A.send(r||null)})},a_={http:pH,xhr:GH};Ae.forEach(a_,(i,t)=>{if(i){try{Object.defineProperty(i,"name",{value:t})}catch{}Object.defineProperty(i,"adapterName",{value:t})}});const lA=i=>`- ${i}`,VH=i=>Ae.isFunction(i)||i===null||i===!1,aC={getAdapter:i=>{i=Ae.isArray(i)?i:[i];const{length:t}=i;let e,r;const s={};for(let n=0;n<t;n++){e=i[n];let c;if(r=e,!VH(e)&&(r=a_[(c=String(e)).toLowerCase()],r===void 0))throw new pr(`Unknown adapter '${c}'`);if(r)break;s[c||"#"+n]=r}if(!r){const n=Object.entries(s).map(l=>{let[f,y]=l;return`adapter ${f} `+(y===!1?"is not supported by the environment":"is not available in the build")});let c=t?n.length>1?`since :
`+n.map(lA).join(`
`):" "+lA(n[0]):"as no adapter specified";throw new pr("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return r},adapters:a_};function $y(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Of(null,i)}function cA(i){return $y(i),i.headers=Ya.from(i.headers),i.data=Zy.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),aC.getAdapter(i.adapter||kf.adapter)(i).then(function(t){return $y(i),t.data=Zy.call(i,i.transformResponse,t),t.headers=Ya.from(t.headers),t},function(t){return nC(t)||($y(i),t&&t.response&&(t.response.data=Zy.call(i,i.transformResponse,t.response),t.response.headers=Ya.from(t.response.headers))),Promise.reject(t)})}const hA=i=>i instanceof Ya?{...i}:i;function Xd(i,t){t=t||{};const e={};function r(y,A,T){return Ae.isPlainObject(y)&&Ae.isPlainObject(A)?Ae.merge.call({caseless:T},y,A):Ae.isPlainObject(A)?Ae.merge({},A):Ae.isArray(A)?A.slice():A}function s(y,A,T){if(Ae.isUndefined(A)){if(!Ae.isUndefined(y))return r(void 0,y,T)}else return r(y,A,T)}function n(y,A){if(!Ae.isUndefined(A))return r(void 0,A)}function c(y,A){if(Ae.isUndefined(A)){if(!Ae.isUndefined(y))return r(void 0,y)}else return r(void 0,A)}function l(y,A,T){if(T in t)return r(y,A);if(T in i)return r(void 0,y)}const f={url:n,method:n,data:n,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(y,A)=>s(hA(y),hA(A),!0)};return Ae.forEach(Object.keys(Object.assign({},i,t)),function(y){const A=f[y]||s,T=A(i[y],t[y],y);Ae.isUndefined(T)&&A!==l||(e[y]=T)}),e}const lC="1.6.8",kv={};["object","boolean","number","function","string","symbol"].forEach((i,t)=>{kv[i]=function(e){return typeof e===i||"a"+(t<1?"n ":" ")+i}});const uA={};kv.transitional=function(i,t,e){function r(s,n){return"[Axios v"+lC+"] Transitional option '"+s+"'"+n+(e?". "+e:"")}return(s,n,c)=>{if(i===!1)throw new pr(r(n," has been removed"+(t?" in "+t:"")),pr.ERR_DEPRECATED);return t&&!uA[n]&&(uA[n]=!0,console.warn(r(n," has been deprecated since v"+t+" and will be removed in the near future"))),i?i(s,n,c):!0}};function qH(i,t,e){if(typeof i!="object")throw new pr("options must be an object",pr.ERR_BAD_OPTION_VALUE);const r=Object.keys(i);let s=r.length;for(;s-- >0;){const n=r[s],c=t[n];if(c){const l=i[n],f=l===void 0||c(l,n,i);if(f!==!0)throw new pr("option "+n+" must be "+f,pr.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new pr("Unknown option "+n,pr.ERR_BAD_OPTION)}}const l_={assertOptions:qH,validators:kv},Dh=l_.validators;class Mu{constructor(t){this.defaults=t,this.interceptors={request:new nA,response:new nA}}async request(t,e){try{return await this._request(t,e)}catch(r){if(r instanceof Error){let s;Error.captureStackTrace?Error.captureStackTrace(s={}):s=new Error;const n=s.stack?s.stack.replace(/^.+\n/,""):"";r.stack?n&&!String(r.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+n):r.stack=n}throw r}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Xd(this.defaults,e);const{transitional:r,paramsSerializer:s,headers:n}=e;r!==void 0&&l_.assertOptions(r,{silentJSONParsing:Dh.transitional(Dh.boolean),forcedJSONParsing:Dh.transitional(Dh.boolean),clarifyTimeoutError:Dh.transitional(Dh.boolean)},!1),s!=null&&(Ae.isFunction(s)?e.paramsSerializer={serialize:s}:l_.assertOptions(s,{encode:Dh.function,serialize:Dh.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let c=n&&Ae.merge(n.common,n[e.method]);n&&Ae.forEach(["delete","get","head","post","put","patch","common"],D=>{delete n[D]}),e.headers=Ya.concat(c,n);const l=[];let f=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(e)===!1||(f=f&&D.synchronous,l.unshift(D.fulfilled,D.rejected))});const y=[];this.interceptors.response.forEach(function(D){y.push(D.fulfilled,D.rejected)});let A,T=0,P;if(!f){const D=[cA.bind(this),void 0];for(D.unshift.apply(D,l),D.push.apply(D,y),P=D.length,A=Promise.resolve(e);T<P;)A=A.then(D[T++],D[T++]);return A}P=l.length;let L=e;for(T=0;T<P;){const D=l[T++],j=l[T++];try{L=D(L)}catch(X){j.call(this,X);break}}try{A=cA.call(this,L)}catch(D){return Promise.reject(D)}for(T=0,P=y.length;T<P;)A=A.then(y[T++],y[T++]);return A}getUri(t){t=Xd(this.defaults,t);const e=oC(t.baseURL,t.url);return eC(e,t.params,t.paramsSerializer)}}Ae.forEach(["delete","get","head","options"],function(i){Mu.prototype[i]=function(t,e){return this.request(Xd(e||{},{method:i,url:t,data:(e||{}).data}))}});Ae.forEach(["post","put","patch"],function(i){function t(e){return function(r,s,n){return this.request(Xd(n||{},{method:i,headers:e?{"Content-Type":"multipart/form-data"}:{},url:r,data:s}))}}Mu.prototype[i]=t(),Mu.prototype[i+"Form"]=t(!0)});class Ov{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(s){e=s});const r=this;this.promise.then(s=>{if(!r._listeners)return;let n=r._listeners.length;for(;n-- >0;)r._listeners[n](s);r._listeners=null}),this.promise.then=s=>{let n;const c=new Promise(l=>{r.subscribe(l),n=l}).then(s);return c.cancel=function(){r.unsubscribe(n)},c},t(function(s,n,c){r.reason||(r.reason=new Of(s,n,c),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}static source(){let t;return{token:new Ov(function(e){t=e}),cancel:t}}}function HH(i){return function(t){return i.apply(null,t)}}function WH(i){return Ae.isObject(i)&&i.isAxiosError===!0}const c_={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(c_).forEach(i=>{let[t,e]=i;c_[e]=t});function cC(i){const t=new Mu(i),e=VE(Mu.prototype.request,t);return Ae.extend(e,Mu.prototype,t,{allOwnKeys:!0}),Ae.extend(e,t,null,{allOwnKeys:!0}),e.create=function(r){return cC(Xd(i,r))},e}const qs=cC(kf);qs.Axios=Mu;qs.CanceledError=Of;qs.CancelToken=Ov;qs.isCancel=nC;qs.VERSION=lC;qs.toFormData=$m;qs.AxiosError=pr;qs.Cancel=qs.CanceledError;qs.all=function(i){return Promise.all(i)};qs.spread=HH;qs.isAxiosError=WH;qs.mergeConfig=Xd;qs.AxiosHeaders=Ya;qs.formToJSON=i=>sC(Ae.isHTMLForm(i)?new FormData(i):i);qs.getAdapter=aC.getAdapter;qs.HttpStatusCode=c_;qs.default=qs;const JH="https://tilemaps.icgc.cat/cdn/configs/mapicgc-config.json",XH=5e3;class hC{static async getConfigICGC(){try{const t=await qs.get(JH,{timeout:XH});return t.data?t.data:(console.log("Resposta sense dades:",t),Tu)}catch(t){return t.response?(console.error("Error de resposta:",t.response.data),console.error("Codi d'estat:",t.response.status)):t.request?console.error("No s'ha rebut resposta del servidor:",t.request):console.error("Error:",t.message),Tu}}}const ZH={"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]},$H={cobertesSol:ZH},YH="lines",Ug="labels";let _u,Gp,Cs,yr,KH=class{constructor(i){hC.getConfigICGC().then(t=>{_u={...t.Styles},Cs={...t.Layers},Gp={...t.Terrains},yr={...t.defaultOptions},this.initTheMap(i)}).catch(t=>{console.info("Configuracio per defecte",t),_u={...Tu.Styles},Cs={...Tu.Layers},Gp={...Tu.Terrains},yr={...Tu.defaultOptions},this.initTheMap(i)})}initTheMap(i){if(!i)i=yr.mapOptions;else for(const t in yr.mapOptions){let e=[yr.mapOptions.center[0],yr.mapOptions.center[1]];yr.mapOptions.center=e,i.hasOwnProperty(t)||(i[t]=yr.mapOptions[t])}i.maxPitch=85,i.maplibreLogo=!1,i.attributionControl=!1,this.map=new Cn.Map(i),this.map.options=i,this.map.addControl(new Cn.AttributionControl({compact:!0})),this.map.on("load",async()=>{const t=this.map.getStyle().name,e=this.map.options.style;if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this.map.addControl(new Pq({color:e.indexOf("orto")===-1,defaultOptions:yr}),"bottom-left"),this._dealOrto3dStyle(t)})}addGeocoderICGC(i){try{i===void 0&&(i="top-right");let t={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:Cn,showResultsWhileTyping:!0,minLength:2};const e={forwardGeocode:async s=>{const n=[];try{const c=yr.geocoder.peliasUrl1+encodeURIComponent(s.query)+yr.geocoder.peliasUrl2,l=await(await fetch(c)).json();for(const f of l.features){const y=f.geometry.coordinates,A={type:"Feature",geometry:{type:"Point",coordinates:y},place_name:f.properties.etiqueta,properties:f.properties,text:f.properties.etiqueta,place_type:["place"],center:y};n.push(A)}}catch(c){console.error(`Failed to forwardGeocode with error: ${c}`)}return{features:n}}};this.map.addControl(new Aq(e,t),i);let r=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");r[0].attributes[2].nodeValue="Cerca...",r[0].addEventListener("input",function(s){s.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(i){console.error(`Error getting style: ${i.message}`)}}async loadImage(i){try{return this.map.loadImage(i)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(i,t){try{return this.map.addImage(i,t)}catch(e){console.error(`Error getting addImage: ${e.message}`)}}getConfigStyles(){try{let i=[];for(const t of _u)i.push(t.name);return i}catch(i){console.error(`Error retrieving base styles: ${i.message}`)}}getConfigWMSLayers(){try{let i=[];for(const t in Cs.WMS)Cs.WMS.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving WMS layers: ${i.message}`)}}getConfigOrtoLayers(){try{let i=[];for(const t in Cs.Orto)Cs.Orto.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving orto image layers: ${i.message}`)}}getConfigVectorLayers(){try{let i=[];for(const t in Cs.Vector)Cs.Vector.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving vector layers: ${i.message}`)}}getConfigVectorAdminLayers(){try{let i=[];for(const t in Cs.VectorAdmin)Cs.VectorAdmin.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving vectorAdmin layers: ${i.message}`)}}getConfigFGBAdminLayers(){try{let i=[];for(const t in Cs.FGBAdmin)Cs.FGBAdmin.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving FGBAdmin layers: ${i.message}`)}}async fetchData(i,t,e){try{(!e||e===void 0)&&(e={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let r=e.layerPosition;if(i.includes(".fgb"))this.addFGBLayerICGC(i,t,e);else{const s=await(await fetch(i)).json();let n=t,c=this._dealOrderLayer(r),l=s.features[0].geometry.type;l.includes("ine")&&(e!==void 0?this.map.addLayer({id:n,type:"line",source:{type:"geojson",data:s},layout:e.layout||{},paint:e.paint||{}},c):this.map.addLayer({id:n,type:"line",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},c)),l.includes("olygon")&&(e!==void 0?this.map.addLayer({id:n,type:"fill",source:{type:"geojson",data:s},layout:e.layout,paint:e.paint},c):this.map.addLayer({id:n,type:"fill",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},c)),l.includes("oint")&&(e!==void 0?this.map.addLayer({id:n,type:"circle",source:{type:"geojson",data:s},layout:e.layout,paint:e.paint},c):this.map.addLayer({id:n,type:"circle",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},c))}}catch(r){console.error(`Error fetching data: ${r.message}`)}}async fetchDataAndMenu(i,t,e,r){try{let s;r!==null?s=r.layerPosition:s=Ug;let n,c=document.getElementById("map");if(document.getElementById("menu-group")?n=document.getElementById("menu-group"):(n=document.createElement("nav"),n.id="menu-group",n.classList.add="filter-group",c.appendChild(n)),n!==null){let l="visible",f=this._dealOrderLayer(s),y;if(i.includes(".fgb")){let T=this._getKeyByUrlFGB(i);T===null&&(T="userFGB");const P=await fetch(i),L={type:"FeatureCollection",features:[]};for await(const j of m2(P.body))L.features.push(j);y=L;let D=t;if(this.map.addSource(D,{type:"geojson",data:L}),i.includes("text"))r!==void 0?this.map.addLayer({id:t,type:"symbol",source:D,layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"symbol",source:D,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:l,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f);else{let j=t+"Text";this.map.addLayer({id:j,type:"symbol",source:D,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:l,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)}}else y=await(await fetch(i)).json();if(e!=="all"){const T=document.createElement("div");T.id="titleDivMenu",T.textContent=t,n.appendChild(T);const P=document.createElement("div");P.id="titleDivMenuSub",P.textContent=`📂 ${e}`,n.appendChild(P)}let A;if(r.type?A=r.type:A=y.features[0].geometry.type,e==="all")A.includes("ine")&&(r!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),A.includes("olygon")&&(r!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},f)),A.includes("oint")&&(r!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},f)),A.includes("ymbol")&&(r!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)),this.addMenuItem(t);else{let T=e;const P={};y.features.forEach(L=>{const D=L.properties[T],j=D+"-userFieldFilter-"+t;D!==null&&(P[j]||(A.includes("ine")&&(r!==void 0?this.map.addLayer({id:j,type:"line",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint,filter:["==",`${T}`,D]},f):this.map.addLayer({id:j,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${T}`,D],paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),A.includes("olygon")&&(r!==void 0?this.map.addLayer({id:j,type:"fill",source:{type:"geojson",data:y},filter:["==",`${T}`,D],layout:r.layout,paint:r.paint},f):this.map.addLayer({id:j,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${T}`,D],paint:{"fill-color":"blue","fill-opacity":.6}},f)),A.includes("oint")&&(r!==void 0?this.map.addLayer({id:j,type:"circle",source:{type:"geojson",data:y},filter:["==",`${T}`,D],layout:r.layout,paint:r.paint},f):this.map.addLayer({id:j,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${T}`,D],paint:{"circle-color":"red","circle-opacity":.85}},f)),P[j]=!0,this.addMenuItem(j)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(i,t){setTimeout(()=>{try{this.map.on(i,t)}catch(e){console.error(`Error adding event ON listener: ${e.message}`)}},500)}getSource(i){try{return this.map.getSource(i)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(i,t){try{this.map.addSource(i,t)}catch(e){console.error(`Error adding source: ${e.message}`)}}setStyle(i,t){try{t!==void 0?this.map.setStyle(i,t):this.map.setStyle(i),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var e=window.document.querySelector(".maplibregl-compact-show");e.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(e){console.error(`Error setting style: ${e.message}`)}}getLayer(i){try{return this.map.getLayer(i)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(i,t,e){try{return this.map.setFilter(i,t,e)}catch(r){console.error(`Error setting filter: ${r.message}`)}}jumpTo(i){try{this.map.jumpTo(i)}catch(t){console.error(`Error jumping to ${i}: ${t.message}`)}}setLayoutProperty(i,t,e){try{this.map.setLayoutProperty(i,t,e)}catch(r){console.error(`Error setting layout property: ${r.message}`)}}setPaintProperty(i,t,e){try{this.map.setPaintProperty(i,t,e)}catch(r){console.error(`Error setting paint property: ${r.message}`)}}addControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(i,t)}catch(e){console.error(`Error adding control: ${e.message}`)}}getZoom(){try{return this.map.getZoom()}catch(i){console.error(`Error getting zoom level: ${i.message}`)}}addMouseCoordControl(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new Bq(i),t)}catch(e){console.error(`Error adding mouse coordinate control: ${e.message}`)}}addGeolocateControl(i,t){try{t===void 0&&(t="top-right"),i===void 0?this.map.addControl(new Cn.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new Cn.GeolocateControl(i),t)}catch(e){console.error(`Error adding geolocate control: ${e.message}`)}}addFullscreenControl(i,t){try{t===void 0&&(t="top-right"),i===void 0?this.map.addControl(new Cn.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new Cn.FullscreenControl(i),t)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}getBounds(){try{return this.map.getBounds()}catch(i){console.error(`Error getting bounds: ${i.message}`)}}getCenter(){try{return this.map.getCenter()}catch(i){console.error(`Error getting center: ${i.message}`)}}setTerrain(i){try{return this.map.setTerrain(i)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(i,t,e){try{return this.map.setLayerZoomRange(i,t,e)}catch(r){console.error(`Error setting terrain: ${r.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(i){console.error(`Error getting canvas: ${i.message}`)}}setCenter(i){try{return this.map.setCenter(i)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(i,t){try{this.map.addLayer(i,t)}catch(e){console.error(`Error adding layer: ${e.message}`)}}addLayerGeoJSON(i,t){try{let e=this._dealOrderLayer(t);this.map.addSource(`${i.id}`,{type:"geojson",data:i.data}),this.map.addLayer({id:`${i.id}-layerIcgcMap`,type:i.layerType,source:`${i.id}`,layout:i.layout,paint:i.paint},e)}catch(e){console.error(`Error adding GeoJSON layer: ${e.message}`)}}addLayerWMS(i,t,e){try{let r=this._dealOrderLayer(e.layerPosition);e?(this.map.addSource(`${t}`,{type:"raster",tiles:[i],tileSize:256},r),this.map.addLayer({id:t,type:"raster",source:t,layout:e.layout,paint:e.paint},r)):(this.map.addSource(`${t}`,{type:"raster",tiles:[i],tileSize:256},r),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},r))}catch(r){console.error(`Error adding WMS layer: ${r.message}`)}}removeControl(i){try{this.map.removeControl(i)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(i){try{this.map.removeLayer(i)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(i){try{this.map.removeSource(i)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(i){try{let t=document.getElementById("map"),e;e=document.createElement("div"),e.id="logos",t.appendChild(e);const r=document.createElement("img");r.src=i.url,r.style.height=i.height;const s=document.getElementById("logos"),n=document.createElement("a");n.id=i.id,n.href=i.href,n.target="_blank",n.style.position="relative",n.style.bottom="1px",n.appendChild(r),s.appendChild(n)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(i){try{const t=n=>{this.map.setStyle(n)};let e=document.getElementById("map"),r;r=document.createElement("div"),r.id="basemap-group",r.classList.add="filter-group",e.appendChild(r);const s=document.getElementById("basemap-group");for(const n of i)for(const c of Object.keys(yr.baseStyles)){const l=yr.baseStyles[c];if(n===l.url){const f=document.createElement("div");f.className="basemap-item",f.title=l.key,f.style.backgroundImage=`url('${l.image}')`,s.appendChild(f),f.addEventListener("click",()=>t(l.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(i){try{const t=n=>{map.setStyle(n.url)};let e=document.getElementById("map"),r;r=document.createElement("div"),r.id="basemap-group",r.classList.add="basemap-group",e.appendChild(r);const s=document.getElementById("basemap-group");i.forEach(n=>{const c=document.createElement("div");c.className="basemap-item",c.title=n.label,c.style.backgroundImage=`url('${n.image}')`,s.appendChild(c),c.addEventListener("click",()=>t(n))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(i,t,e){try{let r;this.map.on("mouseenter",i,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",i,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let n=this.map.queryRenderedFeatures(s.point);if(n&&n[0].source.includes(i)){let c=[s.lngLat.lng,s.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let l="";t.forEach(f=>{let y=n[0].properties[f];l=l+`<h4>${y}</h4>`}),r=l,this.addPopup(c,r,e)}}else{let l="";for(const f in n[0].properties)l+="<b>"+f+"</b>:"+n[0].properties[f]+"<br>";r=l,this.addPopup(c,r,e)}}})}catch(r){console.error(`Error adding feature query: ${r.message}`)}}addScaleControl(i,t){try{var e=new Cn.ScaleControl(i);this.map.addControl(e,t)}catch(r){console.error(`Error adding scale: ${r.message}`)}}addExportControl(i,t){try{typeof i=="string"&&(t=i,i=void 0),i===void 0&&(i={PageSize:Cu.A4,PageOrientation:Wp.Landscape,Format:zc.PNG,DPI:q1[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},t="top-right"),this.map.addControl(new RV(i),t)}catch(e){console.error(`Error adding export control: ${e.message}`)}}addMarker(i){try{let t,e;return i.text===void 0?t=new Cn.Marker(i.options).setLngLat(i.coord).addTo(this.map):(e=new Cn.Popup({offset:i.textOffset}).setHTML(i.text),t=new Cn.Marker().setLngLat(i.coord).setPopup(e).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(i,t,e){try{return e.image===void 0?new Cn.Popup().setLngLat(i).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${e.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new Cn.Popup().setLngLat(i).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${e.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${e.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(r){return console.error(`Error adding popup: ${r.message}`),null}}addFullScreen(i){try{i===void 0&&(i="top-right"),this.map.addControl(new Cn.FullscreenControl,i)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(i){try{let t;if(i.includes("-userFieldFilter-")?t=i.split("-userFieldFilter-")[0]:t=i,i.length>0){const e=document.getElementById("menu-group"),r=document.createElement("input");r.type="checkbox",r.id=i,r.checked=!0,e.appendChild(r);const s=document.createElement("label");s.setAttribute("for",i),s.textContent=t,e.appendChild(s),r.addEventListener("change",n=>{this.map.setLayoutProperty(i,"visibility",n.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(i){try{let t=i.features,e=document.getElementById("map"),r=document.createElement("nav");r.id="filter-group",e.appendChild(r);const s=document.getElementById("filter-group");this.map.addSource(`${i.id}`,{type:i.type,data:t}),t.features.forEach(n=>{const c=n.properties.icon,l=`poi-${c}`;if(!this.map.getLayer(l)){this.map.addLayer({id:l,type:"circle",source:`${i.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",c]},this._firstSymbolLayer());const f=document.createElement("input");f.type="checkbox",f.id=l,f.checked=!0,s.appendChild(f);const y=document.createElement("label");y.setAttribute("for",l),y.textContent=c,s.appendChild(y),f.addEventListener("change",A=>{this.map.setLayoutProperty(l,"visibility",A.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Cn.NavigationControl(i),t)}catch(e){return console.error(`Error creating navigation control: ${e.message}`),null}}addNavigationControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Cn.NavigationControl(i),t)}catch(e){console.error(`Error adding navigation control: ${e.message}`)}}addAttributionControl(i,t){try{this.map.addControl(new Cn.AttributionControl(i),t)}catch(e){console.error(`Error adding attribution control: ${e.message}`)}}addImageLayerICGC(i,t,e){try{let r=null,s,n;e?(n=e,s=e.layerPosition):n={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:Ug},r=this._findImageType(i,Cs.Orto,Cs.VectorAdmin,Cs.WMS,Cs.Vector),r||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",i,"font-weight: bold; font-style: italic;");let c={id:t,tiles:i};this.addLayerWMS(i,t,n)}catch(r){console.error(`Error adding ICGC image layer: ${r.message}`)}}async addVectorLayerICGC(i,t,e){try{let{type:r="line",layerPosition:s=Ug,layoutOptions:n={visibility:"visible"},paintOption:c}=e||{},l=this._dealOrderLayer(s);if(!i){console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",i,"font-weight: bold; font-style: italic;");return}if(i.includes("https")){let f=this._getKeyByUrlVector(i);this.map.addSource(f,{type:"vector",url:i});let y={id:f,type:"fill",source:f,"source-layer":"cobertes",maxzoom:18,layout:e.layout,paint:$H.cobertesSol};if(f==="cobertes2018"&&this.map.addLayer(y,l),n.visibility==="visible"){let A=this._getLegendByName(f);console.info("legendUrl",A),console.info("sourceName",f),this.addLegend(A,f)}}else{let f=t;this.map.addSource(f,{type:"vector",url:yr.limitsUrl});let y={id:t,type:r,source:f,"source-layer":i,layout:e.layout,paint:e.paint||{}};r==="fill"||r==="polygon"?y.paint=c||{"fill-color":"#0000FF","fill-opacity":0}:r==="line"&&(y.paint=c||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(y,l)}}catch(r){console.error(`Error adding ICGC vector layer: ${r.message}`)}}async addFGBLayerICGC(i,t,e){try{e||(e.layout={visibility:!0},e.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},e.type="lines",e.layerPosition="labels");let r=this._dealOrderLayer(e.layerPosition);const s=await fetch(i),n={type:"FeatureCollection",features:[]};for await(const l of m2(s.body))n.features.push(l);let c=t;this.map.addSource(c,{type:"geojson",data:n}),i.includes("text")?this.map.addLayer({id:t,type:"symbol",source:c,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:e.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},r):this.map.addLayer({id:t,type:e.type,source:c,layout:e.layout,paint:e.paint},r)}catch(r){console.error(`Error adding ICGC FGB layer: ${r.message}`)}}addTerrainICGC(i,t){try{let e;for(const s in Gp)if(Gp.hasOwnProperty(s)){const n=Gp[s];n===i&&(e=n)}let r=e;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(s=>{s.source==="terrainICGC"&&this.removeLayer(s.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(i.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[r],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[r],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new TP({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(e){console.error(`Error adding 3D terrain: ${e.message}`)}}addLegend(i,t){try{this.map.addControl(new Iq({url:i,idLayer:t}))}catch(e){console.error(`Error adding legend: ${e.message}`)}}_findImageType(i,t,e,r,s){const n=[t,e,r,s];for(const c of n)for(const[l,f]of Object.entries(c))if(f===i)return l;return null}_getKeyByUrlFGB(i){for(const t in Cs.FGBAdmin)if(Cs.FGBAdmin.hasOwnProperty(t)&&Cs.FGBAdmin[t]===i)return t;return null}_getLegendByName(i){for(const t in yr.vectorLayers){const e=yr.vectorLayers[t];if(e.key===i)return e.legend}return null}_getKeyByUrlVector(i){for(const t in Cs.Vector)if(Cs.Vector.hasOwnProperty(t)&&Cs.Vector[t]===i)return t;return null}async _raiseText3DStyle(){try{const i=await this.map.loadImage(yr.map3dOptions.imageIcon);this.map.addImage("stick",i.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===yr.map3dOptions.sourceLayerFilterId&&t.minzoom>=yr.map3dOptions.minZoomFilter&&i){const e=t.id;this.map.setLayoutProperty(e,"icon-image","stick"),this.map.setLayoutProperty(e,"text-offset",[0,-9]),this.map.setLayoutProperty(e,"symbol-placement","point"),this.map.setLayoutProperty(e,"symbol-avoid-edges",!1),this.map.setLayoutProperty(e,"text-allow-overlap",!0),this.map.setLayoutProperty(e,"text-ignore-placement",!1),this.map.setLayoutProperty(e,"text-pitch-alignment","auto"),this.map.setLayoutProperty(e,"text-rotation-alignment","auto"),this.map.setLayoutProperty(e,"text-justify","center"),this.map.setLayoutProperty(e,"text-anchor","bottom"),this.map.setLayoutProperty(e,"icon-anchor","bottom"),this.map.setPaintProperty(e,"text-color","#ffffff"),this.map.setPaintProperty(e,"text-halo-color","#000000"),this.map.setPaintProperty(e,"text-halo-width",2)}})}catch(i){return console.error(`Error dealing orto 3D: ${i.message}`),null}}_dealStyleMaps(i){try{if(i&&i.indexOf("icgc.cat")!=-1){for(const t in _u)if(_u.hasOwnProperty(t)){const e=_u[t];if(t===i)return e}return _u[0]}else return i}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(i){try{if(i=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new O3({intensity:4}),e=new $_({ambientLight:t});this.map.setTerrain({source:yr.map3dOptions.terrainSource,exaggeration:yr.map3dOptions.exaggeration});const r=this._createCitiesMapboxLayer();this.map.getLayer(yr.map3dOptions.layerId3d)||(this.map.addLayer(r,yr.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(yr.map3dOptions.layerId3d,yr.map3dOptions.minZoomRange,yr.map3dOptions.maxZoomRange),r.deck.setProps({effects:[e]}),this._raiseText3DStyle())}else this.map.getLayer(yr.map3dOptions.layerId3d)&&(this.map.removeLayer(yr.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(i){return i===Ug?this._firstSymbolLayer():i===YH?this._firstLineLayer():""}_firstSymbolLayer(){try{const i=this.map.getStyle().layers;let t;for(let e=0;e<i.length;e++)if(i[e].type==="symbol"&&i[e].id.indexOf("contour")===-1&&i[e].id.indexOf("water")===-1){console.info(i[e].id),t=i[e].id;break}return t}catch(i){console.error(`Error getting first symbol layer: ${i.message}`)}}_firstLineLayer(){try{const i=this.map.getStyle().layers;let t;for(let e=0;e<i.length;e++)if(i[e].type==="line"){t=i[e].id;break}return t}catch(i){console.error(`Error getting first symbol layer: ${i.message}`)}}_createCitiesMapboxLayer(){try{return new nD({id:yr.map3dOptions.layerId3d,type:Cv,data:yr.map3dOptions.urlTilesetCities,loader:Ev,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:yr.map3dOptions.spaceErrorFactor}},onTilesetLoad:i=>{i.options.maximumScreenSpaceError=yr.map3dOptions.spaceErrorFactor},onTileLoad:i=>{i.content.cartographicOrigin.z-=yr.map3dOptions.zfactor},operation:"terrain+draw"})}catch(i){return console.error(`Error adding MapboxLayer: ${i.message}`),null}}};var QH={exports:{}};function tW(i,t){var e=i.getCenter(),r=i.getZoom(),s=i.getBearing(),n=i.getPitch();t.forEach(function(c){c.jumpTo({center:e,zoom:r,bearing:s,pitch:n})})}function eW(){var i,t=arguments.length;if(t===1)i=arguments[0];else{i=[];for(var e=0;e<t;e++)i.push(arguments[e])}var r=[];i.forEach(function(l,f){r[f]=c.bind(null,l,i.filter(function(y,A){return A!==f}))});function s(){i.forEach(function(l,f){l.on("move",r[f])})}function n(){i.forEach(function(l,f){l.off("move",r[f])})}function c(l,f){n(),tW(l,f),s()}return s(),function(){n(),r=[],i=[]}}var iW=eW;(function(i){var t=iW,e=zE.EventEmitter;function r(s,n,c,l){if(this.options=l||{},this._mapA=s,this._mapB=n,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new e,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof c=="string"&&document.body.querySelectorAll){var f=document.body.querySelectorAll(c)[0];if(!f)throw new Error("Cannot find element with specified container selector.");f.appendChild(this._controlContainer)}else if(c instanceof Element&&c.appendChild)c.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=n.getContainer().getBoundingClientRect();var y=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(y),this._clearSync=t(s,n),this._onResize=(function(){this._bounds=n.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),n.on("resize",this._onResize),this.options&&this.options.mousemove&&(s.getContainer().addEventListener("mousemove",this._onMove),n.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}r.prototype={_setPointerEvents:function(s){this._controlContainer.style.pointerEvents=s,this._swiper.style.pointerEvents=s},_onDown:function(s){s.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(s){s=Math.min(s,this._horizontal?this._bounds.height:this._bounds.width);var n=this._horizontal?"translate(0, "+s+"px)":"translate("+s+"px, 0)";this._controlContainer.style.transform=n,this._controlContainer.style.WebkitTransform=n;var c=this._horizontal?"rect(0, 999em, "+s+"px, 0)":"rect(0, "+s+"px, "+this._bounds.height+"px, 0)",l=this._horizontal?"rect("+s+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+s+"px)";this._mapA.getContainer().style.clip=c,this._mapB.getContainer().style.clip=l,this.currentPosition=s},_onMove:function(s){this.options&&this.options.mousemove&&this._setPointerEvents(s.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(s)):this._setPosition(this._getX(s))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(s){s=s.touches?s.touches[0]:s;var n=s.clientX-this._bounds.left;return n<0&&(n=0),n>this._bounds.width&&(n=this._bounds.width),n},_getY:function(s){s=s.touches?s.touches[0]:s;var n=s.clientY-this._bounds.top;return n<0&&(n=0),n>this._bounds.height&&(n=this._bounds.height),n},setSlider:function(s){this._setPosition(s)},on:function(s,n){return this._ev.on(s,n),this},fire:function(s,n){return this._ev.emit(s,n),this},off:function(s,n){return this._ev.removeListener(s,n),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var s=this._mapA.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove));var n=this._mapB.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=r:i.exports=r})(QH);let jg=1,md=null;async function rW(){try{const i=await hC.getConfigICGC(),t=new KH({container:"map",style:i.Styles.ORTO,center:[1.808,41.618],zoom:10,maxZoom:19,hash:!0,pitch:0});t.on("load",()=>{t.addGeocoderICGC(),t.addGeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0},"bottom-right"),t.addExportControl(),t.addFullscreenControl({},"top-right"),t.addTerrainICGC(i.Terrains.ICGC5M,"bottom-right"),t.addMouseCoordControl(["bottom-right"]);let e=[i.Styles.ORTO,i.Styles.TOPO,i.Styles.DARK,i.Styles.GEOLOGY];t.addBasemapsICGC(e);const r=document.getElementsByClassName("basemap-item");Array.from(r).forEach(y=>{y.addEventListener("click",s)});function s(){md&&setTimeout(()=>{t.addImageLayerICGC(n[md],`ortoexample${md}`,{type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":jg},layerPosition:"labels"})},2e3)}const n=i.Layers.Orto,c=document.getElementById("menuSelect");function l(y){return y.match(/[A-Z]?[a-z]+|[A-Z]+(?=[A-Z]|$)|\d+/g).join(" ")}for(const y in n)if(n.hasOwnProperty(y)){const A=document.createElement("option");A.value=y;let T=l(y);A.textContent=T,c.appendChild(A)}c.addEventListener("change",y=>{t.getStyle().layers.forEach(P=>{P.id.startsWith("ortoexample")&&(t.removeLayer(P.id),t.getSource(P.id)&&t.removeSource(P.id))});const T=y.target.value;T&&(console.log("ooooo",jg),t.addImageLayerICGC(n[T],`ortoexample${T}`,{type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":jg},layerPosition:"labels"}),md=T)});var f=document.getElementById("myRange");f.oninput=function(){if(md)try{let y=parseInt(this.value)/100;t.setPaintProperty(`ortoexample${md}`,"raster-opacity",y),jg=y}catch{}}})}catch(i){console.error(i)}}rW();export{Ur as j};
