(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const jT="modulepreload",UT=function(i){return"/"+i},Yb={},Jy=function(t,e,r){let s=Promise.resolve();if(e&&e.length>0){const n=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=Promise.all(e.map(f=>{if(f=UT(f),f in Yb)return;Yb[f]=!0;const y=f.endsWith(".css"),x=y?'[rel="stylesheet"]':"";if(!!r)for(let M=n.length-1;M>=0;M--){const N=n[M];if(N.href===f&&(!y||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${x}`))return;const P=document.createElement("link");if(P.rel=y?"stylesheet":jT,y||(P.as="script",P.crossOrigin=""),P.href=f,l&&P.setAttribute("nonce",l),document.head.appendChild(P),y)return new Promise((M,N)=>{P.addEventListener("load",M),P.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${f}`)))})}))}return s.then(()=>t()).catch(n=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n})};function GT(i,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in i)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(i,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}var vd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var dA={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(vd,function(){var e={},r={};function s(c,l,f){if(r[c]=f,c==="index"){var y="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",x={};return r.shared(x),r.index(e,x),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),e}}s("shared",["exports"],function(c){function l(h,o,u,p){return new(u||(u=Promise))(function(v,S){function C(j){try{k(p.next(j))}catch(q){S(q)}}function L(j){try{k(p.throw(j))}catch(q){S(q)}}function k(j){var q;j.done?v(j.value):(q=j.value,q instanceof u?q:new u(function(J){J(q)})).then(C,L)}k((p=p.apply(h,o||[])).next())})}function f(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var y=x;function x(h,o){this.x=h,this.y=o}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,o){return this.clone()._rotateAround(h,o)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var o=h.x-this.x,u=h.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,o){return Math.atan2(this.x*o-this.y*h,this.x*h+this.y*o)},_matMult:function(h){var o=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=o,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var o=Math.cos(h),u=Math.sin(h),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(h,o){var u=Math.cos(h),p=Math.sin(h),v=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(h){return h instanceof x?h:Array.isArray(h)?new x(h[0],h[1]):h};var T=f(y),P=M;function M(h,o,u,p){this.cx=3*h,this.bx=3*(u-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=o,this.p2x=u,this.p2y=p}M.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,o){if(o===void 0&&(o=1e-6),h<0)return 0;if(h>1)return 1;for(var u=h,p=0;p<8;p++){var v=this.sampleCurveX(u)-h;if(Math.abs(v)<o)return u;var S=this.sampleCurveDerivativeX(u);if(Math.abs(S)<1e-6)break;u-=v/S}var C=0,L=1;for(u=h,p=0;p<20&&(v=this.sampleCurveX(u),!(Math.abs(v-h)<o));p++)h>v?C=u:L=u,u=.5*(L-C)+C;return u},solve:function(h,o){return this.sampleCurveY(this.solveCurveX(h,o))}};var N=f(P);let G,Z;function X(){return G==null&&(G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),G}function $(){if(Z==null&&(Z=!1,X())){const h=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(h){for(let u=0;u<5*5;u++){const p=4*u;h.fillStyle=`rgb(${p},${p+1},${p+2})`,h.fillRect(u%5,Math.floor(u/5),1,1)}const o=h.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&o[u]!==u){Z=!0;break}}}return Z||!1}function ct(h,o,u,p){const v=new N(h,o,u,p);return function(S){return v.solve(S)}}const yt=ct(.25,.1,.25,1);function Mt(h,o,u){return Math.min(u,Math.max(o,h))}function Nt(h,o,u){const p=u-o,v=((h-o)%p+p)%p+o;return v===o?u:v}function Rt(h){for(var o=arguments.length,u=new Array(o>1?o-1:0),p=1;p<o;p++)u[p-1]=arguments[p];for(const v of u)for(const S in v)h[S]=v[S];return h}let xt=1;function qt(h,o,u){const p={};for(const v in h)p[v]=o.call(u||this,h[v],v,h);return p}function zt(h,o,u){const p={};for(const v in h)o.call(u||this,h[v],v,h)&&(p[v]=h[v]);return p}function ot(h){return Array.isArray(h)?h.map(ot):typeof h=="object"&&h?qt(h,ot):h}const dt={};function Lt(h){dt[h]||(typeof console<"u"&&console.warn(h),dt[h]=!0)}function wt(h,o,u){return(u.y-h.y)*(o.x-h.x)>(o.y-h.y)*(u.x-h.x)}function le(h){let o=0;for(let u,p,v=0,S=h.length,C=S-1;v<S;C=v++)u=h[v],p=h[C],o+=(p.x-u.x)*(u.y+p.y);return o}function oe(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let de=null;function te(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ge(h,o,u,p,v){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(h,{timestamp:0});try{const C=S==null?void 0:S.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);const L=C.startsWith("BGR"),k=new Uint8ClampedArray(p*v*4);if(yield S.copyTo(k,function(j,q,J,et,nt){const lt=4*Math.max(-q,0),gt=(Math.max(0,J)-J)*et*4+lt,St=4*et,Bt=Math.max(0,q),$t=Math.max(0,J);return{rect:{x:Bt,y:$t,width:Math.min(j.width,q+et)-Bt,height:Math.min(j.height,J+nt)-$t},layout:[{offset:gt,stride:St}]}}(h,o,u,p,v)),L)for(let j=0;j<k.length;j+=4){const q=k[j];k[j]=k[j+2],k[j+2]=q}return k}finally{S.close()}})}let ke,it;const Et="AbortError";function It(){return new Error(Et)}const Ut={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Xt(h){return Ut.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const Kt="global-dispatcher";class ie extends Error{constructor(o,u,p,v){super(`AJAXError: ${u} (${o}): ${p}`),this.status=o,this.statusText=u,this.url=p,this.body=v}}const Qt=()=>oe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ae=function(h,o){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const p=Xt(h.url);if(p)return p(h,o);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:Kt},o)}if(!(/^file:/.test(u=h.url)||/^file:/.test(Qt())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,v){return l(this,void 0,void 0,function*(){const S=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Qt(),signal:v.signal});p.type==="json"&&S.headers.set("Accept","application/json");const C=yield fetch(S);if(!C.ok){const j=yield C.blob();throw new ie(C.status,C.statusText,p.url,j)}let L;L=p.type==="arrayBuffer"||p.type==="image"?C.arrayBuffer():p.type==="json"?C.json():C.text();const k=yield L;if(v.signal.aborted)throw It();return{data:k,cacheControl:C.headers.get("Cache-Control"),expires:C.headers.get("Expires")}})}(h,o);if(oe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:Kt},o)}var u;return function(p,v){return new Promise((S,C)=>{const L=new XMLHttpRequest;L.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(L.responseType="arraybuffer");for(const k in p.headers)L.setRequestHeader(k,p.headers[k]);p.type==="json"&&(L.responseType="text",L.setRequestHeader("Accept","application/json")),L.withCredentials=p.credentials==="include",L.onerror=()=>{C(new Error(L.statusText))},L.onload=()=>{if(!v.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let k=L.response;if(p.type==="json")try{k=JSON.parse(L.response)}catch(j){return void C(j)}S({data:k,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const k=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});C(new ie(L.status,L.statusText,p.url,k))}},v.signal.addEventListener("abort",()=>{L.abort(),C(It())}),L.send(p.body)})}(h,o)};function Le(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const o=new URL(h),u=window.location;return o.protocol===u.protocol&&o.host===u.host}function Fe(h,o,u){u[h]&&u[h].indexOf(o)!==-1||(u[h]=u[h]||[],u[h].push(o))}function Ge(h,o,u){if(u&&u[h]){const p=u[h].indexOf(o);p!==-1&&u[h].splice(p,1)}}class Xe{constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rt(this,u),this.type=o}}class pe extends Xe{constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Rt({error:o},u))}}class Pt{on(o,u){return this._listeners=this._listeners||{},Fe(o,u,this._listeners),this}off(o,u){return Ge(o,u,this._listeners),Ge(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Fe(o,u,this._oneTimeListeners),this):new Promise(p=>this.once(o,p))}fire(o,u){typeof o=="string"&&(o=new Xe(o,u||{}));const p=o.type;if(this.listens(p)){o.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const L of v)L.call(this,o);const S=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const L of S)Ge(p,L,this._oneTimeListeners),L.call(this,o);const C=this._eventedParent;C&&(Rt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(o))}else o instanceof pe&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var Zt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pe(h,o){const u={};for(const p in h)p!=="ref"&&(u[p]=h[p]);return ii.forEach(p=>{p in o&&(u[p]=o[p])}),u}function ve(h,o){if(Array.isArray(h)){if(!Array.isArray(o)||h.length!==o.length)return!1;for(let u=0;u<h.length;u++)if(!ve(h[u],o[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&o!==null){if(typeof o!="object"||Object.keys(h).length!==Object.keys(o).length)return!1;for(const u in h)if(!ve(h[u],o[u]))return!1;return!0}return h===o}function Ee(h,o){h.push(o)}function Ve(h,o,u){Ee(u,{command:"addSource",args:[h,o[h]]})}function ai(h,o,u){Ee(o,{command:"removeSource",args:[h]}),u[h]=!0}function Ai(h,o,u,p){ai(h,u,p),Ve(h,o,u)}function Ti(h,o,u){let p;for(p in h[u])if(Object.prototype.hasOwnProperty.call(h[u],p)&&p!=="data"&&!ve(h[u][p],o[u][p]))return!1;for(p in o[u])if(Object.prototype.hasOwnProperty.call(o[u],p)&&p!=="data"&&!ve(h[u][p],o[u][p]))return!1;return!0}function Pi(h,o,u,p,v,S){h=h||{},o=o||{};for(const C in h)Object.prototype.hasOwnProperty.call(h,C)&&(ve(h[C],o[C])||u.push({command:S,args:[p,C,o[C],v]}));for(const C in o)Object.prototype.hasOwnProperty.call(o,C)&&!Object.prototype.hasOwnProperty.call(h,C)&&(ve(h[C],o[C])||u.push({command:S,args:[p,C,o[C],v]}))}function qi(h){return h.id}function Ji(h,o){return h[o.id]=o,h}class ce{constructor(o,u,p,v){this.message=(o?`${o}: `:"")+p,v&&(this.identifier=v),u!=null&&u.__line__&&(this.line=u.__line__)}}function Ei(h){for(var o=arguments.length,u=new Array(o>1?o-1:0),p=1;p<o;p++)u[p-1]=arguments[p];for(const v of u)for(const S in v)h[S]=v[S];return h}class Re extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}class jr{constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=o,this.bindings={};for(const[p,v]of u)this.bindings[p]=v}concat(o){return new jr(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Ci={kind:"null"},Te={kind:"number"},Ke={kind:"string"},Qe={kind:"boolean"},hr={kind:"color"},Di={kind:"object"},vi={kind:"value"},yr={kind:"collator"},sr={kind:"formatted"},vt={kind:"padding"},K={kind:"resolvedImage"},Y={kind:"variableAnchorOffsetCollection"};function st(h,o){return{kind:"array",itemType:h,N:o}}function _t(h){if(h.kind==="array"){const o=_t(h.itemType);return typeof h.N=="number"?`array<${o}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${o}>`}return h.kind}const kt=[Ci,Te,Ke,Qe,hr,sr,Di,st(vi),vt,K,Y];function Ft(h,o){if(o.kind==="error")return null;if(h.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Ft(h.itemType,o.itemType))&&(typeof h.N!="number"||h.N===o.N))return null}else{if(h.kind===o.kind)return null;if(h.kind==="value"){for(const u of kt)if(!Ft(u,o))return null}}return`Expected ${_t(h)} but found ${_t(o)} instead.`}function Vt(h,o){return o.some(u=>u.kind===h.kind)}function At(h,o){return o.some(u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h)}function Jt(h,o){return h.kind==="array"&&o.kind==="array"?h.itemType.kind===o.itemType.kind&&typeof h.N=="number":h.kind===o.kind}const ye=.96422,he=.82521,ae=4/29,qe=6/29,Je=3*qe*qe,bi=qe*qe*qe,si=Math.PI/180,Si=180/Math.PI;function Ni(h){return(h%=360)<0&&(h+=360),h}function Hi(h){let[o,u,p,v]=h,S,C;const L=li((.2225045*(o=nr(o))+.7168786*(u=nr(u))+.0606169*(p=nr(p)))/1);o===u&&u===p?S=C=L:(S=li((.4360747*o+.3850649*u+.1430804*p)/ye),C=li((.0139322*o+.0971045*u+.7141733*p)/he));const k=116*L-16;return[k<0?0:k,500*(S-L),200*(L-C),v]}function nr(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function li(h){return h>bi?Math.pow(h,1/3):h/Je+ae}function ji(h){let[o,u,p,v]=h,S=(o+16)/116,C=isNaN(u)?S:S+u/500,L=isNaN(p)?S:S-p/200;return S=1*Mr(S),C=ye*Mr(C),L=he*Mr(L),[ur(3.1338561*C-1.6168667*S-.4906146*L),ur(-.9787684*C+1.9161415*S+.033454*L),ur(.0719453*C-.2289914*S+1.4052427*L),v]}function ur(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function Mr(h){return h>qe?h*h*h:Je*(h-ae)}function Ur(h){return parseInt(h.padEnd(2,h),16)/255}function Er(h,o){return ks(o?h/100:h,0,1)}function ks(h,o,u){return Math.min(Math.max(o,h),u)}function qa(h){return!h.some(Number.isNaN)}const da={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Bi{constructor(o,u,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=o,this.g=u,this.b=p,this.a=v,S||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[o,u,p,v]))}static parse(o){if(o instanceof Bi)return o;if(typeof o!="string")return;const u=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=da[p];if(v){const[C,L,k]=v;return[C/255,L/255,k/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const C=p.length<6?1:2;let L=1;return[Ur(p.slice(L,L+=C)),Ur(p.slice(L,L+=C)),Ur(p.slice(L,L+=C)),Ur(p.slice(L,L+C)||"ff")]}if(p.startsWith("rgb")){const C=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(C){const[L,k,j,q,J,et,nt,lt,gt,St,Bt,$t]=C,Ot=[q||" ",nt||" ",St].join("");if(Ot==="  "||Ot==="  /"||Ot===",,"||Ot===",,,"){const Ht=[j,et,gt].join(""),_e=Ht==="%%%"?100:Ht===""?255:0;if(_e){const be=[ks(+k/_e,0,1),ks(+J/_e,0,1),ks(+lt/_e,0,1),Bt?Er(+Bt,$t):1];if(qa(be))return be}}return}}const S=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[C,L,k,j,q,J,et,nt,lt]=S,gt=[k||" ",q||" ",et].join("");if(gt==="  "||gt==="  /"||gt===",,"||gt===",,,"){const St=[+L,ks(+j,0,100),ks(+J,0,100),nt?Er(+nt,lt):1];if(qa(St))return function(Bt){let[$t,Ot,Ht,_e]=Bt;function be(He){const ri=(He+$t/30)%12,Ue=Ot*Math.min(Ht,1-Ht);return Ht-Ue*Math.max(-1,Math.min(ri-3,9-ri,1))}return $t=Ni($t),Ot/=100,Ht/=100,[be(0),be(8),be(4),_e]}(St)}}}(o);return u?new Bi(...u,!1):void 0}get rgb(){const{r:o,g:u,b:p,a:v}=this,S=v||1/0;return this.overwriteGetter("rgb",[o/S,u/S,p/S,v])}get hcl(){return this.overwriteGetter("hcl",function(o){const[u,p,v,S]=Hi(o),C=Math.sqrt(p*p+v*v);return[Math.round(1e4*C)?Ni(Math.atan2(v,p)*Si):NaN,C,u,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Hi(this.rgb))}overwriteGetter(o,u){return Object.defineProperty(this,o,{value:u}),u}toString(){const[o,u,p,v]=this.rgb;return`rgba(${[o,u,p].map(S=>Math.round(255*S)).join(",")},${v})`}}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1);class $s{constructor(o,u,p){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ks{constructor(o,u,p,v,S){this.text=o,this.image=u,this.scale=p,this.fontStack=v,this.textColor=S}}class Rr{constructor(o){this.sections=o}static fromString(o){return new Rr([new Ks(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Rr?o:Rr.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class Gr{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Gr)return o;if(typeof o=="number")return new Gr([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const u of o)if(typeof u!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new Gr(o)}}toString(){return JSON.stringify(this.values)}}const xs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kr{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof kr)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let u=0;u<o.length;u+=2){const p=o[u],v=o[u+1];if(typeof p!="string"||!xs.has(p)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new kr(o)}}toString(){return JSON.stringify(this.values)}}class Os{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Os({name:o,available:!1}):null}}function nn(h,o,u,p){return typeof h=="number"&&h>=0&&h<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[h,o,u,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[h,o,u,p]:[h,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function to(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof Bi||h instanceof $s||h instanceof Rr||h instanceof Gr||h instanceof kr||h instanceof Os)return!0;if(Array.isArray(h)){for(const o of h)if(!to(o))return!1;return!0}if(typeof h=="object"){for(const o in h)if(!to(h[o]))return!1;return!0}return!1}function xi(h){if(h===null)return Ci;if(typeof h=="string")return Ke;if(typeof h=="boolean")return Qe;if(typeof h=="number")return Te;if(h instanceof Bi)return hr;if(h instanceof $s)return yr;if(h instanceof Rr)return sr;if(h instanceof Gr)return vt;if(h instanceof kr)return Y;if(h instanceof Os)return K;if(Array.isArray(h)){const o=h.length;let u;for(const p of h){const v=xi(p);if(u){if(u===v)continue;u=vi;break}u=v}return st(u||vi,o)}return Di}function wn(h){const o=typeof h;return h===null?"":o==="string"||o==="number"||o==="boolean"?String(h):h instanceof Bi||h instanceof Rr||h instanceof Gr||h instanceof kr||h instanceof Os?h.toString():JSON.stringify(h)}class Ys{constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(o.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!to(o[1]))return u.error("invalid value");const p=o[1];let v=xi(p);const S=u.expectedType;return v.kind!=="array"||v.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(v=S),new Ys(v,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class dr{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Rn={string:Ke,number:Te,boolean:Qe,object:Di};class ds{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let p,v=1;const S=o[0];if(S==="array"){let L,k;if(o.length>2){const j=o[1];if(typeof j!="string"||!(j in Rn)||j==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);L=Rn[j],v++}else L=vi;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);k=o[2],v++}p=st(L,k)}else{if(!Rn[S])throw new Error(`Types doesn't contain name = ${S}`);p=Rn[S]}const C=[];for(;v<o.length;v++){const L=u.parse(o[v],v,vi);if(!L)return null;C.push(L)}return new ds(p,C)}evaluate(o){for(let u=0;u<this.args.length;u++){const p=this.args[u].evaluate(o);if(!Ft(this.type,xi(p)))return p;if(u===this.args.length-1)throw new dr(`Expected value to be of type ${_t(this.type)}, but found ${_t(xi(p))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const ps={"to-boolean":Qe,"to-color":hr,"to-number":Te,"to-string":Ke};class Or{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const p=o[0];if(!ps[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&o.length!==2)return u.error("Expected one argument.");const v=ps[p],S=[];for(let C=1;C<o.length;C++){const L=u.parse(o[C],C,vi);if(!L)return null;S.push(L)}return new Or(v,S)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let u,p;for(const v of this.args){if(u=v.evaluate(o),p=null,u instanceof Bi)return u;if(typeof u=="string"){const S=o.parseColor(u);if(S)return S}else if(Array.isArray(u)&&(p=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:nn(u[0],u[1],u[2],u[3]),!p))return new Bi(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new dr(p||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const p of this.args){u=p.evaluate(o);const v=Gr.parse(u);if(v)return v}throw new dr(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const p of this.args){u=p.evaluate(o);const v=kr.parse(u);if(v)return v}throw new dr(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const p of this.args){if(u=p.evaluate(o),u===null)return 0;const v=Number(u);if(!isNaN(v))return v}throw new dr(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Rr.fromString(wn(this.args[0].evaluate(o)));case"resolvedImage":return Os.fromString(wn(this.args[0].evaluate(o)));default:return wn(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const hs=["Unknown","Point","LineString","Polygon"];class Zi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?hs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Bi.parse(o)),u}}class eo{constructor(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],v=arguments.length>3?arguments[3]:void 0,S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new jr,C=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=o,this.path=p,this.key=p.map(L=>`[${L}]`).join(""),this.scope=S,this.errors=C,this.expectedType=v,this._isConstant=u}parse(o,u,p,v){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return u?this.concat(u,p,v)._parse(o,S):this._parse(o,S)}_parse(o,u){function p(v,S,C){return C==="assert"?new ds(S,[v]):C==="coerce"?new Or(S,[v]):v}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=o[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[v];if(S){let C=S.parse(o,this);if(!C)return null;if(this.expectedType){const L=this.expectedType,k=C.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||k.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(L.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(L,k))return null}else C=p(C,L,u.typeAnnotation||"coerce");else C=p(C,L,u.typeAnnotation||"coerce");else C=p(C,L,u.typeAnnotation||"coerce");else C=p(C,L,u.typeAnnotation||"assert")}if(!(C instanceof Ys)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){const L=new Zi;try{C=new Ys(C.type,C.evaluate(L))}catch(k){return this.error(k.message),null}}return C}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,p){const v=typeof o=="number"?this.path.concat(o):this.path,S=p?this.scope.concat(p):this.scope;return new eo(this.registry,this._isConstant,v,u||null,S,this.errors)}error(o){for(var u=arguments.length,p=new Array(u>1?u-1:0),v=1;v<u;v++)p[v-1]=arguments[v];const S=`${this.key}${p.map(C=>`[${C}]`).join("")}`;this.errors.push(new Re(S,o))}checkSubtype(o,u){const p=Ft(o,u);return p&&this.error(p),p}}class io{constructor(o,u,p){this.type=yr,this.locale=p,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(o.length!==2)return u.error("Expected one argument.");const p=o[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");const v=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Qe);if(!v)return null;const S=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Qe);if(!S)return null;let C=null;return p.locale&&(C=u.parse(p.locale,1,Ke),!C)?null:new io(v,S,C)}evaluate(o){return new $s(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const xn=8192;function pa(h,o){h[0]=Math.min(h[0],o[0]),h[1]=Math.min(h[1],o[1]),h[2]=Math.max(h[2],o[0]),h[3]=Math.max(h[3],o[1])}function rt(h,o){return!(h[0]<=o[0]||h[2]>=o[2]||h[1]<=o[1]||h[3]>=o[3])}function mt(h,o){const u=(180+h[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,v=Math.pow(2,o.z);return[Math.round(u*v*xn),Math.round(p*v*xn)]}function Dt(h,o,u){const p=h[0]-o[0],v=h[1]-o[1],S=h[0]-u[0],C=h[1]-u[1];return p*C-S*v==0&&p*S<=0&&v*C<=0}function ue(h,o){let u=!1;for(let C=0,L=o.length;C<L;C++){const k=o[C];for(let j=0,q=k.length;j<q-1;j++){if(Dt(h,k[j],k[j+1]))return!1;(v=k[j])[1]>(p=h)[1]!=(S=k[j+1])[1]>p[1]&&p[0]<(S[0]-v[0])*(p[1]-v[1])/(S[1]-v[1])+v[0]&&(u=!u)}}var p,v,S;return u}function Se(h,o){for(let u=0;u<o.length;u++)if(ue(h,o[u]))return!0;return!1}function gi(h,o,u,p){const v=p[0]-u[0],S=p[1]-u[1],C=(h[0]-u[0])*S-v*(h[1]-u[1]),L=(o[0]-u[0])*S-v*(o[1]-u[1]);return C>0&&L<0||C<0&&L>0}function Mi(h,o,u){for(const j of u)for(let q=0;q<j.length-1;++q)if((L=[(C=j[q+1])[0]-(S=j[q])[0],C[1]-S[1]])[0]*(k=[(v=o)[0]-(p=h)[0],v[1]-p[1]])[1]-L[1]*k[0]!=0&&gi(p,v,S,C)&&gi(S,C,p,v))return!0;var p,v,S,C,L,k;return!1}function pr(h,o){for(let u=0;u<h.length;++u)if(!ue(h[u],o))return!1;for(let u=0;u<h.length-1;++u)if(Mi(h[u],h[u+1],o))return!1;return!0}function fs(h,o){for(let u=0;u<o.length;u++)if(pr(h,o[u]))return!0;return!1}function rs(h,o,u){const p=[];for(let v=0;v<h.length;v++){const S=[];for(let C=0;C<h[v].length;C++){const L=mt(h[v][C],u);pa(o,L),S.push(L)}p.push(S)}return p}function Ar(h,o,u){const p=[];for(let v=0;v<h.length;v++){const S=rs(h[v],o,u);p.push(S)}return p}function rh(h,o,u,p){if(h[0]<u[0]||h[0]>u[2]){const v=.5*p;let S=h[0]-u[0]>v?-p:u[0]-h[0]>v?p:0;S===0&&(S=h[0]-u[2]>v?-p:u[2]-h[0]>v?p:0),h[0]+=S}pa(o,h)}function Ha(h,o,u,p){const v=Math.pow(2,p.z)*xn,S=[p.x*xn,p.y*xn],C=[];for(const L of h)for(const k of L){const j=[k.x+S[0],k.y+S[1]];rh(j,o,u,v),C.push(j)}return C}function Li(h,o,u,p){const v=Math.pow(2,p.z)*xn,S=[p.x*xn,p.y*xn],C=[];for(const k of h){const j=[];for(const q of k){const J=[q.x+S[0],q.y+S[1]];pa(o,J),j.push(J)}C.push(j)}if(o[2]-o[0]<=v/2){(L=o)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const k of C)for(const j of k)rh(j,o,u,v)}var L;return C}class Vo{constructor(o,u){this.type=Qe,this.geojson=o,this.geometries=u}static parse(o,u){if(o.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(to(o[1])){const p=o[1];if(p.type==="FeatureCollection"){const v=[];for(const S of p.features){const{type:C,coordinates:L}=S.geometry;C==="Polygon"&&v.push(L),C==="MultiPolygon"&&v.push(...L)}if(v.length)return new Vo(p,{type:"MultiPolygon",coordinates:v})}else if(p.type==="Feature"){const v=p.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Vo(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Vo(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,p){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=u.canonicalID();if(p.type==="Polygon"){const L=rs(p.coordinates,S,C),k=Ha(u.geometry(),v,S,C);if(!rt(v,S))return!1;for(const j of k)if(!ue(j,L))return!1}if(p.type==="MultiPolygon"){const L=Ar(p.coordinates,S,C),k=Ha(u.geometry(),v,S,C);if(!rt(v,S))return!1;for(const j of k)if(!Se(j,L))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,p){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=u.canonicalID();if(p.type==="Polygon"){const L=rs(p.coordinates,S,C),k=Li(u.geometry(),v,S,C);if(!rt(v,S))return!1;for(const j of k)if(!pr(j,L))return!1}if(p.type==="MultiPolygon"){const L=Ar(p.coordinates,S,C),k=Li(u.geometry(),v,S,C);if(!rt(v,S))return!1;for(const j of k)if(!fs(j,L))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class kl{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const p=o[1];return u.scope.has(p)?new kl(p,u.scope.get(p)):u.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class ts{constructor(o,u,p,v){this.name=o,this.type=u,this._evaluate=p,this.args=v}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,u){const p=o[0],v=ts.definitions[p];if(!v)return u.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(v)?v[0]:v.type,C=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,L=C.filter(j=>{let[q]=j;return!Array.isArray(q)||q.length===o.length-1});let k=null;for(const[j,q]of L){k=new eo(u.registry,fa,u.path,null,u.scope);const J=[];let et=!1;for(let nt=1;nt<o.length;nt++){const lt=o[nt],gt=Array.isArray(j)?j[nt-1]:j.type,St=k.parse(lt,1+J.length,gt);if(!St){et=!0;break}J.push(St)}if(!et)if(Array.isArray(j)&&j.length!==J.length)k.error(`Expected ${j.length} arguments, but found ${J.length} instead.`);else{for(let nt=0;nt<J.length;nt++){const lt=Array.isArray(j)?j[nt]:j.type,gt=J[nt];k.concat(nt+1).checkSubtype(lt,gt.type)}if(k.errors.length===0)return new ts(p,S,q,J)}}if(L.length===1)u.errors.push(...k.errors);else{const j=(L.length?L:C).map(J=>{let[et]=J;return nt=et,Array.isArray(nt)?`(${nt.map(_t).join(", ")})`:`(${_t(nt.type)}...)`;var nt}).join(" | "),q=[];for(let J=1;J<o.length;J++){const et=u.parse(o[J],1+q.length);if(!et)return null;q.push(_t(et.type))}u.error(`Expected arguments of type ${j}, but found (${q.join(", ")}) instead.`)}return null}static register(o,u){ts.definitions=u;for(const p in u)o[p]=ts}}function fa(h){if(h instanceof kl)return fa(h.boundExpression);if(h instanceof ts&&h.name==="error"||h instanceof io||h instanceof Vo)return!1;const o=h instanceof Or||h instanceof ds;let u=!0;return h.eachChild(p=>{u=o?u&&fa(p):u&&p instanceof Ys}),!!u&&Wa(h)&&qo(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wa(h){if(h instanceof ts&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Vo)return!1;let o=!0;return h.eachChild(u=>{o&&!Wa(u)&&(o=!1)}),o}function So(h){if(h instanceof ts&&h.name==="feature-state")return!1;let o=!0;return h.eachChild(u=>{o&&!So(u)&&(o=!1)}),o}function qo(h,o){if(h instanceof ts&&o.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild(p=>{u&&!qo(p,o)&&(u=!1)}),u}function Ja(h,o){const u=h.length-1;let p,v,S=0,C=u,L=0;for(;S<=C;)if(L=Math.floor((S+C)/2),p=h[L],v=h[L+1],p<=o){if(L===u||o<v)return L;S=L+1}else{if(!(p>o))throw new dr("Input is not a number.");C=L-1}return 0}class Za{constructor(o,u,p){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[v,S]of p)this.labels.push(v),this.outputs.push(S)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const p=u.parse(o[1],1,Te);if(!p)return null;const v=[];let S=null;u.expectedType&&u.expectedType.kind!=="value"&&(S=u.expectedType);for(let C=1;C<o.length;C+=2){const L=C===1?-1/0:o[C],k=o[C+1],j=C,q=C+1;if(typeof L!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(v.length&&v[v.length-1][0]>=L)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);const J=u.parse(k,q,S);if(!J)return null;S=S||J.type,v.push([L,J])}return new Za(S,p,v)}evaluate(o){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(o);const v=this.input.evaluate(o);if(v<=u[0])return p[0].evaluate(o);const S=u.length;return v>=u[S-1]?p[S-1].evaluate(o):p[Ja(u,v)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Jh(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var gc=ga;function ga(h,o,u,p){this.cx=3*h,this.bx=3*(u-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=o,this.p2x=u,this.p2y=p}ga.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,o){if(o===void 0&&(o=1e-6),h<0)return 0;if(h>1)return 1;for(var u=h,p=0;p<8;p++){var v=this.sampleCurveX(u)-h;if(Math.abs(v)<o)return u;var S=this.sampleCurveDerivativeX(u);if(Math.abs(S)<1e-6)break;u-=v/S}var C=0,L=1;for(u=h,p=0;p<20&&(v=this.sampleCurveX(u),!(Math.abs(v-h)<o));p++)h>v?C=u:L=u,u=.5*(L-C)+C;return u},solve:function(h,o){return this.sampleCurveY(this.solveCurveX(h,o))}};var ma=Jh(gc);function Ho(h,o,u){return h+u*(o-h)}function Eo(h,o,u){return h.map((p,v)=>Ho(p,o[v],u))}const gs={number:Ho,color:function(h,o,u){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[p,v,S,C]=Eo(h.rgb,o.rgb,u);return new Bi(p,v,S,C,!1)}case"hcl":{const[p,v,S,C]=h.hcl,[L,k,j,q]=o.hcl;let J,et;if(isNaN(p)||isNaN(L))isNaN(p)?isNaN(L)?J=NaN:(J=L,S!==1&&S!==0||(et=k)):(J=p,j!==1&&j!==0||(et=v));else{let Bt=L-p;L>p&&Bt>180?Bt-=360:L<p&&p-L>180&&(Bt+=360),J=p+u*Bt}const[nt,lt,gt,St]=function(Bt){let[$t,Ot,Ht,_e]=Bt;return $t=isNaN($t)?0:$t*si,ji([Ht,Math.cos($t)*Ot,Math.sin($t)*Ot,_e])}([J,et??Ho(v,k,u),Ho(S,j,u),Ho(C,q,u)]);return new Bi(nt,lt,gt,St,!1)}case"lab":{const[p,v,S,C]=ji(Eo(h.lab,o.lab,u));return new Bi(p,v,S,C,!1)}}},array:Eo,padding:function(h,o,u){return new Gr(Eo(h.values,o.values,u))},variableAnchorOffsetCollection:function(h,o,u){const p=h.values,v=o.values;if(p.length!==v.length)throw new dr(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${o.toString()}`);const S=[];for(let C=0;C<p.length;C+=2){if(p[C]!==v[C])throw new dr(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${p[C]}, to[${C}]: ${v[C]}`);S.push(p[C]);const[L,k]=p[C+1],[j,q]=v[C+1];S.push([Ho(L,j,u),Ho(k,q,u)])}return new kr(S)}};class ss{constructor(o,u,p,v,S){this.type=o,this.operator=u,this.interpolation=p,this.input=v,this.labels=[],this.outputs=[];for(const[C,L]of S)this.labels.push(C),this.outputs.push(L)}static interpolationFactor(o,u,p,v){let S=0;if(o.name==="exponential")S=Xi(u,o.base,p,v);else if(o.name==="linear")S=Xi(u,1,p,v);else if(o.name==="cubic-bezier"){const C=o.controlPoints;S=new ma(C[0],C[1],C[2],C[3]).solve(Xi(u,1,p,v))}return S}static parse(o,u){let[p,v,S,...C]=o;if(!Array.isArray(v)||v.length===0)return u.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const j=v[1];if(typeof j!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:j}}else{if(v[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const j=v.slice(1);if(j.length!==4||j.some(q=>typeof q!="number"||q<0||q>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:j}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(S=u.parse(S,2,Te),!S)return null;const L=[];let k=null;p==="interpolate-hcl"||p==="interpolate-lab"?k=hr:u.expectedType&&u.expectedType.kind!=="value"&&(k=u.expectedType);for(let j=0;j<C.length;j+=2){const q=C[j],J=C[j+1],et=j+3,nt=j+4;if(typeof q!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',et);if(L.length&&L[L.length-1][0]>=q)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',et);const lt=u.parse(J,nt,k);if(!lt)return null;k=k||lt.type,L.push([q,lt])}return Jt(k,Te)||Jt(k,hr)||Jt(k,vt)||Jt(k,Y)||Jt(k,st(Te))?new ss(k,p,v,S,L):u.error(`Type ${_t(k)} is not interpolatable.`)}evaluate(o){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(o);const v=this.input.evaluate(o);if(v<=u[0])return p[0].evaluate(o);const S=u.length;if(v>=u[S-1])return p[S-1].evaluate(o);const C=Ja(u,v),L=ss.interpolationFactor(this.interpolation,v,u[C],u[C+1]),k=p[C].evaluate(o),j=p[C+1].evaluate(o);switch(this.operator){case"interpolate":return gs[this.type.kind](k,j,L);case"interpolate-hcl":return gs.color(k,j,L,"hcl");case"interpolate-lab":return gs.color(k,j,L,"lab")}}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Xi(h,o,u,p){const v=p-u,S=h-u;return v===0?0:o===1?S/v:(Math.pow(o,S)-1)/(Math.pow(o,v)-1)}class Xa{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expectected at least one argument.");let p=null;const v=u.expectedType;v&&v.kind!=="value"&&(p=v);const S=[];for(const L of o.slice(1)){const k=u.parse(L,1+S.length,p,void 0,{typeAnnotation:"omit"});if(!k)return null;p=p||k.type,S.push(k)}if(!p)throw new Error("No output type");const C=v&&S.some(L=>Ft(v,L.type));return new Xa(C?vi:p,S)}evaluate(o){let u,p=null,v=0;for(const S of this.args)if(v++,p=S.evaluate(o),p&&p instanceof Os&&!p.available&&(u||(u=p.name),p=null,v===this.args.length&&(p=u)),p!==null)break;return p}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class $a{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const p=[];for(let S=1;S<o.length-1;S+=2){const C=o[S];if(typeof C!="string")return u.error(`Expected string, but found ${typeof C} instead.`,S);if(/[^a-zA-Z0-9_]/.test(C))return u.error("Variable names must contain only alphanumeric characters or '_'.",S);const L=u.parse(o[S+1],S+1);if(!L)return null;p.push([C,L])}const v=u.parse(o[o.length-1],o.length-1,u.expectedType,p);return v?new $a(p,v):null}outputDefined(){return this.result.outputDefined()}}class Ol{constructor(o,u,p){this.type=o,this.index=u,this.input=p}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,Te),v=u.parse(o[2],2,st(u.expectedType||vi));return p&&v?new Ol(v.type.itemType,p,v):null}evaluate(o){const u=this.index.evaluate(o),p=this.input.evaluate(o);if(u<0)throw new dr(`Array index out of bounds: ${u} < 0.`);if(u>=p.length)throw new dr(`Array index out of bounds: ${u} > ${p.length-1}.`);if(u!==Math.floor(u))throw new dr(`Array index must be an integer, but found ${u} instead.`);return p[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class ro{constructor(o,u){this.type=Qe,this.needle=o,this.haystack=u}static parse(o,u){if(o.length!==3)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,vi),v=u.parse(o[2],2,vi);return p&&v?Vt(p.type,[Qe,Ke,Te,Ci,vi])?new ro(p,v):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${_t(p.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!p)return!1;if(!At(u,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${_t(xi(u))} instead.`);if(!At(p,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${_t(xi(p))} instead.`);return p.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class so{constructor(o,u,p){this.type=Te,this.needle=o,this.haystack=u,this.fromIndex=p}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,vi),v=u.parse(o[2],2,vi);if(!p||!v)return null;if(!Vt(p.type,[Qe,Ke,Te,Ci,vi]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${_t(p.type)} instead`);if(o.length===4){const S=u.parse(o[3],3,Te);return S?new so(p,v,S):null}return new so(p,v)}evaluate(o){const u=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!At(u,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${_t(xi(u))} instead.`);if(!At(p,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${_t(xi(p))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(o);return p.indexOf(u,v)}return p.indexOf(u)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class mc{constructor(o,u,p,v,S,C){this.inputType=o,this.type=u,this.input=p,this.cases=v,this.outputs=S,this.otherwise=C}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let p,v;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);const S={},C=[];for(let j=2;j<o.length-1;j+=2){let q=o[j];const J=o[j+1];Array.isArray(q)||(q=[q]);const et=u.concat(j);if(q.length===0)return et.error("Expected at least one branch label.");for(const lt of q){if(typeof lt!="number"&&typeof lt!="string")return et.error("Branch labels must be numbers or strings.");if(typeof lt=="number"&&Math.abs(lt)>Number.MAX_SAFE_INTEGER)return et.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof lt=="number"&&Math.floor(lt)!==lt)return et.error("Numeric branch labels must be integer values.");if(p){if(et.checkSubtype(p,xi(lt)))return null}else p=xi(lt);if(S[String(lt)]!==void 0)return et.error("Branch labels must be unique.");S[String(lt)]=C.length}const nt=u.parse(J,j,v);if(!nt)return null;v=v||nt.type,C.push(nt)}const L=u.parse(o[1],1,vi);if(!L)return null;const k=u.parse(o[o.length-1],o.length-1,v);return k?L.type.kind!=="value"&&u.concat(1).checkSubtype(p,L.type)?null:new mc(p,v,L,S,C,k):null}evaluate(o){const u=this.input.evaluate(o);return(xi(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class Co{constructor(o,u,p){this.type=o,this.branches=u,this.otherwise=p}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);const v=[];for(let C=1;C<o.length-1;C+=2){const L=u.parse(o[C],C,Qe);if(!L)return null;const k=u.parse(o[C+1],C+1,p);if(!k)return null;v.push([L,k]),p=p||k.type}const S=u.parse(o[o.length-1],o.length-1,p);if(!S)return null;if(!p)throw new Error("Can't infer output type");return new Co(p,v,S)}evaluate(o){for(const[u,p]of this.branches)if(u.evaluate(o))return p.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,p]of this.branches)o(u),o(p);o(this.otherwise)}outputDefined(){return this.branches.every(o=>{let[u,p]=o;return p.outputDefined()})&&this.otherwise.outputDefined()}}class on{constructor(o,u,p,v){this.type=o,this.input=u,this.beginIndex=p,this.endIndex=v}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=u.parse(o[1],1,vi),v=u.parse(o[2],2,Te);if(!p||!v)return null;if(!Vt(p.type,[st(vi),Ke,vi]))return u.error(`Expected first argument to be of type array or string, but found ${_t(p.type)} instead`);if(o.length===4){const S=u.parse(o[3],3,Te);return S?new on(p.type,p,v,S):null}return new on(p.type,p,v)}evaluate(o){const u=this.input.evaluate(o),p=this.beginIndex.evaluate(o);if(!At(u,["string","array"]))throw new dr(`Expected first argument to be of type array or string, but found ${_t(xi(u))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(o);return u.slice(p,v)}return u.slice(p)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Dl(h,o){return h==="=="||h==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function ya(h,o,u,p){return p.compare(o,u)===0}function _a(h,o,u){const p=h!=="=="&&h!=="!=";return class pA{constructor(S,C,L){this.type=Qe,this.lhs=S,this.rhs=C,this.collator=L,this.hasUntypedArgument=S.type.kind==="value"||C.type.kind==="value"}static parse(S,C){if(S.length!==3&&S.length!==4)return C.error("Expected two or three arguments.");const L=S[0];let k=C.parse(S[1],1,vi);if(!k)return null;if(!Dl(L,k.type))return C.concat(1).error(`"${L}" comparisons are not supported for type '${_t(k.type)}'.`);let j=C.parse(S[2],2,vi);if(!j)return null;if(!Dl(L,j.type))return C.concat(2).error(`"${L}" comparisons are not supported for type '${_t(j.type)}'.`);if(k.type.kind!==j.type.kind&&k.type.kind!=="value"&&j.type.kind!=="value")return C.error(`Cannot compare types '${_t(k.type)}' and '${_t(j.type)}'.`);p&&(k.type.kind==="value"&&j.type.kind!=="value"?k=new ds(j.type,[k]):k.type.kind!=="value"&&j.type.kind==="value"&&(j=new ds(k.type,[j])));let q=null;if(S.length===4){if(k.type.kind!=="string"&&j.type.kind!=="string"&&k.type.kind!=="value"&&j.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(q=C.parse(S[3],3,yr),!q)return null}return new pA(k,j,q)}evaluate(S){const C=this.lhs.evaluate(S),L=this.rhs.evaluate(S);if(p&&this.hasUntypedArgument){const k=xi(C),j=xi(L);if(k.kind!==j.kind||k.kind!=="string"&&k.kind!=="number")throw new dr(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${k.kind}, ${j.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const k=xi(C),j=xi(L);if(k.kind!=="string"||j.kind!=="string")return o(S,C,L)}return this.collator?u(S,C,L,this.collator.evaluate(S)):o(S,C,L)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const Nl=_a("==",function(h,o,u){return o===u},ya),Zh=_a("!=",function(h,o,u){return o!==u},function(h,o,u,p){return!ya(0,o,u,p)}),yc=_a("<",function(h,o,u){return o<u},function(h,o,u,p){return p.compare(o,u)<0}),_c=_a(">",function(h,o,u){return o>u},function(h,o,u,p){return p.compare(o,u)>0}),sh=_a("<=",function(h,o,u){return o<=u},function(h,o,u,p){return p.compare(o,u)<=0}),Fl=_a(">=",function(h,o,u){return o>=u},function(h,o,u,p){return p.compare(o,u)>=0});class Ka{constructor(o,u,p,v,S){this.type=Ke,this.number=o,this.locale=u,this.currency=p,this.minFractionDigits=v,this.maxFractionDigits=S}static parse(o,u){if(o.length!==3)return u.error("Expected two arguments.");const p=u.parse(o[1],1,Te);if(!p)return null;const v=o[2];if(typeof v!="object"||Array.isArray(v))return u.error("NumberFormat options argument must be an object.");let S=null;if(v.locale&&(S=u.parse(v.locale,1,Ke),!S))return null;let C=null;if(v.currency&&(C=u.parse(v.currency,1,Ke),!C))return null;let L=null;if(v["min-fraction-digits"]&&(L=u.parse(v["min-fraction-digits"],1,Te),!L))return null;let k=null;return v["max-fraction-digits"]&&(k=u.parse(v["max-fraction-digits"],1,Te),!k)?null:new Ka(p,S,C,L,k)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class va{constructor(o){this.type=sr,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const p=o[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");const v=[];let S=!1;for(let C=1;C<=o.length-1;++C){const L=o[C];if(S&&typeof L=="object"&&!Array.isArray(L)){S=!1;let k=null;if(L["font-scale"]&&(k=u.parse(L["font-scale"],1,Te),!k))return null;let j=null;if(L["text-font"]&&(j=u.parse(L["text-font"],1,st(Ke)),!j))return null;let q=null;if(L["text-color"]&&(q=u.parse(L["text-color"],1,hr),!q))return null;const J=v[v.length-1];J.scale=k,J.font=j,J.textColor=q}else{const k=u.parse(o[C],1,vi);if(!k)return null;const j=k.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,v.push({content:k,scale:null,font:null,textColor:null})}}return new va(v)}evaluate(o){return new Rr(this.sections.map(u=>{const p=u.content.evaluate(o);return xi(p)===K?new Ks("",p,null,null,null):new Ks(wn(p),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor)}outputDefined(){return!1}}class zl{constructor(o){this.type=K,this.input=o}static parse(o,u){if(o.length!==2)return u.error("Expected two arguments.");const p=u.parse(o[1],1,Ke);return p?new zl(p):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),p=Os.fromString(u);return p&&o.availableImages&&(p.available=o.availableImages.indexOf(u)>-1),p}eachChild(o){o(this.input)}outputDefined(){return!1}}class vc{constructor(o){this.type=Te,this.input=o}static parse(o,u){if(o.length!==2)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const p=u.parse(o[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${_t(p.type)} instead.`):new vc(p):null}evaluate(o){const u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new dr(`Expected value to be of type string or array, but found ${_t(xi(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const no={"==":Nl,"!=":Zh,">":_c,"<":yc,">=":Fl,"<=":sh,array:ds,at:Ol,boolean:ds,case:Co,coalesce:Xa,collator:io,format:va,image:zl,in:ro,"index-of":so,interpolate:ss,"interpolate-hcl":ss,"interpolate-lab":ss,length:vc,let:$a,literal:Ys,match:mc,number:ds,"number-format":Ka,object:ds,slice:on,step:Za,string:ds,"to-boolean":Or,"to-color":Or,"to-number":Or,"to-string":Or,var:kl,within:Vo};function ba(h,o){let[u,p,v,S]=o;u=u.evaluate(h),p=p.evaluate(h),v=v.evaluate(h);const C=S?S.evaluate(h):1,L=nn(u,p,v,C);if(L)throw new dr(L);return new Bi(u/255,p/255,v/255,C,!1)}function jl(h,o){return h in o}function To(h,o){const u=o[h];return u===void 0?null:u}function oo(h){return{type:h}}function D(h){return{result:"success",value:h}}function Q(h){return{result:"error",value:h}}function Ct(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function Gt(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Yt(h){return!!h.expression&&h.expression.interpolated}function ee(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Ie(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function ti(h){return h}function wi(h,o){const u=o.type==="color",p=h.stops&&typeof h.stops[0][0]=="object",v=p||!(p||h.property!==void 0),S=h.type||(Yt(o)?"exponential":"interval");if(u||o.type==="padding"){const q=u?Bi.parse:Gr.parse;(h=Ei({},h)).stops&&(h.stops=h.stops.map(J=>[J[0],q(J[1])])),h.default=q(h.default?h.default:o.default)}if(h.colorSpace&&(C=h.colorSpace)!=="rgb"&&C!=="hcl"&&C!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var C;let L,k,j;if(S==="exponential")L=ui;else if(S==="interval")L=rr;else if(S==="categorical"){L=hi,k=Object.create(null);for(const q of h.stops)k[q[0]]=q[1];j=typeof h.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);L=Zr}if(p){const q={},J=[];for(let lt=0;lt<h.stops.length;lt++){const gt=h.stops[lt],St=gt[0].zoom;q[St]===void 0&&(q[St]={zoom:St,type:h.type,property:h.property,default:h.default,stops:[]},J.push(St)),q[St].stops.push([gt[0].value,gt[1]])}const et=[];for(const lt of J)et.push([q[lt].zoom,wi(q[lt],o)]);const nt={name:"linear"};return{kind:"composite",interpolationType:nt,interpolationFactor:ss.interpolationFactor.bind(void 0,nt),zoomStops:et.map(lt=>lt[0]),evaluate:(lt,gt)=>{let{zoom:St}=lt;return ui({stops:et,base:h.base},o,St).evaluate(St,gt)}}}if(v){const q=S==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:ss.interpolationFactor.bind(void 0,q),zoomStops:h.stops.map(J=>J[0]),evaluate:J=>{let{zoom:et}=J;return L(h,o,et,k,j)}}}return{kind:"source",evaluate(q,J){const et=J&&J.properties?J.properties[h.property]:void 0;return et===void 0?Ii(h.default,o.default):L(h,o,et,k,j)}}}function Ii(h,o,u){return h!==void 0?h:o!==void 0?o:u!==void 0?u:void 0}function hi(h,o,u,p,v){return Ii(typeof u===v?p[u]:void 0,h.default,o.default)}function rr(h,o,u){if(ee(u)!=="number")return Ii(h.default,o.default);const p=h.stops.length;if(p===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[p-1][0])return h.stops[p-1][1];const v=Ja(h.stops.map(S=>S[0]),u);return h.stops[v][1]}function ui(h,o,u){const p=h.base!==void 0?h.base:1;if(ee(u)!=="number")return Ii(h.default,o.default);const v=h.stops.length;if(v===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[v-1][0])return h.stops[v-1][1];const S=Ja(h.stops.map(q=>q[0]),u),C=function(q,J,et,nt){const lt=nt-et,gt=q-et;return lt===0?0:J===1?gt/lt:(Math.pow(J,gt)-1)/(Math.pow(J,lt)-1)}(u,p,h.stops[S][0],h.stops[S+1][0]),L=h.stops[S][1],k=h.stops[S+1][1],j=gs[o.type]||ti;return typeof L.evaluate=="function"?{evaluate(){for(var q=arguments.length,J=new Array(q),et=0;et<q;et++)J[et]=arguments[et];const nt=L.evaluate.apply(void 0,J),lt=k.evaluate.apply(void 0,J);if(nt!==void 0&&lt!==void 0)return j(nt,lt,C,h.colorSpace)}}:j(L,k,C,h.colorSpace)}function Zr(h,o,u){switch(o.type){case"color":u=Bi.parse(u);break;case"formatted":u=Rr.fromString(u.toString());break;case"resolvedImage":u=Os.fromString(u.toString());break;case"padding":u=Gr.parse(u);break;default:ee(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0)}return Ii(u,h.default,o.default)}ts.register(no,{error:[{kind:"error"},[Ke],(h,o)=>{let[u]=o;throw new dr(u.evaluate(h))}],typeof:[Ke,[vi],(h,o)=>{let[u]=o;return _t(xi(u.evaluate(h)))}],"to-rgba":[st(Te,4),[hr],(h,o)=>{let[u]=o;const[p,v,S,C]=u.evaluate(h).rgb;return[255*p,255*v,255*S,C]}],rgb:[hr,[Te,Te,Te],ba],rgba:[hr,[Te,Te,Te,Te],ba],has:{type:Qe,overloads:[[[Ke],(h,o)=>{let[u]=o;return jl(u.evaluate(h),h.properties())}],[[Ke,Di],(h,o)=>{let[u,p]=o;return jl(u.evaluate(h),p.evaluate(h))}]]},get:{type:vi,overloads:[[[Ke],(h,o)=>{let[u]=o;return To(u.evaluate(h),h.properties())}],[[Ke,Di],(h,o)=>{let[u,p]=o;return To(u.evaluate(h),p.evaluate(h))}]]},"feature-state":[vi,[Ke],(h,o)=>{let[u]=o;return To(u.evaluate(h),h.featureState||{})}],properties:[Di,[],h=>h.properties()],"geometry-type":[Ke,[],h=>h.geometryType()],id:[vi,[],h=>h.id()],zoom:[Te,[],h=>h.globals.zoom],"heatmap-density":[Te,[],h=>h.globals.heatmapDensity||0],"line-progress":[Te,[],h=>h.globals.lineProgress||0],accumulated:[vi,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Te,oo(Te),(h,o)=>{let u=0;for(const p of o)u+=p.evaluate(h);return u}],"*":[Te,oo(Te),(h,o)=>{let u=1;for(const p of o)u*=p.evaluate(h);return u}],"-":{type:Te,overloads:[[[Te,Te],(h,o)=>{let[u,p]=o;return u.evaluate(h)-p.evaluate(h)}],[[Te],(h,o)=>{let[u]=o;return-u.evaluate(h)}]]},"/":[Te,[Te,Te],(h,o)=>{let[u,p]=o;return u.evaluate(h)/p.evaluate(h)}],"%":[Te,[Te,Te],(h,o)=>{let[u,p]=o;return u.evaluate(h)%p.evaluate(h)}],ln2:[Te,[],()=>Math.LN2],pi:[Te,[],()=>Math.PI],e:[Te,[],()=>Math.E],"^":[Te,[Te,Te],(h,o)=>{let[u,p]=o;return Math.pow(u.evaluate(h),p.evaluate(h))}],sqrt:[Te,[Te],(h,o)=>{let[u]=o;return Math.sqrt(u.evaluate(h))}],log10:[Te,[Te],(h,o)=>{let[u]=o;return Math.log(u.evaluate(h))/Math.LN10}],ln:[Te,[Te],(h,o)=>{let[u]=o;return Math.log(u.evaluate(h))}],log2:[Te,[Te],(h,o)=>{let[u]=o;return Math.log(u.evaluate(h))/Math.LN2}],sin:[Te,[Te],(h,o)=>{let[u]=o;return Math.sin(u.evaluate(h))}],cos:[Te,[Te],(h,o)=>{let[u]=o;return Math.cos(u.evaluate(h))}],tan:[Te,[Te],(h,o)=>{let[u]=o;return Math.tan(u.evaluate(h))}],asin:[Te,[Te],(h,o)=>{let[u]=o;return Math.asin(u.evaluate(h))}],acos:[Te,[Te],(h,o)=>{let[u]=o;return Math.acos(u.evaluate(h))}],atan:[Te,[Te],(h,o)=>{let[u]=o;return Math.atan(u.evaluate(h))}],min:[Te,oo(Te),(h,o)=>Math.min(...o.map(u=>u.evaluate(h)))],max:[Te,oo(Te),(h,o)=>Math.max(...o.map(u=>u.evaluate(h)))],abs:[Te,[Te],(h,o)=>{let[u]=o;return Math.abs(u.evaluate(h))}],round:[Te,[Te],(h,o)=>{let[u]=o;const p=u.evaluate(h);return p<0?-Math.round(-p):Math.round(p)}],floor:[Te,[Te],(h,o)=>{let[u]=o;return Math.floor(u.evaluate(h))}],ceil:[Te,[Te],(h,o)=>{let[u]=o;return Math.ceil(u.evaluate(h))}],"filter-==":[Qe,[Ke,vi],(h,o)=>{let[u,p]=o;return h.properties()[u.value]===p.value}],"filter-id-==":[Qe,[vi],(h,o)=>{let[u]=o;return h.id()===u.value}],"filter-type-==":[Qe,[Ke],(h,o)=>{let[u]=o;return h.geometryType()===u.value}],"filter-<":[Qe,[Ke,vi],(h,o)=>{let[u,p]=o;const v=h.properties()[u.value],S=p.value;return typeof v==typeof S&&v<S}],"filter-id-<":[Qe,[vi],(h,o)=>{let[u]=o;const p=h.id(),v=u.value;return typeof p==typeof v&&p<v}],"filter->":[Qe,[Ke,vi],(h,o)=>{let[u,p]=o;const v=h.properties()[u.value],S=p.value;return typeof v==typeof S&&v>S}],"filter-id->":[Qe,[vi],(h,o)=>{let[u]=o;const p=h.id(),v=u.value;return typeof p==typeof v&&p>v}],"filter-<=":[Qe,[Ke,vi],(h,o)=>{let[u,p]=o;const v=h.properties()[u.value],S=p.value;return typeof v==typeof S&&v<=S}],"filter-id-<=":[Qe,[vi],(h,o)=>{let[u]=o;const p=h.id(),v=u.value;return typeof p==typeof v&&p<=v}],"filter->=":[Qe,[Ke,vi],(h,o)=>{let[u,p]=o;const v=h.properties()[u.value],S=p.value;return typeof v==typeof S&&v>=S}],"filter-id->=":[Qe,[vi],(h,o)=>{let[u]=o;const p=h.id(),v=u.value;return typeof p==typeof v&&p>=v}],"filter-has":[Qe,[vi],(h,o)=>{let[u]=o;return u.value in h.properties()}],"filter-has-id":[Qe,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Qe,[st(Ke)],(h,o)=>{let[u]=o;return u.value.indexOf(h.geometryType())>=0}],"filter-id-in":[Qe,[st(vi)],(h,o)=>{let[u]=o;return u.value.indexOf(h.id())>=0}],"filter-in-small":[Qe,[Ke,st(vi)],(h,o)=>{let[u,p]=o;return p.value.indexOf(h.properties()[u.value])>=0}],"filter-in-large":[Qe,[Ke,st(vi)],(h,o)=>{let[u,p]=o;return function(v,S,C,L){for(;C<=L;){const k=C+L>>1;if(S[k]===v)return!0;S[k]>v?L=k-1:C=k+1}return!1}(h.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Qe,overloads:[[[Qe,Qe],(h,o)=>{let[u,p]=o;return u.evaluate(h)&&p.evaluate(h)}],[oo(Qe),(h,o)=>{for(const u of o)if(!u.evaluate(h))return!1;return!0}]]},any:{type:Qe,overloads:[[[Qe,Qe],(h,o)=>{let[u,p]=o;return u.evaluate(h)||p.evaluate(h)}],[oo(Qe),(h,o)=>{for(const u of o)if(u.evaluate(h))return!0;return!1}]]},"!":[Qe,[Qe],(h,o)=>{let[u]=o;return!u.evaluate(h)}],"is-supported-script":[Qe,[Ke],(h,o)=>{let[u]=o;const p=h.globals&&h.globals.isSupportedScript;return!p||p(u.evaluate(h))}],upcase:[Ke,[Ke],(h,o)=>{let[u]=o;return u.evaluate(h).toUpperCase()}],downcase:[Ke,[Ke],(h,o)=>{let[u]=o;return u.evaluate(h).toLowerCase()}],concat:[Ke,oo(vi),(h,o)=>o.map(u=>wn(u.evaluate(h))).join("")],"resolved-locale":[Ke,[yr],(h,o)=>{let[u]=o;return u.evaluate(h).resolvedLocale()}]});class Ri{constructor(o,u){var p;this.expression=o,this._warningHistory={},this._evaluator=new Zi,this._defaultValue=u?(p=u).type==="color"&&Ie(p.default)?new Bi(0,0,0,0):p.type==="color"?Bi.parse(p.default)||null:p.type==="padding"?Gr.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?kr.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(o,u,p,v,S,C){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(o,u,p,v,S,C){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new dr(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function Fi(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in no}function Vr(h,o){const u=new eo(no,fa,[],o?function(v){const S={color:hr,string:Ke,number:Te,enum:Ke,boolean:Qe,formatted:sr,padding:vt,resolvedImage:K,variableAnchorOffsetCollection:Y};return v.type==="array"?st(S[v.value]||vi,v.length):S[v.type]}(o):void 0),p=u.parse(h,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?D(new Ri(p,o)):Q(u.errors)}class an{constructor(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!So(u.expression)}evaluateWithoutErrorHandling(o,u,p,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(o,u,p,v,S,C)}evaluate(o,u,p,v,S,C){return this._styleExpression.evaluate(o,u,p,v,S,C)}}class ln{constructor(o,u,p,v){this.kind=o,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!So(u.expression),this.interpolationType=v}evaluateWithoutErrorHandling(o,u,p,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(o,u,p,v,S,C)}evaluate(o,u,p,v,S,C){return this._styleExpression.evaluate(o,u,p,v,S,C)}interpolationFactor(o,u,p){return this.interpolationType?ss.interpolationFactor(this.interpolationType,o,u,p):0}}function Po(h,o){const u=Vr(h,o);if(u.result==="error")return u;const p=u.value.expression,v=Wa(p);if(!v&&!Ct(o))return Q([new Re("","data expressions not supported")]);const S=qo(p,["zoom"]);if(!S&&!Gt(o))return Q([new Re("","zoom expressions not supported")]);const C=wa(p);return C||S?C instanceof Re?Q([C]):C instanceof ss&&!Yt(o)?Q([new Re("",'"interpolate" expressions cannot be used with this property')]):D(C?new ln(v?"camera":"composite",u.value,C.labels,C instanceof ss?C.interpolation:void 0):new an(v?"constant":"source",u.value)):Q([new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ya{constructor(o,u){this._parameters=o,this._specification=u,Ei(this,wi(this._parameters,this._specification))}static deserialize(o){return new Ya(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function wa(h){let o=null;if(h instanceof $a)o=wa(h.result);else if(h instanceof Xa){for(const u of h.args)if(o=wa(u),o)break}else(h instanceof Za||h instanceof ss)&&h.input instanceof ts&&h.input.name==="zoom"&&(o=h);return o instanceof Re||h.eachChild(u=>{const p=wa(u);p instanceof Re?o=p:!o&&p?o=new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&p&&o!==p&&(o=new Re("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function xa(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const o of h.slice(1))if(!xa(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const Qa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Aa(h){if(h==null)return{filter:()=>!0,needGeometry:!1};xa(h)||(h=Ds(h));const o=Vr(h,Qa);if(o.result==="error")throw new Error(o.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,p,v)=>o.value.evaluate(u,p,{},v),needGeometry:Wo(h)}}function Ul(h,o){return h<o?-1:h>o?1:0}function Wo(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(let o=1;o<h.length;o++)if(Wo(h[o]))return!0;return!1}function Ds(h){if(!h)return!0;const o=h[0];return h.length<=1?o!=="any":o==="=="?Sa(h[1],h[2],"=="):o==="!="?Ea(Sa(h[1],h[2],"==")):o==="<"||o===">"||o==="<="||o===">="?Sa(h[1],h[2],o):o==="any"?(u=h.slice(1),["any"].concat(u.map(Ds))):o==="all"?["all"].concat(h.slice(1).map(Ds)):o==="none"?["all"].concat(h.slice(1).map(Ds).map(Ea)):o==="in"?tl(h[1],h.slice(2)):o==="!in"?Ea(tl(h[1],h.slice(2))):o==="has"?el(h[1]):o==="!has"?Ea(el(h[1])):o!=="within"||h;var u}function Sa(h,o,u){switch(h){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,h,o]}}function tl(h,o){if(o.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(u=>typeof u!=typeof o[0])?["filter-in-large",h,["literal",o.sort(Ul)]]:["filter-in-small",h,["literal",o]]}}function el(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Ea(h){return["!",h]}function Js(h){const o=typeof h;if(o==="number"||o==="boolean"||o==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let v="[";for(const S of h)v+=`${Js(S)},`;return`${v}]`}const u=Object.keys(h).sort();let p="{";for(let v=0;v<u.length;v++)p+=`${JSON.stringify(u[v])}:${Js(h[u[v]])},`;return`${p}}`}function Xh(h){let o="";for(const u of ii)o+=`/${Js(h[u])}`;return o}function Gl(h){const o=h.value;return o?[new ce(h.key,o,"constants have been deprecated as of v8")]:[]}function Lr(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function As(h){if(Array.isArray(h))return h.map(As);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const o={};for(const u in h)o[u]=As(h[u]);return o}return Lr(h)}function ms(h){const o=h.key,u=h.value,p=h.valueSpec||{},v=h.objectElementValidators||{},S=h.style,C=h.styleSpec,L=h.validateSpec;let k=[];const j=ee(u);if(j!=="object")return[new ce(o,u,`object expected, ${j} found`)];for(const q in u){const J=q.split(".")[0],et=p[J]||p["*"];let nt;if(v[J])nt=v[J];else if(p[J])nt=L;else if(v["*"])nt=v["*"];else{if(!p["*"]){k.push(new ce(o,u[q],`unknown property "${q}"`));continue}nt=L}k=k.concat(nt({key:(o&&`${o}.`)+q,value:u[q],valueSpec:et,style:S,styleSpec:C,object:u,objectKey:q,validateSpec:L},u))}for(const q in p)v[q]||p[q].required&&p[q].default===void 0&&u[q]===void 0&&k.push(new ce(o,u,`missing required property "${q}"`));return k}function bc(h){const o=h.value,u=h.valueSpec,p=h.style,v=h.styleSpec,S=h.key,C=h.arrayElementValidator||h.validateSpec;if(ee(o)!=="array")return[new ce(S,o,`array expected, ${ee(o)} found`)];if(u.length&&o.length!==u.length)return[new ce(S,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new ce(S,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let L={type:u.value,values:u.values};v.$version<7&&(L.function=u.function),ee(u.value)==="object"&&(L=u.value);let k=[];for(let j=0;j<o.length;j++)k=k.concat(C({array:o,arrayIndex:j,value:o[j],valueSpec:L,validateSpec:h.validateSpec,style:p,styleSpec:v,key:`${S}[${j}]`}));return k}function Vl(h){const o=h.key,u=h.value,p=h.valueSpec;let v=ee(u);return v==="number"&&u!=u&&(v="NaN"),v!=="number"?[new ce(o,u,`number expected, ${v} found`)]:"minimum"in p&&u<p.minimum?[new ce(o,u,`${u} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&u>p.maximum?[new ce(o,u,`${u} is greater than the maximum value ${p.maximum}`)]:[]}function Jo(h){const o=h.valueSpec,u=Lr(h.value.type);let p,v,S,C={};const L=u!=="categorical"&&h.value.property===void 0,k=!L,j=ee(h.value.stops)==="array"&&ee(h.value.stops[0])==="array"&&ee(h.value.stops[0][0])==="object",q=ms({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(nt){if(u==="identity")return[new ce(nt.key,nt.value,'identity function may not have a "stops" property')];let lt=[];const gt=nt.value;return lt=lt.concat(bc({key:nt.key,value:gt,valueSpec:nt.valueSpec,validateSpec:nt.validateSpec,style:nt.style,styleSpec:nt.styleSpec,arrayElementValidator:J})),ee(gt)==="array"&&gt.length===0&&lt.push(new ce(nt.key,gt,"array must have at least one stop")),lt},default:function(nt){return nt.validateSpec({key:nt.key,value:nt.value,valueSpec:o,validateSpec:nt.validateSpec,style:nt.style,styleSpec:nt.styleSpec})}}});return u==="identity"&&L&&q.push(new ce(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||q.push(new ce(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!Yt(h.valueSpec)&&q.push(new ce(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(k&&!Ct(h.valueSpec)?q.push(new ce(h.key,h.value,"property functions not supported")):L&&!Gt(h.valueSpec)&&q.push(new ce(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!j||h.value.property!==void 0||q.push(new ce(h.key,h.value,'"property" property is required')),q;function J(nt){let lt=[];const gt=nt.value,St=nt.key;if(ee(gt)!=="array")return[new ce(St,gt,`array expected, ${ee(gt)} found`)];if(gt.length!==2)return[new ce(St,gt,`array length 2 expected, length ${gt.length} found`)];if(j){if(ee(gt[0])!=="object")return[new ce(St,gt,`object expected, ${ee(gt[0])} found`)];if(gt[0].zoom===void 0)return[new ce(St,gt,"object stop key must have zoom")];if(gt[0].value===void 0)return[new ce(St,gt,"object stop key must have value")];if(S&&S>Lr(gt[0].zoom))return[new ce(St,gt[0].zoom,"stop zoom values must appear in ascending order")];Lr(gt[0].zoom)!==S&&(S=Lr(gt[0].zoom),v=void 0,C={}),lt=lt.concat(ms({key:`${St}[0]`,value:gt[0],valueSpec:{zoom:{}},validateSpec:nt.validateSpec,style:nt.style,styleSpec:nt.styleSpec,objectElementValidators:{zoom:Vl,value:et}}))}else lt=lt.concat(et({key:`${St}[0]`,value:gt[0],valueSpec:{},validateSpec:nt.validateSpec,style:nt.style,styleSpec:nt.styleSpec},gt));return Fi(As(gt[1]))?lt.concat([new ce(`${St}[1]`,gt[1],"expressions are not allowed in function stops.")]):lt.concat(nt.validateSpec({key:`${St}[1]`,value:gt[1],valueSpec:o,validateSpec:nt.validateSpec,style:nt.style,styleSpec:nt.styleSpec}))}function et(nt,lt){const gt=ee(nt.value),St=Lr(nt.value),Bt=nt.value!==null?nt.value:lt;if(p){if(gt!==p)return[new ce(nt.key,Bt,`${gt} stop domain type must match previous stop domain type ${p}`)]}else p=gt;if(gt!=="number"&&gt!=="string"&&gt!=="boolean")return[new ce(nt.key,Bt,"stop domain value must be a number, string, or boolean")];if(gt!=="number"&&u!=="categorical"){let $t=`number expected, ${gt} found`;return Ct(o)&&u===void 0&&($t+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ce(nt.key,Bt,$t)]}return u!=="categorical"||gt!=="number"||isFinite(St)&&Math.floor(St)===St?u!=="categorical"&&gt==="number"&&v!==void 0&&St<v?[new ce(nt.key,Bt,"stop domain values must appear in ascending order")]:(v=St,u==="categorical"&&St in C?[new ce(nt.key,Bt,"stop domain values must be unique")]:(C[St]=!0,[])):[new ce(nt.key,Bt,`integer expected, found ${St}`)]}}function ys(h){const o=(h.expressionContext==="property"?Po:Vr)(As(h.value),h.valueSpec);if(o.result==="error")return o.value.map(p=>new ce(`${h.key}${p.key}`,h.value,p.message));const u=o.value.expression||o.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new ce(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!So(u))return[new ce(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!So(u))return[new ce(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!qo(u,["zoom","feature-state"]))return[new ce(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!Wa(u))return[new ce(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ss(h){const o=h.key,u=h.value,p=h.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(Lr(u))===-1&&v.push(new ce(o,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(Lr(u))===-1&&v.push(new ce(o,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function An(h){return xa(As(h.value))?ys(Ei({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):kn(h)}function kn(h){const o=h.value,u=h.key;if(ee(o)!=="array")return[new ce(u,o,`array expected, ${ee(o)} found`)];const p=h.styleSpec;let v,S=[];if(o.length<1)return[new ce(u,o,"filter array must have at least 1 element")];switch(S=S.concat(Ss({key:`${u}[0]`,value:o[0],valueSpec:p.filter_operator,style:h.style,styleSpec:h.styleSpec})),Lr(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Lr(o[1])==="$type"&&S.push(new ce(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&S.push(new ce(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(v=ee(o[1]),v!=="string"&&S.push(new ce(`${u}[1]`,o[1],`string expected, ${v} found`)));for(let C=2;C<o.length;C++)v=ee(o[C]),Lr(o[1])==="$type"?S=S.concat(Ss({key:`${u}[${C}]`,value:o[C],valueSpec:p.geometry_type,style:h.style,styleSpec:h.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new ce(`${u}[${C}]`,o[C],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let C=1;C<o.length;C++)S=S.concat(kn({key:`${u}[${C}]`,value:o[C],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":v=ee(o[1]),o.length!==2?S.push(new ce(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):v!=="string"&&S.push(new ce(`${u}[1]`,o[1],`string expected, ${v} found`));break;case"within":v=ee(o[1]),o.length!==2?S.push(new ce(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):v!=="object"&&S.push(new ce(`${u}[1]`,o[1],`object expected, ${v} found`))}return S}function On(h,o){const u=h.key,p=h.validateSpec,v=h.style,S=h.styleSpec,C=h.value,L=h.objectKey,k=S[`${o}_${h.layerType}`];if(!k)return[];const j=L.match(/^(.*)-transition$/);if(o==="paint"&&j&&k[j[1]]&&k[j[1]].transition)return p({key:u,value:C,valueSpec:S.transition,style:v,styleSpec:S});const q=h.valueSpec||k[L];if(!q)return[new ce(u,C,`unknown property "${L}"`)];let J;if(ee(C)==="string"&&Ct(q)&&!q.tokens&&(J=/^{([^}]+)}$/.exec(C)))return[new ce(u,C,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(J[1])} }\`.`)];const et=[];return h.layerType==="symbol"&&(L==="text-field"&&v&&!v.glyphs&&et.push(new ce(u,C,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Ie(As(C))&&Lr(C.type)==="identity"&&et.push(new ce(u,C,'"text-font" does not support identity functions'))),et.concat(p({key:h.key,value:C,valueSpec:q,style:v,styleSpec:S,expressionContext:"property",propertyType:o,propertyKey:L}))}function Ca(h){return On(h,"paint")}function Sn(h){return On(h,"layout")}function Io(h){let o=[];const u=h.value,p=h.key,v=h.style,S=h.styleSpec;u.type||u.ref||o.push(new ce(p,u,'either "type" or "ref" is required'));let C=Lr(u.type);const L=Lr(u.ref);if(u.id){const k=Lr(u.id);for(let j=0;j<h.arrayIndex;j++){const q=v.layers[j];Lr(q.id)===k&&o.push(new ce(p,u.id,`duplicate layer id "${u.id}", previously used at line ${q.id.__line__}`))}}if("ref"in u){let k;["type","source","source-layer","filter","layout"].forEach(j=>{j in u&&o.push(new ce(p,u[j],`"${j}" is prohibited for ref layers`))}),v.layers.forEach(j=>{Lr(j.id)===L&&(k=j)}),k?k.ref?o.push(new ce(p,u.ref,"ref cannot reference another ref layer")):C=Lr(k.type):o.push(new ce(p,u.ref,`ref layer "${L}" not found`))}else if(C!=="background")if(u.source){const k=v.sources&&v.sources[u.source],j=k&&Lr(k.type);k?j==="vector"&&C==="raster"?o.push(new ce(p,u.source,`layer "${u.id}" requires a raster source`)):j!=="raster-dem"&&C==="hillshade"?o.push(new ce(p,u.source,`layer "${u.id}" requires a raster-dem source`)):j==="raster"&&C!=="raster"?o.push(new ce(p,u.source,`layer "${u.id}" requires a vector source`)):j!=="vector"||u["source-layer"]?j==="raster-dem"&&C!=="hillshade"?o.push(new ce(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!u.paint||!u.paint["line-gradient"]||j==="geojson"&&k.lineMetrics||o.push(new ce(p,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new ce(p,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new ce(p,u.source,`source "${u.source}" not found`))}else o.push(new ce(p,u,'missing required property "source"'));return o=o.concat(ms({key:p,value:u,valueSpec:S.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${p}.type`,value:u.type,valueSpec:S.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:An,layout:k=>ms({layer:u,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":j=>Sn(Ei({layerType:C},j))}}),paint:k=>ms({layer:u,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":j=>Ca(Ei({layerType:C},j))}})}})),o}function ao(h){const o=h.value,u=h.key,p=ee(o);return p!=="string"?[new ce(u,o,`string expected, ${p} found`)]:[]}const Zo={promoteId:function(h){let{key:o,value:u}=h;if(ee(u)==="string")return ao({key:o,value:u});{const p=[];for(const v in u)p.push(...ao({key:`${o}.${v}`,value:u[v]}));return p}}};function Dn(h){const o=h.value,u=h.key,p=h.styleSpec,v=h.style,S=h.validateSpec;if(!o.type)return[new ce(u,o,'"type" is required')];const C=Lr(o.type);let L;switch(C){case"vector":case"raster":return L=ms({key:u,value:o,valueSpec:p[`source_${C.replace("-","_")}`],style:h.style,styleSpec:p,objectElementValidators:Zo,validateSpec:S}),L;case"raster-dem":return L=function(k){var j;const q=(j=k.sourceName)!==null&&j!==void 0?j:"",J=k.value,et=k.styleSpec,nt=et.source_raster_dem,lt=k.style;let gt=[];const St=ee(J);if(J===void 0)return gt;if(St!=="object")return gt.push(new ce("source_raster_dem",J,`object expected, ${St} found`)),gt;const Bt=Lr(J.encoding)==="custom",$t=["redFactor","greenFactor","blueFactor","baseShift"],Ot=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Ht in J)!Bt&&$t.includes(Ht)?gt.push(new ce(Ht,J[Ht],`In "${q}": "${Ht}" is only valid when "encoding" is set to "custom". ${Ot} encoding found`)):nt[Ht]?gt=gt.concat(k.validateSpec({key:Ht,value:J[Ht],valueSpec:nt[Ht],validateSpec:k.validateSpec,style:lt,styleSpec:et})):gt.push(new ce(Ht,J[Ht],`unknown property "${Ht}"`));return gt}({sourceName:u,value:o,style:h.style,styleSpec:p,validateSpec:S}),L;case"geojson":if(L=ms({key:u,value:o,valueSpec:p.source_geojson,style:v,styleSpec:p,validateSpec:S,objectElementValidators:Zo}),o.cluster)for(const k in o.clusterProperties){const[j,q]=o.clusterProperties[k],J=typeof j=="string"?[j,["accumulated"],["get",k]]:j;L.push(...ys({key:`${u}.${k}.map`,value:q,validateSpec:S,expressionContext:"cluster-map"})),L.push(...ys({key:`${u}.${k}.reduce`,value:J,validateSpec:S,expressionContext:"cluster-reduce"}))}return L;case"video":return ms({key:u,value:o,valueSpec:p.source_video,style:v,validateSpec:S,styleSpec:p});case"image":return ms({key:u,value:o,valueSpec:p.source_image,style:v,validateSpec:S,styleSpec:p});case"canvas":return[new ce(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ss({key:`${u}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:S,styleSpec:p})}}function Mo(h){const o=h.value,u=h.styleSpec,p=u.light,v=h.style;let S=[];const C=ee(o);if(o===void 0)return S;if(C!=="object")return S=S.concat([new ce("light",o,`object expected, ${C} found`)]),S;for(const L in o){const k=L.match(/^(.*)-transition$/);S=S.concat(k&&p[k[1]]&&p[k[1]].transition?h.validateSpec({key:L,value:o[L],valueSpec:u.transition,validateSpec:h.validateSpec,style:v,styleSpec:u}):p[L]?h.validateSpec({key:L,value:o[L],valueSpec:p[L],validateSpec:h.validateSpec,style:v,styleSpec:u}):[new ce(L,o[L],`unknown property "${L}"`)])}return S}function Ta(h){const o=h.value,u=h.styleSpec,p=u.sky,v=h.style,S=ee(o);if(o===void 0)return[];if(S!=="object")return[new ce("sky",o,`object expected, ${S} found`)];let C=[];for(const L in o)C=C.concat(p[L]?cn({key:L,value:o[L],valueSpec:p[L],style:v,styleSpec:u}):[new ce(L,o[L],`unknown property "${L}"`)]);return C}function Lo(h){const o=h.value,u=h.styleSpec,p=u.terrain,v=h.style;let S=[];const C=ee(o);if(o===void 0)return S;if(C!=="object")return S=S.concat([new ce("terrain",o,`object expected, ${C} found`)]),S;for(const L in o)S=S.concat(p[L]?h.validateSpec({key:L,value:o[L],valueSpec:p[L],validateSpec:h.validateSpec,style:v,styleSpec:u}):[new ce(L,o[L],`unknown property "${L}"`)]);return S}function lo(h){let o=[];const u=h.value,p=h.key;if(Array.isArray(u)){const v=[],S=[];for(const C in u)u[C].id&&v.includes(u[C].id)&&o.push(new ce(p,u,`all the sprites' ids must be unique, but ${u[C].id} is duplicated`)),v.push(u[C].id),u[C].url&&S.includes(u[C].url)&&o.push(new ce(p,u,`all the sprites' URLs must be unique, but ${u[C].url} is duplicated`)),S.push(u[C].url),o=o.concat(ms({key:`${p}[${C}]`,value:u[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return o}return ao({key:p,value:u})}const ns={"*":()=>[],array:bc,boolean:function(h){const o=h.value,u=h.key,p=ee(o);return p!=="boolean"?[new ce(u,o,`boolean expected, ${p} found`)]:[]},number:Vl,color:function(h){const o=h.key,u=h.value,p=ee(u);return p!=="string"?[new ce(o,u,`color expected, ${p} found`)]:Bi.parse(String(u))?[]:[new ce(o,u,`color expected, "${u}" found`)]},constants:Gl,enum:Ss,filter:An,function:Jo,layer:Io,object:ms,source:Dn,light:Mo,sky:Ta,terrain:Lo,string:ao,formatted:function(h){return ao(h).length===0?[]:ys(h)},resolvedImage:function(h){return ao(h).length===0?[]:ys(h)},padding:function(h){const o=h.key,u=h.value;if(ee(u)==="array"){if(u.length<1||u.length>4)return[new ce(o,u,`padding requires 1 to 4 values; ${u.length} values found`)];const p={type:"number"};let v=[];for(let S=0;S<u.length;S++)v=v.concat(h.validateSpec({key:`${o}[${S}]`,value:u[S],validateSpec:h.validateSpec,valueSpec:p}));return v}return Vl({key:o,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const o=h.key,u=h.value,p=ee(u),v=h.styleSpec;if(p!=="array"||u.length<1||u.length%2!=0)return[new ce(o,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let C=0;C<u.length;C+=2)S=S.concat(Ss({key:`${o}[${C}]`,value:u[C],valueSpec:v.layout_symbol["text-anchor"]})),S=S.concat(bc({key:`${o}[${C+1}]`,value:u[C+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:v}));return S},sprite:lo};function cn(h){const o=h.value,u=h.valueSpec,p=h.styleSpec;return h.validateSpec=cn,u.expression&&Ie(Lr(o))?Jo(h):u.expression&&Fi(As(o))?ys(h):u.type&&ns[u.type]?ns[u.type](h):ms(Ei({},h,{valueSpec:u.type?p[u.type]:u}))}function hn(h){const o=h.value,u=h.key,p=ao(h);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new ce(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new ce(u,o,'"glyphs" url must include a "{range}" token'))),p}function _s(h){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Zt,u=[];return u=u.concat(cn({key:"",value:h,valueSpec:o.$root,styleSpec:o,style:h,validateSpec:cn,objectElementValidators:{glyphs:hn,"*":()=>[]}})),h.constants&&(u=u.concat(Gl({key:"constants",value:h.constants,style:h,styleSpec:o,validateSpec:cn}))),fr(u)}function er(h){return function(o){return h({...o,validateSpec:cn})}}function fr(h){return[].concat(h).sort((o,u)=>o.line-u.line)}function gr(h){return function(){for(var o=arguments.length,u=new Array(o),p=0;p<o;p++)u[p]=arguments[p];return fr(h.apply(this,u))}}_s.source=gr(er(Dn)),_s.sprite=gr(er(lo)),_s.glyphs=gr(er(hn)),_s.light=gr(er(Mo)),_s.sky=gr(er(Ta)),_s.terrain=gr(er(Lo)),_s.layer=gr(er(Io)),_s.filter=gr(er(An)),_s.paintProperty=gr(er(Ca)),_s.layoutProperty=gr(er(Sn));const Dr=_s,Xo=Dr.light,Bo=Dr.paintProperty,ql=Dr.layoutProperty;function $o(h,o){let u=!1;if(o&&o.length)for(const p of o)h.fire(new pe(new Error(p.message))),u=!0;return u}class Hl{constructor(o,u,p){const v=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const C=new Int32Array(this.arrayBuffer);o=C[0],this.d=(u=C[1])+2*(p=C[2]);for(let k=0;k<this.d*this.d;k++){const j=C[3+k],q=C[3+k+1];v.push(j===q?null:C.subarray(j,q))}const L=C[3+v.length+1];this.keys=C.subarray(C[3+v.length],L),this.bboxes=C.subarray(L),this.insert=this._insertReadonly}else{this.d=u+2*p;for(let C=0;C<this.d*this.d;C++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=p,this.scale=u/o,this.uid=0;const S=p/u*o;this.min=-S,this.max=o+S}insert(o,u,p,v,S){this._forEachCell(u,p,v,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,u,p,v,S,C){this.cells[S].push(C)}query(o,u,p,v,S){const C=this.min,L=this.max;if(o<=C&&u<=C&&L<=p&&L<=v&&!S)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(o,u,p,v,this._queryCell,k,{},S),k}}_queryCell(o,u,p,v,S,C,L,k){const j=this.cells[S];if(j!==null){const q=this.keys,J=this.bboxes;for(let et=0;et<j.length;et++){const nt=j[et];if(L[nt]===void 0){const lt=4*nt;(k?k(J[lt+0],J[lt+1],J[lt+2],J[lt+3]):o<=J[lt+2]&&u<=J[lt+3]&&p>=J[lt+0]&&v>=J[lt+1])?(L[nt]=!0,C.push(q[nt])):L[nt]=!1}}}}_forEachCell(o,u,p,v,S,C,L,k){const j=this._convertToCellCoord(o),q=this._convertToCellCoord(u),J=this._convertToCellCoord(p),et=this._convertToCellCoord(v);for(let nt=j;nt<=J;nt++)for(let lt=q;lt<=et;lt++){const gt=this.d*lt+nt;if((!k||k(this._convertFromCellCoord(nt),this._convertFromCellCoord(lt),this._convertFromCellCoord(nt+1),this._convertFromCellCoord(lt+1)))&&S.call(this,o,u,p,v,gt,C,L,k))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,u=3+this.cells.length+1+1;let p=0;for(let C=0;C<this.cells.length;C++)p+=this.cells[C].length;const v=new Int32Array(u+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let S=u;for(let C=0;C<o.length;C++){const L=o[C];v[3+C]=S,v.set(L,S),S+=L.length}return v[3+o.length]=S,v.set(this.keys,S),S+=this.keys.length,v[3+o.length+1]=S,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer}static serialize(o,u){const p=o.toArrayBuffer();return u&&u.push(p),{buffer:p}}static deserialize(o){return new Hl(o.buffer)}}const co={};function We(h,o){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(co[h])throw new Error(`${h} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:h,writeable:!1}),co[h]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}We("Object",Object),We("TransferableGridIndex",Hl),We("Color",Bi),We("Error",Error),We("AJAXError",ie),We("ResolvedImage",Os),We("StylePropertyFunction",Ya),We("StyleExpression",Ri,{omit:["_evaluator"]}),We("ZoomDependentExpression",ln),We("ZoomConstantExpression",an),We("CompoundExpression",ts,{omit:["_evaluate"]});for(const h in no)no[h]._classRegistryKey||We(`Expression_${h}`,no[h]);function wc(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function il(h,o){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error)return h;if(wc(h)||te(h))return o&&o.push(h),h;if(ArrayBuffer.isView(h)){const u=h;return o&&o.push(u.buffer),u}if(h instanceof ImageData)return o&&o.push(h.data.buffer),h;if(Array.isArray(h)){const u=[];for(const p of h)u.push(il(p,o));return u}if(typeof h=="object"){const u=h.constructor,p=u._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${u.name}`);if(!co[p])throw new Error(`${p} is not registered.`);const v=u.serialize?u.serialize(h,o):{};if(u.serialize){if(o&&v===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in h){if(!h.hasOwnProperty(S)||co[p].omit.indexOf(S)>=0)continue;const C=h[S];v[S]=co[p].shallow.indexOf(S)>=0?C:il(C,o)}h instanceof Error&&(v.message=h.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(v.$name=p),v}throw new Error("can't serialize object of type "+typeof h)}function rl(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||wc(h)||te(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(rl);if(typeof h=="object"){const o=h.$name||"Object";if(!co[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:u}=co[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(h);const p=Object.create(u.prototype);for(const v of Object.keys(h)){if(v==="$name")continue;const S=h[v];p[v]=co[o].shallow.indexOf(v)>=0?S:rl(S)}return p}throw new Error("can't deserialize object of type "+typeof h)}class nh{constructor(){this.first=!0}update(o,u){const p=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=p,!0))}}const Ne={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Es(h){for(const o of h)if(sl(o.charCodeAt(0)))return!0;return!1}function En(h){for(const o of h)if(!xc(o.charCodeAt(0)))return!1;return!0}function xc(h){return!(Ne.Arabic(h)||Ne["Arabic Supplement"](h)||Ne["Arabic Extended-A"](h)||Ne["Arabic Presentation Forms-A"](h)||Ne["Arabic Presentation Forms-B"](h))}function sl(h){return!(h!==746&&h!==747&&(h<4352||!(Ne["Bopomofo Extended"](h)||Ne.Bopomofo(h)||Ne["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Ne["CJK Compatibility Ideographs"](h)||Ne["CJK Compatibility"](h)||Ne["CJK Radicals Supplement"](h)||Ne["CJK Strokes"](h)||!(!Ne["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Ne["CJK Unified Ideographs Extension A"](h)||Ne["CJK Unified Ideographs"](h)||Ne["Enclosed CJK Letters and Months"](h)||Ne["Hangul Compatibility Jamo"](h)||Ne["Hangul Jamo Extended-A"](h)||Ne["Hangul Jamo Extended-B"](h)||Ne["Hangul Jamo"](h)||Ne["Hangul Syllables"](h)||Ne.Hiragana(h)||Ne["Ideographic Description Characters"](h)||Ne.Kanbun(h)||Ne["Kangxi Radicals"](h)||Ne["Katakana Phonetic Extensions"](h)||Ne.Katakana(h)&&h!==12540||!(!Ne["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Ne["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Ne["Unified Canadian Aboriginal Syllabics"](h)||Ne["Unified Canadian Aboriginal Syllabics Extended"](h)||Ne["Vertical Forms"](h)||Ne["Yijing Hexagram Symbols"](h)||Ne["Yi Syllables"](h)||Ne["Yi Radicals"](h))))}function oh(h){return!(sl(h)||function(o){return!!(Ne["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Ne["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Ne["Letterlike Symbols"](o)||Ne["Number Forms"](o)||Ne["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Ne["Control Pictures"](o)&&o!==9251||Ne["Optical Character Recognition"](o)||Ne["Enclosed Alphanumerics"](o)||Ne["Geometric Shapes"](o)||Ne["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Ne["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Ne["CJK Symbols and Punctuation"](o)||Ne.Katakana(o)||Ne["Private Use Area"](o)||Ne["CJK Compatibility Forms"](o)||Ne["Small Form Variants"](o)||Ne["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(h))}function nl(h){return h>=1424&&h<=2303||Ne["Arabic Presentation Forms-A"](h)||Ne["Arabic Presentation Forms-B"](h)}function Ac(h,o){return!(!o&&nl(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Ne.Khmer(h))}function $h(h){for(const o of h)if(nl(o.charCodeAt(0)))return!0;return!1}const Ko=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Cr{constructor(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new nh,this.transition={})}isSupportedScript(o){return function(u,p){for(const v of u)if(!Ac(v.charCodeAt(0),p))return!1;return!0}(o,Ko.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,u=o-Math.floor(o),p=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}}}class ol{constructor(o,u){this.property=o,this.value=u,this.expression=function(p,v){if(Ie(p))return new Ya(p,v);if(Fi(p)){const S=Po(p,v);if(S.result==="error")throw new Error(S.value.map(C=>`${C.key}: ${C.message}`).join(", "));return S.value}{let S=p;return v.type==="color"&&typeof p=="string"?S=Bi.parse(p):v.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(S=kr.parse(p)):S=Gr.parse(p),{kind:"constant",evaluate:()=>S}}}(u===void 0?o.specification.default:u,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,u,p){return this.property.possiblyEvaluate(this,o,u,p)}}class al{constructor(o){this.property=o,this.value=new ol(o,void 0)}transitioned(o,u){return new zu(this.property,this.value,u,Rt({},o.transition,this.transition),o.now)}untransitioned(){return new zu(this.property,this.value,null,{},0)}}class Sc{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return ot(this._values[o].value.value)}setValue(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new al(this._values[o].property)),this._values[o].value=new ol(this._values[o].property,u===null?void 0:ot(u))}getTransition(o){return ot(this._values[o].transition)}setTransition(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new al(this._values[o].property)),this._values[o].transition=ot(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(o[u]=p);const v=this.getTransition(u);v!==void 0&&(o[`${u}-transition`]=v)}return o}transitioned(o,u){const p=new ju(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].transitioned(o,u._values[v]);return p}untransitioned(){const o=new ju(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class zu{constructor(o,u,p,v,S){this.property=o,this.value=u,this.begin=S+v.delay||0,this.end=this.begin+v.duration||0,o.specification.transition&&(v.delay||v.duration)&&(this.prior=p)}possiblyEvaluate(o,u,p){const v=o.now||0,S=this.value.possiblyEvaluate(o,u,p),C=this.prior;if(C){if(v>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(v<this.begin)return C.possiblyEvaluate(o,u,p);{const L=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(o,u,p),S,function(k){if(k<=0)return 0;if(k>=1)return 1;const j=k*k,q=j*k;return 4*(k<.5?q:3*(k-j)+q-.75)}(L))}}return S}}class ju{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,p){const v=new Ec(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(o,u,p);return v}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Kh{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return ot(this._values[o].value)}setValue(o,u){this._values[o]=new ol(this._values[o].property,u===null?void 0:ot(u))}serialize(){const o={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(o[u]=p)}return o}possiblyEvaluate(o,u,p){const v=new Ec(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(o,u,p);return v}}class ho{constructor(o,u,p){this.property=o,this.value=u,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,u,p,v){return this.property.evaluate(this.value,this.parameters,o,u,p,v)}}class Ec{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class ni{constructor(o){this.specification=o}possiblyEvaluate(o,u){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(u)}interpolate(o,u,p){const v=gs[this.specification.type];return v?v(o,u,p):o}}class di{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,p,v){return new ho(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},p,v)}:o.expression,u)}interpolate(o,u,p){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new ho(this,{kind:"constant",value:void 0},o.parameters);const v=gs[this.specification.type];if(v){const S=v(o.value.value,u.value.value,p);return new ho(this,{kind:"constant",value:S},o.parameters)}return o}evaluate(o,u,p,v,S,C){return o.kind==="constant"?o.value:o.evaluate(u,p,v,S,C)}}class ah extends di{possiblyEvaluate(o,u,p,v){if(o.value===void 0)return new ho(this,{kind:"constant",value:void 0},u);if(o.expression.kind==="constant"){const S=o.expression.evaluate(u,null,{},p,v),C=o.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(C,C,C,u);return new ho(this,{kind:"constant",value:L},u)}if(o.expression.kind==="camera"){const S=this._calculate(o.expression.evaluate({zoom:u.zoom-1}),o.expression.evaluate({zoom:u.zoom}),o.expression.evaluate({zoom:u.zoom+1}),u);return new ho(this,{kind:"constant",value:S},u)}return new ho(this,o.expression,u)}evaluate(o,u,p,v,S,C){if(o.kind==="source"){const L=o.evaluate(u,p,v,S,C);return this._calculate(L,L,L,u)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(u.zoom)-1},p,v),o.evaluate({zoom:Math.floor(u.zoom)},p,v),o.evaluate({zoom:Math.floor(u.zoom)+1},p,v),u):o.value}_calculate(o,u,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:p,to:u}}interpolate(o){return o}}class ll{constructor(o){this.specification=o}possiblyEvaluate(o,u,p,v){if(o.value!==void 0){if(o.expression.kind==="constant"){const S=o.expression.evaluate(u,null,{},p,v);return this._calculate(S,S,S,u)}return this._calculate(o.expression.evaluate(new Cr(Math.floor(u.zoom-1),u)),o.expression.evaluate(new Cr(Math.floor(u.zoom),u)),o.expression.evaluate(new Cr(Math.floor(u.zoom+1),u)),u)}}_calculate(o,u,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:p,to:u}}interpolate(o){return o}}class Cc{constructor(o){this.specification=o}possiblyEvaluate(o,u,p,v){return!!o.expression.evaluate(u,null,{},p,v)}interpolate(){return!1}}class Cs{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in o){const p=o[u];p.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new ol(p,void 0),S=this.defaultTransitionablePropertyValues[u]=new al(p);this.defaultTransitioningPropertyValues[u]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate({})}}}We("DataDrivenProperty",di),We("DataConstantProperty",ni),We("CrossFadedDataDrivenProperty",ah),We("CrossFadedProperty",ll),We("ColorRampProperty",Cc);const Yh="-transition";class uo extends Pt{constructor(o,u){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),u.layout&&(this._unevaluatedLayout=new Kh(u.layout)),u.paint)){this._transitionablePaint=new Sc(u.paint);for(const p in o.paint)this.setPaintProperty(p,o.paint[p],{validate:!1});for(const p in o.layout)this.setLayoutProperty(p,o.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ec(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};u!=null&&this._validate(ql,`layers.${this.id}.layout.${o}`,o,u,p)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return o.endsWith(Yh)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(u!=null&&this._validate(Bo,`layers.${this.id}.paint.${o}`,o,u,p))return!1;if(o.endsWith(Yh))return this._transitionablePaint.setTransition(o.slice(0,-11),u||void 0),!1;{const v=this._transitionablePaint._values[o],S=v.property.specification["property-type"]==="cross-faded-data-driven",C=v.value.isDataDriven(),L=v.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const k=this._transitionablePaint._values[o].value;return k.isDataDriven()||C||S||this._handleOverridablePaintPropertyUpdate(o,L,k)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,u,p){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),zt(o,(u,p)=>!(u===void 0||p==="layout"&&!Object.keys(u).length||p==="paint"&&!Object.keys(u).length))}_validate(o,u,p,v){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!S||S.validate!==!1)&&$o(this,o.call(Dr,{key:u,layerType:this.type,objectKey:p,value:v,styleSpec:Zt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof ho&&Ct(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const Qh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Tc{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function os(h){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=0,p=0;return{members:h.map(v=>{const S=Qh[v.type].BYTES_PER_ELEMENT,C=u=Uu(u,Math.max(o,S)),L=v.components||1;return p=Math.max(p,S),u+=S*L,{name:v.name,type:v.type,components:L,offset:C}}),size:Uu(u,Math.max(p,o)),alignment:o}}function Uu(h,o){return Math.ceil(h/o)*o}class Nn extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,u)}emplace(o,u,p){const v=2*o;return this.int16[v+0]=u,this.int16[v+1]=p,o}}Nn.prototype.bytesPerElement=4,We("StructArrayLayout2i4",Nn);class vs extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,p)}emplace(o,u,p,v){const S=3*o;return this.int16[S+0]=u,this.int16[S+1]=p,this.int16[S+2]=v,o}}vs.prototype.bytesPerElement=6,We("StructArrayLayout3i6",vs);class po extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,p,v)}emplace(o,u,p,v,S){const C=4*o;return this.int16[C+0]=u,this.int16[C+1]=p,this.int16[C+2]=v,this.int16[C+3]=S,o}}po.prototype.bytesPerElement=8,We("StructArrayLayout4i8",po);class tu extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,o,u,p,v,S,C)}emplace(o,u,p,v,S,C,L){const k=6*o;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=v,this.int16[k+3]=S,this.int16[k+4]=C,this.int16[k+5]=L,o}}tu.prototype.bytesPerElement=12,We("StructArrayLayout2i4i12",tu);class lh extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,o,u,p,v,S,C)}emplace(o,u,p,v,S,C,L){const k=4*o,j=8*o;return this.int16[k+0]=u,this.int16[k+1]=p,this.uint8[j+4]=v,this.uint8[j+5]=S,this.uint8[j+6]=C,this.uint8[j+7]=L,o}}lh.prototype.bytesPerElement=8,We("StructArrayLayout2i4ub8",lh);class Fn extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,u)}emplace(o,u,p){const v=2*o;return this.float32[v+0]=u,this.float32[v+1]=p,o}}Fn.prototype.bytesPerElement=8,We("StructArrayLayout2f8",Fn);class Qs extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C,L,k,j,q){const J=this.length;return this.resize(J+1),this.emplace(J,o,u,p,v,S,C,L,k,j,q)}emplace(o,u,p,v,S,C,L,k,j,q,J){const et=10*o;return this.uint16[et+0]=u,this.uint16[et+1]=p,this.uint16[et+2]=v,this.uint16[et+3]=S,this.uint16[et+4]=C,this.uint16[et+5]=L,this.uint16[et+6]=k,this.uint16[et+7]=j,this.uint16[et+8]=q,this.uint16[et+9]=J,o}}Qs.prototype.bytesPerElement=20,We("StructArrayLayout10ui20",Qs);class eu extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C,L,k,j,q,J,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,o,u,p,v,S,C,L,k,j,q,J,et)}emplace(o,u,p,v,S,C,L,k,j,q,J,et,nt){const lt=12*o;return this.int16[lt+0]=u,this.int16[lt+1]=p,this.int16[lt+2]=v,this.int16[lt+3]=S,this.uint16[lt+4]=C,this.uint16[lt+5]=L,this.uint16[lt+6]=k,this.uint16[lt+7]=j,this.int16[lt+8]=q,this.int16[lt+9]=J,this.int16[lt+10]=et,this.int16[lt+11]=nt,o}}eu.prototype.bytesPerElement=24,We("StructArrayLayout4i4ui4i24",eu);class iu extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,p)}emplace(o,u,p,v){const S=3*o;return this.float32[S+0]=u,this.float32[S+1]=p,this.float32[S+2]=v,o}}iu.prototype.bytesPerElement=12,We("StructArrayLayout3f12",iu);class Ro extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}Ro.prototype.bytesPerElement=4,We("StructArrayLayout1ul4",Ro);class Pc extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C,L,k,j){const q=this.length;return this.resize(q+1),this.emplace(q,o,u,p,v,S,C,L,k,j)}emplace(o,u,p,v,S,C,L,k,j,q){const J=10*o,et=5*o;return this.int16[J+0]=u,this.int16[J+1]=p,this.int16[J+2]=v,this.int16[J+3]=S,this.int16[J+4]=C,this.int16[J+5]=L,this.uint32[et+3]=k,this.uint16[J+8]=j,this.uint16[J+9]=q,o}}Pc.prototype.bytesPerElement=20,We("StructArrayLayout6i1ul2ui20",Pc);class Wl extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,o,u,p,v,S,C)}emplace(o,u,p,v,S,C,L){const k=6*o;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=v,this.int16[k+3]=S,this.int16[k+4]=C,this.int16[k+5]=L,o}}Wl.prototype.bytesPerElement=12,We("StructArrayLayout2i2i2i12",Wl);class Ic extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S){const C=this.length;return this.resize(C+1),this.emplace(C,o,u,p,v,S)}emplace(o,u,p,v,S,C){const L=4*o,k=8*o;return this.float32[L+0]=u,this.float32[L+1]=p,this.float32[L+2]=v,this.int16[k+6]=S,this.int16[k+7]=C,o}}Ic.prototype.bytesPerElement=16,We("StructArrayLayout2f1f2i16",Ic);class Mc extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,p,v)}emplace(o,u,p,v,S){const C=12*o,L=3*o;return this.uint8[C+0]=u,this.uint8[C+1]=p,this.float32[L+1]=v,this.float32[L+2]=S,o}}Mc.prototype.bytesPerElement=12,We("StructArrayLayout2ub2f12",Mc);class cl extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,p)}emplace(o,u,p,v){const S=3*o;return this.uint16[S+0]=u,this.uint16[S+1]=p,this.uint16[S+2]=v,o}}cl.prototype.bytesPerElement=6,We("StructArrayLayout3ui6",cl);class Yo extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C,L,k,j,q,J,et,nt,lt,gt,St,Bt){const $t=this.length;return this.resize($t+1),this.emplace($t,o,u,p,v,S,C,L,k,j,q,J,et,nt,lt,gt,St,Bt)}emplace(o,u,p,v,S,C,L,k,j,q,J,et,nt,lt,gt,St,Bt,$t){const Ot=24*o,Ht=12*o,_e=48*o;return this.int16[Ot+0]=u,this.int16[Ot+1]=p,this.uint16[Ot+2]=v,this.uint16[Ot+3]=S,this.uint32[Ht+2]=C,this.uint32[Ht+3]=L,this.uint32[Ht+4]=k,this.uint16[Ot+10]=j,this.uint16[Ot+11]=q,this.uint16[Ot+12]=J,this.float32[Ht+7]=et,this.float32[Ht+8]=nt,this.uint8[_e+36]=lt,this.uint8[_e+37]=gt,this.uint8[_e+38]=St,this.uint32[Ht+10]=Bt,this.int16[Ot+22]=$t,o}}Yo.prototype.bytesPerElement=48,We("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Yo);class fo extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,v,S,C,L,k,j,q,J,et,nt,lt,gt,St,Bt,$t,Ot,Ht,_e,be,He,ri,Ue,ze,Be,Ye){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,o,u,p,v,S,C,L,k,j,q,J,et,nt,lt,gt,St,Bt,$t,Ot,Ht,_e,be,He,ri,Ue,ze,Be,Ye)}emplace(o,u,p,v,S,C,L,k,j,q,J,et,nt,lt,gt,St,Bt,$t,Ot,Ht,_e,be,He,ri,Ue,ze,Be,Ye,Oe){const Ce=32*o,mi=16*o;return this.int16[Ce+0]=u,this.int16[Ce+1]=p,this.int16[Ce+2]=v,this.int16[Ce+3]=S,this.int16[Ce+4]=C,this.int16[Ce+5]=L,this.int16[Ce+6]=k,this.int16[Ce+7]=j,this.uint16[Ce+8]=q,this.uint16[Ce+9]=J,this.uint16[Ce+10]=et,this.uint16[Ce+11]=nt,this.uint16[Ce+12]=lt,this.uint16[Ce+13]=gt,this.uint16[Ce+14]=St,this.uint16[Ce+15]=Bt,this.uint16[Ce+16]=$t,this.uint16[Ce+17]=Ot,this.uint16[Ce+18]=Ht,this.uint16[Ce+19]=_e,this.uint16[Ce+20]=be,this.uint16[Ce+21]=He,this.uint16[Ce+22]=ri,this.uint32[mi+12]=Ue,this.float32[mi+13]=ze,this.float32[mi+14]=Be,this.uint16[Ce+30]=Ye,this.uint16[Ce+31]=Oe,o}}fo.prototype.bytesPerElement=64,We("StructArrayLayout8i15ui1ul2f2ui64",fo);class Jl extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}Jl.prototype.bytesPerElement=4,We("StructArrayLayout1f4",Jl);class Lc extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,p)}emplace(o,u,p,v){const S=3*o;return this.uint16[6*o+0]=u,this.float32[S+1]=p,this.float32[S+2]=v,o}}Lc.prototype.bytesPerElement=12,We("StructArrayLayout1ui2f12",Lc);class hl extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,p){const v=this.length;return this.resize(v+1),this.emplace(v,o,u,p)}emplace(o,u,p,v){const S=4*o;return this.uint32[2*o+0]=u,this.uint16[S+2]=p,this.uint16[S+3]=v,o}}hl.prototype.bytesPerElement=8,We("StructArrayLayout1ul2ui8",hl);class ch extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const p=this.length;return this.resize(p+1),this.emplace(p,o,u)}emplace(o,u,p){const v=2*o;return this.uint16[v+0]=u,this.uint16[v+1]=p,o}}ch.prototype.bytesPerElement=4,We("StructArrayLayout2ui4",ch);class ru extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}ru.prototype.bytesPerElement=2,We("StructArrayLayout1ui2",ru);class hh extends Xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,p,v){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,p,v)}emplace(o,u,p,v,S){const C=4*o;return this.float32[C+0]=u,this.float32[C+1]=p,this.float32[C+2]=v,this.float32[C+3]=S,o}}hh.prototype.bytesPerElement=16,We("StructArrayLayout4f16",hh);class Gu extends Tc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}Gu.prototype.size=20;class w extends Pc{get(o){return new Gu(this,o)}}We("CollisionBoxArray",w);class a extends Tc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}a.prototype.size=48;class d extends Yo{get(o){return new a(this,o)}}We("PlacedSymbolArray",d);class m extends Tc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}m.prototype.size=64;class _ extends fo{get(o){return new m(this,o)}}We("SymbolInstanceArray",_);class A extends Jl{getoffsetX(o){return this.float32[1*o+0]}}We("GlyphOffsetArray",A);class B extends vs{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}We("SymbolLineVertexArray",B);class R extends Tc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}R.prototype.size=12;class g extends Lc{get(o){return new R(this,o)}}We("TextAnchorOffsetArray",g);class b extends Tc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}b.prototype.size=8;class E extends hl{get(o){return new b(this,o)}}We("FeatureIndexArray",E);class I extends Nn{}class O extends Nn{}class F extends Nn{}class z extends tu{}class V extends lh{}class U extends Fn{}class W extends Qs{}class at extends eu{}class tt extends iu{}class ht extends Ro{}class ut extends Wl{}class Tt extends Mc{}class bt extends cl{}class pt extends ch{}const ft=os([{name:"a_pos",components:2,type:"Int16"}],4),{members:jt}=ft;class Wt{constructor(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=o}prepareSegment(o,u,p,v){let S=this.segments[this.segments.length-1];return o>Wt.MAX_VERTEX_ARRAY_LENGTH&&Lt(`Max vertices per segment is ${Wt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!S||S.vertexLength+o>Wt.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==v)&&(S={vertexOffset:u.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},v!==void 0&&(S.sortKey=v),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,p,v){return new Wt([{vertexOffset:o,primitiveOffset:u,vertexLength:p,primitiveLength:v,vaos:{},sortKey:0}])}}function se(h,o){return 256*(h=Mt(Math.floor(h),0,255))+Mt(Math.floor(o),0,255)}Wt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,We("SegmentVector",Wt);const ne=os([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var fe={exports:{}},Me={exports:{}};Me.exports=function(h,o){var u,p,v,S,C,L,k,j;for(p=h.length-(u=3&h.length),v=o,C=3432918353,L=461845907,j=0;j<p;)k=255&h.charCodeAt(j)|(255&h.charCodeAt(++j))<<8|(255&h.charCodeAt(++j))<<16|(255&h.charCodeAt(++j))<<24,++j,v=27492+(65535&(S=5*(65535&(v=(v^=k=(65535&(k=(k=(65535&k)*C+(((k>>>16)*C&65535)<<16)&4294967295)<<15|k>>>17))*L+(((k>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(k=0,u){case 3:k^=(255&h.charCodeAt(j+2))<<16;case 2:k^=(255&h.charCodeAt(j+1))<<8;case 1:v^=k=(65535&(k=(k=(65535&(k^=255&h.charCodeAt(j)))*C+(((k>>>16)*C&65535)<<16)&4294967295)<<15|k>>>17))*L+(((k>>>16)*L&65535)<<16)&4294967295}return v^=h.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var we=Me.exports,je={exports:{}};je.exports=function(h,o){for(var u,p=h.length,v=o^p,S=0;p>=4;)u=1540483477*(65535&(u=255&h.charCodeAt(S)|(255&h.charCodeAt(++S))<<8|(255&h.charCodeAt(++S))<<16|(255&h.charCodeAt(++S))<<24))+((1540483477*(u>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++S;switch(p){case 3:v^=(255&h.charCodeAt(S+2))<<16;case 2:v^=(255&h.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&h.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var $e=we,Ze=je.exports;fe.exports=$e,fe.exports.murmur3=$e,fe.exports.murmur2=Ze;var yi=f(fe.exports);class _i{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,p,v){this.ids.push(Ui(o)),this.positions.push(u,p,v)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Ui(o);let p=0,v=this.ids.length-1;for(;p<v;){const C=p+v>>1;this.ids[C]>=u?v=C:p=C+1}const S=[];for(;this.ids[p]===u;)S.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return S}static serialize(o,u){const p=new Float64Array(o.ids),v=new Uint32Array(o.positions);return pi(p,v,0,p.length-1),u&&u.push(p.buffer,v.buffer),{ids:p,positions:v}}static deserialize(o){const u=new _i;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function Ui(h){const o=+h;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:yi(String(h))}function pi(h,o,u,p){for(;u<p;){const v=h[u+p>>1];let S=u-1,C=p+1;for(;;){do S++;while(h[S]<v);do C--;while(h[C]>v);if(S>=C)break;zi(h,S,C),zi(o,3*S,3*C),zi(o,3*S+1,3*C+1),zi(o,3*S+2,3*C+2)}C-u<p-C?(pi(h,o,u,C),u=C+1):(pi(h,o,C+1,p),p=C)}}function zi(h,o,u){const p=h[o];h[o]=h[u],h[u]=p}We("FeaturePositionMap",_i);class or{constructor(o,u){this.gl=o.gl,this.location=u}}class ar extends or{constructor(o,u){super(o,u),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class $r extends or{constructor(o,u){super(o,u),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class Yi extends or{constructor(o,u){super(o,u),this.current=Bi.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const Ns=new Float32Array(16);function us(h){return[se(255*h.r,255*h.g),se(255*h.b,255*h.a)]}class Tr{constructor(o,u,p){this.value=o,this.uniformNames=u.map(v=>`u_${v}`),this.type=p}setUniform(o,u,p){o.set(p.constantOr(this.value))}getBinding(o,u,p){return this.type==="color"?new Yi(o,u):new ar(o,u)}}class Qi{constructor(o,u){this.uniformNames=u.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr}setUniform(o,u,p,v){const S=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&o.set(S)}getBinding(o,u,p){return p.substr(0,9)==="u_pattern"?new $r(o,u):new ar(o,u)}}class Wi{constructor(o,u,p,v){this.expression=o,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(S=>({name:`a_${S}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,u,p,v,S){const C=this.paintVertexArray.length,L=this.expression.evaluate(new Cr(0),u,{},v,[],S);this.paintVertexArray.resize(o),this._setPaintValue(C,o,L)}updatePaintArray(o,u,p,v){const S=this.expression.evaluate({zoom:0},p,v);this._setPaintValue(o,u,S)}_setPaintValue(o,u,p){if(this.type==="color"){const v=us(p);for(let S=o;S<u;S++)this.paintVertexArray.emplace(S,v[0],v[1])}else{for(let v=o;v<u;v++)this.paintVertexArray.emplace(v,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tr{constructor(o,u,p,v,S,C){this.expression=o,this.uniformNames=u.map(L=>`u_${L}_t`),this.type=p,this.useIntegerZoom=v,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=u.map(L=>({name:`a_${L}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(o,u,p,v,S){const C=this.expression.evaluate(new Cr(this.zoom),u,{},v,[],S),L=this.expression.evaluate(new Cr(this.zoom+1),u,{},v,[],S),k=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(k,o,C,L)}updatePaintArray(o,u,p,v){const S=this.expression.evaluate({zoom:this.zoom},p,v),C=this.expression.evaluate({zoom:this.zoom+1},p,v);this._setPaintValue(o,u,S,C)}_setPaintValue(o,u,p,v){if(this.type==="color"){const S=us(p),C=us(v);for(let L=o;L<u;L++)this.paintVertexArray.emplace(L,S[0],S[1],C[0],C[1])}else{for(let S=o;S<u;S++)this.paintVertexArray.emplace(S,p,v);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(v))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u){const p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=Mt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);o.set(v)}getBinding(o,u,p){return new ar(o,u)}}class as{constructor(o,u,p,v,S,C){this.expression=o,this.type=u,this.useIntegerZoom=p,this.zoom=v,this.layerId=C,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(o,u,p){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(v,o,u.patterns&&u.patterns[this.layerId],p)}updatePaintArray(o,u,p,v,S){this._setPaintValues(o,u,p.patterns&&p.patterns[this.layerId],S)}_setPaintValues(o,u,p,v){if(!v||!p)return;const{min:S,mid:C,max:L}=p,k=v[S],j=v[C],q=v[L];if(k&&j&&q)for(let J=o;J<u;J++)this.zoomInPaintVertexArray.emplace(J,j.tl[0],j.tl[1],j.br[0],j.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],j.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(J,j.tl[0],j.tl[1],j.br[0],j.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],j.pixelRatio,q.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,ne.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,ne.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $i{constructor(o,u,p){this.binders={},this._buffers=[];const v=[];for(const S in o.paint._values){if(!p(S))continue;const C=o.paint.get(S);if(!(C instanceof ho&&Ct(C.property.specification)))continue;const L=Ts(S,o.type),k=C.value,j=C.property.specification.type,q=C.property.useIntegerZoom,J=C.property.specification["property-type"],et=J==="cross-faded"||J==="cross-faded-data-driven";if(k.kind==="constant")this.binders[S]=et?new Qi(k.value,L):new Tr(k.value,L,j),v.push(`/u_${S}`);else if(k.kind==="source"||et){const nt=Nr(S,j,"source");this.binders[S]=et?new as(k,j,q,u,nt,o.id):new Wi(k,L,j,nt),v.push(`/a_${S}`)}else{const nt=Nr(S,j,"composite");this.binders[S]=new tr(k,L,j,q,u,nt),v.push(`/z_${S}`)}}this.cacheKey=v.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof Wi||u instanceof tr?u.maxValue:0}populatePaintArrays(o,u,p,v,S){for(const C in this.binders){const L=this.binders[C];(L instanceof Wi||L instanceof tr||L instanceof as)&&L.populatePaintArray(o,u,p,v,S)}}setConstantPatternPositions(o,u){for(const p in this.binders){const v=this.binders[p];v instanceof Qi&&v.setConstantPatternPositions(o,u)}}updatePaintArrays(o,u,p,v,S){let C=!1;for(const L in o){const k=u.getPositions(L);for(const j of k){const q=p.feature(j.index);for(const J in this.binders){const et=this.binders[J];if((et instanceof Wi||et instanceof tr||et instanceof as)&&et.expression.isStateDependent===!0){const nt=v.paint.get(J);et.expression=nt.value,et.updatePaintArray(j.start,j.end,q,o[L],S),C=!0}}}}return C}defines(){const o=[];for(const u in this.binders){const p=this.binders[u];(p instanceof Tr||p instanceof Qi)&&o.push(...p.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Wi||p instanceof tr)for(let v=0;v<p.paintVertexAttributes.length;v++)o.push(p.paintVertexAttributes[v].name);else if(p instanceof as)for(let v=0;v<ne.members.length;v++)o.push(ne.members[v].name)}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Tr||p instanceof Qi||p instanceof tr)for(const v of p.uniformNames)o.push(v)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,u){const p=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof Tr||S instanceof Qi||S instanceof tr){for(const C of S.uniformNames)if(u[C]){const L=S.getBinding(o,u[C],C);p.push({name:C,property:v,binding:L})}}}return p}setUniforms(o,u,p,v){for(const{name:S,property:C,binding:L}of u)this.binders[C].setUniform(L,v,p.get(C),S)}updatePaintBuffers(o){this._buffers=[];for(const u in this.binders){const p=this.binders[u];if(o&&p instanceof as){const v=o.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(p instanceof Wi||p instanceof tr)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(o){for(const u in this.binders){const p=this.binders[u];(p instanceof Wi||p instanceof tr||p instanceof as)&&p.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof Wi||u instanceof tr||u instanceof as)&&u.destroy()}}}class lr{constructor(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const v of o)this.programConfigurations[v.id]=new $i(v,u,p);this.needsUpload=!1,this._featureMap=new _i,this._bufferOffset=0}populatePaintArrays(o,u,p,v,S,C){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(o,u,v,S,C);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,p,v){for(const S of p)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(o,this._featureMap,u,S,v)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function Ts(h,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${o}-`,"").replace(/-/g,"_")]}function Nr(h,o,u){const p={color:{source:Fn,composite:hh},number:{source:Jl,composite:Fn}},v=function(S){return{"line-pattern":{source:W,composite:W},"fill-pattern":{source:W,composite:W},"fill-extrusion-pattern":{source:W,composite:W}}[S]}(h);return v&&v[u]||p[o][u]}We("ConstantBinder",Tr),We("CrossFadedConstantBinder",Qi),We("SourceExpressionBinder",Wi),We("CrossFadedCompositeBinder",as),We("CompositeExpressionBinder",tr),We("ProgramConfiguration",$i,{omit:["_buffers"]}),We("ProgramConfigurationSet",lr);const br=8192,qr=Math.pow(2,14)-1,uh=-qr-1;function Pa(h){const o=br/h.extent,u=h.loadGeometry();for(let p=0;p<u.length;p++){const v=u[p];for(let S=0;S<v.length;S++){const C=v[S],L=Math.round(C.x*o),k=Math.round(C.y*o);C.x=Mt(L,uh,qr),C.y=Mt(k,uh,qr),(L<C.x||L>C.x+1||k<C.y||k>C.y+1)&&Lt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Ia(h,o){return{type:h.type,id:h.id,properties:h.properties,geometry:o?Pa(h):[]}}function ul(h,o,u,p,v){h.emplaceBack(2*o+(p+1)/2,2*u+(v+1)/2)}class zn{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new O,this.indexArray=new bt,this.segments=new Wt,this.programConfigurations=new lr(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){const v=this.layers[0],S=[];let C=null,L=!1;v.type==="circle"&&(C=v.layout.get("circle-sort-key"),L=!C.isConstant());for(const{feature:k,id:j,index:q,sourceLayerIndex:J}of o){const et=this.layers[0]._featureFilter.needGeometry,nt=Ia(k,et);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),nt,p))continue;const lt=L?C.evaluate(nt,{},p):void 0,gt={id:j,properties:k.properties,type:k.type,sourceLayerIndex:J,index:q,geometry:et?nt.geometry:Pa(k),patterns:{},sortKey:lt};S.push(gt)}L&&S.sort((k,j)=>k.sortKey-j.sortKey);for(const k of S){const{geometry:j,index:q,sourceLayerIndex:J}=k,et=o[q].feature;this.addFeature(k,j,q,p),u.featureIndex.insert(et,j,q,J,this.index)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,jt),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,p,v){for(const S of u)for(const C of S){const L=C.x,k=C.y;if(L<0||L>=br||k<0||k>=br)continue;const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),q=j.vertexLength;ul(this.layoutVertexArray,L,k,-1,-1),ul(this.layoutVertexArray,L,k,1,-1),ul(this.layoutVertexArray,L,k,1,1),ul(this.layoutVertexArray,L,k,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,{},v)}}function Zl(h,o){for(let u=0;u<h.length;u++)if(dl(o,h[u]))return!0;for(let u=0;u<o.length;u++)if(dl(h,o[u]))return!0;return!!Bc(h,o)}function jn(h,o,u){return!!dl(h,o)||!!Vu(o,h,u)}function Ma(h,o){if(h.length===1)return qu(o,h[0]);for(let u=0;u<o.length;u++){const p=o[u];for(let v=0;v<p.length;v++)if(dl(h,p[v]))return!0}for(let u=0;u<h.length;u++)if(qu(o,h[u]))return!0;for(let u=0;u<o.length;u++)if(Bc(h,o[u]))return!0;return!1}function La(h,o,u){if(h.length>1){if(Bc(h,o))return!0;for(let p=0;p<o.length;p++)if(Vu(o[p],h,u))return!0}for(let p=0;p<h.length;p++)if(Vu(h[p],o,u))return!0;return!1}function Bc(h,o){if(h.length===0||o.length===0)return!1;for(let u=0;u<h.length-1;u++){const p=h[u],v=h[u+1];for(let S=0;S<o.length-1;S++)if(Xl(p,v,o[S],o[S+1]))return!0}return!1}function Xl(h,o,u,p){return wt(h,u,p)!==wt(o,u,p)&&wt(h,o,u)!==wt(h,o,p)}function Vu(h,o,u){const p=u*u;if(o.length===1)return h.distSqr(o[0])<p;for(let v=1;v<o.length;v++)if(su(h,o[v-1],o[v])<p)return!0;return!1}function su(h,o,u){const p=o.distSqr(u);if(p===0)return h.distSqr(o);const v=((h.x-o.x)*(u.x-o.x)+(h.y-o.y)*(u.y-o.y))/p;return h.distSqr(v<0?o:v>1?u:u.sub(o)._mult(v)._add(o))}function qu(h,o){let u,p,v,S=!1;for(let C=0;C<h.length;C++){u=h[C];for(let L=0,k=u.length-1;L<u.length;k=L++)p=u[L],v=u[k],p.y>o.y!=v.y>o.y&&o.x<(v.x-p.x)*(o.y-p.y)/(v.y-p.y)+p.x&&(S=!S)}return S}function dl(h,o){let u=!1;for(let p=0,v=h.length-1;p<h.length;v=p++){const S=h[p],C=h[v];S.y>o.y!=C.y>o.y&&o.x<(C.x-S.x)*(o.y-S.y)/(C.y-S.y)+S.x&&(u=!u)}return u}function nu(h,o,u){const p=u[0],v=u[2];if(h.x<p.x&&o.x<p.x||h.x>v.x&&o.x>v.x||h.y<p.y&&o.y<p.y||h.y>v.y&&o.y>v.y)return!1;const S=wt(h,o,u[0]);return S!==wt(h,o,u[1])||S!==wt(h,o,u[2])||S!==wt(h,o,u[3])}function ou(h,o,u){const p=o.paint.get(h).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(h)}function Hu(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function dh(h,o,u,p,v){if(!o[0]&&!o[1])return h;const S=T.convert(o)._mult(v);u==="viewport"&&S._rotate(-p);const C=[];for(let L=0;L<h.length;L++)C.push(h[L].sub(S));return C}let pl,Tf;We("CircleBucket",zn,{omit:["layers"]});var qm={get paint(){return Tf=Tf||new Cs({"circle-radius":new di(Zt.paint_circle["circle-radius"]),"circle-color":new di(Zt.paint_circle["circle-color"]),"circle-blur":new di(Zt.paint_circle["circle-blur"]),"circle-opacity":new di(Zt.paint_circle["circle-opacity"]),"circle-translate":new ni(Zt.paint_circle["circle-translate"]),"circle-translate-anchor":new ni(Zt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ni(Zt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ni(Zt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new di(Zt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new di(Zt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new di(Zt.paint_circle["circle-stroke-opacity"])})},get layout(){return pl=pl||new Cs({"circle-sort-key":new di(Zt.layout_circle["circle-sort-key"])})}},un=1e-6,Rc=typeof Float32Array<"u"?Float32Array:Array;function ph(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function Qd(h,o,u){var p=o[0],v=o[1],S=o[2],C=o[3],L=o[4],k=o[5],j=o[6],q=o[7],J=o[8],et=o[9],nt=o[10],lt=o[11],gt=o[12],St=o[13],Bt=o[14],$t=o[15],Ot=u[0],Ht=u[1],_e=u[2],be=u[3];return h[0]=Ot*p+Ht*L+_e*J+be*gt,h[1]=Ot*v+Ht*k+_e*et+be*St,h[2]=Ot*S+Ht*j+_e*nt+be*Bt,h[3]=Ot*C+Ht*q+_e*lt+be*$t,h[4]=(Ot=u[4])*p+(Ht=u[5])*L+(_e=u[6])*J+(be=u[7])*gt,h[5]=Ot*v+Ht*k+_e*et+be*St,h[6]=Ot*S+Ht*j+_e*nt+be*Bt,h[7]=Ot*C+Ht*q+_e*lt+be*$t,h[8]=(Ot=u[8])*p+(Ht=u[9])*L+(_e=u[10])*J+(be=u[11])*gt,h[9]=Ot*v+Ht*k+_e*et+be*St,h[10]=Ot*S+Ht*j+_e*nt+be*Bt,h[11]=Ot*C+Ht*q+_e*lt+be*$t,h[12]=(Ot=u[12])*p+(Ht=u[13])*L+(_e=u[14])*J+(be=u[15])*gt,h[13]=Ot*v+Ht*k+_e*et+be*St,h[14]=Ot*S+Ht*j+_e*nt+be*Bt,h[15]=Ot*C+Ht*q+_e*lt+be*$t,h}Math.hypot||(Math.hypot=function(){for(var h=0,o=arguments.length;o--;)h+=arguments[o]*arguments[o];return Math.sqrt(h)});var fh,Wu=Qd;function gh(h,o,u){var p=o[0],v=o[1],S=o[2],C=o[3];return h[0]=u[0]*p+u[4]*v+u[8]*S+u[12]*C,h[1]=u[1]*p+u[5]*v+u[9]*S+u[13]*C,h[2]=u[2]*p+u[6]*v+u[10]*S+u[14]*C,h[3]=u[3]*p+u[7]*v+u[11]*S+u[15]*C,h}fh=new Rc(4),Rc!=Float32Array&&(fh[0]=0,fh[1]=0,fh[2]=0,fh[3]=0);class au extends uo{constructor(o){super(o,qm)}createBucket(o){return new zn(o)}queryRadius(o){const u=o;return ou("circle-radius",this,u)+ou("circle-stroke-width",this,u)+Hu(this.paint.get("circle-translate"))}queryIntersectsFeature(o,u,p,v,S,C,L,k){const j=dh(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,L),q=this.paint.get("circle-radius").evaluate(u,p)+this.paint.get("circle-stroke-width").evaluate(u,p),J=this.paint.get("circle-pitch-alignment")==="map",et=J?j:function(lt,gt){return lt.map(St=>tp(St,gt))}(j,k),nt=J?q*L:q;for(const lt of v)for(const gt of lt){const St=J?gt:tp(gt,k);let Bt=nt;const $t=gh([],[gt.x,gt.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Bt*=$t[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Bt*=C.cameraToCenterDistance/$t[3]),jn(et,St,Bt))return!0}return!1}}function tp(h,o){const u=gh([],[h.x,h.y,0,1],o);return new T(u[0]/u[3],u[1]/u[3])}class Pf extends zn{}let lu;We("HeatmapBucket",Pf,{omit:["layers"]});var If={get paint(){return lu=lu||new Cs({"heatmap-radius":new di(Zt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new di(Zt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ni(Zt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cc(Zt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ni(Zt.paint_heatmap["heatmap-opacity"])})}};function cu(h,o,u,p){let{width:v,height:S}=o;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==v*S*u)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${v*S*u}`)}else p=new Uint8Array(v*S*u);return h.width=v,h.height=S,h.data=p,h}function fl(h,o,u){let{width:p,height:v}=o;if(p===h.width&&v===h.height)return;const S=cu({},{width:p,height:v},u);Ju(h,S,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,p),height:Math.min(h.height,v)},u),h.width=p,h.height=v,h.data=S.data}function Ju(h,o,u,p,v,S){if(v.width===0||v.height===0)return o;if(v.width>h.width||v.height>h.height||u.x>h.width-v.width||u.y>h.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>o.width||v.height>o.height||p.x>o.width-v.width||p.y>o.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const C=h.data,L=o.data;if(C===L)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<v.height;k++){const j=((u.y+k)*h.width+u.x)*S,q=((p.y+k)*o.width+p.x)*S;for(let J=0;J<v.width*S;J++)L[q+J]=C[j+J]}return o}class mh{constructor(o,u){cu(this,o,1,u)}resize(o){fl(this,o,1)}clone(){return new mh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,p,v,S){Ju(o,u,p,v,S,1)}}class go{constructor(o,u){cu(this,o,4,u)}resize(o){fl(this,o,4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,p,v,S){Ju(o,u,p,v,S,4)}}function ep(h){const o={},u=h.resolution||256,p=h.clips?h.clips.length:1,v=h.image||new go({width:u,height:p});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const S=(C,L,k)=>{o[h.evaluationKey]=k;const j=h.expression.evaluate(o);v.data[C+L+0]=Math.floor(255*j.r/j.a),v.data[C+L+1]=Math.floor(255*j.g/j.a),v.data[C+L+2]=Math.floor(255*j.b/j.a),v.data[C+L+3]=Math.floor(255*j.a)};if(h.clips)for(let C=0,L=0;C<p;++C,L+=4*u)for(let k=0,j=0;k<u;k++,j+=4){const q=k/(u-1),{start:J,end:et}=h.clips[C];S(L,j,J*(1-q)+et*q)}else for(let C=0,L=0;C<u;C++,L+=4)S(0,L,C/(u-1));return v}We("AlphaImage",mh),We("RGBAImage",go);class yh extends uo{createBucket(o){return new Pf(o)}constructor(o){super(o,If),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Mf;var Lf={get paint(){return Mf=Mf||new Cs({"hillshade-illumination-direction":new ni(Zt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ni(Zt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ni(Zt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ni(Zt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ni(Zt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ni(Zt.paint_hillshade["hillshade-accent-color"])})}};class Hm extends uo{constructor(o){super(o,Lf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Bf=os([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wm}=Bf;var kc={exports:{}};function _h(h,o,u){u=u||2;var p,v,S,C,L,k,j,q=o&&o.length,J=q?o[0]*u:h.length,et=hu(h,0,J,u,!0),nt=[];if(!et||et.next===et.prev)return nt;if(q&&(et=function(gt,St,Bt,$t){var Ot,Ht,_e,be=[];for(Ot=0,Ht=St.length;Ot<Ht;Ot++)(_e=hu(gt,St[Ot]*$t,Ot<Ht-1?St[Ot+1]*$t:gt.length,$t,!1))===_e.next&&(_e.steiner=!0),be.push(dC(_e));for(be.sort(Jm),Ot=0;Ot<be.length;Ot++)Bt=rp(be[Ot],Bt);return Bt}(h,o,et,u)),h.length>80*u){p=S=h[0],v=C=h[1];for(var lt=u;lt<J;lt+=u)(L=h[lt])<p&&(p=L),(k=h[lt+1])<v&&(v=k),L>S&&(S=L),k>C&&(C=k);j=(j=Math.max(S-p,C-v))!==0?32767/j:0}return ko(et,nt,u,p,v,j,0),nt}function hu(h,o,u,p,v){var S,C;if(v===$m(h,o,u,p)>0)for(S=o;S<u;S+=p)C=Nv(S,h[S],h[S+1],C);else for(S=u-p;S>=o;S-=p)C=Nv(S,h[S],h[S+1],C);return C&&kf(C,C.next)&&(op(C),C=C.next),C}function Cn(h,o){if(!h)return h;o||(o=h);var u,p=h;do if(u=!1,p.steiner||!kf(p,p.next)&&bs(p.prev,p,p.next)!==0)p=p.next;else{if(op(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function ko(h,o,u,p,v,S,C){if(h){!C&&S&&function(q,J,et,nt){var lt=q;do lt.z===0&&(lt.z=Zm(lt.x,lt.y,J,et,nt)),lt.prevZ=lt.prev,lt.nextZ=lt.next,lt=lt.next;while(lt!==q);lt.prevZ.nextZ=null,lt.prevZ=null,function(gt){var St,Bt,$t,Ot,Ht,_e,be,He,ri=1;do{for(Bt=gt,gt=null,Ht=null,_e=0;Bt;){for(_e++,$t=Bt,be=0,St=0;St<ri&&(be++,$t=$t.nextZ);St++);for(He=ri;be>0||He>0&&$t;)be!==0&&(He===0||!$t||Bt.z<=$t.z)?(Ot=Bt,Bt=Bt.nextZ,be--):(Ot=$t,$t=$t.nextZ,He--),Ht?Ht.nextZ=Ot:gt=Ot,Ot.prevZ=Ht,Ht=Ot;Bt=$t}Ht.nextZ=null,ri*=2}while(_e>1)}(lt)}(h,p,v,S);for(var L,k,j=h;h.prev!==h.next;)if(L=h.prev,k=h.next,S?Zu(h,p,v,S):$l(h))o.push(L.i/u|0),o.push(h.i/u|0),o.push(k.i/u|0),op(h),h=k.next,j=k.next;else if((h=k)===j){C?C===1?ko(h=ip(Cn(h),o,u),o,u,p,v,S,2):C===2&&Rf(h,o,u,p,v,S):ko(Cn(h),o,u,p,v,S,1);break}}}function $l(h){var o=h.prev,u=h,p=h.next;if(bs(o,u,p)>=0)return!1;for(var v=o.x,S=u.x,C=p.x,L=o.y,k=u.y,j=p.y,q=v<S?v<C?v:C:S<C?S:C,J=L<k?L<j?L:j:k<j?k:j,et=v>S?v>C?v:C:S>C?S:C,nt=L>k?L>j?L:j:k>j?k:j,lt=p.next;lt!==o;){if(lt.x>=q&&lt.x<=et&&lt.y>=J&&lt.y<=nt&&Xu(v,L,S,k,C,j,lt.x,lt.y)&&bs(lt.prev,lt,lt.next)>=0)return!1;lt=lt.next}return!0}function Zu(h,o,u,p){var v=h.prev,S=h,C=h.next;if(bs(v,S,C)>=0)return!1;for(var L=v.x,k=S.x,j=C.x,q=v.y,J=S.y,et=C.y,nt=L<k?L<j?L:j:k<j?k:j,lt=q<J?q<et?q:et:J<et?J:et,gt=L>k?L>j?L:j:k>j?k:j,St=q>J?q>et?q:et:J>et?J:et,Bt=Zm(nt,lt,o,u,p),$t=Zm(gt,St,o,u,p),Ot=h.prevZ,Ht=h.nextZ;Ot&&Ot.z>=Bt&&Ht&&Ht.z<=$t;){if(Ot.x>=nt&&Ot.x<=gt&&Ot.y>=lt&&Ot.y<=St&&Ot!==v&&Ot!==C&&Xu(L,q,k,J,j,et,Ot.x,Ot.y)&&bs(Ot.prev,Ot,Ot.next)>=0||(Ot=Ot.prevZ,Ht.x>=nt&&Ht.x<=gt&&Ht.y>=lt&&Ht.y<=St&&Ht!==v&&Ht!==C&&Xu(L,q,k,J,j,et,Ht.x,Ht.y)&&bs(Ht.prev,Ht,Ht.next)>=0))return!1;Ht=Ht.nextZ}for(;Ot&&Ot.z>=Bt;){if(Ot.x>=nt&&Ot.x<=gt&&Ot.y>=lt&&Ot.y<=St&&Ot!==v&&Ot!==C&&Xu(L,q,k,J,j,et,Ot.x,Ot.y)&&bs(Ot.prev,Ot,Ot.next)>=0)return!1;Ot=Ot.prevZ}for(;Ht&&Ht.z<=$t;){if(Ht.x>=nt&&Ht.x<=gt&&Ht.y>=lt&&Ht.y<=St&&Ht!==v&&Ht!==C&&Xu(L,q,k,J,j,et,Ht.x,Ht.y)&&bs(Ht.prev,Ht,Ht.next)>=0)return!1;Ht=Ht.nextZ}return!0}function ip(h,o,u){var p=h;do{var v=p.prev,S=p.next.next;!kf(v,S)&&Ov(v,p,p.next,S)&&np(v,S)&&np(S,v)&&(o.push(v.i/u|0),o.push(p.i/u|0),o.push(S.i/u|0),op(p),op(p.next),p=h=S),p=p.next}while(p!==h);return Cn(p)}function Rf(h,o,u,p,v,S){var C=h;do{for(var L=C.next.next;L!==C.prev;){if(C.i!==L.i&&pC(C,L)){var k=Dv(C,L);return C=Cn(C,C.next),k=Cn(k,k.next),ko(C,o,u,p,v,S,0),void ko(k,o,u,p,v,S,0)}L=L.next}C=C.next}while(C!==h)}function Jm(h,o){return h.x-o.x}function rp(h,o){var u=function(v,S){var C,L=S,k=v.x,j=v.y,q=-1/0;do{if(j<=L.y&&j>=L.next.y&&L.next.y!==L.y){var J=L.x+(j-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(J<=k&&J>q&&(q=J,C=L.x<L.next.x?L:L.next,J===k))return C}L=L.next}while(L!==S);if(!C)return null;var et,nt=C,lt=C.x,gt=C.y,St=1/0;L=C;do k>=L.x&&L.x>=lt&&k!==L.x&&Xu(j<gt?k:q,j,lt,gt,j<gt?q:k,j,L.x,L.y)&&(et=Math.abs(j-L.y)/(k-L.x),np(L,v)&&(et<St||et===St&&(L.x>C.x||L.x===C.x&&sp(C,L)))&&(C=L,St=et)),L=L.next;while(L!==nt);return C}(h,o);if(!u)return o;var p=Dv(u,h);return Cn(p,p.next),Cn(u,u.next)}function sp(h,o){return bs(h.prev,h,o.prev)<0&&bs(o.next,h,h.next)<0}function Zm(h,o,u,p,v){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*v|0)|h<<8))|h<<4))|h<<2))|h<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-p)*v|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function dC(h){var o=h,u=h;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==h);return u}function Xu(h,o,u,p,v,S,C,L){return(v-C)*(o-L)>=(h-C)*(S-L)&&(h-C)*(p-L)>=(u-C)*(o-L)&&(u-C)*(S-L)>=(v-C)*(p-L)}function pC(h,o){return h.next.i!==o.i&&h.prev.i!==o.i&&!function(u,p){var v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==p.i&&v.next.i!==p.i&&Ov(v,v.next,u,p))return!0;v=v.next}while(v!==u);return!1}(h,o)&&(np(h,o)&&np(o,h)&&function(u,p){var v=u,S=!1,C=(u.x+p.x)/2,L=(u.y+p.y)/2;do v.y>L!=v.next.y>L&&v.next.y!==v.y&&C<(v.next.x-v.x)*(L-v.y)/(v.next.y-v.y)+v.x&&(S=!S),v=v.next;while(v!==u);return S}(h,o)&&(bs(h.prev,h,o.prev)||bs(h,o.prev,o))||kf(h,o)&&bs(h.prev,h,h.next)>0&&bs(o.prev,o,o.next)>0)}function bs(h,o,u){return(o.y-h.y)*(u.x-o.x)-(o.x-h.x)*(u.y-o.y)}function kf(h,o){return h.x===o.x&&h.y===o.y}function Ov(h,o,u,p){var v=Df(bs(h,o,u)),S=Df(bs(h,o,p)),C=Df(bs(u,p,h)),L=Df(bs(u,p,o));return v!==S&&C!==L||!(v!==0||!Of(h,u,o))||!(S!==0||!Of(h,p,o))||!(C!==0||!Of(u,h,p))||!(L!==0||!Of(u,o,p))}function Of(h,o,u){return o.x<=Math.max(h.x,u.x)&&o.x>=Math.min(h.x,u.x)&&o.y<=Math.max(h.y,u.y)&&o.y>=Math.min(h.y,u.y)}function Df(h){return h>0?1:h<0?-1:0}function np(h,o){return bs(h.prev,h,h.next)<0?bs(h,o,h.next)>=0&&bs(h,h.prev,o)>=0:bs(h,o,h.prev)<0||bs(h,h.next,o)<0}function Dv(h,o){var u=new Xm(h.i,h.x,h.y),p=new Xm(o.i,o.x,o.y),v=h.next,S=o.prev;return h.next=o,o.prev=h,u.next=v,v.prev=u,p.next=u,u.prev=p,S.next=p,p.prev=S,p}function Nv(h,o,u,p){var v=new Xm(h,o,u);return p?(v.next=p.next,v.prev=p,p.next.prev=v,p.next=v):(v.prev=v,v.next=v),v}function op(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function Xm(h,o,u){this.i=h,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $m(h,o,u,p){for(var v=0,S=o,C=u-p;S<u;S+=p)v+=(h[C]-h[S])*(h[S+1]+h[C+1]),C=S;return v}kc.exports=_h,kc.exports.default=_h,_h.deviation=function(h,o,u,p){var v=o&&o.length,S=Math.abs($m(h,0,v?o[0]*u:h.length,u));if(v)for(var C=0,L=o.length;C<L;C++)S-=Math.abs($m(h,o[C]*u,C<L-1?o[C+1]*u:h.length,u));var k=0;for(C=0;C<p.length;C+=3){var j=p[C]*u,q=p[C+1]*u,J=p[C+2]*u;k+=Math.abs((h[j]-h[J])*(h[q+1]-h[j+1])-(h[j]-h[q])*(h[J+1]-h[j+1]))}return S===0&&k===0?0:Math.abs((k-S)/S)},_h.flatten=function(h){for(var o=h[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,v=0;v<h.length;v++){for(var S=0;S<h[v].length;S++)for(var C=0;C<o;C++)u.vertices.push(h[v][S][C]);v>0&&u.holes.push(p+=h[v-1].length)}return u};var Fv=f(kc.exports);function fC(h,o,u,p,v){zv(h,o,u||0,p||h.length-1,v||gC)}function zv(h,o,u,p,v){for(;p>u;){if(p-u>600){var S=p-u+1,C=o-u+1,L=Math.log(S),k=.5*Math.exp(2*L/3),j=.5*Math.sqrt(L*k*(S-k)/S)*(C-S/2<0?-1:1);zv(h,o,Math.max(u,Math.floor(o-C*k/S+j)),Math.min(p,Math.floor(o+(S-C)*k/S+j)),v)}var q=h[o],J=u,et=p;for(ap(h,u,o),v(h[p],q)>0&&ap(h,u,p);J<et;){for(ap(h,J,et),J++,et--;v(h[J],q)<0;)J++;for(;v(h[et],q)>0;)et--}v(h[u],q)===0?ap(h,u,et):ap(h,++et,p),et<=o&&(u=et+1),o<=et&&(p=et-1)}}function ap(h,o,u){var p=h[o];h[o]=h[u],h[u]=p}function gC(h,o){return h<o?-1:h>o?1:0}function Km(h,o){const u=h.length;if(u<=1)return[h];const p=[];let v,S;for(let C=0;C<u;C++){const L=le(h[C]);L!==0&&(h[C].area=Math.abs(L),S===void 0&&(S=L<0),S===L<0?(v&&p.push(v),v=[h[C]]):v.push(h[C]))}if(v&&p.push(v),o>1)for(let C=0;C<p.length;C++)p[C].length<=o||(fC(p[C],o,1,p[C].length-1,mC),p[C]=p[C].slice(0,o));return p}function mC(h,o){return o.area-h.area}function Ym(h,o,u){const p=u.patternDependencies;let v=!1;for(const S of o){const C=S.paint.get(`${h}-pattern`);C.isConstant()||(v=!0);const L=C.constantOr(null);L&&(v=!0,p[L.to]=!0,p[L.from]=!0)}return v}function Qm(h,o,u,p,v){const S=v.patternDependencies;for(const C of o){const L=C.paint.get(`${h}-pattern`).value;if(L.kind!=="constant"){let k=L.evaluate({zoom:p-1},u,{},v.availableImages),j=L.evaluate({zoom:p},u,{},v.availableImages),q=L.evaluate({zoom:p+1},u,{},v.availableImages);k=k&&k.name?k.name:k,j=j&&j.name?j.name:j,q=q&&q.name?q.name:q,S[k]=!0,S[j]=!0,S[q]=!0,u.patterns[C.id]={min:k,mid:j,max:q}}}return u}class t0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new F,this.indexArray=new bt,this.indexArray2=new pt,this.programConfigurations=new lr(o.layers,o.zoom),this.segments=new Wt,this.segments2=new Wt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){this.hasPattern=Ym("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),S=!v.isConstant(),C=[];for(const{feature:L,id:k,index:j,sourceLayerIndex:q}of o){const J=this.layers[0]._featureFilter.needGeometry,et=Ia(L,J);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),et,p))continue;const nt=S?v.evaluate(et,{},p,u.availableImages):void 0,lt={id:k,properties:L.properties,type:L.type,sourceLayerIndex:q,index:j,geometry:J?et.geometry:Pa(L),patterns:{},sortKey:nt};C.push(lt)}S&&C.sort((L,k)=>L.sortKey-k.sortKey);for(const L of C){const{geometry:k,index:j,sourceLayerIndex:q}=L;if(this.hasPattern){const J=Qm("fill",this.layers,L,this.zoom,u);this.patternFeatures.push(J)}else this.addFeature(L,k,j,p,{});u.featureIndex.insert(o[j].feature,k,j,q,this.index)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}addFeatures(o,u,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Wm),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,p,v,S){for(const C of Km(u,500)){let L=0;for(const nt of C)L+=nt.length;const k=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),j=k.vertexLength,q=[],J=[];for(const nt of C){if(nt.length===0)continue;nt!==C[0]&&J.push(q.length/2);const lt=this.segments2.prepareSegment(nt.length,this.layoutVertexArray,this.indexArray2),gt=lt.vertexLength;this.layoutVertexArray.emplaceBack(nt[0].x,nt[0].y),this.indexArray2.emplaceBack(gt+nt.length-1,gt),q.push(nt[0].x),q.push(nt[0].y);for(let St=1;St<nt.length;St++)this.layoutVertexArray.emplaceBack(nt[St].x,nt[St].y),this.indexArray2.emplaceBack(gt+St-1,gt+St),q.push(nt[St].x),q.push(nt[St].y);lt.vertexLength+=nt.length,lt.primitiveLength+=nt.length}const et=Fv(q,J);for(let nt=0;nt<et.length;nt+=3)this.indexArray.emplaceBack(j+et[nt],j+et[nt+1],j+et[nt+2]);k.vertexLength+=L,k.primitiveLength+=et.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,S,v)}}let jv,Uv;We("FillBucket",t0,{omit:["layers","patternFeatures"]});var yC={get paint(){return Uv=Uv||new Cs({"fill-antialias":new ni(Zt.paint_fill["fill-antialias"]),"fill-opacity":new di(Zt.paint_fill["fill-opacity"]),"fill-color":new di(Zt.paint_fill["fill-color"]),"fill-outline-color":new di(Zt.paint_fill["fill-outline-color"]),"fill-translate":new ni(Zt.paint_fill["fill-translate"]),"fill-translate-anchor":new ni(Zt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ah(Zt.paint_fill["fill-pattern"])})},get layout(){return jv=jv||new Cs({"fill-sort-key":new di(Zt.layout_fill["fill-sort-key"])})}};class _C extends uo{constructor(o){super(o,yC)}recalculate(o,u){super.recalculate(o,u);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new t0(o)}queryRadius(){return Hu(this.paint.get("fill-translate"))}queryIntersectsFeature(o,u,p,v,S,C,L){return Ma(dh(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,L),v)}isTileClipped(){return!0}}const vC=os([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bC=os([{name:"a_centroid",components:2,type:"Int16"}],4),{members:wC}=vC;var vh={},xC=y,Gv=$u;function $u(h,o,u,p,v){this.properties={},this.extent=u,this.type=0,this._pbf=h,this._geometry=-1,this._keys=p,this._values=v,h.readFields(AC,this,o)}function AC(h,o,u){h==1?o.id=u.readVarint():h==2?function(p,v){for(var S=p.readVarint()+p.pos;p.pos<S;){var C=v._keys[p.readVarint()],L=v._values[p.readVarint()];v.properties[C]=L}}(u,o):h==3?o.type=u.readVarint():h==4&&(o._geometry=u.pos)}function SC(h){for(var o,u,p=0,v=0,S=h.length,C=S-1;v<S;C=v++)p+=((u=h[C]).x-(o=h[v]).x)*(o.y+u.y);return p}$u.types=["Unknown","Point","LineString","Polygon"],$u.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var o,u=h.readVarint()+h.pos,p=1,v=0,S=0,C=0,L=[];h.pos<u;){if(v<=0){var k=h.readVarint();p=7&k,v=k>>3}if(v--,p===1||p===2)S+=h.readSVarint(),C+=h.readSVarint(),p===1&&(o&&L.push(o),o=[]),o.push(new xC(S,C));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&L.push(o),L},$u.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var o=h.readVarint()+h.pos,u=1,p=0,v=0,S=0,C=1/0,L=-1/0,k=1/0,j=-1/0;h.pos<o;){if(p<=0){var q=h.readVarint();u=7&q,p=q>>3}if(p--,u===1||u===2)(v+=h.readSVarint())<C&&(C=v),v>L&&(L=v),(S+=h.readSVarint())<k&&(k=S),S>j&&(j=S);else if(u!==7)throw new Error("unknown command "+u)}return[C,k,L,j]},$u.prototype.toGeoJSON=function(h,o,u){var p,v,S=this.extent*Math.pow(2,u),C=this.extent*h,L=this.extent*o,k=this.loadGeometry(),j=$u.types[this.type];function q(nt){for(var lt=0;lt<nt.length;lt++){var gt=nt[lt];nt[lt]=[360*(gt.x+C)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(gt.y+L)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var J=[];for(p=0;p<k.length;p++)J[p]=k[p][0];q(k=J);break;case 2:for(p=0;p<k.length;p++)q(k[p]);break;case 3:for(k=function(nt){var lt=nt.length;if(lt<=1)return[nt];for(var gt,St,Bt=[],$t=0;$t<lt;$t++){var Ot=SC(nt[$t]);Ot!==0&&(St===void 0&&(St=Ot<0),St===Ot<0?(gt&&Bt.push(gt),gt=[nt[$t]]):gt.push(nt[$t]))}return gt&&Bt.push(gt),Bt}(k),p=0;p<k.length;p++)for(v=0;v<k[p].length;v++)q(k[p][v])}k.length===1?k=k[0]:j="Multi"+j;var et={type:"Feature",geometry:{type:j,coordinates:k},properties:this.properties};return"id"in this&&(et.id=this.id),et};var EC=Gv,Vv=qv;function qv(h,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(CC,this,o),this.length=this._features.length}function CC(h,o,u){h===15?o.version=u.readVarint():h===1?o.name=u.readString():h===5?o.extent=u.readVarint():h===2?o._features.push(u.pos):h===3?o._keys.push(u.readString()):h===4&&o._values.push(function(p){for(var v=null,S=p.readVarint()+p.pos;p.pos<S;){var C=p.readVarint()>>3;v=C===1?p.readString():C===2?p.readFloat():C===3?p.readDouble():C===4?p.readVarint64():C===5?p.readVarint():C===6?p.readSVarint():C===7?p.readBoolean():null}return v}(u))}qv.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var o=this._pbf.readVarint()+this._pbf.pos;return new EC(this._pbf,o,this.extent,this._keys,this._values)};var TC=Vv;function PC(h,o,u){if(h===3){var p=new TC(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}vh.VectorTile=function(h,o){this.layers=h.readFields(PC,{},o)},vh.VectorTileFeature=Gv,vh.VectorTileLayer=Vv;const IC=vh.VectorTileFeature.types,e0=Math.pow(2,13);function lp(h,o,u,p,v,S,C,L){h.emplaceBack(o,u,2*Math.floor(p*e0)+C,v*e0*2,S*e0*2,Math.round(L))}class i0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new z,this.centroidVertexArray=new I,this.indexArray=new bt,this.programConfigurations=new lr(o.layers,o.zoom),this.segments=new Wt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){this.features=[],this.hasPattern=Ym("fill-extrusion",this.layers,u);for(const{feature:v,id:S,index:C,sourceLayerIndex:L}of o){const k=this.layers[0]._featureFilter.needGeometry,j=Ia(v,k);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),j,p))continue;const q={id:S,sourceLayerIndex:L,index:C,geometry:k?j.geometry:Pa(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Qm("fill-extrusion",this.layers,q,this.zoom,u)):this.addFeature(q,q.geometry,C,p,{}),u.featureIndex.insert(v,q.geometry,C,L,this.index,!0)}}addFeatures(o,u,p){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,u,p)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,wC),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,bC.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,u,p,v,S){const C={x:0,y:0,vertexCount:0};for(const L of Km(u,500)){let k=0;for(const lt of L)k+=lt.length;let j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const lt of L){if(lt.length===0||LC(lt))continue;let gt=0;for(let St=0;St<lt.length;St++){const Bt=lt[St];if(St>=1){const $t=lt[St-1];if(!MC(Bt,$t)){j.vertexLength+4>Wt.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ot=Bt.sub($t)._perp()._unit(),Ht=$t.dist(Bt);gt+Ht>32768&&(gt=0),lp(this.layoutVertexArray,Bt.x,Bt.y,Ot.x,Ot.y,0,0,gt),lp(this.layoutVertexArray,Bt.x,Bt.y,Ot.x,Ot.y,0,1,gt),C.x+=2*Bt.x,C.y+=2*Bt.y,C.vertexCount+=2,gt+=Ht,lp(this.layoutVertexArray,$t.x,$t.y,Ot.x,Ot.y,0,0,gt),lp(this.layoutVertexArray,$t.x,$t.y,Ot.x,Ot.y,0,1,gt),C.x+=2*$t.x,C.y+=2*$t.y,C.vertexCount+=2;const _e=j.vertexLength;this.indexArray.emplaceBack(_e,_e+2,_e+1),this.indexArray.emplaceBack(_e+1,_e+2,_e+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+k>Wt.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),IC[o.type]!=="Polygon")continue;const q=[],J=[],et=j.vertexLength;for(const lt of L)if(lt.length!==0){lt!==L[0]&&J.push(q.length/2);for(let gt=0;gt<lt.length;gt++){const St=lt[gt];lp(this.layoutVertexArray,St.x,St.y,0,0,1,1,0),C.x+=St.x,C.y+=St.y,C.vertexCount+=1,q.push(St.x),q.push(St.y)}}const nt=Fv(q,J);for(let lt=0;lt<nt.length;lt+=3)this.indexArray.emplaceBack(et+nt[lt],et+nt[lt+2],et+nt[lt+1]);j.primitiveLength+=nt.length/3,j.vertexLength+=k}for(let L=0;L<C.vertexCount;L++)this.centroidVertexArray.emplaceBack(Math.floor(C.x/C.vertexCount),Math.floor(C.y/C.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,S,v)}}function MC(h,o){return h.x===o.x&&(h.x<0||h.x>br)||h.y===o.y&&(h.y<0||h.y>br)}function LC(h){return h.every(o=>o.x<0)||h.every(o=>o.x>br)||h.every(o=>o.y<0)||h.every(o=>o.y>br)}let Hv;We("FillExtrusionBucket",i0,{omit:["layers","features"]});var BC={get paint(){return Hv=Hv||new Cs({"fill-extrusion-opacity":new ni(Zt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new di(Zt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ni(Zt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ni(Zt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ah(Zt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new di(Zt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new di(Zt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ni(Zt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class RC extends uo{constructor(o){super(o,BC)}createBucket(o){return new i0(o)}queryRadius(){return Hu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,u,p,v,S,C,L,k){const j=dh(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,L),q=this.paint.get("fill-extrusion-height").evaluate(u,p),J=this.paint.get("fill-extrusion-base").evaluate(u,p),et=function(lt,gt,St,Bt){const $t=[];for(const Ot of lt){const Ht=[Ot.x,Ot.y,0,1];gh(Ht,Ht,gt),$t.push(new T(Ht[0]/Ht[3],Ht[1]/Ht[3]))}return $t}(j,k),nt=function(lt,gt,St,Bt){const $t=[],Ot=[],Ht=Bt[8]*gt,_e=Bt[9]*gt,be=Bt[10]*gt,He=Bt[11]*gt,ri=Bt[8]*St,Ue=Bt[9]*St,ze=Bt[10]*St,Be=Bt[11]*St;for(const Ye of lt){const Oe=[],Ce=[];for(const mi of Ye){const oi=mi.x,Gi=mi.y,Hr=Bt[0]*oi+Bt[4]*Gi+Bt[12],Kr=Bt[1]*oi+Bt[5]*Gi+Bt[13],zs=Bt[2]*oi+Bt[6]*Gi+Bt[14],Oo=Bt[3]*oi+Bt[7]*Gi+Bt[15],Un=zs+be,Ps=Oo+He,tn=Hr+ri,pn=Kr+Ue,Gn=zs+ze,Vn=Oo+Be,js=new T((Hr+Ht)/Ps,(Kr+_e)/Ps);js.z=Un/Ps,Oe.push(js);const Us=new T(tn/Vn,pn/Vn);Us.z=Gn/Vn,Ce.push(Us)}$t.push(Oe),Ot.push(Ce)}return[$t,Ot]}(v,J,q,k);return function(lt,gt,St){let Bt=1/0;Ma(St,gt)&&(Bt=Wv(St,gt[0]));for(let $t=0;$t<gt.length;$t++){const Ot=gt[$t],Ht=lt[$t];for(let _e=0;_e<Ot.length-1;_e++){const be=Ot[_e],He=[be,Ot[_e+1],Ht[_e+1],Ht[_e],be];Zl(St,He)&&(Bt=Math.min(Bt,Wv(St,He)))}}return Bt!==1/0&&Bt}(nt[0],nt[1],et)}}function cp(h,o){return h.x*o.x+h.y*o.y}function Wv(h,o){if(h.length===1){let u=0;const p=o[u++];let v;for(;!v||p.equals(v);)if(v=o[u++],!v)return 1/0;for(;u<o.length;u++){const S=o[u],C=h[0],L=v.sub(p),k=S.sub(p),j=C.sub(p),q=cp(L,L),J=cp(L,k),et=cp(k,k),nt=cp(j,L),lt=cp(j,k),gt=q*et-J*J,St=(et*nt-J*lt)/gt,Bt=(q*lt-J*nt)/gt,$t=p.z*(1-St-Bt)+v.z*St+S.z*Bt;if(isFinite($t))return $t}return 1/0}{let u=1/0;for(const p of o)u=Math.min(u,p.z);return u}}const kC=os([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:OC}=kC,DC=os([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:NC}=DC,FC=vh.VectorTileFeature.types,zC=Math.cos(Math.PI/180*37.5),Jv=Math.pow(2,14)/.5;class r0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new V,this.layoutVertexArray2=new U,this.indexArray=new bt,this.programConfigurations=new lr(o.layers,o.zoom),this.segments=new Wt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,p){this.hasPattern=Ym("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),S=!v.isConstant(),C=[];for(const{feature:L,id:k,index:j,sourceLayerIndex:q}of o){const J=this.layers[0]._featureFilter.needGeometry,et=Ia(L,J);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom),et,p))continue;const nt=S?v.evaluate(et,{},p):void 0,lt={id:k,properties:L.properties,type:L.type,sourceLayerIndex:q,index:j,geometry:J?et.geometry:Pa(L),patterns:{},sortKey:nt};C.push(lt)}S&&C.sort((L,k)=>L.sortKey-k.sortKey);for(const L of C){const{geometry:k,index:j,sourceLayerIndex:q}=L;if(this.hasPattern){const J=Qm("line",this.layers,L,this.zoom,u);this.patternFeatures.push(J)}else this.addFeature(L,k,j,p,{});u.featureIndex.insert(o[j].feature,k,j,q,this.index)}}update(o,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,p)}addFeatures(o,u,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,NC)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,OC),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,p,v,S){const C=this.layers[0].layout,L=C.get("line-join").evaluate(o,{}),k=C.get("line-cap"),j=C.get("line-miter-limit"),q=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const J of u)this.addLine(J,o,L,k,j,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,S,v)}addLine(o,u,p,v,S,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Bt=0;Bt<o.length-1;Bt++)this.totalDistance+=o[Bt].dist(o[Bt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=FC[u.type]==="Polygon";let k=o.length;for(;k>=2&&o[k-1].equals(o[k-2]);)k--;let j=0;for(;j<k-1&&o[j].equals(o[j+1]);)j++;if(k<(L?3:2))return;p==="bevel"&&(S=1.05);const q=this.overscaling<=16?15*br/(512*this.overscaling):0,J=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let et,nt,lt,gt,St;this.e1=this.e2=-1,L&&(et=o[k-2],St=o[j].sub(et)._unit()._perp());for(let Bt=j;Bt<k;Bt++){if(lt=Bt===k-1?L?o[j+1]:void 0:o[Bt+1],lt&&o[Bt].equals(lt))continue;St&&(gt=St),et&&(nt=et),et=o[Bt],St=lt?lt.sub(et)._unit()._perp():gt,gt=gt||St;let $t=gt.add(St);$t.x===0&&$t.y===0||$t._unit();const Ot=gt.x*St.x+gt.y*St.y,Ht=$t.x*St.x+$t.y*St.y,_e=Ht!==0?1/Ht:1/0,be=2*Math.sqrt(2-2*Ht),He=Ht<zC&&nt&&lt,ri=gt.x*St.y-gt.y*St.x>0;if(He&&Bt>j){const Be=et.dist(nt);if(Be>2*q){const Ye=et.sub(et.sub(nt)._mult(q/Be)._round());this.updateDistance(nt,Ye),this.addCurrentVertex(Ye,gt,0,0,J),nt=Ye}}const Ue=nt&&lt;let ze=Ue?p:L?"butt":v;if(Ue&&ze==="round"&&(_e<C?ze="miter":_e<=2&&(ze="fakeround")),ze==="miter"&&_e>S&&(ze="bevel"),ze==="bevel"&&(_e>2&&(ze="flipbevel"),_e<S&&(ze="miter")),nt&&this.updateDistance(nt,et),ze==="miter")$t._mult(_e),this.addCurrentVertex(et,$t,0,0,J);else if(ze==="flipbevel"){if(_e>100)$t=St.mult(-1);else{const Be=_e*gt.add(St).mag()/gt.sub(St).mag();$t._perp()._mult(Be*(ri?-1:1))}this.addCurrentVertex(et,$t,0,0,J),this.addCurrentVertex(et,$t.mult(-1),0,0,J)}else if(ze==="bevel"||ze==="fakeround"){const Be=-Math.sqrt(_e*_e-1),Ye=ri?Be:0,Oe=ri?0:Be;if(nt&&this.addCurrentVertex(et,gt,Ye,Oe,J),ze==="fakeround"){const Ce=Math.round(180*be/Math.PI/20);for(let mi=1;mi<Ce;mi++){let oi=mi/Ce;if(oi!==.5){const Hr=oi-.5;oi+=oi*Hr*(oi-1)*((1.0904+Ot*(Ot*(3.55645-1.43519*Ot)-3.2452))*Hr*Hr+(.848013+Ot*(.215638*Ot-1.06021)))}const Gi=St.sub(gt)._mult(oi)._add(gt)._unit()._mult(ri?-1:1);this.addHalfVertex(et,Gi.x,Gi.y,!1,ri,0,J)}}lt&&this.addCurrentVertex(et,St,-Ye,-Oe,J)}else if(ze==="butt")this.addCurrentVertex(et,$t,0,0,J);else if(ze==="square"){const Be=nt?1:-1;this.addCurrentVertex(et,$t,Be,Be,J)}else ze==="round"&&(nt&&(this.addCurrentVertex(et,gt,0,0,J),this.addCurrentVertex(et,gt,1,1,J,!0)),lt&&(this.addCurrentVertex(et,St,-1,-1,J,!0),this.addCurrentVertex(et,St,0,0,J)));if(He&&Bt<k-1){const Be=et.dist(lt);if(Be>2*q){const Ye=et.add(lt.sub(et)._mult(q/Be)._round());this.updateDistance(et,Ye),this.addCurrentVertex(Ye,St,0,0,J),et=Ye}}}}addCurrentVertex(o,u,p,v,S){let C=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const L=u.y*v-u.x,k=-u.y-u.x*v;this.addHalfVertex(o,u.x+u.y*p,u.y-u.x*p,C,!1,p,S),this.addHalfVertex(o,L,k,C,!0,-v,S),this.distance>Jv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,u,p,v,S,C))}addHalfVertex(o,u,p,v,S,C,L){let{x:k,y:j}=o;const q=.5*(this.lineClips?this.scaledDistance*(Jv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((k<<1)+(v?1:0),(j<<1)+(S?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(C===0?0:C<0?-1:1)|(63&q)<<2,q>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const J=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,J),L.primitiveLength++),S?this.e2=J:this.e1=J}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}}let Zv,Xv;We("LineBucket",r0,{omit:["layers","patternFeatures"]});var $v={get paint(){return Xv=Xv||new Cs({"line-opacity":new di(Zt.paint_line["line-opacity"]),"line-color":new di(Zt.paint_line["line-color"]),"line-translate":new ni(Zt.paint_line["line-translate"]),"line-translate-anchor":new ni(Zt.paint_line["line-translate-anchor"]),"line-width":new di(Zt.paint_line["line-width"]),"line-gap-width":new di(Zt.paint_line["line-gap-width"]),"line-offset":new di(Zt.paint_line["line-offset"]),"line-blur":new di(Zt.paint_line["line-blur"]),"line-dasharray":new ll(Zt.paint_line["line-dasharray"]),"line-pattern":new ah(Zt.paint_line["line-pattern"]),"line-gradient":new Cc(Zt.paint_line["line-gradient"])})},get layout(){return Zv=Zv||new Cs({"line-cap":new ni(Zt.layout_line["line-cap"]),"line-join":new di(Zt.layout_line["line-join"]),"line-miter-limit":new ni(Zt.layout_line["line-miter-limit"]),"line-round-limit":new ni(Zt.layout_line["line-round-limit"]),"line-sort-key":new di(Zt.layout_line["line-sort-key"])})}};class jC extends di{possiblyEvaluate(o,u){return u=new Cr(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(o,u)}evaluate(o,u,p,v){return u=Rt({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(o,u,p,v)}}let Nf;class UC extends uo{constructor(o){super(o,$v),this.gradientVersion=0,Nf||(Nf=new jC($v.paint.properties["line-width"].specification),Nf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,u){super.recalculate(o,u),this.paint._values["line-floorwidth"]=Nf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new r0(o)}queryRadius(o){const u=o,p=Kv(ou("line-width",this,u),ou("line-gap-width",this,u)),v=ou("line-offset",this,u);return p/2+Math.abs(v)+Hu(this.paint.get("line-translate"))}queryIntersectsFeature(o,u,p,v,S,C,L){const k=dh(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,L),j=L/2*Kv(this.paint.get("line-width").evaluate(u,p),this.paint.get("line-gap-width").evaluate(u,p)),q=this.paint.get("line-offset").evaluate(u,p);return q&&(v=function(J,et){const nt=[];for(let lt=0;lt<J.length;lt++){const gt=J[lt],St=[];for(let Bt=0;Bt<gt.length;Bt++){const $t=gt[Bt-1],Ot=gt[Bt],Ht=gt[Bt+1],_e=Bt===0?new T(0,0):Ot.sub($t)._unit()._perp(),be=Bt===gt.length-1?new T(0,0):Ht.sub(Ot)._unit()._perp(),He=_e._add(be)._unit(),ri=He.x*be.x+He.y*be.y;ri!==0&&He._mult(1/ri),St.push(He._mult(et)._add(Ot))}nt.push(St)}return nt}(v,q*L)),function(J,et,nt){for(let lt=0;lt<et.length;lt++){const gt=et[lt];if(J.length>=3){for(let St=0;St<gt.length;St++)if(dl(J,gt[St]))return!0}if(La(J,gt,nt))return!0}return!1}(k,v,j)}isTileClipped(){return!0}}function Kv(h,o){return o>0?o+2*h:h}const GC=os([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),VC=os([{name:"a_projected_pos",components:3,type:"Float32"}],4);os([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qC=os([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);os([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yv=os([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),HC=os([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function WC(h,o,u){return h.sections.forEach(p=>{p.text=function(v,S,C){const L=S.layout.get("text-transform").evaluate(C,{});return L==="uppercase"?v=v.toLocaleUpperCase():L==="lowercase"&&(v=v.toLocaleLowerCase()),Ko.applyArabicShaping&&(v=Ko.applyArabicShaping(v)),v}(p.text,o,u)}),h}os([{name:"triangle",components:3,type:"Uint16"}]),os([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),os([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),os([{type:"Float32",name:"offsetX"}]),os([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),os([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const hp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Fs=24,Qv=Pr,tb=function(h,o,u,p,v){var S,C,L=8*v-p-1,k=(1<<L)-1,j=k>>1,q=-7,J=u?v-1:0,et=u?-1:1,nt=h[o+J];for(J+=et,S=nt&(1<<-q)-1,nt>>=-q,q+=L;q>0;S=256*S+h[o+J],J+=et,q-=8);for(C=S&(1<<-q)-1,S>>=-q,q+=p;q>0;C=256*C+h[o+J],J+=et,q-=8);if(S===0)S=1-j;else{if(S===k)return C?NaN:1/0*(nt?-1:1);C+=Math.pow(2,p),S-=j}return(nt?-1:1)*C*Math.pow(2,S-p)},eb=function(h,o,u,p,v,S){var C,L,k,j=8*S-v-1,q=(1<<j)-1,J=q>>1,et=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,nt=p?0:S-1,lt=p?1:-1,gt=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(L=isNaN(o)?1:0,C=q):(C=Math.floor(Math.log(o)/Math.LN2),o*(k=Math.pow(2,-C))<1&&(C--,k*=2),(o+=C+J>=1?et/k:et*Math.pow(2,1-J))*k>=2&&(C++,k/=2),C+J>=q?(L=0,C=q):C+J>=1?(L=(o*k-1)*Math.pow(2,v),C+=J):(L=o*Math.pow(2,J-1)*Math.pow(2,v),C=0));v>=8;h[u+nt]=255&L,nt+=lt,L/=256,v-=8);for(C=C<<v|L,j+=v;j>0;h[u+nt]=255&C,nt+=lt,C/=256,j-=8);h[u+nt-lt]|=128*gt};function Pr(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Pr.Varint=0,Pr.Fixed64=1,Pr.Bytes=2,Pr.Fixed32=5;var s0=4294967296,ib=1/s0,rb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Oc(h){return h.type===Pr.Bytes?h.readVarint()+h.pos:h.pos+1}function JC(h,o,u){return u?4294967296*o+(h>>>0):4294967296*(o>>>0)+(h>>>0)}function sb(h,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var v=u.pos-1;v>=h;v--)u.buf[v+p]=u.buf[v]}function ZC(h,o){for(var u=0;u<h.length;u++)o.writeVarint(h[u])}function XC(h,o){for(var u=0;u<h.length;u++)o.writeSVarint(h[u])}function $C(h,o){for(var u=0;u<h.length;u++)o.writeFloat(h[u])}function KC(h,o){for(var u=0;u<h.length;u++)o.writeDouble(h[u])}function YC(h,o){for(var u=0;u<h.length;u++)o.writeBoolean(h[u])}function QC(h,o){for(var u=0;u<h.length;u++)o.writeFixed32(h[u])}function tT(h,o){for(var u=0;u<h.length;u++)o.writeSFixed32(h[u])}function eT(h,o){for(var u=0;u<h.length;u++)o.writeFixed64(h[u])}function iT(h,o){for(var u=0;u<h.length;u++)o.writeSFixed64(h[u])}function Ff(h,o){return(h[o]|h[o+1]<<8|h[o+2]<<16)+16777216*h[o+3]}function Ku(h,o,u){h[u]=o,h[u+1]=o>>>8,h[u+2]=o>>>16,h[u+3]=o>>>24}function nb(h,o){return(h[o]|h[o+1]<<8|h[o+2]<<16)+(h[o+3]<<24)}Pr.prototype={destroy:function(){this.buf=null},readFields:function(h,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),v=p>>3,S=this.pos;this.type=7&p,h(v,o,this),this.pos===S&&this.skip(p)}return o},readMessage:function(h,o){return this.readFields(h,o,this.readVarint()+this.pos)},readFixed32:function(){var h=Ff(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=nb(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=Ff(this.buf,this.pos)+Ff(this.buf,this.pos+4)*s0;return this.pos+=8,h},readSFixed64:function(){var h=Ff(this.buf,this.pos)+nb(this.buf,this.pos+4)*s0;return this.pos+=8,h},readFloat:function(){var h=tb(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=tb(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(v,S,C){var L,k,j=C.buf;if(L=(112&(k=j[C.pos++]))>>4,k<128||(L|=(127&(k=j[C.pos++]))<<3,k<128)||(L|=(127&(k=j[C.pos++]))<<10,k<128)||(L|=(127&(k=j[C.pos++]))<<17,k<128)||(L|=(127&(k=j[C.pos++]))<<24,k<128)||(L|=(1&(k=j[C.pos++]))<<31,k<128))return JC(v,L,S);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,o=this.pos;return this.pos=h,h-o>=12&&rb?function(u,p,v){return rb.decode(u.subarray(p,v))}(this.buf,o,h):function(u,p,v){for(var S="",C=p;C<v;){var L,k,j,q=u[C],J=null,et=q>239?4:q>223?3:q>191?2:1;if(C+et>v)break;et===1?q<128&&(J=q):et===2?(192&(L=u[C+1]))==128&&(J=(31&q)<<6|63&L)<=127&&(J=null):et===3?(k=u[C+2],(192&(L=u[C+1]))==128&&(192&k)==128&&((J=(15&q)<<12|(63&L)<<6|63&k)<=2047||J>=55296&&J<=57343)&&(J=null)):et===4&&(k=u[C+2],j=u[C+3],(192&(L=u[C+1]))==128&&(192&k)==128&&(192&j)==128&&((J=(15&q)<<18|(63&L)<<12|(63&k)<<6|63&j)<=65535||J>=1114112)&&(J=null)),J===null?(J=65533,et=1):J>65535&&(J-=65536,S+=String.fromCharCode(J>>>10&1023|55296),J=56320|1023&J),S+=String.fromCharCode(J),C+=et}return S}(this.buf,o,h)},readBytes:function(){var h=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,h);return this.pos=h,o},readPackedVarint:function(h,o){if(this.type!==Pr.Bytes)return h.push(this.readVarint(o));var u=Oc(this);for(h=h||[];this.pos<u;)h.push(this.readVarint(o));return h},readPackedSVarint:function(h){if(this.type!==Pr.Bytes)return h.push(this.readSVarint());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Pr.Bytes)return h.push(this.readBoolean());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Pr.Bytes)return h.push(this.readFloat());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Pr.Bytes)return h.push(this.readDouble());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Pr.Bytes)return h.push(this.readFixed32());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Pr.Bytes)return h.push(this.readSFixed32());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Pr.Bytes)return h.push(this.readFixed64());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Pr.Bytes)return h.push(this.readSFixed64());var o=Oc(this);for(h=h||[];this.pos<o;)h.push(this.readSFixed64());return h},skip:function(h){var o=7&h;if(o===Pr.Varint)for(;this.buf[this.pos++]>127;);else if(o===Pr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Pr.Fixed32)this.pos+=4;else{if(o!==Pr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(h,o){this.writeVarint(h<<3|o)},realloc:function(h){for(var o=this.length||16;o<this.pos+h;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),Ku(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),Ku(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),Ku(this.buf,-1&h,this.pos),Ku(this.buf,Math.floor(h*ib),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),Ku(this.buf,-1&h,this.pos),Ku(this.buf,Math.floor(h*ib),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(o,u){var p,v;if(o>=0?(p=o%4294967296|0,v=o/4294967296|0):(v=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,v=v+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(S,C,L){L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,L.buf[L.pos]=127&(S>>>=7)}(p,0,u),function(S,C){var L=(7&S)<<4;C.buf[C.pos++]|=L|((S>>>=3)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S)))))}(v,u)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var o=this.pos;this.pos=function(p,v,S){for(var C,L,k=0;k<v.length;k++){if((C=v.charCodeAt(k))>55295&&C<57344){if(!L){C>56319||k+1===v.length?(p[S++]=239,p[S++]=191,p[S++]=189):L=C;continue}if(C<56320){p[S++]=239,p[S++]=191,p[S++]=189,L=C;continue}C=L-55296<<10|C-56320|65536,L=null}else L&&(p[S++]=239,p[S++]=191,p[S++]=189,L=null);C<128?p[S++]=C:(C<2048?p[S++]=C>>6|192:(C<65536?p[S++]=C>>12|224:(p[S++]=C>>18|240,p[S++]=C>>12&63|128),p[S++]=C>>6&63|128),p[S++]=63&C|128)}return S}(this.buf,h,this.pos);var u=this.pos-o;u>=128&&sb(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(h){this.realloc(4),eb(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),eb(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var o=h.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=h[u]},writeRawMessage:function(h,o){this.pos++;var u=this.pos;h(o,this);var p=this.pos-u;p>=128&&sb(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(h,o,u){this.writeTag(h,Pr.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(h,o){o.length&&this.writeMessage(h,ZC,o)},writePackedSVarint:function(h,o){o.length&&this.writeMessage(h,XC,o)},writePackedBoolean:function(h,o){o.length&&this.writeMessage(h,YC,o)},writePackedFloat:function(h,o){o.length&&this.writeMessage(h,$C,o)},writePackedDouble:function(h,o){o.length&&this.writeMessage(h,KC,o)},writePackedFixed32:function(h,o){o.length&&this.writeMessage(h,QC,o)},writePackedSFixed32:function(h,o){o.length&&this.writeMessage(h,tT,o)},writePackedFixed64:function(h,o){o.length&&this.writeMessage(h,eT,o)},writePackedSFixed64:function(h,o){o.length&&this.writeMessage(h,iT,o)},writeBytesField:function(h,o){this.writeTag(h,Pr.Bytes),this.writeBytes(o)},writeFixed32Field:function(h,o){this.writeTag(h,Pr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(h,o){this.writeTag(h,Pr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(h,o){this.writeTag(h,Pr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(h,o){this.writeTag(h,Pr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(h,o){this.writeTag(h,Pr.Varint),this.writeVarint(o)},writeSVarintField:function(h,o){this.writeTag(h,Pr.Varint),this.writeSVarint(o)},writeStringField:function(h,o){this.writeTag(h,Pr.Bytes),this.writeString(o)},writeFloatField:function(h,o){this.writeTag(h,Pr.Fixed32),this.writeFloat(o)},writeDoubleField:function(h,o){this.writeTag(h,Pr.Fixed64),this.writeDouble(o)},writeBooleanField:function(h,o){this.writeVarintField(h,!!o)}};var n0=f(Qv);const o0=3;function rT(h,o,u){h===1&&u.readMessage(sT,o)}function sT(h,o,u){if(h===3){const{id:p,bitmap:v,width:S,height:C,left:L,top:k,advance:j}=u.readMessage(nT,{});o.push({id:p,bitmap:new mh({width:S+2*o0,height:C+2*o0},v),metrics:{width:S,height:C,left:L,top:k,advance:j}})}}function nT(h,o,u){h===1?o.id=u.readVarint():h===2?o.bitmap=u.readBytes():h===3?o.width=u.readVarint():h===4?o.height=u.readVarint():h===5?o.left=u.readSVarint():h===6?o.top=u.readSVarint():h===7&&(o.advance=u.readVarint())}const ob=o0;function ab(h){let o=0,u=0;for(const C of h)o+=C.w*C.h,u=Math.max(u,C.w);h.sort((C,L)=>L.h-C.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let v=0,S=0;for(const C of h)for(let L=p.length-1;L>=0;L--){const k=p[L];if(!(C.w>k.w||C.h>k.h)){if(C.x=k.x,C.y=k.y,S=Math.max(S,C.y+C.h),v=Math.max(v,C.x+C.w),C.w===k.w&&C.h===k.h){const j=p.pop();L<p.length&&(p[L]=j)}else C.h===k.h?(k.x+=C.w,k.w-=C.w):C.w===k.w?(k.y+=C.h,k.h-=C.h):(p.push({x:k.x+C.w,y:k.y,w:k.w-C.w,h:C.h}),k.y+=C.h,k.h-=C.h);break}}return{w:v,h:S,fill:o/(v*S)||0}}const mo=1;class a0{constructor(o,u){let{pixelRatio:p,version:v,stretchX:S,stretchY:C,content:L}=u;this.paddedRect=o,this.pixelRatio=p,this.stretchX=S,this.stretchY=C,this.content=L,this.version=v}get tl(){return[this.paddedRect.x+mo,this.paddedRect.y+mo]}get br(){return[this.paddedRect.x+this.paddedRect.w-mo,this.paddedRect.y+this.paddedRect.h-mo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*mo)/this.pixelRatio,(this.paddedRect.h-2*mo)/this.pixelRatio]}}class lb{constructor(o,u){const p={},v={};this.haveRenderCallbacks=[];const S=[];this.addImages(o,p,S),this.addImages(u,v,S);const{w:C,h:L}=ab(S),k=new go({width:C||1,height:L||1});for(const j in o){const q=o[j],J=p[j].paddedRect;go.copy(q.data,k,{x:0,y:0},{x:J.x+mo,y:J.y+mo},q.data)}for(const j in u){const q=u[j],J=v[j].paddedRect,et=J.x+mo,nt=J.y+mo,lt=q.data.width,gt=q.data.height;go.copy(q.data,k,{x:0,y:0},{x:et,y:nt},q.data),go.copy(q.data,k,{x:0,y:gt-1},{x:et,y:nt-1},{width:lt,height:1}),go.copy(q.data,k,{x:0,y:0},{x:et,y:nt+gt},{width:lt,height:1}),go.copy(q.data,k,{x:lt-1,y:0},{x:et-1,y:nt},{width:1,height:gt}),go.copy(q.data,k,{x:0,y:0},{x:et+lt,y:nt},{width:1,height:gt})}this.image=k,this.iconPositions=p,this.patternPositions=v}addImages(o,u,p){for(const v in o){const S=o[v],C={x:0,y:0,w:S.data.width+2*mo,h:S.data.height+2*mo};p.push(C),u[v]=new a0(C,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(o,u){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in o.updatedImages)this.patchUpdatedImage(this.iconPositions[p],o.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],o.getImage(p),u)}patchUpdatedImage(o,u,p){if(!o||!u||o.version===u.version)return;o.version=u.version;const[v,S]=o.tl;p.update(u.data,void 0,{x:v,y:S})}}var bh;We("ImagePosition",a0),We("ImageAtlas",lb),c.ah=void 0,(bh=c.ah||(c.ah={}))[bh.none=0]="none",bh[bh.horizontal=1]="horizontal",bh[bh.vertical=2]="vertical",bh[bh.horizontalOnly=3]="horizontalOnly";const up=-17;class dp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,u){const p=new dp;return p.scale=o||1,p.fontStack=u,p}static forImage(o){const u=new dp;return u.imageName=o,u}}class Yu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const p=new Yu;for(let v=0;v<o.sections.length;v++){const S=o.sections[v];S.image?p.addImageSection(S):p.addTextSection(S,u)}return p}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let u="";for(let p=0;p<o.length;p++){const v=o.charCodeAt(p+1)||null,S=o.charCodeAt(p-1)||null;u+=v&&oh(v)&&!hp[o[p+1]]||S&&oh(S)&&!hp[o[p-1]]||!hp[o[p]]?o[p]:hp[o[p]]}return u}(this.text)}trim(){let o=0;for(let p=0;p<this.text.length&&jf[this.text.charCodeAt(p)];p++)o++;let u=this.text.length;for(let p=this.text.length-1;p>=0&&p>=o&&jf[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const p=new Yu;return p.text=this.text.substring(o,u),p.sectionIndex=this.sectionIndex.slice(o,u),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,u)=>Math.max(o,this.sections[u].scale),0)}addTextSection(o,u){this.text+=o.text,this.sections.push(dp.forText(o.scale,o.fontStack||u));const p=this.sections.length-1;for(let v=0;v<o.text.length;++v)this.sectionIndex.push(p)}addImageSection(o){const u=o.image?o.image.name:"";if(u.length===0)return void Lt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(dp.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Lt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zf(h,o,u,p,v,S,C,L,k,j,q,J,et,nt,lt,gt){const St=Yu.fromFeature(h,v);let Bt;J===c.ah.vertical&&St.verticalizePunctuation();const{processBidirectionalText:$t,processStyledBidirectionalText:Ot}=Ko;if($t&&St.sections.length===1){Bt=[];const be=$t(St.toString(),l0(St,j,S,o,p,nt,lt));for(const He of be){const ri=new Yu;ri.text=He,ri.sections=St.sections;for(let Ue=0;Ue<He.length;Ue++)ri.sectionIndex.push(0);Bt.push(ri)}}else if(Ot){Bt=[];const be=Ot(St.text,St.sectionIndex,l0(St,j,S,o,p,nt,lt));for(const He of be){const ri=new Yu;ri.text=He[0],ri.sectionIndex=He[1],ri.sections=St.sections,Bt.push(ri)}}else Bt=function(be,He){const ri=[],Ue=be.text;let ze=0;for(const Be of He)ri.push(be.substring(ze,Be)),ze=Be;return ze<Ue.length&&ri.push(be.substring(ze,Ue.length)),ri}(St,l0(St,j,S,o,p,nt,lt));const Ht=[],_e={positionedLines:Ht,text:St.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:J,iconsInText:!1,verticalizable:!1};return function(be,He,ri,Ue,ze,Be,Ye,Oe,Ce,mi,oi,Gi){let Hr=0,Kr=up,zs=0,Oo=0;const Un=Oe==="right"?1:Oe==="left"?0:.5;let Ps=0;for(const js of ze){js.trim();const Us=js.getMaxScale(),Tn=(Us-1)*Fs,qn={positionedGlyphs:[],lineOffset:0};be.positionedLines[Ps]=qn;const Pn=qn.positionedGlyphs;let yo=0;if(!js.length()){Kr+=Be,++Ps;continue}for(let Gs=0;Gs<js.length();Gs++){const Ki=js.getSection(Gs),In=js.getSectionIndex(Gs),fn=js.getCharCode(Gs);let Vs=0,Ba=null,gl=null,ml=null,Dc=Fs;const Ra=!(Ce===c.ah.horizontal||!oi&&!sl(fn)||oi&&(jf[fn]||(tn=fn,Ne.Arabic(tn)||Ne["Arabic Supplement"](tn)||Ne["Arabic Extended-A"](tn)||Ne["Arabic Presentation Forms-A"](tn)||Ne["Arabic Presentation Forms-B"](tn))));if(Ki.imageName){const ta=Ue[Ki.imageName];if(!ta)continue;ml=Ki.imageName,be.iconsInText=be.iconsInText||!0,gl=ta.paddedRect;const vo=ta.displaySize;Ki.scale=Ki.scale*Fs/Gi,Ba={width:vo[0],height:vo[1],left:mo,top:-ob,advance:Ra?vo[1]:vo[0]},Vs=Tn+(Fs-vo[1]*Ki.scale),Dc=Ba.advance;const Nc=Ra?vo[0]*Ki.scale-Fs*Us:vo[1]*Ki.scale-Fs*Us;Nc>0&&Nc>yo&&(yo=Nc)}else{const ta=ri[Ki.fontStack],vo=ta&&ta[fn];if(vo&&vo.rect)gl=vo.rect,Ba=vo.metrics;else{const Nc=He[Ki.fontStack],yp=Nc&&Nc[fn];if(!yp)continue;Ba=yp.metrics}Vs=(Us-Ki.scale)*Fs}Ra?(be.verticalizable=!0,Pn.push({glyph:fn,imageName:ml,x:Hr,y:Kr+Vs,vertical:Ra,scale:Ki.scale,fontStack:Ki.fontStack,sectionIndex:In,metrics:Ba,rect:gl}),Hr+=Dc*Ki.scale+mi):(Pn.push({glyph:fn,imageName:ml,x:Hr,y:Kr+Vs,vertical:Ra,scale:Ki.scale,fontStack:Ki.fontStack,sectionIndex:In,metrics:Ba,rect:gl}),Hr+=Ba.advance*Ki.scale+mi)}Pn.length!==0&&(zs=Math.max(Hr-mi,zs),lT(Pn,0,Pn.length-1,Un,yo)),Hr=0;const _o=Be*Us+yo;qn.lineOffset=Math.max(yo,Tn),Kr+=_o,Oo=Math.max(_o,Oo),++Ps}var tn;const pn=Kr-up,{horizontalAlign:Gn,verticalAlign:Vn}=c0(Ye);(function(js,Us,Tn,qn,Pn,yo,_o,Gs,Ki){const In=(Us-Tn)*Pn;let fn=0;fn=yo!==_o?-Gs*qn-up:(-qn*Ki+.5)*_o;for(const Vs of js)for(const Ba of Vs.positionedGlyphs)Ba.x+=In,Ba.y+=fn})(be.positionedLines,Un,Gn,Vn,zs,Oo,Be,pn,ze.length),be.top+=-Vn*pn,be.bottom=be.top+pn,be.left+=-Gn*zs,be.right=be.left+zs}(_e,o,u,p,Bt,C,L,k,J,j,et,gt),!function(be){for(const He of be)if(He.positionedGlyphs.length!==0)return!1;return!0}(Ht)&&_e}const jf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},oT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cb(h,o,u,p,v,S){if(o.imageName){const C=p[o.imageName];return C?C.displaySize[0]*o.scale*Fs/S+v:0}{const C=u[o.fontStack],L=C&&C[h];return L?L.metrics.advance*o.scale+v:0}}function hb(h,o,u,p){const v=Math.pow(h-o,2);return p?h<o?v/2:2*v:v+Math.abs(u)*u}function aT(h,o,u){let p=0;return h===10&&(p-=1e4),u&&(p+=150),h!==40&&h!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function ub(h,o,u,p,v,S){let C=null,L=hb(o,u,v,S);for(const k of p){const j=hb(o-k.x,u,v,S)+k.badness;j<=L&&(C=k,L=j)}return{index:h,x:o,priorBreak:C,badness:L}}function db(h){return h?db(h.priorBreak).concat(h.index):[]}function l0(h,o,u,p,v,S,C){if(S!=="point")return[];if(!h)return[];const L=[],k=function(et,nt,lt,gt,St,Bt){let $t=0;for(let Ot=0;Ot<et.length();Ot++){const Ht=et.getSection(Ot);$t+=cb(et.getCharCode(Ot),Ht,gt,St,nt,Bt)}return $t/Math.max(1,Math.ceil($t/lt))}(h,o,u,p,v,C),j=h.text.indexOf("​")>=0;let q=0;for(let et=0;et<h.length();et++){const nt=h.getSection(et),lt=h.getCharCode(et);if(jf[lt]||(q+=cb(lt,nt,p,v,o,C)),et<h.length()-1){const gt=!((J=lt)<11904||!(Ne["Bopomofo Extended"](J)||Ne.Bopomofo(J)||Ne["CJK Compatibility Forms"](J)||Ne["CJK Compatibility Ideographs"](J)||Ne["CJK Compatibility"](J)||Ne["CJK Radicals Supplement"](J)||Ne["CJK Strokes"](J)||Ne["CJK Symbols and Punctuation"](J)||Ne["CJK Unified Ideographs Extension A"](J)||Ne["CJK Unified Ideographs"](J)||Ne["Enclosed CJK Letters and Months"](J)||Ne["Halfwidth and Fullwidth Forms"](J)||Ne.Hiragana(J)||Ne["Ideographic Description Characters"](J)||Ne["Kangxi Radicals"](J)||Ne["Katakana Phonetic Extensions"](J)||Ne.Katakana(J)||Ne["Vertical Forms"](J)||Ne["Yi Radicals"](J)||Ne["Yi Syllables"](J)));(oT[lt]||gt||nt.imageName)&&L.push(ub(et+1,q,k,L,aT(lt,h.getCharCode(et+1),gt&&j),!1))}}var J;return db(ub(h.length(),q,k,L,0,!0))}function c0(h){let o=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function lT(h,o,u,p,v){if(!p&&!v)return;const S=h[u],C=(h[u].x+S.metrics.advance*S.scale)*p;for(let L=o;L<=u;L++)h[L].x-=C,h[L].y+=v}function cT(h,o,u){const{horizontalAlign:p,verticalAlign:v}=c0(u),S=o[0]-h.displaySize[0]*p,C=o[1]-h.displaySize[1]*v;return{image:h,top:C,bottom:C+h.displaySize[1],left:S,right:S+h.displaySize[0]}}function pb(h,o,u,p,v,S){const C=h.image;let L;if(C.content){const St=C.content,Bt=C.pixelRatio||1;L=[St[0]/Bt,St[1]/Bt,C.displaySize[0]-St[2]/Bt,C.displaySize[1]-St[3]/Bt]}const k=o.left*S,j=o.right*S;let q,J,et,nt;u==="width"||u==="both"?(nt=v[0]+k-p[3],J=v[0]+j+p[1]):(nt=v[0]+(k+j-C.displaySize[0])/2,J=nt+C.displaySize[0]);const lt=o.top*S,gt=o.bottom*S;return u==="height"||u==="both"?(q=v[1]+lt-p[0],et=v[1]+gt+p[2]):(q=v[1]+(lt+gt-C.displaySize[1])/2,et=q+C.displaySize[1]),{image:C,top:q,right:J,bottom:et,left:nt,collisionPadding:L}}const pp=255,Kl=128,wh=pp*Kl;function fb(h,o){const{expression:u}=o;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Cr(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:v}=u;let S=0;for(;S<p.length&&p[S]<=h;)S++;S=Math.max(0,S-1);let C=S;for(;C<p.length&&p[C]<h+1;)C++;C=Math.min(p.length-1,C);const L=p[S],k=p[C];return u.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:k,interpolationType:v}:{kind:"camera",minZoom:L,maxZoom:k,minSize:u.evaluate(new Cr(L)),maxSize:u.evaluate(new Cr(k)),interpolationType:v}}}function h0(h,o,u){let p="never";const v=h.get(o);return v?p=v:h.get(u)&&(p="always"),p}const hT=vh.VectorTileFeature.types,uT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uf(h,o,u,p,v,S,C,L,k,j,q,J,et){const nt=L?Math.min(wh,Math.round(L[0])):0,lt=L?Math.min(wh,Math.round(L[1])):0;h.emplaceBack(o,u,Math.round(32*p),Math.round(32*v),S,C,(nt<<1)+(k?1:0),lt,16*j,16*q,256*J,256*et)}function u0(h,o,u){h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u),h.emplaceBack(o.x,o.y,u)}function dT(h){for(const o of h.sections)if($h(o.text))return!0;return!1}class d0{constructor(o){this.layoutVertexArray=new at,this.indexArray=new bt,this.programConfigurations=o,this.segments=new Wt,this.dynamicLayoutVertexArray=new tt,this.opacityVertexArray=new ht,this.hasVisibleVertices=!1,this.placedSymbolArray=new d}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,u,p,v){this.isEmpty()||(p&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,GC.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,VC.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,uT,!0),this.opacityVertexBuffer.itemSize=1),(p||v)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}We("SymbolBuffers",d0);class p0{constructor(o,u,p){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new p,this.segments=new Wt,this.collisionVertexArray=new Tt}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,qC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}We("CollisionBuffers",p0);class Qu{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(C=>C.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ph([]),this.placementViewportMatrix=ph([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fb(this.zoom,u["text-size"]),this.iconSizeData=fb(this.zoom,u["icon-size"]);const p=this.layers[0].layout,v=p.get("symbol-sort-key"),S=p.get("symbol-z-order");this.canOverlap=h0(p,"text-overlap","text-allow-overlap")!=="never"||h0(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(C=>c.ah[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=o.sourceID}createArrays(){this.text=new d0(new lr(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new d0(new lr(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new A,this.lineVertexArray=new B,this.symbolInstances=new _,this.textAnchorOffsets=new g}calculateGlyphDependencies(o,u,p,v,S){for(let C=0;C<o.length;C++)if(u[o.charCodeAt(C)]=!0,(p||v)&&S){const L=hp[o.charAt(C)];L&&(u[L.charCodeAt(0)]=!0)}}populate(o,u,p){const v=this.layers[0],S=v.layout,C=S.get("text-font"),L=S.get("text-field"),k=S.get("icon-image"),j=(L.value.kind!=="constant"||L.value.value instanceof Rr&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),q=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,J=S.get("symbol-sort-key");if(this.features=[],!j&&!q)return;const et=u.iconDependencies,nt=u.glyphDependencies,lt=u.availableImages,gt=new Cr(this.zoom);for(const{feature:St,id:Bt,index:$t,sourceLayerIndex:Ot}of o){const Ht=v._featureFilter.needGeometry,_e=Ia(St,Ht);if(!v._featureFilter.filter(gt,_e,p))continue;let be,He;if(Ht||(_e.geometry=Pa(St)),j){const Ue=v.getValueAndResolveTokens("text-field",_e,p,lt),ze=Rr.factory(Ue),Be=this.hasRTLText=this.hasRTLText||dT(ze);(!Be||Ko.getRTLTextPluginStatus()==="unavailable"||Be&&Ko.isParsed())&&(be=WC(ze,v,_e))}if(q){const Ue=v.getValueAndResolveTokens("icon-image",_e,p,lt);He=Ue instanceof Os?Ue:Os.fromString(Ue)}if(!be&&!He)continue;const ri=this.sortFeaturesByKey?J.evaluate(_e,{},p):void 0;if(this.features.push({id:Bt,text:be,icon:He,index:$t,sourceLayerIndex:Ot,geometry:_e.geometry,properties:St.properties,type:hT[St.type],sortKey:ri}),He&&(et[He.name]=!0),be){const Ue=C.evaluate(_e,{},p).join(","),ze=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const Be of be.sections)if(Be.image)et[Be.image.name]=!0;else{const Ye=Es(be.toString()),Oe=Be.fontStack||Ue,Ce=nt[Oe]=nt[Oe]||{};this.calculateGlyphDependencies(Be.text,Ce,ze,this.allowVerticalPlacement,Ye)}}}S.get("symbol-placement")==="line"&&(this.features=function(St){const Bt={},$t={},Ot=[];let Ht=0;function _e(Ue){Ot.push(St[Ue]),Ht++}function be(Ue,ze,Be){const Ye=$t[Ue];return delete $t[Ue],$t[ze]=Ye,Ot[Ye].geometry[0].pop(),Ot[Ye].geometry[0]=Ot[Ye].geometry[0].concat(Be[0]),Ye}function He(Ue,ze,Be){const Ye=Bt[ze];return delete Bt[ze],Bt[Ue]=Ye,Ot[Ye].geometry[0].shift(),Ot[Ye].geometry[0]=Be[0].concat(Ot[Ye].geometry[0]),Ye}function ri(Ue,ze,Be){const Ye=Be?ze[0][ze[0].length-1]:ze[0][0];return`${Ue}:${Ye.x}:${Ye.y}`}for(let Ue=0;Ue<St.length;Ue++){const ze=St[Ue],Be=ze.geometry,Ye=ze.text?ze.text.toString():null;if(!Ye){_e(Ue);continue}const Oe=ri(Ye,Be),Ce=ri(Ye,Be,!0);if(Oe in $t&&Ce in Bt&&$t[Oe]!==Bt[Ce]){const mi=He(Oe,Ce,Be),oi=be(Oe,Ce,Ot[mi].geometry);delete Bt[Oe],delete $t[Ce],$t[ri(Ye,Ot[oi].geometry,!0)]=oi,Ot[mi].geometry=null}else Oe in $t?be(Oe,Ce,Be):Ce in Bt?He(Oe,Ce,Be):(_e(Ue),Bt[Oe]=Ht-1,$t[Ce]=Ht-1)}return Ot.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((St,Bt)=>St.sortKey-Bt.sortKey)}update(o,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const p=this.lineVertexArray.length;if(o.segment!==void 0){let v=o.dist(u[o.segment+1]),S=o.dist(u[o.segment]);const C={};for(let L=o.segment+1;L<u.length;L++)C[L]={x:u[L].x,y:u[L].y,tileUnitDistanceFromAnchor:v},L<u.length-1&&(v+=u[L+1].dist(u[L]));for(let L=o.segment||0;L>=0;L--)C[L]={x:u[L].x,y:u[L].y,tileUnitDistanceFromAnchor:S},L>0&&(S+=u[L-1].dist(u[L]));for(let L=0;L<u.length;L++){const k=C[L];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(o,u,p,v,S,C,L,k,j,q,J,et){const nt=o.indexArray,lt=o.layoutVertexArray,gt=o.segments.prepareSegment(4*u.length,lt,nt,this.canOverlap?C.sortKey:void 0),St=this.glyphOffsetArray.length,Bt=gt.vertexLength,$t=this.allowVerticalPlacement&&L===c.ah.vertical?Math.PI/2:0,Ot=C.text&&C.text.sections;for(let Ht=0;Ht<u.length;Ht++){const{tl:_e,tr:be,bl:He,br:ri,tex:Ue,pixelOffsetTL:ze,pixelOffsetBR:Be,minFontScaleX:Ye,minFontScaleY:Oe,glyphOffset:Ce,isSDF:mi,sectionIndex:oi}=u[Ht],Gi=gt.vertexLength,Hr=Ce[1];Uf(lt,k.x,k.y,_e.x,Hr+_e.y,Ue.x,Ue.y,p,mi,ze.x,ze.y,Ye,Oe),Uf(lt,k.x,k.y,be.x,Hr+be.y,Ue.x+Ue.w,Ue.y,p,mi,Be.x,ze.y,Ye,Oe),Uf(lt,k.x,k.y,He.x,Hr+He.y,Ue.x,Ue.y+Ue.h,p,mi,ze.x,Be.y,Ye,Oe),Uf(lt,k.x,k.y,ri.x,Hr+ri.y,Ue.x+Ue.w,Ue.y+Ue.h,p,mi,Be.x,Be.y,Ye,Oe),u0(o.dynamicLayoutVertexArray,k,$t),nt.emplaceBack(Gi,Gi+1,Gi+2),nt.emplaceBack(Gi+1,Gi+2,Gi+3),gt.vertexLength+=4,gt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ce[0]),Ht!==u.length-1&&oi===u[Ht+1].sectionIndex||o.programConfigurations.populatePaintArrays(lt.length,C,C.index,{},et,Ot&&Ot[oi])}o.placedSymbolArray.emplaceBack(k.x,k.y,St,this.glyphOffsetArray.length-St,Bt,j,q,k.segment,p?p[0]:0,p?p[1]:0,v[0],v[1],L,0,!1,0,J)}_addCollisionDebugVertex(o,u,p,v,S,C){return u.emplaceBack(0,0),o.emplaceBack(p.x,p.y,v,S,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(o,u,p,v,S,C,L){const k=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),j=k.vertexLength,q=S.layoutVertexArray,J=S.collisionVertexArray,et=L.anchorX,nt=L.anchorY;this._addCollisionDebugVertex(q,J,C,et,nt,new T(o,u)),this._addCollisionDebugVertex(q,J,C,et,nt,new T(p,u)),this._addCollisionDebugVertex(q,J,C,et,nt,new T(p,v)),this._addCollisionDebugVertex(q,J,C,et,nt,new T(o,v)),k.vertexLength+=4;const lt=S.indexArray;lt.emplaceBack(j,j+1),lt.emplaceBack(j+1,j+2),lt.emplaceBack(j+2,j+3),lt.emplaceBack(j+3,j),k.primitiveLength+=4}addDebugCollisionBoxes(o,u,p,v){for(let S=o;S<u;S++){const C=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,v?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new p0(ut,Yv.members,pt),this.iconCollisionBox=new p0(ut,Yv.members,pt);for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(o,u,p,v,S,C,L,k,j){const q={};for(let J=u;J<p;J++){const et=o.get(J);q.textBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},q.textFeatureIndex=et.featureIndex;break}for(let J=v;J<S;J++){const et=o.get(J);q.verticalTextBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},q.verticalTextFeatureIndex=et.featureIndex;break}for(let J=C;J<L;J++){const et=o.get(J);q.iconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},q.iconFeatureIndex=et.featureIndex;break}for(let J=k;J<j;J++){const et=o.get(J);q.verticalIconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},q.verticalIconFeatureIndex=et.featureIndex;break}return q}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const p=o.placedSymbolArray.get(u),v=p.vertexStartIndex+4*p.numGlyphs;for(let S=p.vertexStartIndex;S<v;S+=4)o.indexArray.emplaceBack(S,S+1,S+2),o.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(o),p=Math.cos(o),v=[],S=[],C=[];for(let L=0;L<this.symbolInstances.length;++L){C.push(L);const k=this.symbolInstances.get(L);v.push(0|Math.round(u*k.anchorX+p*k.anchorY)),S.push(k.featureIndex)}return C.sort((L,k)=>v[L]-v[k]||S[k]-S[L]),C}addToSortKeyRanges(o,u){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const p=this.symbolInstances.get(u);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((v,S,C)=>{v>=0&&C.indexOf(v)===S&&this.addIndicesForPlacedSymbol(this.text,v)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gb,mb;We("SymbolBucket",Qu,{omit:["layers","collisionBoxArray","features","compareText"]}),Qu.MAX_GLYPHS=65535,Qu.addDynamicAttributes=u0;var f0={get paint(){return mb=mb||new Cs({"icon-opacity":new di(Zt.paint_symbol["icon-opacity"]),"icon-color":new di(Zt.paint_symbol["icon-color"]),"icon-halo-color":new di(Zt.paint_symbol["icon-halo-color"]),"icon-halo-width":new di(Zt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new di(Zt.paint_symbol["icon-halo-blur"]),"icon-translate":new ni(Zt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ni(Zt.paint_symbol["icon-translate-anchor"]),"text-opacity":new di(Zt.paint_symbol["text-opacity"]),"text-color":new di(Zt.paint_symbol["text-color"],{runtimeType:hr,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new di(Zt.paint_symbol["text-halo-color"]),"text-halo-width":new di(Zt.paint_symbol["text-halo-width"]),"text-halo-blur":new di(Zt.paint_symbol["text-halo-blur"]),"text-translate":new ni(Zt.paint_symbol["text-translate"]),"text-translate-anchor":new ni(Zt.paint_symbol["text-translate-anchor"])})},get layout(){return gb=gb||new Cs({"symbol-placement":new ni(Zt.layout_symbol["symbol-placement"]),"symbol-spacing":new ni(Zt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ni(Zt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new di(Zt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ni(Zt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ni(Zt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ni(Zt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ni(Zt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ni(Zt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ni(Zt.layout_symbol["icon-rotation-alignment"]),"icon-size":new di(Zt.layout_symbol["icon-size"]),"icon-text-fit":new ni(Zt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ni(Zt.layout_symbol["icon-text-fit-padding"]),"icon-image":new di(Zt.layout_symbol["icon-image"]),"icon-rotate":new di(Zt.layout_symbol["icon-rotate"]),"icon-padding":new di(Zt.layout_symbol["icon-padding"]),"icon-keep-upright":new ni(Zt.layout_symbol["icon-keep-upright"]),"icon-offset":new di(Zt.layout_symbol["icon-offset"]),"icon-anchor":new di(Zt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ni(Zt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ni(Zt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ni(Zt.layout_symbol["text-rotation-alignment"]),"text-field":new di(Zt.layout_symbol["text-field"]),"text-font":new di(Zt.layout_symbol["text-font"]),"text-size":new di(Zt.layout_symbol["text-size"]),"text-max-width":new di(Zt.layout_symbol["text-max-width"]),"text-line-height":new ni(Zt.layout_symbol["text-line-height"]),"text-letter-spacing":new di(Zt.layout_symbol["text-letter-spacing"]),"text-justify":new di(Zt.layout_symbol["text-justify"]),"text-radial-offset":new di(Zt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ni(Zt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new di(Zt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new di(Zt.layout_symbol["text-anchor"]),"text-max-angle":new ni(Zt.layout_symbol["text-max-angle"]),"text-writing-mode":new ni(Zt.layout_symbol["text-writing-mode"]),"text-rotate":new di(Zt.layout_symbol["text-rotate"]),"text-padding":new ni(Zt.layout_symbol["text-padding"]),"text-keep-upright":new ni(Zt.layout_symbol["text-keep-upright"]),"text-transform":new di(Zt.layout_symbol["text-transform"]),"text-offset":new di(Zt.layout_symbol["text-offset"]),"text-allow-overlap":new ni(Zt.layout_symbol["text-allow-overlap"]),"text-overlap":new ni(Zt.layout_symbol["text-overlap"]),"text-ignore-placement":new ni(Zt.layout_symbol["text-ignore-placement"]),"text-optional":new ni(Zt.layout_symbol["text-optional"])})}};class yb{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Ci,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}We("FormatSectionOverride",yb,{omit:["defaultValue"]});class Gf extends uo{constructor(o){super(o,f0)}recalculate(o,u){if(super.recalculate(o,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const v=[];for(const S of p)v.indexOf(S)<0&&v.push(S);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,u,p,v){const S=this.layout.get(o).evaluate(u,{},p,v),C=this._unevaluatedLayout._values[o];return C.isDataDriven()||Fi(C.value)||!S?S:function(L,k){return k.replace(/{([^{}]+)}/g,(j,q)=>L&&q in L?String(L[q]):"")}(u.properties,S)}createBucket(o){return new Qu(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of f0.paint.overridableProperties){if(!Gf.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),p=new yb(u),v=new Ri(p,u.property.specification);let S=null;S=u.value.kind==="constant"||u.value.kind==="source"?new an("source",v):new ln("composite",v,u.value.zoomStops),this.paint._values[o]=new ho(u.property,S,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,p){return!(!this.layout||u.isDataDriven()||p.isDataDriven())&&Gf.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const p=o.get("text-field"),v=f0.paint.properties[u];let S=!1;const C=L=>{for(const k of L)if(v.overrides&&v.overrides.hasOverride(k))return void(S=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Rr)C(p.value.value.sections);else if(p.value.kind==="source"){const L=j=>{S||(j instanceof Ys&&xi(j.value)===sr?C(j.value.sections):j instanceof va?C(j.sections):j.eachChild(L))},k=p.value;k._styleExpression&&L(k._styleExpression.expression)}return S}}let _b;var pT={get paint(){return _b=_b||new Cs({"background-color":new ni(Zt.paint_background["background-color"]),"background-pattern":new ll(Zt.paint_background["background-pattern"]),"background-opacity":new ni(Zt.paint_background["background-opacity"])})}};class fT extends uo{constructor(o){super(o,pT)}}let vb;var gT={get paint(){return vb=vb||new Cs({"raster-opacity":new ni(Zt.paint_raster["raster-opacity"]),"raster-hue-rotate":new ni(Zt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ni(Zt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ni(Zt.paint_raster["raster-brightness-max"]),"raster-saturation":new ni(Zt.paint_raster["raster-saturation"]),"raster-contrast":new ni(Zt.paint_raster["raster-contrast"]),"raster-resampling":new ni(Zt.paint_raster["raster-resampling"]),"raster-fade-duration":new ni(Zt.paint_raster["raster-fade-duration"])})}};class mT extends uo{constructor(o){super(o,gT)}}class yT extends uo{constructor(o){super(o,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _T{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const g0=63710088e-1;class xh{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xh(Nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,p=this.lat*u,v=o.lat*u,S=Math.sin(p)*Math.sin(v)+Math.cos(p)*Math.cos(v)*Math.cos((o.lng-this.lng)*u);return g0*Math.acos(Math.min(S,1))}static convert(o){if(o instanceof xh)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new xh(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new xh(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const bb=2*Math.PI*g0;function wb(h){return bb*Math.cos(h*Math.PI/180)}function xb(h){return(180+h)/360}function Ab(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function Sb(h,o){return h/wb(o)}function m0(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class Vf{constructor(o,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+o,this.y=+u,this.z=+p}static fromLngLat(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=xh.convert(o);return new Vf(xb(p.lng),Ab(p.lat),Sb(u,p.lat))}toLngLat(){return new xh(360*this.x-180,m0(this.y))}toAltitude(){return this.z*wb(m0(this.y))}meterInMercatorCoordinateUnits(){return 1/bb*(o=m0(this.y),1/Math.cos(o*Math.PI/180));var o}}function Eb(h,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[h*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}class y0{constructor(o,u,p){if(o<0||o>25||p<0||p>=Math.pow(2,o)||u<0||u>=Math.pow(2,o))throw new Error(`x=${u}, y=${p}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=u,this.y=p,this.key=fp(0,o,o,u,p)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u,p){const v=(C=this.y,L=this.z,k=Eb(256*(S=this.x),256*(C=Math.pow(2,L)-C-1),L),j=Eb(256*(S+1),256*(C+1),L),k[0]+","+k[1]+","+j[0]+","+j[1]);var S,C,L,k,j;const q=function(J,et,nt){let lt,gt="";for(let St=J;St>0;St--)lt=1<<St-1,gt+=(et&lt?1:0)+(nt&lt?2:0);return gt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,v)}isChildOf(o){const u=this.z-o.z;return u>0&&o.x===this.x>>u&&o.y===this.y>>u}getTilePoint(o){const u=Math.pow(2,this.z);return new T((o.x*u-this.x)*br,(o.y*u-this.y)*br)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cb{constructor(o,u){this.wrap=o,this.canonical=u,this.key=fp(o,u.z,u.z,u.x,u.y)}}class Qo{constructor(o,u,p,v,S){if(o<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${p}`);this.overscaledZ=o,this.wrap=u,this.canonical=new y0(p,+v,+S),this.key=fp(u,o,p,v,S)}clone(){return new Qo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-o;return o>this.canonical.z?new Qo(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qo(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(o,u){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-o;return o>this.canonical.z?fp(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):fp(this.wrap*+u,o,o,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new Qo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,p=2*this.canonical.x,v=2*this.canonical.y;return[new Qo(u,this.wrap,u,p,v),new Qo(u,this.wrap,u,p+1,v),new Qo(u,this.wrap,u,p,v+1),new Qo(u,this.wrap,u,p+1,v+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Qo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Qo(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new Vf(o.x-this.wrap,o.y))}}function fp(h,o,u,p,v){(h*=2)<0&&(h=-1*h-1);const S=1<<u;return(S*S*h+S*v+p).toString(36)+u.toString(36)+o.toString(36)}We("CanonicalTileID",y0),We("OverscaledTileID",Qo,{omit:["posMatrix"]});class Tb{constructor(o,u,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,C=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,L=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Lt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const k=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=S,this.blueFactor=C,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let j=0;j<k;j++)this.data[this._idx(-1,j)]=this.data[this._idx(0,j)],this.data[this._idx(k,j)]=this.data[this._idx(k-1,j)],this.data[this._idx(j,-1)]=this.data[this._idx(j,0)],this.data[this._idx(j,k)]=this.data[this._idx(j,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let j=0;j<k;j++)for(let q=0;q<k;q++){const J=this.get(j,q);J>this.max&&(this.max=J),J<this.min&&(this.min=J)}}get(o,u){const p=new Uint8Array(this.data.buffer),v=4*this._idx(o,u);return this.unpack(p[v],p[v+1],p[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}unpack(o,u,p){return o*this.redFactor+u*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new go({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,u,p){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let v=u*this.dim,S=u*this.dim+this.dim,C=p*this.dim,L=p*this.dim+this.dim;switch(u){case-1:v=S-1;break;case 1:S=v+1}switch(p){case-1:C=L-1;break;case 1:L=C+1}const k=-u*this.dim,j=-p*this.dim;for(let q=C;q<L;q++)for(let J=v;J<S;J++)this.data[this._idx(J,q)]=o.data[this._idx(J+k,q+j)]}}We("DEMData",Tb);class Pb{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const p=o[u];this._stringToNumber[p]=u,this._numberToString[u]=p}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class Ib{constructor(o,u,p,v,S){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=p,o._y=v,this.properties=o.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o}}class Mb{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Hl(br,16,0),this.grid3D=new Hl(br,16,0),this.featureIndexArray=new E,this.promoteId=u}insert(o,u,p,v,S,C){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,v,S);const k=C?this.grid3D:this.grid;for(let j=0;j<u.length;j++){const q=u[j],J=[1/0,1/0,-1/0,-1/0];for(let et=0;et<q.length;et++){const nt=q[et];J[0]=Math.min(J[0],nt.x),J[1]=Math.min(J[1],nt.y),J[2]=Math.max(J[2],nt.x),J[3]=Math.max(J[3],nt.y)}J[0]<br&&J[1]<br&&J[2]>=0&&J[3]>=0&&k.insert(L,J[0],J[1],J[2],J[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new vh.VectorTile(new n0(this.rawTileData)).layers,this.sourceLayerCoder=new Pb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,u,p,v){this.loadVTLayers();const S=o.params||{},C=br/o.tileSize/o.scale,L=Aa(S.filter),k=o.queryGeometry,j=o.queryPadding*C,q=Bb(k),J=this.grid.query(q.minX-j,q.minY-j,q.maxX+j,q.maxY+j),et=Bb(o.cameraQueryGeometry),nt=this.grid3D.query(et.minX-j,et.minY-j,et.maxX+j,et.maxY+j,(St,Bt,$t,Ot)=>function(Ht,_e,be,He,ri){for(const ze of Ht)if(_e<=ze.x&&be<=ze.y&&He>=ze.x&&ri>=ze.y)return!0;const Ue=[new T(_e,be),new T(_e,ri),new T(He,ri),new T(He,be)];if(Ht.length>2){for(const ze of Ue)if(dl(Ht,ze))return!0}for(let ze=0;ze<Ht.length-1;ze++)if(nu(Ht[ze],Ht[ze+1],Ue))return!0;return!1}(o.cameraQueryGeometry,St-j,Bt-j,$t+j,Ot+j));for(const St of nt)J.push(St);J.sort(vT);const lt={};let gt;for(let St=0;St<J.length;St++){const Bt=J[St];if(Bt===gt)continue;gt=Bt;const $t=this.featureIndexArray.get(Bt);let Ot=null;this.loadMatchingFeature(lt,$t.bucketIndex,$t.sourceLayerIndex,$t.featureIndex,L,S.layers,S.availableImages,u,p,v,(Ht,_e,be)=>(Ot||(Ot=Pa(Ht)),_e.queryIntersectsFeature(k,Ht,be,Ot,this.z,o.transform,C,o.pixelPosMatrix)))}return lt}loadMatchingFeature(o,u,p,v,S,C,L,k,j,q,J){const et=this.bucketLayerIDs[u];if(C&&!function(St,Bt){for(let $t=0;$t<St.length;$t++)if(Bt.indexOf(St[$t])>=0)return!0;return!1}(C,et))return;const nt=this.sourceLayerCoder.decode(p),lt=this.vtLayers[nt].feature(v);if(S.needGeometry){const St=Ia(lt,!0);if(!S.filter(new Cr(this.tileID.overscaledZ),St,this.tileID.canonical))return}else if(!S.filter(new Cr(this.tileID.overscaledZ),lt))return;const gt=this.getId(lt,nt);for(let St=0;St<et.length;St++){const Bt=et[St];if(C&&C.indexOf(Bt)<0)continue;const $t=k[Bt];if(!$t)continue;let Ot={};gt&&q&&(Ot=q.getState($t.sourceLayer||"_geojsonTileLayer",gt));const Ht=Rt({},j[Bt]);Ht.paint=Lb(Ht.paint,$t.paint,lt,Ot,L),Ht.layout=Lb(Ht.layout,$t.layout,lt,Ot,L);const _e=!J||J(lt,$t,Ot);if(!_e)continue;const be=new Ib(lt,this.z,this.x,this.y,gt);be.layer=Ht;let He=o[Bt];He===void 0&&(He=o[Bt]=[]),He.push({featureIndex:v,feature:be,intersectionZ:_e})}}lookupSymbolFeatures(o,u,p,v,S,C,L,k){const j={};this.loadVTLayers();const q=Aa(S);for(const J of o)this.loadMatchingFeature(j,p,v,J,q,C,L,k,u);return j}hasLayer(o){for(const u of this.bucketLayerIDs)for(const p of u)if(o===p)return!0;return!1}getId(o,u){let p=o.id;return this.promoteId&&(p=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof p=="boolean"&&(p=Number(p))),p}}function Lb(h,o,u,p,v){return qt(h,(S,C)=>{const L=o instanceof Ec?o.get(C):null;return L&&L.evaluate?L.evaluate(u,p,v):L})}function Bb(h){let o=1/0,u=1/0,p=-1/0,v=-1/0;for(const S of h)o=Math.min(o,S.x),u=Math.min(u,S.y),p=Math.max(p,S.x),v=Math.max(v,S.y);return{minX:o,minY:u,maxX:p,maxY:v}}function vT(h,o){return o-h}function Rb(h,o,u,p,v){const S=[];for(let C=0;C<h.length;C++){const L=h[C];let k;for(let j=0;j<L.length-1;j++){let q=L[j],J=L[j+1];q.x<o&&J.x<o||(q.x<o?q=new T(o,q.y+(o-q.x)/(J.x-q.x)*(J.y-q.y))._round():J.x<o&&(J=new T(o,q.y+(o-q.x)/(J.x-q.x)*(J.y-q.y))._round()),q.y<u&&J.y<u||(q.y<u?q=new T(q.x+(u-q.y)/(J.y-q.y)*(J.x-q.x),u)._round():J.y<u&&(J=new T(q.x+(u-q.y)/(J.y-q.y)*(J.x-q.x),u)._round()),q.x>=p&&J.x>=p||(q.x>=p?q=new T(p,q.y+(p-q.x)/(J.x-q.x)*(J.y-q.y))._round():J.x>=p&&(J=new T(p,q.y+(p-q.x)/(J.x-q.x)*(J.y-q.y))._round()),q.y>=v&&J.y>=v||(q.y>=v?q=new T(q.x+(v-q.y)/(J.y-q.y)*(J.x-q.x),v)._round():J.y>=v&&(J=new T(q.x+(v-q.y)/(J.y-q.y)*(J.x-q.x),v)._round()),k&&q.equals(k[k.length-1])||(k=[q],S.push(k)),k.push(J)))))}}return S}We("FeatureIndex",Mb,{omit:["rawTileData","sourceLayerCoder"]});class Ah extends T{constructor(o,u,p,v){super(o,u),this.angle=p,v!==void 0&&(this.segment=v)}clone(){return new Ah(this.x,this.y,this.angle,this.segment)}}function kb(h,o,u,p,v){if(o.segment===void 0||u===0)return!0;let S=o,C=o.segment+1,L=0;for(;L>-u/2;){if(C--,C<0)return!1;L-=h[C].dist(S),S=h[C]}L+=h[C].dist(h[C+1]),C++;const k=[];let j=0;for(;L<u/2;){const q=h[C],J=h[C+1];if(!J)return!1;let et=h[C-1].angleTo(q)-q.angleTo(J);for(et=Math.abs((et+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:L,angleDelta:et}),j+=et;L-k[0].distance>p;)j-=k.shift().angleDelta;if(j>v)return!1;C++,L+=q.dist(J)}return!0}function Ob(h){let o=0;for(let u=0;u<h.length-1;u++)o+=h[u].dist(h[u+1]);return o}function Db(h,o,u){return h?.6*o*u:0}function Nb(h,o){return Math.max(h?h.right-h.left:0,o?o.right-o.left:0)}function bT(h,o,u,p,v,S){const C=Db(u,v,S),L=Nb(u,p)*S;let k=0;const j=Ob(h)/2;for(let q=0;q<h.length-1;q++){const J=h[q],et=h[q+1],nt=J.dist(et);if(k+nt>j){const lt=(j-k)/nt,gt=gs.number(J.x,et.x,lt),St=gs.number(J.y,et.y,lt),Bt=new Ah(gt,St,et.angleTo(J),q);return Bt._round(),!C||kb(h,Bt,L,C,o)?Bt:void 0}k+=nt}}function wT(h,o,u,p,v,S,C,L,k){const j=Db(p,S,C),q=Nb(p,v),J=q*C,et=h[0].x===0||h[0].x===k||h[0].y===0||h[0].y===k;return o-J<o/4&&(o=J+o/4),Fb(h,et?o/2*L%o:(q/2+2*S)*C*L%o,o,j,u,J,et,!1,k)}function Fb(h,o,u,p,v,S,C,L,k){const j=S/2,q=Ob(h);let J=0,et=o-u,nt=[];for(let lt=0;lt<h.length-1;lt++){const gt=h[lt],St=h[lt+1],Bt=gt.dist(St),$t=St.angleTo(gt);for(;et+u<J+Bt;){et+=u;const Ot=(et-J)/Bt,Ht=gs.number(gt.x,St.x,Ot),_e=gs.number(gt.y,St.y,Ot);if(Ht>=0&&Ht<k&&_e>=0&&_e<k&&et-j>=0&&et+j<=q){const be=new Ah(Ht,_e,$t,lt);be._round(),p&&!kb(h,be,S,p,v)||nt.push(be)}}J+=Bt}return L||nt.length||C||(nt=Fb(h,J/2,u,p,v,S,C,!0,k)),nt}We("Anchor",Ah);const td=mo;function zb(h,o,u,p){const v=[],S=h.image,C=S.pixelRatio,L=S.paddedRect.w-2*td,k=S.paddedRect.h-2*td,j=h.right-h.left,q=h.bottom-h.top,J=S.stretchX||[[0,L]],et=S.stretchY||[[0,k]],nt=(Be,Ye)=>Be+Ye[1]-Ye[0],lt=J.reduce(nt,0),gt=et.reduce(nt,0),St=L-lt,Bt=k-gt;let $t=0,Ot=lt,Ht=0,_e=gt,be=0,He=St,ri=0,Ue=Bt;if(S.content&&p){const Be=S.content;$t=qf(J,0,Be[0]),Ht=qf(et,0,Be[1]),Ot=qf(J,Be[0],Be[2]),_e=qf(et,Be[1],Be[3]),be=Be[0]-$t,ri=Be[1]-Ht,He=Be[2]-Be[0]-Ot,Ue=Be[3]-Be[1]-_e}const ze=(Be,Ye,Oe,Ce)=>{const mi=Hf(Be.stretch-$t,Ot,j,h.left),oi=Wf(Be.fixed-be,He,Be.stretch,lt),Gi=Hf(Ye.stretch-Ht,_e,q,h.top),Hr=Wf(Ye.fixed-ri,Ue,Ye.stretch,gt),Kr=Hf(Oe.stretch-$t,Ot,j,h.left),zs=Wf(Oe.fixed-be,He,Oe.stretch,lt),Oo=Hf(Ce.stretch-Ht,_e,q,h.top),Un=Wf(Ce.fixed-ri,Ue,Ce.stretch,gt),Ps=new T(mi,Gi),tn=new T(Kr,Gi),pn=new T(Kr,Oo),Gn=new T(mi,Oo),Vn=new T(oi/C,Hr/C),js=new T(zs/C,Un/C),Us=o*Math.PI/180;if(Us){const Pn=Math.sin(Us),yo=Math.cos(Us),_o=[yo,-Pn,Pn,yo];Ps._matMult(_o),tn._matMult(_o),Gn._matMult(_o),pn._matMult(_o)}const Tn=Be.stretch+Be.fixed,qn=Ye.stretch+Ye.fixed;return{tl:Ps,tr:tn,bl:Gn,br:pn,tex:{x:S.paddedRect.x+td+Tn,y:S.paddedRect.y+td+qn,w:Oe.stretch+Oe.fixed-Tn,h:Ce.stretch+Ce.fixed-qn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vn,pixelOffsetBR:js,minFontScaleX:He/C/j,minFontScaleY:Ue/C/q,isSDF:u}};if(p&&(S.stretchX||S.stretchY)){const Be=jb(J,St,lt),Ye=jb(et,Bt,gt);for(let Oe=0;Oe<Be.length-1;Oe++){const Ce=Be[Oe],mi=Be[Oe+1];for(let oi=0;oi<Ye.length-1;oi++)v.push(ze(Ce,Ye[oi],mi,Ye[oi+1]))}}else v.push(ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:k+1}));return v}function qf(h,o,u){let p=0;for(const v of h)p+=Math.max(o,Math.min(u,v[1]))-Math.max(o,Math.min(u,v[0]));return p}function jb(h,o,u){const p=[{fixed:-td,stretch:0}];for(const[v,S]of h){const C=p[p.length-1];p.push({fixed:v-C.stretch,stretch:C.stretch}),p.push({fixed:v-C.stretch,stretch:C.stretch+(S-v)})}return p.push({fixed:o+td,stretch:u}),p}function Hf(h,o,u,p){return h/o*u+p}function Wf(h,o,u,p){return h-o*u/p}class Jf{constructor(o,u,p,v,S,C,L,k,j,q){if(this.boxStartIndex=o.length,j){let J=C.top,et=C.bottom;const nt=C.collisionPadding;nt&&(J-=nt[1],et+=nt[3]);let lt=et-J;lt>0&&(lt=Math.max(10,lt),this.circleDiameter=lt)}else{let J=C.top*L-k[0],et=C.bottom*L+k[2],nt=C.left*L-k[3],lt=C.right*L+k[1];const gt=C.collisionPadding;if(gt&&(nt-=gt[0]*L,J-=gt[1]*L,lt+=gt[2]*L,et+=gt[3]*L),q){const St=new T(nt,J),Bt=new T(lt,J),$t=new T(nt,et),Ot=new T(lt,et),Ht=q*Math.PI/180;St._rotate(Ht),Bt._rotate(Ht),$t._rotate(Ht),Ot._rotate(Ht),nt=Math.min(St.x,Bt.x,$t.x,Ot.x),lt=Math.max(St.x,Bt.x,$t.x,Ot.x),J=Math.min(St.y,Bt.y,$t.y,Ot.y),et=Math.max(St.y,Bt.y,$t.y,Ot.y)}o.emplaceBack(u.x,u.y,nt,J,lt,et,p,v,S)}this.boxEndIndex=o.length}}class xT{constructor(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:AT;if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:p}=this,v=u[o];for(;o>0;){const S=o-1>>1,C=u[S];if(p(v,C)>=0)break;u[o]=C,o=S}u[o]=v}_down(o){const{data:u,compare:p}=this,v=this.length>>1,S=u[o];for(;o<v;){let C=1+(o<<1),L=u[C];const k=C+1;if(k<this.length&&p(u[k],L)<0&&(C=k,L=u[k]),p(L,S)>=0)break;u[o]=L,o=C}u[o]=S}}function AT(h,o){return h<o?-1:h>o?1:0}function ST(h){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,v=1/0,S=-1/0,C=-1/0;const L=h[0];for(let nt=0;nt<L.length;nt++){const lt=L[nt];(!nt||lt.x<p)&&(p=lt.x),(!nt||lt.y<v)&&(v=lt.y),(!nt||lt.x>S)&&(S=lt.x),(!nt||lt.y>C)&&(C=lt.y)}const k=Math.min(S-p,C-v);let j=k/2;const q=new xT([],ET);if(k===0)return new T(p,v);for(let nt=p;nt<S;nt+=k)for(let lt=v;lt<C;lt+=k)q.push(new ed(nt+j,lt+j,j,h));let J=function(nt){let lt=0,gt=0,St=0;const Bt=nt[0];for(let $t=0,Ot=Bt.length,Ht=Ot-1;$t<Ot;Ht=$t++){const _e=Bt[$t],be=Bt[Ht],He=_e.x*be.y-be.x*_e.y;gt+=(_e.x+be.x)*He,St+=(_e.y+be.y)*He,lt+=3*He}return new ed(gt/lt,St/lt,0,nt)}(h),et=q.length;for(;q.length;){const nt=q.pop();(nt.d>J.d||!J.d)&&(J=nt,u&&console.log("found best %d after %d probes",Math.round(1e4*nt.d)/1e4,et)),nt.max-J.d<=o||(j=nt.h/2,q.push(new ed(nt.p.x-j,nt.p.y-j,j,h)),q.push(new ed(nt.p.x+j,nt.p.y-j,j,h)),q.push(new ed(nt.p.x-j,nt.p.y+j,j,h)),q.push(new ed(nt.p.x+j,nt.p.y+j,j,h)),et+=4)}return u&&(console.log(`num probes: ${et}`),console.log(`best distance: ${J.d}`)),J.p}function ET(h,o){return o.max-h.max}function ed(h,o,u,p){this.p=new T(h,o),this.h=u,this.d=function(v,S){let C=!1,L=1/0;for(let k=0;k<S.length;k++){const j=S[k];for(let q=0,J=j.length,et=J-1;q<J;et=q++){const nt=j[q],lt=j[et];nt.y>v.y!=lt.y>v.y&&v.x<(lt.x-nt.x)*(v.y-nt.y)/(lt.y-nt.y)+nt.x&&(C=!C),L=Math.min(L,su(v,nt,lt))}}return(C?1:-1)*Math.sqrt(L)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var dn;c.ap=void 0,(dn=c.ap||(c.ap={}))[dn.center=1]="center",dn[dn.left=2]="left",dn[dn.right=3]="right",dn[dn.top=4]="top",dn[dn.bottom=5]="bottom",dn[dn["top-left"]=6]="top-left",dn[dn["top-right"]=7]="top-right",dn[dn["bottom-left"]=8]="bottom-left",dn[dn["bottom-right"]=9]="bottom-right";const Sh=7,_0=Number.POSITIVE_INFINITY;function Ub(h,o){return o[1]!==_0?function(u,p,v){let S=0,C=0;switch(p=Math.abs(p),v=Math.abs(v),u){case"top-right":case"top-left":case"top":C=v-Sh;break;case"bottom-right":case"bottom-left":case"bottom":C=-v+Sh}switch(u){case"top-right":case"bottom-right":case"right":S=-p;break;case"top-left":case"bottom-left":case"left":S=p}return[S,C]}(h,o[0],o[1]):function(u,p){let v=0,S=0;p<0&&(p=0);const C=p/Math.SQRT2;switch(u){case"top-right":case"top-left":S=C-Sh;break;case"bottom-right":case"bottom-left":S=-C+Sh;break;case"bottom":S=-p+Sh;break;case"top":S=p-Sh}switch(u){case"top-right":case"bottom-right":v=-C;break;case"top-left":case"bottom-left":v=C;break;case"left":v=p;break;case"right":v=-p}return[v,S]}(h,o[0])}function Gb(h,o,u){var p;const v=h.layout,S=(p=v.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(o,{},u);if(S){const L=S.values,k=[];for(let j=0;j<L.length;j+=2){const q=k[j]=L[j],J=L[j+1].map(et=>et*Fs);q.startsWith("top")?J[1]-=Sh:q.startsWith("bottom")&&(J[1]+=Sh),k[j+1]=J}return new kr(k)}const C=v.get("text-variable-anchor");if(C){let L;L=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(o,{},u)*Fs,_0]:v.get("text-offset").evaluate(o,{},u).map(j=>j*Fs);const k=[];for(const j of C)k.push(j,Ub(j,L));return new kr(k)}return null}function v0(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function CT(h,o,u,p,v,S,C,L,k,j,q){let J=S.textMaxSize.evaluate(o,{});J===void 0&&(J=C);const et=h.layers[0].layout,nt=et.get("icon-offset").evaluate(o,{},q),lt=qb(u.horizontal),gt=C/24,St=h.tilePixelRatio*gt,Bt=h.tilePixelRatio*J/24,$t=h.tilePixelRatio*L,Ot=h.tilePixelRatio*et.get("symbol-spacing"),Ht=et.get("text-padding")*h.tilePixelRatio,_e=function(Ce,mi,oi){let Gi=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Hr=Ce.get("icon-padding").evaluate(mi,{},oi),Kr=Hr&&Hr.values;return[Kr[0]*Gi,Kr[1]*Gi,Kr[2]*Gi,Kr[3]*Gi]}(et,o,q,h.tilePixelRatio),be=et.get("text-max-angle")/180*Math.PI,He=et.get("text-rotation-alignment")!=="viewport"&&et.get("symbol-placement")!=="point",ri=et.get("icon-rotation-alignment")==="map"&&et.get("symbol-placement")!=="point",Ue=et.get("symbol-placement"),ze=Ot/2,Be=et.get("icon-text-fit");let Ye;p&&Be!=="none"&&(h.allowVerticalPlacement&&u.vertical&&(Ye=pb(p,u.vertical,Be,et.get("icon-text-fit-padding"),nt,gt)),lt&&(p=pb(p,lt,Be,et.get("icon-text-fit-padding"),nt,gt)));const Oe=(Ce,mi)=>{mi.x<0||mi.x>=br||mi.y<0||mi.y>=br||function(oi,Gi,Hr,Kr,zs,Oo,Un,Ps,tn,pn,Gn,Vn,js,Us,Tn,qn,Pn,yo,_o,Gs,Ki,In,fn,Vs,Ba){const gl=oi.addToLineVertexArray(Gi,Hr);let ml,Dc,Ra,ta,vo=0,Nc=0,yp=0,Zb=0,T0=-1,P0=-1;const Fc={};let Xb=yi("");if(oi.allowVerticalPlacement&&Kr.vertical){const Mn=Ps.layout.get("text-rotate").evaluate(Ki,{},Vs)+90;Ra=new Jf(tn,Gi,pn,Gn,Vn,Kr.vertical,js,Us,Tn,Mn),Un&&(ta=new Jf(tn,Gi,pn,Gn,Vn,Un,Pn,yo,Tn,Mn))}if(zs){const Mn=Ps.layout.get("icon-rotate").evaluate(Ki,{}),ea=Ps.layout.get("icon-text-fit")!=="none",uu=zb(zs,Mn,fn,ea),_l=Un?zb(Un,Mn,fn,ea):void 0;Dc=new Jf(tn,Gi,pn,Gn,Vn,zs,Pn,yo,!1,Mn),vo=4*uu.length;const du=oi.iconSizeData;let Yl=null;du.kind==="source"?(Yl=[Kl*Ps.layout.get("icon-size").evaluate(Ki,{})],Yl[0]>wh&&Lt(`${oi.layerIds[0]}: Value for "icon-size" is >= ${pp}. Reduce your "icon-size".`)):du.kind==="composite"&&(Yl=[Kl*In.compositeIconSizes[0].evaluate(Ki,{},Vs),Kl*In.compositeIconSizes[1].evaluate(Ki,{},Vs)],(Yl[0]>wh||Yl[1]>wh)&&Lt(`${oi.layerIds[0]}: Value for "icon-size" is >= ${pp}. Reduce your "icon-size".`)),oi.addSymbols(oi.icon,uu,Yl,Gs,_o,Ki,c.ah.none,Gi,gl.lineStartIndex,gl.lineLength,-1,Vs),T0=oi.icon.placedSymbolArray.length-1,_l&&(Nc=4*_l.length,oi.addSymbols(oi.icon,_l,Yl,Gs,_o,Ki,c.ah.vertical,Gi,gl.lineStartIndex,gl.lineLength,-1,Vs),P0=oi.icon.placedSymbolArray.length-1)}const $b=Object.keys(Kr.horizontal);for(const Mn of $b){const ea=Kr.horizontal[Mn];if(!ml){Xb=yi(ea.text);const _l=Ps.layout.get("text-rotate").evaluate(Ki,{},Vs);ml=new Jf(tn,Gi,pn,Gn,Vn,ea,js,Us,Tn,_l)}const uu=ea.positionedLines.length===1;if(yp+=Vb(oi,Gi,ea,Oo,Ps,Tn,Ki,qn,gl,Kr.vertical?c.ah.horizontal:c.ah.horizontalOnly,uu?$b:[Mn],Fc,T0,In,Vs),uu)break}Kr.vertical&&(Zb+=Vb(oi,Gi,Kr.vertical,Oo,Ps,Tn,Ki,qn,gl,c.ah.vertical,["vertical"],Fc,P0,In,Vs));const IT=ml?ml.boxStartIndex:oi.collisionBoxArray.length,MT=ml?ml.boxEndIndex:oi.collisionBoxArray.length,LT=Ra?Ra.boxStartIndex:oi.collisionBoxArray.length,BT=Ra?Ra.boxEndIndex:oi.collisionBoxArray.length,RT=Dc?Dc.boxStartIndex:oi.collisionBoxArray.length,kT=Dc?Dc.boxEndIndex:oi.collisionBoxArray.length,OT=ta?ta.boxStartIndex:oi.collisionBoxArray.length,DT=ta?ta.boxEndIndex:oi.collisionBoxArray.length;let yl=-1;const Xf=(Mn,ea)=>Mn&&Mn.circleDiameter?Math.max(Mn.circleDiameter,ea):ea;yl=Xf(ml,yl),yl=Xf(Ra,yl),yl=Xf(Dc,yl),yl=Xf(ta,yl);const Kb=yl>-1?1:0;Kb&&(yl*=Ba/Fs),oi.glyphOffsetArray.length>=Qu.MAX_GLYPHS&&Lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ki.sortKey!==void 0&&oi.addToSortKeyRanges(oi.symbolInstances.length,Ki.sortKey);const NT=Gb(Ps,Ki,Vs),[FT,zT]=function(Mn,ea){const uu=Mn.length,_l=ea==null?void 0:ea.values;if((_l==null?void 0:_l.length)>0)for(let du=0;du<_l.length;du+=2){const Yl=_l[du+1];Mn.emplaceBack(c.ap[_l[du]],Yl[0],Yl[1])}return[uu,Mn.length]}(oi.textAnchorOffsets,NT);oi.symbolInstances.emplaceBack(Gi.x,Gi.y,Fc.right>=0?Fc.right:-1,Fc.center>=0?Fc.center:-1,Fc.left>=0?Fc.left:-1,Fc.vertical||-1,T0,P0,Xb,IT,MT,LT,BT,RT,kT,OT,DT,pn,yp,Zb,vo,Nc,Kb,0,js,yl,FT,zT)}(h,mi,Ce,u,p,v,Ye,h.layers[0],h.collisionBoxArray,o.index,o.sourceLayerIndex,h.index,St,[Ht,Ht,Ht,Ht],He,k,$t,_e,ri,nt,o,S,j,q,C)};if(Ue==="line")for(const Ce of Rb(o.geometry,0,0,br,br)){const mi=wT(Ce,Ot,be,u.vertical||lt,p,24,Bt,h.overscaling,br);for(const oi of mi)lt&&TT(h,lt.text,ze,oi)||Oe(Ce,oi)}else if(Ue==="line-center"){for(const Ce of o.geometry)if(Ce.length>1){const mi=bT(Ce,be,u.vertical||lt,p,24,Bt);mi&&Oe(Ce,mi)}}else if(o.type==="Polygon")for(const Ce of Km(o.geometry,0)){const mi=ST(Ce,16);Oe(Ce[0],new Ah(mi.x,mi.y,0))}else if(o.type==="LineString")for(const Ce of o.geometry)Oe(Ce,new Ah(Ce[0].x,Ce[0].y,0));else if(o.type==="Point")for(const Ce of o.geometry)for(const mi of Ce)Oe([mi],new Ah(mi.x,mi.y,0))}function Vb(h,o,u,p,v,S,C,L,k,j,q,J,et,nt,lt){const gt=function($t,Ot,Ht,_e,be,He,ri,Ue){const ze=_e.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,Be=[];for(const Ye of Ot.positionedLines)for(const Oe of Ye.positionedGlyphs){if(!Oe.rect)continue;const Ce=Oe.rect||{};let mi=ob+1,oi=!0,Gi=1,Hr=0;const Kr=(be||Ue)&&Oe.vertical,zs=Oe.metrics.advance*Oe.scale/2;if(Ue&&Ot.verticalizable&&(Hr=Ye.lineOffset/2-(Oe.imageName?-(Fs-Oe.metrics.width*Oe.scale)/2:(Oe.scale-1)*Fs)),Oe.imageName){const Gs=ri[Oe.imageName];oi=Gs.sdf,Gi=Gs.pixelRatio,mi=mo/Gi}const Oo=be?[Oe.x+zs,Oe.y]:[0,0];let Un=be?[0,0]:[Oe.x+zs+Ht[0],Oe.y+Ht[1]-Hr],Ps=[0,0];Kr&&(Ps=Un,Un=[0,0]);const tn=Oe.metrics.isDoubleResolution?2:1,pn=(Oe.metrics.left-mi)*Oe.scale-zs+Un[0],Gn=(-Oe.metrics.top-mi)*Oe.scale+Un[1],Vn=pn+Ce.w/tn*Oe.scale/Gi,js=Gn+Ce.h/tn*Oe.scale/Gi,Us=new T(pn,Gn),Tn=new T(Vn,Gn),qn=new T(pn,js),Pn=new T(Vn,js);if(Kr){const Gs=new T(-zs,zs-up),Ki=-Math.PI/2,In=Fs/2-zs,fn=new T(5-up-In,-(Oe.imageName?In:0)),Vs=new T(...Ps);Us._rotateAround(Ki,Gs)._add(fn)._add(Vs),Tn._rotateAround(Ki,Gs)._add(fn)._add(Vs),qn._rotateAround(Ki,Gs)._add(fn)._add(Vs),Pn._rotateAround(Ki,Gs)._add(fn)._add(Vs)}if(ze){const Gs=Math.sin(ze),Ki=Math.cos(ze),In=[Ki,-Gs,Gs,Ki];Us._matMult(In),Tn._matMult(In),qn._matMult(In),Pn._matMult(In)}const yo=new T(0,0),_o=new T(0,0);Be.push({tl:Us,tr:Tn,bl:qn,br:Pn,tex:Ce,writingMode:Ot.writingMode,glyphOffset:Oo,sectionIndex:Oe.sectionIndex,isSDF:oi,pixelOffsetTL:yo,pixelOffsetBR:_o,minFontScaleX:0,minFontScaleY:0})}return Be}(0,u,L,v,S,C,p,h.allowVerticalPlacement),St=h.textSizeData;let Bt=null;St.kind==="source"?(Bt=[Kl*v.layout.get("text-size").evaluate(C,{})],Bt[0]>wh&&Lt(`${h.layerIds[0]}: Value for "text-size" is >= ${pp}. Reduce your "text-size".`)):St.kind==="composite"&&(Bt=[Kl*nt.compositeTextSizes[0].evaluate(C,{},lt),Kl*nt.compositeTextSizes[1].evaluate(C,{},lt)],(Bt[0]>wh||Bt[1]>wh)&&Lt(`${h.layerIds[0]}: Value for "text-size" is >= ${pp}. Reduce your "text-size".`)),h.addSymbols(h.text,gt,Bt,L,S,C,j,o,k.lineStartIndex,k.lineLength,et,lt);for(const $t of q)J[$t]=h.text.placedSymbolArray.length-1;return 4*gt.length}function qb(h){for(const o in h)return h[o];return null}function TT(h,o,u,p){const v=h.compareText;if(o in v){const S=v[o];for(let C=S.length-1;C>=0;C--)if(p.dist(S[C])<u)return!0}else v[o]=[];return v[o].push(p),!1}const Hb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class b0{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,p]=new Uint8Array(o,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=p>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const S=Hb[15&p];if(!S)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(o,2,1),[L]=new Uint32Array(o,4,1);return new b0(L,C,S,o)}constructor(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,v=arguments.length>3?arguments[3]:void 0;if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=p,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const S=Hb.indexOf(this.ArrayType),C=2*o*this.ArrayType.BYTES_PER_ELEMENT,L=o*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-L%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${p}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+L+k,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+C+L+k),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+L+k,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=o)}add(o,u){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=o,this.coords[this._pos++]=u,p}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return w0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,u,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:C,nodeSize:L}=this,k=[0,S.length-1,0],j=[];for(;k.length;){const q=k.pop()||0,J=k.pop()||0,et=k.pop()||0;if(J-et<=L){for(let St=et;St<=J;St++){const Bt=C[2*St],$t=C[2*St+1];Bt>=o&&Bt<=p&&$t>=u&&$t<=v&&j.push(S[St])}continue}const nt=et+J>>1,lt=C[2*nt],gt=C[2*nt+1];lt>=o&&lt<=p&&gt>=u&&gt<=v&&j.push(S[nt]),(q===0?o<=lt:u<=gt)&&(k.push(et),k.push(nt-1),k.push(1-q)),(q===0?p>=lt:v>=gt)&&(k.push(nt+1),k.push(J),k.push(1-q))}return j}within(o,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:S,nodeSize:C}=this,L=[0,v.length-1,0],k=[],j=p*p;for(;L.length;){const q=L.pop()||0,J=L.pop()||0,et=L.pop()||0;if(J-et<=C){for(let St=et;St<=J;St++)Jb(S[2*St],S[2*St+1],o,u)<=j&&k.push(v[St]);continue}const nt=et+J>>1,lt=S[2*nt],gt=S[2*nt+1];Jb(lt,gt,o,u)<=j&&k.push(v[nt]),(q===0?o-p<=lt:u-p<=gt)&&(L.push(et),L.push(nt-1),L.push(1-q)),(q===0?o+p>=lt:u+p>=gt)&&(L.push(nt+1),L.push(J),L.push(1-q))}return k}}function w0(h,o,u,p,v,S){if(v-p<=u)return;const C=p+v>>1;Wb(h,o,C,p,v,S),w0(h,o,u,p,C-1,1-S),w0(h,o,u,C+1,v,1-S)}function Wb(h,o,u,p,v,S){for(;v>p;){if(v-p>600){const j=v-p+1,q=u-p+1,J=Math.log(j),et=.5*Math.exp(2*J/3),nt=.5*Math.sqrt(J*et*(j-et)/j)*(q-j/2<0?-1:1);Wb(h,o,u,Math.max(p,Math.floor(u-q*et/j+nt)),Math.min(v,Math.floor(u+(j-q)*et/j+nt)),S)}const C=o[2*u+S];let L=p,k=v;for(gp(h,o,p,u),o[2*v+S]>C&&gp(h,o,p,v);L<k;){for(gp(h,o,L,k),L++,k--;o[2*L+S]<C;)L++;for(;o[2*k+S]>C;)k--}o[2*p+S]===C?gp(h,o,p,k):(k++,gp(h,o,k,v)),k<=u&&(p=k+1),u<=k&&(v=k-1)}}function gp(h,o,u,p){x0(h,u,p),x0(o,2*u,2*p),x0(o,2*u+1,2*p+1)}function x0(h,o,u){const p=h[o];h[o]=h[u],h[u]=p}function Jb(h,o,u,p){const v=h-u,S=o-p;return v*v+S*S}var A0;c.bd=void 0,(A0=c.bd||(c.bd={})).create="create",A0.load="load",A0.fullLoad="fullLoad";let Zf=null,mp=[];const S0=1e3/60,E0="loadTime",C0="fullLoadTime",PT={mark(h){performance.mark(h)},frame(h){const o=h;Zf!=null&&mp.push(o-Zf),Zf=o},clearMetrics(){Zf=null,mp=[],performance.clearMeasures(E0),performance.clearMeasures(C0);for(const h in c.bd)performance.clearMarks(c.bd[h])},getPerformanceMetrics(){performance.measure(E0,c.bd.create,c.bd.load),performance.measure(C0,c.bd.create,c.bd.fullLoad);const h=performance.getEntriesByName(E0)[0].duration,o=performance.getEntriesByName(C0)[0].duration,u=mp.length,p=1/(mp.reduce((S,C)=>S+C,0)/u/1e3),v=mp.filter(S=>S>S0).reduce((S,C)=>S+(C-S0)/S0,0);return{loadTime:h,fullLoadTime:o,fps:p,percentDroppedFrames:v/(u+v)*100,totalFrames:u}}};c.$=Wt,c.A=Rc,c.B=function(h){if(de==null){const o=h.navigator?h.navigator.userAgent:null;de=!!h.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return de},c.C=class{constructor(h,o){this.target=h,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _T(()=>this.process()),this.subscription=function(u,p,v,S){return u.addEventListener(p,v,!1),{unsubscribe:()=>{u.removeEventListener(p,v,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=oe(self)?h:window}registerMessageHandler(h,o){this.messageHandlers[h]=o}sendAsync(h,o){return new Promise((u,p)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:u,reject:p},o&&o.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const L={id:v,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const S=[],C=Object.assign(Object.assign({},h),{id:v,sourceMapId:this.mapId,origin:location.origin,data:il(h.data,S)});this.target.postMessage(C,{transfer:S})})}receive(h){const o=h.data,u=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[u];const p=this.abortControllers[u];return delete this.abortControllers[u],void(p&&p.abort())}if(oe(self)||o.mustQueue)return this.tasks[u]=o,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,o)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),o=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(h,o)}processTask(h,o){return l(this,void 0,void 0,function*(){if(o.type==="<response>"){const v=this.resolveRejects[h];return delete this.resolveRejects[h],v?void(o.error?v.reject(rl(o.error)):v.resolve(rl(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=rl(o.data),p=new AbortController;this.abortControllers[h]=p;try{const v=yield this.messageHandlers[o.type](o.sourceMapId,u,p);this.completeTask(h,null,v)}catch(v){this.completeTask(h,v)}})}completeTask(h,o,u){const p=[];delete this.abortControllers[h];const v={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?il(o):null,data:il(u,p)};this.target.postMessage(v,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.D=ni,c.E=Pt,c.F=function(){var h=new Rc(16);return Rc!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.G=Kt,c.H=function(h,o,u){var p,v,S,C,L,k,j,q,J,et,nt,lt,gt=u[0],St=u[1],Bt=u[2];return o===h?(h[12]=o[0]*gt+o[4]*St+o[8]*Bt+o[12],h[13]=o[1]*gt+o[5]*St+o[9]*Bt+o[13],h[14]=o[2]*gt+o[6]*St+o[10]*Bt+o[14],h[15]=o[3]*gt+o[7]*St+o[11]*Bt+o[15]):(v=o[1],S=o[2],C=o[3],L=o[4],k=o[5],j=o[6],q=o[7],J=o[8],et=o[9],nt=o[10],lt=o[11],h[0]=p=o[0],h[1]=v,h[2]=S,h[3]=C,h[4]=L,h[5]=k,h[6]=j,h[7]=q,h[8]=J,h[9]=et,h[10]=nt,h[11]=lt,h[12]=p*gt+L*St+J*Bt+o[12],h[13]=v*gt+k*St+et*Bt+o[13],h[14]=S*gt+j*St+nt*Bt+o[14],h[15]=C*gt+q*St+lt*Bt+o[15]),h},c.I=a0,c.J=function(h,o,u){var p=u[0],v=u[1],S=u[2];return h[0]=o[0]*p,h[1]=o[1]*p,h[2]=o[2]*p,h[3]=o[3]*p,h[4]=o[4]*v,h[5]=o[5]*v,h[6]=o[6]*v,h[7]=o[7]*v,h[8]=o[8]*S,h[9]=o[9]*S,h[10]=o[10]*S,h[11]=o[11]*S,h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15],h},c.K=Qd,c.L=function(h,o){const u={};for(let p=0;p<o.length;p++){const v=o[p];v in h&&(u[v]=h[v])}return u},c.M=xh,c.N=xb,c.O=Ab,c.P=T,c.Q=Qo,c.R=go,c.S=X,c.T=Sc,c.U=$,c.V=ge,c.W=br,c.X=os,c.Y=Vf,c.Z=class extends po{},c._=l,c.a=Ut,c.a$=function(h,o,u){return h[0]=o[0]*u[0],h[1]=o[1]*u[1],h[2]=o[2]*u[2],h[3]=o[3]*u[3],h},c.a0=y0,c.a1=ce,c.a2=h=>{const o=window.document.createElement("video");return o.muted=!0,new Promise(u=>{o.onloadstart=()=>{u(o)};for(const p of h){const v=window.document.createElement("source");Le(p)||(o.crossOrigin="Anonymous"),v.src=p,o.appendChild(v)}})},c.a3=function(){return xt++},c.a4=w,c.a5=Qu,c.a6=Aa,c.a7=Ia,c.a8=Cr,c.a9=Ib,c.aA=ot,c.aB=function(h,o){if(!h)return[{command:"setStyle",args:[o]}];let u=[];try{if(!ve(h.version,o.version))return[{command:"setStyle",args:[o]}];ve(h.center,o.center)||u.push({command:"setCenter",args:[o.center]}),ve(h.zoom,o.zoom)||u.push({command:"setZoom",args:[o.zoom]}),ve(h.bearing,o.bearing)||u.push({command:"setBearing",args:[o.bearing]}),ve(h.pitch,o.pitch)||u.push({command:"setPitch",args:[o.pitch]}),ve(h.sprite,o.sprite)||u.push({command:"setSprite",args:[o.sprite]}),ve(h.glyphs,o.glyphs)||u.push({command:"setGlyphs",args:[o.glyphs]}),ve(h.transition,o.transition)||u.push({command:"setTransition",args:[o.transition]}),ve(h.light,o.light)||u.push({command:"setLight",args:[o.light]}),ve(h.terrain,o.terrain)||u.push({command:"setTerrain",args:[o.terrain]}),ve(h.sky,o.sky)||u.push({command:"setSky",args:[o.sky]});const p={},v=[];(function(C,L,k,j){let q;for(q in L=L||{},C=C||{})Object.prototype.hasOwnProperty.call(C,q)&&(Object.prototype.hasOwnProperty.call(L,q)||ai(q,k,j));for(q in L)Object.prototype.hasOwnProperty.call(L,q)&&(Object.prototype.hasOwnProperty.call(C,q)?ve(C[q],L[q])||(C[q].type==="geojson"&&L[q].type==="geojson"&&Ti(C,L,q)?Ee(k,{command:"setGeoJSONSourceData",args:[q,L[q].data]}):Ai(q,L,k,j)):Ve(q,L,k))})(h.sources,o.sources,v,p);const S=[];h.layers&&h.layers.forEach(C=>{"source"in C&&p[C.source]?u.push({command:"removeLayer",args:[C.id]}):S.push(C)}),u=u.concat(v),function(C,L,k){L=L||[];const j=(C=C||[]).map(qi),q=L.map(qi),J=C.reduce(Ji,{}),et=L.reduce(Ji,{}),nt=j.slice(),lt=Object.create(null);let gt,St,Bt,$t,Ot;for(let Ht=0,_e=0;Ht<j.length;Ht++)gt=j[Ht],Object.prototype.hasOwnProperty.call(et,gt)?_e++:(Ee(k,{command:"removeLayer",args:[gt]}),nt.splice(nt.indexOf(gt,_e),1));for(let Ht=0,_e=0;Ht<q.length;Ht++)gt=q[q.length-1-Ht],nt[nt.length-1-Ht]!==gt&&(Object.prototype.hasOwnProperty.call(J,gt)?(Ee(k,{command:"removeLayer",args:[gt]}),nt.splice(nt.lastIndexOf(gt,nt.length-_e),1)):_e++,$t=nt[nt.length-Ht],Ee(k,{command:"addLayer",args:[et[gt],$t]}),nt.splice(nt.length-Ht,0,gt),lt[gt]=!0);for(let Ht=0;Ht<q.length;Ht++)if(gt=q[Ht],St=J[gt],Bt=et[gt],!lt[gt]&&!ve(St,Bt))if(ve(St.source,Bt.source)&&ve(St["source-layer"],Bt["source-layer"])&&ve(St.type,Bt.type)){for(Ot in Pi(St.layout,Bt.layout,k,gt,null,"setLayoutProperty"),Pi(St.paint,Bt.paint,k,gt,null,"setPaintProperty"),ve(St.filter,Bt.filter)||Ee(k,{command:"setFilter",args:[gt,Bt.filter]}),ve(St.minzoom,Bt.minzoom)&&ve(St.maxzoom,Bt.maxzoom)||Ee(k,{command:"setLayerZoomRange",args:[gt,Bt.minzoom,Bt.maxzoom]}),St)Object.prototype.hasOwnProperty.call(St,Ot)&&Ot!=="layout"&&Ot!=="paint"&&Ot!=="filter"&&Ot!=="metadata"&&Ot!=="minzoom"&&Ot!=="maxzoom"&&(Ot.indexOf("paint.")===0?Pi(St[Ot],Bt[Ot],k,gt,Ot.slice(6),"setPaintProperty"):ve(St[Ot],Bt[Ot])||Ee(k,{command:"setLayerProperty",args:[gt,Ot,Bt[Ot]]}));for(Ot in Bt)Object.prototype.hasOwnProperty.call(Bt,Ot)&&!Object.prototype.hasOwnProperty.call(St,Ot)&&Ot!=="layout"&&Ot!=="paint"&&Ot!=="filter"&&Ot!=="metadata"&&Ot!=="minzoom"&&Ot!=="maxzoom"&&(Ot.indexOf("paint.")===0?Pi(St[Ot],Bt[Ot],k,gt,Ot.slice(6),"setPaintProperty"):ve(St[Ot],Bt[Ot])||Ee(k,{command:"setLayerProperty",args:[gt,Ot,Bt[Ot]]}))}else Ee(k,{command:"removeLayer",args:[gt]}),$t=nt[nt.lastIndexOf(gt)+1],Ee(k,{command:"addLayer",args:[Bt,$t]})}(S,o.layers,u)}catch(p){console.warn("Unable to compute style diff:",p),u=[{command:"setStyle",args:[o]}]}return u},c.aC=function(h){const o=[],u=h.id;return u===void 0&&o.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&o.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},c.aD=function h(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(let p=0;p<o.length;p++)if(!h(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(const p in o)if(!h(o[p],u[p]))return!1;return!0}return o===u},c.aE=qt,c.aF=zt,c.aG=class extends or{constructor(h,o){super(h,o),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.aH=ar,c.aI=class extends or{constructor(h,o){super(h,o),this.current=Ns}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let o=1;o<16;o++)if(h[o]!==this.current[o]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.aJ=$r,c.aK=class extends or{constructor(h,o){super(h,o),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.aL=class extends or{constructor(h,o){super(h,o),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.aM=Yi,c.aN=function(h,o,u,p,v,S,C){var L=1/(o-u),k=1/(p-v),j=1/(S-C);return h[0]=-2*L,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*k,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*j,h[11]=0,h[12]=(o+u)*L,h[13]=(v+p)*k,h[14]=(C+S)*j,h[15]=1,h},c.aO=Bi,c.aP=Wu,c.aQ=class extends Ic{},c.aR=HC,c.aS=class extends cl{},c.aT=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.aU=ep,c.aV=I,c.aW=class extends ru{},c.aX=bt,c.aY=function(h,o){return h[0]===o[0]&&h[1]===o[1]&&h[2]===o[2]&&h[3]===o[3]&&h[4]===o[4]&&h[5]===o[5]&&h[6]===o[6]&&h[7]===o[7]&&h[8]===o[8]&&h[9]===o[9]&&h[10]===o[10]&&h[11]===o[11]&&h[12]===o[12]&&h[13]===o[13]&&h[14]===o[14]&&h[15]===o[15]},c.aZ=function(h,o){var u=h[0],p=h[1],v=h[2],S=h[3],C=h[4],L=h[5],k=h[6],j=h[7],q=h[8],J=h[9],et=h[10],nt=h[11],lt=h[12],gt=h[13],St=h[14],Bt=h[15],$t=o[0],Ot=o[1],Ht=o[2],_e=o[3],be=o[4],He=o[5],ri=o[6],Ue=o[7],ze=o[8],Be=o[9],Ye=o[10],Oe=o[11],Ce=o[12],mi=o[13],oi=o[14],Gi=o[15];return Math.abs(u-$t)<=un*Math.max(1,Math.abs(u),Math.abs($t))&&Math.abs(p-Ot)<=un*Math.max(1,Math.abs(p),Math.abs(Ot))&&Math.abs(v-Ht)<=un*Math.max(1,Math.abs(v),Math.abs(Ht))&&Math.abs(S-_e)<=un*Math.max(1,Math.abs(S),Math.abs(_e))&&Math.abs(C-be)<=un*Math.max(1,Math.abs(C),Math.abs(be))&&Math.abs(L-He)<=un*Math.max(1,Math.abs(L),Math.abs(He))&&Math.abs(k-ri)<=un*Math.max(1,Math.abs(k),Math.abs(ri))&&Math.abs(j-Ue)<=un*Math.max(1,Math.abs(j),Math.abs(Ue))&&Math.abs(q-ze)<=un*Math.max(1,Math.abs(q),Math.abs(ze))&&Math.abs(J-Be)<=un*Math.max(1,Math.abs(J),Math.abs(Be))&&Math.abs(et-Ye)<=un*Math.max(1,Math.abs(et),Math.abs(Ye))&&Math.abs(nt-Oe)<=un*Math.max(1,Math.abs(nt),Math.abs(Oe))&&Math.abs(lt-Ce)<=un*Math.max(1,Math.abs(lt),Math.abs(Ce))&&Math.abs(gt-mi)<=un*Math.max(1,Math.abs(gt),Math.abs(mi))&&Math.abs(St-oi)<=un*Math.max(1,Math.abs(St),Math.abs(oi))&&Math.abs(Bt-Gi)<=un*Math.max(1,Math.abs(Bt),Math.abs(Gi))},c.a_=function(h,o){return h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[3],h[4]=o[4],h[5]=o[5],h[6]=o[6],h[7]=o[7],h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15],h},c.aa=function(h){const o={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,p,v,S)=>{const C=v||S;return o[p]=!C||C.toLowerCase(),""}),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o},c.ab=function(h,o){const u=[];for(const p in h)p in o||u.push(p);return u},c.ac=Mt,c.ad=function(h,o,u){var p=Math.sin(u),v=Math.cos(u),S=o[0],C=o[1],L=o[2],k=o[3],j=o[4],q=o[5],J=o[6],et=o[7];return o!==h&&(h[8]=o[8],h[9]=o[9],h[10]=o[10],h[11]=o[11],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[0]=S*v+j*p,h[1]=C*v+q*p,h[2]=L*v+J*p,h[3]=k*v+et*p,h[4]=j*v-S*p,h[5]=q*v-C*p,h[6]=J*v-L*p,h[7]=et*v-k*p,h},c.ae=function(h){var o=new Rc(16);return o[0]=h[0],o[1]=h[1],o[2]=h[2],o[3]=h[3],o[4]=h[4],o[5]=h[5],o[6]=h[6],o[7]=h[7],o[8]=h[8],o[9]=h[9],o[10]=h[10],o[11]=h[11],o[12]=h[12],o[13]=h[13],o[14]=h[14],o[15]=h[15],o},c.af=gh,c.ag=function(h,o){let u=0,p=0;if(h.kind==="constant")p=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:v,minZoom:S,maxZoom:C}=h,L=v?Mt(ss.interpolationFactor(v,o,S,C),0,1):0;h.kind==="camera"?p=gs.number(h.minSize,h.maxSize,L):u=L}return{uSizeT:u,uSize:p}},c.ai=function(h,o,u){let{uSize:p,uSizeT:v}=o,{lowerSize:S,upperSize:C}=u;return h.kind==="source"?S/Kl:h.kind==="composite"?gs.number(S/Kl,C/Kl,v):p},c.aj=u0,c.ak=function(h,o,u,p){const v=o.y-h.y,S=o.x-h.x,C=p.y-u.y,L=p.x-u.x,k=C*S-L*v;if(k===0)return null;const j=(L*(h.y-u.y)-C*(h.x-u.x))/k;return new T(h.x+j*S,h.y+j*v)},c.al=Rb,c.am=Zl,c.an=ph,c.ao=Fs,c.aq=h0,c.ar=function(h,o){var u=o[0],p=o[1],v=o[2],S=o[3],C=o[4],L=o[5],k=o[6],j=o[7],q=o[8],J=o[9],et=o[10],nt=o[11],lt=o[12],gt=o[13],St=o[14],Bt=o[15],$t=u*L-p*C,Ot=u*k-v*C,Ht=u*j-S*C,_e=p*k-v*L,be=p*j-S*L,He=v*j-S*k,ri=q*gt-J*lt,Ue=q*St-et*lt,ze=q*Bt-nt*lt,Be=J*St-et*gt,Ye=J*Bt-nt*gt,Oe=et*Bt-nt*St,Ce=$t*Oe-Ot*Ye+Ht*Be+_e*ze-be*Ue+He*ri;return Ce?(h[0]=(L*Oe-k*Ye+j*Be)*(Ce=1/Ce),h[1]=(v*Ye-p*Oe-S*Be)*Ce,h[2]=(gt*He-St*be+Bt*_e)*Ce,h[3]=(et*be-J*He-nt*_e)*Ce,h[4]=(k*ze-C*Oe-j*Ue)*Ce,h[5]=(u*Oe-v*ze+S*Ue)*Ce,h[6]=(St*Ht-lt*He-Bt*Ot)*Ce,h[7]=(q*He-et*Ht+nt*Ot)*Ce,h[8]=(C*Ye-L*ze+j*ri)*Ce,h[9]=(p*ze-u*Ye-S*ri)*Ce,h[10]=(lt*be-gt*Ht+Bt*$t)*Ce,h[11]=(J*Ht-q*be-nt*$t)*Ce,h[12]=(L*Ue-C*Be-k*ri)*Ce,h[13]=(u*Be-p*Ue+v*ri)*Ce,h[14]=(gt*Ot-lt*_e-St*$t)*Ce,h[15]=(q*_e-J*Ot+et*$t)*Ce,h):null},c.as=v0,c.at=c0,c.au=b0,c.av=function(){const h={},o=Zt.$version;for(const u in Zt.$root){const p=Zt.$root[u];if(p.required){let v=null;v=u==="version"?o:p.type==="array"?[]:{},v!=null&&(h[u]=v)}}return h},c.aw=nh,c.ax=Qt,c.ay=function(h){h=h.slice();const o=Object.create(null);for(let u=0;u<h.length;u++)o[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=Pe(h[u],o[h[u].ref]));return h},c.az=function(h){if(h.type==="custom")return new yT(h);switch(h.type){case"background":return new fT(h);case"circle":return new au(h);case"fill":return new _C(h);case"fill-extrusion":return new RC(h);case"heatmap":return new yh(h);case"hillshade":return new Hm(h);case"line":return new UC(h);case"raster":return new mT(h);case"symbol":return new Gf(h)}},c.b=te,c.b0=function(h,o){return h[0]*o[0]+h[1]*o[1]+h[2]*o[2]+h[3]*o[3]},c.b1=Nt,c.b2=Cb,c.b3=Sb,c.b4=function(h,o,u,p,v){var S,C=1/Math.tan(o/2);return h[0]=C/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=C,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,v!=null&&v!==1/0?(h[10]=(v+p)*(S=1/(p-v)),h[14]=2*v*p*S):(h[10]=-1,h[14]=-2*p),h},c.b5=function(h,o,u){var p=Math.sin(u),v=Math.cos(u),S=o[4],C=o[5],L=o[6],k=o[7],j=o[8],q=o[9],J=o[10],et=o[11];return o!==h&&(h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=o[3],h[12]=o[12],h[13]=o[13],h[14]=o[14],h[15]=o[15]),h[4]=S*v+j*p,h[5]=C*v+q*p,h[6]=L*v+J*p,h[7]=k*v+et*p,h[8]=j*v-S*p,h[9]=q*v-C*p,h[10]=J*v-L*p,h[11]=et*v-k*p,h},c.b6=ct,c.b7=yt,c.b8=function(h){return h*Math.PI/180},c.b9=function(h,o){return h[0]=o[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=o[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=o[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.bA=Ko,c.ba=class extends vs{},c.bb=g0,c.bc=PT,c.be=ie,c.bf=function(h,o){Ut.REGISTERED_PROTOCOLS[h]=o},c.bg=function(h){delete Ut.REGISTERED_PROTOCOLS[h]},c.bh=function(h,o){const u={};for(let v=0;v<h.length;v++){const S=o&&o[h[v].id]||Xh(h[v]);o&&(o[h[v].id]=S);let C=u[S];C||(C=u[S]=[]),C.push(h[v])}const p=[];for(const v in u)p.push(u[v]);return p},c.bi=We,c.bj=Pb,c.bk=Mb,c.bl=lb,c.bm=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=br/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const o=h.bucket.layers[0],u=o.layout,p=o._unevaluatedLayout._values,v={layoutIconSize:p["icon-size"].possiblyEvaluate(new Cr(h.bucket.zoom+1),h.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Cr(h.bucket.zoom+1),h.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Cr(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:q}=h.bucket.textSizeData;v.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Cr(j),h.canonical),p["text-size"].possiblyEvaluate(new Cr(q),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:q}=h.bucket.iconSizeData;v.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Cr(j),h.canonical),p["icon-size"].possiblyEvaluate(new Cr(q),h.canonical)]}const S=u.get("text-line-height")*Fs,C=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",L=u.get("text-keep-upright"),k=u.get("text-size");for(const j of h.bucket.features){const q=u.get("text-font").evaluate(j,{},h.canonical).join(","),J=k.evaluate(j,{},h.canonical),et=v.layoutTextSize.evaluate(j,{},h.canonical),nt=v.layoutIconSize.evaluate(j,{},h.canonical),lt={horizontal:{},vertical:void 0},gt=j.text;let St,Bt=[0,0];if(gt){const Ht=gt.toString(),_e=u.get("text-letter-spacing").evaluate(j,{},h.canonical)*Fs,be=En(Ht)?_e:0,He=u.get("text-anchor").evaluate(j,{},h.canonical),ri=Gb(o,j,h.canonical);if(!ri){const Oe=u.get("text-radial-offset").evaluate(j,{},h.canonical);Bt=Oe?Ub(He,[Oe*Fs,_0]):u.get("text-offset").evaluate(j,{},h.canonical).map(Ce=>Ce*Fs)}let Ue=C?"center":u.get("text-justify").evaluate(j,{},h.canonical);const ze=u.get("symbol-placement"),Be=ze==="point"?u.get("text-max-width").evaluate(j,{},h.canonical)*Fs:0,Ye=()=>{h.bucket.allowVerticalPlacement&&Es(Ht)&&(lt.vertical=zf(gt,h.glyphMap,h.glyphPositions,h.imagePositions,q,Be,S,He,"left",be,Bt,c.ah.vertical,!0,ze,et,J))};if(!C&&ri){const Oe=new Set;if(Ue==="auto")for(let mi=0;mi<ri.values.length;mi+=2)Oe.add(v0(ri.values[mi]));else Oe.add(Ue);let Ce=!1;for(const mi of Oe)if(!lt.horizontal[mi])if(Ce)lt.horizontal[mi]=lt.horizontal[0];else{const oi=zf(gt,h.glyphMap,h.glyphPositions,h.imagePositions,q,Be,S,"center",mi,be,Bt,c.ah.horizontal,!1,ze,et,J);oi&&(lt.horizontal[mi]=oi,Ce=oi.positionedLines.length===1)}Ye()}else{Ue==="auto"&&(Ue=v0(He));const Oe=zf(gt,h.glyphMap,h.glyphPositions,h.imagePositions,q,Be,S,He,Ue,be,Bt,c.ah.horizontal,!1,ze,et,J);Oe&&(lt.horizontal[Ue]=Oe),Ye(),Es(Ht)&&C&&L&&(lt.vertical=zf(gt,h.glyphMap,h.glyphPositions,h.imagePositions,q,Be,S,He,Ue,be,Bt,c.ah.vertical,!1,ze,et,J))}}let $t=!1;if(j.icon&&j.icon.name){const Ht=h.imageMap[j.icon.name];Ht&&(St=cT(h.imagePositions[j.icon.name],u.get("icon-offset").evaluate(j,{},h.canonical),u.get("icon-anchor").evaluate(j,{},h.canonical)),$t=!!Ht.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=$t:h.bucket.sdfIcons!==$t&&Lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ht.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Ot=qb(lt.horizontal)||lt.vertical;h.bucket.iconsInText=!!Ot&&Ot.iconsInText,(Ot||St)&&CT(h.bucket,j,lt,St,h.imageMap,v,et,nt,Bt,$t,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.bn=r0,c.bo=t0,c.bp=i0,c.bq=vh,c.br=n0,c.bs=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.bt=function(h,o,u,p,v){return l(this,void 0,void 0,function*(){if($())try{return yield ge(h,o,u,p,v)}catch{}return function(S,C,L,k,j){const q=S.width,J=S.height;ke&&it||(ke=new OffscreenCanvas(q,J),it=ke.getContext("2d",{willReadFrequently:!0})),ke.width=q,ke.height=J,it.drawImage(S,0,0,q,J);const et=it.getImageData(C,L,k,j);return it.clearRect(0,0,q,J),et.data}(h,o,u,p,v)})},c.bu=Tb,c.bv=f,c.bw=y,c.bx=Qv,c.by=Vr,c.bz=function(h){return h.message===Et},c.c=It,c.d=h=>l(void 0,void 0,void 0,function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(o)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=Rt,c.f=h=>new Promise((o,u)=>{const p=new Image;p.onload=()=>{o(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=me})},p.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(h)],{type:"image/png"});p.src=h.byteLength?URL.createObjectURL(v):me}),c.g=Xt,c.h=(h,o)=>Ae(Rt(h,{type:"json"}),o),c.i=oe,c.j=pe,c.k=Xe,c.l=(h,o)=>Ae(Rt(h,{type:"arrayBuffer"}),o),c.m=Ae,c.n=function(h){return new n0(h).readFields(rT,[])},c.o=mh,c.p=ab,c.q=Cs,c.r=Xo,c.s=Le,c.t=$o,c.u=Ne,c.v=Zt,c.w=Lt,c.x=Dr,c.y=function(h){let[o,u,p]=h;return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},c.z=gs}),s("worker",["./shared"],function(c){class l{constructor(K){this.keyCache={},K&&this.replace(K)}replace(K){this._layerConfigs={},this._layers={},this.update(K,[])}update(K,Y){for(const _t of K){this._layerConfigs[_t.id]=_t;const kt=this._layers[_t.id]=c.az(_t);kt._featureFilter=c.a6(kt.filter),this.keyCache[_t.id]&&delete this.keyCache[_t.id]}for(const _t of Y)delete this.keyCache[_t],delete this._layerConfigs[_t],delete this._layers[_t];this.familiesBySource={};const st=c.bh(Object.values(this._layerConfigs),this.keyCache);for(const _t of st){const kt=_t.map(he=>this._layers[he.id]),Ft=kt[0];if(Ft.visibility==="none")continue;const Vt=Ft.source||"";let At=this.familiesBySource[Vt];At||(At=this.familiesBySource[Vt]={});const Jt=Ft.sourceLayer||"_geojsonTileLayer";let ye=At[Jt];ye||(ye=At[Jt]=[]),ye.push(kt)}}}class f{constructor(K){const Y={},st=[];for(const Vt in K){const At=K[Vt],Jt=Y[Vt]={};for(const ye in At){const he=At[+ye];if(!he||he.bitmap.width===0||he.bitmap.height===0)continue;const ae={x:0,y:0,w:he.bitmap.width+2,h:he.bitmap.height+2};st.push(ae),Jt[ye]={rect:ae,metrics:he.metrics}}}const{w:_t,h:kt}=c.p(st),Ft=new c.o({width:_t||1,height:kt||1});for(const Vt in K){const At=K[Vt];for(const Jt in At){const ye=At[+Jt];if(!ye||ye.bitmap.width===0||ye.bitmap.height===0)continue;const he=Y[Vt][Jt].rect;c.o.copy(ye.bitmap,Ft,{x:0,y:0},{x:he.x+1,y:he.y+1},ye.bitmap)}}this.image=Ft,this.positions=Y}}c.bi("GlyphAtlas",f);class y{constructor(K){this.tileID=new c.Q(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[]}parse(K,Y,st,_t){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new c.a4;const kt=new c.bj(Object.keys(K.layers).sort()),Ft=new c.bk(this.tileID,this.promoteId);Ft.bucketLayerIDs=[];const Vt={},At={featureIndex:Ft,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:st},Jt=Y.familiesBySource[this.source];for(const li in Jt){const ji=K.layers[li];if(!ji)continue;ji.version===1&&c.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ur=kt.encode(li),Mr=[];for(let Ur=0;Ur<ji.length;Ur++){const Er=ji.feature(Ur),ks=Ft.getId(Er,li);Mr.push({feature:Er,id:ks,index:Ur,sourceLayerIndex:ur})}for(const Ur of Jt[li]){const Er=Ur[0];Er.source!==this.source&&c.w(`layer.source = ${Er.source} does not equal this.source = ${this.source}`),Er.minzoom&&this.zoom<Math.floor(Er.minzoom)||Er.maxzoom&&this.zoom>=Er.maxzoom||Er.visibility!=="none"&&(x(Ur,this.zoom,st),(Vt[Er.id]=Er.createBucket({index:Ft.bucketLayerIDs.length,layers:Ur,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ur,sourceID:this.source})).populate(Mr,At,this.tileID.canonical),Ft.bucketLayerIDs.push(Ur.map(ks=>ks.id)))}}const ye=c.aE(At.glyphDependencies,li=>Object.keys(li).map(Number));this.inFlightDependencies.forEach(li=>li==null?void 0:li.abort()),this.inFlightDependencies=[];let he=Promise.resolve({});if(Object.keys(ye).length){const li=new AbortController;this.inFlightDependencies.push(li),he=_t.sendAsync({type:"GG",data:{stacks:ye,source:this.source,tileID:this.tileID,type:"glyphs"}},li)}const ae=Object.keys(At.iconDependencies);let qe=Promise.resolve({});if(ae.length){const li=new AbortController;this.inFlightDependencies.push(li),qe=_t.sendAsync({type:"GI",data:{icons:ae,source:this.source,tileID:this.tileID,type:"icons"}},li)}const Je=Object.keys(At.patternDependencies);let bi=Promise.resolve({});if(Je.length){const li=new AbortController;this.inFlightDependencies.push(li),bi=_t.sendAsync({type:"GI",data:{icons:Je,source:this.source,tileID:this.tileID,type:"patterns"}},li)}const[si,Si,Ni]=yield Promise.all([he,qe,bi]),Hi=new f(si),nr=new c.bl(Si,Ni);for(const li in Vt){const ji=Vt[li];ji instanceof c.a5?(x(ji.layers,this.zoom,st),c.bm({bucket:ji,glyphMap:si,glyphPositions:Hi.positions,imageMap:Si,imagePositions:nr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ji.hasPattern&&(ji instanceof c.bn||ji instanceof c.bo||ji instanceof c.bp)&&(x(ji.layers,this.zoom,st),ji.addFeatures(At,this.tileID.canonical,nr.patternPositions))}return this.status="done",{buckets:Object.values(Vt).filter(li=>!li.isEmpty()),featureIndex:Ft,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hi.image,imageAtlas:nr,glyphMap:this.returnDependencies?si:null,iconMap:this.returnDependencies?Si:null,glyphPositions:this.returnDependencies?Hi.positions:null}})}}function x(vt,K,Y){const st=new c.a8(K);for(const _t of vt)_t.recalculate(st,Y)}class T{constructor(K,Y,st){this.actor=K,this.layerIndex=Y,this.availableImages=st,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(K,Y){return c._(this,void 0,void 0,function*(){const st=yield c.l(K.request,Y);try{return{vectorTile:new c.bq.VectorTile(new c.br(st.data)),rawData:st.data,cacheControl:st.cacheControl,expires:st.expires}}catch(_t){const kt=new Uint8Array(st.data);let Ft=`Unable to parse the tile at ${K.request.url}, `;throw Ft+=kt[0]===31&&kt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${_t.messge}`,new Error(Ft)}})}loadTile(K){return c._(this,void 0,void 0,function*(){const Y=K.uid,st=!!(K&&K.request&&K.request.collectResourceTiming)&&new c.bs(K.request),_t=new y(K);this.loading[Y]=_t;const kt=new AbortController;_t.abort=kt;try{const Ft=yield this.loadVectorTile(K,kt);if(delete this.loading[Y],!Ft)return null;const Vt=Ft.rawData,At={};Ft.expires&&(At.expires=Ft.expires),Ft.cacheControl&&(At.cacheControl=Ft.cacheControl);const Jt={};if(st){const he=st.finish();he&&(Jt.resourceTiming=JSON.parse(JSON.stringify(he)))}_t.vectorTile=Ft.vectorTile;const ye=_t.parse(Ft.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Y]=_t,this.fetching[Y]={rawTileData:Vt,cacheControl:At,resourceTiming:Jt};try{const he=yield ye;return c.e({rawTileData:Vt.slice(0)},he,At,Jt)}finally{delete this.fetching[Y]}}catch(Ft){throw delete this.loading[Y],_t.status="done",this.loaded[Y]=_t,Ft}})}reloadTile(K){return c._(this,void 0,void 0,function*(){const Y=K.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const st=this.loaded[Y];if(st.showCollisionBoxes=K.showCollisionBoxes,st.status==="parsing"){const _t=yield st.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor);let kt;if(this.fetching[Y]){const{rawTileData:Ft,cacheControl:Vt,resourceTiming:At}=this.fetching[Y];delete this.fetching[Y],kt=c.e({rawTileData:Ft.slice(0)},_t,Vt,At)}else kt=_t;return kt}if(st.status==="done"&&st.vectorTile)return st.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(K){return c._(this,void 0,void 0,function*(){const Y=this.loading,st=K.uid;Y&&Y[st]&&Y[st].abort&&(Y[st].abort.abort(),delete Y[st])})}removeTile(K){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]})}}class P{constructor(){this.loaded={}}loadTile(K){return c._(this,void 0,void 0,function*(){const{uid:Y,encoding:st,rawImageData:_t,redFactor:kt,greenFactor:Ft,blueFactor:Vt,baseShift:At}=K,Jt=_t.width+2,ye=_t.height+2,he=c.b(_t)?new c.R({width:Jt,height:ye},yield c.bt(_t,-1,-1,Jt,ye)):_t,ae=new c.bu(Y,he,st,kt,Ft,Vt,At);return this.loaded=this.loaded||{},this.loaded[Y]=ae,ae})}removeTile(K){const Y=this.loaded,st=K.uid;Y&&Y[st]&&delete Y[st]}}function M(vt,K){if(vt.length!==0){N(vt[0],K);for(var Y=1;Y<vt.length;Y++)N(vt[Y],!K)}}function N(vt,K){for(var Y=0,st=0,_t=0,kt=vt.length,Ft=kt-1;_t<kt;Ft=_t++){var Vt=(vt[_t][0]-vt[Ft][0])*(vt[Ft][1]+vt[_t][1]),At=Y+Vt;st+=Math.abs(Y)>=Math.abs(Vt)?Y-At+Vt:Vt-At+Y,Y=At}Y+st>=0!=!!K&&vt.reverse()}var G=c.bv(function vt(K,Y){var st,_t=K&&K.type;if(_t==="FeatureCollection")for(st=0;st<K.features.length;st++)vt(K.features[st],Y);else if(_t==="GeometryCollection")for(st=0;st<K.geometries.length;st++)vt(K.geometries[st],Y);else if(_t==="Feature")vt(K.geometry,Y);else if(_t==="Polygon")M(K.coordinates,Y);else if(_t==="MultiPolygon")for(st=0;st<K.coordinates.length;st++)M(K.coordinates[st],Y);return K});const Z=c.bq.VectorTileFeature.prototype.toGeoJSON;var X={exports:{}},$=c.bw,ct=c.bq.VectorTileFeature,yt=Mt;function Mt(vt,K){this.options=K||{},this.features=vt,this.length=vt.length}function Nt(vt,K){this.id=typeof vt.id=="number"?vt.id:void 0,this.type=vt.type,this.rawGeometry=vt.type===1?[vt.geometry]:vt.geometry,this.properties=vt.tags,this.extent=K||4096}Mt.prototype.feature=function(vt){return new Nt(this.features[vt],this.options.extent)},Nt.prototype.loadGeometry=function(){var vt=this.rawGeometry;this.geometry=[];for(var K=0;K<vt.length;K++){for(var Y=vt[K],st=[],_t=0;_t<Y.length;_t++)st.push(new $(Y[_t][0],Y[_t][1]));this.geometry.push(st)}return this.geometry},Nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var vt=this.geometry,K=1/0,Y=-1/0,st=1/0,_t=-1/0,kt=0;kt<vt.length;kt++)for(var Ft=vt[kt],Vt=0;Vt<Ft.length;Vt++){var At=Ft[Vt];K=Math.min(K,At.x),Y=Math.max(Y,At.x),st=Math.min(st,At.y),_t=Math.max(_t,At.y)}return[K,st,Y,_t]},Nt.prototype.toGeoJSON=ct.prototype.toGeoJSON;var Rt=c.bx,xt=yt;function qt(vt){var K=new Rt;return function(Y,st){for(var _t in Y.layers)st.writeMessage(3,zt,Y.layers[_t])}(vt,K),K.finish()}function zt(vt,K){var Y;K.writeVarintField(15,vt.version||1),K.writeStringField(1,vt.name||""),K.writeVarintField(5,vt.extent||4096);var st={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<vt.length;Y++)st.feature=vt.feature(Y),K.writeMessage(2,ot,st);var _t=st.keys;for(Y=0;Y<_t.length;Y++)K.writeStringField(3,_t[Y]);var kt=st.values;for(Y=0;Y<kt.length;Y++)K.writeMessage(4,oe,kt[Y])}function ot(vt,K){var Y=vt.feature;Y.id!==void 0&&K.writeVarintField(1,Y.id),K.writeMessage(2,dt,vt),K.writeVarintField(3,Y.type),K.writeMessage(4,le,Y)}function dt(vt,K){var Y=vt.feature,st=vt.keys,_t=vt.values,kt=vt.keycache,Ft=vt.valuecache;for(var Vt in Y.properties){var At=Y.properties[Vt],Jt=kt[Vt];if(At!==null){Jt===void 0&&(st.push(Vt),kt[Vt]=Jt=st.length-1),K.writeVarint(Jt);var ye=typeof At;ye!=="string"&&ye!=="boolean"&&ye!=="number"&&(At=JSON.stringify(At));var he=ye+":"+At,ae=Ft[he];ae===void 0&&(_t.push(At),Ft[he]=ae=_t.length-1),K.writeVarint(ae)}}}function Lt(vt,K){return(K<<3)+(7&vt)}function wt(vt){return vt<<1^vt>>31}function le(vt,K){for(var Y=vt.loadGeometry(),st=vt.type,_t=0,kt=0,Ft=Y.length,Vt=0;Vt<Ft;Vt++){var At=Y[Vt],Jt=1;st===1&&(Jt=At.length),K.writeVarint(Lt(1,Jt));for(var ye=st===3?At.length-1:At.length,he=0;he<ye;he++){he===1&&st!==1&&K.writeVarint(Lt(2,ye-1));var ae=At[he].x-_t,qe=At[he].y-kt;K.writeVarint(wt(ae)),K.writeVarint(wt(qe)),_t+=ae,kt+=qe}st===3&&K.writeVarint(Lt(7,1))}}function oe(vt,K){var Y=typeof vt;Y==="string"?K.writeStringField(1,vt):Y==="boolean"?K.writeBooleanField(7,vt):Y==="number"&&(vt%1!=0?K.writeDoubleField(3,vt):vt<0?K.writeSVarintField(6,vt):K.writeVarintField(5,vt))}X.exports=qt,X.exports.fromVectorTileJs=qt,X.exports.fromGeojsonVt=function(vt,K){K=K||{};var Y={};for(var st in vt)Y[st]=new xt(vt[st].features,K),Y[st].name=st,Y[st].version=K.version,Y[st].extent=K.extent;return qt({layers:Y})},X.exports.GeoJSONWrapper=xt;var de=c.bv(X.exports);const te={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vt=>vt},me=Math.fround||(ge=new Float32Array(1),vt=>(ge[0]=+vt,ge[0]));var ge;const ke=3,it=5,Et=6;class It{constructor(K){this.options=Object.assign(Object.create(te),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:Y,minZoom:st,maxZoom:_t}=this.options;Y&&console.time("total time");const kt=`prepare ${K.length} points`;Y&&console.time(kt),this.points=K;const Ft=[];for(let At=0;At<K.length;At++){const Jt=K[At];if(!Jt.geometry)continue;const[ye,he]=Jt.geometry.coordinates,ae=me(Kt(ye)),qe=me(ie(he));Ft.push(ae,qe,1/0,At,-1,1),this.options.reduce&&Ft.push(0)}let Vt=this.trees[_t+1]=this._createTree(Ft);Y&&console.timeEnd(kt);for(let At=_t;At>=st;At--){const Jt=+Date.now();Vt=this.trees[At]=this._createTree(this._cluster(Vt,At)),Y&&console.log("z%d: %d clusters in %dms",At,Vt.numItems,+Date.now()-Jt)}return Y&&console.timeEnd("total time"),this}getClusters(K,Y){let st=((K[0]+180)%360+360)%360-180;const _t=Math.max(-90,Math.min(90,K[1]));let kt=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Ft=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)st=-180,kt=180;else if(st>kt){const he=this.getClusters([st,_t,180,Ft],Y),ae=this.getClusters([-180,_t,kt,Ft],Y);return he.concat(ae)}const Vt=this.trees[this._limitZoom(Y)],At=Vt.range(Kt(st),ie(Ft),Kt(kt),ie(_t)),Jt=Vt.data,ye=[];for(const he of At){const ae=this.stride*he;ye.push(Jt[ae+it]>1?Ut(Jt,ae,this.clusterProps):this.points[Jt[ae+ke]])}return ye}getChildren(K){const Y=this._getOriginId(K),st=this._getOriginZoom(K),_t="No cluster with the specified id.",kt=this.trees[st];if(!kt)throw new Error(_t);const Ft=kt.data;if(Y*this.stride>=Ft.length)throw new Error(_t);const Vt=this.options.radius/(this.options.extent*Math.pow(2,st-1)),At=kt.within(Ft[Y*this.stride],Ft[Y*this.stride+1],Vt),Jt=[];for(const ye of At){const he=ye*this.stride;Ft[he+4]===K&&Jt.push(Ft[he+it]>1?Ut(Ft,he,this.clusterProps):this.points[Ft[he+ke]])}if(Jt.length===0)throw new Error(_t);return Jt}getLeaves(K,Y,st){const _t=[];return this._appendLeaves(_t,K,Y=Y||10,st=st||0,0),_t}getTile(K,Y,st){const _t=this.trees[this._limitZoom(K)],kt=Math.pow(2,K),{extent:Ft,radius:Vt}=this.options,At=Vt/Ft,Jt=(st-At)/kt,ye=(st+1+At)/kt,he={features:[]};return this._addTileFeatures(_t.range((Y-At)/kt,Jt,(Y+1+At)/kt,ye),_t.data,Y,st,kt,he),Y===0&&this._addTileFeatures(_t.range(1-At/kt,Jt,1,ye),_t.data,kt,st,kt,he),Y===kt-1&&this._addTileFeatures(_t.range(0,Jt,At/kt,ye),_t.data,-1,st,kt,he),he.features.length?he:null}getClusterExpansionZoom(K){let Y=this._getOriginZoom(K)-1;for(;Y<=this.options.maxZoom;){const st=this.getChildren(K);if(Y++,st.length!==1)break;K=st[0].properties.cluster_id}return Y}_appendLeaves(K,Y,st,_t,kt){const Ft=this.getChildren(Y);for(const Vt of Ft){const At=Vt.properties;if(At&&At.cluster?kt+At.point_count<=_t?kt+=At.point_count:kt=this._appendLeaves(K,At.cluster_id,st,_t,kt):kt<_t?kt++:K.push(Vt),K.length===st)break}return kt}_createTree(K){const Y=new c.au(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let st=0;st<K.length;st+=this.stride)Y.add(K[st],K[st+1]);return Y.finish(),Y.data=K,Y}_addTileFeatures(K,Y,st,_t,kt,Ft){for(const Vt of K){const At=Vt*this.stride,Jt=Y[At+it]>1;let ye,he,ae;if(Jt)ye=Xt(Y,At,this.clusterProps),he=Y[At],ae=Y[At+1];else{const bi=this.points[Y[At+ke]];ye=bi.properties;const[si,Si]=bi.geometry.coordinates;he=Kt(si),ae=ie(Si)}const qe={type:1,geometry:[[Math.round(this.options.extent*(he*kt-st)),Math.round(this.options.extent*(ae*kt-_t))]],tags:ye};let Je;Je=Jt||this.options.generateId?Y[At+ke]:this.points[Y[At+ke]].id,Je!==void 0&&(qe.id=Je),Ft.features.push(qe)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,Y){const{radius:st,extent:_t,reduce:kt,minPoints:Ft}=this.options,Vt=st/(_t*Math.pow(2,Y)),At=K.data,Jt=[],ye=this.stride;for(let he=0;he<At.length;he+=ye){if(At[he+2]<=Y)continue;At[he+2]=Y;const ae=At[he],qe=At[he+1],Je=K.within(At[he],At[he+1],Vt),bi=At[he+it];let si=bi;for(const Si of Je){const Ni=Si*ye;At[Ni+2]>Y&&(si+=At[Ni+it])}if(si>bi&&si>=Ft){let Si,Ni=ae*bi,Hi=qe*bi,nr=-1;const li=((he/ye|0)<<5)+(Y+1)+this.points.length;for(const ji of Je){const ur=ji*ye;if(At[ur+2]<=Y)continue;At[ur+2]=Y;const Mr=At[ur+it];Ni+=At[ur]*Mr,Hi+=At[ur+1]*Mr,At[ur+4]=li,kt&&(Si||(Si=this._map(At,he,!0),nr=this.clusterProps.length,this.clusterProps.push(Si)),kt(Si,this._map(At,ur)))}At[he+4]=li,Jt.push(Ni/si,Hi/si,1/0,li,-1,si),kt&&Jt.push(nr)}else{for(let Si=0;Si<ye;Si++)Jt.push(At[he+Si]);if(si>1)for(const Si of Je){const Ni=Si*ye;if(!(At[Ni+2]<=Y)){At[Ni+2]=Y;for(let Hi=0;Hi<ye;Hi++)Jt.push(At[Ni+Hi])}}}}return Jt}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,Y,st){if(K[Y+it]>1){const Ft=this.clusterProps[K[Y+Et]];return st?Object.assign({},Ft):Ft}const _t=this.points[K[Y+ke]].properties,kt=this.options.map(_t);return st&&kt===_t?Object.assign({},kt):kt}}function Ut(vt,K,Y){return{type:"Feature",id:vt[K+ke],properties:Xt(vt,K,Y),geometry:{type:"Point",coordinates:[(st=vt[K],360*(st-.5)),Qt(vt[K+1])]}};var st}function Xt(vt,K,Y){const st=vt[K+it],_t=st>=1e4?`${Math.round(st/1e3)}k`:st>=1e3?Math.round(st/100)/10+"k":st,kt=vt[K+Et],Ft=kt===-1?{}:Object.assign({},Y[kt]);return Object.assign(Ft,{cluster:!0,cluster_id:vt[K+ke],point_count:st,point_count_abbreviated:_t})}function Kt(vt){return vt/360+.5}function ie(vt){const K=Math.sin(vt*Math.PI/180),Y=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Y<0?0:Y>1?1:Y}function Qt(vt){const K=(180-360*vt)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function Ae(vt,K,Y,st){for(var _t,kt=st,Ft=Y-K>>1,Vt=Y-K,At=vt[K],Jt=vt[K+1],ye=vt[Y],he=vt[Y+1],ae=K+3;ae<Y;ae+=3){var qe=Le(vt[ae],vt[ae+1],At,Jt,ye,he);if(qe>kt)_t=ae,kt=qe;else if(qe===kt){var Je=Math.abs(ae-Ft);Je<Vt&&(_t=ae,Vt=Je)}}kt>st&&(_t-K>3&&Ae(vt,K,_t,st),vt[_t+2]=kt,Y-_t>3&&Ae(vt,_t,Y,st))}function Le(vt,K,Y,st,_t,kt){var Ft=_t-Y,Vt=kt-st;if(Ft!==0||Vt!==0){var At=((vt-Y)*Ft+(K-st)*Vt)/(Ft*Ft+Vt*Vt);At>1?(Y=_t,st=kt):At>0&&(Y+=Ft*At,st+=Vt*At)}return(Ft=vt-Y)*Ft+(Vt=K-st)*Vt}function Fe(vt,K,Y,st){var _t={id:vt===void 0?null:vt,type:K,geometry:Y,tags:st,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(kt){var Ft=kt.geometry,Vt=kt.type;if(Vt==="Point"||Vt==="MultiPoint"||Vt==="LineString")Ge(kt,Ft);else if(Vt==="Polygon"||Vt==="MultiLineString")for(var At=0;At<Ft.length;At++)Ge(kt,Ft[At]);else if(Vt==="MultiPolygon")for(At=0;At<Ft.length;At++)for(var Jt=0;Jt<Ft[At].length;Jt++)Ge(kt,Ft[At][Jt])}(_t),_t}function Ge(vt,K){for(var Y=0;Y<K.length;Y+=3)vt.minX=Math.min(vt.minX,K[Y]),vt.minY=Math.min(vt.minY,K[Y+1]),vt.maxX=Math.max(vt.maxX,K[Y]),vt.maxY=Math.max(vt.maxY,K[Y+1])}function Xe(vt,K,Y,st){if(K.geometry){var _t=K.geometry.coordinates,kt=K.geometry.type,Ft=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),Vt=[],At=K.id;if(Y.promoteId?At=K.properties[Y.promoteId]:Y.generateId&&(At=st||0),kt==="Point")pe(_t,Vt);else if(kt==="MultiPoint")for(var Jt=0;Jt<_t.length;Jt++)pe(_t[Jt],Vt);else if(kt==="LineString")Pt(_t,Vt,Ft,!1);else if(kt==="MultiLineString"){if(Y.lineMetrics){for(Jt=0;Jt<_t.length;Jt++)Pt(_t[Jt],Vt=[],Ft,!1),vt.push(Fe(At,"LineString",Vt,K.properties));return}Zt(_t,Vt,Ft,!1)}else if(kt==="Polygon")Zt(_t,Vt,Ft,!0);else{if(kt!=="MultiPolygon"){if(kt==="GeometryCollection"){for(Jt=0;Jt<K.geometry.geometries.length;Jt++)Xe(vt,{id:At,geometry:K.geometry.geometries[Jt],properties:K.properties},Y,st);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Jt=0;Jt<_t.length;Jt++){var ye=[];Zt(_t[Jt],ye,Ft,!0),Vt.push(ye)}}vt.push(Fe(At,kt,Vt,K.properties))}}function pe(vt,K){K.push(ii(vt[0])),K.push(Pe(vt[1])),K.push(0)}function Pt(vt,K,Y,st){for(var _t,kt,Ft=0,Vt=0;Vt<vt.length;Vt++){var At=ii(vt[Vt][0]),Jt=Pe(vt[Vt][1]);K.push(At),K.push(Jt),K.push(0),Vt>0&&(Ft+=st?(_t*Jt-At*kt)/2:Math.sqrt(Math.pow(At-_t,2)+Math.pow(Jt-kt,2))),_t=At,kt=Jt}var ye=K.length-3;K[2]=1,Ae(K,0,ye,Y),K[ye+2]=1,K.size=Math.abs(Ft),K.start=0,K.end=K.size}function Zt(vt,K,Y,st){for(var _t=0;_t<vt.length;_t++){var kt=[];Pt(vt[_t],kt,Y,st),K.push(kt)}}function ii(vt){return vt/360+.5}function Pe(vt){var K=Math.sin(vt*Math.PI/180),Y=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Y<0?0:Y>1?1:Y}function ve(vt,K,Y,st,_t,kt,Ft,Vt){if(st/=K,kt>=(Y/=K)&&Ft<st)return vt;if(Ft<Y||kt>=st)return null;for(var At=[],Jt=0;Jt<vt.length;Jt++){var ye=vt[Jt],he=ye.geometry,ae=ye.type,qe=_t===0?ye.minX:ye.minY,Je=_t===0?ye.maxX:ye.maxY;if(qe>=Y&&Je<st)At.push(ye);else if(!(Je<Y||qe>=st)){var bi=[];if(ae==="Point"||ae==="MultiPoint")Ee(he,bi,Y,st,_t);else if(ae==="LineString")Ve(he,bi,Y,st,_t,!1,Vt.lineMetrics);else if(ae==="MultiLineString")Ai(he,bi,Y,st,_t,!1);else if(ae==="Polygon")Ai(he,bi,Y,st,_t,!0);else if(ae==="MultiPolygon")for(var si=0;si<he.length;si++){var Si=[];Ai(he[si],Si,Y,st,_t,!0),Si.length&&bi.push(Si)}if(bi.length){if(Vt.lineMetrics&&ae==="LineString"){for(si=0;si<bi.length;si++)At.push(Fe(ye.id,ae,bi[si],ye.tags));continue}ae!=="LineString"&&ae!=="MultiLineString"||(bi.length===1?(ae="LineString",bi=bi[0]):ae="MultiLineString"),ae!=="Point"&&ae!=="MultiPoint"||(ae=bi.length===3?"Point":"MultiPoint"),At.push(Fe(ye.id,ae,bi,ye.tags))}}}return At.length?At:null}function Ee(vt,K,Y,st,_t){for(var kt=0;kt<vt.length;kt+=3){var Ft=vt[kt+_t];Ft>=Y&&Ft<=st&&(K.push(vt[kt]),K.push(vt[kt+1]),K.push(vt[kt+2]))}}function Ve(vt,K,Y,st,_t,kt,Ft){for(var Vt,At,Jt=ai(vt),ye=_t===0?Pi:qi,he=vt.start,ae=0;ae<vt.length-3;ae+=3){var qe=vt[ae],Je=vt[ae+1],bi=vt[ae+2],si=vt[ae+3],Si=vt[ae+4],Ni=_t===0?qe:Je,Hi=_t===0?si:Si,nr=!1;Ft&&(Vt=Math.sqrt(Math.pow(qe-si,2)+Math.pow(Je-Si,2))),Ni<Y?Hi>Y&&(At=ye(Jt,qe,Je,si,Si,Y),Ft&&(Jt.start=he+Vt*At)):Ni>st?Hi<st&&(At=ye(Jt,qe,Je,si,Si,st),Ft&&(Jt.start=he+Vt*At)):Ti(Jt,qe,Je,bi),Hi<Y&&Ni>=Y&&(At=ye(Jt,qe,Je,si,Si,Y),nr=!0),Hi>st&&Ni<=st&&(At=ye(Jt,qe,Je,si,Si,st),nr=!0),!kt&&nr&&(Ft&&(Jt.end=he+Vt*At),K.push(Jt),Jt=ai(vt)),Ft&&(he+=Vt)}var li=vt.length-3;qe=vt[li],Je=vt[li+1],bi=vt[li+2],(Ni=_t===0?qe:Je)>=Y&&Ni<=st&&Ti(Jt,qe,Je,bi),li=Jt.length-3,kt&&li>=3&&(Jt[li]!==Jt[0]||Jt[li+1]!==Jt[1])&&Ti(Jt,Jt[0],Jt[1],Jt[2]),Jt.length&&K.push(Jt)}function ai(vt){var K=[];return K.size=vt.size,K.start=vt.start,K.end=vt.end,K}function Ai(vt,K,Y,st,_t,kt){for(var Ft=0;Ft<vt.length;Ft++)Ve(vt[Ft],K,Y,st,_t,kt,!1)}function Ti(vt,K,Y,st){vt.push(K),vt.push(Y),vt.push(st)}function Pi(vt,K,Y,st,_t,kt){var Ft=(kt-K)/(st-K);return vt.push(kt),vt.push(Y+(_t-Y)*Ft),vt.push(1),Ft}function qi(vt,K,Y,st,_t,kt){var Ft=(kt-Y)/(_t-Y);return vt.push(K+(st-K)*Ft),vt.push(kt),vt.push(1),Ft}function Ji(vt,K){for(var Y=[],st=0;st<vt.length;st++){var _t,kt=vt[st],Ft=kt.type;if(Ft==="Point"||Ft==="MultiPoint"||Ft==="LineString")_t=ce(kt.geometry,K);else if(Ft==="MultiLineString"||Ft==="Polygon"){_t=[];for(var Vt=0;Vt<kt.geometry.length;Vt++)_t.push(ce(kt.geometry[Vt],K))}else if(Ft==="MultiPolygon")for(_t=[],Vt=0;Vt<kt.geometry.length;Vt++){for(var At=[],Jt=0;Jt<kt.geometry[Vt].length;Jt++)At.push(ce(kt.geometry[Vt][Jt],K));_t.push(At)}Y.push(Fe(kt.id,Ft,_t,kt.tags))}return Y}function ce(vt,K){var Y=[];Y.size=vt.size,vt.start!==void 0&&(Y.start=vt.start,Y.end=vt.end);for(var st=0;st<vt.length;st+=3)Y.push(vt[st]+K,vt[st+1],vt[st+2]);return Y}function Ei(vt,K){if(vt.transformed)return vt;var Y,st,_t,kt=1<<vt.z,Ft=vt.x,Vt=vt.y;for(Y=0;Y<vt.features.length;Y++){var At=vt.features[Y],Jt=At.geometry,ye=At.type;if(At.geometry=[],ye===1)for(st=0;st<Jt.length;st+=2)At.geometry.push(Re(Jt[st],Jt[st+1],K,kt,Ft,Vt));else for(st=0;st<Jt.length;st++){var he=[];for(_t=0;_t<Jt[st].length;_t+=2)he.push(Re(Jt[st][_t],Jt[st][_t+1],K,kt,Ft,Vt));At.geometry.push(he)}}return vt.transformed=!0,vt}function Re(vt,K,Y,st,_t,kt){return[Math.round(Y*(vt*st-_t)),Math.round(Y*(K*st-kt))]}function jr(vt,K,Y,st,_t){for(var kt=K===_t.maxZoom?0:_t.tolerance/((1<<K)*_t.extent),Ft={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:st,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Vt=0;Vt<vt.length;Vt++){Ft.numFeatures++,Ci(Ft,vt[Vt],kt,_t);var At=vt[Vt].minX,Jt=vt[Vt].minY,ye=vt[Vt].maxX,he=vt[Vt].maxY;At<Ft.minX&&(Ft.minX=At),Jt<Ft.minY&&(Ft.minY=Jt),ye>Ft.maxX&&(Ft.maxX=ye),he>Ft.maxY&&(Ft.maxY=he)}return Ft}function Ci(vt,K,Y,st){var _t=K.geometry,kt=K.type,Ft=[];if(kt==="Point"||kt==="MultiPoint")for(var Vt=0;Vt<_t.length;Vt+=3)Ft.push(_t[Vt]),Ft.push(_t[Vt+1]),vt.numPoints++,vt.numSimplified++;else if(kt==="LineString")Te(Ft,_t,vt,Y,!1,!1);else if(kt==="MultiLineString"||kt==="Polygon")for(Vt=0;Vt<_t.length;Vt++)Te(Ft,_t[Vt],vt,Y,kt==="Polygon",Vt===0);else if(kt==="MultiPolygon")for(var At=0;At<_t.length;At++){var Jt=_t[At];for(Vt=0;Vt<Jt.length;Vt++)Te(Ft,Jt[Vt],vt,Y,!0,Vt===0)}if(Ft.length){var ye=K.tags||null;if(kt==="LineString"&&st.lineMetrics){for(var he in ye={},K.tags)ye[he]=K.tags[he];ye.mapbox_clip_start=_t.start/_t.size,ye.mapbox_clip_end=_t.end/_t.size}var ae={geometry:Ft,type:kt==="Polygon"||kt==="MultiPolygon"?3:kt==="LineString"||kt==="MultiLineString"?2:1,tags:ye};K.id!==null&&(ae.id=K.id),vt.features.push(ae)}}function Te(vt,K,Y,st,_t,kt){var Ft=st*st;if(st>0&&K.size<(_t?Ft:st))Y.numPoints+=K.length/3;else{for(var Vt=[],At=0;At<K.length;At+=3)(st===0||K[At+2]>Ft)&&(Y.numSimplified++,Vt.push(K[At]),Vt.push(K[At+1])),Y.numPoints++;_t&&function(Jt,ye){for(var he=0,ae=0,qe=Jt.length,Je=qe-2;ae<qe;Je=ae,ae+=2)he+=(Jt[ae]-Jt[Je])*(Jt[ae+1]+Jt[Je+1]);if(he>0===ye)for(ae=0,qe=Jt.length;ae<qe/2;ae+=2){var bi=Jt[ae],si=Jt[ae+1];Jt[ae]=Jt[qe-2-ae],Jt[ae+1]=Jt[qe-1-ae],Jt[qe-2-ae]=bi,Jt[qe-1-ae]=si}}(Vt,kt),vt.push(Vt)}}function Ke(vt,K){var Y=(K=this.options=function(_t,kt){for(var Ft in kt)_t[Ft]=kt[Ft];return _t}(Object.create(this.options),K)).debug;if(Y&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var st=function(_t,kt){var Ft=[];if(_t.type==="FeatureCollection")for(var Vt=0;Vt<_t.features.length;Vt++)Xe(Ft,_t.features[Vt],kt,Vt);else Xe(Ft,_t.type==="Feature"?_t:{geometry:_t},kt);return Ft}(vt,K);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),st=function(_t,kt){var Ft=kt.buffer/kt.extent,Vt=_t,At=ve(_t,1,-1-Ft,Ft,0,-1,2,kt),Jt=ve(_t,1,1-Ft,2+Ft,0,-1,2,kt);return(At||Jt)&&(Vt=ve(_t,1,-Ft,1+Ft,0,-1,2,kt)||[],At&&(Vt=Ji(At,1).concat(Vt)),Jt&&(Vt=Vt.concat(Ji(Jt,-1)))),Vt}(st,K),st.length&&this.splitTile(st,0,0,0),Y&&(st.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qe(vt,K,Y){return 32*((1<<vt)*Y+K)+vt}function hr(vt,K){return K?vt.properties[K]:vt.id}function Di(vt,K){if(vt==null)return!0;if(vt.type==="Feature")return hr(vt,K)!=null;if(vt.type==="FeatureCollection"){const Y=new Set;for(const st of vt.features){const _t=hr(st,K);if(_t==null||Y.has(_t))return!1;Y.add(_t)}return!0}return!1}function vi(vt,K){const Y=new Map;if(vt!=null)if(vt.type==="Feature")Y.set(hr(vt,K),vt);else for(const st of vt.features)Y.set(hr(st,K),st);return Y}Ke.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ke.prototype.splitTile=function(vt,K,Y,st,_t,kt,Ft){for(var Vt=[vt,K,Y,st],At=this.options,Jt=At.debug;Vt.length;){st=Vt.pop(),Y=Vt.pop(),K=Vt.pop(),vt=Vt.pop();var ye=1<<K,he=Qe(K,Y,st),ae=this.tiles[he];if(!ae&&(Jt>1&&console.time("creation"),ae=this.tiles[he]=jr(vt,K,Y,st,At),this.tileCoords.push({z:K,x:Y,y:st}),Jt)){Jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,Y,st,ae.numFeatures,ae.numPoints,ae.numSimplified),console.timeEnd("creation"));var qe="z"+K;this.stats[qe]=(this.stats[qe]||0)+1,this.total++}if(ae.source=vt,_t){if(K===At.maxZoom||K===_t)continue;var Je=1<<_t-K;if(Y!==Math.floor(kt/Je)||st!==Math.floor(Ft/Je))continue}else if(K===At.indexMaxZoom||ae.numPoints<=At.indexMaxPoints)continue;if(ae.source=null,vt.length!==0){Jt>1&&console.time("clipping");var bi,si,Si,Ni,Hi,nr,li=.5*At.buffer/At.extent,ji=.5-li,ur=.5+li,Mr=1+li;bi=si=Si=Ni=null,Hi=ve(vt,ye,Y-li,Y+ur,0,ae.minX,ae.maxX,At),nr=ve(vt,ye,Y+ji,Y+Mr,0,ae.minX,ae.maxX,At),vt=null,Hi&&(bi=ve(Hi,ye,st-li,st+ur,1,ae.minY,ae.maxY,At),si=ve(Hi,ye,st+ji,st+Mr,1,ae.minY,ae.maxY,At),Hi=null),nr&&(Si=ve(nr,ye,st-li,st+ur,1,ae.minY,ae.maxY,At),Ni=ve(nr,ye,st+ji,st+Mr,1,ae.minY,ae.maxY,At),nr=null),Jt>1&&console.timeEnd("clipping"),Vt.push(bi||[],K+1,2*Y,2*st),Vt.push(si||[],K+1,2*Y,2*st+1),Vt.push(Si||[],K+1,2*Y+1,2*st),Vt.push(Ni||[],K+1,2*Y+1,2*st+1)}}},Ke.prototype.getTile=function(vt,K,Y){var st=this.options,_t=st.extent,kt=st.debug;if(vt<0||vt>24)return null;var Ft=1<<vt,Vt=Qe(vt,K=(K%Ft+Ft)%Ft,Y);if(this.tiles[Vt])return Ei(this.tiles[Vt],_t);kt>1&&console.log("drilling down to z%d-%d-%d",vt,K,Y);for(var At,Jt=vt,ye=K,he=Y;!At&&Jt>0;)Jt--,ye=Math.floor(ye/2),he=Math.floor(he/2),At=this.tiles[Qe(Jt,ye,he)];return At&&At.source?(kt>1&&console.log("found parent tile z%d-%d-%d",Jt,ye,he),kt>1&&console.time("drilling down"),this.splitTile(At.source,Jt,ye,he,vt,K,Y),kt>1&&console.timeEnd("drilling down"),this.tiles[Vt]?Ei(this.tiles[Vt],_t):null):null};class yr extends T{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(K,Y){return c._(this,void 0,void 0,function*(){const st=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const _t=this._geoJSONIndex.getTile(st.z,st.x,st.y);if(!_t)return null;const kt=new class{constructor(Vt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.W,this.length=Vt.length,this._features=Vt}feature(Vt){return new class{constructor(At){this._feature=At,this.extent=c.W,this.type=At.type,this.properties=At.tags,"id"in At&&!isNaN(At.id)&&(this.id=parseInt(At.id,10))}loadGeometry(){if(this._feature.type===1){const At=[];for(const Jt of this._feature.geometry)At.push([new c.P(Jt[0],Jt[1])]);return At}{const At=[];for(const Jt of this._feature.geometry){const ye=[];for(const he of Jt)ye.push(new c.P(he[0],he[1]));At.push(ye)}return At}}toGeoJSON(At,Jt,ye){return Z.call(this,At,Jt,ye)}}(this._features[Vt])}}(_t.features);let Ft=de(kt);return Ft.byteOffset===0&&Ft.byteLength===Ft.buffer.byteLength||(Ft=new Uint8Array(Ft)),{vectorTile:kt,rawData:Ft.buffer}})}loadData(K){return c._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const st=!!(K&&K.request&&K.request.collectResourceTiming)&&new c.bs(K.request);this._pendingRequest=new AbortController;try{let _t=yield this.loadGeoJSON(K,this._pendingRequest);if(delete this._pendingRequest,typeof _t!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(G(_t,!0),K.filter){const Ft=c.by(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ft.result==="error")throw new Error(Ft.value.map(Vt=>`${Vt.key}: ${Vt.message}`).join(", "));_t={type:"FeatureCollection",features:_t.features.filter(Vt=>Ft.value.evaluate({zoom:0},Vt))}}this._geoJSONIndex=K.cluster?new It(function(Ft){let{superclusterOptions:Vt,clusterProperties:At}=Ft;if(!At||!Vt)return Vt;const Jt={},ye={},he={accumulated:null,zoom:0},ae={properties:null},qe=Object.keys(At);for(const Je of qe){const[bi,si]=At[Je],Si=c.by(si),Ni=c.by(typeof bi=="string"?[bi,["accumulated"],["get",Je]]:bi);Jt[Je]=Si.value,ye[Je]=Ni.value}return Vt.map=Je=>{ae.properties=Je;const bi={};for(const si of qe)bi[si]=Jt[si].evaluate(he,ae);return bi},Vt.reduce=(Je,bi)=>{ae.properties=bi;for(const si of qe)he.accumulated=Je[si],Je[si]=ye[si].evaluate(he,ae)},Vt}(K)).load(_t.features):function(Ft,Vt){return new Ke(Ft,Vt)}(_t,K.geojsonVtOptions),this.loaded={};const kt={};if(st){const Ft=st.finish();Ft&&(kt.resourceTiming={},kt.resourceTiming[K.source]=JSON.parse(JSON.stringify(Ft)))}return kt}catch(_t){if(delete this._pendingRequest,c.bz(_t))return{abandoned:!0};throw _t}})}reloadTile(K){const Y=this.loaded;return Y&&Y[K.uid]?super.reloadTile(K):this.loadTile(K)}loadGeoJSON(K,Y){return c._(this,void 0,void 0,function*(){const{promoteId:st}=K;if(K.request){const _t=yield c.h(K.request,Y);return this._dataUpdateable=Di(_t.data,st)?vi(_t.data,st):void 0,_t.data}if(typeof K.data=="string")try{const _t=JSON.parse(K.data);return this._dataUpdateable=Di(_t,st)?vi(_t,st):void 0,_t}catch{throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`)}if(!K.dataDiff)throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K.source}`);return function(_t,kt,Ft){var Vt,At,Jt,ye;if(kt.removeAll&&_t.clear(),kt.remove)for(const he of kt.remove)_t.delete(he);if(kt.add)for(const he of kt.add){const ae=hr(he,Ft);ae!=null&&_t.set(ae,he)}if(kt.update)for(const he of kt.update){let ae=_t.get(he.id);if(ae==null)continue;const qe=!he.removeAllProperties&&(((Vt=he.removeProperties)===null||Vt===void 0?void 0:Vt.length)>0||((At=he.addOrUpdateProperties)===null||At===void 0?void 0:At.length)>0);if((he.newGeometry||he.removeAllProperties||qe)&&(ae=Object.assign({},ae),_t.set(he.id,ae),qe&&(ae.properties=Object.assign({},ae.properties))),he.newGeometry&&(ae.geometry=he.newGeometry),he.removeAllProperties)ae.properties={};else if(((Jt=he.removeProperties)===null||Jt===void 0?void 0:Jt.length)>0)for(const Je of he.removeProperties)Object.prototype.hasOwnProperty.call(ae.properties,Je)&&delete ae.properties[Je];if(((ye=he.addOrUpdateProperties)===null||ye===void 0?void 0:ye.length)>0)for(const{key:Je,value:bi}of he.addOrUpdateProperties)ae.properties[Je]=bi}}(this._dataUpdateable,K.dataDiff,st),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(K){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}class sr{constructor(K){this.self=K,this.actor=new c.C(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,st)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=st},this.self.addProtocol=c.bf,this.self.removeProtocol=c.bg,this.self.registerRTLTextPlugin=Y=>{if(c.bA.isParsed())throw new Error("RTL text plugin already registered.");c.bA.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,st)=>this._getDEMWorkerSource(Y,st.source).loadTile(st)),this.actor.registerMessageHandler("RDT",(Y,st)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,st.source).removeTile(st)})),this.actor.registerMessageHandler("GCEZ",(Y,st)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,st.type,st.source).getClusterExpansionZoom(st)})),this.actor.registerMessageHandler("GCC",(Y,st)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,st.type,st.source).getClusterChildren(st)})),this.actor.registerMessageHandler("GCL",(Y,st)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,st.type,st.source).getClusterLeaves(st)})),this.actor.registerMessageHandler("LD",(Y,st)=>this._getWorkerSource(Y,st.type,st.source).loadData(st)),this.actor.registerMessageHandler("LT",(Y,st)=>this._getWorkerSource(Y,st.type,st.source).loadTile(st)),this.actor.registerMessageHandler("RT",(Y,st)=>this._getWorkerSource(Y,st.type,st.source).reloadTile(st)),this.actor.registerMessageHandler("AT",(Y,st)=>this._getWorkerSource(Y,st.type,st.source).abortTile(st)),this.actor.registerMessageHandler("RMT",(Y,st)=>this._getWorkerSource(Y,st.type,st.source).removeTile(st)),this.actor.registerMessageHandler("RS",(Y,st)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][st.type]||!this.workerSources[Y][st.type][st.source])return;const _t=this.workerSources[Y][st.type][st.source];delete this.workerSources[Y][st.type][st.source],_t.removeSource!==void 0&&_t.removeSource(st)})),this.actor.registerMessageHandler("RM",Y=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,st)=>c._(this,void 0,void 0,function*(){this.referrer=st})),this.actor.registerMessageHandler("SRPS",(Y,st)=>this._syncRTLPluginState(Y,st)),this.actor.registerMessageHandler("IS",(Y,st)=>c._(this,void 0,void 0,function*(){this.self.importScripts(st)})),this.actor.registerMessageHandler("SI",(Y,st)=>this._setImages(Y,st)),this.actor.registerMessageHandler("UL",(Y,st)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(st.layers,st.removedIds)})),this.actor.registerMessageHandler("SL",(Y,st)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(st)}))}_setImages(K,Y){return c._(this,void 0,void 0,function*(){this.availableImages[K]=Y;for(const st in this.workerSources[K]){const _t=this.workerSources[K][st];for(const kt in _t)_t[kt].availableImages=Y}})}_syncRTLPluginState(K,Y){return c._(this,void 0,void 0,function*(){if(c.bA.isParsed())return c.bA.getState();if(Y.pluginStatus!=="loading")return c.bA.setState(Y),Y;const st=Y.pluginURL;if(this.self.importScripts(st),c.bA.isParsed()){const _t={pluginStatus:"loaded",pluginURL:st};return c.bA.setState(_t),_t}throw c.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${st}`)})}_getAvailableImages(K){let Y=this.availableImages[K];return Y||(Y=[]),Y}_getLayerIndex(K){let Y=this.layerIndexes[K];return Y||(Y=this.layerIndexes[K]=new l),Y}_getWorkerSource(K,Y,st){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][Y]||(this.workerSources[K][Y]={}),!this.workerSources[K][Y][st]){const _t={sendAsync:(kt,Ft)=>(kt.targetMapId=K,this.actor.sendAsync(kt,Ft))};switch(Y){case"vector":this.workerSources[K][Y][st]=new T(_t,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][Y][st]=new yr(_t,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][Y][st]=new this.externalWorkerSourceTypes[Y](_t,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][Y][st]}_getDEMWorkerSource(K,Y){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][Y]||(this.demWorkerSources[K][Y]=new P),this.demWorkerSources[K][Y]}}return c.i(self)&&(self.worker=new sr(self)),sr}),s("index",["exports","./shared"],function(c,l){var f="4.1.3";let y,x;const T={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((a,d)=>{const m=requestAnimationFrame(a);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),d(l.c())})}),getImageData(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(w).getImageData(-a,-a,w.width+2*a,w.height+2*a)},getImageCanvasContext(w){const a=window.document.createElement("canvas"),d=a.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return a.width=w.width,a.height=w.height,d.drawImage(w,0,0,w.width,w.height),d},resolveURL:w=>(y||(y=document.createElement("a")),y.href=w,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(x==null&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};class P{static testProp(a){if(!P.docStyle)return a[0];for(let d=0;d<a.length;d++)if(a[d]in P.docStyle)return a[d];return a[0]}static create(a,d,m){const _=window.document.createElement(a);return d!==void 0&&(_.className=d),m&&m.appendChild(_),_}static createNS(a,d){return window.document.createElementNS(a,d)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(a,d){a.style[P.transformProp]=d}static addEventListener(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.addEventListener(d,m,"passive"in _?_:_.capture)}static removeEventListener(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.removeEventListener(d,m,"passive"in _?_:_.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(a){const d=a.getBoundingClientRect();return{x:d.width/a.offsetWidth||1,y:d.height/a.offsetHeight||1,boundingClientRect:d}}static getPoint(a,d,m){const _=d.boundingClientRect;return new l.P((m.clientX-_.left)/d.x-a.clientLeft,(m.clientY-_.top)/d.y-a.clientTop)}static mousePos(a,d){const m=P.getScale(a);return P.getPoint(a,m,d)}static touchPos(a,d){const m=[],_=P.getScale(a);for(let A=0;A<d.length;A++)m.push(P.getPoint(a,_,d[A]));return m}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const M={supported:!1,testSupport:function(w){!Z&&G&&(X?$(w):N=w)}};let N,G,Z=!1,X=!1;function $(w){const a=w.createTexture();w.bindTexture(w.TEXTURE_2D,a);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,G),w.isContextLost())return;M.supported=!0}catch{}w.deleteTexture(a),Z=!0}var ct;typeof document<"u"&&(G=document.createElement("img"),G.onload=function(){N&&$(N),N=null,X=!0},G.onerror=function(){Z=!0,N=null},G.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let a,d,m,_;w.resetRequestQueue=()=>{a=[],d=0,m=0,_={}},w.addThrottleControl=g=>{const b=m++;return _[b]=g,b},w.removeThrottleControl=g=>{delete _[g],B()},w.getImage=function(g,b){let E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((I,O)=>{M.supported&&(g.headers||(g.headers={}),g.headers.accept="image/webp,*/*"),l.e(g,{type:"image"}),a.push({abortController:b,requestParameters:g,supportImageRefresh:E,state:"queued",onError:F=>{O(F)},onSuccess:F=>{I(F)}}),B()})};const A=g=>l._(this,void 0,void 0,function*(){g.state="running";const{requestParameters:b,supportImageRefresh:E,onError:I,onSuccess:O,abortController:F}=g,z=E===!1&&!l.i(self)&&!l.g(b.url)&&(!b.headers||Object.keys(b.headers).reduce((W,at)=>W&&at==="accept",!0));d++;const V=z?R(b,F):l.m(b,F);try{const W=yield V;delete g.abortController,g.state="completed",W.data instanceof HTMLImageElement||l.b(W.data)?O(W):W.data&&O({data:yield(U=W.data,typeof createImageBitmap=="function"?l.d(U):l.f(U)),cacheControl:W.cacheControl,expires:W.expires})}catch(W){delete g.abortController,I(W)}finally{d--,B()}var U}),B=()=>{const g=(()=>{for(const b of Object.keys(_))if(_[b]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let b=d;b<g&&a.length>0;b++){const E=a.shift();E.abortController.signal.aborted?b--:A(E)}},R=(g,b)=>new Promise((E,I)=>{const O=new Image,F=g.url,z=g.credentials;z&&z==="include"?O.crossOrigin="use-credentials":(z&&z==="same-origin"||!l.s(F))&&(O.crossOrigin="anonymous"),b.signal.addEventListener("abort",()=>{O.src="",I(l.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,E({data:O})},O.onerror=()=>{O.onerror=O.onload=null,b.signal.aborted||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=F})}(ct||(ct={})),ct.resetRequestQueue();class yt{constructor(a){this._transformRequestFn=a}transformRequest(a,d){return this._transformRequestFn&&this._transformRequestFn(a,d)||{url:a}}normalizeSpriteURL(a,d,m){const _=function(A){const B=A.match(Mt);if(!B)throw new Error(`Unable to parse URL "${A}"`);return{protocol:B[1],authority:B[2],path:B[3]||"/",params:B[4]?B[4].split("&"):[]}}(a);return _.path+=`${d}${m}`,function(A){const B=A.params.length?`?${A.params.join("&")}`:"";return`${A.protocol}://${A.authority}${A.path}${B}`}(_)}setTransformRequest(a){this._transformRequestFn=a}}const Mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Nt(w){var a=new l.A(3);return a[0]=w[0],a[1]=w[1],a[2]=w[2],a}var Rt,xt=function(w,a,d){return w[0]=a[0]-d[0],w[1]=a[1]-d[1],w[2]=a[2]-d[2],w};Rt=new l.A(3),l.A!=Float32Array&&(Rt[0]=0,Rt[1]=0,Rt[2]=0);var qt=function(w){var a=w[0],d=w[1];return a*a+d*d};function zt(w){const a=[];if(typeof w=="string")a.push({id:"default",url:w});else if(w&&w.length>0){const d=[];for(const{id:m,url:_}of w){const A=`${m}${_}`;d.indexOf(A)===-1&&(d.push(A),a.push({id:m,url:_}))}}return a}(function(){var w=new l.A(2);l.A!=Float32Array&&(w[0]=0,w[1]=0)})();class ot{constructor(a,d,m,_){this.context=a,this.format=m,this.texture=a.gl.createTexture(),this.update(d,_)}update(a,d,m){const{width:_,height:A}=a,B=!(this.size&&this.size[0]===_&&this.size[1]===A||m),{context:R}=this,{gl:g}=R;if(this.useMipmap=!!(d&&d.useMipmap),g.bindTexture(g.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!d||d.premultiply!==!1)),B)this.size=[_,A],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,a):g.texImage2D(g.TEXTURE_2D,0,this.format,_,A,0,this.format,g.UNSIGNED_BYTE,a.data);else{const{x:b,y:E}=m||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?g.texSubImage2D(g.TEXTURE_2D,0,b,E,g.RGBA,g.UNSIGNED_BYTE,a):g.texSubImage2D(g.TEXTURE_2D,0,b,E,_,A,g.RGBA,g.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&g.generateMipmap(g.TEXTURE_2D)}bind(a,d,m){const{context:_}=this,{gl:A}=_;A.bindTexture(A.TEXTURE_2D,this.texture),m!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=A.LINEAR),a!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,a),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,m||a),this.filter=a),d!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,d),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function dt(w){const{userImage:a}=w;return!!(a&&a.render&&a.render())&&(w.data.replace(new Uint8Array(a.data.buffer)),!0)}class Lt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,promiseResolve:m}of this.requestors)m(this._getImagesForIds(d));this.requestors=[]}}getImage(a){const d=this.images[a];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new l.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(a,d){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let m=!0;const _=d.data||d.spriteData;return this._validateStretch(d.stretchX,_&&_.width)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,_&&_.height)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "content" value`))),m=!1),m}_validateStretch(a,d){if(!a)return!0;let m=0;for(const _ of a){if(_[0]<m||_[1]<_[0]||d<_[1])return!1;m=_[1]}return!0}_validateContent(a,d){if(!a)return!0;if(a.length!==4)return!1;const m=d.spriteData,_=m&&m.width||d.data.width,A=m&&m.height||d.data.height;return!(a[0]<0||_<a[0]||a[1]<0||A<a[1]||a[2]<0||_<a[2]||a[3]<0||A<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const _=this.getImage(a);if(m&&(_.data.width!==d.data.width||_.data.height!==d.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=_.version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((d,m)=>{let _=!0;if(!this.isLoaded())for(const A of a)this.images[A]||(_=!1);this.isLoaded()||_?d(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:d})})}_getImagesForIds(a){const d={};for(const m of a){let _=this.getImage(m);_||(this.fire(new l.k("styleimagemissing",{id:m})),_=this.getImage(m)),_?d[m]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:l.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],m=this.getImage(a);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const _={w:m.data.width+2,h:m.data.height+2,x:0,y:0},A=new l.I(_,m);this.patterns[a]={bin:_,position:A}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ot(a,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const A in this.patterns)a.push(this.patterns[A].bin);const{w:d,h:m}=l.p(a),_=this.atlasImage;_.resize({width:d||1,height:m||1});for(const A in this.patterns){const{bin:B}=this.patterns[A],R=B.x+1,g=B.y+1,b=this.getImage(A).data,E=b.width,I=b.height;l.R.copy(b,_,{x:0,y:0},{x:R,y:g},{width:E,height:I}),l.R.copy(b,_,{x:0,y:I-1},{x:R,y:g-1},{width:E,height:1}),l.R.copy(b,_,{x:0,y:0},{x:R,y:g+I},{width:E,height:1}),l.R.copy(b,_,{x:E-1,y:0},{x:R-1,y:g},{width:1,height:I}),l.R.copy(b,_,{x:0,y:0},{x:R+E,y:g},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||l.w(`Image with ID: "${d}" was not found`),dt(m)&&this.updateImage(d,m)}}}const wt=1e20;function le(w,a,d,m,_,A,B,R,g){for(let b=a;b<a+m;b++)oe(w,d*A+b,A,_,B,R,g);for(let b=d;b<d+_;b++)oe(w,b*A+a,1,m,B,R,g)}function oe(w,a,d,m,_,A,B){A[0]=0,B[0]=-wt,B[1]=wt,_[0]=w[a];for(let R=1,g=0,b=0;R<m;R++){_[R]=w[a+R*d];const E=R*R;do{const I=A[g];b=(_[R]-_[I]+E-I*I)/(R-I)/2}while(b<=B[g]&&--g>-1);g++,A[g]=R,B[g]=b,B[g+1]=wt}for(let R=0,g=0;R<m;R++){for(;B[g+1]<R;)g++;const b=A[g],E=R-b;w[a+R*d]=_[b]+E*E}}class de{constructor(a,d){this.requestManager=a,this.localIdeographFontFamily=d,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return l._(this,void 0,void 0,function*(){const d=[];for(const A in a)for(const B of a[A])d.push(this._getAndCacheGlyphsPromise(A,B));const m=yield Promise.all(d),_={};for(const{stack:A,id:B,glyph:R}of m)_[A]||(_[A]={}),_[A][B]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return _})}_getAndCacheGlyphsPromise(a,d){return l._(this,void 0,void 0,function*(){let m=this.entries[a];m||(m=this.entries[a]={glyphs:{},requests:{},ranges:{}});let _=m.glyphs[d];if(_!==void 0)return{stack:a,id:d,glyph:_};if(_=this._tinySDF(m,a,d),_)return m.glyphs[d]=_,{stack:a,id:d,glyph:_};const A=Math.floor(d/256);if(256*A>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[A])return{stack:a,id:d,glyph:_};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[A]){const R=de.loadGlyphRange(a,A,this.url,this.requestManager);m.requests[A]=R}const B=yield m.requests[A];for(const R in B)this._doesCharSupportLocalGlyph(+R)||(m.glyphs[+R]=B[+R]);return m.ranges[A]=!0,{stack:a,id:d,glyph:B[d]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](a)||l.u["Hangul Syllables"](a)||l.u.Hiragana(a)||l.u.Katakana(a))}_tinySDF(a,d,m){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(m))return;let A=a.tinySDF;if(!A){let R="400";/bold/i.test(d)?R="900":/medium/i.test(d)?R="500":/light/i.test(d)&&(R="200"),A=a.tinySDF=new de.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:R})}const B=A.draw(String.fromCharCode(m));return{id:m,bitmap:new l.o({width:B.width||60,height:B.height||60},B.data),metrics:{width:B.glyphWidth/2||24,height:B.glyphHeight/2||24,left:B.glyphLeft/2+.5||0,top:B.glyphTop/2-27.5||-8,advance:B.glyphAdvance/2||24,isDoubleResolution:!0}}}}de.loadGlyphRange=function(w,a,d,m){return l._(this,void 0,void 0,function*(){const _=256*a,A=_+255,B=m.transformRequest(d.replace("{fontstack}",w).replace("{range}",`${_}-${A}`),"Glyphs"),R=yield l.l(B,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${a}, ${_}-${A}`);const g={};for(const b of l.n(R.data))g[b.id]=b;return g})},de.TinySDF=class{constructor(){let{fontSize:w=24,buffer:a=3,radius:d=8,cutoff:m=.25,fontFamily:_="sans-serif",fontWeight:A="normal",fontStyle:B="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=a,this.cutoff=m,this.radius=d;const R=this.size=w+4*a,g=this._createCanvas(R),b=this.ctx=g.getContext("2d",{willReadFrequently:!0});b.font=`${B} ${A} ${w}px ${_}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(w){const a=document.createElement("canvas");return a.width=a.height=w,a}draw(w){const{width:a,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:_,actualBoundingBoxRight:A}=this.ctx.measureText(w),B=Math.ceil(d),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(A-_))),g=Math.min(this.size-this.buffer,B+Math.ceil(m)),b=R+2*this.buffer,E=g+2*this.buffer,I=Math.max(b*E,0),O=new Uint8ClampedArray(I),F={data:O,width:b,height:E,glyphWidth:R,glyphHeight:g,glyphTop:B,glyphLeft:0,glyphAdvance:a};if(R===0||g===0)return F;const{ctx:z,buffer:V,gridInner:U,gridOuter:W}=this;z.clearRect(V,V,R,g),z.fillText(w,V,V+B);const at=z.getImageData(V,V,R,g);W.fill(wt,0,I),U.fill(0,0,I);for(let tt=0;tt<g;tt++)for(let ht=0;ht<R;ht++){const ut=at.data[4*(tt*R+ht)+3]/255;if(ut===0)continue;const Tt=(tt+V)*b+ht+V;if(ut===1)W[Tt]=0,U[Tt]=wt;else{const bt=.5-ut;W[Tt]=bt>0?bt*bt:0,U[Tt]=bt<0?bt*bt:0}}le(W,0,0,b,E,b,this.f,this.v,this.z),le(U,V,V,R,g,b,this.f,this.v,this.z);for(let tt=0;tt<I;tt++){const ht=Math.sqrt(W[tt])-Math.sqrt(U[tt]);O[tt]=Math.round(255-255*(ht/this.radius+this.cutoff))}return F}};class te{constructor(){this.specification=l.v.light.position}possiblyEvaluate(a,d){return l.y(a.expression.evaluate(d))}interpolate(a,d,m){return{x:l.z.number(a.x,d.x,m),y:l.z.number(a.y,d.y,m),z:l.z.number(a.z,d.z,m)}}}let me;class ge extends l.E{constructor(a){super(),me=me||new l.q({anchor:new l.D(l.v.light.anchor),position:new te,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(me),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(l.r,a,d))for(const m in a){const _=a[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),_):this._transitionable.setValue(m,_)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,m){return(!m||m.validate!==!1)&&l.t(this,a.call(l.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class ke{constructor(a,d){this.width=a,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,d){const m=a.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(a,d)),this.dashEntry[m]}getDashRanges(a,d,m){const _=[];let A=a.length%2==1?-a[a.length-1]*m:0,B=a[0]*m,R=!0;_.push({left:A,right:B,isDash:R,zeroLength:a[0]===0});let g=a[0];for(let b=1;b<a.length;b++){R=!R;const E=a[b];A=g*m,g+=E,B=g*m,_.push({left:A,right:B,isDash:R,zeroLength:E===0})}return _}addRoundDash(a,d,m){const _=d/2;for(let A=-m;A<=m;A++){const B=this.width*(this.nextRow+m+A);let R=0,g=a[R];for(let b=0;b<this.width;b++){b/g.right>1&&(g=a[++R]);const E=Math.abs(b-g.left),I=Math.abs(b-g.right),O=Math.min(E,I);let F;const z=A/m*(_+1);if(g.isDash){const V=_-Math.abs(z);F=Math.sqrt(O*O+V*V)}else F=_-Math.sqrt(O*O+z*z);this.data[B+b]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(a){for(let R=a.length-1;R>=0;--R){const g=a[R],b=a[R+1];g.zeroLength?a.splice(R,1):b&&b.isDash===g.isDash&&(b.left=g.left,a.splice(R,1))}const d=a[0],m=a[a.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const _=this.width*this.nextRow;let A=0,B=a[A];for(let R=0;R<this.width;R++){R/B.right>1&&(B=a[++A]);const g=Math.abs(R-B.left),b=Math.abs(R-B.right),E=Math.min(g,b);this.data[_+R]=Math.max(0,Math.min(255,(B.isDash?E:-E)+128))}}addDash(a,d){const m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return l.w("LineAtlas out of space"),null;let A=0;for(let R=0;R<a.length;R++)A+=a[R];if(A!==0){const R=this.width/A,g=this.getDashRanges(a,this.width,R);d?this.addRoundDash(g,R,m):this.addRegularDash(g)}const B={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:A};return this.nextRow+=_,this.dirty=!0,B}bind(a){const d=a.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const it="maplibre_preloaded_worker_pool";class Et{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Et.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[it]}numActive(){return Object.keys(this.active).length}}const It=Math.floor(T.hardwareConcurrency/2);let Ut,Xt;function Kt(){return Ut||(Ut=new Et),Ut}Et.workerCount=l.B(globalThis)?Math.max(Math.min(It,3),1):1;class ie{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let _=0;_<m.length;_++){const A=new l.C(m[_],d);A.name=`Worker ${_}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,d){const m=[];for(const _ of this.actors)m.push(_.sendAsync({type:a,data:d}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,d){for(const m of this.actors)m.registerMessageHandler(a,d)}}function Qt(){return Xt||(Xt=new ie(Kt(),l.G),Xt.registerMessageHandler("GR",(w,a,d)=>l.m(a,d))),Xt}function Ae(w,a){const d=l.F();return l.H(d,d,[1,1,0]),l.J(d,d,[.5*w.width,.5*w.height,1]),l.K(d,d,w.calculatePosMatrix(a.toUnwrapped()))}function Le(w,a,d,m,_,A){const B=function(I,O,F){if(I)for(const z of I){const V=O[z];if(V&&V.source===F&&V.type==="fill-extrusion")return!0}else for(const z in O){const V=O[z];if(V.source===F&&V.type==="fill-extrusion")return!0}return!1}(_&&_.layers,a,w.id),R=A.maxPitchScaleFactor(),g=w.tilesIn(m,R,B);g.sort(Fe);const b=[];for(const I of g)b.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(a,d,w._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,_,A,R,Ae(w.transform,I.tileID))});const E=function(I){const O={},F={};for(const z of I){const V=z.queryResults,U=z.wrappedTileID,W=F[U]=F[U]||{};for(const at in V){const tt=V[at],ht=W[at]=W[at]||{},ut=O[at]=O[at]||[];for(const Tt of tt)ht[Tt.featureIndex]||(ht[Tt.featureIndex]=!0,ut.push(Tt))}}return O}(b);for(const I in E)E[I].forEach(O=>{const F=O.feature,z=w.getFeatureState(F.layer["source-layer"],F.id);F.source=F.layer.source,F.layer["source-layer"]&&(F.sourceLayer=F.layer["source-layer"]),F.state=z});return E}function Fe(w,a){const d=w.tileID,m=a.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}function Ge(w,a,d){return l._(this,void 0,void 0,function*(){let m=w;if(w.url?m=(yield l.h(a.transformRequest(w.url,"Source"),d)).data:yield T.frameAsync(d),!m)return null;const _=l.L(l.e(m,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(_.vectorLayerIds=m.vector_layers.map(A=>A.id)),_})}class Xe{constructor(a,d){a&&(d?this.setSouthWest(a).setNorthEast(d):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}extend(a){const d=this._sw,m=this._ne;let _,A;if(a instanceof l.M)_=a,A=a;else{if(!(a instanceof Xe))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Xe.convert(a)):this.extend(l.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(l.M.convert(a)):this;if(_=a._sw,A=a._ne,!_||!A)return this}return d||m?(d.lng=Math.min(_.lng,d.lng),d.lat=Math.min(_.lat,d.lat),m.lng=Math.max(A.lng,m.lng),m.lat=Math.max(A.lat,m.lat)):(this._sw=new l.M(_.lng,_.lat),this._ne=new l.M(A.lng,A.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:d,lat:m}=l.M.convert(a);let _=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_}static convert(a){return a instanceof Xe?a:a&&new Xe(a)}static fromLngLat(a){const d=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,m=d/Math.cos(Math.PI/180*a.lat);return new Xe(new l.M(a.lng-m,a.lat-d),new l.M(a.lng+m,a.lat+d))}}class pe{constructor(a,d,m){this.bounds=Xe.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),m=Math.floor(l.N(this.bounds.getWest())*d),_=Math.floor(l.O(this.bounds.getNorth())*d),A=Math.ceil(l.N(this.bounds.getEast())*d),B=Math.ceil(l.O(this.bounds.getSouth())*d);return a.x>=m&&a.x<A&&a.y>=_&&a.y<B}}class Pt extends l.E{constructor(a,d,m,_){if(super(),this.id=a,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ge(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(l.e(this,a),a.bounds&&(this.tileBounds=new pe(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,"Tile"),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let _="RT";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((A,B)=>{a.reloadPromise={resolve:A,reject:B}})}else a.actor=this.dispatcher.getActor(),_="LT";a.abortController=new AbortController;try{const A=yield a.actor.sendAsync({type:_,data:m},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,A)}catch(A){if(delete a.abortController,a.aborted)return;if(A&&A.status!==404)throw A;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,d){if(d&&d.resourceTiming&&(a.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&a.setExpiryData(d),a.loadVectorData(d,this.map.painter),a.reloadPromise){const m=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(m.resolve).catch(m.reject)}}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"AT",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Zt extends l.E{constructor(a,d,m,_){super(),this.id=a,this.dispatcher=m,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.L(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ge(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new pe(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return l.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const m=yield ct.getImage(this.map._requestManager.transformRequest(d,"Tile"),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&a.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const _=this.map.painter.context,A=_.gl,B=m.data;a.texture=this.map.painter.getTileTexture(B.width),a.texture?a.texture.update(B,{useMipmap:!0}):(a.texture=new ot(_,B,A.RGBA,{useMipmap:!0}),a.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),_.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,_.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(m){if(delete a.abortController,a.aborted)a.state="unloaded";else if(m)throw a.state="errored",m}})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class ii extends Zt{constructor(a,d,m,_){super(a,d,m,_),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,"Tile");a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const _=yield ct.getImage(m,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(_&&_.data){const A=_.data;this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&a.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const B=l.b(A)&&l.S()?A:yield this.readImageNow(A),R={type:this.type,uid:a.uid,source:this.id,rawImageData:B,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const g=yield a.actor.sendAsync({type:"LDT",data:R});a.dem=g,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(_){if(delete a.abortController,a.aborted)a.state="unloaded";else if(_)throw a.state="errored",_}})}readImageNow(a){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const d=a.width+2,m=a.height+2;try{return new l.R({width:d,height:m},yield l.V(a,-1,-1,d,m))}catch{}}return T.getImageData(a,1)})}_getNeighboringTiles(a){const d=a.canonical,m=Math.pow(2,d.z),_=(d.x-1+m)%m,A=d.x===0?a.wrap-1:a.wrap,B=(d.x+1+m)%m,R=d.x+1===m?a.wrap+1:a.wrap,g={};return g[new l.Q(a.overscaledZ,A,d.z,_,d.y).key]={backfilled:!1},g[new l.Q(a.overscaledZ,R,d.z,B,d.y).key]={backfilled:!1},d.y>0&&(g[new l.Q(a.overscaledZ,A,d.z,_,d.y-1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,R,d.z,B,d.y-1).key]={backfilled:!1}),d.y+1<m&&(g[new l.Q(a.overscaledZ,A,d.z,_,d.y+1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},g[new l.Q(a.overscaledZ,R,d.z,B,d.y+1).key]={backfilled:!1}),g}unloadTile(a){return l._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"RDT",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class Pe extends l.E{constructor(a,d,m,_){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(_),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const A=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*A,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*A,extent:l.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.W,radius:(d.clusterRadius||50)*A,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,d,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:a,limit:d,offset:m}})}_updateWorkerData(a){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);a?d.dataDiff=a:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(T.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let _=null;m.resourceTiming&&m.resourceTiming[this.id]&&(_=m.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&l.e(A,{resourceTiming:_}),this.fire(new l.k("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.actor?"RT":"LT";a.actor=this.actor;const m={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const _=yield this.actor.sendAsync({type:d,data:m},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(_,this.map.painter,d==="RT")})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ve=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ee extends l.E{constructor(a,d,m,_){super(),this.id=a,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=d}load(a){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield ct.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,a&&(this.coordinates=a),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const d=a.map(l.Y.fromLngLat);this.tileID=function(_){let A=1/0,B=1/0,R=-1/0,g=-1/0;for(const O of _)A=Math.min(A,O.x),B=Math.min(B,O.y),R=Math.max(R,O.x),g=Math.max(g,O.y);const b=Math.max(R-A,g-B),E=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),I=Math.pow(2,E);return new l.a0(E,Math.floor((A+R)/2*I),Math.floor((B+g)/2*I))}(d),this.minzoom=this.maxzoom=this.tileID.z;const m=d.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,l.W,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,l.W),this._boundsArray.emplaceBack(m[2].x,m[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ve.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ot(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const _ in this.tiles){const A=this.tiles[_];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ve extends Ee{constructor(a,d,m,_){super(a,d,m,_),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const d of a.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield l.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const d=this.video.seekable;a<d.start(0)||a>d.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ve.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new ot(a,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const _ in this.tiles){const A=this.tiles[_];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ai extends Ee{constructor(a,d,m,_){super(a,d,m,_),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(B=>typeof B!="number"))||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ve.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ot(d,this.canvas,m.RGBA,{premultiply:!0});let _=!1;for(const A in this.tiles){const B=this.tiles[A];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Ai={},Ti=w=>{switch(w){case"geojson":return Pe;case"image":return Ee;case"raster":return Zt;case"raster-dem":return ii;case"vector":return Pt;case"video":return Ve;case"canvas":return ai}return Ai[w]},Pi="RTLPluginLoaded";class qi extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(a){return this.status=a,this.dispatcher.broadcast("SRPS",{pluginStatus:a,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(a){return l._(this,arguments,void 0,function(d){var m=this;let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(m.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(m.url=T.resolveURL(d),!m.url)throw new Error(`requested url ${d} is invalid`);if(m.status==="unavailable"){if(!_)return m._requestImport();m.status="deferred",m._syncState(m.status)}else if(m.status==="requested")return m._requestImport()}()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Pi))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ji=null;function ce(){return Ji||(Ji=new qi),Ji}class Ei{constructor(a,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=l.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const d=a+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(_,A){const B={};if(!A)return B;for(const R of _){const g=R.layerIds.map(b=>A.getLayer(b)).filter(Boolean);if(g.length!==0){R.layers=g,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(b=>g.filter(E=>E.id===b)[0]));for(const b of g)B[b.id]=R}}return B}(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const A=this.buckets[_];if(A instanceof l.a5){if(this.hasSymbolBuckets=!0,!m)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const A=this.buckets[_];if(A instanceof l.a5&&A.hasRTLText){this.hasRTLText=!0,ce().lazyLoad();break}}this.queryPadding=0;for(const _ in this.buckets){const A=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(_).queryRadius(A))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const m in this.buckets){const _=this.buckets[m];_.uploadPending()&&_.upload(a)}const d=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ot(a,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ot(a,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,d,m,_,A,B,R,g,b,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:A,scale:B,tileSize:this.tileSize,pixelPosMatrix:E,transform:g,params:R,queryPadding:this.queryPadding*b},a,d,m):{}}querySourceFeatures(a,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const _=m.loadVTLayers(),A=d&&d.sourceLayer?d.sourceLayer:"",B=_._geojsonTileLayer||_[A];if(!B)return;const R=l.a6(d&&d.filter),{z:g,x:b,y:E}=this.tileID.canonical,I={z:g,x:b,y:E};for(let O=0;O<B.length;O++){const F=B.feature(O);if(R.needGeometry){const U=l.a7(F,!0);if(!R.filter(new l.a8(this.tileID.overscaledZ),U,this.tileID.canonical))continue}else if(!R.filter(new l.a8(this.tileID.overscaledZ),F))continue;const z=m.getId(F,A),V=new l.a9(F,g,b,E,z);V.tile=I,a.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const m=l.aa(a.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const m=Date.now();let _=!1;if(this.expirationTime>m)_=!1;else if(d)if(this.expirationTime<d)_=!0;else{const A=this.expirationTime-d;A?this.expirationTime=m+Math.max(A,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!d.style.hasLayer(_))continue;const A=this.buckets[_],B=A.layers[0].sourceLayer||"_geojsonTileLayer",R=m[B],g=a[B];if(!R||!g||Object.keys(g).length===0)continue;A.update(g,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const b=d&&d.style&&d.style.getLayer(_);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<T.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=T.now()+a}setDependencies(a,d){const m={};for(const _ of d)m[_]=!0;this.dependencies[a]=m}hasDependency(a,d){for(const m of a){const _=this.dependencies[m];if(_){for(const A of d)if(_[A])return!0}}return!1}}class Re{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,m){const _=a.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const A={value:d,timeout:void 0};if(m!==void 0&&(A.timeout=setTimeout(()=>{this.remove(a,A)},m)),this.data[_].push(A),this.order.push(_),this.order.length>this.max){const B=this._getAndRemoveByKey(this.order[0]);B&&this.onRemove(B)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const m=a.wrapped().key,_=d===void 0?0:this.data[m].indexOf(d),A=this.data[m][_];return this.data[m].splice(_,1),A.timeout&&clearTimeout(A.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(A.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const m in this.data)for(const _ of this.data[m])a(_.value)||d.push(_);for(const m of d)this.remove(m.value.tileID,m)}}class jr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,m){const _=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][_]=this.stateChanges[a][_]||{},l.e(this.stateChanges[a][_],m),this.deletedStates[a]===null){this.deletedStates[a]={};for(const A in this.state[a])A!==_&&(this.deletedStates[a][A]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][_]===null){this.deletedStates[a][_]={};for(const A in this.state[a][_])m[A]||(this.deletedStates[a][_][A]=null)}else for(const A in m)this.deletedStates[a]&&this.deletedStates[a][_]&&this.deletedStates[a][_][A]===null&&delete this.deletedStates[a][_][A]}removeFeatureState(a,d,m){if(this.deletedStates[a]===null)return;const _=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},m&&d!==void 0)this.deletedStates[a][_]!==null&&(this.deletedStates[a][_]=this.deletedStates[a][_]||{},this.deletedStates[a][_][m]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][_])for(m in this.deletedStates[a][_]={},this.stateChanges[a][_])this.deletedStates[a][_][m]=null;else this.deletedStates[a][_]=null;else this.deletedStates[a]=null}getState(a,d){const m=String(d),_=l.e({},(this.state[a]||{})[m],(this.stateChanges[a]||{})[m]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const A=this.deletedStates[a][d];if(A===null)return{};for(const B in A)delete _[B]}return _}initializeTileState(a,d){a.setFeatureState(this.state,d)}coalesceChanges(a,d){const m={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const A={};for(const B in this.stateChanges[_])this.state[_][B]||(this.state[_][B]={}),l.e(this.state[_][B],this.stateChanges[_][B]),A[B]=this.state[_][B];m[_]=A}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const A={};if(this.deletedStates[_]===null)for(const B in this.state[_])A[B]={},this.state[_][B]={};else for(const B in this.deletedStates[_]){if(this.deletedStates[_][B]===null)this.state[_][B]={};else for(const R of Object.keys(this.deletedStates[_][B]))delete this.state[_][B][R];A[B]=this.state[_][B]}m[_]=m[_]||{},l.e(m[_],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const _ in a)a[_].setFeatureState(m,d)}}class Ci extends l.E{constructor(a,d,m){super(),this.id=a,this.dispatcher=m,this.on("data",_=>this._dataHandler(_)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((_,A,B,R)=>{const g=new(Ti(A.type))(_,A,B,R);if(g.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${g.id}`);return g})(a,d,m,this),this._tiles={},this._cache=new Re(0,_=>this._unloadTile(_)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new jr,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const d=this._tiles[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,d,m){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,d,m)}catch(_){a.state="errored",_.status!==404?this._source.fire(new l.j(_,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new l.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(a),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Te).map(a=>a.key)}getRenderableIds(a){const d=[];for(const m in this._tiles)this._isIdRenderable(m,a)&&d.push(this._tiles[m]);return a?d.sort((m,_)=>{const A=m.tileID,B=_.tileID,R=new l.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),g=new l.P(B.canonical.x,B.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-B.overscaledZ||g.y-R.y||g.x-R.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(Te).map(m=>m.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,d){return l._(this,void 0,void 0,function*(){const m=this._tiles[a];m&&(m.state!=="loading"&&(m.state=d),yield this._loadTile(m,a,d))})}_tileLoaded(a,d,m){a.timeAdded=T.now(),m==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const d=this.getRenderableIds();for(let _=0;_<d.length;_++){const A=d[_];if(a.neighboringTiles&&a.neighboringTiles[A]){const B=this.getTileByID(A);m(a,B),m(B,a)}}function m(_,A){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let B=A.tileID.canonical.x-_.tileID.canonical.x;const R=A.tileID.canonical.y-_.tileID.canonical.y,g=Math.pow(2,_.tileID.canonical.z),b=A.tileID.key;B===0&&R===0||Math.abs(R)>1||(Math.abs(B)>1&&(Math.abs(B+g)===1?B+=g:Math.abs(B-g)===1&&(B-=g)),A.dem&&_.dem&&(_.dem.backfillBorder(A.dem,B,R),_.neighboringTiles&&_.neighboringTiles[b]&&(_.neighboringTiles[b].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,m,_){for(const A in this._tiles){let B=this._tiles[A];if(_[A]||!B.hasData()||B.tileID.overscaledZ<=d||B.tileID.overscaledZ>m)continue;let R=B.tileID;for(;B&&B.tileID.overscaledZ>d+1;){const b=B.tileID.scaledTo(B.tileID.overscaledZ-1);B=this._tiles[b.key],B&&B.hasData()&&(R=b)}let g=R;for(;g.overscaledZ>d;)if(g=g.scaledTo(g.overscaledZ-1),a[g.key]){_[R.key]=R;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const m=this._loadedParentTiles[a.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=a.overscaledZ-1;m>=d;m--){const _=a.scaledTo(m),A=this._getLoadedTile(_);if(A)return A}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const d=Math.ceil(a.width/this._source.tileSize)+1,m=Math.ceil(a.height/this._source.tileSize)+1,_=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(A)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const m={};for(const _ in this._tiles){const A=this._tiles[_];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),m[A.tileID.key]=A}this._tiles=m;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(a,d){if(!this._sourceLoaded||this._paused)return;let m;this.transform=a,this.terrain=d,this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new l.Q(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(m=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(m=m.filter(E=>this._source.hasTile(E)))):m=[];const _=a.coveringZoomLevel(this._source),A=Math.max(_-Ci.maxOverzooming,this._source.minzoom),B=Math.max(_+Ci.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const E={};for(const I of m)if(I.canonical.z>this._source.minzoom){const O=I.scaledTo(I.canonical.z-1);E[O.key]=O;const F=I.scaledTo(Math.max(this._source.minzoom,Math.min(I.canonical.z,5)));E[F.key]=F}m=m.concat(Object.values(E))}const R=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,R&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=this._updateRetainedTiles(m,_);if(Ke(this._source.type)){const E={},I={},O=Object.keys(g),F=T.now();for(const z of O){const V=g[z],U=this._tiles[z];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=F)continue;const W=this.findLoadedParent(V,A);W&&(this._addTile(W.tileID),E[W.tileID.key]=W.tileID),I[z]=V}this._retainLoadedChildren(I,_,B,g);for(const z in E)g[z]||(this._coveredTiles[z]=!0,g[z]=E[z]);if(d){const z={},V={};for(const U of m)this._tiles[U.key].hasData()?z[U.key]=U:V[U.key]=U;for(const U in V){const W=V[U].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(z[W[0].key]=g[W[0].key]=W[0],z[W[1].key]=g[W[1].key]=W[1],z[W[2].key]=g[W[2].key]=W[2],z[W[3].key]=g[W[3].key]=W[3],delete V[U])}for(const U in V){const W=this.findLoadedParent(V[U],this._source.minzoom);if(W){z[W.tileID.key]=g[W.tileID.key]=W.tileID;for(const at in z)z[at].isChildOf(W.tileID)&&delete z[at]}}for(const U in this._tiles)z[U]||(this._coveredTiles[U]=!0)}}for(const E in g)this._tiles[E].clearFadeHold();const b=l.ab(this._tiles,g);for(const E of b){const I=this._tiles[E];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,d){const m={},_={},A=Math.max(d-Ci.maxOverzooming,this._source.minzoom),B=Math.max(d+Ci.maxUnderzooming,this._source.minzoom),R={};for(const g of a){const b=this._addTile(g);m[g.key]=g,b.hasData()||d<this._source.maxzoom&&(R[g.key]=g)}this._retainLoadedChildren(R,d,B,m);for(const g of a){let b=this._tiles[g.key];if(b.hasData())continue;if(d+1>this._source.maxzoom){const I=g.children(this._source.maxzoom)[0],O=this.getTile(I);if(O&&O.hasData()){m[I.key]=I;continue}}else{const I=g.children(this._source.maxzoom);if(m[I[0].key]&&m[I[1].key]&&m[I[2].key]&&m[I[3].key])continue}let E=b.wasRequested();for(let I=g.overscaledZ-1;I>=A;--I){const O=g.scaledTo(I);if(_[O.key])break;if(_[O.key]=!0,b=this.getTile(O),!b&&E&&(b=this._addTile(O)),b){const F=b.hasData();if((E||F)&&(m[O.key]=O),E=b.wasRequested(),F)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let m,_=this._tiles[a].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){m=this._loadedParentTiles[_.key];break}d.push(_.key);const A=_.scaledTo(_.overscaledZ-1);if(m=this._getLoadedTile(A),m)break;_=A}for(const A of d)this._loadedParentTiles[A]=m}}_addTile(a){let d=this._tiles[a.key];if(d)return d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const m=d;return d||(d=new Ei(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(d,a.key,d.state)),d.uses++,this._tiles[a.key]=d,m||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const m=d.getExpiryTimeout();m&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},m))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(a){const d=a.sourceDataType;a.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,d,m){const _=[],A=this.transform;if(!A)return _;const B=m?A.getCameraQueryGeometry(a):a,R=a.map(z=>A.pointCoordinate(z,this.terrain)),g=B.map(z=>A.pointCoordinate(z,this.terrain)),b=this.getIds();let E=1/0,I=1/0,O=-1/0,F=-1/0;for(const z of g)E=Math.min(E,z.x),I=Math.min(I,z.y),O=Math.max(O,z.x),F=Math.max(F,z.y);for(let z=0;z<b.length;z++){const V=this._tiles[b[z]];if(V.holdingForFade())continue;const U=V.tileID,W=Math.pow(2,A.zoom-V.tileID.overscaledZ),at=d*V.queryPadding*l.W/V.tileSize/W,tt=[U.getTilePoint(new l.Y(E,I)),U.getTilePoint(new l.Y(O,F))];if(tt[0].x-at<l.W&&tt[0].y-at<l.W&&tt[1].x+at>=0&&tt[1].y+at>=0){const ht=R.map(Tt=>U.getTilePoint(Tt)),ut=g.map(Tt=>U.getTilePoint(Tt));_.push({tile:V,tileID:U,queryGeometry:ht,cameraQueryGeometry:ut,scale:W})}}return _}getVisibleCoordinates(a){const d=this.getRenderableIds(a).map(m=>this._tiles[m].tileID);for(const m of d)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Ke(this._source.type)){const a=T.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=a)return!0}return!1}setFeatureState(a,d,m){this._state.updateState(a=a||"_geojsonTileLayer",d,m)}removeFeatureState(a,d,m){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,m)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,m){const _=this._tiles[a];_&&_.setDependencies(d,m)}reloadTilesForDependencies(a,d){for(const m in this._tiles)this._tiles[m].hasDependency(a,d)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(a,d))}}function Te(w,a){const d=Math.abs(2*w.wrap)-+(w.wrap<0),m=Math.abs(2*a.wrap)-+(a.wrap<0);return w.overscaledZ-a.overscaledZ||m-d||a.canonical.y-w.canonical.y||a.canonical.x-w.canonical.x}function Ke(w){return w==="raster"||w==="image"||w==="video"}Ci.maxOverzooming=10,Ci.maxUnderzooming=3;class Qe{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=l.ac(a,0,1);let d=1,m=this._distances[d];const _=a*this.paddedLength+this.padding;for(;m<_&&d<this._distances.length;)m=this._distances[++d];const A=d-1,B=this._distances[A],R=m-B,g=R>0?(_-B)/R:0;return this.points[A].mult(1-g).add(this.points[d].mult(g))}}function hr(w,a){let d=!0;return w==="always"||w!=="never"&&a!=="never"||(d=!1),d}class Di{constructor(a,d,m){const _=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(a/m),this.yCellCount=Math.ceil(d/m);for(let B=0;B<this.xCellCount*this.yCellCount;B++)_.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,m,_,A){this._forEachCell(d,m,_,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_),this.bboxes.push(A)}insertCircle(a,d,m,_){this._forEachCell(d-_,m-_,d+_,m+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(m),this.circles.push(_)}_insertBoxCell(a,d,m,_,A,B){this.boxCells[A].push(B)}_insertCircleCell(a,d,m,_,A,B){this.circleCells[A].push(B)}_query(a,d,m,_,A,B,R){if(m<0||a>this.width||_<0||d>this.height)return[];const g=[];if(a<=0&&d<=0&&this.width<=m&&this.height<=_){if(A)return[{key:null,x1:a,y1:d,x2:m,y2:_}];for(let b=0;b<this.boxKeys.length;b++)g.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const E=this.circles[3*b],I=this.circles[3*b+1],O=this.circles[3*b+2];g.push({key:this.circleKeys[b],x1:E-O,y1:I-O,x2:E+O,y2:I+O})}}else this._forEachCell(a,d,m,_,this._queryCell,g,{hitTest:A,overlapMode:B,seenUids:{box:{},circle:{}}},R);return g}query(a,d,m,_){return this._query(a,d,m,_,!1,null)}hitTest(a,d,m,_,A,B){return this._query(a,d,m,_,!0,A,B).length>0}hitTestCircle(a,d,m,_,A){const B=a-m,R=a+m,g=d-m,b=d+m;if(R<0||B>this.width||b<0||g>this.height)return!1;const E=[];return this._forEachCell(B,g,R,b,this._queryCellCircle,E,{hitTest:!0,overlapMode:_,circle:{x:a,y:d,radius:m},seenUids:{box:{},circle:{}}},A),E.length>0}_queryCell(a,d,m,_,A,B,R,g){const{seenUids:b,hitTest:E,overlapMode:I}=R,O=this.boxCells[A];if(O!==null){const z=this.bboxes;for(const V of O)if(!b.box[V]){b.box[V]=!0;const U=4*V,W=this.boxKeys[V];if(a<=z[U+2]&&d<=z[U+3]&&m>=z[U+0]&&_>=z[U+1]&&(!g||g(W))&&(!E||!hr(I,W.overlapMode))&&(B.push({key:W,x1:z[U],y1:z[U+1],x2:z[U+2],y2:z[U+3]}),E))return!0}}const F=this.circleCells[A];if(F!==null){const z=this.circles;for(const V of F)if(!b.circle[V]){b.circle[V]=!0;const U=3*V,W=this.circleKeys[V];if(this._circleAndRectCollide(z[U],z[U+1],z[U+2],a,d,m,_)&&(!g||g(W))&&(!E||!hr(I,W.overlapMode))){const at=z[U],tt=z[U+1],ht=z[U+2];if(B.push({key:W,x1:at-ht,y1:tt-ht,x2:at+ht,y2:tt+ht}),E)return!0}}}return!1}_queryCellCircle(a,d,m,_,A,B,R,g){const{circle:b,seenUids:E,overlapMode:I}=R,O=this.boxCells[A];if(O!==null){const z=this.bboxes;for(const V of O)if(!E.box[V]){E.box[V]=!0;const U=4*V,W=this.boxKeys[V];if(this._circleAndRectCollide(b.x,b.y,b.radius,z[U+0],z[U+1],z[U+2],z[U+3])&&(!g||g(W))&&!hr(I,W.overlapMode))return B.push(!0),!0}}const F=this.circleCells[A];if(F!==null){const z=this.circles;for(const V of F)if(!E.circle[V]){E.circle[V]=!0;const U=3*V,W=this.circleKeys[V];if(this._circlesCollide(z[U],z[U+1],z[U+2],b.x,b.y,b.radius)&&(!g||g(W))&&!hr(I,W.overlapMode))return B.push(!0),!0}}}_forEachCell(a,d,m,_,A,B,R,g){const b=this._convertToXCellCoord(a),E=this._convertToYCellCoord(d),I=this._convertToXCellCoord(m),O=this._convertToYCellCoord(_);for(let F=b;F<=I;F++)for(let z=E;z<=O;z++)if(A.call(this,a,d,m,_,this.xCellCount*z+F,B,R,g))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,m,_,A,B){const R=_-a,g=A-d,b=m+B;return b*b>R*R+g*g}_circleAndRectCollide(a,d,m,_,A,B,R){const g=(B-_)/2,b=Math.abs(a-(_+g));if(b>g+m)return!1;const E=(R-A)/2,I=Math.abs(d-(A+E));if(I>E+m)return!1;if(b<=g||I<=E)return!0;const O=b-g,F=I-E;return O*O+F*F<=m*m}}function vi(w,a,d,m,_){const A=l.F();return a?(l.J(A,A,[1/_,1/_,1]),d||l.ad(A,A,m.angle)):l.K(A,m.labelPlaneMatrix,w),A}function yr(w,a,d,m,_){if(a){const A=l.ae(w);return l.J(A,A,[_,_,1]),d||l.ad(A,A,-m.angle),A}return m.glCoordMatrix}function sr(w,a,d){let m;d?(m=[w.x,w.y,d(w.x,w.y),1],l.af(m,m,a)):(m=[w.x,w.y,0,1],qe(m,m,a));const _=m[3];return{point:new l.P(m[0]/_,m[1]/_),signedDistanceFromCamera:_}}function vt(w,a){return .5+w/a*.5}function K(w,a){const d=w[0]/w[3],m=w[1]/w[3];return d>=-a[0]&&d<=a[0]&&m>=-a[1]&&m<=a[1]}function Y(w,a,d,m,_,A,B,R,g,b){const E=m?w.textSizeData:w.iconSizeData,I=l.ag(E,d.transform.zoom),O=[256/d.width*2+1,256/d.height*2+1],F=m?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;F.clear();const z=w.lineVertexArray,V=m?w.text.placedSymbolArray:w.icon.placedSymbolArray,U=d.transform.width/d.transform.height;let W=!1;for(let at=0;at<V.length;at++){const tt=V.get(at);if(tt.hidden||tt.writingMode===l.ah.vertical&&!W){ae(tt.numGlyphs,F);continue}let ht;if(W=!1,b?(ht=[tt.anchorX,tt.anchorY,b(tt.anchorX,tt.anchorY),1],l.af(ht,ht,a)):(ht=[tt.anchorX,tt.anchorY,0,1],qe(ht,ht,a)),!K(ht,O)){ae(tt.numGlyphs,F);continue}const ut=vt(d.transform.cameraToCenterDistance,ht[3]),Tt=l.ai(E,I,tt),bt=B?Tt/ut:Tt*ut,pt=new l.P(tt.anchorX,tt.anchorY),ft=sr(pt,_,b).point,jt={projections:{},offsets:{}},Wt=kt(tt,bt,!1,R,a,_,A,w.glyphOffsetArray,z,F,ft,pt,jt,U,g,b);W=Wt.useVertical,(Wt.notEnoughRoom||W||Wt.needsFlipping&&kt(tt,bt,!0,R,a,_,A,w.glyphOffsetArray,z,F,ft,pt,jt,U,g,b).notEnoughRoom)&&ae(tt.numGlyphs,F)}m?w.text.dynamicLayoutVertexBuffer.updateData(F):w.icon.dynamicLayoutVertexBuffer.updateData(F)}function st(w,a,d,m,_,A,B,R,g,b,E,I,O){const F=R.glyphStartIndex+R.numGlyphs,z=R.lineStartIndex,V=R.lineStartIndex+R.lineLength,U=a.getoffsetX(R.glyphStartIndex),W=a.getoffsetX(F-1),at=ye(w*U,d,m,_,A,B,R.segment,z,V,g,b,E,I,O);if(!at)return null;const tt=ye(w*W,d,m,_,A,B,R.segment,z,V,g,b,E,I,O);return tt?{first:at,last:tt}:null}function _t(w,a,d,m){return w===l.ah.horizontal&&Math.abs(d.y-a.y)>Math.abs(d.x-a.x)*m?{useVertical:!0}:(w===l.ah.vertical?a.y<d.y:a.x>d.x)?{needsFlipping:!0}:null}function kt(w,a,d,m,_,A,B,R,g,b,E,I,O,F,z,V){const U=a/24,W=w.lineOffsetX*U,at=w.lineOffsetY*U;let tt;if(w.numGlyphs>1){const ht=w.glyphStartIndex+w.numGlyphs,ut=w.lineStartIndex,Tt=w.lineStartIndex+w.lineLength,bt=st(U,R,W,at,d,E,I,w,g,A,O,z,V);if(!bt)return{notEnoughRoom:!0};const pt=sr(bt.first.point,B,V).point,ft=sr(bt.last.point,B,V).point;if(m&&!d){const jt=_t(w.writingMode,pt,ft,F);if(jt)return jt}tt=[bt.first];for(let jt=w.glyphStartIndex+1;jt<ht-1;jt++)tt.push(ye(U*R.getoffsetX(jt),W,at,d,E,I,w.segment,ut,Tt,g,A,O,z,V));tt.push(bt.last)}else{if(m&&!d){const ut=sr(I,_,V).point,Tt=w.lineStartIndex+w.segment+1,bt=new l.P(g.getx(Tt),g.gety(Tt)),pt=sr(bt,_,V),ft=pt.signedDistanceFromCamera>0?pt.point:Ft(I,bt,ut,1,_,V),jt=_t(w.writingMode,ut,ft,F);if(jt)return jt}const ht=ye(U*R.getoffsetX(w.glyphStartIndex),W,at,d,E,I,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,g,A,O,z,V);if(!ht)return{notEnoughRoom:!0};tt=[ht]}for(const ht of tt)l.aj(b,ht.point,ht.angle);return{}}function Ft(w,a,d,m,_,A){const B=sr(w.add(w.sub(a)._unit()),_,A).point,R=d.sub(B);return d.add(R._mult(m/R.mag()))}function Vt(w,a){const{projectionCache:d,lineVertexArray:m,labelPlaneMatrix:_,tileAnchorPoint:A,distanceFromAnchor:B,getElevation:R,previousVertex:g,direction:b,absOffsetX:E}=a;if(d.projections[w])return d.projections[w];const I=new l.P(m.getx(w),m.gety(w)),O=sr(I,_,R);if(O.signedDistanceFromCamera>0)return d.projections[w]=O.point,O.point;const F=w-b;return Ft(B===0?A:new l.P(m.getx(F),m.gety(F)),I,g,E-B+1,_,R)}function At(w,a,d){return w._unit()._perp()._mult(a*d)}function Jt(w,a,d,m,_,A,B,R){const{projectionCache:g,direction:b}=R;if(g.offsets[w])return g.offsets[w];const E=d.add(a);if(w+b<m||w+b>=_)return g.offsets[w]=E,E;const I=Vt(w+b,R),O=At(I.sub(d),B,b),F=d.add(O),z=I.add(O);return g.offsets[w]=l.ak(A,E,F,z)||E,g.offsets[w]}function ye(w,a,d,m,_,A,B,R,g,b,E,I,O,F){const z=m?w-a:w+a;let V=z>0?1:-1,U=0;m&&(V*=-1,U=Math.PI),V<0&&(U+=Math.PI);let W,at,tt=V>0?R+B:R+B+1,ht=_,ut=_,Tt=0,bt=0;const pt=Math.abs(z),ft=[];let jt;for(;Tt+bt<=pt;){if(tt+=V,tt<R||tt>=g)return null;Tt+=bt,ut=ht,at=W;const ne={projectionCache:I,lineVertexArray:b,labelPlaneMatrix:E,tileAnchorPoint:A,distanceFromAnchor:Tt,getElevation:F,previousVertex:ut,direction:V,absOffsetX:pt};if(ht=Vt(tt,ne),d===0)ft.push(ut),jt=ht.sub(ut);else{let fe;const Me=ht.sub(ut);fe=Me.mag()===0?At(Vt(tt+V,ne).sub(ht),d,V):At(Me,d,V),at||(at=ut.add(fe)),W=Jt(tt,fe,ht,R,g,at,d,ne),ft.push(at),jt=W.sub(at)}bt=jt.mag()}const Wt=jt._mult((pt-Tt)/bt)._add(at||ut),se=U+Math.atan2(ht.y-ut.y,ht.x-ut.x);return ft.push(Wt),{point:Wt,angle:O?se:0,path:ft}}const he=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ae(w,a){for(let d=0;d<w;d++){const m=a.length;a.resize(m+4),a.float32.set(he,3*m)}}function qe(w,a,d){const m=a[0],_=a[1];return w[0]=d[0]*m+d[4]*_+d[12],w[1]=d[1]*m+d[5]*_+d[13],w[3]=d[3]*m+d[7]*_+d[15],w}const Je=100;class bi{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Di(a.width+200,a.height+200,25),m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Di(a.width+200,a.height+200,25);this.transform=a,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Je,this.screenBottomBoundary=a.height+Je,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,d,m,_,A,B){const R=this.projectAndGetPerspectiveRatio(_,a.anchorPointX,a.anchorPointY,B),g=m*R.perspectiveRatio,b=a.x1*g+R.point.x,E=a.y1*g+R.point.y,I=a.x2*g+R.point.x,O=a.y2*g+R.point.y;return!this.isInsideGrid(b,E,I,O)||d!=="always"&&this.grid.hitTest(b,E,I,O,d,A)||R.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[b,E,I,O],offscreen:this.isOffscreen(b,E,I,O)}}placeCollisionCircles(a,d,m,_,A,B,R,g,b,E,I,O,F,z){const V=[],U=new l.P(d.anchorX,d.anchorY),W=sr(U,B,z),at=vt(this.transform.cameraToCenterDistance,W.signedDistanceFromCamera),tt=(E?A/at:A*at)/l.ao,ht=sr(U,R,z).point,ut=st(tt,_,d.lineOffsetX*tt,d.lineOffsetY*tt,!1,ht,U,d,m,R,{projections:{},offsets:{}},!1,z);let Tt=!1,bt=!1,pt=!0;if(ut){const ft=.5*O*at+F,jt=new l.P(-100,-100),Wt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),se=new Qe,ne=ut.first,fe=ut.last;let Me=[];for(let $e=ne.path.length-1;$e>=1;$e--)Me.push(ne.path[$e]);for(let $e=1;$e<fe.path.length;$e++)Me.push(fe.path[$e]);const we=2.5*ft;if(g){const $e=Me.map(Ze=>sr(Ze,g,z));Me=$e.some(Ze=>Ze.signedDistanceFromCamera<=0)?[]:$e.map(Ze=>Ze.point)}let je=[];if(Me.length>0){const $e=Me[0].clone(),Ze=Me[0].clone();for(let yi=1;yi<Me.length;yi++)$e.x=Math.min($e.x,Me[yi].x),$e.y=Math.min($e.y,Me[yi].y),Ze.x=Math.max(Ze.x,Me[yi].x),Ze.y=Math.max(Ze.y,Me[yi].y);je=$e.x>=jt.x&&Ze.x<=Wt.x&&$e.y>=jt.y&&Ze.y<=Wt.y?[Me]:Ze.x<jt.x||$e.x>Wt.x||Ze.y<jt.y||$e.y>Wt.y?[]:l.al([Me],jt.x,jt.y,Wt.x,Wt.y)}for(const $e of je){se.reset($e,.25*ft);let Ze=0;Ze=se.length<=.5*ft?1:Math.ceil(se.paddedLength/we)+1;for(let yi=0;yi<Ze;yi++){const _i=yi/Math.max(Ze-1,1),Ui=se.lerp(_i),pi=Ui.x+Je,zi=Ui.y+Je;V.push(pi,zi,ft,0);const or=pi-ft,ar=zi-ft,$r=pi+ft,Yi=zi+ft;if(pt=pt&&this.isOffscreen(or,ar,$r,Yi),bt=bt||this.isInsideGrid(or,ar,$r,Yi),a!=="always"&&this.grid.hitTestCircle(pi,zi,ft,a,I)&&(Tt=!0,!b))return{circles:[],offscreen:!1,collisionDetected:Tt}}}}return{circles:!b&&Tt||!bt||at<this.perspectiveRatioCutoff?[]:V,offscreen:pt,collisionDetected:Tt}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let m=1/0,_=1/0,A=-1/0,B=-1/0;for(const E of a){const I=new l.P(E.x+Je,E.y+Je);m=Math.min(m,I.x),_=Math.min(_,I.y),A=Math.max(A,I.x),B=Math.max(B,I.y),d.push(I)}const R=this.grid.query(m,_,A,B).concat(this.ignoredGrid.query(m,_,A,B)),g={},b={};for(const E of R){const I=E.key;if(g[I.bucketInstanceId]===void 0&&(g[I.bucketInstanceId]={}),g[I.bucketInstanceId][I.featureIndex])continue;const O=[new l.P(E.x1,E.y1),new l.P(E.x2,E.y1),new l.P(E.x2,E.y2),new l.P(E.x1,E.y2)];l.am(d,O)&&(g[I.bucketInstanceId][I.featureIndex]=!0,b[I.bucketInstanceId]===void 0&&(b[I.bucketInstanceId]=[]),b[I.bucketInstanceId].push(I.featureIndex))}return b}insertCollisionBox(a,d,m,_,A,B){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:A,collisionGroupID:B,overlapMode:d},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,m,_,A,B){const R=m?this.ignoredGrid:this.grid,g={bucketInstanceId:_,featureIndex:A,collisionGroupID:B,overlapMode:d};for(let b=0;b<a.length;b+=4)R.insertCircle(g,a[b],a[b+1],a[b+2])}projectAndGetPerspectiveRatio(a,d,m,_){let A;return _?(A=[d,m,_(d,m),1],l.af(A,A,a)):(A=[d,m,0,1],qe(A,A,a)),{point:new l.P((A[0]/A[3]+1)/2*this.transform.width+Je,(-A[1]/A[3]+1)/2*this.transform.height+Je),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A[3]*.5}}isOffscreen(a,d,m,_){return m<Je||a>=this.screenRightBoundary||_<Je||d>this.screenBottomBoundary}isInsideGrid(a,d,m,_){return m>=0&&a<this.gridRightBoundary&&_>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=l.an([]);return l.H(a,a,[-100,-100,0]),a}}function si(w,a,d){return a*(l.W/(w.tileSize*Math.pow(2,d-w.tileID.overscaledZ)))}class Si{constructor(a,d,m,_){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):_&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Ni{constructor(a,d,m,_,A){this.text=new Si(a?a.text:null,d,m,A),this.icon=new Si(a?a.icon:null,d,_,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hi{constructor(a,d,m){this.text=a,this.icon=d,this.skipFade=m}}class nr{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class li{constructor(a,d,m,_,A){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=_,this.tileID=A}}class ji{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[a]}}function ur(w,a,d,m,_){const{horizontalAlign:A,verticalAlign:B}=l.at(w);return new l.P(-(A-.5)*a+m[0]*_,-(B-.5)*d+m[1]*_)}function Mr(w,a,d,m,_,A){const{x1:B,x2:R,y1:g,y2:b,anchorPointX:E,anchorPointY:I}=w,O=new l.P(a,d);return m&&O._rotate(_?A:-A),{x1:B+O.x,y1:g+O.y,x2:R+O.x,y2:b+O.y,anchorPointX:E,anchorPointY:I}}class Ur{constructor(a,d,m,_,A){this.transform=a.clone(),this.terrain=d,this.collisionIndex=new bi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new ji(_),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,m,_){const A=m.getBucket(d),B=m.latestFeatureIndex;if(!A||!B||d.id!==A.layerIds[0])return;const R=m.collisionBoxArray,g=A.layers[0].layout,b=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),E=m.tileSize/l.W,I=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),O=g.get("text-pitch-alignment")==="map",F=g.get("text-rotation-alignment")==="map",z=si(m,1,this.transform.zoom),V=vi(I,O,F,this.transform,z);let U=null;if(O){const at=yr(I,O,F,this.transform,z);U=l.K([],this.transform.labelPlaneMatrix,at)}this.retainedQueryData[A.bucketInstanceId]=new li(A.bucketInstanceId,B,A.sourceLayerIndex,A.index,m.tileID);const W={bucket:A,layout:g,posMatrix:I,textLabelPlaneMatrix:V,labelToScreenMatrix:U,scale:b,textPixelRatio:E,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:l.ag(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(_)for(const at of A.sortKeyRanges){const{sortKey:tt,symbolInstanceStart:ht,symbolInstanceEnd:ut}=at;a.push({sortKey:tt,symbolInstanceStart:ht,symbolInstanceEnd:ut,parameters:W})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:W})}attemptAnchorPlacement(a,d,m,_,A,B,R,g,b,E,I,O,F,z,V,U){const W=l.ap[a.textAnchor],at=[a.textOffset0,a.textOffset1],tt=ur(W,m,_,at,A),ht=this.collisionIndex.placeCollisionBox(Mr(d,tt.x,tt.y,B,R,this.transform.angle),I,g,b,E.predicate,U);if((!V||this.collisionIndex.placeCollisionBox(Mr(V,tt.x,tt.y,B,R,this.transform.angle),I,g,b,E.predicate,U).box.length!==0)&&ht.box.length>0){let ut;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(ut=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:at,width:m,height:_,anchor:W,textBoxScale:A,prevAnchor:ut},this.markUsedJustification(F,W,O,z),F.allowVerticalPlacement&&(this.markUsedOrientation(F,z,O),this.placedOrientations[O.crossTileID]=z),{shift:tt,placedGlyphBoxes:ht}}}placeLayerBucketPart(a,d,m){const{bucket:_,layout:A,posMatrix:B,textLabelPlaneMatrix:R,labelToScreenMatrix:g,textPixelRatio:b,holdingForFade:E,collisionBoxArray:I,partiallyEvaluatedTextSize:O,collisionGroup:F}=a.parameters,z=A.get("text-optional"),V=A.get("icon-optional"),U=l.aq(A,"text-overlap","text-allow-overlap"),W=U==="always",at=l.aq(A,"icon-overlap","icon-allow-overlap"),tt=at==="always",ht=A.get("text-rotation-alignment")==="map",ut=A.get("text-pitch-alignment")==="map",Tt=A.get("icon-text-fit")!=="none",bt=A.get("symbol-z-order")==="viewport-y",pt=W&&(tt||!_.hasIconData()||V),ft=tt&&(W||!_.hasTextData()||z);!_.collisionArrays&&I&&_.deserializeCollisionBoxes(I);const jt=this.retainedQueryData[_.bucketInstanceId].tileID,Wt=this.terrain?(ne,fe)=>this.terrain.getElevation(jt,ne,fe):null,se=(ne,fe)=>{var Me,we;if(d[ne.crossTileID])return;if(E)return void(this.placements[ne.crossTileID]=new Hi(!1,!1,!1));let je=!1,$e=!1,Ze=!0,yi=null,_i={box:null,offscreen:null},Ui={box:null,offscreen:null},pi=null,zi=null,or=null,ar=0,$r=0,Yi=0;fe.textFeatureIndex?ar=fe.textFeatureIndex:ne.useRuntimeCollisionCircles&&(ar=ne.featureIndex),fe.verticalTextFeatureIndex&&($r=fe.verticalTextFeatureIndex);const Ns=fe.textBox;if(Ns){const Qi=$i=>{let lr=l.ah.horizontal;if(_.allowVerticalPlacement&&!$i&&this.prevPlacement){const Ts=this.prevPlacement.placedOrientations[ne.crossTileID];Ts&&(this.placedOrientations[ne.crossTileID]=Ts,lr=Ts,this.markUsedOrientation(_,lr,ne))}return lr},Wi=($i,lr)=>{if(_.allowVerticalPlacement&&ne.numVerticalGlyphVertices>0&&fe.verticalTextBox){for(const Ts of _.writingModes)if(Ts===l.ah.vertical?(_i=lr(),Ui=_i):_i=$i(),_i&&_i.box&&_i.box.length)break}else _i=$i()},tr=ne.textAnchorOffsetStartIndex,as=ne.textAnchorOffsetEndIndex;if(as===tr){const $i=(lr,Ts)=>{const Nr=this.collisionIndex.placeCollisionBox(lr,U,b,B,F.predicate,Wt);return Nr&&Nr.box&&Nr.box.length&&(this.markUsedOrientation(_,Ts,ne),this.placedOrientations[ne.crossTileID]=Ts),Nr};Wi(()=>$i(Ns,l.ah.horizontal),()=>{const lr=fe.verticalTextBox;return _.allowVerticalPlacement&&ne.numVerticalGlyphVertices>0&&lr?$i(lr,l.ah.vertical):{box:null,offscreen:null}}),Qi(_i&&_i.box&&_i.box.length)}else{let $i=l.ap[(we=(Me=this.prevPlacement)===null||Me===void 0?void 0:Me.variableOffsets[ne.crossTileID])===null||we===void 0?void 0:we.anchor];const lr=(Nr,br,qr)=>{const uh=Nr.x2-Nr.x1,Pa=Nr.y2-Nr.y1,Ia=ne.textBoxScale,ul=Tt&&at==="never"?br:null;let zn={box:[],offscreen:!1},Zl=U==="never"?1:2,jn="never";$i&&Zl++;for(let Ma=0;Ma<Zl;Ma++){for(let La=tr;La<as;La++){const Bc=_.textAnchorOffsets.get(La);if($i&&Bc.textAnchor!==$i)continue;const Xl=this.attemptAnchorPlacement(Bc,Nr,uh,Pa,Ia,ht,ut,b,B,F,jn,ne,_,qr,ul,Wt);if(Xl&&(zn=Xl.placedGlyphBoxes,zn&&zn.box&&zn.box.length))return je=!0,yi=Xl.shift,zn}$i?$i=null:jn=U}return zn};Wi(()=>lr(Ns,fe.iconBox,l.ah.horizontal),()=>{const Nr=fe.verticalTextBox;return _.allowVerticalPlacement&&!(_i&&_i.box&&_i.box.length)&&ne.numVerticalGlyphVertices>0&&Nr?lr(Nr,fe.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),_i&&(je=_i.box,Ze=_i.offscreen);const Ts=Qi(_i&&_i.box);if(!je&&this.prevPlacement){const Nr=this.prevPlacement.variableOffsets[ne.crossTileID];Nr&&(this.variableOffsets[ne.crossTileID]=Nr,this.markUsedJustification(_,Nr.anchor,ne,Ts))}}}if(pi=_i,je=pi&&pi.box&&pi.box.length>0,Ze=pi&&pi.offscreen,ne.useRuntimeCollisionCircles){const Qi=_.text.placedSymbolArray.get(ne.centerJustifiedTextSymbolIndex),Wi=l.ai(_.textSizeData,O,Qi),tr=A.get("text-padding");zi=this.collisionIndex.placeCollisionCircles(U,Qi,_.lineVertexArray,_.glyphOffsetArray,Wi,B,R,g,m,ut,F.predicate,ne.collisionCircleDiameter,tr,Wt),zi.circles.length&&zi.collisionDetected&&!m&&l.w("Collisions detected, but collision boxes are not shown"),je=W||zi.circles.length>0&&!zi.collisionDetected,Ze=Ze&&zi.offscreen}if(fe.iconFeatureIndex&&(Yi=fe.iconFeatureIndex),fe.iconBox){const Qi=Wi=>{const tr=Tt&&yi?Mr(Wi,yi.x,yi.y,ht,ut,this.transform.angle):Wi;return this.collisionIndex.placeCollisionBox(tr,at,b,B,F.predicate,Wt)};Ui&&Ui.box&&Ui.box.length&&fe.verticalIconBox?(or=Qi(fe.verticalIconBox),$e=or.box.length>0):(or=Qi(fe.iconBox),$e=or.box.length>0),Ze=Ze&&or.offscreen}const us=z||ne.numHorizontalGlyphVertices===0&&ne.numVerticalGlyphVertices===0,Tr=V||ne.numIconVertices===0;if(us||Tr?Tr?us||($e=$e&&je):je=$e&&je:$e=je=$e&&je,je&&pi&&pi.box&&this.collisionIndex.insertCollisionBox(pi.box,U,A.get("text-ignore-placement"),_.bucketInstanceId,Ui&&Ui.box&&$r?$r:ar,F.ID),$e&&or&&this.collisionIndex.insertCollisionBox(or.box,at,A.get("icon-ignore-placement"),_.bucketInstanceId,Yi,F.ID),zi&&(je&&this.collisionIndex.insertCollisionCircles(zi.circles,U,A.get("text-ignore-placement"),_.bucketInstanceId,ar,F.ID),m)){const Qi=_.bucketInstanceId;let Wi=this.collisionCircleArrays[Qi];Wi===void 0&&(Wi=this.collisionCircleArrays[Qi]=new nr);for(let tr=0;tr<zi.circles.length;tr+=4)Wi.circles.push(zi.circles[tr+0]),Wi.circles.push(zi.circles[tr+1]),Wi.circles.push(zi.circles[tr+2]),Wi.circles.push(zi.collisionDetected?1:0)}if(ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ne.crossTileID]=new Hi(je||pt,$e||ft,Ze||_.justReloaded),d[ne.crossTileID]=!0};if(bt){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ne=_.getSortedSymbolIndexes(this.transform.angle);for(let fe=ne.length-1;fe>=0;--fe){const Me=ne[fe];se(_.symbolInstances.get(Me),_.collisionArrays[Me])}}else for(let ne=a.symbolInstanceStart;ne<a.symbolInstanceEnd;ne++)se(_.symbolInstances.get(ne),_.collisionArrays[ne]);if(m&&_.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[_.bucketInstanceId];l.ar(ne.invProjMatrix,B),ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(a,d,m,_){let A;A=_===l.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.as(d)];const B=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of B)R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=A>=0&&R!==A?0:m.crossTileID)}markUsedOrientation(a,d,m){const _=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,A=d===l.ah.vertical?d:0,B=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of B)a.text.placedSymbolArray.get(R).placedOrientation=_;m.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const _=d?d.symbolFadeChange(a):1,A=d?d.opacities:{},B=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(const g in this.placements){const b=this.placements[g],E=A[g];E?(this.opacities[g]=new Ni(E,_,b.text,b.icon),m=m||b.text!==E.text.placed||b.icon!==E.icon.placed):(this.opacities[g]=new Ni(null,_,b.text,b.icon,b.skipFade),m=m||b.text||b.icon)}for(const g in A){const b=A[g];if(!this.opacities[g]){const E=new Ni(b,_,!1,!1);E.isHidden()||(this.opacities[g]=E,m=m||b.text.placed||b.icon.placed)}}for(const g in B)this.variableOffsets[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.variableOffsets[g]=B[g]);for(const g in R)this.placedOrientations[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.placedOrientations[g]=R[g]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const m={};for(const _ of d){const A=_.getBucket(a);A&&_.latestFeatureIndex&&a.id===A.layerIds[0]&&this.updateBucketOpacities(A,m,_.collisionBoxArray)}}updateBucketOpacities(a,d,m){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const _=a.layers[0],A=_.layout,B=new Ni(null,0,!1,!1,!0),R=A.get("text-allow-overlap"),g=A.get("icon-allow-overlap"),b=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),E=A.get("text-rotation-alignment")==="map",I=A.get("text-pitch-alignment")==="map",O=A.get("icon-text-fit")!=="none",F=new Ni(null,0,R&&(g||!a.hasIconData()||A.get("icon-optional")),g&&(R||!a.hasTextData()||A.get("text-optional")),!0);!a.collisionArrays&&m&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(m);const z=(V,U,W)=>{for(let at=0;at<U/4;at++)V.opacityVertexArray.emplaceBack(W);V.hasVisibleVertices=V.hasVisibleVertices||W!==xs};for(let V=0;V<a.symbolInstances.length;V++){const U=a.symbolInstances.get(V),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:at,crossTileID:tt}=U;let ht=this.opacities[tt];d[tt]?ht=B:ht||(ht=F,this.opacities[tt]=ht),d[tt]=!0;const ut=U.numIconVertices>0,Tt=this.placedOrientations[U.crossTileID],bt=Tt===l.ah.vertical,pt=Tt===l.ah.horizontal||Tt===l.ah.horizontalOnly;if(W>0||at>0){const ft=Gr(ht.text);z(a.text,W,bt?xs:ft),z(a.text,at,pt?xs:ft);const jt=ht.text.isHidden();[U.rightJustifiedTextSymbolIndex,U.centerJustifiedTextSymbolIndex,U.leftJustifiedTextSymbolIndex].forEach(ne=>{ne>=0&&(a.text.placedSymbolArray.get(ne).hidden=jt||bt?1:0)}),U.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(U.verticalPlacedTextSymbolIndex).hidden=jt||pt?1:0);const Wt=this.variableOffsets[U.crossTileID];Wt&&this.markUsedJustification(a,Wt.anchor,U,Tt);const se=this.placedOrientations[U.crossTileID];se&&(this.markUsedJustification(a,"left",U,se),this.markUsedOrientation(a,se,U))}if(ut){const ft=Gr(ht.icon),jt=!(O&&U.verticalPlacedIconSymbolIndex&&bt);U.placedIconSymbolIndex>=0&&(z(a.icon,U.numIconVertices,jt?ft:xs),a.icon.placedSymbolArray.get(U.placedIconSymbolIndex).hidden=ht.icon.isHidden()),U.verticalPlacedIconSymbolIndex>=0&&(z(a.icon,U.numVerticalIconVertices,jt?xs:ft),a.icon.placedSymbolArray.get(U.verticalPlacedIconSymbolIndex).hidden=ht.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ft=a.collisionArrays[V];if(ft){let jt=new l.P(0,0);if(ft.textBox||ft.verticalTextBox){let se=!0;if(b){const ne=this.variableOffsets[tt];ne?(jt=ur(ne.anchor,ne.width,ne.height,ne.textOffset,ne.textBoxScale),E&&jt._rotate(I?this.transform.angle:-this.transform.angle)):se=!1}ft.textBox&&Er(a.textCollisionBox.collisionVertexArray,ht.text.placed,!se||bt,jt.x,jt.y),ft.verticalTextBox&&Er(a.textCollisionBox.collisionVertexArray,ht.text.placed,!se||pt,jt.x,jt.y)}const Wt=!!(!pt&&ft.verticalIconBox);ft.iconBox&&Er(a.iconCollisionBox.collisionVertexArray,ht.icon.placed,Wt,O?jt.x:0,O?jt.y:0),ft.verticalIconBox&&Er(a.iconCollisionBox.collisionVertexArray,ht.icon.placed,!Wt,O?jt.x:0,O?jt.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const V=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=V.invProjMatrix,a.placementViewportMatrix=V.viewportMatrix,a.collisionCircleArray=V.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>a}setStale(){this.stale=!0}}function Er(w,a,d,m,_){w.emplaceBack(a?1:0,d?1:0,m||0,_||0),w.emplaceBack(a?1:0,d?1:0,m||0,_||0),w.emplaceBack(a?1:0,d?1:0,m||0,_||0),w.emplaceBack(a?1:0,d?1:0,m||0,_||0)}const ks=Math.pow(2,25),qa=Math.pow(2,24),da=Math.pow(2,17),Bi=Math.pow(2,16),$s=Math.pow(2,9),Ks=Math.pow(2,8),Rr=Math.pow(2,1);function Gr(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const a=w.placed?1:0,d=Math.floor(127*w.opacity);return d*ks+a*qa+d*da+a*Bi+d*$s+a*Ks+d*Rr+a}const xs=0;class kr{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,d,m,_,A){const B=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(B,_,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,B.sort((R,g)=>R.sortKey-g.sortKey));this._currentPartIndex<B.length;)if(d.placeLayerBucketPart(B[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,A())return!0;return!1}}class Os{constructor(a,d,m,_,A,B,R,g){this.placement=new Ur(a,d,B,R,g),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(a,d,m){const _=T.now(),A=()=>!this._forceFullPlacement&&T.now()-_>2;for(;this._currentPlacementIndex>=0;){const B=d[a[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=R)&&(!B.maxzoom||B.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new kr(B)),this._inProgressLayer.continuePlacement(m[B.source],this.placement,this._showCollisionBoxes,B,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const nn=512/l.W/2;class to{constructor(a,d,m){this.tileID=a,this.bucketInstanceId=m,this._symbolsByKey={};const _=new Map;for(let A=0;A<d.length;A++){const B=d.get(A),R=B.key,g=_.get(R);g?g.push(B):_.set(R,[B])}for(const[A,B]of _){const R={positions:B.map(g=>({x:Math.floor(g.anchorX*nn),y:Math.floor(g.anchorY*nn)})),crossTileIDs:B.map(g=>g.crossTileID)};if(R.positions.length>128){const g=new l.au(R.positions.length,16,Uint16Array);for(const{x:b,y:E}of R.positions)g.add(b,E);g.finish(),delete R.positions,R.index=g}this._symbolsByKey[A]=R}}getScaledCoordinates(a,d){const{x:m,y:_,z:A}=this.tileID.canonical,{x:B,y:R,z:g}=d.canonical,b=nn/Math.pow(2,g-A),E=(R*l.W+a.anchorY)*b,I=_*l.W*nn;return{x:Math.floor((B*l.W+a.anchorX)*b-m*l.W*nn),y:Math.floor(E-I)}}findMatches(a,d,m){const _=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let A=0;A<a.length;A++){const B=a.get(A);if(B.crossTileID)continue;const R=this._symbolsByKey[B.key];if(!R)continue;const g=this.getScaledCoordinates(B,d);if(R.index){const b=R.index.range(g.x-_,g.y-_,g.x+_,g.y+_).sort();for(const E of b){const I=R.crossTileIDs[E];if(!m[I]){m[I]=!0,B.crossTileID=I;break}}}else if(R.positions)for(let b=0;b<R.positions.length;b++){const E=R.positions[b],I=R.crossTileIDs[b];if(Math.abs(E.x-g.x)<=_&&Math.abs(E.y-g.y)<=_&&!m[I]){m[I]=!0,B.crossTileID=I;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(a=>{let{crossTileIDs:d}=a;return d})}}class xi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(d!==0)for(const m in this.indexes){const _=this.indexes[m],A={};for(const B in _){const R=_[B];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),A[R.tileID.key]=R}this.indexes[m]=A}this.lng=a}addBucket(a,d,m){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let A=0;A<d.symbolInstances.length;A++)d.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const _=this.usedCrossTileIDs[a.overscaledZ];for(const A in this.indexes){const B=this.indexes[A];if(Number(A)>a.overscaledZ)for(const R in B){const g=B[R];g.tileID.isChildOf(a)&&g.findMatches(d.symbolInstances,a,_)}else{const R=B[a.scaledTo(Number(A)).key];R&&R.findMatches(d.symbolInstances,a,_)}}for(let A=0;A<d.symbolInstances.length;A++){const B=d.symbolInstances.get(A);B.crossTileID||(B.crossTileID=m.generate(),_[B.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new to(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const m of d.getCrossTileIDsLists())for(const _ of m)delete this.usedCrossTileIDs[a][_]}removeStaleBuckets(a){let d=!1;for(const m in this.indexes){const _=this.indexes[m];for(const A in _)a[_[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,_[A]),delete _[A],d=!0)}return d}}class Ys{constructor(){this.layerIndexes={},this.crossTileIDs=new xi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,m){let _=this.layerIndexes[a.id];_===void 0&&(_=this.layerIndexes[a.id]=new wn);let A=!1;const B={};_.handleWrapJump(m);for(const R of d){const g=R.getBucket(a);g&&a.id===g.layerIds[0]&&(g.bucketInstanceId||(g.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(R.tileID,g,this.crossTileIDs)&&(A=!0),B[g.bucketInstanceId]=!0)}return _.removeStaleBuckets(B)&&(A=!0),A}pruneUnusedLayers(a){const d={};a.forEach(m=>{d[m]=!0});for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}const dr=(w,a)=>l.t(w,a&&a.filter(d=>d.identifier!=="source.canvas")),Rn=l.av();class ds extends l.E{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const _=this.sourceCaches[m].getSource().type;_!=="vector"&&_!=="geojson"||this.sourceCaches[m].reload()}},this.map=a,this.dispatcher=new ie(Kt(),a._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,_)=>this.getGlyphs(m,_)),this.dispatcher.registerMessageHandler("GI",(m,_)=>this.getImages(m,_)),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new de(a._requestManager,d.localIdeographFontFamily),this.lineAtlas=new ke(256,512),this.crossTileSymbolIndex=new Ys,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ax()),ce().on(Pi,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.sourceCaches[m.sourceId];if(!_)return;const A=_.getSource();if(A&&A.vectorLayerIds)for(const B in this._layers){const R=this._layers[B];R.source===A.id&&this._validateLayer(R)}})}loadURL(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const _=this.map._requestManager.transformRequest(a,"Style");this._loadStyleRequest=new AbortController,l.h(_,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,d,m)}).catch(A=>{this._loadStyleRequest=null,A&&this.fire(new l.j(A))})}loadJSON(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(a,d,m)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Rn,{validate:!1})}_load(a,d,m){var _;const A=d.transformStyle?d.transformStyle(m,a):a;if(!d.validate||!dr(this,l.x(A))){this._loaded=!0,this.stylesheet=A;for(const B in A.sources)this.addSource(B,A.sources[B],{validate:!1});A.sprite?this._loadSprite(A.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(A.glyphs),this._createLayers(),this.light=new ge(this.stylesheet.light),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const a=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",a),this._order=a.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of a){const m=l.az(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,_;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(A,B,R,g){return l._(this,void 0,void 0,function*(){const b=zt(A),E=R>1?"@2x":"",I={},O={};for(const{id:F,url:z}of b){const V=B.transformRequest(B.normalizeSpriteURL(z,E,".json"),"SpriteJSON");I[F]=l.h(V,g);const U=B.transformRequest(B.normalizeSpriteURL(z,E,".png"),"SpriteImage");O[F]=ct.getImage(U,g)}return yield Promise.all([...Object.values(I),...Object.values(O)]),function(F,z){return l._(this,void 0,void 0,function*(){const V={};for(const U in F){V[U]={};const W=T.getImageCanvasContext((yield z[U]).data),at=(yield F[U]).data;for(const tt in at){const{width:ht,height:ut,x:Tt,y:bt,sdf:pt,pixelRatio:ft,stretchX:jt,stretchY:Wt,content:se}=at[tt];V[U][tt]={data:null,pixelRatio:ft,sdf:pt,stretchX:jt,stretchY:Wt,content:se,spriteData:{width:ht,height:ut,x:Tt,y:bt,context:W}}}}return V})}(I,O)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(A=>{if(this._spriteRequest=null,A)for(const B in A){this._spritesImagesIds[B]=[];const R=this._spritesImagesIds[B]?this._spritesImagesIds[B].filter(g=>!(g in A)):[];for(const g of R)this.imageManager.removeImage(g),this._changedImages[g]=!0;for(const g in A[B]){const b=B==="default"?g:`${B}:${g}`;this._spritesImagesIds[B].push(b),b in this.imageManager.images?this.imageManager.updateImage(b,A[B][g],!1):this.imageManager.addImage(b,A[B][g]),d&&(this._changedImages[b]=!0)}}}).catch(A=>{this._spriteRequest=null,_=A,this.fire(new l.j(_))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),m&&m(_)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(a){const d=this.sourceCaches[a.source];if(!d)return;const m=a.sourceLayer;if(!m)return;const _=d.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(m)===-1)&&this.fire(new l.j(new Error(`Source layer "${m}" does not exist on source "${_.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const d=this._serializedAllLayers();if(!a||a.length===0)return Object.values(d);const m=[];for(const _ of a)d[_]&&m.push(d[_]);return m}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const _=this._layers[m];_.type!=="custom"&&(a[m]=_.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const d=this._changed;if(d){const _=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(_.length||A.length)&&this._updateWorkerLayers(_,A);for(const B in this._updatedSources){const R=this._updatedSources[B];if(R==="reload")this._reloadSource(B);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(B)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const B in this._updatedPaintProps)this._layers[B].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const m={};for(const _ in this.sourceCaches){const A=this.sourceCaches[_];m[_]=A.used,A.used=!1}for(const _ of this._order){const A=this._layers[_];A.recalculate(a,this._availableImages),!A.isHidden(a.zoom)&&A.source&&(this.sourceCaches[A.source].used=!0)}for(const _ in m){const A=this.sourceCaches[_];!!m[_]!=!!A.used&&A.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(a),this.z=a.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var m;this._checkLoaded();const _=this.serialize();if(a=d.transformStyle?d.transformStyle(_,a):a,((m=d.validate)===null||m===void 0||m)&&dr(this,l.x(a)))return!1;(a=l.aA(a)).layers=l.ay(a.layers);const A=l.aB(_,a),B=this._getOperationsToPerform(A);if(B.unimplemented.length>0)throw new Error(`Unimplemented: ${B.unimplemented.join(", ")}.`);if(B.operations.length===0)return!1;for(const R of B.operations)R();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const d=[],m=[];for(const _ of a)switch(_.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,_.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,_.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,_.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,_.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,_.args));break;case"addSource":d.push(()=>this.addSource.apply(this,_.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,_.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,_.args));break;case"setLight":d.push(()=>this.setLight.apply(this,_.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,_.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,_.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,_.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,_.args));break;case"setTransition":d.push(()=>{});break;default:m.push(_.command)}return{operations:d,unimplemented:m}}addImage(a,d){if(this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,d),this._afterImageUpdated(a)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.x.source,`sources.${a}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const _=this.sourceCaches[a]=new Ci(a,d,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:_.loaded(),source:_.serialize(),sourceId:a})),_.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===a)return this.fire(new l.j(new Error(`Source "${a}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,d){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const m=this.sourceCaches[a].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const _=a.id;if(this.getLayer(_))return void this.fire(new l.j(new Error(`Layer "${_}" already exists on this map.`)));let A;if(a.type==="custom"){if(dr(this,l.aC(a)))return;A=l.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(_,a.source),a=l.aA(a),a=l.e(a,{source:_})),this._validate(l.x.layer,`layers.${_}`,a,{arrayIndex:-1},m))return;A=l.az(a),this._validateLayer(A),A.setEventedParent(this,{layer:{id:_}})}const B=d?this._order.indexOf(d):this._order.length;if(d&&B===-1)this.fire(new l.j(new Error(`Cannot add layer "${_}" before non-existing layer "${d}".`)));else{if(this._order.splice(B,0,_),this._layerOrderChanged=!0,this._layers[_]=A,this._removedLayers[_]&&A.source&&A.type!=="custom"){const R=this._removedLayers[_];delete this._removedLayers[_],R.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new l.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const m=this._order.indexOf(a);this._order.splice(m,1);const _=d?this._order.indexOf(d):this._order.length;d&&_===-1?this.fire(new l.j(new Error(`Cannot move layer "${a}" before non-existing layer "${d}".`))):(this._order.splice(_,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${a}".`)));d.setEventedParent(null);const m=this._order.indexOf(a);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,d,m){this._checkLoaded();const _=this.getLayer(a);_?_.minzoom===d&&_.maxzoom===m||(d!=null&&(_.minzoom=d),m!=null&&(_.maxzoom=m),this._updateLayer(_)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const _=this.getLayer(a);if(_){if(!l.aD(_.filter,d))return d==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.x.filter,`layers.${_.id}.filter`,d,null,m)||(_.filter=l.aA(d),this._updateLayer(_)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return l.aA(this.getLayer(a).filter)}setLayoutProperty(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const A=this.getLayer(a);A?l.aD(A.getLayoutProperty(d),m)||(A.setLayoutProperty(d,m,_),this._updateLayer(A)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,d){const m=this.getLayer(a);if(m)return m.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const A=this.getLayer(a);A?l.aD(A.getPaintProperty(d),m)||(A.setPaintProperty(d,m,_)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[a]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,d){return this.getLayer(a).getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const m=a.source,_=a.sourceLayer,A=this.sourceCaches[m];if(A===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const B=A.getSource().type;B==="geojson"&&_?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||_?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),A.setFeatureState(_,a.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,d){this._checkLoaded();const m=a.source,_=this.sourceCaches[m];if(_===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const A=_.getSource().type,B=A==="vector"?a.sourceLayer:void 0;A!=="vector"||B?d&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(B,a.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const d=a.source,m=a.sourceLayer,_=this.sourceCaches[d];if(_!==void 0)return _.getSource().type!=="vector"||m?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),_.getFeatureState(m,a.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=l.aE(this.sourceCaches,A=>A.serialize()),d=this._serializeByIds(this._order),m=this.map.getTerrain()||void 0,_=this.stylesheet;return l.aF({version:_.version,name:_.name,metadata:_.metadata,light:_.light,center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,sprite:_.sprite,glyphs:_.glyphs,transition:_.transition,sources:a,layers:d,terrain:m},A=>A!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const d=B=>this._layers[B].type==="fill-extrusion",m={},_=[];for(let B=this._order.length-1;B>=0;B--){const R=this._order[B];if(d(R)){m[R]=B;for(const g of a){const b=g[R];if(b)for(const E of b)_.push(E)}}}_.sort((B,R)=>R.intersectionZ-B.intersectionZ);const A=[];for(let B=this._order.length-1;B>=0;B--){const R=this._order[B];if(d(R))for(let g=_.length-1;g>=0;g--){const b=_[g].feature;if(m[b.layer.id]<B)break;A.push(b),_.pop()}else for(const g of a){const b=g[R];if(b)for(const E of b)A.push(E.feature)}}return A}queryRenderedFeatures(a,d,m){d&&d.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const _={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const R of d.layers){const g=this._layers[R];if(!g)return this.fire(new l.j(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];_[g.source]=!0}}const A=[];d.availableImages=this._availableImages;const B=this._serializedAllLayers();for(const R in this.sourceCaches)d.layers&&!_[R]||A.push(Le(this.sourceCaches[R],this._layers,B,a,d,m));return this.placement&&A.push(function(R,g,b,E,I,O,F){const z={},V=O.queryRenderedSymbols(E),U=[];for(const W of Object.keys(V).map(Number))U.push(F[W]);U.sort(Fe);for(const W of U){const at=W.featureIndex.lookupSymbolFeatures(V[W.bucketInstanceId],g,W.bucketIndex,W.sourceLayerIndex,I.filter,I.layers,I.availableImages,R);for(const tt in at){const ht=z[tt]=z[tt]||[],ut=at[tt];ut.sort((Tt,bt)=>{const pt=W.featureSortOrder;if(pt){const ft=pt.indexOf(Tt.featureIndex);return pt.indexOf(bt.featureIndex)-ft}return bt.featureIndex-Tt.featureIndex});for(const Tt of ut)ht.push(Tt)}}for(const W in z)z[W].forEach(at=>{const tt=at.feature,ht=b[R[W].source].getFeatureState(tt.layer["source-layer"],tt.id);tt.source=tt.layer.source,tt.layer["source-layer"]&&(tt.sourceLayer=tt.layer["source-layer"]),tt.state=ht});return z}(this._layers,B,this.sourceCaches,a,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(a,d){d&&d.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[a];return m?function(_,A){const B=_.getRenderableIds().map(b=>_.getTileByID(b)),R=[],g={};for(let b=0;b<B.length;b++){const E=B[b],I=E.tileID.canonical.key;g[I]||(g[I]=!0,E.querySourceFeatures(R,A))}return R}(m,d):[]}getLight(){return this.light.getLight()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const m=this.light.getLight();let _=!1;for(const B in a)if(!l.aD(a[B],m[B])){_=!0;break}if(!_)return;const A={now:T.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,d),this.light.updateTransitions(A)}_validate(a,d,m,_){let A=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!A||A.validate!==!1)&&dr(this,a.call(l.x,l.e({key:d,style:this.serialize(),value:m,styleSpec:l.v},_)))}_remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ce().off(Pi,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const d in this.sourceCaches)this.sourceCaches[d].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,d,m,_){let A=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,B=!1,R=!1;const g={};for(const b of this._order){const E=this._layers[b];if(E.type!=="symbol")continue;if(!g[E.source]){const O=this.sourceCaches[E.source];g[E.source]=O.getRenderableIds(!0).map(F=>O.getTileByID(F)).sort((F,z)=>z.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(z.tileID)?-1:1))}const I=this.crossTileSymbolIndex.addLayer(E,g[E.source],a.center.lng);B=B||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now(),a.zoom))&&(this.pauseablePlacement=new Os(a,this.map.terrain,this._order,A,d,m,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,g),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.now()),R=!0),B&&this.pauseablePlacement.placement.setStale()),R||B)for(const b of this._order){const E=this._layers[b];E.type==="symbol"&&this.placement.updateLayerOpacities(E,g[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d){return l._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const _=this.sourceCaches[d.source];return _&&_.setDependencies(d.tileID.key,d.type,d.icons),m})}getGlyphs(a,d){return l._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(d.stacks),_=this.sourceCaches[d.source];return _&&_.setDependencies(d.tileID.key,d.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),a&&this._validate(l.x.glyphs,"glyphs",a,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},_=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const A=[{id:a,url:d}],B=[...zt(this.stylesheet.sprite),...A];this._validate(l.x.sprite,"sprite",B,null,m)||(this.stylesheet.sprite=B,this._loadSprite(A,!0,_))}removeSprite(a){this._checkLoaded();const d=zt(this.stylesheet.sprite);if(d.find(m=>m.id===a)){if(this._spritesImagesIds[a])for(const m of this._spritesImagesIds[a])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex(m=>m.id===a),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return zt(this.stylesheet.sprite)}setSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),a&&this._validate(l.x.sprite,"sprite",a,null,d)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,m):(this._unloadSprite(),m&&m(null)))}}var ps=l.X([{name:"a_pos",type:"Int16",components:2}]),Or="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const hs={prelude:Zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Zi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Zi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Or),terrainDepth:Zi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Or),terrainCoords:Zi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Or)};function Zi(w,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=a.match(/attribute ([\w]+) ([\w]+)/g),_=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),B=A?A.concat(_):_,R={};return{fragmentSource:w=w.replace(d,(g,b,E,I,O)=>(R[O]=!0,b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${E} ${I} ${O};
#else
uniform ${E} ${I} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${E} ${I} ${O} = u_${O};
#endif
`)),vertexSource:a=a.replace(d,(g,b,E,I,O)=>{const F=I==="float"?"vec2":"vec4",z=O.match(/color/)?"color":F;return R[O]?b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${E} ${F} a_${O};
varying ${E} ${I} ${O};
#else
uniform ${E} ${I} u_${O};
#endif
`:z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${E} ${I} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${z}(a_${O}, u_${O}_t);
#else
    ${E} ${I} ${O} = u_${O};
#endif
`:b==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${E} ${F} a_${O};
#else
uniform ${E} ${I} u_${O};
#endif
`:z==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${E} ${I} ${O} = a_${O};
#else
    ${E} ${I} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${E} ${I} ${O} = unpack_mix_${z}(a_${O}, u_${O}_t);
#else
    ${E} ${I} ${O} = u_${O};
#endif
`}),staticAttributes:m,staticUniforms:B}}class eo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,d,m,_,A,B,R,g,b){this.context=a;let E=this.boundPaintVertexBuffers.length!==_.length;for(let I=0;!E&&I<_.length;I++)this.boundPaintVertexBuffers[I]!==_[I]&&(E=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||E||this.boundIndexBuffer!==A||this.boundVertexOffset!==B||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==g||this.boundDynamicVertexBuffer3!==b?this.freshBind(d,m,_,A,B,R,g,b):(a.bindVertexArray.set(this.vao),R&&R.bind(),A&&A.dynamicDraw&&A.bind(),g&&g.bind(),b&&b.bind())}freshBind(a,d,m,_,A,B,R,g){const b=a.numAttributes,E=this.context,I=E.gl;this.vao&&this.destroy(),this.vao=E.createVertexArray(),E.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=_,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=B,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=g,d.enableAttributes(I,a);for(const O of m)O.enableAttributes(I,a);B&&B.enableAttributes(I,a),R&&R.enableAttributes(I,a),g&&g.enableAttributes(I,a),d.bind(),d.setVertexAttribPointers(I,a,A);for(const O of m)O.bind(),O.setVertexAttribPointers(I,a,A);B&&(B.bind(),B.setVertexAttribPointers(I,a,A)),_&&_.bind(),R&&(R.bind(),R.setVertexAttribPointers(I,a,A)),g&&(g.bind(),g.setVertexAttribPointers(I,a,A)),E.currentNumAttributes=b}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function io(w){const a=[];for(let d=0;d<w.length;d++){if(w[d]===null)continue;const m=w[d].split(" ");a.push(m.pop())}return a}class xn{constructor(a,d,m,_,A,B){const R=a.gl;this.program=R.createProgram();const g=io(d.staticAttributes),b=m?m.getBinderAttributes():[],E=g.concat(b),I=hs.prelude.staticUniforms?io(hs.prelude.staticUniforms):[],O=d.staticUniforms?io(d.staticUniforms):[],F=m?m.getBinderUniforms():[],z=I.concat(O).concat(F),V=[];for(const Tt of z)V.indexOf(Tt)<0&&V.push(Tt);const U=m?m.defines():[];A&&U.push("#define OVERDRAW_INSPECTOR;"),B&&U.push("#define TERRAIN3D;");const W=U.concat(hs.prelude.fragmentSource,d.fragmentSource).join(`
`),at=U.concat(hs.prelude.vertexSource,d.vertexSource).join(`
`),tt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(tt,W),R.compileShader(tt),!R.getShaderParameter(tt,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(tt)}`);R.attachShader(this.program,tt);const ht=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(ht,at),R.compileShader(ht),!R.getShaderParameter(ht,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(ht)}`);R.attachShader(this.program,ht),this.attributes={};const ut={};this.numAttributes=E.length;for(let Tt=0;Tt<this.numAttributes;Tt++)E[Tt]&&(R.bindAttribLocation(this.program,Tt,E[Tt]),this.attributes[E[Tt]]=Tt);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(ht),R.deleteShader(tt);for(let Tt=0;Tt<V.length;Tt++){const bt=V[Tt];if(bt&&!ut[bt]){const pt=R.getUniformLocation(this.program,bt);pt&&(ut[bt]=pt)}}this.fixedUniforms=_(a,ut),this.terrainUniforms=((Tt,bt)=>({u_depth:new l.aG(Tt,bt.u_depth),u_terrain:new l.aG(Tt,bt.u_terrain),u_terrain_dim:new l.aH(Tt,bt.u_terrain_dim),u_terrain_matrix:new l.aI(Tt,bt.u_terrain_matrix),u_terrain_unpack:new l.aJ(Tt,bt.u_terrain_unpack),u_terrain_exaggeration:new l.aH(Tt,bt.u_terrain_exaggeration)}))(a,ut),this.binderUniforms=m?m.getUniforms(a,ut):[]}draw(a,d,m,_,A,B,R,g,b,E,I,O,F,z,V,U,W,at){const tt=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(m),a.setStencilMode(_),a.setColorMode(A),a.setCullFace(B),g){a.activeTexture.set(tt.TEXTURE2),tt.bindTexture(tt.TEXTURE_2D,g.depthTexture),a.activeTexture.set(tt.TEXTURE3),tt.bindTexture(tt.TEXTURE_2D,g.texture);for(const ut in this.terrainUniforms)this.terrainUniforms[ut].set(g[ut])}for(const ut in this.fixedUniforms)this.fixedUniforms[ut].set(R[ut]);V&&V.setUniforms(a,this.binderUniforms,F,{zoom:z});let ht=0;switch(d){case tt.LINES:ht=2;break;case tt.TRIANGLES:ht=3;break;case tt.LINE_STRIP:ht=1}for(const ut of O.get()){const Tt=ut.vaos||(ut.vaos={});(Tt[b]||(Tt[b]=new eo)).bind(a,this,E,V?V.getPaintVertexBuffers():[],I,ut.vertexOffset,U,W,at),tt.drawElements(d,ut.primitiveLength*ht,tt.UNSIGNED_SHORT,ut.primitiveOffset*ht*2)}}}function pa(w,a,d){const m=1/si(d,1,a.transform.tileZoom),_=Math.pow(2,d.tileID.overscaledZ),A=d.tileSize*Math.pow(2,a.transform.tileZoom)/_,B=A*(d.tileID.canonical.x+d.tileID.wrap*_),R=A*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[B>>16,R>>16],u_pixel_coord_lower:[65535&B,65535&R]}}const rt=(w,a,d,m)=>{const _=a.style.light,A=_.properties.get("position"),B=[A.x,A.y,A.z],R=function(){var b=new l.A(9);return l.A!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}();_.properties.get("anchor")==="viewport"&&function(b,E){var I=Math.sin(E),O=Math.cos(E);b[0]=O,b[1]=I,b[2]=0,b[3]=-I,b[4]=O,b[5]=0,b[6]=0,b[7]=0,b[8]=1}(R,-a.transform.angle),function(b,E,I){var O=E[0],F=E[1],z=E[2];b[0]=O*I[0]+F*I[3]+z*I[6],b[1]=O*I[1]+F*I[4]+z*I[7],b[2]=O*I[2]+F*I[5]+z*I[8]}(B,B,R);const g=_.properties.get("color");return{u_matrix:w,u_lightpos:B,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_vertical_gradient:+d,u_opacity:m}},mt=(w,a,d,m,_,A,B)=>l.e(rt(w,a,d,m),pa(A,a,B),{u_height_factor:-Math.pow(2,_.overscaledZ)/B.tileSize/8}),Dt=w=>({u_matrix:w}),ue=(w,a,d,m)=>l.e(Dt(w),pa(d,a,m)),Se=(w,a)=>({u_matrix:w,u_world:a}),gi=(w,a,d,m,_)=>l.e(ue(w,a,d,m),{u_world:_}),Mi=(w,a,d,m)=>{const _=w.transform;let A,B;if(m.paint.get("circle-pitch-alignment")==="map"){const R=si(d,1,_.zoom);A=!0,B=[R,R]}else A=!1,B=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(a.posMatrix,d,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:B}},pr=(w,a,d)=>{const m=si(d,1,a.zoom),_=Math.pow(2,a.zoom-d.tileID.overscaledZ),A=d.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[a.pixelsToGLUnits[0]/(m*_),a.pixelsToGLUnits[1]/(m*_)],u_overscale_factor:A}},fs=function(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:w,u_color:a,u_overlay:0,u_overlay_scale:d}},rs=w=>({u_matrix:w}),Ar=(w,a,d,m)=>({u_matrix:w,u_extrude_scale:si(a,1,d),u_intensity:m});function rh(w,a){const d=Math.pow(2,a.canonical.z),m=a.canonical.y;return[new l.Y(0,m/d).toLngLat().lat,new l.Y(0,(m+1)/d).toLngLat().lat]}const Ha=(w,a,d,m)=>{const _=w.transform;return{u_matrix:fa(w,a,d,m),u_ratio:1/si(a,1,_.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Li=(w,a,d,m,_)=>l.e(Ha(w,a,d,_),{u_image:0,u_image_height:m}),Vo=(w,a,d,m,_)=>{const A=w.transform,B=ts(a,A);return{u_matrix:fa(w,a,d,_),u_texsize:a.imageAtlasTexture.size,u_ratio:1/si(a,1,A.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[B,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},kl=(w,a,d,m,_,A)=>{const B=w.lineAtlas,R=ts(a,w.transform),g=d.layout.get("line-cap")==="round",b=B.getDash(m.from,g),E=B.getDash(m.to,g),I=b.width*_.fromScale,O=E.width*_.toScale;return l.e(Ha(w,a,d,A),{u_patternscale_a:[R/I,-b.height/2],u_patternscale_b:[R/O,-E.height/2],u_sdfgamma:B.width/(256*Math.min(I,O)*w.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:E.y,u_mix:_.t})};function ts(w,a){return 1/si(w,1,a.tileZoom)}function fa(w,a,d,m){return w.translatePosMatrix(m?m.posMatrix:a.tileID.posMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Wa=(w,a,d,m,_)=>{return{u_matrix:w,u_tl_parent:a,u_scale_parent:d,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(B=_.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(A=_.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:So(_.paint.get("raster-hue-rotate"))};var A,B};function So(w){w*=Math.PI/180;const a=Math.sin(w),d=Math.cos(w);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const qo=(w,a,d,m,_,A,B,R,g,b)=>{const E=_.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:E.cameraToCenterDistance,u_pitch:E.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:E.width/E.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:B,u_coord_matrix:R,u_is_text:+g,u_pitch_with_map:+m,u_texsize:b,u_texture:0}},Ja=(w,a,d,m,_,A,B,R,g,b,E)=>{const I=_.transform;return l.e(qo(w,a,d,m,_,A,B,R,g,b),{u_gamma_scale:m?Math.cos(I._pitch)*I.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+E})},Za=(w,a,d,m,_,A,B,R,g,b)=>l.e(Ja(w,a,d,m,_,A,B,R,!0,g,!0),{u_texsize_icon:b,u_texture_icon:1}),Jh=(w,a,d)=>({u_matrix:w,u_opacity:a,u_color:d}),gc=(w,a,d,m,_,A)=>l.e(function(B,R,g,b){const E=g.imageManager.getPattern(B.from.toString()),I=g.imageManager.getPattern(B.to.toString()),{width:O,height:F}=g.imageManager.getPixelSize(),z=Math.pow(2,b.tileID.overscaledZ),V=b.tileSize*Math.pow(2,g.transform.tileZoom)/z,U=V*(b.tileID.canonical.x+b.tileID.wrap*z),W=V*b.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[O,F],u_mix:R.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/si(b,1,g.transform.tileZoom),u_pixel_coord_upper:[U>>16,W>>16],u_pixel_coord_lower:[65535&U,65535&W]}}(m,A,d,_),{u_matrix:w,u_opacity:a}),ga={fillExtrusion:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_lightpos:new l.aK(w,a.u_lightpos),u_lightintensity:new l.aH(w,a.u_lightintensity),u_lightcolor:new l.aK(w,a.u_lightcolor),u_vertical_gradient:new l.aH(w,a.u_vertical_gradient),u_opacity:new l.aH(w,a.u_opacity)}),fillExtrusionPattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_lightpos:new l.aK(w,a.u_lightpos),u_lightintensity:new l.aH(w,a.u_lightintensity),u_lightcolor:new l.aK(w,a.u_lightcolor),u_vertical_gradient:new l.aH(w,a.u_vertical_gradient),u_height_factor:new l.aH(w,a.u_height_factor),u_image:new l.aG(w,a.u_image),u_texsize:new l.aL(w,a.u_texsize),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade),u_opacity:new l.aH(w,a.u_opacity)}),fill:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix)}),fillPattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_image:new l.aG(w,a.u_image),u_texsize:new l.aL(w,a.u_texsize),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade)}),fillOutline:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_world:new l.aL(w,a.u_world)}),fillOutlinePattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_world:new l.aL(w,a.u_world),u_image:new l.aG(w,a.u_image),u_texsize:new l.aL(w,a.u_texsize),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade)}),circle:(w,a)=>({u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_scale_with_map:new l.aG(w,a.u_scale_with_map),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_extrude_scale:new l.aL(w,a.u_extrude_scale),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_matrix:new l.aI(w,a.u_matrix)}),collisionBox:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(w,a.u_pixels_to_tile_units),u_extrude_scale:new l.aL(w,a.u_extrude_scale),u_overscale_factor:new l.aH(w,a.u_overscale_factor)}),collisionCircle:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_inv_matrix:new l.aI(w,a.u_inv_matrix),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_viewport_size:new l.aL(w,a.u_viewport_size)}),debug:(w,a)=>({u_color:new l.aM(w,a.u_color),u_matrix:new l.aI(w,a.u_matrix),u_overlay:new l.aG(w,a.u_overlay),u_overlay_scale:new l.aH(w,a.u_overlay_scale)}),clippingMask:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix)}),heatmap:(w,a)=>({u_extrude_scale:new l.aH(w,a.u_extrude_scale),u_intensity:new l.aH(w,a.u_intensity),u_matrix:new l.aI(w,a.u_matrix)}),heatmapTexture:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_world:new l.aL(w,a.u_world),u_image:new l.aG(w,a.u_image),u_color_ramp:new l.aG(w,a.u_color_ramp),u_opacity:new l.aH(w,a.u_opacity)}),hillshade:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_image:new l.aG(w,a.u_image),u_latrange:new l.aL(w,a.u_latrange),u_light:new l.aL(w,a.u_light),u_shadow:new l.aM(w,a.u_shadow),u_highlight:new l.aM(w,a.u_highlight),u_accent:new l.aM(w,a.u_accent)}),hillshadePrepare:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_image:new l.aG(w,a.u_image),u_dimension:new l.aL(w,a.u_dimension),u_zoom:new l.aH(w,a.u_zoom),u_unpack:new l.aJ(w,a.u_unpack)}),line:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels)}),lineGradient:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels),u_image:new l.aG(w,a.u_image),u_image_height:new l.aH(w,a.u_image_height)}),linePattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_texsize:new l.aL(w,a.u_texsize),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_image:new l.aG(w,a.u_image),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels),u_scale:new l.aK(w,a.u_scale),u_fade:new l.aH(w,a.u_fade)}),lineSDF:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ratio:new l.aH(w,a.u_ratio),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(w,a.u_units_to_pixels),u_patternscale_a:new l.aL(w,a.u_patternscale_a),u_patternscale_b:new l.aL(w,a.u_patternscale_b),u_sdfgamma:new l.aH(w,a.u_sdfgamma),u_image:new l.aG(w,a.u_image),u_tex_y_a:new l.aH(w,a.u_tex_y_a),u_tex_y_b:new l.aH(w,a.u_tex_y_b),u_mix:new l.aH(w,a.u_mix)}),raster:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_tl_parent:new l.aL(w,a.u_tl_parent),u_scale_parent:new l.aH(w,a.u_scale_parent),u_buffer_scale:new l.aH(w,a.u_buffer_scale),u_fade_t:new l.aH(w,a.u_fade_t),u_opacity:new l.aH(w,a.u_opacity),u_image0:new l.aG(w,a.u_image0),u_image1:new l.aG(w,a.u_image1),u_brightness_low:new l.aH(w,a.u_brightness_low),u_brightness_high:new l.aH(w,a.u_brightness_high),u_saturation_factor:new l.aH(w,a.u_saturation_factor),u_contrast_factor:new l.aH(w,a.u_contrast_factor),u_spin_weights:new l.aK(w,a.u_spin_weights)}),symbolIcon:(w,a)=>({u_is_size_zoom_constant:new l.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(w,a.u_is_size_feature_constant),u_size_t:new l.aH(w,a.u_size_t),u_size:new l.aH(w,a.u_size),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pitch:new l.aH(w,a.u_pitch),u_rotate_symbol:new l.aG(w,a.u_rotate_symbol),u_aspect_ratio:new l.aH(w,a.u_aspect_ratio),u_fade_change:new l.aH(w,a.u_fade_change),u_matrix:new l.aI(w,a.u_matrix),u_label_plane_matrix:new l.aI(w,a.u_label_plane_matrix),u_coord_matrix:new l.aI(w,a.u_coord_matrix),u_is_text:new l.aG(w,a.u_is_text),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_texsize:new l.aL(w,a.u_texsize),u_texture:new l.aG(w,a.u_texture)}),symbolSDF:(w,a)=>({u_is_size_zoom_constant:new l.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(w,a.u_is_size_feature_constant),u_size_t:new l.aH(w,a.u_size_t),u_size:new l.aH(w,a.u_size),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pitch:new l.aH(w,a.u_pitch),u_rotate_symbol:new l.aG(w,a.u_rotate_symbol),u_aspect_ratio:new l.aH(w,a.u_aspect_ratio),u_fade_change:new l.aH(w,a.u_fade_change),u_matrix:new l.aI(w,a.u_matrix),u_label_plane_matrix:new l.aI(w,a.u_label_plane_matrix),u_coord_matrix:new l.aI(w,a.u_coord_matrix),u_is_text:new l.aG(w,a.u_is_text),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_texsize:new l.aL(w,a.u_texsize),u_texture:new l.aG(w,a.u_texture),u_gamma_scale:new l.aH(w,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_is_halo:new l.aG(w,a.u_is_halo)}),symbolTextAndIcon:(w,a)=>({u_is_size_zoom_constant:new l.aG(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(w,a.u_is_size_feature_constant),u_size_t:new l.aH(w,a.u_size_t),u_size:new l.aH(w,a.u_size),u_camera_to_center_distance:new l.aH(w,a.u_camera_to_center_distance),u_pitch:new l.aH(w,a.u_pitch),u_rotate_symbol:new l.aG(w,a.u_rotate_symbol),u_aspect_ratio:new l.aH(w,a.u_aspect_ratio),u_fade_change:new l.aH(w,a.u_fade_change),u_matrix:new l.aI(w,a.u_matrix),u_label_plane_matrix:new l.aI(w,a.u_label_plane_matrix),u_coord_matrix:new l.aI(w,a.u_coord_matrix),u_is_text:new l.aG(w,a.u_is_text),u_pitch_with_map:new l.aG(w,a.u_pitch_with_map),u_texsize:new l.aL(w,a.u_texsize),u_texsize_icon:new l.aL(w,a.u_texsize_icon),u_texture:new l.aG(w,a.u_texture),u_texture_icon:new l.aG(w,a.u_texture_icon),u_gamma_scale:new l.aH(w,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(w,a.u_device_pixel_ratio),u_is_halo:new l.aG(w,a.u_is_halo)}),background:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_opacity:new l.aH(w,a.u_opacity),u_color:new l.aM(w,a.u_color)}),backgroundPattern:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_opacity:new l.aH(w,a.u_opacity),u_image:new l.aG(w,a.u_image),u_pattern_tl_a:new l.aL(w,a.u_pattern_tl_a),u_pattern_br_a:new l.aL(w,a.u_pattern_br_a),u_pattern_tl_b:new l.aL(w,a.u_pattern_tl_b),u_pattern_br_b:new l.aL(w,a.u_pattern_br_b),u_texsize:new l.aL(w,a.u_texsize),u_mix:new l.aH(w,a.u_mix),u_pattern_size_a:new l.aL(w,a.u_pattern_size_a),u_pattern_size_b:new l.aL(w,a.u_pattern_size_b),u_scale_a:new l.aH(w,a.u_scale_a),u_scale_b:new l.aH(w,a.u_scale_b),u_pixel_coord_upper:new l.aL(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(w,a.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(w,a.u_tile_units_to_pixels)}),terrain:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_texture:new l.aG(w,a.u_texture),u_ele_delta:new l.aH(w,a.u_ele_delta)}),terrainDepth:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_ele_delta:new l.aH(w,a.u_ele_delta)}),terrainCoords:(w,a)=>({u_matrix:new l.aI(w,a.u_matrix),u_texture:new l.aG(w,a.u_texture),u_terrain_coords_id:new l.aH(w,a.u_terrain_coords_id),u_ele_delta:new l.aH(w,a.u_ele_delta)})};class ma{constructor(a,d,m){this.context=a;const _=a.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ho={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Eo{constructor(a,d,m,_){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=_,this.context=a;const A=a.gl;this.buffer=A.createBuffer(),a.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let m=0;m<this.attributes.length;m++){const _=d.attributes[this.attributes[m].name];_!==void 0&&a.enableVertexAttribArray(_)}}setVertexAttribPointers(a,d,m){for(let _=0;_<this.attributes.length;_++){const A=this.attributes[_],B=d.attributes[A.name];B!==void 0&&a.vertexAttribPointer(B,A.components,a[Ho[A.type]],!1,this.itemSize,A.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gs=new WeakMap;function ss(w){var a;if(gs.has(w))return gs.get(w);{const d=(a=w.getParameter(w.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return gs.set(w,d),d}}class Xi{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xa extends Xi{getDefault(){return l.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class $a extends Xi{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Ol extends Xi{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class ro extends Xi{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class so extends Xi{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class mc extends Xi{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Co extends Xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class on extends Xi{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Dl extends Xi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class ya extends Xi{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class _a extends Xi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class Nl extends Xi{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Zh extends Xi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class yc extends Xi{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class _c extends Xi{getDefault(){return l.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class sh extends Xi{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Fl extends Xi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class Ka extends Xi{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class va extends Xi{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class zl extends Xi{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class vc extends Xi{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class no extends Xi{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ba extends Xi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class jl extends Xi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class To extends Xi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class oo extends Xi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class D extends Xi{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Q extends Xi{getDefault(){return null}set(a){var d;if(a===this.current&&!this.dirty)return;const m=this.gl;ss(m)?m.bindVertexArray(a):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class Ct extends Xi{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Gt extends Xi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Yt extends Xi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class ee extends Xi{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class Ie extends ee{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ti extends ee{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class wi extends ee{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ii{constructor(a,d,m,_,A){this.context=a,this.width=d,this.height=m;const B=a.gl,R=this.framebuffer=B.createFramebuffer();if(this.colorAttachment=new Ie(a,R),_)this.depthAttachment=A?new wi(a,R):new ti(a,R);else if(A)throw new Error("Stencil cannot be set without depth");if(B.checkFramebufferStatus(B.FRAMEBUFFER)!==B.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&a.deleteRenderbuffer(m)}a.deleteFramebuffer(this.framebuffer)}}class hi{constructor(a,d,m){this.blendFunction=a,this.blendColor=d,this.mask=m}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,l.aO.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,l.aO.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],l.aO.transparent,[!0,!0,!0,!0]);class rr{constructor(a){var d,m;if(this.gl=a,this.clearColor=new Xa(this),this.clearDepth=new $a(this),this.clearStencil=new Ol(this),this.colorMask=new ro(this),this.depthMask=new so(this),this.stencilMask=new mc(this),this.stencilFunc=new Co(this),this.stencilOp=new on(this),this.stencilTest=new Dl(this),this.depthRange=new ya(this),this.depthTest=new _a(this),this.depthFunc=new Nl(this),this.blend=new Zh(this),this.blendFunc=new yc(this),this.blendColor=new _c(this),this.blendEquation=new sh(this),this.cullFace=new Fl(this),this.cullFaceSide=new Ka(this),this.frontFace=new va(this),this.program=new zl(this),this.activeTexture=new vc(this),this.viewport=new no(this),this.bindFramebuffer=new ba(this),this.bindRenderbuffer=new jl(this),this.bindTexture=new To(this),this.bindVertexBuffer=new oo(this),this.bindElementBuffer=new D(this),this.bindVertexArray=new Q(this),this.pixelStoreUnpack=new Ct(this),this.pixelStoreUnpackPremultiplyAlpha=new Gt(this),this.pixelStoreUnpackFlipY=new Yt(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),ss(a)){this.HALF_FLOAT=a.HALF_FLOAT;const _=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=a.RGBA16F)!==null&&d!==void 0?d:_==null?void 0:_.RGBA16F_EXT,this.RGB16F=(m=a.RGB16F)!==null&&m!==void 0?m:_==null?void 0:_.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const _=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=_==null?void 0:_.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new ma(this,a,d)}createVertexBuffer(a,d,m){return new Eo(this,a,d,m)}createRenderbuffer(a,d,m){const _=this.gl,A=_.createRenderbuffer();return this.bindRenderbuffer.set(A),_.renderbufferStorage(_.RENDERBUFFER,a,d,m),this.bindRenderbuffer.set(null),A}createFramebuffer(a,d,m,_){return new Ii(this,a,d,m,_)}clear(a){let{color:d,depth:m,stencil:_}=a;const A=this.gl;let B=0;d&&(B|=A.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(B|=A.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),_!==void 0&&(B|=A.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),A.clear(B)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){l.aD(a.blendFunction,hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return ss(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var d;return ss(this.gl)?this.gl.deleteVertexArray(a):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class ui{constructor(a,d,m){this.func=a,this.mask=d,this.range=m}}ui.ReadOnly=!1,ui.ReadWrite=!0,ui.disabled=new ui(519,ui.ReadOnly,[0,1]);const Zr=7680;class Ri{constructor(a,d,m,_,A,B){this.test=a,this.ref=d,this.mask=m,this.fail=_,this.depthFail=A,this.pass=B}}Ri.disabled=new Ri({func:519,mask:0},0,0,Zr,Zr,Zr);class Fi{constructor(a,d,m){this.enable=a,this.mode=d,this.frontFace=m}}let Vr;function an(w,a,d,m,_,A,B){const R=w.context,g=R.gl,b=w.useProgram("collisionBox"),E=[];let I=0,O=0;for(let tt=0;tt<m.length;tt++){const ht=m[tt],ut=a.getTile(ht),Tt=ut.getBucket(d);if(!Tt)continue;let bt=ht.posMatrix;_[0]===0&&_[1]===0||(bt=w.translatePosMatrix(ht.posMatrix,ut,_,A));const pt=B?Tt.textCollisionBox:Tt.iconCollisionBox,ft=Tt.collisionCircleArray;if(ft.length>0){const jt=l.F(),Wt=bt;l.aP(jt,Tt.placementInvProjMatrix,w.transform.glCoordMatrix),l.aP(jt,jt,Tt.placementViewportMatrix),E.push({circleArray:ft,circleOffset:O,transform:Wt,invTransform:jt,coord:ht}),I+=ft.length/4,O=I}pt&&b.draw(R,g.LINES,ui.disabled,Ri.disabled,w.colorModeForRenderPass(),Fi.disabled,pr(bt,w.transform,ut),w.style.map.terrain&&w.style.map.terrain.getTerrainData(ht),d.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,w.transform.zoom,null,null,pt.collisionVertexBuffer)}if(!B||!E.length)return;const F=w.useProgram("collisionCircle"),z=new l.aQ;z.resize(4*I),z._trim();let V=0;for(const tt of E)for(let ht=0;ht<tt.circleArray.length/4;ht++){const ut=4*ht,Tt=tt.circleArray[ut+0],bt=tt.circleArray[ut+1],pt=tt.circleArray[ut+2],ft=tt.circleArray[ut+3];z.emplace(V++,Tt,bt,pt,ft,0),z.emplace(V++,Tt,bt,pt,ft,1),z.emplace(V++,Tt,bt,pt,ft,2),z.emplace(V++,Tt,bt,pt,ft,3)}(!Vr||Vr.length<2*I)&&(Vr=function(tt){const ht=2*tt,ut=new l.aS;ut.resize(ht),ut._trim();for(let Tt=0;Tt<ht;Tt++){const bt=6*Tt;ut.uint16[bt+0]=4*Tt+0,ut.uint16[bt+1]=4*Tt+1,ut.uint16[bt+2]=4*Tt+2,ut.uint16[bt+3]=4*Tt+2,ut.uint16[bt+4]=4*Tt+3,ut.uint16[bt+5]=4*Tt+0}return ut}(I));const U=R.createIndexBuffer(Vr,!0),W=R.createVertexBuffer(z,l.aR.members,!0);for(const tt of E){const ht={u_matrix:tt.transform,u_inv_matrix:tt.invTransform,u_camera_to_center_distance:(at=w.transform).cameraToCenterDistance,u_viewport_size:[at.width,at.height]};F.draw(R,g.TRIANGLES,ui.disabled,Ri.disabled,w.colorModeForRenderPass(),Fi.disabled,ht,w.style.map.terrain&&w.style.map.terrain.getTerrainData(tt.coord),d.id,W,U,l.$.simpleSegment(0,2*tt.circleOffset,tt.circleArray.length,tt.circleArray.length/2),null,w.transform.zoom,null,null,null)}var at;W.destroy(),U.destroy()}Fi.disabled=new Fi(!1,1029,2305),Fi.backCCW=new Fi(!0,1029,2305);const ln=l.an(new Float32Array(16));function Po(w,a,d,m,_,A){const{horizontalAlign:B,verticalAlign:R}=l.at(w);return new l.P((-(B-.5)*a/_+m[0])*A,(-(R-.5)*d/_+m[1])*A)}function Ya(w,a,d,m,_,A,B,R,g,b,E){const I=w.text.placedSymbolArray,O=w.text.dynamicLayoutVertexArray,F=w.icon.dynamicLayoutVertexArray,z={};O.clear();for(let V=0;V<I.length;V++){const U=I.get(V),W=U.hidden||!U.crossTileID||w.allowVerticalPlacement&&!U.placedOrientation?null:m[U.crossTileID];if(W){const at=new l.P(U.anchorX,U.anchorY),tt=sr(at,d?B:A,E),ht=vt(_.cameraToCenterDistance,tt.signedDistanceFromCamera);let ut=l.ai(w.textSizeData,g,U)*ht/l.ao;d&&(ut*=w.tilePixelRatio/R);const{width:Tt,height:bt,anchor:pt,textOffset:ft,textBoxScale:jt}=W,Wt=Po(pt,Tt,bt,ft,jt,ut),se=d?sr(at.add(Wt),A,E).point:tt.point.add(a?Wt.rotate(-_.angle):Wt),ne=w.allowVerticalPlacement&&U.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let fe=0;fe<U.numGlyphs;fe++)l.aj(O,se,ne);b&&U.associatedIconIndex>=0&&(z[U.associatedIconIndex]={shiftedAnchor:se,angle:ne})}else ae(U.numGlyphs,O)}if(b){F.clear();const V=w.icon.placedSymbolArray;for(let U=0;U<V.length;U++){const W=V.get(U);if(W.hidden)ae(W.numGlyphs,F);else{const at=z[U];if(at)for(let tt=0;tt<W.numGlyphs;tt++)l.aj(F,at.shiftedAnchor,at.angle);else ae(W.numGlyphs,F)}}w.icon.dynamicLayoutVertexBuffer.updateData(F)}w.text.dynamicLayoutVertexBuffer.updateData(O)}function wa(w,a,d){return d.iconsInText&&a?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function xa(w,a,d,m,_,A,B,R,g,b,E,I){const O=w.context,F=O.gl,z=w.transform,V=R==="map",U=g==="map",W=R!=="viewport"&&d.layout.get("symbol-placement")!=="point",at=V&&!U&&!W,tt=!d.layout.get("symbol-sort-key").isConstant();let ht=!1;const ut=w.depthModeForSublayer(0,ui.ReadOnly),Tt=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),bt=[];for(const pt of m){const ft=a.getTile(pt),jt=ft.getBucket(d);if(!jt)continue;const Wt=_?jt.text:jt.icon;if(!Wt||!Wt.segments.get().length||!Wt.hasVisibleVertices)continue;const se=Wt.programConfigurations.get(d.id),ne=_||jt.sdfIcons,fe=_?jt.textSizeData:jt.iconSizeData,Me=U||z.pitch!==0,we=w.useProgram(wa(ne,_,jt),se),je=l.ag(fe,z.zoom),$e=w.style.map.terrain&&w.style.map.terrain.getTerrainData(pt);let Ze,yi,_i,Ui,pi=[0,0],zi=null;if(_)yi=ft.glyphAtlasTexture,_i=F.LINEAR,Ze=ft.glyphAtlasTexture.size,jt.iconsInText&&(pi=ft.imageAtlasTexture.size,zi=ft.imageAtlasTexture,Ui=Me||w.options.rotating||w.options.zooming||fe.kind==="composite"||fe.kind==="camera"?F.LINEAR:F.NEAREST);else{const $i=d.layout.get("icon-size").constantOr(0)!==1||jt.iconsNeedLinear;yi=ft.imageAtlasTexture,_i=ne||w.options.rotating||w.options.zooming||$i||Me?F.LINEAR:F.NEAREST,Ze=ft.imageAtlasTexture.size}const or=si(ft,1,w.transform.zoom),ar=vi(pt.posMatrix,U,V,w.transform,or),$r=yr(pt.posMatrix,U,V,w.transform,or),Yi=Tt&&jt.hasTextData(),Ns=d.layout.get("icon-text-fit")!=="none"&&Yi&&jt.hasIconData();if(W){const $i=w.style.map.terrain?(Ts,Nr)=>w.style.map.terrain.getElevation(pt,Ts,Nr):null,lr=d.layout.get("text-rotation-alignment")==="map";Y(jt,pt.posMatrix,w,_,ar,$r,U,b,lr,$i)}const us=w.translatePosMatrix(pt.posMatrix,ft,A,B),Tr=W||_&&Tt||Ns?ln:ar,Qi=w.translatePosMatrix($r,ft,A,B,!0),Wi=ne&&d.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let tr;tr=ne?jt.iconsInText?Za(fe.kind,je,at,U,w,us,Tr,Qi,Ze,pi):Ja(fe.kind,je,at,U,w,us,Tr,Qi,_,Ze,!0):qo(fe.kind,je,at,U,w,us,Tr,Qi,_,Ze);const as={program:we,buffers:Wt,uniformValues:tr,atlasTexture:yi,atlasTextureIcon:zi,atlasInterpolation:_i,atlasInterpolationIcon:Ui,isSDF:ne,hasHalo:Wi};if(tt&&jt.canOverlap){ht=!0;const $i=Wt.segments.get();for(const lr of $i)bt.push({segments:new l.$([lr]),sortKey:lr.sortKey,state:as,terrainData:$e})}else bt.push({segments:Wt.segments,sortKey:0,state:as,terrainData:$e})}ht&&bt.sort((pt,ft)=>pt.sortKey-ft.sortKey);for(const pt of bt){const ft=pt.state;if(O.activeTexture.set(F.TEXTURE0),ft.atlasTexture.bind(ft.atlasInterpolation,F.CLAMP_TO_EDGE),ft.atlasTextureIcon&&(O.activeTexture.set(F.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),ft.isSDF){const jt=ft.uniformValues;ft.hasHalo&&(jt.u_is_halo=1,Qa(ft.buffers,pt.segments,d,w,ft.program,ut,E,I,jt,pt.terrainData)),jt.u_is_halo=0}Qa(ft.buffers,pt.segments,d,w,ft.program,ut,E,I,ft.uniformValues,pt.terrainData)}}function Qa(w,a,d,m,_,A,B,R,g,b){const E=m.context;_.draw(E,E.gl.TRIANGLES,A,B,R,Fi.disabled,g,b,d.id,w.layoutVertexBuffer,w.indexBuffer,a,d.paint,m.transform.zoom,w.programConfigurations.get(d.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Aa(w,a,d,m,_){if(!d||!m||!m.imageAtlas)return;const A=m.imageAtlas.patternPositions;let B=A[d.to.toString()],R=A[d.from.toString()];if(!B&&R&&(B=R),!R&&B&&(R=B),!B||!R){const g=_.getPaintProperty(a);B=A[g],R=A[g]}B&&R&&w.setConstantPatternPositions(B,R)}function Ul(w,a,d,m,_,A,B){const R=w.context.gl,g="fill-pattern",b=d.paint.get(g),E=b&&b.constantOr(1),I=d.getCrossfadeParameters();let O,F,z,V,U;B?(F=E&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=R.LINES):(F=E?"fillPattern":"fill",O=R.TRIANGLES);const W=b.constantOr(null);for(const at of m){const tt=a.getTile(at);if(E&&!tt.patternsLoaded())continue;const ht=tt.getBucket(d);if(!ht)continue;const ut=ht.programConfigurations.get(d.id),Tt=w.useProgram(F,ut),bt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(at);E&&(w.context.activeTexture.set(R.TEXTURE0),tt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ut.updatePaintBuffers(I)),Aa(ut,g,W,tt,d);const pt=bt?at:null,ft=w.translatePosMatrix(pt?pt.posMatrix:at.posMatrix,tt,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(B){V=ht.indexBuffer2,U=ht.segments2;const jt=[R.drawingBufferWidth,R.drawingBufferHeight];z=F==="fillOutlinePattern"&&E?gi(ft,w,I,tt,jt):Se(ft,jt)}else V=ht.indexBuffer,U=ht.segments,z=E?ue(ft,w,I,tt):Dt(ft);Tt.draw(w.context,O,_,w.stencilModeForClipping(at),A,Fi.disabled,z,bt,d.id,ht.layoutVertexBuffer,V,U,d.paint,w.transform.zoom,ut)}}function Wo(w,a,d,m,_,A,B){const R=w.context,g=R.gl,b="fill-extrusion-pattern",E=d.paint.get(b),I=E.constantOr(1),O=d.getCrossfadeParameters(),F=d.paint.get("fill-extrusion-opacity"),z=E.constantOr(null);for(const V of m){const U=a.getTile(V),W=U.getBucket(d);if(!W)continue;const at=w.style.map.terrain&&w.style.map.terrain.getTerrainData(V),tt=W.programConfigurations.get(d.id),ht=w.useProgram(I?"fillExtrusionPattern":"fillExtrusion",tt);I&&(w.context.activeTexture.set(g.TEXTURE0),U.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),tt.updatePaintBuffers(O)),Aa(tt,b,z,U,d);const ut=w.translatePosMatrix(V.posMatrix,U,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Tt=d.paint.get("fill-extrusion-vertical-gradient"),bt=I?mt(ut,w,Tt,F,V,O,U):rt(ut,w,Tt,F);ht.draw(R,R.gl.TRIANGLES,_,A,B,Fi.backCCW,bt,at,d.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,d.paint,w.transform.zoom,tt,w.style.map.terrain&&W.centroidVertexBuffer)}}function Ds(w,a,d,m,_,A,B){const R=w.context,g=R.gl,b=d.fbo;if(!b)return;const E=w.useProgram("hillshade"),I=w.style.map.terrain&&w.style.map.terrain.getTerrainData(a);R.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,b.colorAttachment.get()),E.draw(R,g.TRIANGLES,_,A,B,Fi.disabled,((O,F,z,V)=>{const U=z.paint.get("hillshade-shadow-color"),W=z.paint.get("hillshade-highlight-color"),at=z.paint.get("hillshade-accent-color");let tt=z.paint.get("hillshade-illumination-direction")*(Math.PI/180);z.paint.get("hillshade-illumination-anchor")==="viewport"&&(tt-=O.transform.angle);const ht=!O.options.moving;return{u_matrix:V?V.posMatrix:O.transform.calculatePosMatrix(F.tileID.toUnwrapped(),ht),u_image:0,u_latrange:rh(0,F.tileID),u_light:[z.paint.get("hillshade-exaggeration"),tt],u_shadow:U,u_highlight:W,u_accent:at}})(w,d,m,I?a:null),I,m.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function Sa(w,a,d,m,_,A){const B=w.context,R=B.gl,g=a.dem;if(g&&g.data){const b=g.dim,E=g.stride,I=g.getPixels();if(B.activeTexture.set(R.TEXTURE1),B.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||w.getTileTexture(E),a.demTexture){const F=a.demTexture;F.update(I,{premultiply:!1}),F.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else a.demTexture=new ot(B,I,R.RGBA,{premultiply:!1}),a.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);B.activeTexture.set(R.TEXTURE0);let O=a.fbo;if(!O){const F=new ot(B,{width:b,height:b,data:null},R.RGBA);F.bind(R.LINEAR,R.CLAMP_TO_EDGE),O=a.fbo=B.createFramebuffer(b,b,!0,!1),O.colorAttachment.set(F.texture)}B.bindFramebuffer.set(O.framebuffer),B.viewport.set([0,0,b,b]),w.useProgram("hillshadePrepare").draw(B,R.TRIANGLES,m,_,A,Fi.disabled,((F,z)=>{const V=z.stride,U=l.F();return l.aN(U,0,l.W,-l.W,0,0,1),l.H(U,U,[0,-l.W,0]),{u_matrix:U,u_image:1,u_dimension:[V,V],u_zoom:F.overscaledZ,u_unpack:z.getUnpackVector()}})(a.tileID,g),null,d.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function tl(w,a,d,m,_,A){const B=m.paint.get("raster-fade-duration");if(!A&&B>0){const R=T.now(),g=(R-w.timeAdded)/B,b=a?(R-a.timeAdded)/B:-1,E=d.getSource(),I=_.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),O=!a||Math.abs(a.tileID.overscaledZ-I)>Math.abs(w.tileID.overscaledZ-I),F=O&&w.refreshedUponExpiration?1:l.ac(O?g:1-b,0,1);return w.refreshedUponExpiration&&g>=1&&(w.refreshedUponExpiration=!1),a?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}const el=new l.aO(1,0,0,1),Ea=new l.aO(0,1,0,1),Js=new l.aO(0,0,1,1),Xh=new l.aO(1,0,1,1),Gl=new l.aO(0,1,1,1);function Lr(w,a,d,m){ms(w,0,a+d/2,w.transform.width,d,m)}function As(w,a,d,m){ms(w,a-d/2,0,d,w.transform.height,m)}function ms(w,a,d,m,_,A){const B=w.context,R=B.gl;R.enable(R.SCISSOR_TEST),R.scissor(a*w.pixelRatio,d*w.pixelRatio,m*w.pixelRatio,_*w.pixelRatio),B.clear({color:A}),R.disable(R.SCISSOR_TEST)}function bc(w,a,d){const m=w.context,_=m.gl,A=d.posMatrix,B=w.useProgram("debug"),R=ui.disabled,g=Ri.disabled,b=w.colorModeForRenderPass(),E="$debug",I=w.style.map.terrain&&w.style.map.terrain.getTerrainData(d);m.activeTexture.set(_.TEXTURE0);const O=a.getTileByID(d.key).latestRawTileData,F=Math.floor((O&&O.byteLength||0)/1024),z=a.getTile(d).tileSize,V=512/Math.min(z,512)*(d.overscaledZ/w.transform.zoom)*.5;let U=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(U+=` => ${d.overscaledZ}`),function(W,at){W.initDebugOverlayCanvas();const tt=W.debugOverlayCanvas,ht=W.context.gl,ut=W.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,tt.width,tt.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(at,5,5),ut.strokeText(at,5,5),W.debugOverlayTexture.update(tt),W.debugOverlayTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE)}(w,`${U} ${F}kB`),B.draw(m,_.TRIANGLES,R,g,hi.alphaBlended,Fi.disabled,fs(A,l.aO.transparent,V),null,E,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),B.draw(m,_.LINE_STRIP,R,g,b,Fi.disabled,fs(A,l.aO.red),I,E,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function Vl(w,a,d){const m=w.context,_=m.gl,A=w.colorModeForRenderPass(),B=new ui(_.LEQUAL,ui.ReadWrite,w.depthRangeFor3D),R=w.useProgram("terrain"),g=a.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,w.width,w.height]);for(const b of d){const E=w.renderToTexture.getTexture(b),I=a.getTerrainData(b.tileID);m.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,E.texture);const O={u_matrix:w.transform.calculatePosMatrix(b.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(w.transform.zoom)};R.draw(m,_.TRIANGLES,B,Ri.disabled,A,Fi.backCCW,O,I,"terrain",g.vertexBuffer,g.indexBuffer,g.segments)}}class Jo{constructor(a,d){this.context=new rr(a),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ci.maxUnderzooming+Ci.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ys}resize(a,d,m){if(this.width=Math.floor(a*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const a=this.context,d=new l.aV;d.emplaceBack(0,0),d.emplaceBack(l.W,0),d.emplaceBack(0,l.W),d.emplaceBack(l.W,l.W),this.tileExtentBuffer=a.createVertexBuffer(d,ps.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const m=new l.aV;m.emplaceBack(0,0),m.emplaceBack(l.W,0),m.emplaceBack(0,l.W),m.emplaceBack(l.W,l.W),this.debugBuffer=a.createVertexBuffer(m,ps.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const _=new l.Z;_.emplaceBack(0,0,0,0),_.emplaceBack(l.W,0,l.W,0),_.emplaceBack(0,l.W,0,l.W),_.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=a.createVertexBuffer(_,ve.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const A=new l.aV;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(A,ps.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const B=new l.aW;B.emplaceBack(0),B.emplaceBack(1),B.emplaceBack(3),B.emplaceBack(2),B.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(B);const R=new l.aX;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(R);const g=this.context.gl;this.stencilClearMode=new Ri({func:g.ALWAYS,mask:0},0,255,g.ZERO,g.ZERO,g.ZERO)}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=l.F();l.aN(m,0,this.width,this.height,0,0,1),l.J(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,d.TRIANGLES,ui.disabled,this.stencilClearMode,hi.disabled,Fi.disabled,rs(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,d){if(this.currentStencilSource===a.source||!a.isTileClipped()||!d||!d.length)return;this.currentStencilSource=a.source;const m=this.context,_=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(hi.disabled),m.setDepthMode(ui.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of d){const R=this._tileClippingMaskIDs[B.key]=this.nextStencilID++,g=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B);A.draw(m,_.TRIANGLES,ui.disabled,new Ri({func:_.ALWAYS,mask:0},R,255,_.KEEP,_.KEEP,_.REPLACE),hi.disabled,Fi.disabled,rs(B.posMatrix),g,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new Ri({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){const d=this.context.gl;return new Ri({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,m=a.sort((B,R)=>R.overscaledZ-B.overscaledZ),_=m[m.length-1].overscaledZ,A=m[0].overscaledZ-_+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const B={};for(let R=0;R<A;R++)B[R+_]=new Ri({func:d.GEQUAL,mask:255},R+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=A,[B,m]}return[{[_]:Ri.disabled},m]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new hi([a.CONSTANT_COLOR,a.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hi.unblended:hi.alphaBlended}depthModeForSublayer(a,d,m){if(!this.opaquePassEnabledForLayer())return ui.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new ui(m||this.context.gl.LEQUAL,d,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(T.now()),this.imageManager.beginFrame();const m=this.style._order,_=this.style.sourceCaches,A={},B={},R={};for(const g in _){const b=_[g];b.used&&b.prepare(this.context),A[g]=b.getVisibleCoordinates(),B[g]=A[g].slice().reverse(),R[g]=b.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let g=0;g<m.length;g++)if(this.style._layers[m[g]].is3D()){this.opaquePassCutoff=g;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const g of m){const b=this.style._layers[g];if(!b.hasOffscreenPass()||b.isHidden(this.transform.zoom))continue;const E=B[b.source];(b.type==="custom"||E.length)&&this.renderLayer(this,_[b.source],b,E)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const g=this.style._layers[m[this.currentLayer]],b=_[g.source],E=A[g.source];this._renderTileClippingMasks(g,E),this.renderLayer(this,b,g,E)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const g=this.style._layers[m[this.currentLayer]],b=_[g.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(g))continue;const E=(g.type==="symbol"?R:B)[g.source];this._renderTileClippingMasks(g,A[g.source]),this.renderLayer(this,b,g,E)}if(this.options.showTileBoundaries){const g=function(b,E){let I=null;const O=Object.values(b._layers).flatMap(U=>U.source&&!U.isHidden(E)?[b.sourceCaches[U.source]]:[]),F=O.filter(U=>U.getSource().type==="vector"),z=O.filter(U=>U.getSource().type!=="vector"),V=U=>{(!I||I.getSource().maxzoom<U.getSource().maxzoom)&&(I=U)};return F.forEach(U=>V(U)),I||z.forEach(U=>V(U)),I}(this.style,this.transform.zoom);g&&function(b,E,I){for(let O=0;O<I.length;O++)bc(b,E,I[O])}(this,g,g.getVisibleCoordinates())}this.options.showPadding&&function(g){const b=g.transform.padding;Lr(g,g.transform.height-(b.top||0),3,el),Lr(g,b.bottom||0,3,Ea),As(g,b.left||0,3,Js),As(g,g.transform.width-(b.right||0),3,Xh);const E=g.transform.centerPoint;(function(I,O,F,z){ms(I,O-1,F-10,2,20,z),ms(I,O-10,F-1,20,2,z)})(g,E.x,g.transform.height-E.y,Gl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(a){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,m=this.transform.projMatrix;let _=this.terrainFacilitator.dirty;_||(_=a?!l.aY(d,m):!l.aZ(d,m)),_||(_=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),_&&(l.a_(d,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,B){const R=A.context,g=R.gl,b=hi.unblended,E=new ui(g.LEQUAL,ui.ReadWrite,[0,1]),I=B.getTerrainMesh(),O=B.sourceCache.getRenderableTiles(),F=A.useProgram("terrainDepth");R.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:l.aO.transparent,depth:1});for(const z of O){const V=B.getTerrainData(z.tileID),U={u_matrix:A.transform.calculatePosMatrix(z.tileID.toUnwrapped()),u_ele_delta:B.getMeshFrameDelta(A.transform.zoom)};F.draw(R,g.TRIANGLES,E,Ri.disabled,b,Fi.backCCW,U,V,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,B){const R=A.context,g=R.gl,b=hi.unblended,E=new ui(g.LEQUAL,ui.ReadWrite,[0,1]),I=B.getTerrainMesh(),O=B.getCoordsTexture(),F=B.sourceCache.getRenderableTiles(),z=A.useProgram("terrainCoords");R.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:l.aO.transparent,depth:1}),B.coordsIndex=[];for(const V of F){const U=B.getTerrainData(V.tileID);R.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,O.texture);const W={u_matrix:A.transform.calculatePosMatrix(V.tileID.toUnwrapped()),u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0,u_ele_delta:B.getMeshFrameDelta(A.transform.zoom)};z.draw(R,g.TRIANGLES,E,Ri.disabled,b,Fi.backCCW,W,U,"terrain",I.vertexBuffer,I.indexBuffer,I.segments),B.coordsIndex.push(V.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}renderLayer(a,d,m,_){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(_||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(A,B,R,g,b){if(A.renderPass!=="translucent")return;const E=Ri.disabled,I=A.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,F,z,V,U,W,at){const tt=F.transform,ht=U==="map",ut=W==="map";for(const Tt of O){const bt=V.getTile(Tt),pt=bt.getBucket(z);if(!pt||!pt.text||!pt.text.segments.get().length)continue;const ft=l.ag(pt.textSizeData,tt.zoom),jt=si(bt,1,F.transform.zoom),Wt=vi(Tt.posMatrix,ut,ht,F.transform,jt),se=z.layout.get("icon-text-fit")!=="none"&&pt.hasIconData();if(ft){const ne=Math.pow(2,tt.zoom-bt.tileID.overscaledZ);Ya(pt,ht,ut,at,tt,Wt,Tt.posMatrix,ne,ft,se,F.style.map.terrain?(fe,Me)=>F.style.map.terrain.getElevation(Tt,fe,Me):null)}}}(g,A,R,B,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),b),R.paint.get("icon-opacity").constantOr(1)!==0&&xa(A,B,R,g,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),E,I),R.paint.get("text-opacity").constantOr(1)!==0&&xa(A,B,R,g,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),E,I),B.map.showCollisionBoxes&&(an(A,B,R,g,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),!0),an(A,B,R,g,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),!1))})(a,d,m,_,this.style.placement.variableOffsets);break;case"circle":(function(A,B,R,g){if(A.renderPass!=="translucent")return;const b=R.paint.get("circle-opacity"),E=R.paint.get("circle-stroke-width"),I=R.paint.get("circle-stroke-opacity"),O=!R.layout.get("circle-sort-key").isConstant();if(b.constantOr(1)===0&&(E.constantOr(1)===0||I.constantOr(1)===0))return;const F=A.context,z=F.gl,V=A.depthModeForSublayer(0,ui.ReadOnly),U=Ri.disabled,W=A.colorModeForRenderPass(),at=[];for(let tt=0;tt<g.length;tt++){const ht=g[tt],ut=B.getTile(ht),Tt=ut.getBucket(R);if(!Tt)continue;const bt=Tt.programConfigurations.get(R.id),pt=A.useProgram("circle",bt),ft=Tt.layoutVertexBuffer,jt=Tt.indexBuffer,Wt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ht),se={programConfiguration:bt,program:pt,layoutVertexBuffer:ft,indexBuffer:jt,uniformValues:Mi(A,ht,ut,R),terrainData:Wt};if(O){const ne=Tt.segments.get();for(const fe of ne)at.push({segments:new l.$([fe]),sortKey:fe.sortKey,state:se})}else at.push({segments:Tt.segments,sortKey:0,state:se})}O&&at.sort((tt,ht)=>tt.sortKey-ht.sortKey);for(const tt of at){const{programConfiguration:ht,program:ut,layoutVertexBuffer:Tt,indexBuffer:bt,uniformValues:pt,terrainData:ft}=tt.state;ut.draw(F,z.TRIANGLES,V,U,W,Fi.disabled,pt,ft,R.id,Tt,bt,tt.segments,R.paint,A.transform.zoom,ht)}})(a,d,m,_);break;case"heatmap":(function(A,B,R,g){if(R.paint.get("heatmap-opacity")!==0)if(A.renderPass==="offscreen"){const b=A.context,E=b.gl,I=Ri.disabled,O=new hi([E.ONE,E.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(F,z,V){const U=F.gl;F.activeTexture.set(U.TEXTURE1),F.viewport.set([0,0,z.width/4,z.height/4]);let W=V.heatmapFbo;if(W)U.bindTexture(U.TEXTURE_2D,W.colorAttachment.get()),F.bindFramebuffer.set(W.framebuffer);else{const at=U.createTexture();U.bindTexture(U.TEXTURE_2D,at),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),W=V.heatmapFbo=F.createFramebuffer(z.width/4,z.height/4,!1,!1),function(tt,ht,ut,Tt){var bt,pt;const ft=tt.gl,jt=(bt=tt.HALF_FLOAT)!==null&&bt!==void 0?bt:ft.UNSIGNED_BYTE,Wt=(pt=tt.RGBA16F)!==null&&pt!==void 0?pt:ft.RGBA;ft.texImage2D(ft.TEXTURE_2D,0,Wt,ht.width/4,ht.height/4,0,ft.RGBA,jt,null),Tt.colorAttachment.set(ut)}(F,z,at,W)}})(b,A,R),b.clear({color:l.aO.transparent});for(let F=0;F<g.length;F++){const z=g[F];if(B.hasRenderableParent(z))continue;const V=B.getTile(z),U=V.getBucket(R);if(!U)continue;const W=U.programConfigurations.get(R.id),at=A.useProgram("heatmap",W),{zoom:tt}=A.transform;at.draw(b,E.TRIANGLES,ui.disabled,I,O,Fi.disabled,Ar(z.posMatrix,V,tt,R.paint.get("heatmap-intensity")),null,R.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,R.paint,A.transform.zoom,W)}b.viewport.set([0,0,A.width,A.height])}else A.renderPass==="translucent"&&(A.context.setColorMode(A.colorModeForRenderPass()),function(b,E){const I=b.context,O=I.gl,F=E.heatmapFbo;if(!F)return;I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,F.colorAttachment.get()),I.activeTexture.set(O.TEXTURE1);let z=E.colorRampTexture;z||(z=E.colorRampTexture=new ot(I,E.colorRamp,O.RGBA)),z.bind(O.LINEAR,O.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(I,O.TRIANGLES,ui.disabled,Ri.disabled,b.colorModeForRenderPass(),Fi.disabled,((V,U,W,at)=>{const tt=l.F();l.aN(tt,0,V.width,V.height,0,0,1);const ht=V.context.gl;return{u_matrix:tt,u_world:[ht.drawingBufferWidth,ht.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}})(b,E),null,E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(A,R))})(a,d,m,_);break;case"line":(function(A,B,R,g){if(A.renderPass!=="translucent")return;const b=R.paint.get("line-opacity"),E=R.paint.get("line-width");if(b.constantOr(1)===0||E.constantOr(1)===0)return;const I=A.depthModeForSublayer(0,ui.ReadOnly),O=A.colorModeForRenderPass(),F=R.paint.get("line-dasharray"),z=R.paint.get("line-pattern"),V=z.constantOr(1),U=R.paint.get("line-gradient"),W=R.getCrossfadeParameters(),at=V?"linePattern":F?"lineSDF":U?"lineGradient":"line",tt=A.context,ht=tt.gl;let ut=!0;for(const Tt of g){const bt=B.getTile(Tt);if(V&&!bt.patternsLoaded())continue;const pt=bt.getBucket(R);if(!pt)continue;const ft=pt.programConfigurations.get(R.id),jt=A.context.program.get(),Wt=A.useProgram(at,ft),se=ut||Wt.program!==jt,ne=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Tt),fe=z.constantOr(null);if(fe&&bt.imageAtlas){const je=bt.imageAtlas,$e=je.patternPositions[fe.to.toString()],Ze=je.patternPositions[fe.from.toString()];$e&&Ze&&ft.setConstantPatternPositions($e,Ze)}const Me=ne?Tt:null,we=V?Vo(A,bt,R,W,Me):F?kl(A,bt,R,F,W,Me):U?Li(A,bt,R,pt.lineClipsArray.length,Me):Ha(A,bt,R,Me);if(V)tt.activeTexture.set(ht.TEXTURE0),bt.imageAtlasTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE),ft.updatePaintBuffers(W);else if(F&&(se||A.lineAtlas.dirty))tt.activeTexture.set(ht.TEXTURE0),A.lineAtlas.bind(tt);else if(U){const je=pt.gradients[R.id];let $e=je.texture;if(R.gradientVersion!==je.version){let Ze=256;if(R.stepInterpolant){const yi=B.getSource().maxzoom,_i=Tt.canonical.z===yi?Math.ceil(1<<A.transform.maxZoom-Tt.canonical.z):1;Ze=l.ac(l.aT(pt.maxLineLength/l.W*1024*_i),256,tt.maxTextureSize)}je.gradient=l.aU({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:Ze,image:je.gradient||void 0,clips:pt.lineClipsArray}),je.texture?je.texture.update(je.gradient):je.texture=new ot(tt,je.gradient,ht.RGBA),je.version=R.gradientVersion,$e=je.texture}tt.activeTexture.set(ht.TEXTURE0),$e.bind(R.stepInterpolant?ht.NEAREST:ht.LINEAR,ht.CLAMP_TO_EDGE)}Wt.draw(tt,ht.TRIANGLES,I,A.stencilModeForClipping(Tt),O,Fi.disabled,we,ne,R.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,R.paint,A.transform.zoom,ft,pt.layoutVertexBuffer2),ut=!1}})(a,d,m,_);break;case"fill":(function(A,B,R,g){const b=R.paint.get("fill-color"),E=R.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const I=A.colorModeForRenderPass(),O=R.paint.get("fill-pattern"),F=A.opaquePassEnabledForLayer()&&!O.constantOr(1)&&b.constantOr(l.aO.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(A.renderPass===F){const z=A.depthModeForSublayer(1,A.renderPass==="opaque"?ui.ReadWrite:ui.ReadOnly);Ul(A,B,R,g,z,I,!1)}if(A.renderPass==="translucent"&&R.paint.get("fill-antialias")){const z=A.depthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,ui.ReadOnly);Ul(A,B,R,g,z,I,!0)}})(a,d,m,_);break;case"fill-extrusion":(function(A,B,R,g){const b=R.paint.get("fill-extrusion-opacity");if(b!==0&&A.renderPass==="translucent"){const E=new ui(A.context.gl.LEQUAL,ui.ReadWrite,A.depthRangeFor3D);if(b!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))Wo(A,B,R,g,E,Ri.disabled,hi.disabled),Wo(A,B,R,g,E,A.stencilModeFor3D(),A.colorModeForRenderPass());else{const I=A.colorModeForRenderPass();Wo(A,B,R,g,E,Ri.disabled,I)}}})(a,d,m,_);break;case"hillshade":(function(A,B,R,g){if(A.renderPass!=="offscreen"&&A.renderPass!=="translucent")return;const b=A.context,E=A.depthModeForSublayer(0,ui.ReadOnly),I=A.colorModeForRenderPass(),[O,F]=A.renderPass==="translucent"?A.stencilConfigForOverlap(g):[{},g];for(const z of F){const V=B.getTile(z);V.needsHillshadePrepare!==void 0&&V.needsHillshadePrepare&&A.renderPass==="offscreen"?Sa(A,V,R,E,Ri.disabled,I):A.renderPass==="translucent"&&Ds(A,z,V,R,E,O[z.overscaledZ],I)}b.viewport.set([0,0,A.width,A.height])})(a,d,m,_);break;case"raster":(function(A,B,R,g){if(A.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!g.length)return;const b=A.context,E=b.gl,I=B.getSource(),O=A.useProgram("raster"),F=A.colorModeForRenderPass(),[z,V]=I instanceof Ee?[{},g]:A.stencilConfigForOverlap(g),U=V[V.length-1].overscaledZ,W=!A.options.moving;for(const at of V){const tt=A.depthModeForSublayer(at.overscaledZ-U,R.paint.get("raster-opacity")===1?ui.ReadWrite:ui.ReadOnly,E.LESS),ht=B.getTile(at);ht.registerFadeDuration(R.paint.get("raster-fade-duration"));const ut=B.findLoadedParent(at,0),Tt=tl(ht,ut,B,R,A.transform,A.style.map.terrain);let bt,pt;const ft=R.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;b.activeTexture.set(E.TEXTURE0),ht.texture.bind(ft,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(E.TEXTURE1),ut?(ut.texture.bind(ft,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),bt=Math.pow(2,ut.tileID.overscaledZ-ht.tileID.overscaledZ),pt=[ht.tileID.canonical.x*bt%1,ht.tileID.canonical.y*bt%1]):ht.texture.bind(ft,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST);const jt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(at),Wt=jt?at:null,se=Wt?Wt.posMatrix:A.transform.calculatePosMatrix(at.toUnwrapped(),W),ne=Wa(se,pt||[0,0],bt||1,Tt,R);I instanceof Ee?O.draw(b,E.TRIANGLES,tt,Ri.disabled,F,Fi.disabled,ne,jt,R.id,I.boundsBuffer,A.quadTriangleIndexBuffer,I.boundsSegments):O.draw(b,E.TRIANGLES,tt,z[at.overscaledZ],F,Fi.disabled,ne,jt,R.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments)}})(a,d,m,_);break;case"background":(function(A,B,R,g){const b=R.paint.get("background-color"),E=R.paint.get("background-opacity");if(E===0)return;const I=A.context,O=I.gl,F=A.transform,z=F.tileSize,V=R.paint.get("background-pattern");if(A.isPatternMissing(V))return;const U=!V&&b.a===1&&E===1&&A.opaquePassEnabledForLayer()?"opaque":"translucent";if(A.renderPass!==U)return;const W=Ri.disabled,at=A.depthModeForSublayer(0,U==="opaque"?ui.ReadWrite:ui.ReadOnly),tt=A.colorModeForRenderPass(),ht=A.useProgram(V?"backgroundPattern":"background"),ut=g||F.coveringTiles({tileSize:z,terrain:A.style.map.terrain});V&&(I.activeTexture.set(O.TEXTURE0),A.imageManager.bind(A.context));const Tt=R.getCrossfadeParameters();for(const bt of ut){const pt=g?bt.posMatrix:A.transform.calculatePosMatrix(bt.toUnwrapped()),ft=V?gc(pt,E,A,V,{tileID:bt,tileSize:z},Tt):Jh(pt,E,b),jt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(bt);ht.draw(I,O.TRIANGLES,at,W,tt,Fi.disabled,ft,jt,R.id,A.tileExtentBuffer,A.quadTriangleIndexBuffer,A.tileExtentSegments)}})(a,0,m,_);break;case"custom":(function(A,B,R){const g=A.context,b=R.implementation;if(A.renderPass==="offscreen"){const E=b.prerender;E&&(A.setCustomLayerDefaults(),g.setColorMode(A.colorModeForRenderPass()),E.call(b,g.gl,A.transform.customLayerMatrix()),g.setDirty(),A.setBaseState())}else if(A.renderPass==="translucent"){A.setCustomLayerDefaults(),g.setColorMode(A.colorModeForRenderPass()),g.setStencilMode(Ri.disabled);const E=b.renderingMode==="3d"?new ui(A.context.gl.LEQUAL,ui.ReadWrite,A.depthRangeFor3D):A.depthModeForSublayer(0,ui.ReadOnly);g.setDepthMode(E),b.render(g.gl,A.transform.customLayerMatrix()),g.setDirty(),A.setBaseState(),g.bindFramebuffer.set(null)}})(a,0,m)}}translatePosMatrix(a,d,m,_,A){if(!m[0]&&!m[1])return a;const B=A?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(B){const b=Math.sin(B),E=Math.cos(B);m=[m[0]*E-m[1]*b,m[0]*b+m[1]*E]}const R=[A?m[0]:si(d,m[0],this.transform.zoom),A?m[1]:si(d,m[1],this.transform.zoom),0],g=new Float32Array(16);return l.H(g,a,R),g}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const d=this.imageManager.getPattern(a.from.toString()),m=this.imageManager.getPattern(a.to.toString());return!d||!m}useProgram(a,d){this.cache=this.cache||{};const m=a+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new xn(this.context,hs[a],d,ga[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ot(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:d}=this.context.gl;return this.width!==a||this.height!==d}}class ys{constructor(a,d){this.points=a,this.planes=d}static fromInvProjectionMatrix(a,d,m){const _=Math.pow(2,m),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const g=1/(R=l.af([],R,a))[3]/d*_;return l.a$(R,R,[g,g,1/R[3],g])}),B=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const g=function(O,F){var z=F[0],V=F[1],U=F[2],W=z*z+V*V+U*U;return W>0&&(W=1/Math.sqrt(W)),O[0]=F[0]*W,O[1]=F[1]*W,O[2]=F[2]*W,O}([],function(O,F,z){var V=F[0],U=F[1],W=F[2],at=z[0],tt=z[1],ht=z[2];return O[0]=U*ht-W*tt,O[1]=W*at-V*ht,O[2]=V*tt-U*at,O}([],xt([],A[R[0]],A[R[1]]),xt([],A[R[2]],A[R[1]]))),b=-((E=g)[0]*(I=A[R[1]])[0]+E[1]*I[1]+E[2]*I[2]);var E,I;return g.concat(b)});return new ys(A,B)}}class Ss{constructor(a,d){this.min=a,this.max=d,this.center=function(m,_,A){return m[0]=.5*_[0],m[1]=.5*_[1],m[2]=.5*_[2],m}([],function(m,_,A){return m[0]=_[0]+A[0],m[1]=_[1]+A[1],m[2]=_[2]+A[2],m}([],this.min,this.max))}quadrant(a){const d=[a%2==0,a<2],m=Nt(this.min),_=Nt(this.max);for(let A=0;A<d.length;A++)m[A]=d[A]?this.min[A]:this.center[A],_[A]=d[A]?this.center[A]:this.max[A];return _[2]=this.max[2],new Ss(m,_)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let _=0;_<a.planes.length;_++){const A=a.planes[_];let B=0;for(let R=0;R<d.length;R++)l.b0(A,d[R])>=0&&B++;if(B===0)return 0;B!==d.length&&(m=!1)}if(m)return 2;for(let _=0;_<3;_++){let A=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let R=0;R<a.points.length;R++){const g=a.points[R][_]-this.min[_];A=Math.min(A,g),B=Math.max(B,g)}if(B<0||A>this.max[_]-this.min[_])return 0}return 1}}class An{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,_=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=m,this.right=_}interpolate(a,d,m){return d.top!=null&&a.top!=null&&(this.top=l.z.number(a.top,d.top,m)),d.bottom!=null&&a.bottom!=null&&(this.bottom=l.z.number(a.bottom,d.bottom,m)),d.left!=null&&a.left!=null&&(this.left=l.z.number(a.left,d.left,m)),d.right!=null&&a.right!=null&&(this.right=l.z.number(a.right,d.right,m)),this}getCenter(a,d){const m=l.ac((this.left+a-this.right)/2,0,a),_=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(m,_)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new An(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const kn=85.051129;class On{constructor(a,d,m,_,A){this.tileSize=512,this._renderWorldCopies=A===void 0||!!A,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new An,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new On(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const d=-l.b1(a,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var m=new l.A(4);return l.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,_,A){var B=_[0],R=_[1],g=_[2],b=_[3],E=Math.sin(A),I=Math.cos(A);m[0]=B*I+g*E,m[1]=R*I+b*E,m[2]=B*-E+g*I,m[3]=R*-E+b*I}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=l.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,m){this._unmodified=!1,this._edgeInsets.interpolate(a,d,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new l.b2(0,a)];if(this._renderWorldCopies){const m=this.pointCoordinate(new l.P(0,0)),_=this.pointCoordinate(new l.P(this.width,0)),A=this.pointCoordinate(new l.P(this.width,this.height)),B=this.pointCoordinate(new l.P(0,this.height)),R=Math.floor(Math.min(m.x,_.x,A.x,B.x)),g=Math.floor(Math.max(m.x,_.x,A.x,B.x)),b=1;for(let E=R-b;E<=g+b;E++)E!==0&&d.push(new l.b2(E,a))}return d}coveringTiles(a){var d,m;let _=this.coveringZoomLevel(a);const A=_;if(a.minzoom!==void 0&&_<a.minzoom)return[];a.maxzoom!==void 0&&_>a.maxzoom&&(_=a.maxzoom);const B=this.pointCoordinate(this.getCameraPoint()),R=l.Y.fromLngLat(this.center),g=Math.pow(2,_),b=[g*B.x,g*B.y,0],E=[g*R.x,g*R.y,0],I=ys.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let O=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=_);const F=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,z=tt=>({aabb:new Ss([tt*g,0,0],[(tt+1)*g,g,0]),zoom:0,x:0,y:0,wrap:tt,fullyVisible:!1}),V=[],U=[],W=_,at=a.reparseOverscaled?A:_;if(this._renderWorldCopies)for(let tt=1;tt<=3;tt++)V.push(z(-tt)),V.push(z(tt));for(V.push(z(0));V.length>0;){const tt=V.pop(),ht=tt.x,ut=tt.y;let Tt=tt.fullyVisible;if(!Tt){const Wt=tt.aabb.intersects(I);if(Wt===0)continue;Tt=Wt===2}const bt=a.terrain?b:E,pt=tt.aabb.distanceX(bt),ft=tt.aabb.distanceY(bt),jt=Math.max(Math.abs(pt),Math.abs(ft));if(tt.zoom===W||jt>F+(1<<W-tt.zoom)-2&&tt.zoom>=O){const Wt=W-tt.zoom,se=b[0]-.5-(ht<<Wt),ne=b[1]-.5-(ut<<Wt);U.push({tileID:new l.Q(tt.zoom===W?at:tt.zoom,tt.wrap,tt.zoom,ht,ut),distanceSq:qt([E[0]-.5-ht,E[1]-.5-ut]),tileDistanceToCamera:Math.sqrt(se*se+ne*ne)})}else for(let Wt=0;Wt<4;Wt++){const se=(ht<<1)+Wt%2,ne=(ut<<1)+(Wt>>1),fe=tt.zoom+1;let Me=tt.aabb.quadrant(Wt);if(a.terrain){const we=new l.Q(fe,tt.wrap,fe,se,ne),je=a.terrain.getMinMaxElevation(we),$e=(d=je.minElevation)!==null&&d!==void 0?d:this.elevation,Ze=(m=je.maxElevation)!==null&&m!==void 0?m:this.elevation;Me=new Ss([Me.min[0],Me.min[1],$e],[Me.max[0],Me.max[1],Ze])}V.push({aabb:Me,zoom:fe,x:se,y:ne,wrap:tt.wrap,fullyVisible:Tt})}}return U.sort((tt,ht)=>tt.distanceSq-ht.distanceSq).map(tt=>tt.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=l.ac(a.lat,-85.051129,kn);return new l.P(l.N(a.lng)*this.worldSize,l.O(d)*this.worldSize)}unproject(a){return new l.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const d=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,_=this.pointLocation(this.centerPoint,a),A=a.getElevationForLngLatZoom(_,this.tileZoom);if(!(this.elevation-A))return;const B=m+d-A,R=Math.cos(this._pitch)*this.cameraToCenterDistance/B/l.b3(1,_.lat),g=this.scaleZoom(R/this.tileSize);this._elevation=A,this._center=_,this.zoom=g}setLocationAtPoint(a,d){const m=this.pointCoordinate(d),_=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(a),B=new l.Y(A.x-(m.x-_.x),A.y-(m.y-_.y));this.center=this.coordinateLocation(B),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,d){return d?this.coordinatePoint(this.locationCoordinate(a),d.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,d){return this.coordinateLocation(this.pointCoordinate(a,d))}locationCoordinate(a){return l.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,d){if(d){const O=d.pointCoordinate(a);if(O!=null)return O}const m=[a.x,a.y,0,1],_=[a.x,a.y,1,1];l.af(m,m,this.pixelMatrixInverse),l.af(_,_,this.pixelMatrixInverse);const A=m[3],B=_[3],R=m[1]/A,g=_[1]/B,b=m[2]/A,E=_[2]/B,I=b===E?0:(0-b)/(E-b);return new l.Y(l.z.number(m[0]/A,_[0]/B,I)/this.worldSize,l.z.number(R,g,I)/this.worldSize)}coordinatePoint(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const _=[a.x*this.worldSize,a.y*this.worldSize,d,1];return l.af(_,_,m),new l.P(_[0]/_[3],_[1]/_[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new Xe().extend(this.pointLocation(new l.P(0,a))).extend(this.pointLocation(new l.P(this.width,a))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,kn])}calculatePosMatrix(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const m=a.key,_=d?this._alignedPosMatrixCache:this._posMatrixCache;if(_[m])return _[m];const A=a.canonical,B=this.worldSize/this.zoomScale(A.z),R=A.x+Math.pow(2,A.z)*a.wrap,g=l.an(new Float64Array(16));return l.H(g,g,[R*B,A.y*B,0]),l.J(g,g,[B/l.W,B/l.W,1]),l.K(g,d?this.alignedProjMatrix:this.projMatrix,g),_[m]=new Float32Array(g),_[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(a,d){d=l.ac(+d,this.minZoom,this.maxZoom);const m={center:new l.M(a.lng,a.lat),zoom:d};let _=this.lngRange;if(!this._renderWorldCopies&&_===null){const tt=179.9999999999;_=[-tt,tt]}const A=this.tileSize*this.zoomScale(m.zoom);let B=0,R=A,g=0,b=A,E=0,I=0;const{x:O,y:F}=this.size;if(this.latRange){const tt=this.latRange;B=l.O(tt[1])*A,R=l.O(tt[0])*A,R-B<F&&(E=F/(R-B))}_&&(g=l.b1(l.N(_[0])*A,0,A),b=l.b1(l.N(_[1])*A,0,A),b<g&&(b+=A),b-g<O&&(I=O/(b-g)));const{x:z,y:V}=this.project.call({worldSize:A},a);let U,W;const at=Math.max(I||0,E||0);if(at){const tt=new l.P(I?(b+g)/2:z,E?(R+B)/2:V);return m.center=this.unproject.call({worldSize:A},tt).wrap(),m.zoom+=this.scaleZoom(at),m}if(this.latRange){const tt=F/2;V-tt<B&&(W=B+tt),V+tt>R&&(W=R-tt)}if(_){const tt=(g+b)/2;let ht=z;this._renderWorldCopies&&(ht=l.b1(z,tt-A/2,tt+A/2));const ut=O/2;ht-ut<g&&(U=g+ut),ht+ut>b&&(U=b-ut)}if(U!==void 0||W!==void 0){const tt=new l.P(U??z,W??V);m.center=this.unproject.call({worldSize:A},tt).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this._unmodified,{center:d,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=m,this._unmodified=a,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let _=l.an(new Float64Array(16));l.J(_,_,[this.width/2,-this.height/2,1]),l.H(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.an(new Float64Array(16)),l.J(_,_,[1,-1,1]),l.H(_,_,[-1,-1,0]),l.J(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_;const A=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),B=Math.min(this.elevation,this.minElevationForCurrentTile),R=A-B*this._pixelPerMeter/Math.cos(this._pitch),g=B<0?R:A,b=Math.PI/2+this._pitch,E=this._fov*(.5+a.y/this.height),I=Math.sin(E)*g/Math.sin(l.ac(Math.PI-b-E,.01,Math.PI-.01)),O=this.getHorizon(),F=2*Math.atan(O/this.cameraToCenterDistance)*(.5+a.y/(2*O)),z=Math.sin(F)*g/Math.sin(l.ac(Math.PI-b-F,.01,Math.PI-.01)),V=Math.min(I,z),U=1.01*(Math.cos(Math.PI/2-this._pitch)*V+g),W=this.height/50;_=new Float64Array(16),l.b4(_,this._fov,this.width/this.height,W,U),_[8]=2*-a.x/this.width,_[9]=2*a.y/this.height,l.J(_,_,[1,-1,1]),l.H(_,_,[0,0,-this.cameraToCenterDistance]),l.b5(_,_,this._pitch),l.ad(_,_,this.angle),l.H(_,_,[-d,-m,0]),this.mercatorMatrix=l.J([],_,[this.worldSize,this.worldSize,this.worldSize]),l.J(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,_),l.H(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.ar([],_),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,_);const at=this.width%2/2,tt=this.height%2/2,ht=Math.cos(this.angle),ut=Math.sin(this.angle),Tt=d-Math.round(d)+ht*at+ut*tt,bt=m-Math.round(m)+ht*tt+ut*at,pt=new Float64Array(_);if(l.H(pt,pt,[Tt>.5?Tt-1:Tt,bt>.5?bt-1:bt,0]),this.alignedProjMatrix=pt,_=l.ar(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new l.P(0,0)),d=[a.x*this.worldSize,a.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,a))}getCameraQueryGeometry(a){const d=this.getCameraPoint();if(a.length===1)return[a[0],d];{let m=d.x,_=d.y,A=d.x,B=d.y;for(const R of a)m=Math.min(m,R.x),_=Math.min(_,R.y),A=Math.max(A,R.x),B=Math.max(B,R.y);return[new l.P(m,_),new l.P(A,_),new l.P(A,B),new l.P(m,B),new l.P(m,_)]}}lngLatToCameraDepth(a,d){const m=this.locationCoordinate(a),_=[m.x*this.worldSize,m.y*this.worldSize,d,1];return l.af(_,_,this.projMatrix),_[2]/_[3]}}function Ca(w,a){var d=this;let m,_=!1,A=null,B=null;const R=()=>{A=null,_&&(w.apply(B,m),A=setTimeout(R,a),_=!1)};return function(){for(var g=arguments.length,b=new Array(g),E=0;E<g;E++)b[E]=arguments[E];return _=!0,B=d,m=b,A||R(),A}}class Sn{constructor(a){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(m=_)}),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=Ca(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,_=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,_),B=Math.round(d.lng*A)/A,R=Math.round(d.lat*A)/A,g=this._map.getBearing(),b=this._map.getPitch();let E="";if(E+=a?`/${B}/${R}/${m}`:`${m}/${R}/${B}`,(g||b)&&(E+="/"+Math.round(10*g)/10),b&&(E+=`/${Math.round(b)}`),this._hashName){const I=this._hashName;let O=!1;const F=window.location.hash.slice(1).split("&").map(z=>{const V=z.split("=")[0];return V===I?(O=!0,`${V}=${E}`):z}).filter(z=>z);return O||F.push(`${I}=${E}`),`#${F.join("&")}`}return`#${E}`}}const Io={linearity:.3,easing:l.b6(0,0,.3,1)},ao=l.e({deceleration:2500,maxSpeed:1400},Io),Zo=l.e({deceleration:20,maxSpeed:1400},Io),Dn=l.e({deceleration:1e3,maxSpeed:360},Io),Mo=l.e({deceleration:1e3,maxSpeed:90},Io);class Ta{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:T.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=T.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)d.zoom+=A.zoomDelta||0,d.bearing+=A.bearingDelta||0,d.pitch+=A.pitchDelta||0,A.panDelta&&d.pan._add(A.panDelta),A.around&&(d.around=A.around),A.pinchAround&&(d.pinchAround=A.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(d.pan.mag()){const A=lo(d.pan.mag(),m,l.e({},ao,a||{}));_.offset=d.pan.mult(A.amount/d.pan.mag()),_.center=this._map.transform.center,Lo(_,A)}if(d.zoom){const A=lo(d.zoom,m,Zo);_.zoom=this._map.transform.zoom+A.amount,Lo(_,A)}if(d.bearing){const A=lo(d.bearing,m,Dn);_.bearing=this._map.transform.bearing+l.ac(A.amount,-179,179),Lo(_,A)}if(d.pitch){const A=lo(d.pitch,m,Mo);_.pitch=this._map.transform.pitch+A.amount,Lo(_,A)}if(_.zoom||_.bearing){const A=d.pinchAround===void 0?d.around:d.pinchAround;_.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),l.e(_,{noMoveStart:!0})}}function Lo(w,a){(!w.duration||w.duration<a.duration)&&(w.duration=a.duration,w.easing=a.easing)}function lo(w,a,d){const{maxSpeed:m,linearity:_,deceleration:A}=d,B=l.ac(w*_/(a/1e3),-m,m),R=Math.abs(B)/(A*_);return{easing:d.easing,duration:1e3*R,amount:B*(R/2)}}class ns extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const A=P.mousePos(d.getCanvas(),m),B=d.unproject(A);super(a,l.e({point:A,lngLat:B,originalEvent:m},_)),this._defaultPrevented=!1,this.target=d}}class cn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,m){const _=a==="touchend"?m.changedTouches:m.touches,A=P.touchPos(d.getCanvasContainer(),_),B=A.map(g=>d.unproject(g)),R=A.reduce((g,b,E,I)=>g.add(b.div(I.length)),new l.P(0,0));super(a,{points:A,point:R,lngLats:B,lngLat:d.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class hn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,m){super(a,{originalEvent:m}),this._defaultPrevented=!1}}class _s{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new hn(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new ns(a.type,this._map,a))}mouseup(a){this._map.fire(new ns(a.type,this._map,a))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new ns(a.type,this._map,a))}dblclick(a){return this._firePreventable(new ns(a.type,this._map,a))}mouseover(a){this._map.fire(new ns(a.type,this._map,a))}mouseout(a){this._map.fire(new ns(a.type,this._map,a))}touchstart(a){return this._firePreventable(new cn(a.type,this._map,a))}touchmove(a){this._map.fire(new cn(a.type,this._map,a))}touchend(a){this._map.fire(new cn(a.type,this._map,a))}touchcancel(a){this._map.fire(new cn(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class er{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new ns(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ns("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new ns(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fr{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(l.P.convert(a),this._map.terrain)}}class gr{constructor(a,d){this._map=a,this._tr=new fr(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&a.button===0&&(P.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=m,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const A=Math.min(_.x,m.x),B=Math.max(_.x,m.x),R=Math.min(_.y,m.y),g=Math.max(_.y,m.y);P.setTransform(this._box,`translate(${A}px,${R}px)`),this._box.style.width=B-A+"px",this._box.style.height=g-R+"px"}mouseupWindow(a,d){if(!this._active||a.button!==0)return;const m=this._startPos,_=d;if(this.reset(),P.suppressClick(),m.x!==_.x||m.y!==_.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:a})),{cameraAnimation:A=>A.fitScreenCoordinates(m,_,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new l.k(a,{originalEvent:d}))}}function Dr(w,a){if(w.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${a.length}`);const d={};for(let m=0;m<w.length;m++)d[w[m].identifier]=a[m];return d}class Xo{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),m.length===this.numTouches&&(this.centroid=function(_){const A=new l.P(0,0);for(const B of _)A._add(B);return A.div(_.length)}(d),this.touches=Dr(m,d)))}touchmove(a,d,m){if(this.aborted||!this.centroid)return;const _=Dr(m,d);for(const A in this.touches){const B=_[A];(!B||B.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(a,d,m){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Bo{constructor(a){this.singleTap=new Xo(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,d,m){this.singleTap.touchstart(a,d,m)}touchmove(a,d,m){this.singleTap.touchmove(a,d,m)}touchend(a,d,m){const _=this.singleTap.touchend(a,d,m);if(_){const A=a.timeStamp-this.lastTime<500,B=!this.lastTap||this.lastTap.dist(_)<30;if(A&&B||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class ql{constructor(a){this._tr=new fr(a),this._zoomIn=new Bo({numTouches:1,numTaps:2}),this._zoomOut=new Bo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,m){this._zoomIn.touchstart(a,d,m),this._zoomOut.touchstart(a,d,m)}touchmove(a,d,m){this._zoomIn.touchmove(a,d,m),this._zoomOut.touchmove(a,d,m)}touchend(a,d,m){const _=this._zoomIn.touchend(a,d,m),A=this._zoomOut.touchend(a,d,m),B=this._tr;return _?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:B.zoom+1,around:B.unproject(_)},{originalEvent:a})}):A?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:B.zoom-1,around:B.unproject(A)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $o{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(){const a=this._moveFunction(...arguments);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(a,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const _=d.length?d[0]:d;return!this._moved&&_.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(m,_))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&P.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Hl={0:1,2:2};class co{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const d=P.mouseButton(a);this._eventButton=d}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(d,m){const _=Hl[m];return d.buttons===void 0||(d.buttons&_)!==_}(a,this._eventButton)}isValidEndEvent(a){return P.mouseButton(a)===this._eventButton}}class We{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const wc=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(a){a.preventDefault()}},il=w=>{let{enable:a,clickTolerance:d,bearingDegreesPerPixelMoved:m=.8}=w;const _=new co({checkCorrectEvent:A=>P.mouseButton(A)===0&&A.ctrlKey||P.mouseButton(A)===2});return new $o({clickTolerance:d,move:(A,B)=>({bearingDelta:(B.x-A.x)*m}),moveStateManager:_,enable:a,assignEvents:wc})},rl=w=>{let{enable:a,clickTolerance:d,pitchDegreesPerPixelMoved:m=-.5}=w;const _=new co({checkCorrectEvent:A=>P.mouseButton(A)===0&&A.ctrlKey||P.mouseButton(A)===2});return new $o({clickTolerance:d,move:(A,B)=>({pitchDelta:(B.y-A.y)*m}),moveStateManager:_,enable:a,assignEvents:wc})};class nh{constructor(a,d){this._clickTolerance=a.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,d,m){return this._calculateTransform(a,d,m)}touchmove(a,d,m){if(this._active&&!(m.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,d,m)}touchend(a,d,m){this._calculateTransform(a,d,m),this._active&&m.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,m){m.length>0&&(this._active=!0);const _=Dr(m,d),A=new l.P(0,0),B=new l.P(0,0);let R=0;for(const b in _){const E=_[b],I=this._touches[b];I&&(A._add(E),B._add(E.sub(I)),R++,_[b]=E)}if(this._touches=_,R<this.minTouchs()||!B.mag())return;const g=B.div(R);return this._sum._add(g),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(R),panDelta:g}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ne{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,m){if(!this._firstTwoTouches)return;a.preventDefault();const[_,A]=this._firstTwoTouches,B=Es(m,d,_),R=Es(m,d,A);if(!B||!R)return;const g=this._aroundCenter?null:B.add(R).div(2);return this._move([B,R],g,a)}touchend(a,d,m){if(!this._firstTwoTouches)return;const[_,A]=this._firstTwoTouches,B=Es(m,d,_),R=Es(m,d,A);B&&R||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Es(w,a,d){for(let m=0;m<w.length;m++)if(w[m].identifier===d)return a[m]}function En(w,a){return Math.log(w/a)/Math.LN2}class xc extends Ne{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const m=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(En(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:En(this._distance,m),pinchAround:d}}}function sl(w,a){return 180*w.angleWith(a)/Math.PI}class oh extends Ne{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d,m){const _=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:sl(this._vector,_),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,m=sl(a,this._startVector);return Math.abs(m)<d}}function nl(w){return Math.abs(w.y)>Math.abs(w.x)}class Ac extends Ne{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,d,m){super.touchstart(a,d,m),this._currentTouchCount=m.length}_start(a){this._lastPoints=a,nl(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const _=a[0].sub(this._lastPoints[0]),A=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,A,m.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(_.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(a,d,m){if(this._valid!==void 0)return this._valid;const _=a.mag()>=2,A=d.mag()>=2;if(!_&&!A)return;if(!_||!A)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const B=a.y>0==d.y>0;return nl(a)&&nl(d)&&B}}const $h={panStep:100,bearingStep:15,pitchStep:10};class Ko{constructor(a){this._tr=new fr(a);const d=$h;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,m=0,_=0,A=0,B=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?m=-1:(a.preventDefault(),A=-1);break;case 39:a.shiftKey?m=1:(a.preventDefault(),A=1);break;case 38:a.shiftKey?_=1:(a.preventDefault(),B=-1);break;case 40:a.shiftKey?_=-1:(a.preventDefault(),B=1);break;default:return}return this._rotationDisabled&&(m=0,_=0),{cameraAnimation:R=>{const g=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Cr,zoom:d?Math.round(g.zoom)+d*(a.shiftKey?2:1):g.zoom,bearing:g.bearing+m*this._bearingStep,pitch:g.pitch+_*this._pitchStep,offset:[-A*this._panStep,-B*this._panStep],center:g.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cr(w){return w*(2-w)}const ol=4.000244140625;class al{constructor(a,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=a,this._tr=new fr(a),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let d=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const m=T.now(),_=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%ol==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(_*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=P.mousePos(this._map.getCanvas(),a),m=this._tr;this._around=d.y>m.transform.height/2-m.transform.getHorizon()?l.M.convert(this._aroundCenter?m.center:m.unproject(d)):l.M.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>ol?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&g!==0&&(g=1/g);const b=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(b*g))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,m=this._startZoom,_=this._easing;let A,B=!1;if(this._type==="wheel"&&m&&_){const R=Math.min((T.now()-this._lastWheelEventTime)/200,1),g=_(R);A=l.z.number(m,d,g),R<1?this._frameId||(this._frameId=!0):B=!0}else A=d,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:A-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=l.b7;if(this._prevEase){const m=this._prevEase,_=(T.now()-m.start)/m.duration,A=m.easing(_+.01)-m.easing(_),B=.27/Math.sqrt(A*A+1e-4)*.01,R=Math.sqrt(.0729-B*B);d=l.b6(B,R,.25,1)}return this._prevEase={start:T.now(),duration:a,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Sc{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zu{constructor(a){this._tr=new fr(a),this.reset()}reset(){this._active=!1}dblclick(a,d){return a.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ju{constructor(){this._tap=new Bo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,d,m){if(!this._swipePoint)if(this._tapTime){const _=d[0],A=a.timeStamp-this._tapTime<500,B=this._tapPoint.dist(_)<30;A&&B?m.length>0&&(this._swipePoint=_,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(a,d,m)}touchmove(a,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const _=d[0],A=_.y-this._swipePoint.y;return this._swipePoint=_,a.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(a,d,m)}touchend(a,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const _=this._tap.touchend(a,d,m);_&&(this._tapTime=a.timeStamp,this._tapPoint=_)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kh{constructor(a,d,m){this._el=a,this._mousePan=d,this._touchPan=m}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ho{constructor(a,d,m){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ec{constructor(a,d,m,_){this._el=a,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ni{constructor(a,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",a);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),_=document.createElement("div");_.className="maplibregl-desktop-message",_.textContent=d,this._container.appendChild(_);const A=document.createElement("div");A.className="maplibregl-mobile-message",A.textContent=m,this._container.appendChild(A),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const di=w=>w.zoom||w.drag||w.pitch||w.rotate;class ah extends l.k{}function ll(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Cc{constructor(a,d){this.handleWindowEvent=_=>{this.handleEvent(_,`${_.type}Window`)},this.handleEvent=(_,A)=>{if(_.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const B=_.type==="renderFrame"?void 0:_,R={needsRenderFrame:!1},g={},b={},E=_.touches,I=E?this._getMapTouches(E):void 0,O=I?P.touchPos(this._map.getCanvas(),I):P.mousePos(this._map.getCanvas(),_);for(const{handlerName:V,handler:U,allowed:W}of this._handlers){if(!U.isEnabled())continue;let at;this._blockedByActive(b,W,V)?U.reset():U[A||_.type]&&(at=U[A||_.type](_,O,I),this.mergeHandlerResult(R,g,at,V,B),at&&at.needsRenderFrame&&this._triggerRenderFrame()),(at||U.isActive())&&(b[V]=U)}const F={};for(const V in this._previousActiveHandlers)b[V]||(F[V]=B);this._previousActiveHandlers=b,(Object.keys(F).length||ll(R))&&(this._changes.push([R,g,F]),this._triggerRenderFrame()),(Object.keys(b).length||ll(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=R;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ta(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,A,B]of this._listeners)P.addEventListener(_,A,_===document?this.handleWindowEvent:this.handleEvent,B)}destroy(){for(const[a,d,m]of this._listeners)P.removeEventListener(a,d,a===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(a){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new _s(d,a));const _=d.boxZoom=new gr(d,a);this._add("boxZoom",_),a.interactive&&a.boxZoom&&_.enable();const A=d.cooperativeGestures=new ni(d,a.cooperativeGestures);this._add("cooperativeGestures",A),a.cooperativeGestures&&A.enable();const B=new ql(d),R=new zu(d);d.doubleClickZoom=new Sc(R,B),this._add("tapZoom",B),this._add("clickZoom",R),a.interactive&&a.doubleClickZoom&&d.doubleClickZoom.enable();const g=new ju;this._add("tapDragZoom",g);const b=d.touchPitch=new Ac(d);this._add("touchPitch",b),a.interactive&&a.touchPitch&&d.touchPitch.enable(a.touchPitch);const E=il(a),I=rl(a);d.dragRotate=new ho(a,E,I),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),a.interactive&&a.dragRotate&&d.dragRotate.enable();const O=(at=>{let{enable:tt,clickTolerance:ht}=at;const ut=new co({checkCorrectEvent:Tt=>P.mouseButton(Tt)===0&&!Tt.ctrlKey});return new $o({clickTolerance:ht,move:(Tt,bt)=>({around:bt,panDelta:bt.sub(Tt)}),activateOnStart:!0,moveStateManager:ut,enable:tt,assignEvents:wc})})(a),F=new nh(a,d);d.dragPan=new Kh(m,O,F),this._add("mousePan",O),this._add("touchPan",F,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&d.dragPan.enable(a.dragPan);const z=new oh,V=new xc;d.touchZoomRotate=new Ec(m,V,z,g),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&d.touchZoomRotate.enable(a.touchZoomRotate);const U=d.scrollZoom=new al(d,()=>this._triggerRenderFrame());this._add("scrollZoom",U,["mousePan"]),a.interactive&&a.scrollZoom&&d.scrollZoom.enable(a.scrollZoom);const W=d.keyboard=new Ko(d);this._add("keyboard",W),a.interactive&&a.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new er(d))}_add(a,d,m){this._handlers.push({handlerName:a,handler:d,allowed:m}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!di(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,d,m){for(const _ in a)if(_!==m&&(!d||d.indexOf(_)<0))return!0;return!1}_getMapTouches(a){const d=[];for(const m of a)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(a,d,m,_,A){if(!m)return;l.e(a,m);const B={handlerName:_,originalEvent:m.originalEvent||A};m.zoomDelta!==void 0&&(d.zoom=B),m.panDelta!==void 0&&(d.drag=B),m.pitchDelta!==void 0&&(d.pitch=B),m.bearingDelta!==void 0&&(d.rotate=B)}_applyChanges(){const a={},d={},m={};for(const[_,A,B]of this._changes)_.panDelta&&(a.panDelta=(a.panDelta||new l.P(0,0))._add(_.panDelta)),_.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(a.around=_.around),_.pinchAround!==void 0&&(a.pinchAround=_.pinchAround),_.noInertia&&(a.noInertia=_.noInertia),l.e(d,A),l.e(m,B);this._updateMapTransform(a,d,m),this._changes=[]}_updateMapTransform(a,d,m){const _=this._map,A=_._getTransformForUpdate(),B=_.terrain;if(!(ll(a)||B&&this._terrainMovement))return this._fireEvents(d,m,!0);let{panDelta:R,zoomDelta:g,bearingDelta:b,pitchDelta:E,around:I,pinchAround:O}=a;O!==void 0&&(I=O),_._stop(!0),I=I||_.transform.centerPoint;const F=A.pointLocation(R?I.sub(R):I);b&&(A.bearing+=b),E&&(A.pitch+=E),g&&(A.zoom+=g),B?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?A.center=A.pointLocation(A.centerPoint.sub(R)):A.setLocationAtPoint(F,I):(this._terrainMovement=!0,this._map._elevationFreeze=!0,A.setLocationAtPoint(F,I),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,A.recalculateZoom(_.terrain)})):A.setLocationAtPoint(F,I),_._applyUpdatedTransform(A),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,m,!0)}_fireEvents(a,d,m){const _=di(this._eventsInProgress),A=di(a),B={};for(const E in a){const{originalEvent:I}=a[E];this._eventsInProgress[E]||(B[`${E}start`]=I),this._eventsInProgress[E]=a[E]}!_&&A&&this._fireEvent("movestart",A.originalEvent);for(const E in B)this._fireEvent(E,B[E]);A&&this._fireEvent("move",A.originalEvent);for(const E in a){const{originalEvent:I}=a[E];this._fireEvent(E,I)}const R={};let g;for(const E in this._eventsInProgress){const{handlerName:I,originalEvent:O}=this._eventsInProgress[E];this._handlersById[I].isActive()||(delete this._eventsInProgress[E],g=d[I]||O,R[`${E}end`]=g)}for(const E in R)this._fireEvent(E,R[E]);const b=di(this._eventsInProgress);if(m&&(_||A)&&!b){this._updatingCamera=!0;const E=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!E||!E.essential&&T.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:g})),I(this._map.getBearing())&&this._map.resetNorth()):(I(E.bearing||this._map.getBearing())&&(E.bearing=0),E.freezeElevation=!0,this._map.easeTo(E,{originalEvent:g})),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new l.k(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new ah("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Cs extends l.E{constructor(a,d){super(),this._renderFrameCallback=()=>{const m=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,m){return a=l.P.convert(a).mult(-1),this.panTo(this.transform.center,l.e({offset:a},d),m)}panTo(a,d,m){return this.easeTo(l.e({center:a},d),m)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,m){return this.easeTo(l.e({zoom:a},d),m)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,m){return this.easeTo(l.e({bearing:a},d),m)}resetNorth(a,d){return this.rotateTo(0,l.e({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=Xe.convert(a);const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),m,d)}_cameraForBoxAndBearing(a,d,m,_){const A={top:0,bottom:0,right:0,left:0};if(typeof(_=l.e({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const Wt=_.padding;_.padding={top:Wt,bottom:Wt,right:Wt,left:Wt}}_.padding=l.e(A,_.padding);const B=this.transform,R=B.padding,g=new Xe(a,d),b=B.project(g.getNorthWest()),E=B.project(g.getNorthEast()),I=B.project(g.getSouthEast()),O=B.project(g.getSouthWest()),F=l.b8(-m),z=b.rotate(F),V=E.rotate(F),U=I.rotate(F),W=O.rotate(F),at=new l.P(Math.max(z.x,V.x,W.x,U.x),Math.max(z.y,V.y,W.y,U.y)),tt=new l.P(Math.min(z.x,V.x,W.x,U.x),Math.min(z.y,V.y,W.y,U.y)),ht=at.sub(tt),ut=(B.width-(R.left+R.right+_.padding.left+_.padding.right))/ht.x,Tt=(B.height-(R.top+R.bottom+_.padding.top+_.padding.bottom))/ht.y;if(Tt<0||ut<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(B.scaleZoom(B.scale*Math.min(ut,Tt)),_.maxZoom),pt=l.P.convert(_.offset),ft=new l.P((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(l.b8(m)),jt=pt.add(ft).mult(B.scale/B.zoomScale(bt));return{center:B.unproject(b.add(I).div(2).sub(jt)),zoom:bt,bearing:m}}fitBounds(a,d,m){return this._fitInternal(this.cameraForBounds(a,d),d,m)}fitScreenCoordinates(a,d,m,_,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(a)),this.transform.pointLocation(l.P.convert(d)),m,_),_,A)}_fitInternal(a,d,m){return a?(delete(d=l.e(a,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(a,d){this.stop();const m=this._getTransformForUpdate();let _=!1,A=!1,B=!1;return"zoom"in a&&m.zoom!==+a.zoom&&(_=!0,m.zoom=+a.zoom),a.center!==void 0&&(m.center=l.M.convert(a.center)),"bearing"in a&&m.bearing!==+a.bearing&&(A=!0,m.bearing=+a.bearing),"pitch"in a&&m.pitch!==+a.pitch&&(B=!0,m.pitch=+a.pitch),a.padding==null||m.isPaddingEqual(a.padding)||(m.padding=a.padding),this._applyUpdatedTransform(m),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),_&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),A&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),B&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const A=l.Y.fromLngLat(a,d),B=l.Y.fromLngLat(m,_),R=B.x-A.x,g=B.y-A.y,b=B.z-A.z,E=Math.hypot(R,g,b);if(E===0)throw new Error("Can't calculate camera options with same From and To");const I=Math.hypot(R,g),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/E/this.transform.tileSize),F=180*Math.atan2(R,-g)/Math.PI;let z=180*Math.acos(I/E)/Math.PI;return z=b<0?90-z:90+z,{center:B.toLngLat(),zoom:O,pitch:z,bearing:F}}easeTo(a,d){var m;this._stop(!1,a.easeId),((a=l.e({offset:[0,0],duration:500,easing:l.b7},a)).animate===!1||!a.essential&&T.prefersReducedMotion)&&(a.duration=0);const _=this._getTransformForUpdate(),A=this.getZoom(),B=this.getBearing(),R=this.getPitch(),g=this.getPadding(),b="bearing"in a?this._normalizeBearing(a.bearing,B):B,E="pitch"in a?+a.pitch:R,I="padding"in a?a.padding:_.padding,O=l.P.convert(a.offset);let F=_.centerPoint.add(O);const z=_.pointLocation(F),{center:V,zoom:U}=_.getConstrained(l.M.convert(a.center||z),(m=a.zoom)!==null&&m!==void 0?m:A);this._normalizeCenter(V);const W=_.project(z),at=_.project(V).sub(W),tt=_.zoomScale(U-A);let ht,ut;a.around&&(ht=l.M.convert(a.around),ut=_.locationPoint(ht));const Tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||U!==A,this._rotating=this._rotating||B!==b,this._pitching=this._pitching||E!==R,this._padding=!_.isPaddingEqual(I),this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,Tt),this.terrain&&this._prepareElevation(V),this._ease(bt=>{if(this._zooming&&(_.zoom=l.z.number(A,U,bt)),this._rotating&&(_.bearing=l.z.number(B,b,bt)),this._pitching&&(_.pitch=l.z.number(R,E,bt)),this._padding&&(_.interpolatePadding(g,I,bt),F=_.centerPoint.add(O)),this.terrain&&!a.freezeElevation&&this._updateElevation(bt),ht)_.setLocationAtPoint(ht,ut);else{const pt=_.zoomScale(_.zoom-A),ft=U>A?Math.min(2,tt):Math.max(.5,tt),jt=Math.pow(ft,1-bt),Wt=_.unproject(W.add(at.mult(bt*jt)).mult(pt));_.setLocationAtPoint(_.renderWorldCopies?Wt.wrap():Wt,F)}this._applyUpdatedTransform(_),this._fireMoveEvents(d)},bt=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,bt)},a),this}_prepareEase(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||m.moving||this.fire(new l.k("movestart",a)),this._zooming&&!m.zooming&&this.fire(new l.k("zoomstart",a)),this._rotating&&!m.rotating&&this.fire(new l.k("rotatestart",a)),this._pitching&&!m.pitching&&this.fire(new l.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(m-(d-(m*a+this._elevationStart))/(1-a)),this._elevationTarget=d}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const d=a.clone(),{center:m,zoom:_,pitch:A,bearing:B,elevation:R}=this.transformCameraUpdate(d);m&&(d.center=m),_!==void 0&&(d.zoom=_),A!==void 0&&(d.pitch=A),B!==void 0&&(d.bearing=B),R!==void 0&&(d.elevation=R),this.transform.apply(d)}_fireMoveEvents(a){this.fire(new l.k("move",a)),this._zooming&&this.fire(new l.k("zoom",a)),this._rotating&&this.fire(new l.k("rotate",a)),this._pitching&&this.fire(new l.k("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,_=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.k("zoomend",a)),_&&this.fire(new l.k("rotateend",a)),A&&this.fire(new l.k("pitchend",a)),this.fire(new l.k("moveend",a))}flyTo(a,d){var m;if(!a.essential&&T.prefersReducedMotion){const we=l.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(we,d)}this.stop(),a=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},a);const _=this._getTransformForUpdate(),A=this.getZoom(),B=this.getBearing(),R=this.getPitch(),g=this.getPadding(),b="bearing"in a?this._normalizeBearing(a.bearing,B):B,E="pitch"in a?+a.pitch:R,I="padding"in a?a.padding:_.padding,O=l.P.convert(a.offset);let F=_.centerPoint.add(O);const z=_.pointLocation(F),{center:V,zoom:U}=_.getConstrained(l.M.convert(a.center||z),(m=a.zoom)!==null&&m!==void 0?m:A);this._normalizeCenter(V);const W=_.zoomScale(U-A),at=_.project(z),tt=_.project(V).sub(at);let ht=a.curve;const ut=Math.max(_.width,_.height),Tt=ut/W,bt=tt.mag();if("minZoom"in a){const we=l.ac(Math.min(a.minZoom,A,U),_.minZoom,_.maxZoom),je=ut/_.zoomScale(we-A);ht=Math.sqrt(je/bt*2)}const pt=ht*ht;function ft(we){const je=(Tt*Tt-ut*ut+(we?-1:1)*pt*pt*bt*bt)/(2*(we?Tt:ut)*pt*bt);return Math.log(Math.sqrt(je*je+1)-je)}function jt(we){return(Math.exp(we)-Math.exp(-we))/2}function Wt(we){return(Math.exp(we)+Math.exp(-we))/2}const se=ft(!1);let ne=function(we){return Wt(se)/Wt(se+ht*we)},fe=function(we){return ut*((Wt(se)*(jt(je=se+ht*we)/Wt(je))-jt(se))/pt)/bt;var je},Me=(ft(!0)-se)/ht;if(Math.abs(bt)<1e-6||!isFinite(Me)){if(Math.abs(ut-Tt)<1e-6)return this.easeTo(a,d);const we=Tt<ut?-1:1;Me=Math.abs(Math.log(Tt/ut))/ht,fe=function(){return 0},ne=function(je){return Math.exp(we*ht*je)}}return a.duration="duration"in a?+a.duration:1e3*Me/("screenSpeed"in a?+a.screenSpeed/ht:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=B!==b,this._pitching=E!==R,this._padding=!_.isPaddingEqual(I),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(V),this._ease(we=>{const je=we*Me,$e=1/ne(je);_.zoom=we===1?U:A+_.scaleZoom($e),this._rotating&&(_.bearing=l.z.number(B,b,we)),this._pitching&&(_.pitch=l.z.number(R,E,we)),this._padding&&(_.interpolatePadding(g,I,we),F=_.centerPoint.add(O)),this.terrain&&!a.freezeElevation&&this._updateElevation(we);const Ze=we===1?V:_.unproject(at.add(tt.mult(fe(je))).mult($e));_.setLocationAtPoint(_.renderWorldCopies?Ze.wrap():Ze,F),this._applyUpdatedTransform(_),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}if(!a){const m=this.handlers;m&&m.stop(!1)}return this}_ease(a,d,m){m.animate===!1||m.duration===0?(a(1),d()):(this._easeStart=T.now(),this._easeOptions=m,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,d){a=l.b1(a,-180,180);const m=Math.abs(a-d);return Math.abs(a-360-d)<m&&(a-=360),Math.abs(a+360-d)<m&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const m=a.lng-d.center.lng;a.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const Yh={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class uo{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yh;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const m=this._map._getUIString(`AttributionControl.${d}`);a.title=m,a.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const d=this._map.style.sourceCaches;for(const _ in d){const A=d[_];if(A.used||A.usedForTerrain){const B=A.getSource();B.attribution&&a.indexOf(B.attribution)<0&&a.push(B.attribution)}}a=a.filter(_=>String(_).trim()),a.sort((_,A)=>_.length-A.length),a=a.filter((_,A)=>{for(let B=A+1;B<a.length;B++)if(a[B].indexOf(_)>=0)return!1;return!0});const m=a.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,a.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qh{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const d=P.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Tc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const _ of m)if(_.id===a)return void(_.cancelled=!0)}run(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class os extends l.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,d){this.sourceCache.update(a,d),this._renderableTilesKeys=[];const m={};for(const _ of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))m[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.posMatrix=new Float64Array(16),l.aN(_.posMatrix,0,l.W,0,l.W,0,1),this._tiles[_.key]=new Ei(_,this.tileSize));for(const _ in this._tiles)m[_]||delete this._tiles[_]}freeRtt(a){for(const d in this._tiles){const m=this._tiles[d];(!a||m.tileID.equals(a)||m.tileID.isChildOf(a)||a.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const d={};for(const m of this._renderableTilesKeys){const _=this._tiles[m].tileID;if(_.canonical.equals(a.canonical)){const A=a.clone();A.posMatrix=new Float64Array(16),l.aN(A.posMatrix,0,l.W,0,l.W,0,1),d[m]=A}else if(_.canonical.isChildOf(a.canonical)){const A=a.clone();A.posMatrix=new Float64Array(16);const B=_.canonical.z-a.canonical.z,R=_.canonical.x-(_.canonical.x>>B<<B),g=_.canonical.y-(_.canonical.y>>B<<B),b=l.W>>B;l.aN(A.posMatrix,0,b,0,b,0,1),l.H(A.posMatrix,A.posMatrix,[-R*b,-g*b,0]),d[m]=A}else if(a.canonical.isChildOf(_.canonical)){const A=a.clone();A.posMatrix=new Float64Array(16);const B=a.canonical.z-_.canonical.z,R=a.canonical.x-(a.canonical.x>>B<<B),g=a.canonical.y-(a.canonical.y>>B<<B),b=l.W>>B;l.aN(A.posMatrix,0,l.W,0,l.W,0,1),l.H(A.posMatrix,A.posMatrix,[R*b,g*b,0]),l.J(A.posMatrix,A.posMatrix,[1/2**B,1/2**B,0]),d[m]=A}}return d}getSourceTile(a,d){const m=this.sourceCache._source;let _=a.overscaledZ-this.deltaZoom;if(_>m.maxzoom&&(_=m.maxzoom),_<m.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(_).key);let A=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!A||!A.dem)&&d)for(;_>=m.minzoom&&(!A||!A.dem);)A=this.sourceCache.getTileByID(a.scaledTo(_--).key);return A}tilesAfterTime(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=a)}}class Uu{constructor(a,d,m){this.painter=a,this.sourceCache=new os(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l.W;var A;if(!(d>=0&&d<_&&m>=0&&m<_))return 0;const B=this.getTerrainData(a),R=(A=B.tile)===null||A===void 0?void 0:A.dem;if(!R)return 0;const g=function(z,V,U){var W=V[0],at=V[1];return z[0]=U[0]*W+U[4]*at+U[12],z[1]=U[1]*W+U[5]*at+U[13],z}([],[d/_*l.W,m/_*l.W],B.u_terrain_matrix),b=[g[0]*R.dim,g[1]*R.dim],E=Math.floor(b[0]),I=Math.floor(b[1]),O=b[0]-E,F=b[1]-I;return R.get(E,I)*(1-O)*(1-F)+R.get(E+1,I)*O*(1-F)+R.get(E,I+1)*(1-O)*F+R.get(E+1,I+1)*O*F}getElevationForLngLatZoom(a,d){const{tileID:m,mercatorX:_,mercatorY:A}=this._getOverscaledTileIDFromLngLatZoom(a,d);return this.getElevation(m,_%l.W,A%l.W,l.W)}getElevation(a,d,m){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l.W;return this.getDEMElevation(a,d,m,_)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const _=this.painter.context,A=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ot(_,A,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ot(_,new l.R({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(a,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const _=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new ot(_,d.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),d.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+a.key;if(m&&!this._demMatrixCache[m]){const _=this.sourceCache.sourceCache._source.maxzoom;let A=a.canonical.z-d.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=_?A=a.canonical.z-_:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const B=a.canonical.x-(a.canonical.x>>A<<A),R=a.canonical.y-(a.canonical.y>>A<<A),g=l.b9(new Float64Array(16),[1/(l.W<<A),1/(l.W<<A),0]);l.H(g,g,[B*l.W,R*l.W,0]),this._demMatrixCache[a.key]={matrix:g,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(a){const d=this.painter,m=d.width/devicePixelRatio,_=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ot(d.context,{width:m,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ot(d.context,{width:m,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,_,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,_))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,B=0;A<this._coordsTextureSize;A++)for(let R=0;R<this._coordsTextureSize;R++,B+=4)d[B+0]=255&R,d[B+1]=255&A,d[B+2]=R>>8<<4|A>>8,d[B+3]=0;const m=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),_=new ot(a,m,a.gl.RGBA,{premultiply:!1});return _.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(a){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),m=this.painter.context,_=m.gl,A=Math.round(a.x*this.painter.pixelRatio/devicePixelRatio),B=Math.round(a.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(A,R-B-1,1,1,_.RGBA,_.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const g=d[0]+(d[2]>>4<<8),b=d[1]+((15&d[2])<<8),E=this.coordsIndex[255-d[3]],I=E&&this.sourceCache.getTileByID(E);if(!I)return null;const O=this._coordsTextureSize,F=(1<<I.tileID.canonical.z)*O;return new l.Y((I.tileID.canonical.x*O+g)/F+I.tileID.wrap,(I.tileID.canonical.y*O+b)/F,this.getElevation(I.tileID,g,b,O))}depthAtPoint(a){const d=new Uint8Array(4),m=this.painter.context,_=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),_.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,d=new l.ba,m=new l.aX,_=this.meshSize,A=l.W/_,B=_*_;for(let I=0;I<=_;I++)for(let O=0;O<=_;O++)d.emplaceBack(O*A,I*A,0);for(let I=0;I<B;I+=_+1)for(let O=0;O<_;O++)m.emplaceBack(O+I,_+O+I+1,_+O+I+2),m.emplaceBack(O+I,_+O+I+2,O+I+1);const R=d.length,g=R+2*(_+1);for(const I of[0,1])for(let O=0;O<=_;O++)for(const F of[0,1])d.emplaceBack(O*A,I*l.W,F);for(let I=0;I<2*_;I+=2)m.emplaceBack(g+I,g+I+1,g+I+3),m.emplaceBack(g+I,g+I+3,g+I+2),m.emplaceBack(R+I,R+I+3,R+I+1),m.emplaceBack(R+I,R+I+2,R+I+3);const b=d.length,E=b+2*(_+1);for(const I of[0,1])for(let O=0;O<=_;O++)for(const F of[0,1])d.emplaceBack(I*l.W,O*A,F);for(let I=0;I<2*_;I+=2)m.emplaceBack(b+I,b+I+1,b+I+3),m.emplaceBack(b+I,b+I+3,b+I+2),m.emplaceBack(E+I,E+I+3,E+I+1),m.emplaceBack(E+I,E+I+2,E+I+3);return this._mesh={indexBuffer:a.createIndexBuffer(m),vertexBuffer:a.createVertexBuffer(d,Xr.members),segments:l.$.simpleSegment(0,0,d.length,m.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*l.bb/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,d){var m;const{tileID:_}=this._getOverscaledTileIDFromLngLatZoom(a,d);return(m=this.getMinMaxElevation(_).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(a){const d=this.getTerrainData(a).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(a,d){const m=l.Y.fromLngLat(a.wrap()),_=(1<<d)*l.W,A=m.x*_,B=m.y*_,R=Math.floor(A/l.W),g=Math.floor(B/l.W);return{tileID:new l.Q(d,0,d,R,g),mercatorX:A,mercatorY:B}}}class Nn{constructor(a,d,m){this._context=a,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new ot(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:a,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>a.id!==d),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const vs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class po{constructor(a,d){this.painter=a,this.terrain=d,this.pool=new Nn(a.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(m=>!a._layers[m].isHidden(d)),this._coordsDescendingInv={};for(const m in a.sourceCaches){this._coordsDescendingInv[m]={};const _=a.sourceCaches[m].getVisibleCoordinates();for(const A of _){const B=this.terrain.sourceCache.getTerrainCoords(A);for(const R in B)this._coordsDescendingInv[m][R]||(this._coordsDescendingInv[m][R]=[]),this._coordsDescendingInv[m][R].push(B[R])}}this._coordsDescendingInvStr={};for(const m of a._order){const _=a._layers[m],A=_.source;if(vs[_.type]&&!this._coordsDescendingInvStr[A]){this._coordsDescendingInvStr[A]={};for(const B in this._coordsDescendingInv[A])this._coordsDescendingInvStr[A][B]=this._coordsDescendingInv[A][B].map(R=>R.key).sort().join()}}for(const m of this._renderableTiles)for(const _ in this._coordsDescendingInvStr){const A=this._coordsDescendingInvStr[_][m.tileID.key];A&&A!==m.rttCoords[_]&&(m.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const d=a.type,m=this.painter,_=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(vs[d]&&(this._prevType&&vs[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(a.id),!_))return!0;if(vs[this._prevType]||vs[d]&&_){this._prevType=d;const A=this._stacks.length-1,B=this._stacks[A]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(Vl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[A]){const b=this.pool.getObjectForId(R.rtt[A].id);if(b.stamp===R.rtt[A].stamp){this.pool.useObject(b);continue}}const g=this.pool.getOrCreateFreeObject();this.pool.useObject(g),this.pool.stampObject(g),R.rtt[A]={id:g.id,stamp:g.stamp},m.context.bindFramebuffer.set(g.fbo.framebuffer),m.context.clear({color:l.aO.transparent,stencil:0}),m.currentStencilSource=void 0;for(let b=0;b<B.length;b++){const E=m.style._layers[B[b]],I=E.source?this._coordsDescendingInv[E.source][R.tileID.key]:[R.tileID];m.context.viewport.set([0,0,g.fbo.width,g.fbo.height]),m._renderTileClippingMasks(E,I),m.renderLayer(m,m.style.sourceCaches[E.source],E,I),E.source&&(R.rttCoords[E.source]=this._coordsDescendingInvStr[E.source][R.tileID.key])}}return Vl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),vs[d]}return!1}}const tu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},lh=f,Fn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Yh,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Qs=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},eu={showCompass:!0,showZoom:!0,visualizePitch:!1};class iu{constructor(a,d){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=B=>{this.startMouse(l.e({},B,{ctrlKey:!0,preventDefault:()=>B.preventDefault()}),P.mousePos(this.element,B)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=B=>{this.moveMouse(B,P.mousePos(this.element,B))},this.mouseup=B=>{this.mouseRotate.dragEnd(B),this.mousePitch&&this.mousePitch.dragEnd(B),this.offTemp()},this.touchstart=B=>{B.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.startTouch(B,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=B=>{B.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.moveTouch(B,this._lastPos))},this.touchend=B=>{B.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const _=a.dragRotate._mouseRotate.getClickTolerance(),A=a.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=il({clickTolerance:_,enable:!0}),this.touchRotate=(B=>{let{enable:R,clickTolerance:g,bearingDegreesPerPixelMoved:b=.8}=B;const E=new We;return new $o({clickTolerance:g,move:(I,O)=>({bearingDelta:(O.x-I.x)*b}),moveStateManager:E,enable:R,assignEvents:Qs})})({clickTolerance:_,enable:!0}),this.map=a,m&&(this.mousePitch=rl({clickTolerance:A,enable:!0}),this.touchPitch=(B=>{let{enable:R,clickTolerance:g,pitchDegreesPerPixelMoved:b=-.5}=B;const E=new We;return new $o({clickTolerance:g,move:(I,O)=>({pitchDelta:(O.y-I.y)*b}),moveStateManager:E,enable:R,assignEvents:Qs})})({clickTolerance:A,enable:!0})),P.addEventListener(d,"mousedown",this.mousedown),P.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(d,"touchcancel",this.reset)}startMouse(a,d){this.mouseRotate.dragStart(a,d),this.mousePitch&&this.mousePitch.dragStart(a,d),P.disableDrag()}startTouch(a,d){this.touchRotate.dragStart(a,d),this.touchPitch&&this.touchPitch.dragStart(a,d),P.disableDrag()}moveMouse(a,d){const m=this.map,{bearingDelta:_}=this.mouseRotate.dragMove(a,d)||{};if(_&&m.setBearing(m.getBearing()+_),this.mousePitch){const{pitchDelta:A}=this.mousePitch.dragMove(a,d)||{};A&&m.setPitch(m.getPitch()+A)}}moveTouch(a,d){const m=this.map,{bearingDelta:_}=this.touchRotate.dragMove(a,d)||{};if(_&&m.setBearing(m.getBearing()+_),this.touchPitch){const{pitchDelta:A}=this.touchPitch.dragMove(a,d)||{};A&&m.setPitch(m.getPitch()+A)}}off(){const a=this.element;P.removeEventListener(a,"mousedown",this.mousedown),P.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let Ro;function Pc(w,a,d){const m=new l.M(w.lng,w.lat);if(w=new l.M(w.lng,w.lat),a){const _=new l.M(w.lng-360,w.lat),A=new l.M(w.lng+360,w.lat),B=d.locationPoint(w).distSqr(a);d.locationPoint(_).distSqr(a)<B?w=_:d.locationPoint(A).distSqr(a)<B&&(w=A)}for(;Math.abs(w.lng-d.center.lng)>180;){const _=d.locationPoint(w);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;w.lng>d.center.lng?w.lng-=360:w.lng+=360}return w.lng!==m.lng&&d.locationPoint(w).y>d.height/2-d.getHorizon()?w:m}const Wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ic(w,a,d){const m=w.classList;for(const _ in Wl)m.remove(`maplibregl-${d}-anchor-${_}`);m.add(`maplibregl-${d}-anchor-${a}`)}class Mc extends l.E{constructor(a){if(super(),this._onKeyPress=d=>{const m=d.code,_=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&_!==32&&_!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,_=this._element;this._popup&&(m===_||_.contains(m))&&this.togglePopup()},this._update=d=>{var m;if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Pc(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let B="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?B="rotateX(0deg)":this._pitchAlignment==="map"&&(B=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${Wl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${B} ${A}`),T.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=l.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const d=P.createNS("http://www.w3.org/2000/svg","svg"),m=41,_=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${_}px`),d.setAttributeNS(null,"viewBox",`0 0 ${_} ${m}`);const A=P.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const B=P.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");const R=P.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const g=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const W of g){const at=P.createNS("http://www.w3.org/2000/svg","ellipse");at.setAttributeNS(null,"opacity","0.04"),at.setAttributeNS(null,"cx","10.5"),at.setAttributeNS(null,"cy","5.80029008"),at.setAttributeNS(null,"rx",W.rx),at.setAttributeNS(null,"ry",W.ry),R.appendChild(at)}const b=P.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill",this._color);const E=P.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),b.appendChild(E);const I=P.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"fill","#000000");const O=P.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),I.appendChild(O);const F=P.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const z=P.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const V=P.createNS("http://www.w3.org/2000/svg","circle");V.setAttributeNS(null,"fill","#000000"),V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"cx","5.5"),V.setAttributeNS(null,"cy","5.5"),V.setAttributeNS(null,"r","5.4999962");const U=P.createNS("http://www.w3.org/2000/svg","circle");U.setAttributeNS(null,"fill","#FFFFFF"),U.setAttributeNS(null,"cx","5.5"),U.setAttributeNS(null,"cy","5.5"),U.setAttributeNS(null,"r","5.4999962"),z.appendChild(V),z.appendChild(U),B.appendChild(R),B.appendChild(b),B.appendChild(I),B.appendChild(F),B.appendChild(z),d.appendChild(B),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Ic(this._element,this._anchor,"marker"),a&&a.className)for(const d of a.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=l.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const d=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d,m;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const _=this._map,A=_.terrain.depthAtPoint(this._pos),B=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,B)-A<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/_.transform._pixelPerMeter,g=Math.sin(_.getPitch()*Math.PI/180)*R,b=_.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),E=_.transform.lngLatToCameraDepth(this._lngLat,B+g)-b>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&E&&this._popup.remove(),this._element.style.opacity=E?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=l.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,d){return a===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const cl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Yo=0,fo=!1;const Jl={maxWidth:100,unit:"metric"};function Lc(w,a,d){const m=d&&d.maxWidth||100,_=w._container.clientHeight/2,A=w.unproject([0,_]),B=w.unproject([m,_]),R=A.distanceTo(B);if(d&&d.unit==="imperial"){const g=3.2808*R;g>5280?hl(a,m,g/5280,w._getUIString("ScaleControl.Miles")):hl(a,m,g,w._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?hl(a,m,R/1852,w._getUIString("ScaleControl.NauticalMiles")):R>=1e3?hl(a,m,R/1e3,w._getUIString("ScaleControl.Kilometers")):hl(a,m,R,w._getUIString("ScaleControl.Meters"))}function hl(w,a,d,m){const _=function(A){const B=Math.pow(10,`${Math.floor(A)}`.length-1);let R=A/B;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(g){const b=Math.pow(10,Math.ceil(-Math.log(g)/Math.LN10));return Math.round(g*b)/b}(R),B*R}(d);w.style.width=a*(_/d)+"px",w.innerHTML=`${_}&nbsp;${m}`}const ch={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ru=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hh(w){if(w){if(typeof w=="number"){const a=Math.round(Math.abs(w)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,w),"top-left":new l.P(a,a),"top-right":new l.P(-a,a),bottom:new l.P(0,-w),"bottom-left":new l.P(a,-a),"bottom-right":new l.P(-a,-a),left:new l.P(w,0),right:new l.P(-w,0)}}if(w instanceof l.P||Array.isArray(w)){const a=l.P.convert(w);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:l.P.convert(w.center||[0,0]),top:l.P.convert(w.top||[0,0]),"top-left":l.P.convert(w["top-left"]||[0,0]),"top-right":l.P.convert(w["top-right"]||[0,0]),bottom:l.P.convert(w.bottom||[0,0]),"bottom-left":l.P.convert(w["bottom-left"]||[0,0]),"bottom-right":l.P.convert(w["bottom-right"]||[0,0]),left:l.P.convert(w.left||[0,0]),right:l.P.convert(w.right||[0,0])}}return hh(new l.P(0,0))}const Gu=f;c.AJAXError=l.be,c.Evented=l.E,c.LngLat=l.M,c.MercatorCoordinate=l.Y,c.Point=l.P,c.addProtocol=l.bf,c.config=l.a,c.removeProtocol=l.bg,c.AttributionControl=uo,c.BoxZoomHandler=gr,c.CanvasSource=ai,c.CooperativeGesturesHandler=ni,c.DoubleClickZoomHandler=Sc,c.DragPanHandler=Kh,c.DragRotateHandler=ho,c.EdgeInsets=An,c.FullscreenControl=class extends l.E{constructor(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var a;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=d==null?void 0:d.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Pe,c.GeolocateControl=class extends l.E{constructor(w){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const d=new l.M(a.coords.longitude,a.coords.latitude),m=a.coords.accuracy,_=this._map.getBearing(),A=l.e({bearing:_},this.options.fitBoundsOptions),B=Xe.fromLngLat(d,m);this._map.fitBounds(B,A,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const d=new l.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&fo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Mc({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},cl,w)}onAdd(w){return this._map=w,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Ro!==void 0&&!a)return Ro;if(window.navigator.permissions===void 0)return Ro=!!window.navigator.geolocation,Ro;try{Ro=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ro=!!window.navigator.geolocation}return Ro}()})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Yo=0,fo=!1}_isOutOfMapMaxBounds(w){const a=this._map.getMaxBounds(),d=w.coords;return a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),a=w.getSouthEast(),d=w.getNorthEast(),m=a.distanceTo(d),_=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yo--,fo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Yo++,Yo>1?(w={maximumAge:6e5,timeout:0},fo=!0):(w=this.options.positionOptions,fo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=Sn,c.ImageSource=Ee,c.KeyboardHandler=Ko,c.LngLatBounds=Xe,c.LogoControl=Qh,c.Map=class extends Cs{constructor(w){if(l.bc.mark(l.bd.create),(w=l.e({},Fn,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new On(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new Tc,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},tu,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=ct.addThrottleControl(()=>this.isMoving()),this._requestManager=new yt(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const d=Ca(m=>{this._trackResize&&!this._removed&&this.resize(m)._update()},50);this._resizeObserver=new ResizeObserver(m=>{a?d(m):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Cc(this,w),this._hash=w.hash&&new Sn(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,l.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new uo(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Qh,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new l.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new l.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new l.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(w,a){if(a===void 0&&(a=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=w.onAdd(this);this._controls.push(w);const m=this._controlPositions[a];return a.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(w);return a>-1&&this._controls.splice(a,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,a,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,a,d,m)}resize(w){var a;const d=this._containerDimensions(),m=d[0],_=d[1],A=this._getClampedPixelRatio(m,_);if(this._resizeCanvas(m,_,A),this.painter.resize(m,_,A),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const g=this._getClampedPixelRatio(m,_);this._resizeCanvas(m,_,g),this.painter.resize(m,_,g)}this.transform.resize(m,_),(a=this._requestedCameraState)===null||a===void 0||a.resize(m,_);const B=!this._moving;return B&&(this.stop(),this.fire(new l.k("movestart",w)).fire(new l.k("move",w))),this.fire(new l.k("resize",w)),B&&this.fire(new l.k("moveend",w)),this}_getClampedPixelRatio(w,a){const{0:d,1:m}=this._maxCanvasSize,_=this.getPixelRatio(),A=w*_,B=a*_;return Math.min(A>d?d/A:1,B>m?m/B:1)*_}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Xe.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(l.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(l.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,a,d){if(w==="mouseenter"||w==="mouseover"){let m=!1;return{layer:a,listener:d,delegates:{mousemove:_=>{const A=this.getLayer(a)?this.queryRenderedFeatures(_.point,{layers:[a]}):[];A.length?m||(m=!0,d.call(this,new ns(w,this,_.originalEvent,{features:A}))):m=!1},mouseout:()=>{m=!1}}}}if(w==="mouseleave"||w==="mouseout"){let m=!1;return{layer:a,listener:d,delegates:{mousemove:_=>{(this.getLayer(a)?this.queryRenderedFeatures(_.point,{layers:[a]}):[]).length?m=!0:m&&(m=!1,d.call(this,new ns(w,this,_.originalEvent)))},mouseout:_=>{m&&(m=!1,d.call(this,new ns(w,this,_.originalEvent)))}}}}{const m=_=>{const A=this.getLayer(a)?this.queryRenderedFeatures(_.point,{layers:[a]}):[];A.length&&(_.features=A,d.call(this,_),delete _.features)};return{layer:a,listener:d,delegates:{[w]:m}}}}on(w,a,d){if(d===void 0)return super.on(w,a);const m=this._createDelegatedListener(w,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(m);for(const _ in m.delegates)this.on(_,m.delegates[_]);return this}once(w,a,d){if(d===void 0)return super.once(w,a);const m=this._createDelegatedListener(w,a,d);for(const _ in m.delegates)this.once(_,m.delegates[_]);return this}off(w,a,d){return d===void 0?super.off(w,a):(this._delegatedListeners&&this._delegatedListeners[w]&&(m=>{const _=this._delegatedListeners[w];for(let A=0;A<_.length;A++){const B=_[A];if(B.layer===a&&B.listener===d){for(const R in B.delegates)this.off(R,B.delegates[R]);return _.splice(A,1),this}}})(),this)}queryRenderedFeatures(w,a){if(!this.style)return[];let d;const m=w instanceof l.P||Array.isArray(w),_=m?w:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(m?{}:w)||{},_ instanceof l.P||typeof _[0]=="number")d=[l.P.convert(_)];else{const A=l.P.convert(_[0]),B=l.P.convert(_[1]);d=[A,new l.P(B.x,A.y),B,new l.P(A.x,B.y),A]}return this.style.queryRenderedFeatures(d,a,this.transform)}querySourceFeatures(w,a){return this.style.querySourceFeatures(w,a)}setStyle(w,a){return(a=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(w,a))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const a=this._locale[w];if(a==null)throw new Error(`Missing UI string '${w}'`);return a}_updateStyle(w,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,a));const d=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new ds(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,a,d):this.style.loadJSON(w,a,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,a){if(typeof w=="string"){const d=this._requestManager.transformRequest(w,"Style");l.h(d,new AbortController).then(m=>{this._updateDiff(m.data,a)}).catch(m=>{m&&this.fire(new l.j(m))})}else typeof w=="object"&&this._updateDiff(w,a)}_updateDiff(w,a){try{this.style.setState(w,a)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(w,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(w,a){return this._lazyInitEmptyStyle(),this.style.addSource(w,a),this._update(!0)}isSourceLoaded(w){const a=this.style&&this.style.sourceCaches[w];if(a!==void 0)return a.loaded();this.fire(new l.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const a=this.style.sourceCaches[w.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&a.reload();for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===w.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Uu(this.painter,a,w),this.painter.renderToTexture=new po(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:w})),this}getTerrain(){var w,a;return(a=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const a in w){const d=w[a]._tiles;for(const m in d){const _=d[m];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:m=1,sdf:_=!1,stretchX:A,stretchY:B,content:R}=d;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||l.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:g,height:b,data:E}=a,I=a;return this.style.addImage(w,{data:new l.R({width:g,height:b},new Uint8Array(E)),pixelRatio:m,stretchX:A,stretchY:B,content:R,sdf:_,version:0,userImage:I}),I.onAdd&&I.onAdd(this,w),this}}{const{width:g,height:b,data:E}=T.getImageData(a);this.style.addImage(w,{data:new l.R({width:g,height:b},E),pixelRatio:m,stretchX:A,stretchY:B,content:R,sdf:_,version:0})}}updateImage(w,a){const d=this.style.getImage(w);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=a instanceof HTMLImageElement||l.b(a)?T.getImageData(a):a,{width:_,height:A,data:B}=m;if(_===void 0||A===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==d.data.width||A!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(a instanceof HTMLImageElement||l.b(a));return d.data.replace(B,R),this.style.updateImage(w,d),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return ct.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,a){return this._lazyInitEmptyStyle(),this.style.addLayer(w,a),this._update(!0)}moveLayer(w,a){return this.style.moveLayer(w,a),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,a,d){return this.style.setLayerZoomRange(w,a,d),this._update(!0)}setFilter(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(w,a,d),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,a,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(w,a,d,m),this._update(!0)}getPaintProperty(w,a){return this.style.getPaintProperty(w,a)}setLayoutProperty(w,a,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(w,a,d,m),this._update(!0)}getLayoutProperty(w,a){return this.style.getLayoutProperty(w,a)}setGlyphs(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(w,a,d,m=>{m||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(w,a,d=>{d||this._update(!0)}),this}setLight(w){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(w,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,a){return this.style.setFeatureState(w,a),this._update()}removeFeatureState(w,a){return this.style.removeFeatureState(w,a),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,a=0;return this._container&&(w=this._container.clientWidth||400,a=this._container.clientHeight||300),[w,a]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const a=this._canvasContainer=P.create("div","maplibregl-canvas-container",w);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const _=this._controlContainer=P.create("div","maplibregl-control-container",w),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(B=>{A[B]=P.create("div",`maplibregl-ctrl-${B} `,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,a,d){this._canvas.width=Math.floor(d*w),this._canvas.height=Math.floor(d*a),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{a={requestedAttributes:w},m&&(a.statusMessage=m.statusMessage,a.type=m.type)},{once:!0});const d=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!d){const m="Failed to initialize WebGL";throw a?(a.message=m,new Error(JSON.stringify(a))):new Error(m)}this.painter=new Jo(d,this.transform),M.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const _=this.transform.zoom,A=T.now();this.style.zoomHistory.update(_,A);const B=new l.a8(_,{now:A,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=B.crossFadingFactor();R===1&&R===this._crossFadingFactor||(d=!0,this._crossFadingFactor=R),this.style.update(B)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ct.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(w=>{l.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return lh}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=ns,c.MapTouchEvent=cn,c.MapWheelEvent=hn,c.Marker=Mc,c.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const a=this._map.getZoom(),d=a===this._map.getMaxZoom(),m=a===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);a.title=m,a.setAttribute("aria-label",m)},this.options=l.e({},eu,w),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new iu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,a){const d=P.create("button",w,this._container);return d.type="button",d.addEventListener("click",a),d}},c.Popup=class extends l.E{constructor(w){super(),this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Pc(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!a)return;const m=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let _=this.options.anchor;const A=hh(this.options.offset);if(!_){const R=this._container.offsetWidth,g=this._container.offsetHeight;let b;b=m.y+A.bottom.y<g?["top"]:m.y>this._map.transform.height-g?["bottom"]:[],m.x<R/2?b.push("left"):m.x>this._map.transform.width-R/2&&b.push("right"),_=b.length===0?"bottom":b.join("-")}let B=m.add(A[_]);this.options.subpixelPositioning||(B=B.round()),P.setTransform(this._container,`${Wl[_]} translate(${B.x}px,${B.y}px)`),Ic(this._container,_,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(ch),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=l.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const a=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=w;m=d.firstChild,m;)a.appendChild(m);return this.setDOMContent(a)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(ru);w&&w.focus()}},c.RasterDEMTileSource=ii,c.RasterTileSource=Zt,c.ScaleControl=class{constructor(w){this._onMove=()=>{Lc(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,Lc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Jl),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=al,c.Style=ds,c.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=Ac,c.TwoFingersTouchRotateHandler=oh,c.TwoFingersTouchZoomHandler=xc,c.TwoFingersTouchZoomRotateHandler=Ec,c.VectorTileSource=Pt,c.VideoSource=Ve,c.addSourceType=(w,a)=>l._(void 0,void 0,void 0,function*(){if(Ti(w))throw new Error(`A source type called "${w}" already exists.`);((d,m)=>{Ai[d]=m})(w,a)}),c.clearPrewarmedResources=function(){const w=Ut;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(it),Ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return ce().getRTLTextPluginStatus()},c.getVersion=function(){return Gu},c.getWorkerCount=function(){return Et.workerCount},c.getWorkerUrl=function(){return l.a.WORKER_URL},c.importScriptInWorkers=function(w){return Qt().broadcast("IS",w)},c.prewarm=function(){Kt().acquire(it)},c.setMaxParallelImageRequests=function(w){l.a.MAX_PARALLEL_IMAGE_REQUESTS=w},c.setRTLTextPlugin=function(w,a){return ce().setRTLTextPlugin(w,a)},c.setWorkerCount=function(w){Et.workerCount=w},c.setWorkerUrl=function(w){l.a.WORKER_URL=w}});var n=e;return n})})(dA);var fA=dA.exports;const gn=wm(fA);var vn;(function(i){i[i.Unknown=0]="Unknown",i[i.Point=1]="Point",i[i.LineString=2]="LineString",i[i.Polygon=3]="Polygon",i[i.MultiPoint=4]="MultiPoint",i[i.MultiLineString=5]="MultiLineString",i[i.MultiPolygon=6]="MultiPolygon",i[i.GeometryCollection=7]="GeometryCollection",i[i.CircularString=8]="CircularString",i[i.CompoundCurve=9]="CompoundCurve",i[i.CurvePolygon=10]="CurvePolygon",i[i.MultiCurve=11]="MultiCurve",i[i.MultiSurface=12]="MultiSurface",i[i.Curve=13]="Curve",i[i.Surface=14]="Surface",i[i.PolyhedralSurface=15]="PolyhedralSurface",i[i.TIN=16]="TIN",i[i.Triangle=17]="Triangle"})(vn||(vn={}));const _p=4,vp=4,hf=4,Dh=new Int32Array(2),Qb=new Float32Array(Dh.buffer),t2=new Float64Array(Dh.buffer),$f=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Zy;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(Zy||(Zy={}));class Kc{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Kc(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Dh[0]=this.readInt32(t),Qb[0]}readFloat64(t){return Dh[$f?0:1]=this.readInt32(t),Dh[$f?1:0]=this.readInt32(t+4),t2[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Qb[0]=e,this.writeInt32(t,Dh[0])}writeFloat64(t,e){t2[0]=e,this.writeInt32(t,Dh[$f?0:1]),this.writeInt32(t+4,Dh[$f?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+_p+vp)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<vp;e++)t+=String.fromCharCode(this.readInt8(this.position_+_p+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);t+=_p;const s=this.bytes_.subarray(t,t+r);return e===Zy.UTF8_BYTES?s:this.text_decoder_.decode(s)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+_p}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=vp)throw new Error("FlatBuffers: file identifier must be length "+vp);for(let e=0;e<vp;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+_p+e))return!1;return!0}createScalarList(t,e){const r=[];for(let s=0;s<e;++s){const n=t(s);n!==null&&r.push(n)}return r}createObjList(t,e){const r=[];for(let s=0;s<e;++s){const n=t(s);n!==null&&r.push(n.unpack())}return r}}let VT=class No{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new No).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+hf),(e||new No).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):vn.Unknown}parts(t,e){const r=this.bb.__offset(this.bb_pos,18);return r?(e||new No).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,vn.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,r,s,n,c,l,f,y){return No.startGeometry(t),No.addEnds(t,e),No.addXy(t,r),No.addZ(t,s),No.addM(t,n),No.addT(t,c),No.addTm(t,l),No.addType(t,f),No.addParts(t,y),No.endGeometry(t)}};function Xy(i,t){const e=[];for(let r=0;r<i.length;r+=2){const s=[i[r],i[r+1]];t&&s.push(t[r>>1]),e.push(s)}return e}function e2(i,t,e){if(!e||e.length===0)return[Xy(i,t)];let r=0;const s=Array.from(e).map(c=>i.slice(r,r=c<<1));let n;return t&&(r=0,n=Array.from(e).map(c=>t.slice(r,r=c))),s.map((c,l)=>Xy(c,n?n[l]:void 0))}function qT(i,t){const e=i.xyArray(),r=i.zArray();switch(t){case vn.Point:{const s=Array.from(e);return r&&s.push(r[0]),s}case vn.MultiPoint:case vn.LineString:return Xy(e,r);case vn.MultiLineString:return e2(e,r,i.endsArray());case vn.Polygon:return e2(e,r,i.endsArray())}}function $y(i,t){let e=t;if(e===vn.Unknown&&(e=i.type()),e===vn.GeometryCollection){const s=[];for(let n=0;n<i.partsLength();n++){const c=i.parts(n),l=c.type();s.push($y(c,l))}return{type:vn[e],geometries:s}}else if(e===vn.MultiPolygon){const s=[];for(let n=0;n<i.partsLength();n++)s.push($y(i.parts(n),vn.Polygon));return{type:vn[e],coordinates:s.map(n=>n.coordinates)}}const r=qT(i,e);return{type:vn[e],coordinates:r}}var yn;(function(i){i[i.Byte=0]="Byte",i[i.UByte=1]="UByte",i[i.Bool=2]="Bool",i[i.Short=3]="Short",i[i.UShort=4]="UShort",i[i.Int=5]="Int",i[i.UInt=6]="UInt",i[i.Long=7]="Long",i[i.ULong=8]="ULong",i[i.Float=9]="Float",i[i.Double=10]="Double",i[i.String=11]="String",i[i.Json=12]="Json",i[i.DateTime=13]="DateTime",i[i.Binary=14]="Binary"})(yn||(yn={}));class mn{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new mn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+hf),(e||new mn).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):yn.Byte}title(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,yn.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){const e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,r,s,n,c,l,f,y,x,T,P){return mn.startColumn(t),mn.addName(t,e),mn.addType(t,r),mn.addTitle(t,s),mn.addDescription(t,n),mn.addWidth(t,c),mn.addPrecision(t,l),mn.addScale(t,f),mn.addNullable(t,y),mn.addUnique(t,x),mn.addPrimaryKey(t,T),mn.addMetadata(t,P),mn.endColumn(t)}}class Al{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new Al).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+hf),(e||new Al).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new VT).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new mn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,r,s){return Al.startFeature(t),Al.addGeometry(t,e),Al.addProperties(t,r),Al.addColumns(t,s),Al.endFeature(t)}}new TextEncoder;const i2=new TextDecoder;function HT(i,t){const e={};if(!t||t.length===0)return e;const r=i.propertiesArray();if(!r)return e;const s=new DataView(r.buffer,r.byteOffset),n=i.propertiesLength();let c=0;for(;c<n;){const l=s.getUint16(c,!0);c+=2;const f=t[l],y=f.name;switch(f.type){case yn.Bool:{e[y]=!!s.getUint8(c),c+=1;break}case yn.Byte:{e[y]=s.getInt8(c),c+=1;break}case yn.UByte:{e[y]=s.getUint8(c),c+=1;break}case yn.Short:{e[y]=s.getInt16(c,!0),c+=2;break}case yn.UShort:{e[y]=s.getUint16(c,!0),c+=2;break}case yn.Int:{e[y]=s.getInt32(c,!0),c+=4;break}case yn.UInt:{e[y]=s.getUint32(c,!0),c+=4;break}case yn.Long:{e[y]=Number(s.getBigInt64(c,!0)),c+=8;break}case yn.ULong:{e[y]=Number(s.getBigUint64(c,!0)),c+=8;break}case yn.Float:{e[y]=s.getFloat32(c,!0),c+=4;break}case yn.Double:{e[y]=s.getFloat64(c,!0),c+=8;break}case yn.DateTime:case yn.String:{const x=s.getUint32(c,!0);c+=4,e[y]=i2.decode(r.subarray(c,c+x)),c+=x;break}case yn.Json:{const x=s.getUint32(c,!0);c+=4;const T=i2.decode(r.subarray(c,c+x));e[y]=JSON.parse(T),c+=x;break}default:throw new Error("Unknown type "+f.type)}}return e}function n1(i,t){const e=t.columns;return{type:"Feature",geometry:$y(i.geometry(),t.geometryType),properties:HT(i,e)}}const o1=new Uint8Array(0);function WT(){return this._source.cancel()}function JT(i,t){if(!i.length)return t;if(!t.length)return i;var e=new Uint8Array(i.length+t.length);return e.set(i),e.set(t,i.length),e}function ZT(){var i=this,t=i._array.subarray(i._index);return i._source.read().then(function(e){return i._array=o1,i._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:JT(t,e.value)}})}function XT(i){if((i|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+i<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=i));var r=new Uint8Array(i);return r.set(this._array.subarray(this._index)),function s(){return t._source.read().then(function(n){return n.done?(t._array=o1,t._index=0,e>0?r.subarray(0,e):null):e+n.value.length>=i?(t._array=n.value,t._index=i-e,r.set(n.value.subarray(0,i-e),e),r):(r.set(n.value,e),e+=n.value.length,s())})}()}function $T(i){return typeof i.slice=="function"?i:new xm(typeof i.read=="function"?i:i.getReader())}function xm(i){this._source=i,this._array=o1,this._index=0}xm.prototype.read=ZT;xm.prototype.slice=XT;xm.prototype.cancel=WT;class ka{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+hf),(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}org(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,r,s,n,c,l){return ka.startCrs(t),ka.addOrg(t,e),ka.addCode(t,r),ka.addName(t,s),ka.addDescription(t,n),ka.addWkt(t,c),ka.addCodeString(t,l),ka.endCrs(t)}}class Xg{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new Xg).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+hf),(e||new Xg).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):vn.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,e){const r=this.bb.__offset(this.bb_pos,18);return r?(e||new mn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const e=this.bb.__offset(this.bb_pos,24);return e?(t||new ka).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){const e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,vn.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function a1(i){const t=Xg.getRootAsHeader(i),e=t.featuresCount(),r=t.indexNodeSize(),s=[];for(let l=0;l<t.columnsLength();l++){const f=t.columns(l);if(!f)throw new Error("Column unexpectedly missing");if(!f.name())throw new Error("Column name unexpectedly missing");s.push({name:f.name(),type:f.type(),title:f.title(),description:f.description(),width:f.width(),precision:f.precision(),scale:f.scale(),nullable:f.nullable(),unique:f.unique(),primary_key:f.primaryKey()})}const n=t.crs(),c=n?{org:n.org(),code:n.code(),name:n.name(),description:n.description(),wkt:n.wkt(),code_string:n.codeString()}:null;return{geometryType:t.geometryType(),columns:s,envelope:null,featuresCount:Number(e),indexNodeSize:r,crs:c,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ky=function(i,t){return Ky=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])},Ky(i,t)};function KT(i,t){Ky(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Od(i,t,e,r){function s(n){return n instanceof e?n:new e(function(c){c(n)})}return new(e||(e=Promise))(function(n,c){function l(x){try{y(r.next(x))}catch(T){c(T)}}function f(x){try{y(r.throw(x))}catch(T){c(T)}}function y(x){x.done?n(x.value):s(x.value).then(l,f)}y((r=r.apply(i,t||[])).next())})}function Gh(i,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(y){return function(x){return f([y,x])}}function f(y){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,s&&(n=y[0]&2?s.return:y[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,y[1])).done)return n;switch(s=0,n&&(y=[y[0]&2,n.value]),y[0]){case 0:case 1:n=y;break;case 4:return e.label++,{value:y[1],done:!1};case 5:e.label++,s=y[1],y=[0];continue;case 7:y=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(y[0]===6||y[0]===2)){e=0;continue}if(y[0]===3&&(!n||y[1]>n[0]&&y[1]<n[3])){e.label=y[1];break}if(y[0]===6&&e.label<n[1]){e.label=n[1],n=y;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(y);break}n[2]&&e.ops.pop(),e.trys.pop();continue}y=t.call(i,e)}catch(x){y=[6,x],s=0}finally{r=n=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function Jd(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xp(i){return this instanceof Xp?(this.v=i,this):new Xp(i)}function YT(i,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(i,t||[]),s,n=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(P){r[P]&&(s[P]=function(M){return new Promise(function(N,G){n.push([P,M,N,G])>1||l(P,M)})})}function l(P,M){try{f(r[P](M))}catch(N){T(n[0][3],N)}}function f(P){P.value instanceof Xp?Promise.resolve(P.value.v).then(y,x):T(n[0][2],P)}function y(P){l("next",P)}function x(P){l("throw",P)}function T(P,M){P(M),n.shift(),n.length&&l(n[0][0],n[0][1])}}var gA=function(i){KT(t,i);function t(e){var r=i.call(this,e)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return t}(Error);(function(){function i(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),i.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();(function(){function i(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();(function(){function i(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();function Yy(i){i!=null&&typeof i.then=="function"&&i.then(Yg,Yg)}var I0=0,r2=1,Mu=2,$g=3,Qy=4,Kg=1024,Yg=function(){};function Ed(i){var t=i.err,e=Promise.resolve(i.execution).then(function(r){if(t!=null)throw t;return r});return i.err=void 0,i.execution=e.then(function(){},function(){}),i.pending===void 0?e:i.pending.then(function(){return e})}function bu(i,t){var e=i.state>=$g;return Promise.resolve(t).then(function(r){return!e&&i.state>=Qy?Ed(i).then(function(s){return{value:s,done:!0}}):{value:r,done:e}})}function l1(i,t){var e,r;if(!(i.state>=Mu))if(i.state=Mu,i.onnext(),i.onstop(),i.err==null&&(i.err=t),i.pushes.length===0&&(typeof i.buffer>"u"||i.buffer.empty))jp(i);else try{for(var s=Jd(i.pushes),n=s.next();!n.done;n=s.next()){var c=n.value;c.resolve()}}catch(l){e={error:l}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}}function jp(i){var t,e;if(!(i.state>=$g)){i.state<Mu&&l1(i),i.state=$g,i.buffer=void 0;try{for(var r=Jd(i.nexts),s=r.next();!s.done;s=r.next()){var n=s.value,c=i.pending===void 0?Ed(i):i.pending.then(function(){return Ed(i)});n.resolve(bu(i,c))}}catch(l){t={error:l}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}i.pushes=[],i.nexts=[]}}function s2(i){i.state>=Qy||(i.state<$g&&jp(i),i.state=Qy)}function QT(i,t){if(Yy(t),i.pushes.length>=Kg)throw new gA("No more than "+Kg+" pending calls to push are allowed on a single repeater.");if(i.state>=Mu)return Promise.resolve(void 0);var e=i.pending===void 0?Promise.resolve(t):i.pending.then(function(){return t});e=e.catch(function(f){i.state<Mu&&(i.err=f),s2(i)});var r;if(i.nexts.length){var s=i.nexts.shift();s.resolve(bu(i,e)),i.nexts.length?r=Promise.resolve(i.nexts[0].value):r=new Promise(function(f){return i.onnext=f})}else typeof i.buffer<"u"&&!i.buffer.full?(i.buffer.add(e),r=Promise.resolve(void 0)):r=new Promise(function(f){return i.pushes.push({resolve:f,value:e})});var n=!0,c={},l=r.catch(function(f){if(n)throw f});return c.then=function(f,y){return n=!1,Promise.prototype.then.call(r,f,y)},c.catch=function(f){return n=!1,Promise.prototype.catch.call(r,f)},c.finally=r.finally.bind(r),i.pending=e.then(function(){return l}).catch(function(f){i.err=f,s2(i)}),c}function tP(i){var t=l1.bind(null,i),e=new Promise(function(r){return i.onstop=r});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function eP(i){if(!(i.state>=r2)){i.state=r2;var t=QT.bind(null,i),e=tP(i);i.execution=new Promise(function(r){return r(i.executor(t,e))}),i.execution.catch(function(){return l1(i)})}}var Kf=new WeakMap,uf=function(){function i(t,e){Kf.set(this,{executor:t,buffer:e,err:void 0,state:I0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Yg,onstop:Yg})}return i.prototype.next=function(t){Yy(t);var e=Kf.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=Kg)throw new gA("No more than "+Kg+" pending calls to next are allowed on a single repeater.");if(e.state<=I0&&eP(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var r=bu(e,e.buffer.remove());if(e.pushes.length){var s=e.pushes.shift();e.buffer.add(s.value),e.onnext=s.resolve}return r}else if(e.pushes.length){var n=e.pushes.shift();return e.onnext=n.resolve,bu(e,n.value)}else if(e.state>=Mu)return jp(e),bu(e,Ed(e));return new Promise(function(c){return e.nexts.push({resolve:c,value:t})})},i.prototype.return=function(t){Yy(t);var e=Kf.get(this);if(e===void 0)throw new Error("WeakMap error");return jp(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),bu(e,Ed(e))},i.prototype.throw=function(t){var e=Kf.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=I0||e.state>=Mu||typeof e.buffer<"u"&&!e.buffer.empty?(jp(e),e.err==null&&(e.err=t),bu(e,Ed(e))):this.next(Promise.reject(t))},i.prototype[Symbol.asyncIterator]=function(){return this},i.race=iP,i.merge=rP,i.zip=sP,i.latest=nP,i}();function Am(i,t){var e,r,s=[],n=function(y){y!=null&&typeof y[Symbol.asyncIterator]=="function"?s.push(y[Symbol.asyncIterator]()):y!=null&&typeof y[Symbol.iterator]=="function"?s.push(y[Symbol.iterator]()):s.push(function(){return YT(this,arguments,function(){return Gh(this,function(x){switch(x.label){case 0:return t.yieldValues?[4,Xp(y)]:[3,3];case 1:return[4,x.sent()];case 2:x.sent(),x.label=3;case 3:return t.returnValues?[4,Xp(y)]:[3,5];case 4:return[2,x.sent()];case 5:return[2]}})})}())};try{for(var c=Jd(i),l=c.next();!l.done;l=c.next()){var f=l.value;n(f)}}catch(y){e={error:y}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}return s}function iP(i){var t=this,e=Am(i,{returnValues:!0});return new uf(function(r,s){return Od(t,void 0,void 0,function(){var n,c,l,f,y,x;return Gh(this,function(T){switch(T.label){case 0:if(!e.length)return s(),[2];c=!1,s.then(function(){n(),c=!0}),T.label=1;case 1:T.trys.push([1,,5,7]),f=void 0,y=0,x=function(){var P,M,N,G,Z,X;return Gh(this,function($){switch($.label){case 0:P=y;try{for(M=(Z=void 0,Jd(e)),N=M.next();!N.done;N=M.next())G=N.value,Promise.resolve(G.next()).then(function(ct){ct.done?(s(),l===void 0&&(l=ct)):y===P&&(y++,n(ct))},function(ct){return s(ct)})}catch(ct){Z={error:ct}}finally{try{N&&!N.done&&(X=M.return)&&X.call(M)}finally{if(Z)throw Z.error}}return[4,new Promise(function(ct){return n=ct})];case 1:return f=$.sent(),f===void 0?[3,3]:[4,r(f.value)];case 2:$.sent(),$.label=3;case 3:return[2]}})},T.label=2;case 2:return c?[3,4]:[5,x()];case 3:return T.sent(),[3,2];case 4:return[2,l&&l.value];case 5:return s(),[4,Promise.race(e.map(function(P){return P.return&&P.return()}))];case 6:return T.sent(),[7];case 7:return[2]}})})})}function rP(i){var t=this,e=Am(i,{yieldValues:!0});return new uf(function(r,s){return Od(t,void 0,void 0,function(){var n,c,l,f=this;return Gh(this,function(y){switch(y.label){case 0:if(!e.length)return s(),[2];n=[],c=!1,s.then(function(){var x,T;c=!0;try{for(var P=Jd(n),M=P.next();!M.done;M=P.next()){var N=M.value;N()}}catch(G){x={error:G}}finally{try{M&&!M.done&&(T=P.return)&&T.call(P)}finally{if(x)throw x.error}}}),y.label=1;case 1:return y.trys.push([1,,3,4]),[4,Promise.all(e.map(function(x,T){return Od(f,void 0,void 0,function(){var P,M;return Gh(this,function(N){switch(N.label){case 0:N.trys.push([0,,6,9]),N.label=1;case 1:return c?[3,5]:(Promise.resolve(x.next()).then(function(G){return n[T](G)},function(G){return s(G)}),[4,new Promise(function(G){n[T]=G})]);case 2:return P=N.sent(),P===void 0?[3,4]:P.done?(l=P,[2]):[4,r(P.value)];case 3:N.sent(),N.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return M=x.return,M?[4,x.return()]:[3,8];case 7:M=N.sent(),N.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return y.sent(),[2,l&&l.value];case 3:return s(),[7];case 4:return[2]}})})})}function sP(i){var t=this,e=Am(i,{returnValues:!0});return new uf(function(r,s){return Od(t,void 0,void 0,function(){var n,c,l,f;return Gh(this,function(y){switch(y.label){case 0:if(!e.length)return s(),[2,[]];c=!1,s.then(function(){n(),c=!0}),y.label=1;case 1:y.trys.push([1,,6,8]),y.label=2;case 2:return c?[3,5]:(Promise.all(e.map(function(x){return x.next()})).then(function(x){return n(x)},function(x){return s(x)}),[4,new Promise(function(x){return n=x})]);case 3:return l=y.sent(),l===void 0?[2]:(f=l.map(function(x){return x.value}),l.some(function(x){return x.done})?[2,f]:[4,r(f)]);case 4:return y.sent(),[3,2];case 5:return[3,8];case 6:return s(),[4,Promise.all(e.map(function(x){return x.return&&x.return()}))];case 7:return y.sent(),[7];case 8:return[2]}})})})}function nP(i){var t=this,e=Am(i,{yieldValues:!0,returnValues:!0});return new uf(function(r,s){return Od(t,void 0,void 0,function(){var n,c,l,f,y,x=this;return Gh(this,function(T){switch(T.label){case 0:if(!e.length)return s(),[2,[]];c=[],l=!1,s.then(function(){var P,M;n();try{for(var N=Jd(c),G=N.next();!G.done;G=N.next()){var Z=G.value;Z()}}catch(X){P={error:X}}finally{try{G&&!G.done&&(M=N.return)&&M.call(N)}finally{if(P)throw P.error}}l=!0}),T.label=1;case 1:return T.trys.push([1,,5,7]),Promise.all(e.map(function(P){return P.next()})).then(function(P){return n(P)},function(P){return s(P)}),[4,new Promise(function(P){return n=P})];case 2:return f=T.sent(),f===void 0?[2]:(y=f.map(function(P){return P.value}),f.every(function(P){return P.done})?[2,y]:[4,r(y.slice())]);case 3:return T.sent(),[4,Promise.all(e.map(function(P,M){return Od(x,void 0,void 0,function(){var N;return Gh(this,function(G){switch(G.label){case 0:if(f[M].done)return[2,f[M].value];G.label=1;case 1:return l?[3,4]:(Promise.resolve(P.next()).then(function(Z){return c[M](Z)},function(Z){return s(Z)}),[4,new Promise(function(Z){return c[M]=Z})]);case 2:return N=G.sent(),N===void 0?[2,f[M].value]:N.done?[2,N.value]:(y[M]=N.value,[4,r(y.slice())]);case 3:return G.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,T.sent()];case 5:return s(),[4,Promise.all(e.map(function(P){return P.return&&P.return()}))];case 6:return T.sent(),[7];case 7:return[2]}})})})}let Qg=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(i){if(i<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=i}};Qg.global=new Qg;var xl;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warn=2]="Warn",i[i.Error=3]="Error"})(xl||(xl={}));class bn{static debug(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(xl.Debug,...e)}static info(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(xl.Info,...e)}static warn(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(xl.Warn,...e)}static error(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(xl.Error,...e)}static log(t){if(!(this.logLevel>t)){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];switch(t){case xl.Debug:{console.debug(...r);break}case xl.Info:{console.info(...r);break}case xl.Warn:{console.warn(...r);break}case xl.Error:{console.error(...r);break}}}}}bn.logLevel=xl.Warn;const wu=8*4+8,oP=16;function c1(i,t){t=Math.min(Math.max(+t,2),65535);let e=i,r=e;do e=Math.ceil(e/t),r+=e;while(e!==1);return r*wu}function aP(i,t){if(t<2)throw new Error("Node size must be at least 2");if(i===0)throw new Error("Number of items must be greater than 0");let e=i,r=e;const s=[e];do e=Math.ceil(e/t),r+=e,s.push(e);while(e!==1);const n=[];e=r;for(const l of s)n.push(e-l),e-=l;const c=[];for(let l=0;l<s.length;l++)c.push([n[l],n[l]+s[l]]);return c}async function*lP(i,t,e,r){class s{constructor(M,N){this._level=N,this.nodes=M}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(M){console.assert(M>this.nodes[1]),this.nodes[1]=M}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:n,minY:c,maxX:l,maxY:f}=e;bn.info(`tree items: ${i}, nodeSize: ${t}`);const y=aP(i,t),x=y[0][0],T=[(()=>{const P=[0,1],M=y.length-1;return new s(P,M)})()];for(bn.debug(`starting stream search with queue: ${T}, numItems: ${i}, nodeSize: ${t}, levelBounds: ${y}`);T.length!=0;){const P=T.shift();bn.debug(`popped node: ${P}, queueLength: ${T.length}`);const M=P.startNodeIdx(),N=M>=x,G=(()=>{const[,ct]=y[P.level()],yt=Math.min(P.endNodeIdx()+t,ct);return N&&yt<ct?yt+1:yt})(),Z=G-M,X=await r(M*wu,Z*wu),$=new DataView(X);for(let ct=M;ct<G;ct++){const yt=ct-M,Mt=yt*wu;if(l<$.getFloat64(Mt+0,!0)||f<$.getFloat64(Mt+8,!0)||n>$.getFloat64(Mt+16,!0)||c>$.getFloat64(Mt+24,!0))continue;const Nt=$.getBigUint64(Mt+32,!0);if(N){const ot=Nt,dt=(()=>{if(ct<i-1){const wt=(yt+1)*wu;return $.getBigUint64(wt+32,!0)-ot}else return null})(),Lt=ct-x;yield[Number(ot),Lt,Number(dt)];continue}const Rt=Nt,xt=Qg.global.extraRequestThreshold()/wu,qt=T[T.length-1];if(qt!==void 0&&qt.level()==P.level()-1&&Rt<qt.endNodeIdx()+xt){bn.debug(`Merging "nodeRange" request into existing range: ${qt}, newEndNodeIdx: ${qt.endNodeIdx()} -> ${Rt}`),qt.extendEndNodeIdx(Number(Rt));continue}const zt=(()=>{const ot=P.level()-1,dt=[Number(Rt),Number(Rt)+1];return new s(dt,ot)})();qt!==void 0&&qt.level()==zt.level()?bn.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Rt} rather than merging with distant ${qt}`):bn.info(`Pushing new level for ${zt} onto queue with nearestNodeRange: ${qt} since there's not already a range for this level.`),T.push(zt)}}}const Nh=new Uint8Array([102,103,98,3,102,103,98,0]),qc=4;class h1{constructor(t,e,r,s,n){this.headerClient=t,this.header=e,this.headerLength=r,this.indexLength=s,this.nocache=n}static async open(t,e){const r=new n2(t,e),s=(()=>{const T=oP,P=3;let M=0,N;for(N=0;N<P;N++){const G=T**N*wu;M+=G}return M})(),n=2024+s;bn.debug(`fetching header. minReqLength: ${n} (assumedHeaderLength: 2024, assumedIndexLength: ${s})`);{const T=new Uint8Array(await r.getRange(0,8,n,"header"));if(!T.subarray(0,3).every((P,M)=>Nh[M]===P))throw bn.error(`bytes: ${T} != ${Nh}`),new Error("Not a FlatGeobuf file");bn.debug("magic bytes look good")}let c;{const T=await r.getRange(8,4,n,"header");c=new DataView(T).getUint32(0,!0);const P=1048576*10;if(c>P||c<8)throw new Error("Invalid header size");bn.debug(`headerLength: ${c}`)}const l=await r.getRange(12,c,n,"header"),f=new Kc(new Uint8Array(l)),y=a1(f),x=c1(y.featuresCount,y.indexNodeSize);return bn.debug("completed: opening http reader"),new h1(r,y,c,x,e)}async*selectBbox(t){const e=this.lengthBeforeTree(),r=this.headerClient,s=async function(f,y){return r.getRange(e+f,y,0,"index")},n=[];let c=[];for await(const f of lP(this.header.featuresCount,this.header.indexNodeSize,t,s)){const[y,,]=f;let[,,x]=f;if(x||(bn.info("final feature"),x=4),c.length==0){c.push([y,x]);continue}const T=c[c.length-1],P=y-(T[0]+T[1]);P>Qg.global.extraRequestThreshold()&&(bn.info(`Pushing new feature batch, since gap ${P} was too large`),n.push(c),c=[]),c.push([y,x])}this.headerClient.logUsage("header+index"),c.length>0&&n.push(c);const l=n.flatMap(f=>this.readFeatureBatch(f,this.nocache));yield*uf.merge(l)}lengthBeforeTree(){return Nh.length+qc+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new n2(this.headerClient.httpClient,t)}async*readFeatureBatch(t,e){const[r]=t[0],[s,n]=t[t.length-1],c=r,l=s+n-c,f=this.buildFeatureClient(e);let y=l;for(const[x]of t)yield await this.readFeature(f,x,y),y=0;f.logUsage("feature")}async readFeature(t,e,r){const s=e+this.lengthBeforeFeatures();let n;{const x=await t.getRange(s,4,r,"feature length");n=new DataView(x).getUint32(0,!0)}const c=await t.getRange(s+4,n,r,"feature data"),l=new Uint8Array(c),f=new Uint8Array(n+qc);f.set(l,qc);const y=new Kc(f);return y.setPosition(qc),Al.getRootAsFeature(y)}}class n2{constructor(t,e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new o2(t,e);else if(t instanceof o2)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,e,r,s){this.bytesEverUsed+=e;const n=t-this.head,c=n+e;if(n>=0&&c<=this.buffer.byteLength)return this.buffer.slice(n,c);const l=Math.max(e,r);return this.bytesEverFetched+=l,bn.debug(`requesting for new Range: ${t}-${t+l-1}`),this.buffer=await this.httpClient.getRange(t,l,s),this.head=t,this.buffer.slice(0,e)}logUsage(t){const e=t.split(" ")[0],r=this.bytesEverUsed,s=this.bytesEverFetched,n=(100*r/s).toFixed(2);bn.info(`${e} bytes used/requested: ${r} / ${s} = ${n}%`)}}class o2{constructor(t,e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=e}async getRange(t,e,r){this.requestsEverMade+=1,this.bytesEverRequested+=e;const s=`bytes=${t}-${t+e-1}`;bn.info(`request: #${this.requestsEverMade}, purpose: ${r}), bytes: (this_request: ${e}, ever: ${this.bytesEverRequested}), Range: ${s}`);const n={Range:s};return this.nocache&&(n["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:n})).arrayBuffer()}}function cP(i,t,e){if(!i.subarray(0,3).every((x,T)=>Nh[T]===x))throw new Error("Not a FlatGeobuf file");const r=new Kc(i),s=r.readUint32(Nh.length);r.setPosition(Nh.length+qc);const n=a1(r);e&&e(n);let c=Nh.length+qc+s;const{indexNodeSize:l,featuresCount:f}=n;l>0&&(c+=c1(f,l));const y=[];for(;c<r.capacity();){const x=r.readUint32(c);r.setPosition(c+qc);const T=Al.getRootAsFeature(r);y.push(t(T,n)),c+=qc+x}return y}async function*hP(i,t,e){const r=$T(i),s=async P=>await r.slice(P);let n=new Uint8Array(await s(8));if(!n.subarray(0,3).every((P,M)=>Nh[M]===P))throw new Error("Not a FlatGeobuf file");n=new Uint8Array(await s(4));let c=new Kc(n);const l=c.readUint32(0);n=new Uint8Array(await s(l)),c=new Kc(n);const f=a1(c);e&&e(f);const{indexNodeSize:y,featuresCount:x}=f;if(y>0){const P=c1(x,y);await s(P)}let T;for(;T=await dP(s,f,t);)yield T}function uP(i,t,e,r){try{let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const n=await h1.open(i,s);bn.debug("opened reader"),r&&r(n.header);for await(const c of n.selectBbox(t))yield e(c,n.header)}()}catch(s){return Promise.reject(s)}}async function dP(i,t,e){let r=new Uint8Array(await i(4,"feature length"));if(r.byteLength===0)return;let s=new Kc(r);const n=s.readUint32(0);r=new Uint8Array(await i(n,"feature data"));const c=new Uint8Array(n+4);c.set(r,4),s=new Kc(c),s.setPosition(qc);const l=Al.getRootAsFeature(s);return e(l,t)}function pP(i,t){return{type:"FeatureCollection",features:cP(i,n1,t)}}function fP(i,t){return hP(i,n1,t)}function gP(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return uP(i,t,n1,e,r)}function a2(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return i instanceof Uint8Array?pP(i,e):i instanceof ReadableStream?fP(i,e):gP(i,t,e,r)}class mP{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let e=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(e._btn.className.indexOf("3d")!=-1){let y={pitch:e._pitch,bearing:e._bearing};e._minpitchzoom&&t.getZoom()>e._minpitchzoom&&(y.zoom=e._minpitchzoom);var r=0,s=38.5,n=6,c=62.33,{longitude:l,latitude:f}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainMapZen",exaggeration:1.5}):l>=r&&l<=n&&f>=s&&f<=c?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainMapZen",exaggeration:1.5}),t.easeTo(y),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function $p(i){"@babel/helpers - typeof";return $p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$p(i)}function yP(i,t){if($p(i)!="object"||!i)return i;var e=i[Symbol.toPrimitive];if(e!==void 0){var r=e.call(i,t||"default");if($p(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(i)}function _P(i){var t=yP(i,"string");return $p(t)=="symbol"?t:String(t)}function H(i,t,e){return t=_P(t),t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function Qr(i,t){if(!i)throw new Error(t||"loader assertion failed.")}const Sm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),l2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);l2&&parseFloat(l2[1]);const vP="3.4.14";function dc(i,t){if(!i)throw new Error(t||"loaders.gl assertion failed.")}const M0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},bP=M0.global||M0.self||M0.window||{},Zc=typeof process!="object"||String(process)!=="[object process]"||process.browser,u1=typeof importScripts=="function",wP=typeof window<"u"&&typeof window.orientation<"u",c2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);c2&&parseFloat(c2[1]);class xP{constructor(t,e){H(this,"name",void 0),H(this,"workerThread",void 0),H(this,"isRunning",!0),H(this,"result",void 0),H(this,"_resolve",()=>{}),H(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){dc(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){dc(this.isRunning),this.isRunning=!1,this._reject(t)}}let L0=class{terminate(){}};const B0=new Map;function AP(i){dc(i.source&&!i.url||!i.source&&i.url);let t=B0.get(i.source||i.url);return t||(i.url&&(t=SP(i.url),B0.set(i.url,t)),i.source&&(t=mA(i.source),B0.set(i.source,t))),dc(t),t}function SP(i){if(!i.startsWith("http"))return i;const t=EP(i);return mA(t)}function mA(i){const t=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(t)}function EP(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function yA(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const r=e||new Set;if(i){if(h2(i))r.add(i);else if(h2(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)&&t&&typeof i=="object")for(const s in i)yA(i[s],t,r)}return e===void 0?Array.from(r):[]}function h2(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const R0=()=>{};class t_{static isSupported(){return typeof Worker<"u"&&Zc||typeof L0<"u"&&!Zc}constructor(t){H(this,"name",void 0),H(this,"source",void 0),H(this,"url",void 0),H(this,"terminated",!1),H(this,"worker",void 0),H(this,"onMessage",void 0),H(this,"onError",void 0),H(this,"_loadableURL","");const{name:e,source:r,url:s}=t;dc(r||s),this.name=e,this.source=r,this.url=s,this.onMessage=R0,this.onError=n=>console.log(n),this.worker=Zc?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=R0,this.onError=R0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||yA(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=AP({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new L0(e,{eval:!1})}else if(this.source)t=new L0(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class CP{static isSupported(){return t_.isSupported()}constructor(t){H(this,"name","unnamed"),H(this,"source",void 0),H(this,"url",void 0),H(this,"maxConcurrency",1),H(this,"maxMobileConcurrency",1),H(this,"onDebug",()=>{}),H(this,"reuseWorkers",!0),H(this,"props",{}),H(this,"jobQueue",[]),H(this,"idleQueue",[]),H(this,"count",0),H(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(n,c,l)=>n.done(l),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(n,c)=>n.error(c);const s=new Promise(n=>(this.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const r=new xP(e.name,t);t.onMessage=s=>e.onMessage(r,s.type,s.payload),t.onError=s=>e.onError(r,s),e.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new t_({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return wP?this.maxMobileConcurrency:this.maxConcurrency}}const TP={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Gc{static isSupported(){return t_.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Gc._workerFarm=Gc._workerFarm||new Gc({}),Gc._workerFarm.setProps(t),Gc._workerFarm}constructor(t){H(this,"props",void 0),H(this,"workerPools",new Map),this.props={...TP},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:r,url:s}=t;let n=this.workerPools.get(e);return n||(n=new CP({name:e,source:r,url:s}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}H(Gc,"_workerFarm",void 0);const PP="latest";function IP(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[i.id]||{},r="".concat(i.id,"-worker.js");let s=e.workerUrl;if(!s&&i.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(s="modules/".concat(i.module,"/dist/").concat(r)),!s){let n=i.version;n==="latest"&&(n=PP);const c=n?"@".concat(n):"";s="https://unpkg.com/@loaders.gl/".concat(i.module).concat(c,"/dist/").concat(r)}return dc(s),s}function MP(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vP;dc(i,"no worker provided");const e=i.version;return!(!t||!e)}const LP=null,BP=null,e_=null,_A=null,RP=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:LP,readFileAsText:BP,requireFromFile:e_,requireFromString:_A},Symbol.toStringTag,{value:"Module"})),kP="3.4.14",k0={};async function Tu(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(i=OP(i,t,e)),k0[i]=k0[i]||DP(i),await k0[i]}function OP(i,t,e){if(i.startsWith("http"))return i;const r=e.modules||{};return r[i]?r[i]:Zc?e.CDN?(dc(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(t,"@").concat(kP,"/dist/libs/").concat(i)):u1?"../src/libs/".concat(i):"modules/".concat(t,"/src/libs/").concat(i):"modules/".concat(t,"/dist/libs/").concat(i)}async function DP(i){if(i.endsWith("wasm"))return await(await fetch(i)).arrayBuffer();if(!Zc)try{return RP&&e_&&await e_(i)}catch{return null}if(u1)return importScripts(i);const t=await(await fetch(i)).text();return NP(t,i)}function NP(i,t){if(!Zc)return _A;if(u1)return eval.call(bP,i),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(i))}catch{e.text=i}return document.body.appendChild(e),null}function FP(i,t){return!Gc.isSupported()||!Zc&&!(t!=null&&t._nodeWorkers)?!1:i.worker&&(t==null?void 0:t.worker)}async function zP(i,t,e,r,s){const n=i.id,c=IP(i,e),l=Gc.getWorkerFarm(e).getWorkerPool({name:n,url:c});e=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(r||{}));const f=await l.startJob("process-on-worker",jP.bind(null,s));return f.postMessage("process",{input:t,options:e,context:r}),await(await f.result).result}async function jP(i,t,e,r){switch(e){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:s,input:n,options:c}=r;try{const l=await i(n,c);t.postMessage("done",{id:s,result:l})}catch(l){const f=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:s,error:f})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function UP(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?u2(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?u2(i,0,t):""}function u2(i,t,e){if(i.byteLength<=t+e)return"";const r=new DataView(i);let s="";for(let n=0;n<e;n++)s+=String.fromCharCode(r.getUint8(t+n));return s}function GP(i){try{return JSON.parse(i)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(UP(i),'"'))}}function VP(i,t,e){if(e=e||i.byteLength,i.byteLength<e||t.byteLength<e)return!1;const r=new Uint8Array(i),s=new Uint8Array(t);for(let n=0;n<r.length;++n)if(r[n]!==s[n])return!1;return!0}function qP(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];const r=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),s=r.reduce((l,f)=>l+f.byteLength,0),n=new Uint8Array(s);let c=0;for(const l of r)n.set(l,c),c+=l.byteLength;return n.buffer}function d1(i,t,e){const r=e!==void 0?new Uint8Array(i).subarray(t,t+e):new Uint8Array(i).subarray(t);return new Uint8Array(r).buffer}function df(i,t){return Qr(i>=0),Qr(t>0),i+(t-1)&~(t-1)}function HP(i,t,e){let r;if(i instanceof ArrayBuffer)r=new Uint8Array(i);else{const s=i.byteOffset,n=i.byteLength;r=new Uint8Array(i.buffer||i.arrayBuffer,s,n)}return t.set(r,e),e+df(r.byteLength,4)}async function WP(i){const t=[];for await(const e of i)t.push(e);return qP(...t)}function d2(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}let p2=class{constructor(i,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=i,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(i){return this.sampleSize=i,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(i){return this._count+=i,this._samples++,this._checkSampling(),this}subtractCount(i){return this._count-=i,this._samples++,this._checkSampling(),this}addTime(i){return this._time+=i,this.lastTiming=i,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=d2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(d2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},JP=class{constructor(i){this.id=void 0,this.stats={},this.id=i.id,this.stats={},this._initializeStats(i.stats),Object.seal(this)}get(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:i,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const i of Object.values(this.stats))i.reset();return this}forEach(i){for(const t of Object.values(this.stats))i(t)}getTable(){const i={};return this.forEach(t=>{i[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),i}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(i=>this._getOrCreate(i))}_getOrCreate(i){const{name:t,type:e}=i;let r=this.stats[t];return r||(i instanceof p2?r=i:r=new p2(t,e),this.stats[t]=r),r}};const ZP="Queued Requests",XP="Active Requests",$P="Cancelled Requests",KP="Queued Requests Ever",YP="Active Requests Ever",QP={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class tI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"props",void 0),H(this,"stats",void 0),H(this,"activeRequestCount",0),H(this,"requestQueue",[]),H(this,"requestMap",new Map),H(this,"deferredUpdate",null),this.props={...QP,...t},this.stats=new JP({id:this.props.id}),this.stats.get(ZP),this.stats.get(XP),this.stats.get($P),this.stats.get(KP),this.stats.get(YP)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const r={handle:t,priority:0,getPriority:e},s=new Promise(n=>(r.resolve=n,r));return this.requestQueue.push(r),this.requestMap.set(t,s),this._issueNewRequests(),s}_issueRequest(t){const{handle:e,resolve:r}=t;let s=!1;const n=()=>{s||(s=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:n}):Promise.resolve({done:n})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const r=t[e];this._updateRequest(r)||(t.splice(e,1),this.requestMap.delete(r.handle),e--)}t.sort((e,r)=>e.priority-r.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let eI="";const f2={};function iI(i){for(const t in f2)if(i.startsWith(t)){const e=f2[t];i=i.replace(t,e)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(eI).concat(i)),i}function rI(i){return i&&typeof i=="object"&&i.isBuffer}function vA(i){if(rI(i)||i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const t=i;return new TextEncoder().encode(t).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function bA(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(t+1):""}function p1(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(0,t):""}const sI=i=>typeof i=="boolean",Up=i=>typeof i=="function",pf=i=>i!==null&&typeof i=="object",g2=i=>pf(i)&&i.constructor==={}.constructor,nI=i=>i&&typeof i[Symbol.iterator]=="function",oI=i=>i&&typeof i[Symbol.asyncIterator]=="function",ku=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Ou=i=>typeof Blob<"u"&&i instanceof Blob,aI=i=>i&&typeof i=="object"&&i.isBuffer,lI=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||pf(i)&&Up(i.tee)&&Up(i.cancel)&&Up(i.getReader),cI=i=>pf(i)&&Up(i.read)&&Up(i.pipe)&&sI(i.readable),wA=i=>lI(i)||cI(i),hI=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,uI=/^([-\w.]+\/[-\w.+]+)/;function dI(i){const t=uI.exec(i);return t?t[1]:i}function m2(i){const t=hI.exec(i);return t?t[1]:""}const xA=/\?.*/;function pI(i){const t=i.match(xA);return t&&t[0]}function f1(i){return i.replace(xA,"")}function Em(i){return ku(i)?i.url:Ou(i)?i.name||"":typeof i=="string"?i:""}function g1(i){if(ku(i)){const t=i,e=t.headers.get("content-type")||"",r=f1(t.url);return dI(e)||m2(r)}return Ou(i)?i.type||"":typeof i=="string"?m2(i):""}function fI(i){return ku(i)?i.headers["content-length"]||-1:Ou(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function AA(i){if(ku(i))return i;const t={},e=fI(i);e>=0&&(t["content-length"]=String(e));const r=Em(i),s=g1(i);s&&(t["content-type"]=s);const n=await yI(i);n&&(t["x-first-bytes"]=n),typeof i=="string"&&(i=new TextEncoder().encode(i));const c=new Response(i,{headers:t});return Object.defineProperty(c,"url",{value:r}),c}async function gI(i){if(!i.ok){const t=await mI(i);throw new Error(t)}}async function mI(i){let t="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const e=i.headers.get("Content-Type");let r=i.statusText;e.includes("application/json")&&(r+=" ".concat(await i.text())),t+=r,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function yI(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(e=>{const r=new FileReader;r.onload=s=>{var n;return e(s==null||(n=s.target)===null||n===void 0?void 0:n.result)},r.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),e=_I(t);return"data:base64,".concat(e)}return null}function _I(i){let t="";const e=new Uint8Array(i);for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t)}async function y2(i,t){if(typeof i=="string"){i=iI(i);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(i,e)}return await AA(i)}function vI(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=i||t;return!!(e&&e.indexOf("Electron")>=0)}function ff(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||vI()}const O0=globalThis.window||globalThis.self||globalThis.global,Yf=globalThis.process||{},SA=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";ff();function bI(i){try{const t=window[i],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}let wI=class{constructor(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=bI(e),this.id=i,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(i){if(Object.assign(this.config,i),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let i={};if(this.storage){const t=this.storage.getItem(this.id);i=t?JSON.parse(t):{}}return Object.assign(this.config,i),this}};function xI(i){let t;return i<10?t=`${i.toFixed(2)}ms`:i<100?t=`${i.toFixed(1)}ms`:i<1e3?t=`${i.toFixed(0)}ms`:t=`${(i/1e3).toFixed(2)}s`,t}function AI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-i.length,0);return`${" ".repeat(e)}${i}`}function D0(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(e=Math.min(e,r/i.width));const n=i.width*e,c=i.height*e,l=["font-size:1px;",`padding:${Math.floor(c/2)}px ${Math.floor(n/2)}px;`,`line-height:${c}px;`,`background:url(${s});`,`background-size:${n}px ${c}px;`,"color:transparent;"].join("");return[`${t} %c+`,l]}let tm;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(tm||(tm={}));const SI=10;function _2(i){return typeof i!="string"?i:(i=i.toUpperCase(),tm[i]||tm.WHITE)}function EI(i,t,e){return!ff&&typeof i=="string"&&(t&&(i=`\x1B[${_2(t)}m${i}\x1B[39m`),e&&(i=`\x1B[${_2(e)+SI}m${i}\x1B[49m`)),i}function CI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(e),s=i;for(const n of r){const c=s[n];typeof c=="function"&&(t.find(l=>n===l)||(s[n]=c.bind(i)))}}function em(i,t){if(!i)throw new Error(t||"Assertion failed")}function id(){let i;if(ff()&&O0.performance){var t,e;i=O0==null||(t=O0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in Yf){var r;const s=Yf==null||(r=Yf.hrtime)===null||r===void 0?void 0:r.call(Yf);i=s[0]*1e3+s[1]/1e6}else i=Date.now();return i}const rd={debug:ff()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},TI={enabled:!0,level:0};function Na(){}const v2={},b2={once:!0};let m1=class{constructor(){let{id:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=SA,this._startTs=id(),this._deltaTs=id(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=i,this.userData={},this._storage=new wI(`__probe-${this.id}__`,TI),this.timeStamp(`${this.id} started`),CI(this),Object.seal(this)}set level(i){this.setLevel(i)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((id()-this._startTs).toPrecision(10))}getDelta(){return Number((id()-this._deltaTs).toPrecision(10))}set priority(i){this.level=i}get priority(){return this.level}getPriority(){return this.level}enable(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:i}),this}setLevel(i){return this._storage.setConfiguration({level:i}),this}get(i){return this._storage.config[i]}set(i,t){this._storage.setConfiguration({[i]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(i,t){em(i,t)}warn(i){return this._getLogFunction(0,i,rd.warn,arguments,b2)}error(i){return this._getLogFunction(0,i,rd.error,arguments)}deprecated(i,t){return this.warn(`\`${i}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(i,t){return this.error(`\`${i}\` has been removed. Use \`${t}\` instead`)}probe(i,t){return this._getLogFunction(i,t,rd.log,arguments,{time:!0,once:!0})}log(i,t){return this._getLogFunction(i,t,rd.debug,arguments)}info(i,t){return this._getLogFunction(i,t,console.info,arguments)}once(i,t){return this._getLogFunction(i,t,rd.debug||rd.info,arguments,b2)}table(i,t,e){return t?this._getLogFunction(i,t,console.table||Na,e&&[e],{tag:LI(t)}):Na}image(i){let{logLevel:t,priority:e,image:r,message:s="",scale:n=1}=i;return this._shouldLog(t||e)?ff()?MI({image:r,message:s,scale:n}):II():Na}time(i,t){return this._getLogFunction(i,t,console.time?console.time:console.info)}timeEnd(i,t){return this._getLogFunction(i,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(i,t){return this._getLogFunction(i,t,console.timeStamp||Na)}group(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=w2({logLevel:i,message:t,opts:e}),{collapsed:s}=e;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(i,t,Object.assign({},e,{collapsed:!0}))}groupEnd(i){return this._getLogFunction(i,"",console.groupEnd||Na)}withGroup(i,t,e){this.group(i,t)();try{e()}finally{this.groupEnd(i)()}}trace(){console.trace&&console.trace()}_shouldLog(i){return this.isEnabled()&&this.getLevel()>=EA(i)}_getLogFunction(i,t,e,r,s){if(this._shouldLog(i)){s=w2({logLevel:i,message:t,args:r,opts:s}),e=e||s.method,em(e),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=id();const n=s.tag||s.message;if(s.once&&n)if(!v2[n])v2[n]=id();else return Na;return t=PI(this.id,s.message,s),e.bind(console,t,...s.args)}return Na}};m1.VERSION=SA;function EA(i){if(!i)return 0;let t;switch(typeof i){case"number":t=i;break;case"object":t=i.logLevel||i.priority||0;break;default:return 0}return em(Number.isFinite(t)&&t>=0),t}function w2(i){const{logLevel:t,message:e}=i;i.logLevel=EA(t);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&r.unshift(e),i.message=t;break;case"object":Object.assign(i,t);break}typeof i.message=="function"&&(i.message=i.message());const s=typeof i.message;return em(s==="string"||s==="object"),Object.assign(i,{args:r},i.opts)}function PI(i,t,e){if(typeof t=="string"){const r=e.time?AI(xI(e.total)):"";t=e.time?`${i}: ${r}  ${t}`:`${i}: ${t}`,t=EI(t,e.color,e.background)}return t}function II(i){return console.warn("removed"),Na}function MI(i){let{image:t,message:e="",scale:r=1}=i;if(typeof t=="string"){const n=new Image;return n.onload=()=>{const c=D0(n,e,r);console.log(...c)},n.src=t,Na}const s=t.nodeName||"";if(s.toLowerCase()==="img")return console.log(...D0(t,e,r)),Na;if(s.toLowerCase()==="canvas"){const n=new Image;return n.onload=()=>console.log(...D0(n,e,r)),n.src=t.toDataURL(),Na}return Na}function LI(i){for(const t in i)for(const e in i[t])return e||"untitled";return"empty"}const x2=new m1({id:"loaders.gl"});class BI{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class RI{constructor(){H(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.error.bind(this.console,...e)}}const CA={fetch:null,mimeType:void 0,nothrow:!1,log:new RI,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Sm,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kI={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function TA(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const PA=()=>{const i=TA();return i.globalOptions=i.globalOptions||{...CA},i.globalOptions};function OI(i,t,e,r){return e=e||[],e=Array.isArray(e)?e:[e],DI(i,e),FI(t,i,r)}function DI(i,t){A2(i,null,CA,kI,t);for(const e of t){const r=i&&i[e.id]||{},s=e.options&&e.options[e.id]||{},n=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};A2(r,e.id,s,n,t)}}function A2(i,t,e,r,s){const n=t||"Top level",c=t?"".concat(t,"."):"";for(const l in i){const f=!t&&pf(i[l]),y=l==="baseUri"&&!t,x=l==="workerUrl"&&t;if(!(l in e)&&!y&&!x){if(l in r)x2.warn("".concat(n," loader option '").concat(c).concat(l,"' no longer supported, use '").concat(r[l],"'"))();else if(!f){const T=NI(l,s);x2.warn("".concat(n," loader option '").concat(c).concat(l,"' not recognized. ").concat(T))()}}}}function NI(i,t){const e=i.toLowerCase();let r="";for(const s of t)for(const n in s.options){if(i===n)return"Did you mean '".concat(s.id,".").concat(n,"'?");const c=n.toLowerCase();(e.startsWith(c)||c.startsWith(e))&&(r=r||"Did you mean '".concat(s.id,".").concat(n,"'?"))}return r}function FI(i,t,e){const r={...i.options||{}};return zI(r,e),r.log===null&&(r.log=new BI),S2(r,PA()),S2(r,t),r}function S2(i,t){for(const e in t)if(e in t){const r=t[e];g2(r)&&g2(i[e])?i[e]={...i[e],...t[e]}:i[e]=t[e]}}function zI(i,t){t&&!("baseUri"in i)&&(i.baseUri=t)}function y1(i){var t;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((t=i)===null||t===void 0?void 0:t.extensions)):!1}function _1(i){var t,e;Qr(i,"null loader"),Qr(y1(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((t=i)!==null&&t!==void 0&&t.parseTextSync||(e=i)!==null&&e!==void 0&&e.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const IA=()=>{const i=TA();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function jI(i){const t=IA();i=Array.isArray(i)?i:[i];for(const e of i){const r=_1(e);t.find(s=>r===s)||t.unshift(r)}}function UI(){return IA()}const GI=new m1({id:"loaders.gl"}),VI=/\.([^.]+)$/;async function qI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!MA(i))return null;let s=E2(i,t,{...e,nothrow:!0},r);if(s)return s;if(Ou(i)&&(i=await i.slice(0,10).arrayBuffer(),s=E2(i,t,e,r)),!s&&!(e!=null&&e.nothrow))throw new Error(LA(i));return s}function E2(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!MA(i))return null;if(t&&!Array.isArray(t))return _1(t);let s=[];t&&(s=s.concat(t)),e!=null&&e.ignoreRegisteredLoaders||s.push(...UI()),WI(s);const n=HI(i,s,e,r);if(!n&&!(e!=null&&e.nothrow))throw new Error(LA(i));return n}function HI(i,t,e,r){const s=Em(i),n=g1(i),c=f1(s)||(r==null?void 0:r.url);let l=null,f="";if(e!=null&&e.mimeType&&(l=N0(t,e==null?void 0:e.mimeType),f="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),l=l||JI(t,c),f=f||(l?"matched url ".concat(c):""),l=l||N0(t,n),f=f||(l?"matched MIME type ".concat(n):""),l=l||XI(t,i),f=f||(l?"matched initial data ".concat(BA(i)):""),l=l||N0(t,e==null?void 0:e.fallbackMimeType),f=f||(l?"matched fallback MIME type ".concat(n):""),f){var y;GI.log(1,"selectLoader selected ".concat((y=l)===null||y===void 0?void 0:y.name,": ").concat(f,"."))}return l}function MA(i){return!(i instanceof Response&&i.status===204)}function LA(i){const t=Em(i),e=g1(i);let r="No valid loader found (";r+=t?"".concat(bA(t),", "):"no url provided, ",r+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const s=i?BA(i):"";return r+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",r+=")",r}function WI(i){for(const t of i)_1(t)}function JI(i,t){const e=t&&VI.exec(t),r=e&&e[1];return r?ZI(i,r):null}function ZI(i,t){t=t.toLowerCase();for(const e of i)for(const r of e.extensions)if(r.toLowerCase()===t)return e;return null}function N0(i,t){for(const e of i)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function XI(i,t){if(!t)return null;for(const e of i)if(typeof t=="string"){if($I(t,e))return e}else if(ArrayBuffer.isView(t)){if(C2(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&C2(t,0,e))return e;return null}function $I(i,t){return t.testText?t.testText(i):(Array.isArray(t.tests)?t.tests:[t.tests]).some(e=>i.startsWith(e))}function C2(i,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>KI(i,t,e,r))}function KI(i,t,e,r){if(r instanceof ArrayBuffer)return VP(r,i,r.byteLength);switch(typeof r){case"function":return r(i,e);case"string":const s=i_(i,t,r.length);return r===s;default:return!1}}function BA(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?i_(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?i_(i,0,t):""}function i_(i,t,e){if(i.byteLength<t+e)return"";const r=new DataView(i);let s="";for(let n=0;n<e;n++)s+=String.fromCharCode(r.getUint8(t+n));return s}const YI=256*1024;function*QI(i,t){const e=(t==null?void 0:t.chunkSize)||YI;let r=0;const s=new TextEncoder;for(;r<i.length;){const n=Math.min(i.length-r,e),c=i.slice(r,r+n);r+=n,yield s.encode(c)}}const tM=256*1024;function eM(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=tM}=t;let r=0;for(;r<i.byteLength;){const s=Math.min(i.byteLength-r,e),n=new ArrayBuffer(s),c=new Uint8Array(i,r,s);new Uint8Array(n).set(c),r+=s,yield n}}()}const iM=1024*1024;async function*rM(i,t){const e=(t==null?void 0:t.chunkSize)||iM;let r=0;for(;r<i.size;){const s=r+e,n=await i.slice(r,s).arrayBuffer();r=s,yield n}}function T2(i,t){return Sm?sM(i,t):nM(i)}async function*sM(i,t){const e=i.getReader();let r;try{for(;;){const s=r||e.read();t!=null&&t._streamReadAhead&&(r=e.read());const{done:n,value:c}=await s;if(n)return;yield vA(c)}}catch{e.releaseLock()}}async function*nM(i,t){for await(const e of i)yield vA(e)}function oM(i,t){if(typeof i=="string")return QI(i,t);if(i instanceof ArrayBuffer)return eM(i,t);if(Ou(i))return rM(i,t);if(wA(i))return T2(i,t);if(ku(i))return T2(i.body,t);throw new Error("makeIterator")}const RA="Cannot convert supplied data type";function aM(i,t,e){if(t.text&&typeof i=="string")return i;if(aI(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const s=i.byteLength||i.length;return(i.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+s)),r}throw new Error(RA)}async function lM(i,t,e){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return aM(i,t);if(Ou(i)&&(i=await AA(i)),ku(i)){const s=i;return await gI(s),t.binary?await s.arrayBuffer():await s.text()}if(wA(i)&&(i=oM(i,e)),nI(i)||oI(i))return WP(i);throw new Error(RA)}function kA(i,t){const e=PA(),r=i||e;return typeof r.fetch=="function"?r.fetch:pf(r.fetch)?s=>y2(s,r):t!=null&&t.fetch?t==null?void 0:t.fetch:y2}function cM(i,t,e){if(e)return e;const r={fetch:kA(t,i),...i};if(r.url){const s=f1(r.url);r.baseUrl=s,r.queryString=pI(r.url),r.filename=bA(s),r.baseUrl=p1(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function hM(i,t){if(!t&&i&&!Array.isArray(i))return i;let e;if(i&&(e=Array.isArray(i)?i:[i]),t&&t.loaders){const r=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...r]:r}return e&&e.length?e:null}async function v1(i,t,e,r){dc(!r||typeof r=="object"),t&&!Array.isArray(t)&&!y1(t)&&(r=void 0,e=t,t=void 0),i=await i,e=e||{};const s=Em(i),n=hM(t,r),c=await qI(i,n,e);return c?(e=OI(e,c,n,s),r=cM({url:s,parse:v1,loaders:n},e,r||null),await uM(c,i,e,r)):null}async function uM(i,t,e,r){if(MP(i),ku(t)){const s=t,{ok:n,redirected:c,status:l,statusText:f,type:y,url:x}=s,T=Object.fromEntries(s.headers.entries());r.response={headers:T,ok:n,redirected:c,status:l,statusText:f,type:y,url:x}}if(t=await lM(t,i,e),i.parseTextSync&&typeof t=="string")return e.dataType="text",i.parseTextSync(t,e,r,i);if(FP(i,e))return await zP(i,t,e,r,v1);if(i.parseText&&typeof t=="string")return await i.parseText(t,e,r,i);if(i.parse)return await i.parse(t,e,r,i);throw dc(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function Vh(i,t,e,r){!Array.isArray(t)&&!y1(t)&&(e=t,t=void 0);const s=kA(e);let n=i;return typeof i=="string"&&(n=await s(i)),Ou(i)&&(n=await s(i)),await v1(n,t,e)}const dM="3.4.14",{_parseImageNode:pM}=globalThis,r_=typeof Image<"u",s_=typeof ImageBitmap<"u",fM=!!pM,n_=Sm?!0:fM;function gM(i){switch(i){case"auto":return s_||r_||n_;case"imagebitmap":return s_;case"image":return r_;case"data":return n_;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function mM(){if(s_)return"imagebitmap";if(r_)return"image";if(n_)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function yM(i){const t=vM(i);if(!t)throw new Error("Not an image");return t}function _M(i){switch(yM(i)){case"data":return i;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=i.width,t.height=i.height,e.drawImage(i,0,0),e.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function vM(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const bM=/^data:image\/svg\+xml/,wM=/\.svg((\?|#).*)?$/;function b1(i){return i&&(bM.test(i)||wM.test(i))}function xM(i,t){if(b1(t)){let e=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(e=unescape(encodeURIComponent(e)))}catch(r){throw new Error(r.message)}return"data:image/svg+xml;base64,".concat(btoa(e))}return OA(i,t)}function OA(i,t){if(b1(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function DA(i,t,e){const r=xM(i,e),s=self.URL||self.webkitURL,n=typeof r!="string"&&s.createObjectURL(r);try{return await AM(n||r,t)}finally{n&&s.revokeObjectURL(n)}}async function AM(i,t){const e=new Image;return e.src=i,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((r,s)=>{try{e.onload=()=>r(e),e.onerror=n=>s(new Error("Could not load image ".concat(i,": ").concat(n)))}catch(n){s(n)}})}const SM={};let P2=!0;async function EM(i,t,e){let r;b1(e)?r=await DA(i,t,e):r=OA(i,e);const s=t&&t.imagebitmap;return await CM(r,s)}async function CM(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((TM(t)||!P2)&&(t=null),t)try{return await createImageBitmap(i,t)}catch(e){console.warn(e),P2=!1}return await createImageBitmap(i)}function TM(i){for(const t in i||SM)return!1;return!0}function PM(i){return!BM(i,"ftyp",4)||!(i[8]&96)?null:IM(i)}function IM(i){switch(MM(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function MM(i,t,e){return String.fromCharCode(...i.slice(t,e))}function LM(i){return[...i].map(t=>t.charCodeAt(0))}function BM(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=LM(t);for(let s=0;s<r.length;++s)if(r[s]!==i[s+e])return!1;return!0}const sc=!1,Gp=!0;function w1(i){const t=gf(i);return kM(t)||NM(t)||OM(t)||DM(t)||RM(t)}function RM(i){const t=new Uint8Array(i instanceof DataView?i.buffer:i),e=PM(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function kM(i){const t=gf(i);return t.byteLength>=24&&t.getUint32(0,sc)===2303741511?{mimeType:"image/png",width:t.getUint32(16,sc),height:t.getUint32(20,sc)}:null}function OM(i){const t=gf(i);return t.byteLength>=10&&t.getUint32(0,sc)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Gp),height:t.getUint16(8,Gp)}:null}function DM(i){const t=gf(i);return t.byteLength>=14&&t.getUint16(0,sc)===16973&&t.getUint32(2,Gp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Gp),height:t.getUint32(22,Gp)}:null}function NM(i){const t=gf(i);if(!(t.byteLength>=3&&t.getUint16(0,sc)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:e,sofMarkers:r}=FM();let s=2;for(;s+9<t.byteLength;){const n=t.getUint16(s,sc);if(r.has(n))return{mimeType:"image/jpeg",height:t.getUint16(s+5,sc),width:t.getUint16(s+7,sc)};if(!e.has(n))return null;s+=2,s+=t.getUint16(s,sc)}return null}function FM(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function gf(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function zM(i,t){const{mimeType:e}=w1(i)||{},r=globalThis._parseImageNode;return Qr(r),await r(i,e)}async function jM(i,t,e){t=t||{};const r=(t.image||{}).type||"auto",{url:s}=e||{},n=UM(r);let c;switch(n){case"imagebitmap":c=await EM(i,t,s);break;case"image":c=await DA(i,t,s);break;case"data":c=await zM(i);break;default:Qr(!1)}return r==="data"&&(c=_M(c)),c}function UM(i){switch(i){case"auto":case"data":return mM();default:return gM(i),i}}const GM=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],VM=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],qM={image:{type:"auto",decode:!0}},NA={id:"image",module:"images",name:"Images",version:dM,mimeTypes:VM,extensions:GM,parse:jM,tests:[i=>!!w1(new DataView(i))],options:qM},F0={};function HM(i){if(F0[i]===void 0){const t=Sm?JM(i):WM(i);F0[i]=t}return F0[i]}function WM(i){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:e,_imageFormatsNode:r=t}=globalThis;return!!e&&r.includes(i)}function JM(i){switch(i){case"image/avif":case"image/webp":return ZM(i);default:return!0}}function ZM(i){try{return document.createElement("canvas").toDataURL(i).indexOf("data:".concat(i))===0}catch{return!1}}function FA(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=i||t;return!!(e&&e.indexOf("Electron")>=0)}function eh(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||FA()}const Ig={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},z0=Ig.window||Ig.self||Ig.global,Qf=Ig.process||{},zA=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";eh();const j0=globalThis;function jA(i){if(!i&&!eh())return"Node";if(FA(i))return"Electron";const t=i||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const e=t.indexOf("MSIE ")!==-1,r=t.indexOf("Trident/")!==-1;return e||r?"IE":j0.chrome?"Chrome":j0.safari?"Safari":j0.mozInnerScreenX?"Firefox":"Unknown"}function XM(i){try{const t=window[i],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class $M{constructor(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";H(this,"storage",void 0),H(this,"id",void 0),H(this,"config",void 0),this.storage=XM(r),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function KM(i){let t;return i<10?t="".concat(i.toFixed(2),"ms"):i<100?t="".concat(i.toFixed(1),"ms"):i<1e3?t="".concat(i.toFixed(0),"ms"):t="".concat((i/1e3).toFixed(2),"s"),t}function YM(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-i.length,0);return"".concat(" ".repeat(e)).concat(i)}function U0(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const s=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(e=Math.min(e,r/i.width));const n=i.width*e,c=i.height*e,l=["font-size:1px;","padding:".concat(Math.floor(c/2),"px ").concat(Math.floor(n/2),"px;"),"line-height:".concat(c,"px;"),"background:url(".concat(s,");"),"background-size:".concat(n,"px ").concat(c,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),l]}let im;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(im||(im={}));function I2(i){return typeof i=="string"?im[i.toUpperCase()]||im.WHITE:i}function QM(i,t,e){return!eh&&typeof i=="string"&&(t&&(t=I2(t),i="\x1B[".concat(t,"m").concat(i,"\x1B[39m")),e&&(t=I2(e),i="\x1B[".concat(e+10,"m").concat(i,"\x1B[49m"))),i}function tL(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(e);for(const s of r)typeof i[s]=="function"&&(t.find(n=>s===n)||(i[s]=i[s].bind(i)))}function rm(i,t){if(!i)throw new Error(t||"Assertion failed")}function sd(){let i;if(eh&&"performance"in z0){var t,e;i=z0==null||(t=z0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in Qf){var r;const s=Qf==null||(r=Qf.hrtime)===null||r===void 0?void 0:r.call(Qf);i=s[0]*1e3+s[1]/1e6}else i=Date.now();return i}const nd={debug:eh&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},eL={enabled:!0,level:0};function Fa(){}const M2={},L2={once:!0};class x1{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};H(this,"id",void 0),H(this,"VERSION",zA),H(this,"_startTs",sd()),H(this,"_deltaTs",sd()),H(this,"_storage",void 0),H(this,"userData",{}),H(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new $M("__probe-".concat(this.id,"__"),eL),this.timeStamp("".concat(this.id," started")),tL(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((sd()-this._startTs).toPrecision(10))}getDelta(){return Number((sd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){rm(t,e)}warn(t){return this._getLogFunction(0,t,nd.warn,arguments,L2)}error(t){return this._getLogFunction(0,t,nd.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,nd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,nd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var r=arguments.length,s=new Array(r>2?r-2:0),n=2;n<r;n++)s[n-2]=arguments[n];return this._getLogFunction(t,e,nd.debug||nd.info,arguments,L2)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||Fa,r&&[r],{tag:nL(e)}):Fa}image(t){let{logLevel:e,priority:r,image:s,message:n="",scale:c=1}=t;return this._shouldLog(e||r)?eh?sL({image:s,message:n,scale:c}):rL():Fa}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Fa)}group(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const s=B2({logLevel:t,message:e,opts:r}),{collapsed:n}=r;return s.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Fa)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=UA(t)}_getLogFunction(t,e,r,s,n){if(this._shouldLog(t)){n=B2({logLevel:t,message:e,args:s,opts:n}),r=r||n.method,rm(r),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=sd();const c=n.tag||n.message;if(n.once)if(!M2[c])M2[c]=sd();else return Fa;return e=iL(this.id,n.message,n),r.bind(console,e,...n.args)}return Fa}}H(x1,"VERSION",zA);function UA(i){if(!i)return 0;let t;switch(typeof i){case"number":t=i;break;case"object":t=i.logLevel||i.priority||0;break;default:return 0}return rm(Number.isFinite(t)&&t>=0),t}function B2(i){const{logLevel:t,message:e}=i;i.logLevel=UA(t);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&r.unshift(e),i.message=t;break;case"object":Object.assign(i,t);break}typeof i.message=="function"&&(i.message=i.message());const s=typeof i.message;return rm(s==="string"||s==="object"),Object.assign(i,{args:r},i.opts)}function iL(i,t,e){if(typeof t=="string"){const r=e.time?YM(KM(e.total)):"";t=e.time?"".concat(i,": ").concat(r,"  ").concat(t):"".concat(i,": ").concat(t),t=QM(t,e.color,e.background)}return t}function rL(i){return console.warn("removed"),Fa}function sL(i){let{image:t,message:e="",scale:r=1}=i;if(typeof t=="string"){const n=new Image;return n.onload=()=>{const c=U0(n,e,r);console.log(...c)},n.src=t,Fa}const s=t.nodeName||"";if(s.toLowerCase()==="img")return console.log(...U0(t,e,r)),Fa;if(s.toLowerCase()==="canvas"){const n=new Image;return n.onload=()=>console.log(...U0(n,e,r)),n.src=t.toDataURL(),Fa}return Fa}function nL(i){for(const t in i)for(const e in i[t])return e||"untitled";return"empty"}const vr=new x1({id:"deck"}),Eh={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},G0=1,bp=2,V0=3,q0=4,oL=2,aL=i=>({"layer.changeFlag":(t,e,r)=>{i.log(V0,"".concat(t.id," ").concat(e,": "),r[e])()},"layer.initialize":t=>{i.log(G0,"Initializing ".concat(t))()},"layer.update":(t,e)=>{if(e){const r=t.getChangeFlags();i.log(bp,"Updating ".concat(t," because: ").concat(Object.keys(r).filter(s=>r[s]).join(", ")))()}else i.log(q0,"".concat(t," does not need update"))()},"layer.matched":(t,e)=>{e&&i.log(q0,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{i.log(G0,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,e,r)=>{e?i.log(bp,"Composite layer rendered new subLayers ".concat(t),r)():i.log(q0,"Composite layer reused subLayers ".concat(t),r)()},"layerManager.setLayers":(t,e,r)=>{e&&i.log(bp,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(t,e)=>{i.log(V0,"Viewport changed",e)()},"attributeManager.invalidate":(t,e,r)=>{i.log(G0,r?"invalidated attributes ".concat(r," (").concat(e,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{Eh.attributeUpdateMessages.length=0,Eh.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,e)=>{const r=Math.round(Date.now()-Eh.attributeManagerUpdateStart);i.groupCollapsed(bp,"Updated attributes for ".concat(e," instances in ").concat(t.id," in ").concat(r,"ms"))();for(const s of Eh.attributeUpdateMessages)i.log(V0,s)();i.groupEnd(bp)()},"attribute.updateStart":t=>{Eh.attributeUpdateStart=Date.now()},"attribute.allocate":(t,e)=>{const r="".concat(t.id," allocated ").concat(e);Eh.attributeUpdateMessages.push(r)},"attribute.updateEnd":(t,e)=>{const r=Math.round(Date.now()-Eh.attributeUpdateStart),s="".concat(t.id," updated ").concat(e," in ").concat(r,"ms");Eh.attributeUpdateMessages.push(s)},"deckRenderer.renderLayers":(t,e,r)=>{const{pass:s,redrawReason:n,stats:c}=r;for(const l of e){const{totalCount:f,visibleCount:y,compositeCount:x,pickableCount:T}=l,P=f-x-y;i.log(oL,"RENDER #".concat(t.renderCount,"   ").concat(y," (of ").concat(f," layers) to ").concat(s," because ").concat(n,"   (").concat(P," hidden, ").concat(x," composite ").concat(T," pickable)"))(),c&&c.get("Redraw Layers").add(y)}}});var lL={};let sm={};lL.NODE_ENV!=="production"&&(sm=aL(vr));function cL(i){sm=i}function $n(i,t,e,r){vr.level>0&&sm[i]&&sm[i].call(null,t,e,r)}function hL(i){const t=i[0],e=i[i.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const uL={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:hL,parseTextSync:JSON.parse};function dL(){const i="8.9.35",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==i)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(i));return t||(vr.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:vr,_registerLoggers:cL},jI([uL,[NA,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const pL=dL(),mr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(mr,"IDENTITY",{get:()=>(vr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const oc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},o_={common:0,meters:1,pixels:2},R2={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ci=new x1({id:"luma.gl"});function bo(i,t){if(!i)throw new Error(t||"luma.gl: assertion failed.")}const fL="Invalid WebGLRenderingContext",gL="Requires WebGL2";function Cm(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function ir(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function mL(i){return ir(i)?i:null}function Tm(i){return bo(Cm(i),fL),i}function wo(i){return bo(ir(i),gL),i}const Dp={};function yL(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function _L(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function vL(i,t){Dp[i]=!0,t!==void 0&&yL(t)}function bL(i){const t=i.getError;i.getError=function(){let e;do e=t.apply(i),e!==0&&(Dp[e]=!0);while(e!==0);for(e in Dp)if(Dp[e])return delete Dp[e],parseInt(e,10);return 0}}const mf=function i(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const s=new i.VertexAttrib(e);this.attribs[r]=s}this.maxAttrib=0};mf.VertexAttrib=function(i){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};mf.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Du=function(i){const t=this;this.gl=i,bL(i);const e=this.original={getParameter:i.getParameter,enableVertexAttribArray:i.enableVertexAttribArray,disableVertexAttribArray:i.disableVertexAttribArray,bindBuffer:i.bindBuffer,getVertexAttrib:i.getVertexAttrib,vertexAttribPointer:i.vertexAttribPointer};i.getParameter=function(r){return r===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:e.getParameter.apply(this,arguments)},i.enableVertexAttribArray=function(r){const s=t.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,r);const n=s.attribs[r];return n.enabled=!0,e.enableVertexAttribArray.apply(this,arguments)},i.disableVertexAttribArray=function(r){const s=t.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,r);const n=s.attribs[r];return n.enabled=!1,e.disableVertexAttribArray.apply(this,arguments)},i.bindBuffer=function(r,s){switch(r){case 34962:t.currentArrayBuffer=s;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=s;break}return e.bindBuffer.apply(this,arguments)},i.getVertexAttrib=function(r,s){const n=t.currentVertexArrayObject.attribs[r];switch(s){case 34975:return n.buffer;case 34338:return n.enabled;case 34339:return n.size;case 34340:return n.stride;case 34341:return n.type;case 34922:return n.normalized;default:return e.getVertexAttrib.apply(this,arguments)}},i.vertexAttribPointer=function(r,s,n,c,l,f){const y=t.currentVertexArrayObject;y.maxAttrib=Math.max(y.maxAttrib,r);const x=y.attribs[r];return x.buffer=t.currentArrayBuffer,x.size=s,x.type=n,x.normalized=c,x.stride=l,x.offset=f,x.recache(),e.vertexAttribPointer.apply(this,arguments)},i.instrumentExtension&&i.instrumentExtension(this,"OES_vertex_array_object"),i.canvas&&i.canvas.addEventListener("webglcontextrestored",()=>{_L("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};Du.prototype.VERTEX_ARRAY_BINDING_OES=34229;Du.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const i=this.gl;this.maxVertexAttribs=i.getParameter(34921),this.defaultVertexArrayObject=new mf(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Du.prototype.createVertexArrayOES=function(){const i=new mf(this);return this.vertexArrayObjects.push(i),i};Du.prototype.deleteVertexArrayOES=function(i){i.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(i),1),this.currentVertexArrayObject===i&&this.bindVertexArrayOES(null)};Du.prototype.isVertexArrayOES=function(i){return!!(i&&i instanceof mf&&i.hasBeenBound&&i.ext===this)};Du.prototype.bindVertexArrayOES=function(i){const t=this.gl;if(i&&!i.isAlive){vL(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const e=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=i||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&e.bindBuffer.call(t,34963,s.elementArrayBuffer);let n=this.currentArrayBuffer;const c=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=c;l++){const f=s.attribs[l],y=r?r.attribs[l]:null;if((!r||f.enabled!==y.enabled)&&(f.enabled?e.enableVertexAttribArray.call(t,l):e.disableVertexAttribArray.call(t,l)),f.enabled){let x=!1;(!r||f.buffer!==y.buffer)&&(n!==f.buffer&&(e.bindBuffer.call(t,34962,f.buffer),n=f.buffer),x=!0),(x||f.cached!==y.cached)&&e.vertexAttribPointer.call(t,l,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==n&&e.bindBuffer.call(t,34962,this.currentArrayBuffer)};function wL(i){if(typeof i.createVertexArray=="function")return;const t=i.getSupportedExtensions;i.getSupportedExtensions=function(){const r=t.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const e=i.getExtension;i.getExtension=function(r){return e.call(this,r)||(r!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Du(this)),this.__OESVertexArrayObject))}}const k2="OES_element_index",O2="WEBGL_draw_buffers",xL="EXT_disjoint_timer_query",AL="EXT_disjoint_timer_query_webgl2",SL="EXT_texture_filter_anisotropic",D2="WEBGL_debug_renderer_info",EL=35723,CL=4352,TL=36795,PL=34047,IL=37445,ML=37446,es=i=>ir(i)?void 0:0,LL={3074:i=>ir(i)?void 0:36064,[EL]:i=>ir(i)?void 0:CL,35977:es,32937:es,[TL]:(i,t)=>{const e=ir(i)?i.getExtension(AL):i.getExtension(xL);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[IL]:(i,t)=>{const e=i.getExtension(D2);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[ML]:(i,t)=>{const e=i.getExtension(D2);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[PL]:(i,t)=>{const e=i.luma.extensions[SL];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:es,35071:es,37447:es,36063:(i,t)=>{if(!ir(i)){const e=i.getExtension(O2);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:es,35374:es,35377:es,34852:i=>{if(!ir(i)){const t=i.getExtension(O2);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:i=>i.getExtension(k2)?2147483647:65535,33001:i=>i.getExtension(k2)?16777216:65535,33e3:i=>16777216,37157:es,35373:es,35657:es,36183:es,37137:es,34045:es,35978:es,35979:es,35968:es,35376:es,35375:es,35659:es,37154:es,35371:es,35658:es,35076:es,35077:es,35380:es};function BL(i,t,e){const r=LL[e],s=typeof r=="function"?r(i,t,e):r;return s!==void 0?s:t(e)}const RL="OES_vertex_array_object",GA="ANGLE_instanced_arrays",kL="WEBGL_draw_buffers",OL="EXT_disjoint_timer_query",DL="EXT_texture_filter_anisotropic",NL="VertexArray requires WebGL2 or OES_vertex_array_object extension";function FL(i,t){return{webgl2:ir(i),ext:i.getExtension(t)}}const VA={[RL]:{meta:{suffix:"OES"},createVertexArray:()=>{bo(!1,NL)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[GA]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,t){bo(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[kL]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{bo(!1)}},[OL]:{meta:{suffix:"EXT"},createQuery:()=>{bo(!1)},deleteQuery:()=>{bo(!1)},beginQuery:()=>{bo(!1)},endQuery:()=>{},getQuery(i,t){return this.getQueryObject(i,t)},getQueryParameter(i,t){return this.getQueryObject(i,t)},getQueryObject:()=>{}}},H0={readBuffer:(i,t,e)=>{ir(i)&&t(e)},getVertexAttrib:(i,t,e,r)=>{const{webgl2:s,ext:n}=FL(i,GA);let c;switch(r){case 35069:c=s?void 0:!1;break;case 35070:c=!s&&!n?0:void 0;break}return c!==void 0?c:t(e,r)},getProgramParameter:(i,t,e,r)=>{if(!ir(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,r)},getInternalformatParameter:(i,t,e,r,s)=>{if(!ir(i))switch(s){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(e,r,s)},getTexParameter(i,t,e,r){switch(r){case 34046:const{extensions:s}=i.luma,n=s[DL];r=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,r)},getParameter:BL,hint(i,t,e,r){return t(e,r)}};function zL(i){i.luma=i.luma||{};const{luma:t}=i;return t.polyfilled||(wL(i),jL(i),VL(i,VA),UL(i,{target:t,target2:i}),t.polyfilled=!0),i}globalThis.polyfillContext=zL;function jL(i){i.luma.extensions={};const t=i.getSupportedExtensions()||[];for(const e of t)i.luma[e]=i.getExtension(e)}function UL(i,t){let{target:e,target2:r}=t;Object.keys(H0).forEach(s=>{if(typeof H0[s]=="function"){const n=i[s]?i[s].bind(i):()=>{},c=H0[s].bind(null,i,n);e[s]=c,r[s]=c}})}function VL(i,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&qL(i,{extension:e,target:i.luma,target2:i})}function qL(i,t){let{extension:e,target:r,target2:s}=t;const n=VA[e];bo(n);const{meta:c={}}=n,{suffix:l=""}=c,f=i.getExtension(e);for(const y of Object.keys(n)){const x="".concat(y).concat(l);let T=null;y==="meta"||typeof i[y]=="function"||(f&&typeof f[x]=="function"?T=function(){return f[x](...arguments)}:typeof n[y]=="function"&&(T=n[y].bind(r))),T&&(r[y]=T,s[y]=T)}}const A1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ch=(i,t,e)=>t?i.enable(e):i.disable(e),N2=(i,t,e)=>i.hint(e,t),ia=(i,t,e)=>i.pixelStorei(e,t),HL=(i,t)=>{const e=ir(i)?36009:36160;return i.bindFramebuffer(e,t)},WL=(i,t)=>i.bindFramebuffer(36008,t);function wp(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const JL={3042:Ch,32773:(i,t)=>i.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,t)=>i.clearColor(...t),3107:(i,t)=>i.colorMask(...t),2884:Ch,2885:(i,t)=>i.cullFace(t),2929:Ch,2931:(i,t)=>i.clearDepth(t),2932:(i,t)=>i.depthFunc(t),2928:(i,t)=>i.depthRange(...t),2930:(i,t)=>i.depthMask(t),3024:Ch,35723:N2,36006:HL,2886:(i,t)=>i.frontFace(t),33170:N2,2849:(i,t)=>i.lineWidth(t),32823:Ch,32824:"polygonOffset",10752:"polygonOffset",35977:Ch,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ch,3088:(i,t)=>i.scissor(...t),2960:Ch,2961:(i,t)=>i.clearStencil(t),2968:(i,t)=>i.stencilMaskSeparate(1028,t),36005:(i,t)=>i.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,t)=>i.viewport(...t),3333:ia,3317:ia,37440:ia,37441:ia,37443:ia,3330:ia,3332:ia,3331:ia,36010:WL,3314:ia,32878:ia,3316:ia,3315:ia,32877:ia,framebuffer:(i,t)=>{const e=t&&"handle"in t?t.handle:t;return i.bindFramebuffer(36160,e)},blend:(i,t)=>t?i.enable(3042):i.disable(3042),blendColor:(i,t)=>i.blendColor(...t),blendEquation:(i,t)=>{t=wp(t)?t:[t,t],i.blendEquationSeparate(...t)},blendFunc:(i,t)=>{t=wp(t)&&t.length===2?[...t,...t]:t,i.blendFuncSeparate(...t)},clearColor:(i,t)=>i.clearColor(...t),clearDepth:(i,t)=>i.clearDepth(t),clearStencil:(i,t)=>i.clearStencil(t),colorMask:(i,t)=>i.colorMask(...t),cull:(i,t)=>t?i.enable(2884):i.disable(2884),cullFace:(i,t)=>i.cullFace(t),depthTest:(i,t)=>t?i.enable(2929):i.disable(2929),depthFunc:(i,t)=>i.depthFunc(t),depthMask:(i,t)=>i.depthMask(t),depthRange:(i,t)=>i.depthRange(...t),dither:(i,t)=>t?i.enable(3024):i.disable(3024),derivativeHint:(i,t)=>{i.hint(35723,t)},frontFace:(i,t)=>i.frontFace(t),mipmapHint:(i,t)=>i.hint(33170,t),lineWidth:(i,t)=>i.lineWidth(t),polygonOffsetFill:(i,t)=>t?i.enable(32823):i.disable(32823),polygonOffset:(i,t)=>i.polygonOffset(...t),sampleCoverage:(i,t)=>i.sampleCoverage(...t),scissorTest:(i,t)=>t?i.enable(3089):i.disable(3089),scissor:(i,t)=>i.scissor(...t),stencilTest:(i,t)=>t?i.enable(2960):i.disable(2960),stencilMask:(i,t)=>{t=wp(t)?t:[t,t];const[e,r]=t;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,t)=>{t=wp(t)&&t.length===3?[...t,...t]:t;const[e,r,s,n,c,l]=t;i.stencilFuncSeparate(1028,e,r,s),i.stencilFuncSeparate(1029,n,c,l)},stencilOp:(i,t)=>{t=wp(t)&&t.length===3?[...t,...t]:t;const[e,r,s,n,c,l]=t;i.stencilOpSeparate(1028,e,r,s),i.stencilOpSeparate(1029,n,c,l)},viewport:(i,t)=>i.viewport(...t)};function Is(i,t,e){return t[i]!==void 0?t[i]:e[i]}const ZL={blendEquation:(i,t,e)=>i.blendEquationSeparate(Is(32777,t,e),Is(34877,t,e)),blendFunc:(i,t,e)=>i.blendFuncSeparate(Is(32969,t,e),Is(32968,t,e),Is(32971,t,e),Is(32970,t,e)),polygonOffset:(i,t,e)=>i.polygonOffset(Is(32824,t,e),Is(10752,t,e)),sampleCoverage:(i,t,e)=>i.sampleCoverage(Is(32938,t,e),Is(32939,t,e)),stencilFuncFront:(i,t,e)=>i.stencilFuncSeparate(1028,Is(2962,t,e),Is(2967,t,e),Is(2963,t,e)),stencilFuncBack:(i,t,e)=>i.stencilFuncSeparate(1029,Is(34816,t,e),Is(36003,t,e),Is(36004,t,e)),stencilOpFront:(i,t,e)=>i.stencilOpSeparate(1028,Is(2964,t,e),Is(2965,t,e),Is(2966,t,e)),stencilOpBack:(i,t,e)=>i.stencilOpSeparate(1029,Is(34817,t,e),Is(34818,t,e),Is(34819,t,e))},F2={enable:(i,t)=>i({[t]:!0}),disable:(i,t)=>i({[t]:!1}),pixelStorei:(i,t,e)=>i({[t]:e}),hint:(i,t,e)=>i({[t]:e}),bindFramebuffer:(i,t,e)=>{switch(t){case 36160:return i({36006:e,36010:e});case 36009:return i({36006:e});case 36008:return i({36010:e});default:return null}},blendColor:(i,t,e,r,s)=>i({32773:new Float32Array([t,e,r,s])}),blendEquation:(i,t)=>i({32777:t,34877:t}),blendEquationSeparate:(i,t,e)=>i({32777:t,34877:e}),blendFunc:(i,t,e)=>i({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(i,t,e,r,s)=>i({32969:t,32968:e,32971:r,32970:s}),clearColor:(i,t,e,r,s)=>i({3106:new Float32Array([t,e,r,s])}),clearDepth:(i,t)=>i({2931:t}),clearStencil:(i,t)=>i({2961:t}),colorMask:(i,t,e,r,s)=>i({3107:[t,e,r,s]}),cullFace:(i,t)=>i({2885:t}),depthFunc:(i,t)=>i({2932:t}),depthRange:(i,t,e)=>i({2928:new Float32Array([t,e])}),depthMask:(i,t)=>i({2930:t}),frontFace:(i,t)=>i({2886:t}),lineWidth:(i,t)=>i({2849:t}),polygonOffset:(i,t,e)=>i({32824:t,10752:e}),sampleCoverage:(i,t,e)=>i({32938:t,32939:e}),scissor:(i,t,e,r,s)=>i({3088:new Int32Array([t,e,r,s])}),stencilMask:(i,t)=>i({2968:t,36005:t}),stencilMaskSeparate:(i,t,e)=>i({[t===1028?2968:36005]:e}),stencilFunc:(i,t,e,r)=>i({2962:t,2967:e,2963:r,34816:t,36003:e,36004:r}),stencilFuncSeparate:(i,t,e,r,s)=>i({[t===1028?2962:34816]:e,[t===1028?2967:36003]:r,[t===1028?2963:36004]:s}),stencilOp:(i,t,e,r)=>i({2964:t,2965:e,2966:r,34817:t,34818:e,34819:r}),stencilOpSeparate:(i,t,e,r,s)=>i({[t===1028?2964:34817]:e,[t===1028?2965:34818]:r,[t===1028?2966:34819]:s}),viewport:(i,t,e,r,s)=>i({2978:[t,e,r,s]})},Ql=(i,t)=>i.isEnabled(t),z2={3042:Ql,2884:Ql,2929:Ql,3024:Ql,32823:Ql,32926:Ql,32928:Ql,3089:Ql,2960:Ql,35977:Ql};function qA(i){for(const t in i)return!1;return!0}function XL(i,t){if(i===t)return!0;const e=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&r&&i.length===t.length){for(let s=0;s<i.length;++s)if(i[s]!==t[s])return!1;return!0}return!1}function j2(i,t){const e=i[t].bind(i);i[t]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in i.state.cache?i.state.enable?i.state.cache[r]:e(...arguments):e(...arguments)},Object.defineProperty(i[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function $L(i,t,e){const r=i[t].bind(i);i[t]=function(){for(var s=arguments.length,n=new Array(s),c=0;c<s;c++)n[c]=arguments[c];const{valueChanged:l,oldValue:f}=e(i.state._updateCache,...n);return l&&r(...n),f},Object.defineProperty(i[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function KL(i){const t=i.useProgram.bind(i);i.useProgram=function(e){i.state.program!==e&&(t(e),i.state.program=e)}}class YL{constructor(t){let{copyState:e=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?t4(t):Object.assign({},A1),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){bo(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Yc(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,r;const s=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const n in t){bo(n!==void 0);const c=t[n],l=this.cache[n];XL(c,l)||(e=!0,r=l,s&&!(n in s)&&(s[n]=l),this.cache[n]=c)}return{valueChanged:e,oldValue:r}}}function HA(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:r}=t;if(bo(r!==void 0),!i.state){const{polyfillContext:s}=globalThis;s&&s(i),i.state=new YL(i,{copyState:r}),KL(i);for(const n in F2){const c=F2[n];$L(i,n,c)}j2(i,"getParameter"),j2(i,"isEnabled")}return i.state.enable=e,i}function QL(i){i.state||HA(i,{copyState:!1}),i.state.push()}function U2(i){bo(i.state),i.state.pop()}function Yc(i,t){if(bo(Cm(i),"setParameters requires a WebGL context"),qA(t))return;const e={};for(const s in t){const n=Number(s),c=JL[s];c&&(typeof c=="string"?e[c]=!0:c(i,t[s],n))}const r=i.state&&i.state.cache;if(r)for(const s in e){const n=ZL[s];n(i,t,r)}}function t4(i,t){if(t=t||A1,typeof t=="number"){const s=t,n=z2[s];return n?n(i,s):i.getParameter(s)}const e=Array.isArray(t)?t:Object.keys(t),r={};for(const s of e){const n=z2[s];r[s]=n?n(i,Number(s)):i.getParameter(Number(s))}return r}function e4(i){Yc(i,A1)}function Pl(i,t,e){if(qA(t))return e(i);const{nocatch:r=!0}=t;QL(i),Yc(i,t);let s;if(r)s=e(i),U2(i);else try{s=e(i)}finally{U2(i)}return s}function Dd(i){const{luma:t}=i;if(i.canvas&&t){const e=t.canvasSizeInfo,r="clientWidth"in e?e.clientWidth:i.canvas.clientWidth;return r?i.drawingBufferWidth/r:1}return 1}function W0(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=Dd(i),s=i.drawingBufferWidth,n=i.drawingBufferHeight;return r4(t,r,s,n,e)}function i4(i){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?t:1}function r4(i,t,e,r,s){const n=G2(i[0],t,e);let c=V2(i[1],t,r,s),l=G2(i[0]+1,t,e);const f=l===e-1?l:l-1;l=V2(i[1]+1,t,r,s);let y;return s?(l=l===0?l:l+1,y=c,c=l):y=l===r-1?l:l-1,{x:n,y:c,width:Math.max(f-n+1,1),height:Math.max(y-c+1,1)}}function G2(i,t,e){return Math.min(Math.round(i*t),e-1)}function V2(i,t,e,r){return r?Math.max(0,e-1-Math.round(i*t)):Math.min(Math.round(i*t),e-1)}const S1=eh(),s4=S1&&typeof document<"u",WA={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function JA(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};bo(S1,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},WA,i);const{width:t,height:e}=i;function r(l){if(i.throwOnError)throw new Error(l);return console.error(l),null}i.onError=r;let s;const{canvas:n}=i,c=l4({canvas:n,width:t,height:e,onError:r});return s=a4(c,i),s?(s=E1(s,i),c4(s),s):null}function E1(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||h4(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},t=Object.assign({},WA,t);const{manageState:e,debug:r}=t;return e&&HA(i,{copyState:!1,log:function(){for(var s=arguments.length,n=new Array(s),c=0;c<s;c++)n[c]=arguments[c];return ci.log(1,...n)()}}),S1&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,t),ci.level=Math.max(ci.level,1)):ci.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function n4(i){const t=i.getParameter(7936),e=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),s=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),n=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:s||t,renderer:n||e,vendorMasked:t,rendererMasked:e,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function o4(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=i4(t.useDevicePixels);u4(i,r,t);return}const e=i.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function a4(i,t){const{onError:e}=t;let r=null;const s=f=>r=f.statusMessage||r;i.addEventListener("webglcontextcreationerror",s,!1);const{webgl1:n=!0,webgl2:c=!0}=t;let l=null;return c&&(l=l||i.getContext("webgl2",t),l=l||i.getContext("experimental-webgl2",t)),n&&(l=l||i.getContext("webgl",t),l=l||i.getContext("experimental-webgl",t)),i.removeEventListener("webglcontextcreationerror",s,!1),l?(t.onContextLost&&i.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&i.addEventListener("webglcontextrestored",t.onContextRestored,!1),l):e("Failed to create ".concat(c&&!n?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function l4(i){let{canvas:t,width:e=800,height:r=600,onError:s}=i,n;return typeof t=="string"?(s4&&document.readyState==="complete"||s("createGLContext called on canvas '".concat(t,"' before page was loaded")),n=document.getElementById(t)):t?n=t:(n=document.createElement("canvas"),n.id="lumagl-canvas",n.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",n.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(n,document.body.firstChild)),n}function c4(i){const t=ir(i)?"WebGL2":"WebGL1",e=n4(i),r=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",s=i.debug?" debug":"";ci.info(1,"".concat(t).concat(s," context ").concat(r))()}function h4(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function u4(i,t,e){let r="width"in e?e.width:i.canvas.clientWidth,s="height"in e?e.height:i.canvas.clientHeight;(!r||!s)&&(ci.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,r=i.canvas.width||1,s=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const n=i.luma.canvasSizeInfo;if(n.clientWidth!==r||n.clientHeight!==s||n.devicePixelRatio!==t){let c=t;const l=Math.floor(r*c),f=Math.floor(s*c);i.canvas.width=l,i.canvas.height=f,(i.drawingBufferWidth!==l||i.drawingBufferHeight!==f)&&(ci.warn("Device pixel ratio clamped")(),c=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/s),i.canvas.width=Math.floor(r*c),i.canvas.height=Math.floor(s*c)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:s,devicePixelRatio:t})}}function q2(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}let H2=class{constructor(i,t){H(this,"name",void 0),H(this,"type",void 0),H(this,"sampleSize",1),H(this,"time",void 0),H(this,"count",void 0),H(this,"samples",void 0),H(this,"lastTiming",void 0),H(this,"lastSampleTime",void 0),H(this,"lastSampleCount",void 0),H(this,"_count",0),H(this,"_time",0),H(this,"_samples",0),H(this,"_startTime",0),H(this,"_timerPending",!1),this.name=i,this.type=t,this.reset()}setSampleSize(i){return this.sampleSize=i,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(i){return this._count+=i,this._samples++,this._checkSampling(),this}subtractCount(i){return this._count-=i,this._samples++,this._checkSampling(),this}addTime(i){return this._time+=i,this.lastTiming=i,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=q2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(q2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},C1=class{constructor(i){H(this,"id",void 0),H(this,"stats",{}),this.id=i.id,this.stats={},this._initializeStats(i.stats),Object.seal(this)}get(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:i,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const i in this.stats)this.stats[i].reset();return this}forEach(i){for(const t in this.stats)i(this.stats[t])}getTable(){const i={};return this.forEach(t=>{i[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),i}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(i=>this._getOrCreate(i))}_getOrCreate(i){if(!i||!i.name)return null;const{name:t,type:e}=i;return this.stats[t]||(i instanceof H2?this.stats[t]=i:this.stats[t]=new H2(t,e)),this.stats[t]}};const Vp="8.5.21",d4="set luma.log.level=1 (or higher) to trace rendering";class p4{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new C1({id:t})),this.stats.get(t)}}const Au=new p4;if(globalThis.luma&&globalThis.luma.VERSION!==Vp)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Vp));globalThis.luma||(eh()&&ci.log(1,"luma.gl ".concat(Vp," - ").concat(d4))(),globalThis.luma=globalThis.luma||{VERSION:Vp,version:Vp,log:ci,stats:Au,globals:{modules:{},nodeIO:{}}});function f4(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function g4(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function ei(i,t){if(!i)throw new Error(t||"luma.gl: assertion failed.")}function J0(i,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const r=i[t];return ei(r!==void 0,"Accessing undefined constant GL.".concat(t)),r}function jh(i,t){t=Number(t);for(const e in i)if(i[e]===t)return"GL.".concat(e);return String(t)}const Z0={};function Qc(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Z0[i]=Z0[i]||1;const t=Z0[i]++;return"".concat(i,"-").concat(t)}function W2(i){return ei(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function Nd(i){let t=!0;for(const e in i){t=!1;break}return t}function ZA(i,t,e,r){const s="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),n=Object.getPrototypeOf(i);r.forEach(c=>{n.methodName||(n[c]=()=>{throw ci.removed("Calling removed method ".concat(t,".").concat(c,": "),s)(),new Error(c)})})}const od="Resource subclass must define virtual methods";let ih=class{get[Symbol.toStringTag](){return"Resource"}constructor(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tm(i);const{id:e,userData:r={}}=t;this.gl=i,this.gl2=i,this.id=e||Qc(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:i=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&i&&t.filter(Boolean).forEach(e=>e.delete()),this}bind(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof i!="function")return this._bindHandle(i),this;let t;return this._bound?t=i():(this._bindHandle(this.handle),this._bound=!0,t=i(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};i=J0(this.gl,i),ei(i);const e=(this.constructor.PARAMETERS||{})[i];if(e){const r=ir(this.gl);if(!((!("webgl2"in e)||r)&&(!("extension"in e)||this.gl.getExtension(e.extension)))){const s=e.webgl1,n="webgl2"in e?e.webgl2:e.webgl1;return r?n:s}}return this._getParameter(i,t)}getParameters(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:e}=i,r=this.constructor.PARAMETERS||{},s=ir(this.gl),n={},c=t||Object.keys(r);for(const l of c){const f=r[l];if(f&&(!("webgl2"in f)||s)&&(!("extension"in f)||this.gl.getExtension(f.extension))){const y=e?jh(this.gl,l):l;n[y]=this.getParameter(l,i),e&&f.type==="GLenum"&&(n[y]=jh(this.gl,n[y]))}}return n}setParameter(i,t){i=J0(this.gl,i),ei(i);const e=(this.constructor.PARAMETERS||{})[i];if(e){const r=ir(this.gl);if(!((!("webgl2"in e)||r)&&(!("extension"in e)||this.gl.getExtension(e.extension))))throw new Error("Parameter not available on this platform");e.type==="GLenum"&&(t=J0(t))}return this._setParameter(i,t),this}setParameters(i){for(const t in i)this.setParameter(t,i[t]);return this}stubRemovedMethods(i,t,e){return ZA(this,i,t,e)}initialize(i){}_createHandle(){throw new Error(od)}_deleteHandle(){throw new Error(od)}_bindHandle(i){throw new Error(od)}_getOptsFromHandle(){throw new Error(od)}_getParameter(i,t){throw new Error(od)}_setParameter(i,t){throw new Error(od)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const i=this[Symbol.toStringTag],t=Au.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(i,"s Created")).incrementCount(),t.get("".concat(i,"s Active")).incrementCount()}_removeStats(){const i=this[Symbol.toStringTag];Au.get("Resource Counts").get("".concat(i,"s Active")).decrementCount()}_trackAllocatedMemory(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(i,t),this._trackAllocatedMemoryForContext(i,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=i}_trackAllocatedMemoryForContext(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=Au.get("Memory Usage".concat(e));r.get("GPU Memory").addCount(i),r.get("".concat(t," Memory")).addCount(i)}_trackDeallocatedMemory(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(i),this._trackDeallocatedMemoryForContext(i,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const e=Au.get("Memory Usage".concat(t));e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(i," Memory")).subtractCount(this.byteLength)}};const m4="Failed to deduce GL constant from typed array";function a_(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(m4)}}function Kp(i){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function y4(i){let{data:t,width:e,height:r,bytesPerPixel:s=4,temp:n}=i;const c=e*s;n=n||new Uint8Array(c);for(let l=0;l<r/2;++l){const f=l*c,y=(r-l-1)*c;n.set(t.subarray(f,f+c)),t.copyWithin(f,y,y+c),t.set(n,y)}}function _4(i){let{data:t,width:e,height:r}=i;const s=Math.round(e/2),n=Math.round(r/2),c=new Uint8Array(s*n*4);for(let l=0;l<n;l++)for(let f=0;f<s;f++)for(let y=0;y<4;y++)c[(l*s+f)*4+y]=t[(l*2*e+f*2)*4+y];return{data:c,width:s,height:n}}function l_(i,t,e){const{removedProps:r={},deprecatedProps:s={},replacedProps:n={}}=e;for(const l in r)if(l in t){const f=r[l]?"".concat(i,".").concat(r[l]):"N/A";ci.removed("".concat(i,".").concat(l),f)()}for(const l in s)if(l in t){const f=s[l];ci.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(f))()}let c=null;for(const l in n)if(l in t){const f=n[l];ci.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(f))(),c=c||Object.assign({},t),c[f]=t[l],delete c[l]}return c||t}const v4={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},b4={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Fo{static getBytesPerElement(t){return Kp(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return ei(t.size),Kp(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new Fo(v4,...e)}constructor(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(s=>this._assign(s)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Fo.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Fo.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=l_("Accessor",t,b4),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const J2=10,XA={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},w4={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:XA},x4={removedProps:XA};let Wr=class extends ih{get[Symbol.toStringTag](){return"Buffer"}constructor(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(i,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Fo.getBytesPerElement(i))}getVertexCount(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Fo.getBytesPerVertex(i))}initialize(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(i)&&(i={data:i}),Number.isFinite(i)&&(i={byteLength:i}),i=l_("Buffer",i,w4),this.usage=i.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},i,i.accessor)),i.data?this._setData(i.data,i.offset,i.byteLength):this._setByteLength(i.byteLength||0),this}setProps(i){return i=l_("Buffer",i,x4),"accessor"in i&&this.setAccessor(i.accessor),this}setAccessor(i){return i=Object.assign({},i),delete i.buffer,this.accessor=new Fo(i),this}reallocate(i){return i>this.byteLength?(this._setByteLength(i),!0):(this.bytesUsed=i,!1)}setData(i){return this.initialize(i)}subData(i){ArrayBuffer.isView(i)&&(i={data:i});const{data:t,offset:e=0,srcOffset:r=0}=i,s=i.byteLength||i.length;ei(t);const n=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(n,this.handle),r!==0||s!==void 0?(wo(this.gl),this.gl.bufferSubData(this.target,e,t,r,s)):this.gl.bufferSubData(n,e,t),this.gl.bindBuffer(n,null),this.debugData=null,this._inferType(t),this}copyData(i){let{sourceBuffer:t,readOffset:e=0,writeOffset:r=0,size:s}=i;const{gl:n}=this;return wo(n),n.bindBuffer(36662,t.handle),n.bindBuffer(36663,this.handle),n.copyBufferSubData(36662,36663,e,r,s),n.bindBuffer(36662,null),n.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:i=null,srcByteOffset:t=0,dstOffset:e=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};wo(this.gl);const s=Kp(this.accessor.type||5126,{clamped:!1}),n=this._getAvailableElementCount(t),c=e;let l,f;i?(f=i.length,l=f-c):(l=Math.min(n,r||n),f=c+l);const y=Math.min(n,l);return r=r||y,ei(r<=y),i=i||new s(f),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,e,r),this.gl.bindBuffer(36662,null),i}bind(){let{target:i=this.target,index:t=this.accessor&&this.accessor.index,offset:e=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i===35345||i===35982?r!==void 0?this.gl.bindBufferRange(i,t,this.handle,e,r):(ei(e===0),this.gl.bindBufferBase(i,t,this.handle)):this.gl.bindBuffer(i,this.handle),this}unbind(){let{target:i=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i===35345||i===35982?this.gl.bindBufferBase(i,t,null):this.gl.bindBuffer(i,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(J2,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i.byteLength+t;ei(ArrayBuffer.isView(i)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,e,this.usage),this.gl.bufferSubData(r,t,i),this.gl.bindBuffer(r,null),this.debugData=i.slice(0,J2),this.bytesUsed=e,this._trackAllocatedMemory(e);const s=a_(i);return ei(s),this.setAccessor(new Fo(this.accessor,{type:s})),this}_setByteLength(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ei(i>=0),this._trackDeallocatedMemory();let e=i;i===0&&(e=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,e,t),this.gl.bindBuffer(r,null),this.usage=t,this.debugData=null,this.bytesUsed=i,this._trackAllocatedMemory(i),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(i){const t=Kp(this.accessor.type||5126,{clamped:!1}),e=i/t.BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(i){this.accessor.type||this.setAccessor(new Fo(this.accessor,{type:a_(i)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(i){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,i);return this.gl.bindBuffer(this.target,null),t}get type(){return ci.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return ci.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(i){return ci.deprecated("setByteLength","reallocate")(),this.reallocate(i)}updateAccessor(i){return ci.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Fo(this.accessor,i),this}};const T1={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},$A={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},KA={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function A4(i,t){const e=T1[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const r=ir(i)&&e.gl2||e.gl1;return typeof r=="string"?i.getExtension(r):r}function S4(i,t){const e=T1[t];switch(e&&e.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const E4=[9729,9728],Z2=globalThis.WebGLBuffer||function(){};class Fd extends ih{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:s}=e;let n=!0;return r&&(n=n&&A4(t,r),n=n&&(!s||S4(t,r))),n}constructor(t,e){const{id:r=Qc("texture"),handle:s,target:n}=e;super(t,{id:r,handle:s}),this.target=n,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then($=>this.initialize(Object.assign({},t,{pixels:$,data:$}))),this;const r=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(r&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:s=null,format:n=6408,border:c=0,recreate:l=!1,parameters:f={},pixelStore:y={},textureUnit:x=void 0}=t;e||(e=s);let{width:T,height:P,dataFormat:M,type:N,compressed:G=!1,mipmaps:Z=!0}=t;const{depth:X=0}=t;return{width:T,height:P,compressed:G,dataFormat:M,type:N}=this._deduceParameters({format:n,type:N,dataFormat:M,compressed:G,data:e,width:T,height:P}),this.width=T,this.height=P,this.depth=X,this.format=n,this.type=N,this.dataFormat=M,this.border=c,this.textureUnit=x,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),Z&&this._isNPOT()&&(ci.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),Z=!1,this._updateForNPOT(f)),this.mipmaps=Z,this.setImageData({data:e,width:T,height:P,depth:X,format:n,type:N,dataFormat:M,border:c,mipmaps:Z,parameters:y,compressed:G}),Z&&this.generateMipmap(),this.setParameters(f),l&&(this.data=e),r&&(this._video={video:e,parameters:f,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:r}=this._video;if(r===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:r,mipmaps:s=!1}=t;return r!==this.width||e!==this.height?this.initialize({width:r,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:s}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(ci.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Pl(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:r=null,level:s=0,format:n=this.format,border:c=this.border,offset:l=0,parameters:f={}}=t;let{data:y=null,type:x=this.type,width:T=this.width,height:P=this.height,dataFormat:M=this.dataFormat,compressed:N=!1}=t;y||(y=r),{type:x,dataFormat:M,compressed:N,width:T,height:P}=this._deduceParameters({format:n,type:x,dataFormat:M,compressed:N,data:y,width:T,height:P});const{gl:G}=this;G.bindTexture(this.target,this.handle);let Z=null;({data:y,dataType:Z}=this._getDataType({data:y,compressed:N}));let X,$=0;if(Pl(this.gl,f,()=>{switch(Z){case"null":G.texImage2D(e,s,n,T,P,c,M,x,y);break;case"typed-array":G.texImage2D(e,s,n,T,P,c,M,x,y,l);break;case"buffer":X=wo(G),X.bindBuffer(35052,y.handle||y),X.texImage2D(e,s,n,T,P,c,M,x,l),X.bindBuffer(35052,null);break;case"browser-object":ir(G)?G.texImage2D(e,s,n,T,P,c,M,x,y):G.texImage2D(e,s,n,M,x,y);break;case"compressed":for(const[ct,yt]of y.entries())G.compressedTexImage2D(e,ct,yt.format,yt.width,yt.height,c,yt.data),$+=yt.levelSize;break;default:ei(!1,"Unknown image data type")}}),Z==="compressed")this._trackAllocatedMemory($,"Texture");else if(y&&y.byteLength)this._trackAllocatedMemory(y.byteLength,"Texture");else{const ct=$A[this.dataFormat]||4,yt=KA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*ct*yt,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:r=null,data:s=null,x:n=0,y:c=0,width:l=this.width,height:f=this.height,level:y=0,format:x=this.format,type:T=this.type,dataFormat:P=this.dataFormat,compressed:M=!1,offset:N=0,border:G=this.border,parameters:Z={}}=t;if({type:T,dataFormat:P,compressed:M,width:l,height:f}=this._deduceParameters({format:x,type:T,dataFormat:P,compressed:M,data:s,width:l,height:f}),ei(this.depth===0,"texSubImage not supported for 3D textures"),s||(s=r),s&&s.data){const X=s;s=X.data,l=X.shape[0],f=X.shape[1]}s instanceof Wr&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Pl(this.gl,Z,()=>{if(M)this.gl.compressedTexSubImage2D(e,y,n,c,l,f,x,s);else if(s===null)this.gl.texSubImage2D(e,y,n,c,l,f,P,T,null);else if(ArrayBuffer.isView(s))this.gl.texSubImage2D(e,y,n,c,l,f,P,T,s,N);else if(s instanceof Z2){const X=wo(this.gl);X.bindBuffer(35052,s),X.texSubImage2D(e,y,n,c,l,f,P,T,N),X.bindBuffer(35052,null)}else ir(this.gl)?wo(this.gl).texSubImage2D(e,y,n,c,l,f,P,T,s):this.gl.texSubImage2D(e,y,n,c,P,T,s)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return ci.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:r=!1}=t;return r?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Wr?{data:e.handle,dataType:"buffer"}:e instanceof Z2?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:r}=t;let{width:s,height:n,dataFormat:c,type:l,compressed:f}=t;const y=T1[e];return c=c||y&&y.dataFormat,l=l||y&&y.types[0],f=f||y&&y.compressed,{width:s,height:n}=this._deduceImageSize(r,s,n),{dataFormat:c,type:l,compressed:f,width:s,height:n,format:e,data:r}}_deduceImageSize(t,e,r){let s;return typeof ImageData<"u"&&t instanceof ImageData?s={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?s={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?s={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?s={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?s={width:t.videoWidth,height:t.videoHeight}:t?s={width:e,height:r}:s={width:e>=0?e:1,height:r>=0?r:1},ei(s,"Could not deduced texture size"),ei(e===void 0||s.width===e,"Deduced texture width does not match supplied width"),ei(r===void 0||s.height===r,"Deduced texture height does not match supplied height"),s}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:ei(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return ir(this.gl)||!this.width||!this.height?!1:!W2(this.width)||!W2(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:E4.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let C4="";function T4(i,t){return ei(typeof i=="string"),i=C4+i,new Promise((e,r)=>{try{const s=new Image;s.onload=()=>e(s),s.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),s.crossOrigin=t&&t.crossOrigin||"anonymous",s.src=i}catch(s){r(s)}})}class ua extends Fd{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return Fd.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tm(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:T4(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const c_=[34069,34070,34071,34072,34073,34074];class YA extends Fd{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tm(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:r={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(r)}),this}subImage(t){let{face:e,data:r,x:s=0,y:n=0,mipmapLevel:c=0}=t;return this._subImage({target:e,data:r,x:s,y:n,mipmapLevel:c})}async setCubeMapImageData(t){let{width:e,height:r,pixels:s,data:n,border:c=0,format:l=6408,type:f=5121}=t;const{gl:y}=this,x=s||n,T=await Promise.all(c_.map(P=>{const M=x[P];return Promise.all(Array.isArray(M)?M:[M])}));this.bind(),c_.forEach((P,M)=>{T[M].length>1&&this.opts.mipmaps!==!1&&ci.warn("".concat(this.id," has mipmap and multiple LODs."))(),T[M].forEach((N,G)=>{e&&r?y.texImage2D(P,G,l,e,r,c,l,f,N):y.texImage2D(P,G,l,l,f,N)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:r,height:s,pixels:n,data:c,border:l=0,format:f=6408,type:y=5121}=t,{gl:x}=this,T=n||c;return this.bind(),T instanceof Promise?T.then(P=>this.setImageDataForFace(Object.assign({},t,{face:e,data:P,pixels:P}))):this.width||this.height?x.texImage2D(e,0,f,r,s,l,f,y,T):x.texImage2D(e,0,f,f,y,T),this}}YA.FACES=c_;class P4 extends Fd{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return ir(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wo(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:r=6408,width:s,height:n,depth:c=1,border:l=0,format:f,type:y=5121,offset:x=0,data:T,parameters:P={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Pl(this.gl,P,()=>{ArrayBuffer.isView(T)&&this.gl.texImage3D(this.target,e,r,s,n,c,l,f,y,T),T instanceof Wr&&(this.gl.bindBuffer(35052,T.handle),this.gl.texImage3D(this.target,e,r,s,n,c,l,f,y,x))}),T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{const M=$A[this.dataFormat]||4,N=KA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*M*N,"Texture")}return this.loaded=!0,this}}const pu="EXT_color_buffer_float",X2={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:pu,bpp:2},33327:{gl2:pu,bpp:4},34842:{gl2:pu,bpp:8},33326:{gl2:pu,bpp:4},33328:{gl2:pu,bpp:8},34836:{gl2:pu,bpp:16},35898:{gl2:pu,bpp:4}};function I4(i,t,e){const r=e[t];if(!r)return!1;const s=ir(i)&&r.gl2||r.gl1;return typeof s=="string"?i.getExtension(s):s}class bd extends ih{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||I4(t,e,X2)}static getSamplesForFormat(t,e){let{format:r}=e;return t.getInternalformatParameter(36161,r,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:r=1,height:s=1,samples:n=0}=t;return ei(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),n!==0&&ir(this.gl)?this.gl.renderbufferStorageMultisample(36161,n,e,r,s):this.gl.renderbufferStorage(36161,e,r,s),this.format=e,this.width=r,this.height=s,this.samples=n,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*X2[this.format].bpp),this}resize(t){let{width:e,height:r}=t;return e!==this.width||r!==this.height?this.initialize({width:e,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const M4=256,L4=1024,B4=16384,$2=6144,K2=6145,Y2=6146,Q2=34041,QA="clear: bad arguments";function P1(i){let{framebuffer:t=null,color:e=null,depth:r=null,stencil:s=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};t&&(n.framebuffer=t);let c=0;e&&(c|=B4,e!==!0&&(n.clearColor=e)),r&&(c|=M4,r!==!0&&(n.clearDepth=r)),s&&(c|=L4,r!==!0&&(n.clearStencil=r)),ei(c!==0,QA),Pl(i,n,()=>{i.clear(c)})}function R4(i){let{framebuffer:t=null,buffer:e=$2,drawBuffer:r=0,value:s=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wo(i),Pl(i,{framebuffer:t},()=>{switch(e){case $2:switch(s.constructor){case Int32Array:i.clearBufferiv(e,r,s);break;case Uint32Array:i.clearBufferuiv(e,r,s);break;case Float32Array:default:i.clearBufferfv(e,r,s)}break;case K2:i.clearBufferfv(K2,0,[s]);break;case Y2:i.clearBufferiv(Y2,0,[s]);break;case Q2:const[n,c]=s;i.clearBufferfi(Q2,0,n,c);break;default:ei(!1,QA)}})}function k4(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ei(!1),0}}function Pm(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:r=0,sourceFormat:s=6408}=t;let{sourceAttachment:n=36064,target:c=null,sourceWidth:l,sourceHeight:f,sourceType:y}=t;const{framebuffer:x,deleteFramebuffer:T}=O4(i);ei(x);const{gl:P,handle:M,attachments:N}=x;l=l||x.width,f=f||x.height,n===36064&&M===null&&(n=1028),ei(N[n]),y=y||N[n].type,c=D4(c,y,s,l,f),y=y||a_(c);const G=P.bindFramebuffer(36160,M);return P.readPixels(e,r,l,f,s,y,c),P.bindFramebuffer(36160,G||null),T&&x.delete(),c}function tw(i){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Pm(i,{sourceAttachment:t}),{width:s,height:n}=i;for(;n>e;)({data:r,width:s,height:n}=_4({data:r,width:s,height:n}));y4({data:r,width:s,height:n});const c=document.createElement("canvas");c.width=s,c.height=n;const l=c.getContext("2d"),f=l.createImageData(s,n);return f.data.set(r),l.putImageData(f,0,0),c.toDataURL()}function O4(i){return i instanceof sn?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:H4(i),deleteFramebuffer:!0}}function D4(i,t,e,r,s){if(i)return i;t=t||5121;const n=Kp(t,{clamped:!1}),c=k4(e);return new n(r*s*c)}const is={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function N4(i){const t=new ua(i,{format:6408,type:5126,dataFormat:6408}),e=new sn(i,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),r=e.getStatus();return t.delete(),e.delete(),r===36053}const t3={[is.WEBGL2]:[!1,!0],[is.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[is.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[is.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[is.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[is.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[is.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[is.FLOAT_BLEND]:["EXT_float_blend"],[is.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[is.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[is.TEXTURE_FLOAT]:["OES_texture_float",!0],[is.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[is.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[is.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[is.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[is.COLOR_ATTACHMENT_RGBA32F]:[N4,"EXT_color_buffer_float"],[is.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[is.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[is.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[is.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[is.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[is.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},F4=2;function I1(i,t){return e3(i,t)}function e3(i,t){return t=Array.isArray(t)?t:[t],t.every(e=>i3(i,e))}function z4(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const t in t3)i.luma.caps[t]===void 0&&(i.luma.caps[t]=i3(i,t));return i.luma.caps}function i3(i,t){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[t]===void 0&&(i.luma.caps[t]=j4(i,t)),i.luma.caps[t]||ci.log(F4,"Feature: ".concat(t," not supported"))(),i.luma.caps[t]}function j4(i,t){const e=t3[t];ei(e,t);let r;const s=ir(i)&&e[1]||e[0];if(typeof s=="function")r=s(i);else if(Array.isArray(s)){r=!0;for(const n of s)r=r&&!!i.getExtension(n)}else typeof s=="string"?r=!!i.getExtension(s):typeof s=="boolean"?r=s:ei(!1);return r}const ew="Multiple render targets not supported";class sn extends ih{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:s}=e;let n=!0;return r&&(n=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),s&&(n=n&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),n}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new sn(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=wo(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=wo(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:r=1,attachments:s=null,color:n=!0,depth:c=!0,stencil:l=!1,check:f=!0,readBuffer:y=void 0,drawBuffers:x=void 0}=t;if(ei(e>=0&&r>=0,"Width and height need to be integers"),this.width=e,this.height=r,s)for(const T in s){const P=s[T];(Array.isArray(P)?P[0]:P).resize({width:e,height:r})}else s=this._createDefaultAttachments(n,c,l,e,r);this.update({clearAttachments:!0,attachments:s,readBuffer:y,drawBuffers:x}),s&&f&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:r,drawBuffers:s,clearAttachments:n=!1,resizeAttachments:c=!0}=t;this.attach(e,{clearAttachments:n,resizeAttachments:c});const{gl:l}=this,f=l.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),s&&this._setDrawBuffers(s),l.bindFramebuffer(36160,f||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:r}=t;if(this.handle===null)return ei(e===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),e!==this.width&&r!==this.height&&ci.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(r))();for(const s in this.attachments)this.attachments[s].resize({width:e,height:r});return this.width=e,this.height=r,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&Object.keys(this.attachments).forEach(c=>{s[c]=null}),Object.assign(s,t);const n=this.gl.bindFramebuffer(36160,this.handle);for(const c in s){ei(c!==void 0,"Misspelled framebuffer binding point?");const l=Number(c),f=s[l];let y=f;if(!y)this._unattach(l);else if(y instanceof bd)this._attachRenderbuffer({attachment:l,renderbuffer:y});else if(Array.isArray(f)){const[x,T=0,P=0]=f;y=x,this._attachTexture({attachment:l,texture:x,layer:T,level:P})}else this._attachTexture({attachment:l,texture:y,layer:0,level:0});r&&y&&y.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,n||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(c=>!this.attachments[c]).forEach(c=>{delete this.attachments[c]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(G4(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),r=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),r}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:r,stencil:s,drawBuffers:n=[]}=t,c=this.gl.bindFramebuffer(36160,this.handle);return(e||r||s)&&P1(this.gl,{color:e,depth:r,stencil:s}),n.forEach((l,f)=>{R4(this.gl,{drawBuffer:f,value:l})}),this.gl.bindFramebuffer(36160,c||null),this}readPixels(){return ci.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return ci.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return ci.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return ci.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return ci.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return ci.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:r=0,y:s=0,width:n,height:c}=t;const l=wo(this.gl),f=l.bindFramebuffer(36008,this.handle);return r===0&&s===0&&n===void 0&&c===void 0?l.invalidateFramebuffer(36008,e):l.invalidateFramebuffer(36008,e,r,s,n,c),l.bindFramebuffer(36008,f),this}getAttachmentParameter(t,e,r){let s=this._getAttachmentParameterFallback(e);return s===null&&(this.gl.bindFramebuffer(36160,this.handle),s=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),r&&s>1e3&&(s=jh(this.gl,s)),s}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const s={};for(const n of r){const c=e?jh(this.gl,n):n;s[c]=this.getAttachmentParameter(t,n,e)}return s}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),r={};for(const s of e){const n=Number(s),c=t?jh(this.gl,n):n;r[c]=this.getAttachmentParameters(n,t)}return r}show(){return typeof window<"u"&&window.open(tw(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>ci.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const r=tw(this,{targetMaxHeight:100});return ci.image({logLevel:t,message:e,image:r},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,r,s,n){let c=null;return t&&(c=c||{},c[36064]=new ua(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:s,height:n,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(c[36064])),e&&r?(c=c||{},c[33306]=new bd(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:s,height:111}),this.ownResources.push(c[33306])):e?(c=c||{},c[36096]=new bd(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:s,height:n}),this.ownResources.push(c[36096])):r&&ei(!1),c}_unattach(t){const e=this.attachments[t];e&&(e instanceof bd?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:r}=t;const{gl:s}=this;s.framebufferRenderbuffer(36160,e,36161,r.handle),this.attachments[e]=r}_attachTexture(t){let{attachment:e=36064,texture:r,layer:s,level:n}=t;const{gl:c}=this;switch(c.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:wo(c).framebufferTextureLayer(36160,e,r.target,n,s);break;case 34067:const l=U4(s);c.framebufferTexture2D(36160,e,l,r.handle,n);break;case 3553:c.framebufferTexture2D(36160,e,3553,r.handle,n);break;default:ei(!1,"Illegal texture type")}c.bindTexture(r.target,null),this.attachments[e]=r}_setReadBuffer(t){const e=mL(this.gl);e?e.readBuffer(t):ei(t===36064||t===1029,ew),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,r=wo(e);if(r)r.drawBuffers(t);else{const s=e.getExtension("WEBGL_draw_buffers");s?s.drawBuffersWEBGL(t):ei(t.length===1&&(t[0]===36064||t[0]===1029),ew)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=z4(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function U4(i){return i<34069?i+34069:i}function G4(i){return(sn.STATUS||{})[i]||"Framebuffer error ".concat(i)}const V4=[36049,36048,33296,33298,33299,33300,33301,33302,33303];sn.ATTACHMENT_PARAMETERS=V4;function q4(i,t){ei(i instanceof ua||i instanceof YA||i instanceof P4);const e=i.constructor,{gl:r,width:s,height:n,format:c,type:l,dataFormat:f,border:y,mipmaps:x}=i,T=Object.assign({width:s,height:n,format:c,type:l,dataFormat:f,border:y,mipmaps:x},t);return new e(r,T)}function H4(i,t){const{gl:e,width:r,height:s,id:n}=i;return new sn(e,Object.assign({},t,{id:"framebuffer-for-".concat(n),width:r,height:s,attachments:{36064:i}}))}function Mg(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(e);return r?r[1]:t}const W4=35632,J4=35633;function Z4(i){switch(i){case W4:return"fragment";case J4:return"vertex";default:return"unknown type"}}function X4(i,t,e,r){const s=i.split(/\r?\n/),n={},c={},l=r||Mg(t)||"(unnamed)",f="".concat(Z4(e)," shader ").concat(l);for(let x=0;x<s.length;x++){const T=s[x];if(T.length<=1)continue;const P=T.split(":"),M=P[0],N=parseInt(P[2],10);if(isNaN(N))throw new Error("GLSL compilation error in ".concat(f,": ").concat(i));M!=="WARNING"?n[N]=T:c[N]=T}const y=$4(t);return{shaderName:f,errors:iw(n,y),warnings:iw(c,y)}}function iw(i,t){let e="";for(let r=0;r<t.length;r++){const s=t[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(e+="".concat(s,`
`),i[r+1])){const n=i[r+1],c=n.split(":",3),l=c[0],f=parseInt(c[1],10)||0,y=n.substring(c.join(":").length+1).trim();e+=r3("^^^ ".concat(l,": ").concat(y,`

`),f)}}return e}function $4(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),s=String(r.length+t-1).length;return r.map((n,c)=>{const l=String(c+t),f=l.length;return r3(l,s-f)+e+n})}function r3(i,t){let e="";for(let r=0;r<t;++r)e+=" ";return"".concat(e).concat(i)}function s3(i){let t=100;const e=i.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const r=parseInt(e[1],10);Number.isFinite(r)&&(t=r)}return t}const K4="Shader: GLSL source code must be a JavaScript string";class Yp extends ih{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ei(!1),"unknown"}}constructor(t,e){Tm(t),ei(typeof e.source=="string",K4);const r=Mg(e.source,null)||e.id||Qc("unnamed ".concat(Yp.getTypeName(e.shaderType)));super(t,{id:r}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const r=Mg(e,null);r&&(this.id=Qc(r)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(Yp.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Mg(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:n}=X4(e,this.source,this.shaderType,this.id);throw ci.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),ci.warn("GLSL compilation warnings in ".concat(r,`
`).concat(n))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class X0 extends Yp{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class $0 extends Yp{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Y4={5126:ls.bind(null,"uniform1fv",ra,1,Hn),35664:ls.bind(null,"uniform2fv",ra,2,Hn),35665:ls.bind(null,"uniform3fv",ra,3,Hn),35666:ls.bind(null,"uniform4fv",ra,4,Hn),5124:ls.bind(null,"uniform1iv",Th,1,Hn),35667:ls.bind(null,"uniform2iv",Th,2,Hn),35668:ls.bind(null,"uniform3iv",Th,3,Hn),35669:ls.bind(null,"uniform4iv",Th,4,Hn),35670:ls.bind(null,"uniform1iv",Th,1,Hn),35671:ls.bind(null,"uniform2iv",Th,2,Hn),35672:ls.bind(null,"uniform3iv",Th,3,Hn),35673:ls.bind(null,"uniform4iv",Th,4,Hn),35674:ls.bind(null,"uniformMatrix2fv",ra,4,zc),35675:ls.bind(null,"uniformMatrix3fv",ra,9,zc),35676:ls.bind(null,"uniformMatrix4fv",ra,16,zc),35678:Ln,35680:Ln,5125:ls.bind(null,"uniform1uiv",tg,1,Hn),36294:ls.bind(null,"uniform2uiv",tg,2,Hn),36295:ls.bind(null,"uniform3uiv",tg,3,Hn),36296:ls.bind(null,"uniform4uiv",tg,4,Hn),35685:ls.bind(null,"uniformMatrix2x3fv",ra,6,zc),35686:ls.bind(null,"uniformMatrix2x4fv",ra,8,zc),35687:ls.bind(null,"uniformMatrix3x2fv",ra,6,zc),35688:ls.bind(null,"uniformMatrix3x4fv",ra,12,zc),35689:ls.bind(null,"uniformMatrix4x2fv",ra,8,zc),35690:ls.bind(null,"uniformMatrix4x3fv",ra,12,zc),35678:Ln,35680:Ln,35679:Ln,35682:Ln,36289:Ln,36292:Ln,36293:Ln,36298:Ln,36299:Ln,36300:Ln,36303:Ln,36306:Ln,36307:Ln,36308:Ln,36311:Ln},Q4={},tB={},eB={},rw=[0];function M1(i,t,e,r){t===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(rw[0]=i,i=rw);const s=i.length;if(s%t&&ci.warn("Uniform size should be multiples of ".concat(t),i)(),i instanceof e)return i;let n=r[s];n||(n=new e(s),r[s]=n);for(let c=0;c<s;c++)n[c]=i[c];return n}function ra(i,t){return M1(i,t,Float32Array,Q4)}function Th(i,t){return M1(i,t,Int32Array,tB)}function tg(i,t){return M1(i,t,Uint32Array,eB)}function sw(i,t,e){const r=Y4[e.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(e.type));return r().bind(null,i,t)}function iB(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=i.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:e[1],length:e[2]||1,isArray:!!e[2]}}function rB(i,t,e){for(const r in i){const s=i[r];if((!e||e[r])&&!sB(s))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(r),s),new Error("".concat(t," Bad uniform ").concat(r))}return!0}function sB(i){return Array.isArray(i)||ArrayBuffer.isView(i)?oB(i):isFinite(i)||i===!0||i===!1||i instanceof Fd||i instanceof bd?!0:i instanceof sn?!!i.texture:!1}function nB(i,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(i[t]){const r=i[t];for(let s=0,n=e.length;s<n;++s)r[s]=e[s]}else i[t]=e.slice();else i[t]=e}function oB(i){if(i.length===0)return!1;const t=Math.min(i.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(i[e]))return!1;return!0}function Ln(){let i=null;return(t,e,r)=>{const s=i!==r;return s&&(t.uniform1i(e,r),i=r),s}}function ls(i,t,e,r){let s=null,n=null;return(c,l,f)=>{const y=t(f,e),x=y.length;let T=!1;if(s===null)s=new Float32Array(x),n=x,T=!0;else{ei(n===x,"Uniform length cannot change.");for(let P=0;P<x;++P)if(y[P]!==s[P]){T=!0;break}}return T&&(r(c,i,l,y),s.set(y)),T}}function Hn(i,t,e,r){i[t](e,r)}function zc(i,t,e,r){i[t](e,!1,r)}const aB=5120,lB=5121,cB=5122,hB=5123,nw=0,eg=1,uB=2,dB=3,ig=4,pB=5,fB=6,en=5126,gB=35664,mB=35665,yB=35666,xp=5124,_B=35667,vB=35668,bB=35669,Ap=5125,wB=36294,xB=36295,AB=36296,SB=35670,EB=35671,CB=35672,TB=35673,PB=35674,IB=35675,MB=35676,LB=35685,BB=35686,RB=35687,kB=35688,OB=35689,DB=35690,h_={[en]:[en,1,"float"],[gB]:[en,2,"vec2"],[mB]:[en,3,"vec3"],[yB]:[en,4,"vec4"],[xp]:[xp,1,"int"],[_B]:[xp,2,"ivec2"],[vB]:[xp,3,"ivec3"],[bB]:[xp,4,"ivec4"],[Ap]:[Ap,1,"uint"],[wB]:[Ap,2,"uvec2"],[xB]:[Ap,3,"uvec3"],[AB]:[Ap,4,"uvec4"],[SB]:[en,1,"bool"],[EB]:[en,2,"bvec2"],[CB]:[en,3,"bvec3"],[TB]:[en,4,"bvec4"],[PB]:[en,8,"mat2"],[LB]:[en,8,"mat2x3"],[BB]:[en,8,"mat2x4"],[IB]:[en,12,"mat3"],[RB]:[en,12,"mat3x2"],[kB]:[en,12,"mat3x4"],[MB]:[en,16,"mat4"],[OB]:[en,16,"mat4x2"],[DB]:[en,16,"mat4x3"]};function NB(i){switch(i){case nw:return nw;case eg:return eg;case dB:return eg;case uB:return eg;case ig:return ig;case pB:return ig;case fB:return ig;default:return ei(!1),0}}function ow(i){const t=h_[i];if(!t)return null;const[e,r]=t;return{type:e,components:r}}function n3(i,t){switch(i){case aB:case lB:case cB:case hB:i=en;break}for(const e in h_){const[r,s,n]=h_[e];if(r===i&&s===t)return{glType:e,name:n}}return null}class FB{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,r=e.getProgramParameter(t.handle,35721);for(let s=0;s<r;s++){const{name:n,type:c,size:l}=e.getActiveAttrib(t.handle,s),f=e.getAttribLocation(t.handle,n);f>=0&&this._addAttribute(f,n,c,l)}this.attributeInfos.sort((s,n)=>s.location-n.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!ir(e))return;const r=e.getProgramParameter(t.handle,35971);for(let s=0;s<r;s++){const{name:n,type:c,size:l}=e.getTransformFeedbackVarying(t.handle,s);this._addVarying(s,n,c,l)}this.varyingInfos.sort((s,n)=>s.location-n.location)}_addAttribute(t,e,r,s){const{type:n,components:c}=ow(r),l={type:n,size:s*c};this._inferProperties(t,e,l);const f={location:t,name:e,accessor:new Fo(l)};this.attributeInfos.push(f),this.attributeInfosByLocation[t]=f,this.attributeInfosByName[f.name]=f}_inferProperties(t,e,r){/instance/i.test(e)&&(r.divisor=1)}_addVarying(t,e,r,s){const{type:n,components:c}=ow(r),l=new Fo({type:n,size:s*c}),f={location:t,name:e,accessor:l};this.varyingInfos.push(f),this.varyingInfosByName[f.name]=f}}const aw=4,zB=35981,jB=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class o3 extends ih{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",jB),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:r,fs:s,varyings:n,bufferMode:c=zB}=t;return this.hash=e||"",this.vs=typeof r=="string"?new X0(this.gl,{id:"".concat(t.id,"-vs"),source:r}):r,this.fs=typeof s=="string"?new $0(this.gl,{id:"".concat(t.id,"-fs"),source:s}):s,ei(this.vs instanceof X0),ei(this.fs instanceof $0),this.uniforms={},this._textureUniforms={},n&&n.length>0&&(wo(this.gl),this.varyings=n,this.gl2.transformFeedbackVaryings(this.handle,n,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new FB(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:r=4,vertexCount:s,offset:n=0,start:c,end:l,isIndexed:f=!1,indexType:y=5123,instanceCount:x=0,isInstanced:T=x>0,vertexArray:P=null,transformFeedback:M,framebuffer:N,parameters:G={},uniforms:Z,samplers:X}=t;if((Z||X)&&(ci.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(Z||{})),ci.priority>=e){const $=N?N.id:"default",ct="mode=".concat(jh(this.gl,r)," verts=").concat(s," ")+"instances=".concat(x," indexType=").concat(jh(this.gl,y)," ")+"isInstanced=".concat(T," isIndexed=").concat(f," ")+"Framebuffer=".concat($);ci.log(e,ct)()}return ei(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||s===0||T&&x===0?!1:(P.bindForDraw(s,x,()=>{if(N!==void 0&&(G=Object.assign({},G,{framebuffer:N})),M){const $=NB(r);M.begin($)}this._bindTextures(),Pl(this.gl,G,()=>{f&&T?this.gl2.drawElementsInstanced(r,s,y,n,x):f&&ir(this.gl)&&!isNaN(c)&&!isNaN(l)?this.gl2.drawRangeElements(r,c,l,s,y,n):f?this.gl.drawElements(r,s,y,n):T?this.gl2.drawArraysInstanced(r,n,s,x):this.gl.drawArrays(r,n,s)}),M&&M.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ci.priority>=2&&rB(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const r=t[e],s=this._uniformSetters[e];if(s){let n=r,c=!1;if(n instanceof sn&&(n=n.texture),n instanceof Fd)if(c=this.uniforms[e]!==r,c){s.textureIndex===void 0&&(s.textureIndex=this._textureIndexCounter++);const l=n,{textureIndex:f}=s;l.bind(f),n=f,this._textureUniforms[e]=l}else n=s.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(s(n)||c)&&nB(this.uniforms,e,r)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const r=this._textureUniforms[e];r.update(),t=t&&r.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),r={};for(const s of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new X0({handle:s});break;case 35632:r.fs=new $0({handle:s});break}return r}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=Qc(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ci.time(aw,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),ci.timeEnd(aw,"linkProgram for ".concat(this._getName()))(),t.debug||ci.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const r=this.gl.getActiveUniform(this.handle,e),{name:s}=iB(r.name);let n=t.getUniformLocation(this.handle,s);if(this._uniformSetters[s]=sw(t,n,r),r.size>1)for(let c=0;c<r.size;c++)n=t.getUniformLocation(this.handle,"".concat(s,"[").concat(c,"]")),this._uniformSetters["".concat(s,"[").concat(c,"]")]=sw(t,n,r)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const UB=34918,GB=34919,VB=35007,qB=36795,HB=35976,WB=35887,JB=36202;class nm extends ih{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=ir(t),s=e3(t,is.TIMER_QUERY);let n=r||s;for(const c of e)switch(c){case"queries":n=n&&r;break;case"timers":n=n&&s;break;default:ei(!1)}return n}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(VB)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?JB:WB)}beginTransformFeedbackQuery(){return this.begin(HB)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,GB);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(qB)}getResult(){return this.gl2.getQueryParameter(this.handle,UB)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((r,s)=>{const n=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):e++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(n)};requestAnimationFrame(n)}),this._pollingPromise}_createHandle(){return nm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class a3 extends ih{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return ir(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};wo(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Nd(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const r=this._getVaryingIndex(t),{buffer:s,byteSize:n,byteOffset:c}=this._getBufferParams(e);return r<0?(this.unused[t]=s,ci.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[r]=e,this.bindOnUse||this._bindBuffer(r,s,c,n),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,r,s;return t instanceof Wr?s=t:(s=t.buffer,r=t.byteSize,e=t.byteOffset),(e!==void 0||r!==void 0)&&(e=e||0,r=r||s.byteLength-e),{buffer:s,byteOffset:e,byteSize:r}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:r,byteOffset:s}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,s,r)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;const n=e&&e.handle;return!n||s===void 0?this.gl.bindBufferBase(35982,t,n):this.gl.bindBufferRange(35982,t,n,r,s),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let rg=null;function ZB(i){return(!rg||rg.byteLength<i)&&(rg=new ArrayBuffer(i)),rg}function XB(i,t){const e=ZB(i.BYTES_PER_ELEMENT*t);return new i(e,0,t)}function $B(i){let{target:t,source:e,start:r=0,count:s=1}=i;const n=e.length,c=s*n;let l=0;for(let f=r;l<n;l++)t[f++]=e[l];for(;l<c;)l<c-l?(t.copyWithin(r+l,r,r+l),l*=2):(t.copyWithin(r+l,r,r+c-l),l=c);return t}const KB="elements must be GL.ELEMENT_ARRAY_BUFFER";class aa extends ih{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?ir(t)||jA()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new aa(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return aa.MAX_ATTRIBUTES=aa.MAX_ATTRIBUTES||t.getParameter(34921),aa.MAX_ATTRIBUTES}static setConstant(t,e,r){switch(r.constructor){case Float32Array:aa._setConstantFloatArray(t,e,r);break;case Int32Array:aa._setConstantIntArray(t,e,r);break;case Uint32Array:aa._setConstantUintArray(t,e,r);break;default:ei(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return aa.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ei(!t||t.target===34963,KB),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,r){if(e.target===34963)return this.setElementBuffer(e,r);const{size:s,type:n,stride:c,offset:l,normalized:f,integer:y,divisor:x}=r,{gl:T,gl2:P}=this;return t=Number(t),this.bind(()=>{T.bindBuffer(34962,e.handle),y?(ei(ir(T)),P.vertexAttribIPointer(t,s,n,c,l)):T.vertexAttribPointer(t,s,n,f,c,l),T.enableVertexAttribArray(t),P.vertexAttribDivisor(t,x||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!aa.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const r=this._normalizeConstantArrayValue(e),s=r.byteLength*t,n=r.length*t;let c=!this.buffer;if(this.buffer=this.buffer||new Wr(this.gl,s),c=c||this.buffer.reallocate(s),c=c||!this._compareConstantArrayValues(r,this.bufferValue),c){const l=XB(e.constructor,n);$B({target:l,source:r,start:0,count:n}),this.buffer.subData(l),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}static _setConstantFloatArray(t,e,r){switch(r.length){case 1:t.vertexAttrib1fv(e,r);break;case 2:t.vertexAttrib2fv(e,r);break;case 3:t.vertexAttrib3fv(e,r);break;case 4:t.vertexAttrib4fv(e,r);break;default:ei(!1)}}static _setConstantIntArray(t,e,r){switch(ei(ir(t)),r.length){case 1:t.vertexAttribI1iv(e,r);break;case 2:t.vertexAttribI2iv(e,r);break;case 3:t.vertexAttribI3iv(e,r);break;case 4:t.vertexAttribI4iv(e,r);break;default:ei(!1)}}static _setConstantUintArray(t,e,r){switch(ei(ir(t)),r.length){case 1:t.vertexAttribI1uiv(e,r);break;case 2:t.vertexAttribI2uiv(e,r);break;case 3:t.vertexAttribI3uiv(e,r);break;case 4:t.vertexAttribI4uiv(e,r);break;default:ei(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:r}=e;return ei(Number.isFinite(r)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(r,t);default:return this.gl.getVertexAttrib(r,t)}})}}const YB="VertexArray: attributes must be Buffers or constants (i.e. typed array)",QB=/^(.+)__LOCATION_([0-9]+)$/,t6=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class e6{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=e.id||e.program&&e.program.id;this.id=r,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new aa(t),ZA(this,"VertexArray","v6.0",t6),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const r=t[e];this._setAttribute(e,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,r);const{location:s,accessor:n}=this._resolveLocationAndAccessor(t,e,e.accessor,r);return s>=0&&(this.values[s]=e,this.accessors[s]=n,this.clearDrawParams(),this.vertexArrayObject.setBuffer(s,e,n)),this}setConstant(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:s,accessor:n}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},r));return s>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[s]=e,this.accessors[s]=n,this.clearDrawParams(),this.vertexArrayObject.enable(s,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Wr(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof Wr&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof Wr&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,r){let s;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),s=r()}),s}_resolveLocationAndAccessor(t,e,r,s){const n={location:-1,accessor:null},{location:c,name:l}=this._getAttributeIndex(t);if(!Number.isFinite(c)||c<0)return this.unused[t]=e,ci.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),n;const f=this._getAttributeInfo(l||c);if(!f)return n;const y=this.accessors[c]||{},x=Fo.resolve(f.accessor,y,r,s),{size:T,type:P}=x;return ei(Number.isFinite(T)&&Number.isFinite(P)),{location:c,accessor:x}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const r=QB.exec(t),s=r?r[1]:t,n=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(s)+n,name:s}:{location:-1}}_setAttribute(t,e){if(e instanceof Wr)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof Wr){const r=e[0],s=e[1];this.setBuffer(t,r,s)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const r=e;this.setConstant(t,r)}else if(e.buffer instanceof Wr){const r=e;this.setBuffer(t,r.buffer,r)}else throw new Error(YB)}_setConstantAttributes(t,e){const r=Math.max(t|0,e|0);let s=this.values[0];ArrayBuffer.isView(s)&&this._setConstantAttributeZero(s,r);for(let n=1;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)s=this.values[n],ArrayBuffer.isView(s)&&this._setConstantAttribute(n,s)}_setConstantAttributeZero(t,e){if(aa.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const r=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(t,e){aa.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const r=this.values[e],s=this.accessors[e];if(!r)return;const{divisor:n}=s,c=n>0;if(t.isInstanced=t.isInstanced||c,r instanceof Wr){const l=r;if(c){const f=l.getVertexCount(s);t.instanceCount=Math.min(t.instanceCount,f)}else{const f=l.getVertexCount(s);t.vertexCount=Math.min(t.vertexCount,f)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ci.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function i6(i,t){const{maxElts:e=16,size:r=1}=t;let s="[";for(let c=0;c<i.length&&c<e;++c)c>0&&(s+=",".concat(c%r===0?" ":"")),s+=Qp(i[c],t);const n=i.length>e?"...":"]";return"".concat(s).concat(n)}function Qp(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:r=!1}=t;if(Array.isArray(i)||ArrayBuffer.isView(i))return i6(i,t);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<e)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const s=i.toPrecision(2);return s.indexOf(".0")===s.length-2?s.slice(0,-1):s}function lw(i){let{header:t="Uniforms",program:e,uniforms:r,undefinedOnly:s=!1}=i;ei(e);const n=".*_.*",c=".*Matrix",l=e._uniformSetters,f={},y=Object.keys(l).sort();let x=0;for(const M of y)!M.match(n)&&!M.match(c)&&K0({table:f,header:t,uniforms:r,uniformName:M,undefinedOnly:s})&&x++;for(const M of y)M.match(c)&&K0({table:f,header:t,uniforms:r,uniformName:M,undefinedOnly:s})&&x++;for(const M of y)f[M]||K0({table:f,header:t,uniforms:r,uniformName:M,undefinedOnly:s})&&x++;let T=0;const P={};if(!s)for(const M in r){const N=r[M];f[M]||(T++,P[M]={Type:"NOT USED: ".concat(N),[t]:Qp(N)})}return{table:f,count:x,unusedTable:P,unusedCount:T}}function K0(i){let{table:t,header:e,uniforms:r,uniformName:s,undefinedOnly:n}=i;const c=r[s],l=r6(c);return!n||!l?(t[s]={[e]:l?Qp(c):"N/A","Uniform Type":l?c:"NOT PROVIDED"},!0):!1}function r6(i){return i!=null}function s6(i){let{vertexArray:t,header:e="Attributes"}=i;if(!t.configuration)return{};const r={};t.elements&&(r.ELEMENT_ARRAY_BUFFER=cw(t,t.elements,null,e));const s=t.values;for(const n in s){const c=t._getAttributeInfo(n);if(c){let l="".concat(n,": ").concat(c.name);const f=t.accessors[c.location];f&&(l="".concat(n,": ").concat(n6(c.name,f))),r[l]=cw(t,s[n],f,e)}}return r}function cw(i,t,e,r){const{gl:s}=i;if(!t)return{[r]:"null","Format ":"N/A"};let n="NOT PROVIDED",c=1,l=0,f=0,y,x,T;if(e&&(n=e.type,c=e.size,n=String(n).replace("Array",""),y=n.indexOf("nt")!==-1),t instanceof Wr){const P=t,{data:M,changed:N}=P.getDebugData();x=N?"*":"",T=M,f=P.byteLength,l=f/M.BYTES_PER_ELEMENT/c;let G;if(e){const Z=e.divisor>0;G="".concat(Z?"I ":"P "," ").concat(l," (x").concat(c,"=").concat(f," bytes ").concat(jh(s,n),")")}else y=!0,G="".concat(f," bytes");return{[r]:"".concat(x).concat(Qp(T,{size:c,isInteger:y})),"Format ":G}}return T=t,c=t.length,n=String(t.constructor.name).replace("Array",""),y=n.indexOf("nt")!==-1,{[r]:"".concat(Qp(T,{size:c,isInteger:y})," (constant)"),"Format ":"".concat(c,"x").concat(n," (constant)")}}function n6(i,t){const{type:e,size:r}=t,s=n3(e,r);return s?"".concat(i," (").concat(s.name,")"):i}function o6(i){const t={},e="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const s=hw(r);t["in ".concat(s)]={[e]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const s=hw(r);t["out ".concat(s)]={[e]:JSON.stringify(r.accessor)}}return t}function hw(i){const{type:t,size:e}=i.accessor,r=n3(t,e);return r?"".concat(r.name," ").concat(i.name):i.name}const uw=eh()&&typeof document<"u";let a6=0;class l6{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=Z=>JA(Z),onAddHTML:r=null,onInitialize:s=()=>{},onRender:n=()=>{},onFinalize:c=()=>{},onError:l,gl:f=null,glOptions:y={},debug:x=!1,createFramebuffer:T=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:M=!0,stats:N=Au.get("animation-loop-".concat(a6++))}=t;let{useDevicePixels:G=!0}=t;"useDevicePixelRatio"in t&&(ci.deprecated("useDevicePixelRatio","useDevicePixels")(),G=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:r,onInitialize:s,onRender:n,onFinalize:c,onError:l,gl:f,glOptions:y,debug:x,createFramebuffer:T},this.gl=f,this.needsRedraw=null,this.timeline=null,this.stats=N,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:M,useDevicePixels:G}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return ei(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=nm.isSupported(this.gl,["timers"])?new nm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(t);return r?Number(r.value):e}setViewParameters(){return ci.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=uw?new Promise((t,e)=>{if(uw&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):g4(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):f4(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:r}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?E1(this.props.gl,t):this.onCreateContext(t),!Cm(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");e4(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const r=this.props.onAddHTML(e);r&&(e.innerHTML=r)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let r=1;const{canvas:s}=this.gl;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:t>0&&e>0&&(r=t/e),{width:t,height:e,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&o4(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new sn(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const yf="vs",L1="fs";function ha(i,t){if(!i)throw new Error(t||"shadertools: assertion failed.")}const Y0={number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},array:{validate(i,t){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function c6(i){const t={};for(const e in i){const r=i[e],s=h6(r);t[e]=s}return t}function h6(i){let t=dw(i);return t==="object"?i?"type"in i?Object.assign({},i,Y0[i.type]):"value"in i?(t=dw(i.value),Object.assign({type:t},i,Y0[t])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:t,value:i},Y0[t])}function dw(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const u6="vs",d6="fs";class pw{constructor(t){let{name:e,vs:r,fs:s,dependencies:n=[],uniforms:c,getUniforms:l,deprecations:f=[],defines:y={},inject:x={},vertexShader:T,fragmentShader:P}=t;ha(typeof e=="string"),this.name=e,this.vs=r||T,this.fs=s||P,this.getModuleUniforms=l,this.dependencies=n,this.deprecations=this._parseDeprecationDefinitions(f),this.defines=y,this.injections=p6(x),c&&(this.uniforms=c6(c))}getModuleSource(t){let e;switch(t){case u6:e=this.vs||"";break;case d6:e=this.fs||"";break;default:ha(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(r=>{r.regex.test(t)&&(r.deprecated?e.deprecated(r.old,r.new)():e.removed(r.old,r.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},r=this.uniforms;for(const s in r){const n=r[s];s in t&&!n.private?(n.validate&&ha(n.validate(t[s],n),"".concat(this.name,": invalid ").concat(s)),e[s]=t[s]):e[s]=n.value}return e}}function p6(i){const t={vs:{},fs:{}};for(const e in i){let r=i[e];const s=e.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),t[s][e]=r}return t}function f6(i){return g6(c3(i))}function g6(i){const t={},e={};return l3({modules:i,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((r,s)=>e[s]-e[r]).map(r=>t[r])}function l3(i){let{modules:t,level:e,moduleMap:r,moduleDepth:s}=i;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const n of t)r[n.name]=n,(s[n.name]===void 0||s[n.name]<e)&&(s[n.name]=e);for(const n of t)n.dependencies&&l3({modules:n.dependencies,level:e+1,moduleMap:r,moduleDepth:s})}function c3(i,t){return i.map(e=>(e instanceof pw||(ha(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),ha(e.name,"shader module has no name"),e=new pw(e),e.dependencies=c3(e.dependencies)),e))}function m6(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=i.userAgent||t.userAgent||"",r=e.indexOf("MSIE ")!==-1,s=e.indexOf("Trident/")!==-1;return r||s}const y6=7936,_6=7937,v6=7938,b6=35724,B1={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},_u={};Object.keys(B1).forEach(i=>{_u[i]=i});function w6(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function x6(i){const t=i.getExtension("WEBGL_debug_renderer_info"),e=i.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||y6),r=i.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||_6);return{gpuVendor:A6(e,r),vendor:e,renderer:r,version:i.getParameter(v6),shadingLanguageVersion:i.getParameter(b6)}}function A6(i,t){return i.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||t.match(/AMD/i)||i.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Q0={};function fw(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=B1[t];if(ha(r,t),!m6(e))return!0;if(t in Q0)return Q0[t];const s=r[0],n=e.behavior||"enable",c="#extension GL_".concat(s," : ").concat(n,`
void main(void) {}`),l=i.createShader(35633);i.shaderSource(l,c),i.compileShader(l);const f=i.getShaderParameter(l,35713);return i.deleteShader(l),Q0[t]=f,f}function S6(i,t){const e=B1[t];ha(e,t);const r=w6(i)&&e[1]||e[0],s=typeof r=="string"?!!i.getExtension(r):r;return ha(s===!1||s===!0),s}function sg(i,t){return t=Array.isArray(t)?t:[t],t.every(e=>S6(i,e))}function E6(i){switch(x6(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function C6(i,t,e){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return sg(i,_u.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),sg(i,_u.GLSL_DERIVATIVES)&&fw(i,_u.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),sg(i,_u.GLSL_FRAG_DATA)&&fw(i,_u.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),sg(i,_u.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const T6=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,P6=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,I6={[yf]:T6,[L1]:P6},Lg="__LUMA_INJECT_DECLARATIONS__",gw=/void\s+main\s*\([^)]*\)\s*\{\n?/,mw=/}\n?[^{}]*$/,ty=[];function yw(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=t===yf;for(const n in e){const c=e[n];c.sort((f,y)=>f.order-y.order),ty.length=c.length;for(let f=0,y=c.length;f<y;++f)ty[f]=c[f].injection;const l="".concat(ty.join(`
`),`
`);switch(n){case"vs:#decl":s&&(i=i.replace(Lg,l));break;case"vs:#main-start":s&&(i=i.replace(gw,f=>f+l));break;case"vs:#main-end":s&&(i=i.replace(mw,f=>l+f));break;case"fs:#decl":s||(i=i.replace(Lg,l));break;case"fs:#main-start":s||(i=i.replace(gw,f=>f+l));break;case"fs:#main-end":s||(i=i.replace(mw,f=>l+f));break;default:i=i.replace(n,f=>f+l)}}return i=i.replace(Lg,""),r&&(i=i.replace(/\}\s*$/,n=>n+I6[t])),i}function u_(i){const t={};return ha(Array.isArray(i)&&i.length>1),i.forEach(e=>{for(const r in e)t[r]=t[r]?"".concat(t[r],`
`).concat(e[r]):e[r]}),t}function zd(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const h3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],M6=[...h3,[zd("attribute"),"in $1"],[zd("varying"),"out $1"]],L6=[...h3,[zd("varying"),"in $1"]],u3=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],B6=[...u3,[zd("in"),"attribute $1"],[zd("out"),"varying $1"]],R6=[...u3,[zd("in"),"varying $1"]],d_="gl_FragColor",p_=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,k6=/void\s+main\s*\([^)]*\)\s*\{\n?/;function O6(i,t,e){switch(t){case 300:return e?om(i,M6):D6(i);case 100:return e?om(i,B6):N6(i);default:throw new Error("unknown GLSL version ".concat(t))}}function om(i,t){for(const[e,r]of t)i=i.replace(e,r);return i}function D6(i){i=om(i,L6);const t=i.match(p_);if(t){const e=t[1];i=i.replace(new RegExp("\\b".concat(d_,"\\b"),"g"),e)}else{const e="fragmentColor";i=i.replace(k6,r=>"out vec4 ".concat(e,`;
`).concat(r)).replace(new RegExp("\\b".concat(d_,"\\b"),"g"),e)}return i}function N6(i){i=om(i,R6);const t=i.match(p_);if(t){const e=t[1];i=i.replace(p_,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),d_)}return i}const F6=`

`.concat(Lg,`

`),d3={[yf]:"vertex",[L1]:"fragment"},z6=`precision highp float;

`;function j6(i,t){const{vs:e,fs:r}=t,s=f6(t.modules||[]);return{gl:i,vs:_w(i,Object.assign({},t,{source:e,type:yf,modules:s})),fs:_w(i,Object.assign({},t,{source:r,type:L1,modules:s})),getUniforms:U6(s)}}function _w(i,t){let{id:e,source:r,type:s,modules:n,defines:c={},hookFunctions:l=[],inject:f={},transpileToGLSL100:y=!1,prologue:x=!0,log:T}=t;ha(typeof r=="string","shader source must be a string");const P=s===yf,M=r.split(`
`);let N=100,G="",Z=r;M[0].indexOf("#version ")===0?(N=300,G=M[0],Z=M.slice(1).join(`
`)):G="#version ".concat(N);const X={};n.forEach(Rt=>{Object.assign(X,Rt.getDefines())}),Object.assign(X,c);let $=x?"".concat(G,`
`).concat(V6({id:e,source:r,type:s}),`
`).concat(G6({type:s}),`
`).concat(E6(i),`
`).concat(C6(i),`
`).concat(q6(X),`
`).concat(P?"":z6,`
`):"".concat(G,`
`);const ct=W6(l),yt={},Mt={},Nt={};for(const Rt in f){const xt=typeof f[Rt]=="string"?{injection:f[Rt],order:0}:f[Rt],qt=Rt.match(/^(v|f)s:(#)?([\w-]+)$/);if(qt){const zt=qt[2],ot=qt[3];zt?ot==="decl"?Mt[Rt]=[xt]:Nt[Rt]=[xt]:yt[Rt]=[xt]}else Nt[Rt]=[xt]}for(const Rt of n){T&&Rt.checkDeprecations(Z,T);const xt=Rt.getModuleSource(s,N);$+=xt;const qt=Rt.injections[s];for(const zt in qt){const ot=zt.match(/^(v|f)s:#([\w-]+)$/);if(ot){const dt=ot[2]==="decl"?Mt:Nt;dt[zt]=dt[zt]||[],dt[zt].push(qt[zt])}else yt[zt]=yt[zt]||[],yt[zt].push(qt[zt])}}return $+=F6,$=yw($,s,Mt),$+=H6(ct[s],yt),$+=Z,$=yw($,s,Nt),$=O6($,y?100:N,P),$}function U6(i){return function(t){const e={};for(const r of i){const s=r.getUniforms(t,e);Object.assign(e,s)}return e}}function G6(i){let{type:t}=i;return`
#define SHADER_TYPE_`.concat(d3[t].toUpperCase(),`
`)}function V6(i){let{id:t,source:e,type:r}=i;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(d3[r],`

`):""}function q6(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const r in i){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const s=i[r];(s||Number.isFinite(s))&&(e+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return t===0&&(e+=`
`),e}function H6(i,t){let e="";for(const r in i){const s=i[r];if(e+="void ".concat(s.signature,` {
`),s.header&&(e+="  ".concat(s.header)),t[r]){const n=t[r];n.sort((c,l)=>c.order-l.order);for(const c of n)e+="  ".concat(c.injection,`
`)}s.footer&&(e+="  ".concat(s.footer)),e+=`}
`}return e}function W6(i){const t={vs:{},fs:{}};return i.forEach(e=>{let r;typeof e!="string"?(r=e,e=r.hook):r={},e=e.trim();const[s,n]=e.split(":"),c=e.replace(/\(.+/,"");t[s][c]=Object.assign(r,{signature:n})}),t}const J6="void main() {gl_FragColor = vec4(0);}",p3=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,Z6=`#version 300 es
`.concat(p3);function f3(i,t){t=Array.isArray(t)?t:[t];const e=i.replace(/^\s+/,"").split(/\s+/),[r,s,n]=e;if(!t.includes(r)||!s||!n)return null;const c=n.split(";")[0];return{qualifier:r,type:s,name:c}}function g3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:r,output:s}=i;if(!e)return t===300?Z6:t>300?"#version ".concat(t,`
`).concat(p3):J6;const n=K6(e,r);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(r," ").concat(e,`;
out vec4 `).concat(s,`;
void main() {
  `).concat(s," = ").concat(n,`;
}`):"varying ".concat(r," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(n,`;
}`)}function X6(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ha(!1),null}}function $6(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ha(!1),null}}function K6(i,t){switch(t){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return ha(!1),null}}const Y6=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Q6={name:"fp32",vs:Y6,fs:null};function El(i,t){if(!i)throw new Error("math.gl assertion ".concat(t))}const tR=1/Math.PI*180,eR=1/180*Math.PI,rn={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function iR(i){let{precision:t=rn.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=oR(i),"".concat(parseFloat(i.toPrecision(t)))}function qh(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function rR(i){return nR(i)}function sR(i){return Hc(i)}function nR(i,t){return R1(i,e=>e*eR,t)}function Hc(i,t){return R1(i,e=>e*tR,t)}function Wc(i,t,e){return R1(i,r=>Math.max(t,Math.min(e,r)))}function am(i,t,e){return qh(i)?i.map((r,s)=>am(r,t[s],e)):e*t+(1-e)*i}function Il(i,t,e){const r=rn.EPSILON;e&&(rn.EPSILON=e);try{if(i===t)return!0;if(qh(i)&&qh(t)){if(i.length!==t.length)return!1;for(let s=0;s<i.length;++s)if(!Il(i[s],t[s]))return!1;return!0}return i&&i.equals?i.equals(t):t&&t.equals?t.equals(i):typeof i=="number"&&typeof t=="number"?Math.abs(i-t)<=rn.EPSILON*Math.max(1,Math.abs(i),Math.abs(t)):!1}finally{rn.EPSILON=r}}function oR(i){return Math.round(i/rn.EPSILON)*rn.EPSILON}function aR(i){return i.clone?i.clone():new Array(i.length)}function R1(i,t,e){if(qh(i)){const r=i;e=e||aR(r);for(let s=0;s<e.length&&s<r.length;++s)e[s]=t(i[s],s,e);return e}return t(i)}function lR(i){function t(){var e=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i,t}class k1 extends lR(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:qh(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(rn)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+iR(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Il(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){if(r===void 0)return this.lerp(this,t,e);for(let s=0;s<this.ELEMENTS;++s){const n=t[s];this[s]=n+r*(e[s]-n)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=s[n];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=s[n];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(rn.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}get elements(){return this}}function cR(i,t){if(i.length!==t)return!1;for(let e=0;e<i.length;++e)if(!Number.isFinite(i[e]))return!1;return!0}function Ir(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function qp(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(rn.debug&&!cR(i,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return i}class O1 extends k1{get x(){return this[0]}set x(t){this[0]=Ir(t)}get y(){return this[1]}set y(t){this[1]=Ir(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-t[r];e+=s*s}return Ir(e)}dot(t){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Ir(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=s[n];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=s[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return El(t>=0&&t<this.ELEMENTS,"index is out of range"),Ir(this[t])}setComponent(t,e){return El(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var Hp=1e-6,Ml=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function hR(){var i=new Ml(2);return Ml!=Float32Array&&(i[0]=0,i[1]=0),i}function vw(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function uR(i,t){return i[0]=-t[0],i[1]=-t[1],i}function m3(i,t,e,r){var s=t[0],n=t[1];return i[0]=s+r*(e[0]-s),i[1]=n+r*(e[1]-n),i}function dR(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s,i[1]=e[1]*r+e[3]*s,i}function pR(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s+e[4],i[1]=e[1]*r+e[3]*s+e[5],i}function y3(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[3]*s+e[6],i[1]=e[1]*r+e[4]*s+e[7],i}function _3(i,t,e){var r=t[0],s=t[1];return i[0]=e[0]*r+e[4]*s+e[12],i[1]=e[1]*r+e[5]*s+e[13],i}(function(){var i=hR();return function(t,e,r,s,n,c){var l,f;for(e||(e=2),r||(r=0),s?f=Math.min(s*e+r,t.length):f=t.length,l=r;l<f;l+=e)i[0]=t[l],i[1]=t[l+1],n(i,i,c),t[l]=i[0],t[l+1]=i[1];return t}})();function v3(i,t,e){const r=t[0],s=t[1],n=e[3]*r+e[7]*s||1;return i[0]=(e[0]*r+e[4]*s)/n,i[1]=(e[1]*r+e[5]*s)/n,i}function b3(i,t,e){const r=t[0],s=t[1],n=t[2],c=e[3]*r+e[7]*s+e[11]*n||1;return i[0]=(e[0]*r+e[4]*s+e[8]*n)/c,i[1]=(e[1]*r+e[5]*s+e[9]*n)/c,i[2]=(e[2]*r+e[6]*s+e[10]*n)/c,i}function fR(i,t,e){const r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s,i[1]=e[1]*r+e[3]*s,i[2]=t[2],i}function gR(i,t,e){const r=t[0],s=t[1];return i[0]=e[0]*r+e[2]*s,i[1]=e[1]*r+e[3]*s,i[2]=t[2],i[3]=t[3],i}function w3(i,t,e){const r=t[0],s=t[1],n=t[2];return i[0]=e[0]*r+e[3]*s+e[6]*n,i[1]=e[1]*r+e[4]*s+e[7]*n,i[2]=e[2]*r+e[5]*s+e[8]*n,i[3]=t[3],i}class D1 extends O1{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),qh(t)&&arguments.length===1?this.copy(t):(rn.debug&&(Ir(t),Ir(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return rn.debug&&(Ir(t.x),Ir(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return _3(this,this,t),this.check()}transformAsVector(t){return v3(this,this,t),this.check()}transformByMatrix3(t){return y3(this,this,t),this.check()}transformByMatrix2x3(t){return pR(this,this,t),this.check()}transformByMatrix2(t){return dR(this,this,t),this.check()}}function x3(){var i=new Ml(3);return Ml!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function A3(i){var t=i[0],e=i[1],r=i[2];return Math.hypot(t,e,r)}function bw(i,t,e){var r=new Ml(3);return r[0]=i,r[1]=t,r[2]=e,r}function mR(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function yR(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function _R(i,t){var e=t[0],r=t[1],s=t[2],n=e*e+r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i}function N1(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function Bg(i,t,e){var r=t[0],s=t[1],n=t[2],c=e[0],l=e[1],f=e[2];return i[0]=s*f-n*l,i[1]=n*c-r*f,i[2]=r*l-s*c,i}function F1(i,t,e){var r=t[0],s=t[1],n=t[2],c=e[3]*r+e[7]*s+e[11]*n+e[15];return c=c||1,i[0]=(e[0]*r+e[4]*s+e[8]*n+e[12])/c,i[1]=(e[1]*r+e[5]*s+e[9]*n+e[13])/c,i[2]=(e[2]*r+e[6]*s+e[10]*n+e[14])/c,i}function S3(i,t,e){var r=t[0],s=t[1],n=t[2];return i[0]=r*e[0]+s*e[3]+n*e[6],i[1]=r*e[1]+s*e[4]+n*e[7],i[2]=r*e[2]+s*e[5]+n*e[8],i}function E3(i,t,e){var r=e[0],s=e[1],n=e[2],c=e[3],l=t[0],f=t[1],y=t[2],x=s*y-n*f,T=n*l-r*y,P=r*f-s*l,M=s*P-n*T,N=n*x-r*P,G=r*T-s*x,Z=c*2;return x*=Z,T*=Z,P*=Z,M*=2,N*=2,G*=2,i[0]=l+x+M,i[1]=f+T+N,i[2]=y+P+G,i}function vR(i,t,e,r){var s=[],n=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i}function bR(i,t,e,r){var s=[],n=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i}function wR(i,t,e,r){var s=[],n=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],i[0]=n[0]+e[0],i[1]=n[1]+e[1],i[2]=n[2]+e[2],i}function xR(i,t){var e=i[0],r=i[1],s=i[2],n=t[0],c=t[1],l=t[2],f=Math.sqrt(e*e+r*r+s*s),y=Math.sqrt(n*n+c*c+l*l),x=f*y,T=x&&N1(i,t)/x;return Math.acos(Math.min(Math.max(T,-1),1))}var AR=mR,SR=A3;(function(){var i=x3();return function(t,e,r,s,n,c){var l,f;for(e||(e=3),r||(r=0),s?f=Math.min(s*e+r,t.length):f=t.length,l=r;l<f;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],n(i,i,c),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();const ey=[0,0,0];let ng;class re extends O1{static get ZERO(){return ng||(ng=new re(0,0,0),Object.freeze(ng)),ng}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&qh(t)?this.copy(t):(rn.debug&&(Ir(t),Ir(e),Ir(r)),this[0]=t,this[1]=e,this[2]=r)}set(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return rn.debug&&(Ir(t.x),Ir(t.y),Ir(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Ir(t)}angle(t){return xR(this,t)}cross(t){return Bg(this,this,t),this.check()}rotateX(t){let{radians:e,origin:r=ey}=t;return vR(this,this,r,e),this.check()}rotateY(t){let{radians:e,origin:r=ey}=t;return bR(this,this,r,e),this.check()}rotateZ(t){let{radians:e,origin:r=ey}=t;return wR(this,this,r,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return F1(this,this,t),this.check()}transformAsVector(t){return b3(this,this,t),this.check()}transformByMatrix3(t){return S3(this,this,t),this.check()}transformByMatrix2(t){return fR(this,this,t),this.check()}transformByQuaternion(t){return E3(this,this,t),this.check()}}let og;class z1 extends O1{static get ZERO(){return og||(og=new z1(0,0,0,0),Object.freeze(og)),og}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),qh(t)&&arguments.length===1?this.copy(t):(rn.debug&&(Ir(t),Ir(e),Ir(r),Ir(s)),this[0]=t,this[1]=e,this[2]=r,this[3]=s)}set(t,e,r,s){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return rn.debug&&(Ir(t.x),Ir(t.y),Ir(t.z),Ir(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Ir(t)}get w(){return this[3]}set w(t){this[3]=Ir(t)}transform(t){return F1(this,this,t),this.check()}transformByMatrix3(t){return w3(this,this,t),this.check()}transformByMatrix2(t){return gR(this,this,t),this.check()}transformByQuaternion(t){return E3(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class C3 extends k1{toString(){let t="[";if(rn.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=Ir(r),this}getColumn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const r=t*this.RANK;for(let s=0;s<this.RANK;++s)e[s]=this[r+s];return e}setColumn(t,e){const r=t*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=e[s];return this}}function ER(){var i=new Ml(9);return Ml!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function CR(i,t){if(i===t){var e=t[1],r=t[2],s=t[5];i[1]=t[3],i[2]=t[6],i[3]=e,i[5]=t[7],i[6]=r,i[7]=s}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i}function TR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=t[4],l=t[5],f=t[6],y=t[7],x=t[8],T=x*c-l*y,P=-x*n+l*f,M=y*n-c*f,N=e*T+r*P+s*M;return N?(N=1/N,i[0]=T*N,i[1]=(-x*r+s*y)*N,i[2]=(l*r-s*c)*N,i[3]=P*N,i[4]=(x*e-s*f)*N,i[5]=(-l*e+s*n)*N,i[6]=M*N,i[7]=(-y*e+r*f)*N,i[8]=(c*e-r*n)*N,i):null}function PR(i){var t=i[0],e=i[1],r=i[2],s=i[3],n=i[4],c=i[5],l=i[6],f=i[7],y=i[8];return t*(y*n-c*f)+e*(-y*s+c*l)+r*(f*s-n*l)}function ww(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],x=t[7],T=t[8],P=e[0],M=e[1],N=e[2],G=e[3],Z=e[4],X=e[5],$=e[6],ct=e[7],yt=e[8];return i[0]=P*r+M*c+N*y,i[1]=P*s+M*l+N*x,i[2]=P*n+M*f+N*T,i[3]=G*r+Z*c+X*y,i[4]=G*s+Z*l+X*x,i[5]=G*n+Z*f+X*T,i[6]=$*r+ct*c+yt*y,i[7]=$*s+ct*l+yt*x,i[8]=$*n+ct*f+yt*T,i}function IR(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],x=t[7],T=t[8],P=e[0],M=e[1];return i[0]=r,i[1]=s,i[2]=n,i[3]=c,i[4]=l,i[5]=f,i[6]=P*r+M*c+y,i[7]=P*s+M*l+x,i[8]=P*n+M*f+T,i}function MR(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],x=t[7],T=t[8],P=Math.sin(e),M=Math.cos(e);return i[0]=M*r+P*c,i[1]=M*s+P*l,i[2]=M*n+P*f,i[3]=M*c-P*r,i[4]=M*l-P*s,i[5]=M*f-P*n,i[6]=y,i[7]=x,i[8]=T,i}function xw(i,t,e){var r=e[0],s=e[1];return i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i[3]=s*t[3],i[4]=s*t[4],i[5]=s*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function LR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e+e,l=r+r,f=s+s,y=e*c,x=r*c,T=r*l,P=s*c,M=s*l,N=s*f,G=n*c,Z=n*l,X=n*f;return i[0]=1-T-N,i[3]=x-X,i[6]=P+Z,i[1]=x+X,i[4]=1-y-N,i[7]=M-G,i[2]=P-Z,i[5]=M+G,i[8]=1-y-T,i}var f_;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(f_||(f_={}));const BR=Object.freeze([1,0,0,0,1,0,0,0,1]);class Rs extends C3{static get IDENTITY(){return kR()}static get ZERO(){return RR()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return f_}constructor(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(BR)}fromObject(t){return this.check()}fromQuaternion(t){return LR(this,t),this.check()}set(t,e,r,s,n,c,l,f,y){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this[4]=n,this[5]=c,this[6]=l,this[7]=f,this[8]=y,this.check()}setRowMajor(t,e,r,s,n,c,l,f,y){return this[0]=t,this[1]=s,this[2]=l,this[3]=e,this[4]=n,this[5]=f,this[6]=r,this[7]=c,this[8]=y,this.check()}determinant(){return PR(this)}transpose(){return CR(this,this),this.check()}invert(){return TR(this,this),this.check()}multiplyLeft(t){return ww(this,t,this),this.check()}multiplyRight(t){return ww(this,this,t),this.check()}rotate(t){return MR(this,this,t),this.check()}scale(t){return Array.isArray(t)?xw(this,this,t):xw(this,this,[t,t]),this.check()}translate(t){return IR(this,this,t),this.check()}transform(t,e){let r;switch(t.length){case 2:r=y3(e||[-0,-0],t,this);break;case 3:r=S3(e||[-0,-0,-0],t,this);break;case 4:r=w3(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return qp(r,t.length),r}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let ag,lg;function RR(){return ag||(ag=new Rs([0,0,0,0,0,0,0,0,0]),Object.freeze(ag)),ag}function kR(){return lg||(lg=new Rs,Object.freeze(lg)),lg}function OR(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function DR(i,t){if(i===t){var e=t[1],r=t[2],s=t[3],n=t[6],c=t[7],l=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=r,i[9]=n,i[11]=t[14],i[12]=s,i[13]=c,i[14]=l}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function g_(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=t[4],l=t[5],f=t[6],y=t[7],x=t[8],T=t[9],P=t[10],M=t[11],N=t[12],G=t[13],Z=t[14],X=t[15],$=e*l-r*c,ct=e*f-s*c,yt=e*y-n*c,Mt=r*f-s*l,Nt=r*y-n*l,Rt=s*y-n*f,xt=x*G-T*N,qt=x*Z-P*N,zt=x*X-M*N,ot=T*Z-P*G,dt=T*X-M*G,Lt=P*X-M*Z,wt=$*Lt-ct*dt+yt*ot+Mt*zt-Nt*qt+Rt*xt;return wt?(wt=1/wt,i[0]=(l*Lt-f*dt+y*ot)*wt,i[1]=(s*dt-r*Lt-n*ot)*wt,i[2]=(G*Rt-Z*Nt+X*Mt)*wt,i[3]=(P*Nt-T*Rt-M*Mt)*wt,i[4]=(f*zt-c*Lt-y*qt)*wt,i[5]=(e*Lt-s*zt+n*qt)*wt,i[6]=(Z*yt-N*Rt-X*ct)*wt,i[7]=(x*Rt-P*yt+M*ct)*wt,i[8]=(c*dt-l*zt+y*xt)*wt,i[9]=(r*zt-e*dt-n*xt)*wt,i[10]=(N*Nt-G*yt+X*$)*wt,i[11]=(T*yt-x*Nt-M*$)*wt,i[12]=(l*qt-c*ot-f*xt)*wt,i[13]=(e*ot-r*qt+s*xt)*wt,i[14]=(G*ct-N*Mt-Z*$)*wt,i[15]=(x*Mt-T*ct+P*$)*wt,i):null}function NR(i){var t=i[0],e=i[1],r=i[2],s=i[3],n=i[4],c=i[5],l=i[6],f=i[7],y=i[8],x=i[9],T=i[10],P=i[11],M=i[12],N=i[13],G=i[14],Z=i[15],X=t*c-e*n,$=t*l-r*n,ct=t*f-s*n,yt=e*l-r*c,Mt=e*f-s*c,Nt=r*f-s*l,Rt=y*N-x*M,xt=y*G-T*M,qt=y*Z-P*M,zt=x*G-T*N,ot=x*Z-P*N,dt=T*Z-P*G;return X*dt-$*ot+ct*zt+yt*qt-Mt*xt+Nt*Rt}function Pu(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=t[4],f=t[5],y=t[6],x=t[7],T=t[8],P=t[9],M=t[10],N=t[11],G=t[12],Z=t[13],X=t[14],$=t[15],ct=e[0],yt=e[1],Mt=e[2],Nt=e[3];return i[0]=ct*r+yt*l+Mt*T+Nt*G,i[1]=ct*s+yt*f+Mt*P+Nt*Z,i[2]=ct*n+yt*y+Mt*M+Nt*X,i[3]=ct*c+yt*x+Mt*N+Nt*$,ct=e[4],yt=e[5],Mt=e[6],Nt=e[7],i[4]=ct*r+yt*l+Mt*T+Nt*G,i[5]=ct*s+yt*f+Mt*P+Nt*Z,i[6]=ct*n+yt*y+Mt*M+Nt*X,i[7]=ct*c+yt*x+Mt*N+Nt*$,ct=e[8],yt=e[9],Mt=e[10],Nt=e[11],i[8]=ct*r+yt*l+Mt*T+Nt*G,i[9]=ct*s+yt*f+Mt*P+Nt*Z,i[10]=ct*n+yt*y+Mt*M+Nt*X,i[11]=ct*c+yt*x+Mt*N+Nt*$,ct=e[12],yt=e[13],Mt=e[14],Nt=e[15],i[12]=ct*r+yt*l+Mt*T+Nt*G,i[13]=ct*s+yt*f+Mt*P+Nt*Z,i[14]=ct*n+yt*y+Mt*M+Nt*X,i[15]=ct*c+yt*x+Mt*N+Nt*$,i}function lm(i,t,e){var r=e[0],s=e[1],n=e[2],c,l,f,y,x,T,P,M,N,G,Z,X;return t===i?(i[12]=t[0]*r+t[4]*s+t[8]*n+t[12],i[13]=t[1]*r+t[5]*s+t[9]*n+t[13],i[14]=t[2]*r+t[6]*s+t[10]*n+t[14],i[15]=t[3]*r+t[7]*s+t[11]*n+t[15]):(c=t[0],l=t[1],f=t[2],y=t[3],x=t[4],T=t[5],P=t[6],M=t[7],N=t[8],G=t[9],Z=t[10],X=t[11],i[0]=c,i[1]=l,i[2]=f,i[3]=y,i[4]=x,i[5]=T,i[6]=P,i[7]=M,i[8]=N,i[9]=G,i[10]=Z,i[11]=X,i[12]=c*r+x*s+N*n+t[12],i[13]=l*r+T*s+G*n+t[13],i[14]=f*r+P*s+Z*n+t[14],i[15]=y*r+M*s+X*n+t[15]),i}function j1(i,t,e){var r=e[0],s=e[1],n=e[2];return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*n,i[9]=t[9]*n,i[10]=t[10]*n,i[11]=t[11]*n,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function FR(i,t,e,r){var s=r[0],n=r[1],c=r[2],l=Math.hypot(s,n,c),f,y,x,T,P,M,N,G,Z,X,$,ct,yt,Mt,Nt,Rt,xt,qt,zt,ot,dt,Lt,wt,le;return l<Hp?null:(l=1/l,s*=l,n*=l,c*=l,f=Math.sin(e),y=Math.cos(e),x=1-y,T=t[0],P=t[1],M=t[2],N=t[3],G=t[4],Z=t[5],X=t[6],$=t[7],ct=t[8],yt=t[9],Mt=t[10],Nt=t[11],Rt=s*s*x+y,xt=n*s*x+c*f,qt=c*s*x-n*f,zt=s*n*x-c*f,ot=n*n*x+y,dt=c*n*x+s*f,Lt=s*c*x+n*f,wt=n*c*x-s*f,le=c*c*x+y,i[0]=T*Rt+G*xt+ct*qt,i[1]=P*Rt+Z*xt+yt*qt,i[2]=M*Rt+X*xt+Mt*qt,i[3]=N*Rt+$*xt+Nt*qt,i[4]=T*zt+G*ot+ct*dt,i[5]=P*zt+Z*ot+yt*dt,i[6]=M*zt+X*ot+Mt*dt,i[7]=N*zt+$*ot+Nt*dt,i[8]=T*Lt+G*wt+ct*le,i[9]=P*Lt+Z*wt+yt*le,i[10]=M*Lt+X*wt+Mt*le,i[11]=N*Lt+$*wt+Nt*le,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function T3(i,t,e){var r=Math.sin(e),s=Math.cos(e),n=t[4],c=t[5],l=t[6],f=t[7],y=t[8],x=t[9],T=t[10],P=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=n*s+y*r,i[5]=c*s+x*r,i[6]=l*s+T*r,i[7]=f*s+P*r,i[8]=y*s-n*r,i[9]=x*s-c*r,i[10]=T*s-l*r,i[11]=P*s-f*r,i}function zR(i,t,e){var r=Math.sin(e),s=Math.cos(e),n=t[0],c=t[1],l=t[2],f=t[3],y=t[8],x=t[9],T=t[10],P=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=n*s-y*r,i[1]=c*s-x*r,i[2]=l*s-T*r,i[3]=f*s-P*r,i[8]=n*r+y*s,i[9]=c*r+x*s,i[10]=l*r+T*s,i[11]=f*r+P*s,i}function P3(i,t,e){var r=Math.sin(e),s=Math.cos(e),n=t[0],c=t[1],l=t[2],f=t[3],y=t[4],x=t[5],T=t[6],P=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=n*s+y*r,i[1]=c*s+x*r,i[2]=l*s+T*r,i[3]=f*s+P*r,i[4]=y*s-n*r,i[5]=x*s-c*r,i[6]=T*s-l*r,i[7]=P*s-f*r,i}function jR(i,t){var e=t[0],r=t[1],s=t[2],n=t[4],c=t[5],l=t[6],f=t[8],y=t[9],x=t[10];return i[0]=Math.hypot(e,r,s),i[1]=Math.hypot(n,c,l),i[2]=Math.hypot(f,y,x),i}function UR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e+e,l=r+r,f=s+s,y=e*c,x=r*c,T=r*l,P=s*c,M=s*l,N=s*f,G=n*c,Z=n*l,X=n*f;return i[0]=1-T-N,i[1]=x+X,i[2]=P-Z,i[3]=0,i[4]=x-X,i[5]=1-y-N,i[6]=M+G,i[7]=0,i[8]=P+Z,i[9]=M-G,i[10]=1-y-T,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function GR(i,t,e,r,s,n,c){var l=1/(e-t),f=1/(s-r),y=1/(n-c);return i[0]=n*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n*2*f,i[6]=0,i[7]=0,i[8]=(e+t)*l,i[9]=(s+r)*f,i[10]=(c+n)*y,i[11]=-1,i[12]=0,i[13]=0,i[14]=c*n*2*y,i[15]=0,i}function VR(i,t,e,r,s){var n=1/Math.tan(t/2),c;return i[0]=n/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0?(c=1/(r-s),i[10]=(s+r)*c,i[14]=2*s*r*c):(i[10]=-1,i[14]=-2*r),i}var qR=VR;function HR(i,t,e,r,s,n,c){var l=1/(t-e),f=1/(r-s),y=1/(n-c);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*y,i[11]=0,i[12]=(t+e)*l,i[13]=(s+r)*f,i[14]=(c+n)*y,i[15]=1,i}var WR=HR;function JR(i,t,e,r){var s,n,c,l,f,y,x,T,P,M,N=t[0],G=t[1],Z=t[2],X=r[0],$=r[1],ct=r[2],yt=e[0],Mt=e[1],Nt=e[2];return Math.abs(N-yt)<Hp&&Math.abs(G-Mt)<Hp&&Math.abs(Z-Nt)<Hp?OR(i):(x=N-yt,T=G-Mt,P=Z-Nt,M=1/Math.hypot(x,T,P),x*=M,T*=M,P*=M,s=$*P-ct*T,n=ct*x-X*P,c=X*T-$*x,M=Math.hypot(s,n,c),M?(M=1/M,s*=M,n*=M,c*=M):(s=0,n=0,c=0),l=T*c-P*n,f=P*s-x*c,y=x*n-T*s,M=Math.hypot(l,f,y),M?(M=1/M,l*=M,f*=M,y*=M):(l=0,f=0,y=0),i[0]=s,i[1]=l,i[2]=x,i[3]=0,i[4]=n,i[5]=f,i[6]=T,i[7]=0,i[8]=c,i[9]=y,i[10]=P,i[11]=0,i[12]=-(s*N+n*G+c*Z),i[13]=-(l*N+f*G+y*Z),i[14]=-(x*N+T*G+P*Z),i[15]=1,i)}function ZR(){var i=new Ml(4);return Ml!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function XR(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function I3(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function $R(i){var t=i[0],e=i[1],r=i[2],s=i[3];return Math.hypot(t,e,r,s)}function KR(i){var t=i[0],e=i[1],r=i[2],s=i[3];return t*t+e*e+r*r+s*s}function YR(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e*e+r*r+s*s+n*n;return c>0&&(c=1/Math.sqrt(c)),i[0]=e*c,i[1]=r*c,i[2]=s*c,i[3]=n*c,i}function QR(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function tk(i,t,e,r){var s=t[0],n=t[1],c=t[2],l=t[3];return i[0]=s+r*(e[0]-s),i[1]=n+r*(e[1]-n),i[2]=c+r*(e[2]-c),i[3]=l+r*(e[3]-l),i}function _f(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3];return i[0]=e[0]*r+e[4]*s+e[8]*n+e[12]*c,i[1]=e[1]*r+e[5]*s+e[9]*n+e[13]*c,i[2]=e[2]*r+e[6]*s+e[10]*n+e[14]*c,i[3]=e[3]*r+e[7]*s+e[11]*n+e[15]*c,i}function ek(i,t,e){var r=t[0],s=t[1],n=t[2],c=e[0],l=e[1],f=e[2],y=e[3],x=y*r+l*n-f*s,T=y*s+f*r-c*n,P=y*n+c*s-l*r,M=-c*r-l*s-f*n;return i[0]=x*y+M*-c+T*-f-P*-l,i[1]=T*y+M*-l+P*-c-x*-f,i[2]=P*y+M*-f+x*-l-T*-c,i[3]=t[3],i}(function(){var i=ZR();return function(t,e,r,s,n,c){var l,f;for(e||(e=4),r||(r=0),s?f=Math.min(s*e+r,t.length):f=t.length,l=r;l<f;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],n(i,i,c),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();var m_;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(m_||(m_={}));const ik=45*Math.PI/180,rk=1,iy=.1,ry=500,sk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class cr extends C3{static get IDENTITY(){return ok()}static get ZERO(){return nk()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return m_}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,s,n,c,l,f,y,x,T,P,M,N,G,Z){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this[4]=n,this[5]=c,this[6]=l,this[7]=f,this[8]=y,this[9]=x,this[10]=T,this[11]=P,this[12]=M,this[13]=N,this[14]=G,this[15]=Z,this.check()}setRowMajor(t,e,r,s,n,c,l,f,y,x,T,P,M,N,G,Z){return this[0]=t,this[1]=n,this[2]=y,this[3]=M,this[4]=e,this[5]=c,this[6]=x,this[7]=N,this[8]=r,this[9]=l,this[10]=T,this[11]=G,this[12]=s,this[13]=f,this[14]=P,this[15]=Z,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(sk)}fromObject(t){return this.check()}fromQuaternion(t){return UR(this,t),this.check()}frustum(t){const{left:e,right:r,bottom:s,top:n,near:c=iy,far:l=ry}=t;return l===1/0?ak(this,e,r,s,n,c):GR(this,e,r,s,n,c,l),this.check()}lookAt(t){const{eye:e,center:r=[0,0,0],up:s=[0,1,0]}=t;return JR(this,e,r,s),this.check()}ortho(t){const{left:e,right:r,bottom:s,top:n,near:c=iy,far:l=ry}=t;return WR(this,e,r,s,n,c,l),this.check()}orthographic(t){const{fovy:e=ik,aspect:r=rk,focalDistance:s=1,near:n=iy,far:c=ry}=t;Aw(e);const l=e/2,f=s*Math.tan(l),y=f*r;return this.ortho({left:-y,right:y,bottom:-f,top:f,near:n,far:c})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:r=1,near:s=.1,far:n=500}=t;return Aw(e),qR(this,e,r,s,n),this.check()}determinant(){return NR(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const r=this.getScale(e),s=1/r[0],n=1/r[1],c=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*n,t[2]=this[2]*c,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*n,t[6]=this[6]*c,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*n,t[10]=this[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const r=this.getScale(e),s=1/r[0],n=1/r[1],c=1/r[2];return t[0]=this[0]*s,t[1]=this[1]*n,t[2]=this[2]*c,t[3]=this[4]*s,t[4]=this[5]*n,t[5]=this[6]*c,t[6]=this[8]*s,t[7]=this[9]*n,t[8]=this[10]*c,t}transpose(){return DR(this,this),this.check()}invert(){return g_(this,this),this.check()}multiplyLeft(t){return Pu(this,t,this),this.check()}multiplyRight(t){return Pu(this,this,t),this.check()}rotateX(t){return T3(this,this,t),this.check()}rotateY(t){return zR(this,this,t),this.check()}rotateZ(t){return P3(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return FR(this,this,t,e),this.check()}scale(t){return j1(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return lm(this,this,t),this.check()}transform(t,e){return t.length===4?(e=_f(e||[-0,-0,-0,-0],t,this),qp(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;let s;switch(r){case 2:s=_3(e||[-0,-0],t,this);break;case 3:s=F1(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return qp(s,t.length),s}transformAsVector(t,e){let r;switch(t.length){case 2:r=v3(e||[-0,-0],t,this);break;case 3:r=b3(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return qp(r,t.length),r}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}}let cg,hg;function nk(){return cg||(cg=new cr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(cg)),cg}function ok(){return hg||(hg=new cr,Object.freeze(hg)),hg}function Aw(i){if(i>Math.PI*2)throw Error("expected radians")}function ak(i,t,e,r,s,n){const c=2*n/(e-t),l=2*n/(s-r),f=(e+t)/(e-t),y=(s+r)/(s-r),x=-1,T=-1,P=-2*n;return i[0]=c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=f,i[9]=y,i[10]=x,i[11]=T,i[12]=0,i[13]=0,i[14]=P,i[15]=0,i}function Sw(){var i=new Ml(4);return Ml!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function lk(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function M3(i,t,e){e=e*.5;var r=Math.sin(e);return i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i[3]=Math.cos(e),i}function Ew(i,t,e){var r=t[0],s=t[1],n=t[2],c=t[3],l=e[0],f=e[1],y=e[2],x=e[3];return i[0]=r*x+c*l+s*y-n*f,i[1]=s*x+c*f+n*l-r*y,i[2]=n*x+c*y+r*f-s*l,i[3]=c*x-r*l-s*f-n*y,i}function ck(i,t,e){e*=.5;var r=t[0],s=t[1],n=t[2],c=t[3],l=Math.sin(e),f=Math.cos(e);return i[0]=r*f+c*l,i[1]=s*f+n*l,i[2]=n*f-s*l,i[3]=c*f-r*l,i}function hk(i,t,e){e*=.5;var r=t[0],s=t[1],n=t[2],c=t[3],l=Math.sin(e),f=Math.cos(e);return i[0]=r*f-n*l,i[1]=s*f+c*l,i[2]=n*f+r*l,i[3]=c*f-s*l,i}function uk(i,t,e){e*=.5;var r=t[0],s=t[1],n=t[2],c=t[3],l=Math.sin(e),f=Math.cos(e);return i[0]=r*f+s*l,i[1]=s*f-r*l,i[2]=n*f+c*l,i[3]=c*f-n*l,i}function dk(i,t){var e=t[0],r=t[1],s=t[2];return i[0]=e,i[1]=r,i[2]=s,i[3]=Math.sqrt(Math.abs(1-e*e-r*r-s*s)),i}function Rg(i,t,e,r){var s=t[0],n=t[1],c=t[2],l=t[3],f=e[0],y=e[1],x=e[2],T=e[3],P,M,N,G,Z;return M=s*f+n*y+c*x+l*T,M<0&&(M=-M,f=-f,y=-y,x=-x,T=-T),1-M>Hp?(P=Math.acos(M),N=Math.sin(P),G=Math.sin((1-r)*P)/N,Z=Math.sin(r*P)/N):(G=1-r,Z=r),i[0]=G*s+Z*f,i[1]=G*n+Z*y,i[2]=G*c+Z*x,i[3]=G*l+Z*T,i}function pk(i,t){var e=t[0],r=t[1],s=t[2],n=t[3],c=e*e+r*r+s*s+n*n,l=c?1/c:0;return i[0]=-e*l,i[1]=-r*l,i[2]=-s*l,i[3]=n*l,i}function fk(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function L3(i,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),i[3]=.5*r,r=.5/r,i[0]=(t[5]-t[7])*r,i[1]=(t[6]-t[2])*r,i[2]=(t[1]-t[3])*r;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);var n=(s+1)%3,c=(s+2)%3;r=Math.sqrt(t[s*3+s]-t[n*3+n]-t[c*3+c]+1),i[s]=.5*r,r=.5/r,i[3]=(t[n*3+c]-t[c*3+n])*r,i[n]=(t[n*3+s]+t[s*3+n])*r,i[c]=(t[c*3+s]+t[s*3+c])*r}return i}var gk=XR,mk=I3,yk=QR,_k=tk,vk=$R,bk=KR,B3=YR,wk=function(){var i=x3(),t=bw(1,0,0),e=bw(0,1,0);return function(r,s,n){var c=N1(s,n);return c<-.999999?(Bg(i,t,s),SR(i)<1e-6&&Bg(i,e,s),_R(i,i),M3(r,i,Math.PI),r):c>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Bg(i,s,n),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+c,B3(r,r))}}();(function(){var i=Sw(),t=Sw();return function(e,r,s,n,c,l){return Rg(i,r,c,l),Rg(t,s,n,l),Rg(e,i,t,2*l*(1-l)),e}})();(function(){var i=ER();return function(t,e,r,s){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=s[0],i[4]=s[1],i[7]=s[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],B3(t,L3(t,i))}})();const xk=[0,0,0,1];class tf extends k1{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,r,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,r,s){return this[0]=t,this[1]=e,this[2]=r,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return L3(this,t),this.check()}fromAxisRotation(t,e){return M3(this,t,e),this.check()}identity(){return lk(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Ir(t)}get y(){return this[1]}set y(t){this[1]=Ir(t)}get z(){return this[2]}set z(t){this[2]=Ir(t)}get w(){return this[3]}set w(t){this[3]=Ir(t)}len(){return vk(this)}lengthSquared(){return bk(this)}dot(t){return yk(this,t)}rotationTo(t,e){return wk(this,t,e),this.check()}add(t){return gk(this,this,t),this.check()}calculateW(){return dk(this,this),this.check()}conjugate(){return fk(this,this),this.check()}invert(){return pk(this,this),this.check()}lerp(t,e,r){return r===void 0?this.lerp(this,t,e):(_k(this,t,e,r),this.check())}multiplyRight(t){return Ew(this,this,t),this.check()}multiplyLeft(t){return Ew(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return ck(this,this,t),this.check()}rotateY(t){return hk(this,this,t),this.check()}rotateZ(t){return uk(this,this,t),this.check()}scale(t){return mk(this,this,t),this.check()}slerp(t,e,r){let s,n,c;switch(arguments.length){case 1:({start:s=xk,target:n,ratio:c}=t);break;case 2:s=this,n=t,c=e;break;default:s=t,n=e,c=r}return Rg(this,s,n,c),this.check()}transformVector4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new z1;return ek(e,t,this),qp(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const ef={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},Cw=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,Ak={lightSources:{}};function sy(){let{color:i=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(e=>e*t/255)}function Sk(i){let{ambientLight:t,pointLights:e=[],directionalLights:r=[]}=i;const s={};return t?s["lighting_uAmbientLight.color"]=sy(t):s["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((n,c)=>{s["lighting_uPointLight[".concat(c,"].color")]=sy(n),s["lighting_uPointLight[".concat(c,"].position")]=n.position,s["lighting_uPointLight[".concat(c,"].attenuation")]=n.attenuation||[1,0,0]}),s.lighting_uPointLightCount=e.length,r.forEach((n,c)=>{s["lighting_uDirectionalLight[".concat(c,"].color")]=sy(n),s["lighting_uDirectionalLight[".concat(c,"].direction")]=n.direction}),s.lighting_uDirectionalLightCount=r.length,s}function R3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ak;if("lightSources"in i){const{ambientLight:t,pointLights:e,directionalLights:r}=i.lightSources||{};return t||e&&e.length>0||r&&r.length>0?Object.assign({},Sk({ambientLight:t,pointLights:e,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const t={pointLights:[],directionalLights:[]};for(const e of i.lights||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights.push(e);break;case"point":t.pointLights.push(e);break}return R3({lightSources:t})}return{}}const U1={name:"lights",vs:Cw,fs:Cw,getUniforms:R3,defines:{MAX_LIGHTS:3}},Ek=new Uint8Array([0,255,255,255]),Ck={pickingSelectedColor:null,pickingHighlightColor:Ek,pickingActive:!1,pickingAttribute:!1};function Tk(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ck;const t={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=i.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(i.pickingHighlightColor){const e=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return i.pickingActive!==void 0&&(t.picking_uActive=!!i.pickingActive,t.picking_uAttribute=!!i.pickingAttribute),t}const Pk=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Ik=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Mk={name:"picking",vs:Pk,fs:Ik,getUniforms:Tk},k3=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Lk={};function Bk(i){const{ambient:t=.35,diffuse:e=.6,shininess:r=32,specularColor:s=[30,30,30]}=i;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:r,lighting_uSpecularColor:s.map(n=>n/255)}}function O3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Lk;if(!("material"in i))return{};const{material:t}=i;return t?Bk(t):{lighting_uEnabled:!1}}const Rk={name:"gouraud-lighting",dependencies:[U1],vs:k3,defines:{LIGHTING_VERTEX:1},getUniforms:O3},kk={name:"phong-lighting",dependencies:[U1],fs:k3,defines:{LIGHTING_FRAGMENT:1},getUniforms:O3},Ok=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,Dk=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,G1={name:"pbr",vs:Ok,fs:Dk,defines:{LIGHTING_FRAGMENT:1},dependencies:[U1]},Nk=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Fk={name:"transform",vs:Nk,fs:null};class vf{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new vf(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:r="",defines:s={},inject:n={},varyings:c=[],bufferMode:l=35981,transpileToGLSL100:f=!1}=t,y=this._getModuleList(t.modules),x=this._getHash(e),T=this._getHash(r),P=y.map(ct=>this._getHash(ct.name)).sort(),M=c.map(ct=>this._getHash(ct)),N=Object.keys(s).sort(),G=Object.keys(n).sort(),Z=[],X=[];for(const ct of N)Z.push(this._getHash(ct)),Z.push(this._getHash(s[ct]));for(const ct of G)X.push(this._getHash(ct)),X.push(this._getHash(n[ct]));const $="".concat(x,"/").concat(T,"D").concat(Z.join("/"),"M").concat(P.join("/"),"I").concat(X.join("/"),"V").concat(M.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(f?"T":"");if(!this._programCache[$]){const ct=j6(this.gl,{vs:e,fs:r,modules:y,inject:n,defines:s,hookFunctions:this._hookFunctions,transpileToGLSL100:f});this._programCache[$]=new o3(this.gl,{hash:$,vs:ct.vs,fs:ct.fs,varyings:c,bufferMode:l}),this._getUniforms[$]=ct.getUniforms||(yt=>{}),this._useCounts[$]=0}return this._useCounts[$]++,this._programCache[$]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),r={};let s=0;for(let n=0,c=this._defaultModules.length;n<c;++n){const l=this._defaultModules[n],f=l.name;e[s++]=l,r[f]=!0}for(let n=0,c=t.length;n<c;++n){const l=t[n],f=l.name;r[f]||(e[s++]=l,r[f]=!0)}return e.length=s,e}}const zk={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function jk(i,t,e){const r={};let s=t.indices;for(const n in t.attributes){const c=t.attributes[n],l=Uk(n,e);if(n==="indices")s=c;else if(c.constant)r[l]=c.value;else{const f=c.value,y={...c};delete y.value,r[l]=[new Wr(i,f),y],Gk(n,y)}}if(s){const n=s.value||s;ei(n instanceof Uint16Array||n instanceof Uint32Array,'attribute array for "indices" must be of integer type');const c={size:1,isIndexed:s.isIndexed===void 0?!0:s.isIndexed};r.indices=[new Wr(i,{data:n,target:34963}),c]}return r}function Uk(i,t){const{attributeMap:e=zk}=t||{};return e&&e[i]||i}function Gk(i,t){let e;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}ei(Number.isFinite(t.size),"attribute ".concat(i," needs size"))}const ad=2,Vk=1e4,qk="Model needs drawMode and vertexCount",Tw=()=>{},Hk={};class jd{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=Qc("model")}=e;ei(Cm(t)),this.id=r,this.gl=t,this.id=e.id||Qc("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||vf.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:x}=t;this.programProps={program:e,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:x},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},ei(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),qk)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:x}=t;this.programProps={program:e,vs:r,fs:s,modules:n,defines:c,inject:l,varyings:f,bufferMode:y,transpileToGLSL100:x},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return ei(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return ei(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=jk(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Nd(t))return this;const e={};for(const r in t){const s=t[r];e[r]=s.getValue?s.getValue():s}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return P1(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:r,uniforms:s={},attributes:n={},transformFeedback:c=this.transformFeedback,parameters:l={},vertexArray:f=this.vertexArray}=t;this.setAttributes(n),this.updateModuleSettings(e),this.setUniforms(s);let y;ci.priority>=ad&&(y=this._logDrawCallStart(ad));const x=this.vertexArray.getDrawParams(),{isIndexed:T=x.isIndexed,indexType:P=x.indexType,indexOffset:M=x.indexOffset,vertexArrayInstanced:N=x.isInstanced}=this.props;N&&!this.isInstanced&&ci.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:G,instanceCount:Z}=this,{onBeforeRender:X=Tw,onAfterRender:$=Tw}=this.props;X(),this.program.setUniforms(this.uniforms);const ct=this.program.draw(Object.assign(Hk,t,{logPriority:y,uniforms:null,framebuffer:r,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:f,transformFeedback:c,isIndexed:T,indexType:P,isInstanced:G,instanceCount:Z,offset:T?M:0}));return $(),ci.priority>=ad&&this._logDrawCallEnd(y,f,r),ct}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:r,unbindModels:s=[]}=t;let{parameters:n}=t;r&&this._setFeedbackBuffers(r),e&&(n=Object.assign({},n,{35977:e})),s.forEach(c=>c.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:n}))}finally{s.forEach(c=>c.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ci.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:r,modules:s,inject:n,defines:c,varyings:l,bufferMode:f,transpileToGLSL100:y}=this.programProps;t=this.programManager.get({vs:e,fs:r,modules:s,inject:n,defines:c,varyings:l,bufferMode:f,transpileToGLSL100:y}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ei(t instanceof o3,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new e6(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof Wr&&e.delete()}}_setAnimationProps(t){this.animated&&ei(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Nd(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new a3(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:Vk;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),ci.group(ad,">>> DRAWING MODEL ".concat(this.id),{collapsed:ci.level<=2})(),t}_logDrawCallEnd(t,e,r,s){if(t===void 0)return;const n=s6({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:c,unusedTable:l,unusedCount:f}=lw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:y,count:x}=lw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});x>0&&ci.log("MISSING UNIFORMS",Object.keys(y))(),f>0&&ci.log("UNUSED UNIFORMS",Object.keys(l))();const T=o6(this.vertexArray.configuration);ci.table(t,n)(),ci.table(t,c)(),ci.table(t+1,T)(),s&&s.log({logLevel:ad,message:"Rendered to ".concat(s.id)}),ci.groupEnd(ad)()}}class Wk{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:s}=e;return{attributes:Object.assign({},r,t.attributes),transformFeedback:s}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],r=t?e[t]:null;return r?r instanceof Wr?r:r.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,r=this.getBuffer(e);return r?r.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ei(ir(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const s in this.feedbackMap){const n=this.feedbackMap[s];s in e&&(r[n]=s)}Object.assign(r,t.feedbackBuffers);for(const s in r){const n=r[s];if(typeof n=="string"){const c=e[n],{byteLength:l,usage:f,accessor:y}=c;r[s]=this._createNewBuffer(s,{byteLength:l,usage:f,accessor:y})}}return r}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const r=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:r})}_setupTransformFeedback(t,e){let{model:r}=e;const{program:s}=r;t.transformFeedback=new a3(this.gl,{program:s,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceBuffers:e,feedbackBuffers:r})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),r=Object.assign({},t.feedbackBuffers);for(const s in this.feedbackMap){const n=this.feedbackMap[s];e[s]=t.feedbackBuffers[n],r[n]=t.sourceBuffers[s],ei(r[n]instanceof Wr)}return{sourceBuffers:e,feedbackBuffers:r}}_createNewBuffer(t,e){const r=new Wr(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const Jk="transform_uSampler_",cm="transform_uSize_",Pw="transform_position";function Zk(i){let{vs:t,sourceTextureMap:e,targetTextureVarying:r,targetTexture:s}=i,n=Object.keys(e).length,c=null;const l={};let f=t,y={};if(n>0||r){const x=f.split(`
`),T=x.slice();if(x.forEach((P,M,N)=>{if(n>0){const G=Qk(P,e);if(G){const{updatedLine:Z,inject:X}=G;T[M]=Z,y=u_([y,X]),Object.assign(l,G.samplerTextureMap),n--}}r&&!c&&(c=Yk(P,r))}),r){ei(s);const P="".concat(cm).concat(r),M="uniform vec2 ".concat(P,`;
`),N="     vec2 ".concat(Pw," = transform_getPos(").concat(P,`);
     gl_Position = vec4(`).concat(Pw,`, 0, 1.);
`);y=u_([y,{"vs:#decl":M,"vs:#main-start":N}])}f=T.join(`
`)}return{vs:f,targetTextureType:c,inject:y,samplerTextureMap:l}}function Xk(i){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:r}=i;const s={};let n,c;e&&({width:n,height:c}=r,s["".concat(cm).concat(e)]=[n,c]);for(const l in t)({width:n,height:c}=t[l]),s["".concat(cm).concat(l)]=[n,c];return s}function $k(i){return f3(i,["attribute","in"])}function Kk(i){const t="".concat(Jk).concat(i),e="".concat(cm).concat(i),r="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:r}}function Yk(i,t){const e=f3(i,["varying","out"]);return e&&e.name===t?e.type:null}function Qk(i,t){const e={},r=$k(i);if(!r)return null;const{type:s,name:n}=r;if(n&&t[n]){const c="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:f,uniformDeclerations:y}=Kk(n),x=X6(s),T="  ".concat(s," ").concat(n," = transform_getInput(").concat(l,", ").concat(f,").").concat(x,`;
`);return e[l]=n,{updatedLine:c,inject:{"vs:#decl":y,"vs:#main-start":T},samplerTextureMap:e}}return null}const tO={10241:9728,10240:9728,10242:33071,10243:33071},eO="transform_output";class iO{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:r,framebuffer:s,targetTexture:n}=this.bindings[this.currentIndex],c=Object.assign({},e,t.attributes),l=Object.assign({},t.uniforms),f=Object.assign({},t.parameters);let y=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){c.transform_elementID=this.elementIDBuffer;for(const T in this.samplerTextureMap){const P=this.samplerTextureMap[T];l[T]=r[P]}this._setSourceTextureParameters();const x=Xk({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:n});Object.assign(l,x)}return this.hasTargetTexture&&(y=!1,f.viewport=[0,0,s.width,s.height]),{attributes:c,framebuffer:s,uniforms:l,discard:y,parameters:f}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],r=Pm(e);if(!t)return r;const s=r.constructor,n=$6(this.targetTextureType),c=new s(r.length*n/4);let l=0;for(let f=0;f<r.length;f+=4)for(let y=0;y<n;y++)c[l++]=r[f+y];return c}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:r}=t;this._swapTexture=r,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:r}=t;if(r instanceof ua)return r;const s=e[r];return s?(this._targetRefTexName=r,this._createNewTexture(s)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:r={},_targetTexture:s}=t,n=this._createTargetTexture({sourceTextures:r,textureOrReference:s});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:r,targetTexture:n}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((r,s,n)=>{n[s]=s}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new Wr(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),s=this._getNextIndex();this.bindings[s]=this._updateBinding(this.bindings[s],{sourceTextures:e,targetTexture:r})}}_updateBinding(t,e){const{sourceBuffers:r,sourceTextures:s,targetTexture:n}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,s),Object.assign(t.sourceBuffers,r),n){t.targetTexture=n;const{width:c,height:l}=n,{framebuffer:f}=t;f?(f.update({attachments:{36064:n},resizeAttachments:!1}),f.resize({width:c,height:l})):t.framebuffer=new sn(this.gl,{id:"transform-framebuffer",width:c,height:l,attachments:{36064:n}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const r in e)e[r].setParameters(tO)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const r=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:r}}_createNewTexture(t){const e=q4(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:r}=this.bindings[this.currentIndex],{vs:s,uniforms:n,targetTextureType:c,inject:l,samplerTextureMap:f}=Zk({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),y=u_([t.inject||{},l]);this.targetTextureType=c,this.samplerTextureMap=f;const x=t._fs||g3({version:s3(s),input:this.targetTextureVarying,inputType:c,output:eO}),T=this.hasSourceTextures||this.targetTextureVarying?[Fk].concat(t.modules||[]):t.modules;return{vs:s,fs:x,modules:T,uniforms:n,inject:y}}}class V1{static isSupported(t){return ir(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:r}=this;t&&t.delete(),e&&e.delete(),r&&r.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,r=this._updateDrawOptions(t);e&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e)t=t||r.swap();ei(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e){const s=r.getData(t);if(s)return s}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e)r.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new jd(e,Object.assign({},t,{fs:t.fs||g3({version:s3(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of r)e=s.updateModelProps(e);return e}_buildResourceTransforms(t,e){rO(e)&&(this.bufferTransform=new Wk(t,e)),sO(e)&&(this.textureTransform=new iO(t,e)),ei(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const s of r)e=Object.assign(e,s.getDrawOptions(e));return e}}function rO(i){return!!(!Nd(i.feedbackBuffers)||!Nd(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function sO(i){return!!(!Nd(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const Iw={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Wp{static get DRAW_MODE(){return Iw}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e=Qc("geometry"),drawMode:r=Iw.TRIANGLES,attributes:s={},indices:n=null,vertexCount:c=null}=t;this.id=e,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(s,n),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const r in t){let s=t[r];s=ArrayBuffer.isView(s)?{value:s}:s,ei(ArrayBuffer.isView(s.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!s.size&&(s.size=3),r==="indices"?(ei(!this.indices),this.indices=s):this.attributes[r]=s}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let r=1/0;for(const s in t){const n=t[s],{value:c,size:l,constant:f}=n;!f&&c&&l>=1&&(r=Math.min(r,c.length/l))}return ei(Number.isFinite(r)),r}}let nO=1,oO=1;class D3{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:n=1}=t,c=nO++,l={time:0,delay:e,duration:r,rate:s,repeat:n};return this._setChannelTime(l,this.time),this.channels.set(c,l),c}removeChannel(t){this.channels.delete(t);for(const[e,r]of this.animations)r.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const s of e)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:n,channel:c}=s;n.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const r=oO++;return this.animations.set(r,{animation:t,channel:e}),t.setTime(this.getTime(e)),r}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const r=e-t.delay,s=t.duration*t.repeat;r>=s?t.time=t.duration*t.rate:(t.time=Math.max(0,r)%t.duration,t.time*=t.rate)}}const aO=[255,255,255],lO=1;let cO=0;class N3{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id",void 0),H(this,"color",void 0),H(this,"intensity",void 0),H(this,"type","ambient");const{color:e=aO}=t,{intensity:r=lO}=t;this.id=t.id||"ambient-".concat(cO++),this.color=e,this.intensity=r}}const hO=[255,255,255],uO=1,dO=[0,0,-1];let pO=0;class Mw{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id",void 0),H(this,"color",void 0),H(this,"intensity",void 0),H(this,"type","directional"),H(this,"direction",void 0),H(this,"shadow",void 0);const{color:e=hO}=t,{intensity:r=uO}=t,{direction:s=dO}=t,{_shadow:n=!1}=t;this.id=t.id||"directional-".concat(pO++),this.color=e,this.intensity=r,this.type="directional",this.direction=new re(s).normalize().toArray(),this.shadow=n}getProjectedLight(t){return this}}class fO{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};H(this,"id",void 0),H(this,"gl",void 0),H(this,"props",void 0);const{id:r}=e;this.id=r,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class q1 extends fO{constructor(){super(...arguments),H(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return Yc(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:r,viewports:s,views:n,onViewportActive:c,clearStack:l=!0,clearCanvas:f=!0}=t;t.pass=t.pass||"unknown";const y=this.gl;f&&mO(y,e),l&&(this._lastRenderIndex=-1);const x=[];for(const T of s){const P=n&&n[T.id];c==null||c(T);const M=this._getDrawLayerParams(T,t),N=T.subViewports||[T];for(const G of N){const Z=this._drawLayersInViewport(y,{target:e,moduleParameters:r,viewport:G,view:P,pass:t.pass,layers:t.layers},M);x.push(Z)}}return x}_getDrawLayerParams(t,e){let{layers:r,pass:s,isPicking:n=!1,layerFilter:c,cullRect:l,effects:f,moduleParameters:y}=e,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const T=[],P=F3(this._lastRenderIndex+1),M={layer:r[0],viewport:t,isPicking:n,renderPass:s,cullRect:l},N={};for(let G=0;G<r.length;G++){const Z=r[G],X=this._shouldDrawLayer(Z,M,c,N),$={shouldDrawLayer:X};X&&!x&&($.layerRenderIndex=P(Z,X),$.moduleParameters=this._getModuleParameters(Z,f,s,y),$.layerParameters=this.getLayerParameters(Z,G,t)),T[G]=$}return T}_drawLayersInViewport(t,e,r){let{layers:s,moduleParameters:n,pass:c,target:l,viewport:f,view:y}=e;const x=gO(t,{moduleParameters:n,target:l,viewport:f});if(y&&y.props.clear){const P=y.props.clear===!0?{color:!0,depth:!0}:y.props.clear;Pl(t,{scissorTest:!0,scissor:x},()=>P1(t,P))}const T={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};Yc(t,{viewport:x});for(let P=0;P<s.length;P++){const M=s[P],{shouldDrawLayer:N,layerRenderIndex:G,moduleParameters:Z,layerParameters:X}=r[P];if(N&&M.props.pickable&&T.pickableCount++,M.isComposite)T.compositeCount++;else if(N){T.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,G),Z.viewport=f;try{M._drawLayer({moduleParameters:Z,uniforms:{layerIndex:G},parameters:X})}catch($){M.raiseError($,"drawing ".concat(M," to ").concat(c))}}}return T}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,r){return t.props.parameters}_shouldDrawLayer(t,e,r,s){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let n=t.parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(e))return!1;e.layer=n,n=n.parent}if(r){const c=e.layer.id;if(c in s||(s[c]=r(e)),!s[c])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,r,s){var n;const c=Object.assign(Object.create(((n=t.internalState)===null||n===void 0?void 0:n.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Dd(this.gl)});if(e)for(const f of e){var l;Object.assign(c,(l=f.getModuleParameters)===null||l===void 0?void 0:l.call(f,t))}return Object.assign(c,this.getModuleParameters(t,e),s)}}function F3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={},r=(s,n)=>{const c=s.props._offset,l=s.id,f=s.parent&&s.parent.id;let y;if(f&&!(f in t)&&r(s.parent,!1),f in e){const x=e[f]=e[f]||F3(t[f],t);y=x(s,n),e[l]=x}else Number.isFinite(c)?(y=c+(t[f]||0),e[l]=null):y=i;return n&&y>=i&&(i=y+1),t[l]=y,y};return r}function gO(i,t){let{moduleParameters:e,target:r,viewport:s}=t;const n=r&&r.id!=="default-framebuffer",c=e&&e.devicePixelRatio||Dd(i),l=n?r.height:i.drawingBufferHeight,f=s;return[f.x*c,l-(f.y+f.height)*c,f.width*c,f.height*c]}function mO(i,t){const e=t?t.width:i.drawingBufferWidth,r=t?t.height:i.drawingBufferHeight;Yc(i,{viewport:[0,0,e,r]}),i.clear(16640)}class yO extends q1{constructor(t,e){super(t,e),H(this,"shadowMap",void 0),H(this,"depthBuffer",void 0),H(this,"fbo",void 0),this.shadowMap=new ua(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new bd(t,{format:33189,width:1,height:1}),this.fbo=new sn(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;Pl(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=t.viewports[0],s=Dd(this.gl),n=r.width*s,c=r.height*s;(n!==e.width||c!==e.height)&&e.resize({width:n,height:c}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const z3="#define SMOOTH_EDGE_RADIUS 0.5",_O=`
`.concat(z3,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),vO=`
`.concat(z3,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),bO={name:"geometry",vs:_O,fs:vO},wO=Object.keys(mr).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(mr[i],";")).join(""),xO=Object.keys(oc).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(oc[i],";")).join(""),AO=Object.keys(o_).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(o_[i],";")).join(""),SO="".concat(wO,`
`).concat(xO,`
`).concat(AO,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function EO(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}return!1}function bf(i){let t={},e;return r=>{for(const s in r)if(!EO(r[s],t[s])){e=i(r),t=r;break}return e}}const Lw=[0,0,0,0],CO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],j3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],TO=[0,0,0],U3=[0,0,0],PO=bf(LO);function G3(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U3;e.length<3&&(e=[e[0],e[1],0]);let r=e,s,n=!0;switch(t===mr.LNGLAT_OFFSETS||t===mr.METER_OFFSETS?s=e:s=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case oc.WEB_MERCATOR:(t===mr.LNGLAT||t===mr.CARTESIAN)&&(s=[0,0,0],n=!1);break;case oc.WEB_MERCATOR_AUTO_OFFSET:t===mr.LNGLAT?r=s:t===mr.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],s=i.unprojectPosition(r),r[0]-=e[0],r[1]-=e[1],r[2]-=e[2]);break;case oc.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case oc.GLOBE:n=!1,s=null;break;default:n=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:n}}function IO(i,t,e){const{viewMatrixUncentered:r,projectionMatrix:s}=i;let{viewMatrix:n,viewProjectionMatrix:c}=i,l=Lw,f=Lw,y=i.cameraPosition;const{geospatialOrigin:x,shaderCoordinateOrigin:T,offsetMode:P}=G3(i,t,e);return P&&(f=i.projectPosition(x||T),y=[y[0]-f[0],y[1]-f[1],y[2]-f[2]],f[3]=1,l=_f([],f,c),n=r||n,c=Pu([],s,n),c=Pu([],c,CO)),{viewMatrix:n,viewProjectionMatrix:c,projectionCenter:l,originCommon:f,cameraPosCommon:y,shaderCoordinateOrigin:T,geospatialOrigin:x}}function MO(i){let{viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:s=mr.DEFAULT,coordinateOrigin:n=U3,autoWrapLongitude:c=!1}=i;s===mr.DEFAULT&&(s=t.isGeospatial?mr.LNGLAT:mr.CARTESIAN);const l=PO({viewport:t,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:n});return l.project_uWrapLongitude=c,l.project_uModelMatrix=r||j3,l}function LO(i){let{viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s}=i;const{projectionCenter:n,viewProjectionMatrix:c,originCommon:l,cameraPosCommon:f,shaderCoordinateOrigin:y,geospatialOrigin:x}=IO(t,r,s),T=t.getDistanceScales(),P=[t.width*e,t.height*e],M=_f([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={project_uCoordinateSystem:r,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:y,project_uCommonOrigin:l.slice(0,3),project_uCenter:n,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:P,project_uDevicePixelRatio:e,project_uFocalDistance:M,project_uCommonUnitsPerMeter:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:TO,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:j3,project_uCameraPosition:f};if(x){const G=t.getDistanceScales(x);switch(r){case mr.METER_OFFSETS:N.project_uCommonUnitsPerWorldUnit=G.unitsPerMeter,N.project_uCommonUnitsPerWorldUnit2=G.unitsPerMeter2;break;case mr.LNGLAT:case mr.LNGLAT_OFFSETS:t._pseudoMeters||(N.project_uCommonUnitsPerMeter=G.unitsPerMeter),N.project_uCommonUnitsPerWorldUnit=G.unitsPerDegree,N.project_uCommonUnitsPerWorldUnit2=G.unitsPerDegree2;break;case mr.CARTESIAN:N.project_uCommonUnitsPerWorldUnit=[1,1,G.unitsPerMeter[2]],N.project_uCommonUnitsPerWorldUnit2=[0,0,G.unitsPerMeter2[2]];break}}return N}const BO={};function RO(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:BO;return"viewport"in i?MO(i):{}}const H1={name:"project",dependencies:[Q6,bO],vs:SO,getUniforms:RO};function kO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Cd(i,t){const e=_f([],t,i);return I3(e,e,1/e[3]),e}function Bw(i,t){const e=i%t;return e<0?t+e:e}function y_(i,t,e){return i<t?t:i>e?e:i}function OO(i){return Math.log(i)*Math.LOG2E}const W1=Math.log2||OO;function th(i,t){if(!i)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Cl=Math.PI,V3=Cl/4,Ga=Cl/180,__=180/Cl,Ud=512,hm=4003e4,ug=85.051129,DO=1.5;function NO(i){return W1(i)}function rf(i){const[t,e]=i;th(Number.isFinite(t)),th(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const r=t*Ga,s=e*Ga,n=Ud*(r+Cl)/(2*Cl),c=Ud*(Cl+Math.log(Math.tan(V3+s*.5)))/(2*Cl);return[n,c]}function Gd(i){const[t,e]=i,r=t/Ud*(2*Cl)-Cl,s=2*(Math.atan(Math.exp(e/Ud*(2*Cl)-Cl))-V3);return[r*__,s*__]}function FO(i){const{latitude:t}=i;th(Number.isFinite(t));const e=Math.cos(t*Ga);return NO(hm*e)-9}function kg(i){const t=Math.cos(i*Ga);return Ud/hm/t}function v_(i){const{latitude:t,longitude:e,highPrecision:r=!1}=i;th(Number.isFinite(t)&&Number.isFinite(e));const s=Ud,n=Math.cos(t*Ga),c=s/360,l=c/n,f=s/hm/n,y={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[c,l,f],degreesPerUnit:[1/c,1/l,1/f]};if(r){const x=Ga*Math.tan(t*Ga)/n,T=c*x/2,P=s/hm*x,M=P/l*f;y.unitsPerDegree2=[0,T,P],y.unitsPerMeter2=[M,0,M]}return y}function q3(i,t){const[e,r,s]=i,[n,c,l]=t,{unitsPerMeter:f,unitsPerMeter2:y}=v_({longitude:e,latitude:r,highPrecision:!0}),x=rf(i);x[0]+=n*(f[0]+y[0]*c),x[1]+=c*(f[1]+y[1]*c);const T=Gd(x),P=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[T[0],T[1],P]:T}function zO(i){const{height:t,pitch:e,bearing:r,altitude:s,scale:n,center:c}=i,l=kO();lm(l,l,[0,0,-s]),T3(l,l,-e*Ga),P3(l,l,r*Ga);const f=n/t;return j1(l,l,[f,f,f]),c&&lm(l,l,yR([],c)),l}function jO(i){const{width:t,height:e,altitude:r,pitch:s=0,offset:n,center:c,scale:l,nearZMultiplier:f=1,farZMultiplier:y=1}=i;let{fovy:x=um(DO)}=i;r!==void 0&&(x=um(r));const T=x*Ga,P=s*Ga,M=H3(x);let N=M;c&&(N+=c[2]*l/Math.cos(P)/e);const G=T*(.5+(n?n[1]:0)/e),Z=Math.sin(G)*N/Math.sin(y_(Math.PI/2-P-G,.01,Math.PI-.01)),X=Math.sin(P)*Z+N,$=N*10,ct=Math.min(X*y,$);return{fov:T,aspect:t/e,focalDistance:M,near:f,far:ct}}function um(i){return 2*Math.atan(.5/i)*__}function H3(i){return .5/Math.tan(.5*i*Ga)}function W3(i,t){const[e,r,s=0]=i;return th(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(s)),Cd(t,[e,r,s,1])}function J1(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[r,s,n]=i;if(th(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(n))return Cd(t,[r,s,n,1]);const c=Cd(t,[r,s,0,1]),l=Cd(t,[r,s,1,1]),f=c[2],y=l[2],x=f===y?0:((e||0)-f)/(y-f);return m3([],c,l,x)}function UO(i){const{width:t,height:e,bounds:r,minExtent:s=0,maxZoom:n=24,offset:c=[0,0]}=i,[[l,f],[y,x]]=r,T=GO(i.padding),P=rf([l,y_(x,-ug,ug)]),M=rf([y,y_(f,-ug,ug)]),N=[Math.max(Math.abs(M[0]-P[0]),s),Math.max(Math.abs(M[1]-P[1]),s)],G=[t-T.left-T.right-Math.abs(c[0])*2,e-T.top-T.bottom-Math.abs(c[1])*2];th(G[0]>0&&G[1]>0);const Z=G[0]/N[0],X=G[1]/N[1],$=(T.right-T.left)/2/Z,ct=(T.top-T.bottom)/2/X,yt=[(M[0]+P[0])/2+$,(M[1]+P[1])/2+ct],Mt=Gd(yt),Nt=Math.min(n,W1(Math.abs(Math.min(Z,X))));return th(Number.isFinite(Nt)),{longitude:Mt[0],latitude:Mt[1],zoom:Nt}}function GO(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(th(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const Rw=Math.PI/180;function VO(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:e,height:r,unproject:s}=i,n={targetZ:t},c=s([0,r],n),l=s([e,r],n);let f,y;const x=i.fovy?.5*i.fovy*Rw:Math.atan(.5/i.altitude),T=(90-i.pitch)*Rw;return x>T-.01?(f=kw(i,0,t),y=kw(i,e,t)):(f=s([0,0],n),y=s([e,0],n)),[c,l,y,f]}function kw(i,t,e){const{pixelUnprojectionMatrix:r}=i,s=Cd(r,[t,0,1,1]),n=Cd(r,[t,i.height,1,1]),c=(e*i.distanceScales.unitsPerMeter[2]-s[2])/(n[2]-s[2]),l=m3([],s,n,c),f=Gd(l);return f.push(e),f}const Ow=512;function qO(i){const{width:t,height:e,pitch:r=0}=i;let{longitude:s,latitude:n,zoom:c,bearing:l=0}=i;(s<-180||s>180)&&(s=Bw(s+180,360)-180),(l<-180||l>180)&&(l=Bw(l+180,360)-180);const f=W1(e/Ow);if(c<=f)c=f,n=0;else{const y=e/2/Math.pow(2,c),x=Gd([0,y])[1];if(n<x)n=x;else{const T=Gd([0,Ow-y])[1];n>T&&(n=T)}}return{width:t,height:e,longitude:s,latitude:n,zoom:c,pitch:r,bearing:l}}const HO=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,WO=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,JO=bf(YO),ZO=bf(QO),XO=[0,0,0,1],$O=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function KO(i,t){const[e,r,s]=i,n=J1([e,r,s],t);return Number.isFinite(s)?n:[n[0],n[1],0]}function YO(i){let{viewport:t,center:e}=i;return new cr(t.viewProjectionMatrix).invert().transform(e)}function QO(i){let{viewport:t,shadowMatrices:e}=i;const r=[],s=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,c=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(l=>KO(l,s));for(const l of e){const f=l.clone().translate(new re(t.center).negate()),y=c.map(T=>f.transform(T)),x=new cr().ortho({left:Math.min(...y.map(T=>T[0])),right:Math.max(...y.map(T=>T[0])),bottom:Math.min(...y.map(T=>T[1])),top:Math.max(...y.map(T=>T[1])),near:Math.min(...y.map(T=>-T[2])),far:Math.max(...y.map(T=>-T[2]))});r.push(x.multiplyRight(l))}return r}function tD(i,t){const{shadowEnabled:e=!0}=i;if(!e||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||XO,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},s=JO({viewport:i.viewport,center:t.project_uCenter}),n=[],c=ZO({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let l=0;l<i.shadowMatrices.length;l++){const f=c[l],y=f.clone().translate(new re(i.viewport.center).negate());t.project_uCoordinateSystem===mr.LNGLAT&&t.project_uProjectionMode===oc.WEB_MERCATOR?(c[l]=y,n[l]=s):(c[l]=f.clone().multiplyRight($O),n[l]=y.transform(s))}for(let l=0;l<c.length;l++)r["shadow_uViewProjectionMatrices[".concat(l,"]")]=c[l],r["shadow_uProjectCenters[".concat(l,"]")]=n[l],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(l)]=i.shadowMaps[l]:r["shadow_uShadowMap".concat(l)]=i.dummyShadowMap;return r}const ny={name:"shadow",dependencies:[H1],vs:HO,fs:WO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?tD(i,t):{}}},eD={color:[255,255,255],intensity:1},Dw=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],iD=[0,0,0,200/255];class Z1{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id","lighting-effect"),H(this,"props",void 0),H(this,"shadowColor",iD),H(this,"shadow",void 0),H(this,"ambientLight",void 0),H(this,"directionalLights",void 0),H(this,"pointLights",void 0),H(this,"shadowPasses",[]),H(this,"shadowMaps",[]),H(this,"dummyShadowMap",null),H(this,"programManager",void 0),H(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const r=t[e];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,e){let{layers:r,layerFilter:s,viewports:n,onViewportActive:c,views:l}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=vf.getDefaultProgramManager(t),ny&&this.programManager.addDefaultModule(ny)),this.dummyShadowMap||(this.dummyShadowMap=new ua(t,{width:1,height:1}));for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:r,layerFilter:s,viewports:n,onViewportActive:c,views:l,moduleParameters:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:t})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(ny),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const r=new cr().lookAt({eye:new re(e.direction).negate()});t.push(r)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const r=new yO(t);this.shadowPasses[e]=r,this.shadowMaps[e]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:r}=this;!t&&e.length===0&&r.length===0&&(this.ambientLight=new N3(eD),this.directionalLights.push(new Mw(Dw[0]),new Mw(Dw[1])))}}class rD{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"_pool",[]),H(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,r){let{size:s=1,type:n,padding:c=0,copy:l=!1,initialize:f=!1,maxCount:y}=r;const x=n||t&&t.constructor||Float32Array,T=e*s+c;if(ArrayBuffer.isView(t)){if(T<=t.length)return t;if(T*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new x(t.buffer,0,T)}let P=1/0;y&&(P=y*s+c);const M=this._allocate(x,T,f,P);return t&&l?M.set(t):f||M.fill(0,0,4),this._release(t),M}release(t){this._release(t)}_allocate(t,e,r,s){let n=Math.max(Math.ceil(e*this.opts.overAlloc),1);n>s&&(n=s);const c=this._pool,l=t.BYTES_PER_ELEMENT*n,f=c.findIndex(y=>y.byteLength>=l);if(f>=0){const y=new t(c.splice(f,1)[0],0,n);return r&&y.fill(0),y}return new t(n)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:r}=t,{byteLength:s}=r,n=e.findIndex(c=>c.byteLength>=s);n<0?e.push(r):(n>0||e.length<this.opts.poolSize)&&e.splice(n,0,r),e.length>this.opts.poolSize&&e.shift()}}const sf=new rD;function Np(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sD(i){return[i[12],i[13],i[14]]}function nD(i){return{left:ld(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:ld(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:ld(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:ld(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:ld(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:ld(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const Nw=new re;function ld(i,t,e,r){Nw.set(i,t,e);const s=Nw.len();return{distance:r/s,normal:new re(-i/s,-t/s,-e/s)}}function oD(i){return i-Math.fround(i)}let Sp;function oy(i,t){const{size:e=1,startIndex:r=0}=t,s=t.endIndex!==void 0?t.endIndex:i.length,n=(s-r)/e;Sp=sf.allocate(Sp,n,{type:Float32Array,size:e*2});let c=r,l=0;for(;c<s;){for(let f=0;f<e;f++){const y=i[c++];Sp[l+f]=y,Sp[l+f+e]=oD(y)}l+=e*2}return Sp.subarray(0,n*e*2)}function aD(i){let t=null,e=!1;for(const r of i)r&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}const lD=Math.PI/180,cD=Np(),Fw=[0,0,0],hD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function uD(i){let{width:t,height:e,orthographic:r,fovyRadians:s,focalDistance:n,padding:c,near:l,far:f}=i;const y=t/e,x=r?new cr().orthographic({fovy:s,aspect:y,focalDistance:n,near:l,far:f}):new cr().perspective({fovy:s,aspect:y,near:l,far:f});if(c){const{left:T=0,right:P=0,top:M=0,bottom:N=0}=c,G=Wc((T+t-P)/2,0,t)-t/2,Z=Wc((M+e-N)/2,0,e)-e/2;x[8]-=G*2/t,x[9]+=Z*2/e}return x}class Zd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};H(this,"id",void 0),H(this,"x",void 0),H(this,"y",void 0),H(this,"width",void 0),H(this,"height",void 0),H(this,"padding",void 0),H(this,"isGeospatial",void 0),H(this,"zoom",void 0),H(this,"focalDistance",void 0),H(this,"position",void 0),H(this,"modelMatrix",void 0),H(this,"distanceScales",void 0),H(this,"scale",void 0),H(this,"center",void 0),H(this,"cameraPosition",void 0),H(this,"projectionMatrix",void 0),H(this,"viewMatrix",void 0),H(this,"viewMatrixUncentered",void 0),H(this,"viewMatrixInverse",void 0),H(this,"viewProjectionMatrix",void 0),H(this,"pixelProjectionMatrix",void 0),H(this,"pixelUnprojectionMatrix",void 0),H(this,"resolution",void 0),H(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||hD,this.focalDistance=t.focalDistance||1,this.position=t.position||Fw,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:r}=t;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?oc.WEB_MERCATOR:oc.WEB_MERCATOR_AUTO_OFFSET:oc.IDENTITY}equals(t){return t instanceof Zd?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Il(t.projectionMatrix,this.projectionMatrix)&&Il(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.projectPosition(t),s=W3(r,this.pixelProjectionMatrix),[n,c]=s,l=e?c:this.height-c;return t.length===2?[n,l]:[n,l,s[2]]}unproject(t){let{topLeft:e=!0,targetZ:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[s,n,c]=t,l=e?n:this.height-n,f=r&&r*this.distanceScales.unitsPerMeter[2],y=J1([s,l,c],this.pixelUnprojectionMatrix,f),[x,T,P]=this.unprojectPosition(y);return Number.isFinite(c)?[x,T,P]:Number.isFinite(r)?[x,T,r]:[x,T]}projectPosition(t){const[e,r]=this.projectFlat(t),s=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,r,s]}unprojectPosition(t){const[e,r]=this.unprojectFlat(t),s=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,r,s]}projectFlat(t){if(this.isGeospatial){const e=rf(t);return e[1]=Wc(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?Gd(t):t}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},e=this.unproject([0,0],t),r=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),n=this.unproject([this.width,this.height],t);return[Math.min(e[0],r[0],s[0],n[0]),Math.min(e[1],r[1],s[1],n[1]),Math.max(e[0],r[0],s[0],n[0]),Math.max(e[1],r[1],s[1],n[1])]}getDistanceScales(t){return t?v_({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:r,width:s=1,height:n=1}=t;return e<this.x+this.width&&this.x<e+s&&r<this.y+this.height&&this.y<r+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,nD(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,r=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=FO({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||v_({latitude:r,longitude:e}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:n,modelMatrix:c}=t;let l=Fw;if(n&&(l=c?new cr(c).transformAsVector(n,[]):n),this.isGeospatial){const f=this.projectPosition([e,r,0]);this.center=new re(l).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:e=cD,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:n,fovy:c=75,near:l=.1,far:f=1e3,padding:y=null,focalDistance:x=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new cr().multiplyRight(e).translate(new re(this.center).negate()),this.projectionMatrix=r||uD({width:this.width,height:this.height,orthographic:s,fovyRadians:n||c*lD,focalDistance:x,padding:y,near:l,far:f});const T=Np();Pu(T,T,this.projectionMatrix),Pu(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=g_([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=sD(this.viewMatrixInverse);const P=Np(),M=Np();j1(P,P,[this.width/2,-this.height/2,1]),lm(P,P,[1,-1,0]),Pu(M,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=M,this.pixelUnprojectionMatrix=g_(Np(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||vr.warn("Pixel project matrix not invertible")()}}H(Zd,"displayName","Viewport");class Lu extends Zd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:e=0,longitude:r=0,zoom:s=0,pitch:n=0,bearing:c=0,nearZMultiplier:l=.1,farZMultiplier:f=1.01,nearZ:y,farZ:x,orthographic:T=!1,projectionMatrix:P,repeat:M=!1,worldOffset:N=0,position:G,padding:Z,legacyMeterSizes:X=!1}=t;let{width:$,height:ct,altitude:yt=1.5}=t;const Mt=Math.pow(2,s);$=$||1,ct=ct||1;let Nt,Rt=null;if(P)yt=P[5]/2,Nt=um(yt);else{t.fovy?(Nt=t.fovy,yt=H3(Nt)):Nt=um(yt);let qt;if(Z){const{top:zt=0,bottom:ot=0}=Z;qt=[0,Wc((zt+ct-ot)/2,0,ct)-ct/2]}Rt=jO({width:$,height:ct,scale:Mt,center:G&&[0,0,G[2]*kg(e)],offset:qt,pitch:n,fovy:Nt,nearZMultiplier:l,farZMultiplier:f}),Number.isFinite(y)&&(Rt.near=y),Number.isFinite(x)&&(Rt.far=x)}let xt=zO({height:ct,pitch:n,bearing:c,scale:Mt,altitude:yt});N&&(xt=new cr().translate([512*N,0,0]).multiplyLeft(xt)),super({...t,width:$,height:ct,viewMatrix:xt,longitude:r,latitude:e,zoom:s,...Rt,fovy:Nt,focalDistance:yt}),H(this,"longitude",void 0),H(this,"latitude",void 0),H(this,"pitch",void 0),H(this,"bearing",void 0),H(this,"altitude",void 0),H(this,"fovy",void 0),H(this,"orthographic",void 0),H(this,"_subViewports",void 0),H(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=r,this.zoom=s,this.pitch=n,this.bearing=c,this.altitude=yt,this.fovy=Nt,this.orthographic=T,this._subViewports=M?[]:null,this._pseudoMeters=X,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),r=Math.ceil((t[2]-180)/360);for(let s=e;s<=r;s++){const n=s?new Lu({...this,worldOffset:s}):this;this._subViewports.push(n)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,r]=this.projectFlat(t),s=(t[2]||0)*kg(t[1]);return[e,r,s]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,r]=this.unprojectFlat(t),s=(t[2]||0)/kg(r);return[e,r,s]}addMetersToLngLat(t,e){return q3(t,e)}panByPosition(t,e){const r=J1(e,this.pixelUnprojectionMatrix),s=this.projectFlat(t),n=vw([],s,uR([],r)),c=vw([],this.center,n),[l,f]=this.unprojectFlat(c);return{longitude:l,latitude:f}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=VO(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:r,height:s}=this,{longitude:n,latitude:c,zoom:l}=UO({width:r,height:s,bounds:t,...e});return new Lu({width:r,height:s,longitude:n,latitude:c,zoom:l})}}H(Lu,"displayName","WebMercatorViewport");const zw=[0,0,0];function ay(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=t.projectPosition(i);if(e&&t instanceof Lu){const[s,n,c=0]=i,l=t.getDistanceScales([s,n]);r[2]=c*l.unitsPerMeter[2]}return r}function dD(i){const{viewport:t,modelMatrix:e,coordinateOrigin:r}=i;let{coordinateSystem:s,fromCoordinateSystem:n,fromCoordinateOrigin:c}=i;return s===mr.DEFAULT&&(s=t.isGeospatial?mr.LNGLAT:mr.CARTESIAN),n===void 0&&(n=s),c===void 0&&(c=r),{viewport:t,coordinateSystem:s,coordinateOrigin:r,modelMatrix:e,fromCoordinateSystem:n,fromCoordinateOrigin:c}}function J3(i,t){let{viewport:e,modelMatrix:r,coordinateSystem:s,coordinateOrigin:n,offsetMode:c}=t,[l,f,y=0]=i;switch(r&&([l,f,y]=_f([],[l,f,y,1],r)),s){case mr.LNGLAT:return ay([l,f,y],e,c);case mr.LNGLAT_OFFSETS:return ay([l+n[0],f+n[1],y+(n[2]||0)],e,c);case mr.METER_OFFSETS:return ay(q3(n,[l,f,y]),e,c);case mr.CARTESIAN:default:return e.isGeospatial?[l+n[0],f+n[1],y+n[2]]:e.projectPosition([l,f,y])}}function pD(i,t){const{viewport:e,coordinateSystem:r,coordinateOrigin:s,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:l}=dD(t),{autoOffset:f=!0}=t,{geospatialOrigin:y=zw,shaderCoordinateOrigin:x=zw,offsetMode:T=!1}=f?G3(e,r,s):{},P=J3(i,{viewport:e,modelMatrix:n,coordinateSystem:c,coordinateOrigin:l,offsetMode:T});if(T){const M=e.projectPosition(y||x);AR(P,P,M)}return P}const jw={blendFunc:[1,0,32771,0],blendEquation:32774};class Z3 extends q1{constructor(){super(...arguments),H(this,"pickZ",void 0),H(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:r,views:s,viewports:n,onViewportActive:c,pickingFBO:l,deviceRect:{x:f,y,width:x,height:T},cullRect:P,effects:M,pass:N="picking",pickZ:G,moduleParameters:Z}=t;const X=this.gl;this.pickZ=G;const $=this._resetColorEncoder(G),ct=Pl(X,{scissorTest:!0,scissor:[f,y,x,T],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...jw,blend:!G},()=>super.render({target:l,layers:e,layerFilter:r,views:s,viewports:n,onViewportActive:c,cullRect:P,effects:M==null?void 0:M.filter(yt=>yt.useInPicking),pass:N,isPicking:!0,moduleParameters:Z}));return this._colorEncoderState=null,{decodePickingColor:$&&gD.bind(null,$),stats:ct}}shouldDrawLayer(t){const{pickable:e,operation:r}=t.props;return e&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,r){const s={...t.props.parameters},{pickable:n,operation:c}=t.props;return this._colorEncoderState?n&&c.includes("draw")&&(Object.assign(s,jw),s.blend=!0,s.blendColor=fD(this._colorEncoderState,t,r)):s.blend=!1,c.includes("terrain")&&(s.blend=!1),s}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function fD(i,t,e){const{byLayer:r,byAlpha:s}=i;let n,c=r.get(t);return c?(c.viewports.push(e),n=c.a):(n=r.size+1,n<=255?(c={a:n,layer:t,viewports:[e]},r.set(t,c),s[n]=c):(vr.warn("Too many pickable layers, only picking the first 255")(),n=0)),[0,0,0,n/255]}function gD(i,t){const e=i.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const gd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},dm=Symbol.for("component"),Uh=Symbol.for("propTypes"),ly=Symbol.for("deprecatedProps"),Td=Symbol.for("asyncPropDefaults"),Bu=Symbol.for("asyncPropOriginal"),Fh=Symbol.for("asyncPropResolved");function Im(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(i)?X3(i,t,[]):t(i)?[i]:[]}function X3(i,t,e){let r=-1;for(;++r<i.length;){const s=i[r];Array.isArray(s)?X3(s,t,e):t(s)&&e.push(s)}return e}function mD(i){let{target:t,source:e,start:r=0,count:s=1}=i;const n=e.length,c=s*n;let l=0;for(let f=r;l<n;l++)t[f++]=e[l];for(;l<c;)l<c-l?(t.copyWithin(r+l,r,r+l),l*=2):(t.copyWithin(r+l,r,r+c-l),l=c);return t}class yD{constructor(t,e,r){H(this,"id",void 0),H(this,"context",void 0),H(this,"isLoaded",void 0),H(this,"persistent",void 0),H(this,"_loadCount",0),H(this,"_subscribers",new Set),H(this,"_data",void 0),H(this,"_loader",void 0),H(this,"_error",void 0),H(this,"_content",void 0),this.id=t,this.context=r,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const r=++this._loadCount;let s=t;typeof t=="string"&&(s=Vh(t)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(n=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=n)}).catch(n=>{this._loadCount===r&&(this.isLoaded=!0,this._error=n||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const n of this._subscribers)n.onChange(this.getData())}}class _D{constructor(t){let{gl:e,protocol:r}=t;H(this,"protocol",void 0),H(this,"_context",void 0),H(this,"_resources",void 0),H(this,"_consumers",void 0),H(this,"_pruneRequest",void 0),this.protocol=r||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:e,data:r,forceUpdate:s=!1,persistent:n=!0}=t,c=this._resources[e];c?c.setData(r,s):(c=new yD(e,r,this._context),this._resources[e]=c),c.persistent=n}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const r=this._consumers[e];if(r){for(const s in r){const n=r[s],c=this._resources[n.resourceId];c&&c.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:r,consumerId:s,requestId:n="default"}=t;const{_resources:c,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const f=c[e];if(this._track(s,n,f,r),f)return f.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,r,s){const n=this._consumers,c=n[t]=n[t]||{},l=c[e]||{},f=l.resourceId&&this._resources[l.resourceId];f&&(f.unsubscribe(l),this.prune()),r&&(c[e]=l,l.onChange=s,l.resourceId=r.id,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const vD=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,X1={name:"project32",dependencies:[H1],vs:vD},$1={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Mk},bD=[H1],wD=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function xD(i){const t=vf.getDefaultProgramManager(i);for(const e of bD)t.addDefaultModule(e);for(const e of wD)t.addShaderHook(e);return t}const AD="layerManager.setLayers",SD="layerManager.activateViewport";class ED{constructor(t){let{deck:e,stats:r,viewport:s,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};H(this,"layers",void 0),H(this,"context",void 0),H(this,"resourceManager",void 0),H(this,"_lastRenderedLayers",[]),H(this,"_needsRedraw",!1),H(this,"_needsUpdate",!1),H(this,"_nextLayers",null),H(this,"_debug",!1),H(this,"activateViewport",c=>{$n(SD,this,c),c&&(this.context.viewport=c)}),this.layers=[],this.resourceManager=new _D({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&xD(t),stats:r||new C1({id:"deck.gl"}),viewport:s||new Zd({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:n||new D3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(t);e=e||s}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(e=>t.find(r=>e.id.indexOf(r)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){$n(AD,this,e,t),this._lastRenderedLayers=t;const r=Im(t,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,r){r.raiseError(e,"".concat(t," of ").concat(r))}_updateLayers(t,e){const r={};for(const c of t)r[c.id]?vr.warn("Multiple old layers with same id ".concat(c.id))():r[c.id]=c;const s=[];this._updateSublayersRecursively(e,r,s),this._finalizeOldLayers(r);let n=!1;for(const c of s)if(c.hasUniformTransition()){n="Uniform transition in ".concat(c);break}this._needsUpdate=n,this.layers=s}_updateSublayersRecursively(t,e,r){for(const s of t){s.context=this.context;const n=e[s.id];n===null&&vr.warn("Multiple new layers with same id ".concat(s.id))(),e[s.id]=null;let c=null;try{this._debug&&n!==s&&s.validateProps(),n?(this._transferLayerState(n,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),c=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}c&&this._updateSublayersRecursively(c,e,r)}}_finalizeOldLayers(t){for(const e in t){const r=t[e];r&&this._finalizeLayer(r)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=gd.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=gd.MATCHED,e!==t&&(t.lifecycle=gd.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=gd.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=gd.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function ac(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!ac(i[r],t[r],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const r=Object.keys(i),s=Object.keys(t);if(r.length!==s.length)return!1;for(const n of r)if(!t.hasOwnProperty(n)||!ac(i[n],t[n],e-1))return!1;return!0}return!1}class CD{constructor(t){H(this,"width",void 0),H(this,"height",void 0),H(this,"views",void 0),H(this,"viewState",void 0),H(this,"controllers",void 0),H(this,"timeline",void 0),H(this,"_viewports",void 0),H(this,"_viewportMap",void 0),H(this,"_isUpdating",void 0),H(this,"_needsRedraw",void 0),H(this,"_needsUpdate",void 0),H(this,"_eventManager",void 0),H(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,r=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(r):r}getViewport(t){return this._viewportMap[t]}unproject(t,e){const r=this.getViewports(),s={x:t[0],y:t[1]};for(let n=r.length-1;n>=0;--n){const c=r[n];if(c.containsPixel(s)){const l=t.slice();return l[0]-=c.x,l[1]-=c.y,c.unproject(l,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=Im(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!ac(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):vr.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const r=e.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var n;return(n=this.getView(t.id))===null||n===void 0?void 0:n.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(t,e,r,s){const n=t.controller;if(n&&r){const c={...e,...n,id:t.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==n.type)&&(s=this._createController(t,c)),s&&s.setProps(c),s}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=t.length;s--;){const n=t[s],c=this.getViewState(n),l=n.makeViewport({viewState:c,width:this.width,height:this.height});let f=e[n.id];const y=!!n.controller;y&&!f&&(r=!0),(r||!y)&&f&&(f.finalize(),f=null),this.controllers[n.id]=this._updateController(n,c,l,f),l&&this._viewports.unshift(l)}for(const s in e){const n=e[s];n&&!this.controllers[s]&&n.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((r,s)=>!t[s].equals(e[s]))}}const TD=/([0-9]+\.?[0-9]*)(%|px)/;function Ph(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const t=TD.exec(i);if(t&&t.length>=3){const e=t[2]==="%",r=parseFloat(t[1]);return{position:e?r/100:r,relative:e}}default:throw new Error("Could not parse position string ".concat(i))}}function Ih(i,t){return i.relative?Math.round(i.position*t):i.position}function Bn(i,t){if(!i)throw new Error(t||"deck.gl: assertion failed.")}class PD{constructor(t){H(this,"id",void 0),H(this,"viewportInstance",void 0),H(this,"_x",void 0),H(this,"_y",void 0),H(this,"_width",void 0),H(this,"_height",void 0),H(this,"_padding",void 0),H(this,"props",void 0);const{id:e,x:r=0,y:s=0,width:n="100%",height:c="100%",padding:l=null,viewportInstance:f}=t||{};Bn(!f||f instanceof Zd),this.viewportInstance=f,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Ph(r),this._y=Ph(s),this._width=Ph(n),this._height=Ph(c),this._padding=l&&{left:Ph(l.left||0),right:Ph(l.right||0),top:Ph(l.top||0),bottom:Ph(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&ac(this.props,t.props,2)}makeViewport(t){let{width:e,height:r,viewState:s}=t;if(this.viewportInstance)return this.viewportInstance;s=this.filterViewState(s);const n=this.getDimensions({width:e,height:r});return!n.height||!n.width?null:new this.ViewportType({...s,...this.props,...n})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const r in this.props.viewState)r!=="id"&&(e[r]=this.props.viewState[r]);return e}return t}getDimensions(t){let{width:e,height:r}=t;const s={x:Ih(this._x,e),y:Ih(this._y,r),width:Ih(this._width,e),height:Ih(this._height,r)};return this._padding&&(s.padding={left:Ih(this._padding.left,e),top:Ih(this._padding.top,r),right:Ih(this._padding.right,e),bottom:Ih(this._padding.bottom,r)}),s}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class wf{constructor(t){H(this,"_inProgress",void 0),H(this,"_handle",void 0),H(this,"_timeline",void 0),H(this,"time",void 0),H(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,r;this.cancel(),this.settings=t,this._inProgress=!0,(e=(r=this.settings).onStart)===null||e===void 0||e.call(r,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Uw=()=>{},b_={BREAK:1,SNAP_TO_END:2,IGNORE:3},ID=i=>i,MD=b_.BREAK;class LD{constructor(t){H(this,"getControllerState",void 0),H(this,"props",void 0),H(this,"propsInTransition",void 0),H(this,"transition",void 0),H(this,"onViewStateChange",void 0),H(this,"onStateChange",void 0),H(this,"_onTransitionUpdate",e=>{const{time:r,settings:{interpolator:s,startProps:n,endProps:c,duration:l,easing:f}}=e,y=f(r/l),x=s.interpolateProps(n,c,y);this.propsInTransition=this.getControllerState({...this.props,...x}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new wf(t.timeline),this.onViewStateChange=t.onViewStateChange||Uw,this.onStateChange=t.onStateChange||Uw}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const r=this.props;if(this.props=t,!r||this._shouldIgnoreViewportChange(r,t))return!1;if(this._isTransitionEnabled(t)){let s=r;if(this.transition.inProgress){const{interruption:n,endProps:c}=this.transition.settings;s={...r,...n===b_.SNAP_TO_END?c:this.propsInTransition||r}}this._triggerTransition(s,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:r}=t;return(e>0||e==="auto")&&!!r}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===b_.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const r=this.getControllerState(t),s=this.getControllerState(e).shortestPathFrom(r),n=e.transitionInterpolator,c=n.getDuration?n.getDuration(t,e):e.transitionDuration;if(c===0)return;const l=n.initializeProps(t,s);this.propsInTransition={};const f={duration:c,easing:e.transitionEasing||ID,interpolator:n,interruption:e.transitionInterruption||MD,startProps:l.start,endProps:l.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class BD{constructor(t){H(this,"_propsToCompare",void 0),H(this,"_propsToExtract",void 0),H(this,"_requiredProps",void 0);const{compare:e,extract:r,required:s}=t;this._propsToCompare=e,this._propsToExtract=r||e,this._requiredProps=s}arePropsEqual(t,e){for(const r of this._propsToCompare)if(!(r in t)||!(r in e)||!Il(t[r],e[r]))return!1;return!0}initializeProps(t,e){const r={},s={};for(const n of this._propsToExtract)(n in t||n in e)&&(r[n]=t[n],s[n]=e[n]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const r=t[e];Bn(Number.isFinite(r)||Array.isArray(r),"".concat(e," is required for transition"))})}}const RD=["longitude","latitude","zoom","bearing","pitch"],kD=["longitude","latitude","zoom"];class $3 extends BD{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,r=Array.isArray(t)?{}:t;r.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:RD,required:kD},super(r.transitionProps),H(this,"opts",void 0),this.opts=r}initializeProps(t,e){const r=super.initializeProps(t,e),{makeViewport:s,around:n}=this.opts;if(s&&n){const c=s(t),l=s(e),f=c.unproject(n);r.start.around=n,Object.assign(r.end,{around:l.project(f),aroundPosition:f,width:e.width,height:e.height})}return r}interpolateProps(t,e,r){const s={};for(const n of this._propsToExtract)s[n]=am(t[n]||0,e[n]||0,r);if(e.aroundPosition&&this.opts.makeViewport){const n=this.opts.makeViewport({...e,...s});Object.assign(s,n.panByPosition(e.aroundPosition,am(t.around,e.around,r)))}return s}}const Mh={transitionDuration:0},OD=300,dg=i=>1-(1-i)*(1-i),cd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},fu={};class DD{constructor(t){H(this,"props",void 0),H(this,"state",{}),H(this,"transitionManager",void 0),H(this,"eventManager",void 0),H(this,"onViewStateChange",void 0),H(this,"onStateChange",void 0),H(this,"makeViewport",void 0),H(this,"_controllerState",void 0),H(this,"_events",{}),H(this,"_interactionState",{isDragging:!1}),H(this,"_customEvents",[]),H(this,"_eventStartBlocked",null),H(this,"_panMove",!1),H(this,"invertPan",!1),H(this,"dragMode","rotate"),H(this,"inertia",0),H(this,"scrollZoom",!0),H(this,"dragPan",!0),H(this,"dragRotate",!0),H(this,"doubleClickZoom",!0),H(this,"touchZoom",!0),H(this,"touchRotate",!1),H(this,"keyboard",!0),this.transitionManager=new LD({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:r}=this.props,{offsetCenter:s}=t;return[s.x-e,s.y-r]}isPointInBounds(t,e){const{width:r,height:s}=this.props;if(e&&e.handled)return!1;const n=t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=s;return n&&e&&e.stopPropagation(),n}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?OD:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:n=!0,doubleClickZoom:c=!0,touchZoom:l=!0,touchRotate:f=!1,keyboard:y=!0}=t,x=!!this.onViewStateChange;this.toggleEvents(cd.WHEEL,x&&r),this.toggleEvents(cd.PAN,x),this.toggleEvents(cd.PINCH,x&&(l||f)),this.toggleEvents(cd.TRIPLE_PAN,x&&f),this.toggleEvents(cd.DOUBLE_TAP,x&&c),this.toggleEvents(cd.KEYBOARD,x&&y),this.scrollZoom=r,this.dragPan=s,this.dragRotate=n,this.doubleClickZoom=c,this.touchZoom=l,this.touchRotate=f,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(r=>{this._events[r]!==e&&(this._events[r]=e,e?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s={...t.getViewportProps(),...e},n=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(r),n){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:c})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let r=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:e});return this._panMove=r,this.updateViewport(s,Mh,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),r=this.controllerState.pan({pos:e});return this.updateViewport(r,Mh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const r=this.getCenter(t),s=[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2],n=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:dg},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),r=this.controllerState.rotate({pos:e});return this.updateViewport(r,Mh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const r=this.getCenter(t),s=[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2],n=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:dg},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:n}=t;let c=2/(1+Math.exp(-Math.abs(n*r)));n<0&&c!==0&&(c=1/c);const l=this.controllerState.zoom({pos:e,scale:c});return this.updateViewport(l,{...this._getTransitionProps({around:e}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.controllerState.rotateStart({pos:e});return this.updateViewport(r,Mh,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const r=this.controllerState.rotate({pos:e});return this.updateViewport(r,Mh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const r=this.getCenter(t),s=[r[0],r[1]+=t.velocityY*e/2],n=this.controllerState.rotate({pos:s});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:dg},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return fu._startPinchRotation=t.rotation,fu._lastPinchEvent=t,this.updateViewport(r,Mh,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:r}=t,s=this.getCenter(t);e=e.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=t;e=e.rotate({deltaAngleX:fu._startPinchRotation-r})}return this.updateViewport(e,Mh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),fu._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:r}=fu;if(this.touchZoom&&e&&r&&t.scale!==r.scale){const s=this.getCenter(t);let n=this.controllerState.rotateEnd();const c=Math.log2(t.scale),l=(c-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),f=Math.pow(2,c+l*e/2);n=n.zoom({pos:s,scale:f}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:s}),transitionDuration:e,transitionEasing:dg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return fu._startPinchRotation=null,fu._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:e,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:n,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let f;const y={};switch(t.srcEvent.code){case"Minus":f=e?l.zoomOut(r).zoomOut(r):l.zoomOut(r),y.isZooming=!0;break;case"Equal":f=e?l.zoomIn(r).zoomIn(r):l.zoomIn(r),y.isZooming=!0;break;case"ArrowLeft":e?(f=l.rotateLeft(n),y.isRotating=!0):(f=l.moveLeft(s),y.isPanning=!0);break;case"ArrowRight":e?(f=l.rotateRight(n),y.isRotating=!0):(f=l.moveRight(s),y.isPanning=!0);break;case"ArrowUp":e?(f=l.rotateUp(c),y.isRotating=!0):(f=l.moveUp(s),y.isPanning=!0);break;case"ArrowDown":e?(f=l.rotateDown(c),y.isRotating=!0):(f=l.moveDown(s),y.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),y),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?Mh:t?{...e,transitionInterpolator:new $3({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class ND{constructor(t,e){H(this,"_viewportProps",void 0),H(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Gw=5,FD=1.2;class zD extends ND{constructor(t){const{width:e,height:r,latitude:s,longitude:n,zoom:c,bearing:l=0,pitch:f=0,altitude:y=1.5,position:x=[0,0,0],maxZoom:T=20,minZoom:P=0,maxPitch:M=60,minPitch:N=0,startPanLngLat:G,startZoomLngLat:Z,startRotatePos:X,startBearing:$,startPitch:ct,startZoom:yt,normalize:Mt=!0}=t;Bn(Number.isFinite(n)),Bn(Number.isFinite(s)),Bn(Number.isFinite(c)),super({width:e,height:r,latitude:s,longitude:n,zoom:c,bearing:l,pitch:f,altitude:y,maxZoom:T,minZoom:P,maxPitch:M,minPitch:N,normalize:Mt,position:x},{startPanLngLat:G,startZoomLngLat:Z,startRotatePos:X,startBearing:$,startPitch:ct,startZoom:yt}),H(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:r}=t;const s=this.getState().startPanLngLat||this._unproject(r);if(!s)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(s,e);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:r=0,deltaAngleY:s=0}=t;const{startRotatePos:n,startBearing:c,startPitch:l}=this.getState();if(!n||c===void 0||l===void 0)return this;let f;return e?f=this._getNewRotation(e,n,l,c):f={bearing:c+r,pitch:l+s},this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:r,scale:s}=t,{startZoom:n,startZoomLngLat:c}=this.getState();if(c||(n=this.getViewportProps().zoom,c=this._unproject(r)||this._unproject(e)),!c)return this;const{maxZoom:l,minZoom:f}=this.getViewportProps();let y=n+Math.log2(s);y=Wc(y,f,l);const x=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...x.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:n}=r;return Math.abs(s-e.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(n-e.longitude)>180&&(r.longitude=n<0?n+360:n-360),r}applyConstraints(t){const{maxZoom:e,minZoom:r,zoom:s}=t;t.zoom=Wc(s,r,e);const{maxPitch:n,minPitch:c,pitch:l}=t;t.pitch=Wc(l,c,n);const{normalize:f=!0}=t;return f&&Object.assign(t,qO(t)),t}_zoomFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.zoom({pos:[e/2,r/2],scale:t})}_panFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.pan({startPos:[e/2,r/2],pos:[e/2+t[0],r/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,r,s){const n=t[0]-e[0],c=t[1]-e[1],l=t[1],f=e[1],{width:y,height:x}=this.getViewportProps(),T=n/y;let P=0;c>0?Math.abs(x-f)>Gw&&(P=c/(f-x)*FD):c<0&&f>Gw&&(P=1-l/f),P=Wc(P,-1,1);const{minPitch:M,maxPitch:N}=this.getViewportProps(),G=s+180*T;let Z=r;return P>0?Z=r+P*(N-r):P<0&&(Z=r-P*(M-r)),{pitch:Z,bearing:G}}}class jD extends DD{constructor(){super(...arguments),H(this,"ControllerState",zD),H(this,"transition",{transitionDuration:300,transitionInterpolator:new $3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),H(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class K1 extends PD{get ViewportType(){return Lu}get ControllerType(){return jD}}H(K1,"displayName","MapView");const UD=new Z1;function GD(i,t){var e,r;const s=(e=i.order)!==null&&e!==void 0?e:1/0,n=(r=t.order)!==null&&r!==void 0?r:1/0;return s-n}class VD{constructor(){H(this,"effects",void 0),H(this,"_resolvedEffects",[]),H(this,"_defaultEffects",[]),H(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(r=>r.id===t.id)){const r=e.findIndex(s=>GD(s,t)>0);r<0?e.push(t):e.splice(r,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(ac(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const s of this.effects)e[s.id]=s;const r=[];for(const s of t){const n=e[s.id];n&&n!==s?n.setProps?(n.setProps(s.props),r.push(n)):(n.cleanup(),r.push(s)):r.push(s),delete e[s.id]}for(const s in e)e[s].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),t.some(s=>s instanceof Z1)||this._resolvedEffects.push(UD),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class qD extends q1{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const HD="deckRenderer.renderLayers";class WD{constructor(t){H(this,"gl",void 0),H(this,"layerFilter",void 0),H(this,"drawPickingColors",void 0),H(this,"drawLayersPass",void 0),H(this,"pickLayersPass",void 0),H(this,"renderCount",void 0),H(this,"_needsRedraw",void 0),H(this,"renderBuffers",void 0),H(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new qD(t),this.pickLayersPass=new Z3(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||sn.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,n=e.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,$n(HD,this,n,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const r of t)e.preRenderStats[r.id]=r.preRender(this.gl,e),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new sn(this.gl),new sn(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:r}=this,s={...e,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const n of t)if(n.postRender){if(n.id===this.lastPostProcessEffect){s.target=e.target,n.postRender(this.gl,s);break}const c=n.postRender(this.gl,s);s.inputBuffer=c,s.swapBuffer=c===r[0]?r[1]:r[0]}}}const JD={pickedColor:null,pickedObjectIndex:-1};function ZD(i){let{pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:s,deviceRadius:n,deviceRect:c}=i;const{x:l,y:f,width:y,height:x}=c;let T=n*n,P=-1,M=0;for(let N=0;N<x;N++){const G=N+f-s,Z=G*G;if(Z>T)M+=4*y;else for(let X=0;X<y;X++){if(t[M+3]-1>=0){const $=X+l-r,ct=$*$+Z;ct<=T&&(T=ct,P=M)}M+=4}}if(P>=0){const N=t.slice(P,P+4),G=e(N);if(G){const Z=Math.floor(P/4/y),X=P/4-Z*y;return{...G,pickedColor:N,pickedX:l+X,pickedY:f+Z}}vr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return JD}function XD(i){let{pickedColors:t,decodePickingColor:e}=i;const r=new Map;if(t){for(let s=0;s<t.length;s+=4)if(t[s+3]-1>=0){const n=t.slice(s,s+4),c=n.join(",");if(!r.has(c)){const l=e(n);l?r.set(c,{...l,color:n}):vr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function K3(i){let{pickInfo:t,viewports:e,pixelRatio:r,x:s,y:n,z:c}=i,l=e[0];e.length>1&&(l=KD((t==null?void 0:t.pickedViewports)||e,{x:s,y:n}));let f;if(l){const y=[s-l.x,n-l.y];c!==void 0&&(y[2]=c),f=l.unproject(y)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:s,y:n,pixel:[s,n],coordinate:f,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function $D(i){const{pickInfo:t,lastPickedInfo:e,mode:r,layers:s}=i,{pickedColor:n,pickedLayer:c,pickedObjectIndex:l}=t,f=c?[c]:[];if(r==="hover"){const T=e.index,P=e.layerId,M=c?c.props.id:null;if(M!==P||l!==T){if(M!==P){const N=s.find(G=>G.props.id===P);N&&f.unshift(N)}e.layerId=M,e.index=l,e.info=null}}const y=K3(i),x=new Map;return x.set(null,y),f.forEach(T=>{let P={...y};T===c&&(P.color=n,P.index=l,P.picked=!0),P=Y3({layer:T,info:P,mode:r});const M=P.layer;T===c&&r==="hover"&&(e.info=P),x.set(M.id,P),r==="hover"&&M.updateAutoHighlight(P)}),x}function Y3(i){let{layer:t,info:e,mode:r}=i;for(;t&&e;){const s=e.layer||null;e.sourceLayer=s,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:s}),t=t.parent}return e}function KD(i,t){for(let e=i.length-1;e>=0;e--){const r=i[e];if(r.containsPixel(t))return r}return i[0]}class YD{constructor(t){H(this,"gl",void 0),H(this,"pickingFBO",void 0),H(this,"depthFBO",void 0),H(this,"pickLayersPass",void 0),H(this,"layerFilter",void 0),H(this,"lastPickedInfo",void 0),H(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new Z3(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:r,layers:s,viewports:n}=t,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const l=c&&c.layer&&c.layer.id,f=c&&c.viewport&&c.viewport.id,y=l?s.find(P=>P.id===l):null,x=f&&n.find(P=>P.id===f)||n[0],T=x&&x.unproject([e-x.x,r-x.y]);return{...c,x:e,y:r,viewport:x,coordinate:T,layer:y}}_resizeBuffer(){var t,e;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new sn(r),sn.isSupported(r,{colorBufferFloat:!0}))){const s=new sn(r);s.attach({36064:new ua(r,{format:ir(r)?34836:6408,type:5126})}),this.depthFBO=s}(t=this.pickingFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return e.length?e:null}_pickClosestObject(t){let{layers:e,views:r,viewports:s,x:n,y:c,radius:l=0,depth:f=1,mode:y="query",unproject3D:x,onViewportActive:T,effects:P}=t;const M=this._getPickable(e),N=Dd(this.gl);if(!M)return{result:[],emptyInfo:K3({viewports:s,x:n,y:c,pixelRatio:N})};this._resizeBuffer();const G=W0(this.gl,[n,c],!0),Z=[G.x+Math.floor(G.width/2),G.y+Math.floor(G.height/2)],X=Math.round(l*N),{width:$,height:ct}=this.pickingFBO,yt=this._getPickingRect({deviceX:Z[0],deviceY:Z[1],deviceRadius:X,deviceWidth:$,deviceHeight:ct}),Mt={x:n-l,y:c-l,width:l*2+1,height:l*2+1};let Nt;const Rt=[],xt=new Set;for(let qt=0;qt<f;qt++){let zt;if(yt){const dt=this._drawAndSample({layers:M,views:r,viewports:s,onViewportActive:T,deviceRect:yt,cullRect:Mt,effects:P,pass:"picking:".concat(y)});zt=ZD({...dt,deviceX:Z[0],deviceY:Z[1],deviceRadius:X,deviceRect:yt})}else zt={pickedColor:null,pickedObjectIndex:-1};let ot;if(zt.pickedLayer&&x&&this.depthFBO){const{pickedColors:dt}=this._drawAndSample({layers:[zt.pickedLayer],views:r,viewports:s,onViewportActive:T,deviceRect:{x:zt.pickedX,y:zt.pickedY,width:1,height:1},cullRect:Mt,effects:P,pass:"picking:".concat(y,":z")},!0);dt[3]&&(ot=dt[0])}zt.pickedLayer&&qt+1<f&&(xt.add(zt.pickedLayer),zt.pickedLayer.disablePickingIndex(zt.pickedObjectIndex)),Nt=$D({pickInfo:zt,lastPickedInfo:this.lastPickedInfo,mode:y,layers:M,viewports:s,x:n,y:c,z:ot,pixelRatio:N});for(const dt of Nt.values())dt.layer&&Rt.push(dt);if(!zt.pickedColor)break}for(const qt of xt)qt.restorePickingColors();return{result:Rt,emptyInfo:Nt.get(null)}}_pickVisibleObjects(t){let{layers:e,views:r,viewports:s,x:n,y:c,width:l=1,height:f=1,mode:y="query",maxObjects:x=null,onViewportActive:T,effects:P}=t;const M=this._getPickable(e);if(!M)return[];this._resizeBuffer();const N=Dd(this.gl),G=W0(this.gl,[n,c],!0),Z=G.x,X=G.y+G.height,$=W0(this.gl,[n+l,c+f],!0),ct=$.x+$.width,yt=$.y,Mt={x:Z,y:yt,width:ct-Z,height:X-yt},Nt=this._drawAndSample({layers:M,views:r,viewports:s,onViewportActive:T,deviceRect:Mt,cullRect:{x:n,y:c,width:l,height:f},effects:P,pass:"picking:".concat(y)}),Rt=XD(Nt),xt=new Map,qt=Number.isFinite(x);for(let ot=0;ot<Rt.length;ot++){var zt;if(qt&&x&&xt.size>=x)break;const dt=Rt[ot];let Lt={color:dt.pickedColor,layer:null,index:dt.pickedObjectIndex,picked:!0,x:n,y:c,pixelRatio:N};Lt=Y3({layer:dt.pickedLayer,info:Lt,mode:y});const wt=(zt=Lt.object)!==null&&zt!==void 0?zt:"".concat(Lt.layer.id,"[").concat(Lt.index,"]");xt.has(wt)||xt.set(wt,Lt)}return Array.from(xt.values())}_drawAndSample(t){let{layers:e,views:r,viewports:s,onViewportActive:n,deviceRect:c,cullRect:l,effects:f,pass:y}=t,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const T=x?this.depthFBO:this.pickingFBO,P={layers:e,layerFilter:this.layerFilter,views:r,viewports:s,onViewportActive:n,pickingFBO:T,deviceRect:c,cullRect:l,effects:f,pass:y,pickZ:x,preRenderStats:{}};for(const ct of f)ct.useInPicking&&(P.preRenderStats[ct.id]=ct.preRender(this.gl,P));const{decodePickingColor:M}=this.pickLayersPass.render(P),{x:N,y:G,width:Z,height:X}=c,$=new(x?Float32Array:Uint8Array)(Z*X*4);return Pm(T,{sourceX:N,sourceY:G,sourceWidth:Z,sourceHeight:X,target:$}),{pickedColors:$,decodePickingColor:M}}_getPickingRect(t){let{deviceX:e,deviceY:r,deviceRadius:s,deviceWidth:n,deviceHeight:c}=t;const l=Math.max(0,e-s),f=Math.max(0,r-s),y=Math.min(n,e+s+1)-l,x=Math.min(c,r+s+1)-f;return y<=0||x<=0?null:{x:l,y:f,width:y,height:x}}}const QD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class t8{constructor(t){H(this,"el",null),H(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,QD),e.appendChild(this.el))}setTooltip(t,e,r){const s=this.el;if(s){if(typeof t=="string")s.innerText=t;else if(t)t.text&&(s.innerText=t.text),t.html&&(s.innerHTML=t.html),t.className&&(s.className=t.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform="translate(".concat(e,"px, ").concat(r,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(s.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Q3={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(t,e,r,s){var n=["","webkit","Moz","MS","ms","o"],c=e.createElement("div"),l="function",f=Math.round,y=Math.abs,x=Date.now;function T(rt,mt,Dt){return setTimeout(ct(rt,Dt),mt)}function P(rt,mt,Dt){return Array.isArray(rt)?(M(rt,Dt[mt],Dt),!0):!1}function M(rt,mt,Dt){var ue;if(rt)if(rt.forEach)rt.forEach(mt,Dt);else if(rt.length!==s)for(ue=0;ue<rt.length;)mt.call(Dt,rt[ue],ue,rt),ue++;else for(ue in rt)rt.hasOwnProperty(ue)&&mt.call(Dt,rt[ue],ue,rt)}function N(rt,mt,Dt){var ue="DEPRECATED METHOD: "+mt+`
`+Dt+` AT 
`;return function(){var Se=new Error("get-stack-trace"),gi=Se&&Se.stack?Se.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Mi=t.console&&(t.console.warn||t.console.log);return Mi&&Mi.call(t.console,ue,gi),rt.apply(this,arguments)}}var G;typeof Object.assign!="function"?G=function(rt){if(rt===s||rt===null)throw new TypeError("Cannot convert undefined or null to object");for(var mt=Object(rt),Dt=1;Dt<arguments.length;Dt++){var ue=arguments[Dt];if(ue!==s&&ue!==null)for(var Se in ue)ue.hasOwnProperty(Se)&&(mt[Se]=ue[Se])}return mt}:G=Object.assign;var Z=N(function(rt,mt,Dt){for(var ue=Object.keys(mt),Se=0;Se<ue.length;)(!Dt||Dt&&rt[ue[Se]]===s)&&(rt[ue[Se]]=mt[ue[Se]]),Se++;return rt},"extend","Use `assign`."),X=N(function(rt,mt){return Z(rt,mt,!0)},"merge","Use `assign`.");function $(rt,mt,Dt){var ue=mt.prototype,Se;Se=rt.prototype=Object.create(ue),Se.constructor=rt,Se._super=ue,Dt&&G(Se,Dt)}function ct(rt,mt){return function(){return rt.apply(mt,arguments)}}function yt(rt,mt){return typeof rt==l?rt.apply(mt&&mt[0]||s,mt):rt}function Mt(rt,mt){return rt===s?mt:rt}function Nt(rt,mt,Dt){M(zt(mt),function(ue){rt.addEventListener(ue,Dt,!1)})}function Rt(rt,mt,Dt){M(zt(mt),function(ue){rt.removeEventListener(ue,Dt,!1)})}function xt(rt,mt){for(;rt;){if(rt==mt)return!0;rt=rt.parentNode}return!1}function qt(rt,mt){return rt.indexOf(mt)>-1}function zt(rt){return rt.trim().split(/\s+/g)}function ot(rt,mt,Dt){if(rt.indexOf&&!Dt)return rt.indexOf(mt);for(var ue=0;ue<rt.length;){if(Dt&&rt[ue][Dt]==mt||!Dt&&rt[ue]===mt)return ue;ue++}return-1}function dt(rt){return Array.prototype.slice.call(rt,0)}function Lt(rt,mt,Dt){for(var ue=[],Se=[],gi=0;gi<rt.length;){var Mi=mt?rt[gi][mt]:rt[gi];ot(Se,Mi)<0&&ue.push(rt[gi]),Se[gi]=Mi,gi++}return Dt&&(mt?ue=ue.sort(function(pr,fs){return pr[mt]>fs[mt]}):ue=ue.sort()),ue}function wt(rt,mt){for(var Dt,ue,Se=mt[0].toUpperCase()+mt.slice(1),gi=0;gi<n.length;){if(Dt=n[gi],ue=Dt?Dt+Se:mt,ue in rt)return ue;gi++}return s}var le=1;function oe(){return le++}function de(rt){var mt=rt.ownerDocument||rt;return mt.defaultView||mt.parentWindow||t}var te=/mobile|tablet|ip(ad|hone|od)|android/i,me="ontouchstart"in t,ge=wt(t,"PointerEvent")!==s,ke=me&&te.test(navigator.userAgent),it="touch",Et="pen",It="mouse",Ut="kinect",Xt=25,Kt=1,ie=2,Qt=4,Ae=8,Le=1,Fe=2,Ge=4,Xe=8,pe=16,Pt=Fe|Ge,Zt=Xe|pe,ii=Pt|Zt,Pe=["x","y"],ve=["clientX","clientY"];function Ee(rt,mt){var Dt=this;this.manager=rt,this.callback=mt,this.element=rt.element,this.target=rt.options.inputTarget,this.domHandler=function(ue){yt(rt.options.enable,[rt])&&Dt.handler(ue)},this.init()}Ee.prototype={handler:function(){},init:function(){this.evEl&&Nt(this.element,this.evEl,this.domHandler),this.evTarget&&Nt(this.target,this.evTarget,this.domHandler),this.evWin&&Nt(de(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Rt(this.element,this.evEl,this.domHandler),this.evTarget&&Rt(this.target,this.evTarget,this.domHandler),this.evWin&&Rt(de(this.element),this.evWin,this.domHandler)}};function Ve(rt){var mt,Dt=rt.options.inputClass;return Dt?mt=Dt:ge?mt=K:ke?mt=Jt:me?mt=qe:mt=Di,new mt(rt,ai)}function ai(rt,mt,Dt){var ue=Dt.pointers.length,Se=Dt.changedPointers.length,gi=mt&Kt&&ue-Se===0,Mi=mt&(Qt|Ae)&&ue-Se===0;Dt.isFirst=!!gi,Dt.isFinal=!!Mi,gi&&(rt.session={}),Dt.eventType=mt,Ai(rt,Dt),rt.emit("hammer.input",Dt),rt.recognize(Dt),rt.session.prevInput=Dt}function Ai(rt,mt){var Dt=rt.session,ue=mt.pointers,Se=ue.length;Dt.firstInput||(Dt.firstInput=qi(mt)),Se>1&&!Dt.firstMultiple?Dt.firstMultiple=qi(mt):Se===1&&(Dt.firstMultiple=!1);var gi=Dt.firstInput,Mi=Dt.firstMultiple,pr=Mi?Mi.center:gi.center,fs=mt.center=Ji(ue);mt.timeStamp=x(),mt.deltaTime=mt.timeStamp-gi.timeStamp,mt.angle=jr(pr,fs),mt.distance=Re(pr,fs),Ti(Dt,mt),mt.offsetDirection=Ei(mt.deltaX,mt.deltaY);var rs=ce(mt.deltaTime,mt.deltaX,mt.deltaY);mt.overallVelocityX=rs.x,mt.overallVelocityY=rs.y,mt.overallVelocity=y(rs.x)>y(rs.y)?rs.x:rs.y,mt.scale=Mi?Te(Mi.pointers,ue):1,mt.rotation=Mi?Ci(Mi.pointers,ue):0,mt.maxPointers=Dt.prevInput?mt.pointers.length>Dt.prevInput.maxPointers?mt.pointers.length:Dt.prevInput.maxPointers:mt.pointers.length,Pi(Dt,mt);var Ar=rt.element;xt(mt.srcEvent.target,Ar)&&(Ar=mt.srcEvent.target),mt.target=Ar}function Ti(rt,mt){var Dt=mt.center,ue=rt.offsetDelta||{},Se=rt.prevDelta||{},gi=rt.prevInput||{};(mt.eventType===Kt||gi.eventType===Qt)&&(Se=rt.prevDelta={x:gi.deltaX||0,y:gi.deltaY||0},ue=rt.offsetDelta={x:Dt.x,y:Dt.y}),mt.deltaX=Se.x+(Dt.x-ue.x),mt.deltaY=Se.y+(Dt.y-ue.y)}function Pi(rt,mt){var Dt=rt.lastInterval||mt,ue=mt.timeStamp-Dt.timeStamp,Se,gi,Mi,pr;if(mt.eventType!=Ae&&(ue>Xt||Dt.velocity===s)){var fs=mt.deltaX-Dt.deltaX,rs=mt.deltaY-Dt.deltaY,Ar=ce(ue,fs,rs);gi=Ar.x,Mi=Ar.y,Se=y(Ar.x)>y(Ar.y)?Ar.x:Ar.y,pr=Ei(fs,rs),rt.lastInterval=mt}else Se=Dt.velocity,gi=Dt.velocityX,Mi=Dt.velocityY,pr=Dt.direction;mt.velocity=Se,mt.velocityX=gi,mt.velocityY=Mi,mt.direction=pr}function qi(rt){for(var mt=[],Dt=0;Dt<rt.pointers.length;)mt[Dt]={clientX:f(rt.pointers[Dt].clientX),clientY:f(rt.pointers[Dt].clientY)},Dt++;return{timeStamp:x(),pointers:mt,center:Ji(mt),deltaX:rt.deltaX,deltaY:rt.deltaY}}function Ji(rt){var mt=rt.length;if(mt===1)return{x:f(rt[0].clientX),y:f(rt[0].clientY)};for(var Dt=0,ue=0,Se=0;Se<mt;)Dt+=rt[Se].clientX,ue+=rt[Se].clientY,Se++;return{x:f(Dt/mt),y:f(ue/mt)}}function ce(rt,mt,Dt){return{x:mt/rt||0,y:Dt/rt||0}}function Ei(rt,mt){return rt===mt?Le:y(rt)>=y(mt)?rt<0?Fe:Ge:mt<0?Xe:pe}function Re(rt,mt,Dt){Dt||(Dt=Pe);var ue=mt[Dt[0]]-rt[Dt[0]],Se=mt[Dt[1]]-rt[Dt[1]];return Math.sqrt(ue*ue+Se*Se)}function jr(rt,mt,Dt){Dt||(Dt=Pe);var ue=mt[Dt[0]]-rt[Dt[0]],Se=mt[Dt[1]]-rt[Dt[1]];return Math.atan2(Se,ue)*180/Math.PI}function Ci(rt,mt){return jr(mt[1],mt[0],ve)+jr(rt[1],rt[0],ve)}function Te(rt,mt){return Re(mt[0],mt[1],ve)/Re(rt[0],rt[1],ve)}var Ke={mousedown:Kt,mousemove:ie,mouseup:Qt},Qe="mousedown",hr="mousemove mouseup";function Di(){this.evEl=Qe,this.evWin=hr,this.pressed=!1,Ee.apply(this,arguments)}$(Di,Ee,{handler:function(rt){var mt=Ke[rt.type];mt&Kt&&rt.button===0&&(this.pressed=!0),mt&ie&&rt.which!==1&&(mt=Qt),this.pressed&&(mt&Qt&&(this.pressed=!1),this.callback(this.manager,mt,{pointers:[rt],changedPointers:[rt],pointerType:It,srcEvent:rt}))}});var vi={pointerdown:Kt,pointermove:ie,pointerup:Qt,pointercancel:Ae,pointerout:Ae},yr={2:it,3:Et,4:It,5:Ut},sr="pointerdown",vt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(sr="MSPointerDown",vt="MSPointerMove MSPointerUp MSPointerCancel");function K(){this.evEl=sr,this.evWin=vt,Ee.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$(K,Ee,{handler:function(rt){var mt=this.store,Dt=!1,ue=rt.type.toLowerCase().replace("ms",""),Se=vi[ue],gi=yr[rt.pointerType]||rt.pointerType,Mi=gi==it,pr=ot(mt,rt.pointerId,"pointerId");Se&Kt&&(rt.button===0||Mi)?pr<0&&(mt.push(rt),pr=mt.length-1):Se&(Qt|Ae)&&(Dt=!0),!(pr<0)&&(mt[pr]=rt,this.callback(this.manager,Se,{pointers:mt,changedPointers:[rt],pointerType:gi,srcEvent:rt}),Dt&&mt.splice(pr,1))}});var Y={touchstart:Kt,touchmove:ie,touchend:Qt,touchcancel:Ae},st="touchstart",_t="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=st,this.evWin=_t,this.started=!1,Ee.apply(this,arguments)}$(kt,Ee,{handler:function(rt){var mt=Y[rt.type];if(mt===Kt&&(this.started=!0),!!this.started){var Dt=Ft.call(this,rt,mt);mt&(Qt|Ae)&&Dt[0].length-Dt[1].length===0&&(this.started=!1),this.callback(this.manager,mt,{pointers:Dt[0],changedPointers:Dt[1],pointerType:it,srcEvent:rt})}}});function Ft(rt,mt){var Dt=dt(rt.touches),ue=dt(rt.changedTouches);return mt&(Qt|Ae)&&(Dt=Lt(Dt.concat(ue),"identifier",!0)),[Dt,ue]}var Vt={touchstart:Kt,touchmove:ie,touchend:Qt,touchcancel:Ae},At="touchstart touchmove touchend touchcancel";function Jt(){this.evTarget=At,this.targetIds={},Ee.apply(this,arguments)}$(Jt,Ee,{handler:function(rt){var mt=Vt[rt.type],Dt=ye.call(this,rt,mt);Dt&&this.callback(this.manager,mt,{pointers:Dt[0],changedPointers:Dt[1],pointerType:it,srcEvent:rt})}});function ye(rt,mt){var Dt=dt(rt.touches),ue=this.targetIds;if(mt&(Kt|ie)&&Dt.length===1)return ue[Dt[0].identifier]=!0,[Dt,Dt];var Se,gi,Mi=dt(rt.changedTouches),pr=[],fs=this.target;if(gi=Dt.filter(function(rs){return xt(rs.target,fs)}),mt===Kt)for(Se=0;Se<gi.length;)ue[gi[Se].identifier]=!0,Se++;for(Se=0;Se<Mi.length;)ue[Mi[Se].identifier]&&pr.push(Mi[Se]),mt&(Qt|Ae)&&delete ue[Mi[Se].identifier],Se++;if(pr.length)return[Lt(gi.concat(pr),"identifier",!0),pr]}var he=2500,ae=25;function qe(){Ee.apply(this,arguments);var rt=ct(this.handler,this);this.touch=new Jt(this.manager,rt),this.mouse=new Di(this.manager,rt),this.primaryTouch=null,this.lastTouches=[]}$(qe,Ee,{handler:function(rt,mt,Dt){var ue=Dt.pointerType==it,Se=Dt.pointerType==It;if(!(Se&&Dt.sourceCapabilities&&Dt.sourceCapabilities.firesTouchEvents)){if(ue)Je.call(this,mt,Dt);else if(Se&&si.call(this,Dt))return;this.callback(rt,mt,Dt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Je(rt,mt){rt&Kt?(this.primaryTouch=mt.changedPointers[0].identifier,bi.call(this,mt)):rt&(Qt|Ae)&&bi.call(this,mt)}function bi(rt){var mt=rt.changedPointers[0];if(mt.identifier===this.primaryTouch){var Dt={x:mt.clientX,y:mt.clientY};this.lastTouches.push(Dt);var ue=this.lastTouches,Se=function(){var gi=ue.indexOf(Dt);gi>-1&&ue.splice(gi,1)};setTimeout(Se,he)}}function si(rt){for(var mt=rt.srcEvent.clientX,Dt=rt.srcEvent.clientY,ue=0;ue<this.lastTouches.length;ue++){var Se=this.lastTouches[ue],gi=Math.abs(mt-Se.x),Mi=Math.abs(Dt-Se.y);if(gi<=ae&&Mi<=ae)return!0}return!1}var Si=wt(c.style,"touchAction"),Ni=Si!==s,Hi="compute",nr="auto",li="manipulation",ji="none",ur="pan-x",Mr="pan-y",Ur=qa();function Er(rt,mt){this.manager=rt,this.set(mt)}Er.prototype={set:function(rt){rt==Hi&&(rt=this.compute()),Ni&&this.manager.element.style&&Ur[rt]&&(this.manager.element.style[Si]=rt),this.actions=rt.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var rt=[];return M(this.manager.recognizers,function(mt){yt(mt.options.enable,[mt])&&(rt=rt.concat(mt.getTouchAction()))}),ks(rt.join(" "))},preventDefaults:function(rt){var mt=rt.srcEvent,Dt=rt.offsetDirection;if(this.manager.session.prevented){mt.preventDefault();return}var ue=this.actions,Se=qt(ue,ji)&&!Ur[ji],gi=qt(ue,Mr)&&!Ur[Mr],Mi=qt(ue,ur)&&!Ur[ur];if(Se){var pr=rt.pointers.length===1,fs=rt.distance<2,rs=rt.deltaTime<250;if(pr&&fs&&rs)return}if(!(Mi&&gi)&&(Se||gi&&Dt&Pt||Mi&&Dt&Zt))return this.preventSrc(mt)},preventSrc:function(rt){this.manager.session.prevented=!0,rt.preventDefault()}};function ks(rt){if(qt(rt,ji))return ji;var mt=qt(rt,ur),Dt=qt(rt,Mr);return mt&&Dt?ji:mt||Dt?mt?ur:Mr:qt(rt,li)?li:nr}function qa(){if(!Ni)return!1;var rt={},mt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Dt){rt[Dt]=mt?t.CSS.supports("touch-action",Dt):!0}),rt}var da=1,Bi=2,$s=4,Ks=8,Rr=Ks,Gr=16,xs=32;function kr(rt){this.options=G({},this.defaults,rt||{}),this.id=oe(),this.manager=null,this.options.enable=Mt(this.options.enable,!0),this.state=da,this.simultaneous={},this.requireFail=[]}kr.prototype={defaults:{},set:function(rt){return G(this.options,rt),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(rt){if(P(rt,"recognizeWith",this))return this;var mt=this.simultaneous;return rt=to(rt,this),mt[rt.id]||(mt[rt.id]=rt,rt.recognizeWith(this)),this},dropRecognizeWith:function(rt){return P(rt,"dropRecognizeWith",this)?this:(rt=to(rt,this),delete this.simultaneous[rt.id],this)},requireFailure:function(rt){if(P(rt,"requireFailure",this))return this;var mt=this.requireFail;return rt=to(rt,this),ot(mt,rt)===-1&&(mt.push(rt),rt.requireFailure(this)),this},dropRequireFailure:function(rt){if(P(rt,"dropRequireFailure",this))return this;rt=to(rt,this);var mt=ot(this.requireFail,rt);return mt>-1&&this.requireFail.splice(mt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(rt){return!!this.simultaneous[rt.id]},emit:function(rt){var mt=this,Dt=this.state;function ue(Se){mt.manager.emit(Se,rt)}Dt<Ks&&ue(mt.options.event+Os(Dt)),ue(mt.options.event),rt.additionalEvent&&ue(rt.additionalEvent),Dt>=Ks&&ue(mt.options.event+Os(Dt))},tryEmit:function(rt){if(this.canEmit())return this.emit(rt);this.state=xs},canEmit:function(){for(var rt=0;rt<this.requireFail.length;){if(!(this.requireFail[rt].state&(xs|da)))return!1;rt++}return!0},recognize:function(rt){var mt=G({},rt);if(!yt(this.options.enable,[this,mt])){this.reset(),this.state=xs;return}this.state&(Rr|Gr|xs)&&(this.state=da),this.state=this.process(mt),this.state&(Bi|$s|Ks|Gr)&&this.tryEmit(mt)},process:function(rt){},getTouchAction:function(){},reset:function(){}};function Os(rt){return rt&Gr?"cancel":rt&Ks?"end":rt&$s?"move":rt&Bi?"start":""}function nn(rt){return rt==pe?"down":rt==Xe?"up":rt==Fe?"left":rt==Ge?"right":""}function to(rt,mt){var Dt=mt.manager;return Dt?Dt.get(rt):rt}function xi(){kr.apply(this,arguments)}$(xi,kr,{defaults:{pointers:1},attrTest:function(rt){var mt=this.options.pointers;return mt===0||rt.pointers.length===mt},process:function(rt){var mt=this.state,Dt=rt.eventType,ue=mt&(Bi|$s),Se=this.attrTest(rt);return ue&&(Dt&Ae||!Se)?mt|Gr:ue||Se?Dt&Qt?mt|Ks:mt&Bi?mt|$s:Bi:xs}});function wn(){xi.apply(this,arguments),this.pX=null,this.pY=null}$(wn,xi,{defaults:{event:"pan",threshold:10,pointers:1,direction:ii},getTouchAction:function(){var rt=this.options.direction,mt=[];return rt&Pt&&mt.push(Mr),rt&Zt&&mt.push(ur),mt},directionTest:function(rt){var mt=this.options,Dt=!0,ue=rt.distance,Se=rt.direction,gi=rt.deltaX,Mi=rt.deltaY;return Se&mt.direction||(mt.direction&Pt?(Se=gi===0?Le:gi<0?Fe:Ge,Dt=gi!=this.pX,ue=Math.abs(rt.deltaX)):(Se=Mi===0?Le:Mi<0?Xe:pe,Dt=Mi!=this.pY,ue=Math.abs(rt.deltaY))),rt.direction=Se,Dt&&ue>mt.threshold&&Se&mt.direction},attrTest:function(rt){return xi.prototype.attrTest.call(this,rt)&&(this.state&Bi||!(this.state&Bi)&&this.directionTest(rt))},emit:function(rt){this.pX=rt.deltaX,this.pY=rt.deltaY;var mt=nn(rt.direction);mt&&(rt.additionalEvent=this.options.event+mt),this._super.emit.call(this,rt)}});function Ys(){xi.apply(this,arguments)}$(Ys,xi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ji]},attrTest:function(rt){return this._super.attrTest.call(this,rt)&&(Math.abs(rt.scale-1)>this.options.threshold||this.state&Bi)},emit:function(rt){if(rt.scale!==1){var mt=rt.scale<1?"in":"out";rt.additionalEvent=this.options.event+mt}this._super.emit.call(this,rt)}});function dr(){kr.apply(this,arguments),this._timer=null,this._input=null}$(dr,kr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[nr]},process:function(rt){var mt=this.options,Dt=rt.pointers.length===mt.pointers,ue=rt.distance<mt.threshold,Se=rt.deltaTime>mt.time;if(this._input=rt,!ue||!Dt||rt.eventType&(Qt|Ae)&&!Se)this.reset();else if(rt.eventType&Kt)this.reset(),this._timer=T(function(){this.state=Rr,this.tryEmit()},mt.time,this);else if(rt.eventType&Qt)return Rr;return xs},reset:function(){clearTimeout(this._timer)},emit:function(rt){this.state===Rr&&(rt&&rt.eventType&Qt?this.manager.emit(this.options.event+"up",rt):(this._input.timeStamp=x(),this.manager.emit(this.options.event,this._input)))}});function Rn(){xi.apply(this,arguments)}$(Rn,xi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ji]},attrTest:function(rt){return this._super.attrTest.call(this,rt)&&(Math.abs(rt.rotation)>this.options.threshold||this.state&Bi)}});function ds(){xi.apply(this,arguments)}$(ds,xi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Pt|Zt,pointers:1},getTouchAction:function(){return wn.prototype.getTouchAction.call(this)},attrTest:function(rt){var mt=this.options.direction,Dt;return mt&(Pt|Zt)?Dt=rt.overallVelocity:mt&Pt?Dt=rt.overallVelocityX:mt&Zt&&(Dt=rt.overallVelocityY),this._super.attrTest.call(this,rt)&&mt&rt.offsetDirection&&rt.distance>this.options.threshold&&rt.maxPointers==this.options.pointers&&y(Dt)>this.options.velocity&&rt.eventType&Qt},emit:function(rt){var mt=nn(rt.offsetDirection);mt&&this.manager.emit(this.options.event+mt,rt),this.manager.emit(this.options.event,rt)}});function ps(){kr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$(ps,kr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[li]},process:function(rt){var mt=this.options,Dt=rt.pointers.length===mt.pointers,ue=rt.distance<mt.threshold,Se=rt.deltaTime<mt.time;if(this.reset(),rt.eventType&Kt&&this.count===0)return this.failTimeout();if(ue&&Se&&Dt){if(rt.eventType!=Qt)return this.failTimeout();var gi=this.pTime?rt.timeStamp-this.pTime<mt.interval:!0,Mi=!this.pCenter||Re(this.pCenter,rt.center)<mt.posThreshold;this.pTime=rt.timeStamp,this.pCenter=rt.center,!Mi||!gi?this.count=1:this.count+=1,this._input=rt;var pr=this.count%mt.taps;if(pr===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=Rr,this.tryEmit()},mt.interval,this),Bi):Rr}return xs},failTimeout:function(){return this._timer=T(function(){this.state=xs},this.options.interval,this),xs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Rr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Or(rt,mt){return mt=mt||{},mt.recognizers=Mt(mt.recognizers,Or.defaults.preset),new eo(rt,mt)}Or.VERSION="2.0.7",Or.defaults={domEvents:!1,touchAction:Hi,enable:!0,inputTarget:null,inputClass:null,preset:[[Rn,{enable:!1}],[Ys,{enable:!1},["rotate"]],[ds,{direction:Pt}],[wn,{direction:Pt},["swipe"]],[ps],[ps,{event:"doubletap",taps:2},["tap"]],[dr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var hs=1,Zi=2;function eo(rt,mt){this.options=G({},Or.defaults,mt||{}),this.options.inputTarget=this.options.inputTarget||rt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=rt,this.input=Ve(this),this.touchAction=new Er(this,this.options.touchAction),io(this,!0),M(this.options.recognizers,function(Dt){var ue=this.add(new Dt[0](Dt[1]));Dt[2]&&ue.recognizeWith(Dt[2]),Dt[3]&&ue.requireFailure(Dt[3])},this)}eo.prototype={set:function(rt){return G(this.options,rt),rt.touchAction&&this.touchAction.update(),rt.inputTarget&&(this.input.destroy(),this.input.target=rt.inputTarget,this.input.init()),this},stop:function(rt){this.session.stopped=rt?Zi:hs},recognize:function(rt){var mt=this.session;if(!mt.stopped){this.touchAction.preventDefaults(rt);var Dt,ue=this.recognizers,Se=mt.curRecognizer;(!Se||Se&&Se.state&Rr)&&(Se=mt.curRecognizer=null);for(var gi=0;gi<ue.length;)Dt=ue[gi],mt.stopped!==Zi&&(!Se||Dt==Se||Dt.canRecognizeWith(Se))?Dt.recognize(rt):Dt.reset(),!Se&&Dt.state&(Bi|$s|Ks)&&(Se=mt.curRecognizer=Dt),gi++}},get:function(rt){if(rt instanceof kr)return rt;for(var mt=this.recognizers,Dt=0;Dt<mt.length;Dt++)if(mt[Dt].options.event==rt)return mt[Dt];return null},add:function(rt){if(P(rt,"add",this))return this;var mt=this.get(rt.options.event);return mt&&this.remove(mt),this.recognizers.push(rt),rt.manager=this,this.touchAction.update(),rt},remove:function(rt){if(P(rt,"remove",this))return this;if(rt=this.get(rt),rt){var mt=this.recognizers,Dt=ot(mt,rt);Dt!==-1&&(mt.splice(Dt,1),this.touchAction.update())}return this},on:function(rt,mt){if(rt!==s&&mt!==s){var Dt=this.handlers;return M(zt(rt),function(ue){Dt[ue]=Dt[ue]||[],Dt[ue].push(mt)}),this}},off:function(rt,mt){if(rt!==s){var Dt=this.handlers;return M(zt(rt),function(ue){mt?Dt[ue]&&Dt[ue].splice(ot(Dt[ue],mt),1):delete Dt[ue]}),this}},emit:function(rt,mt){this.options.domEvents&&xn(rt,mt);var Dt=this.handlers[rt]&&this.handlers[rt].slice();if(!(!Dt||!Dt.length)){mt.type=rt,mt.preventDefault=function(){mt.srcEvent.preventDefault()};for(var ue=0;ue<Dt.length;)Dt[ue](mt),ue++}},destroy:function(){this.element&&io(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function io(rt,mt){var Dt=rt.element;if(Dt.style){var ue;M(rt.options.cssProps,function(Se,gi){ue=wt(Dt.style,gi),mt?(rt.oldCssProps[ue]=Dt.style[ue],Dt.style[ue]=Se):Dt.style[ue]=rt.oldCssProps[ue]||""}),mt||(rt.oldCssProps={})}}function xn(rt,mt){var Dt=e.createEvent("Event");Dt.initEvent(rt,!0,!0),Dt.gesture=mt,mt.target.dispatchEvent(Dt)}G(Or,{INPUT_START:Kt,INPUT_MOVE:ie,INPUT_END:Qt,INPUT_CANCEL:Ae,STATE_POSSIBLE:da,STATE_BEGAN:Bi,STATE_CHANGED:$s,STATE_ENDED:Ks,STATE_RECOGNIZED:Rr,STATE_CANCELLED:Gr,STATE_FAILED:xs,DIRECTION_NONE:Le,DIRECTION_LEFT:Fe,DIRECTION_RIGHT:Ge,DIRECTION_UP:Xe,DIRECTION_DOWN:pe,DIRECTION_HORIZONTAL:Pt,DIRECTION_VERTICAL:Zt,DIRECTION_ALL:ii,Manager:eo,Input:Ee,TouchAction:Er,TouchInput:Jt,MouseInput:Di,PointerEventInput:K,TouchMouseInput:qe,SingleTouchInput:kt,Recognizer:kr,AttrRecognizer:xi,Tap:ps,Pan:wn,Swipe:ds,Pinch:Ys,Rotate:Rn,Press:dr,on:Nt,off:Rt,each:M,merge:X,extend:Z,assign:G,inherit:$,bindFn:ct,prefixed:wt});var pa=typeof t<"u"?t:typeof self<"u"?self:{};pa.Hammer=Or,typeof s=="function"&&s.amd?s(function(){return Or}):i.exports?i.exports=Or:t[r]=Or})(window,document,"Hammer")})(Q3);var xf=Q3.exports;const e8=wm(xf),tc=GT({__proto__:null,default:e8},[xf]),tS=1,eS=2,w_=4,i8={mousedown:tS,mousemove:eS,mouseup:w_};function r8(i,t){for(let e=0;e<i.length;e++)if(t(i[e]))return!0;return!1}function s8(i){const t=i.prototype.handler;i.prototype.handler=function(e){const r=this.store;e.button>0&&e.type==="pointerdown"&&(r8(r,s=>s.pointerId===e.pointerId)||r.push(e)),t.call(this,e)}}function n8(i){i.prototype.handler=function(t){let e=i8[t.type];e&tS&&t.button>=0&&(this.pressed=!0),e&eS&&t.which===0&&(e=w_),this.pressed&&(e&w_&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}s8(xf.PointerEventInput);n8(xf.MouseInput);const o8=xf.Manager;class Mm{constructor(t,e,r){this.element=t,this.callback=e,this.options={enable:!0,...r}}}const a8=tc?[[tc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[tc.Rotate,{enable:!1}],[tc.Pinch,{enable:!1}],[tc.Swipe,{enable:!1}],[tc.Pan,{threshold:0,enable:!1}],[tc.Press,{enable:!1}],[tc.Tap,{event:"doubletap",taps:2,enable:!1}],[tc.Tap,{event:"anytap",enable:!1}],[tc.Tap,{enable:!1}]]:null,Vw={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},l8={doubletap:["tap"]},c8={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Y1={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},h8={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},qw={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},u8=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",wd=typeof window<"u"?window:global;let x_=!1;try{const i={get passive(){return x_=!0,!0}};wd.addEventListener("test",null,i),wd.removeEventListener("test",null)}catch{x_=!1}const d8=u8.indexOf("firefox")!==-1,{WHEEL_EVENTS:p8}=Y1,Hw="wheel",Ww=4.000244140625,f8=40,g8=.25;class m8 extends Mm{constructor(t,e,r){super(t,e,r),this.handleEvent=s=>{if(!this.options.enable)return;let n=s.deltaY;wd.WheelEvent&&(d8&&s.deltaMode===wd.WheelEvent.DOM_DELTA_PIXEL&&(n/=wd.devicePixelRatio),s.deltaMode===wd.WheelEvent.DOM_DELTA_LINE&&(n*=f8)),n!==0&&n%Ww===0&&(n=Math.floor(n/Ww)),s.shiftKey&&n&&(n=n*g8),this.callback({type:Hw,center:{x:s.clientX,y:s.clientY},delta:-n,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(p8),this.events.forEach(s=>t.addEventListener(s,this.handleEvent,x_?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===Hw&&(this.options.enable=e)}}const{MOUSE_EVENTS:y8}=Y1,Jw="pointermove",Zw="pointerover",Xw="pointerout",$w="pointerenter",Kw="pointerleave";class _8 extends Mm{constructor(t,e,r){super(t,e,r),this.handleEvent=n=>{this.handleOverEvent(n),this.handleOutEvent(n),this.handleEnterEvent(n),this.handleLeaveEvent(n),this.handleMoveEvent(n)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(y8),this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===Jw&&(this.enableMoveEvent=e),t===Zw&&(this.enableOverEvent=e),t===Xw&&(this.enableOutEvent=e),t===$w&&(this.enableEnterEvent=e),t===Kw&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(Zw,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(Xw,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit($w,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(Kw,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(Jw,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:v8}=Y1,Yw="keydown",Qw="keyup";class b8 extends Mm{constructor(t,e,r){super(t,e,r),this.handleEvent=s=>{const n=s.target||s.srcElement;n.tagName==="INPUT"&&n.type==="text"||n.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:Yw,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:Qw,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(v8),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===Yw&&(this.enableDownEvent=e),t===Qw&&(this.enableUpEvent=e)}}const tx="contextmenu";class w8 extends Mm{constructor(t,e,r){super(t,e,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:tx,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===tx&&(this.options.enable=e)}}const A_=1,pm=2,S_=4,x8={pointerdown:A_,pointermove:pm,pointerup:S_,mousedown:A_,mousemove:pm,mouseup:S_},A8=1,S8=2,E8=3,C8=0,T8=1,P8=2,I8=1,M8=2,L8=4;function B8(i){const t=x8[i.srcEvent.type];if(!t)return null;const{buttons:e,button:r,which:s}=i.srcEvent;let n=!1,c=!1,l=!1;return t===S_||t===pm&&!Number.isFinite(e)?(n=s===A8,c=s===S8,l=s===E8):t===pm?(n=!!(e&I8),c=!!(e&L8),l=!!(e&M8)):t===A_&&(n=r===C8,c=r===T8,l=r===P8),{leftButton:n,middleButton:c,rightButton:l}}function R8(i,t){const e=i.center;if(!e)return null;const r=t.getBoundingClientRect(),s=r.width/t.offsetWidth||1,n=r.height/t.offsetHeight||1,c={x:(e.x-r.left-t.clientLeft)/s,y:(e.y-r.top-t.clientTop)/n};return{center:e,offsetCenter:c}}const cy={srcElement:"root",priority:0};class k8{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const r=this._normalizeEvent(e);let s=e.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:c,handlersByElement:l}=this;let f=cy;typeof r=="string"||r&&r.addEventListener?f={...cy,srcElement:r}:r&&(f={...cy,...r});let y=l.get(f.srcElement);y||(y=[],l.set(f.srcElement,y));const x={type:t,handler:e,srcElement:f.srcElement,priority:f.priority};s&&(x.once=!0),n&&(x.passive=!0),c.push(x),this._active=this._active||!x.passive;let T=y.length-1;for(;T>=0&&!(y[T].priority>=x.priority);)T--;y.splice(T+1,0,x)}remove(t,e){const{handlers:r,handlersByElement:s}=this;for(let n=r.length-1;n>=0;n--){const c=r[n];if(c.type===t&&c.handler===e){r.splice(n,1);const l=s.get(c.srcElement);l.splice(l.indexOf(c),1),l.length===0&&s.delete(c.srcElement)}}this._active=r.some(n=>!n.passive)}_emit(t,e){const r=this.handlersByElement.get(e);if(r){let s=!1;const n=()=>{t.handled=!0},c=()=>{t.handled=!0,s=!0},l=[];for(let f=0;f<r.length;f++){const{type:y,handler:x,once:T}=r[f];if(x({...t,type:y,stopPropagation:n,stopImmediatePropagation:c}),T&&l.push(r[f]),s)break}for(let f=0;f<l.length;f++){const{type:y,handler:x}=l[f];this.remove(y,x)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...B8(t),...R8(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const O8={events:null,recognizers:null,recognizerOptions:{},Manager:o8,touchAction:"none",tabIndex:0};class D8{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=s=>{const{srcEvent:n}=s,c=c8[n.type];c&&this.manager.emit(c,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...O8,...e},this.events=new Map,this.setElement(t);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,r=e.Manager;this.manager=new r(t,{touchAction:e.touchAction,recognizers:e.recognizers||a8}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(Vw).forEach(s=>{const n=this.manager.get(s);n&&Vw[s].forEach(c=>{n.recognizeWith(c)})});for(const s in e.recognizerOptions){const n=this.manager.get(s);if(n){const c=e.recognizerOptions[s];delete c.enable,n.set(c)}}this.wheelInput=new m8(t,this._onOtherEvent,{enable:!1}),this.moveInput=new _8(t,this._onOtherEvent,{enable:!1}),this.keyInput=new b8(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new w8(t,this._onOtherEvent,{enable:!1});for(const[s,n]of this.events)n.isEmpty()||(this._toggleRecognizer(n.recognizerName,!0),this.manager.on(s,n.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,r){this._addEventHandler(t,e,r,!1)}once(t,e,r){this._addEventHandler(t,e,r,!0)}watch(t,e,r){this._addEventHandler(t,e,r,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:r}=this;if(!r)return;const s=r.get(t);if(s&&s.options.enable!==e){s.set({enable:e});const n=l8[t];n&&!this.options.recognizers&&n.forEach(c=>{const l=r.get(c);e?(l.requireFailure(t),s.dropRequireFailure(c)):l.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,r,s,n){if(typeof t!="string"){r=e;for(const x in t)this._addEventHandler(x,t[x],r,s,n);return}const{manager:c,events:l}=this,f=qw[t]||t;let y=l.get(f);y||(y=new k8(this),l.set(f,y),y.recognizerName=h8[f]||f,c&&c.on(f,y.handleEvent)),y.add(t,e,r,s,n),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const c in t)this._removeEventHandler(c,t[c]);return}const{events:r}=this,s=qw[t]||t,n=r.get(s);if(n&&(n.remove(t,e),n.isEmpty())){const{recognizerName:c}=n;let l=!1;for(const f of r.values())if(f.recognizerName===c&&!f.isEmpty()){l=!0;break}l||this._toggleRecognizer(c,!1)}}}function gu(){}const N8=i=>{let{isDragging:t}=i;return t?"grabbing":"grab"},iS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:gu,onResize:gu,onViewStateChange:gu,onInteractionStateChange:gu,onBeforeRender:gu,onAfterRender:gu,onLoad:gu,onError:i=>vr.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:N8,getTooltip:null,debug:!1,drawPickingColors:!1};class Q1{constructor(t){H(this,"props",void 0),H(this,"width",0),H(this,"height",0),H(this,"userData",{}),H(this,"canvas",null),H(this,"viewManager",null),H(this,"layerManager",null),H(this,"effectManager",null),H(this,"deckRenderer",null),H(this,"deckPicker",null),H(this,"eventManager",null),H(this,"tooltip",null),H(this,"metrics",void 0),H(this,"animationLoop",void 0),H(this,"stats",void 0),H(this,"viewState",void 0),H(this,"cursorState",void 0),H(this,"_needsRedraw",void 0),H(this,"_pickRequest",void 0),H(this,"_lastPointerDownInfo",null),H(this,"_metricsCounter",void 0),H(this,"_onPointerMove",e=>{const{_pickRequest:r}=this;if(e.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(e.leftButton||e.rightButton)return;{const s=e.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=e}),H(this,"_onEvent",e=>{const r=R2[e.type],s=e.offsetCenter;if(!r||!s||!this.layerManager)return;const n=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:n,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=c,f=l&&(l[r.handler]||l.props[r.handler]),y=this.props[r.handler];let x=!1;f&&(x=f.call(l,c,e)),!x&&y&&y(c,e)}),H(this,"_onPointerDown",e=>{const r=e.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo}),this.props={...iS,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&vr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),jA()==="IE"&&vr.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new C1({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&sf.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,r,s,n,c,l,f;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(s=this.effectManager)===null||s===void 0||s.finalize(),this.effectManager=null,(n=this.deckRenderer)===null||n===void 0||n.finalize(),this.deckRenderer=null,(c=this.deckPicker)===null||c===void 0||c.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(f=this.tooltip)===null||f===void 0||f.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var y;(y=this.canvas.parentElement)===null||y===void 0||y.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&vr.removed("onLayerHover","onHover")(),"onLayerClick"in t&&vr.removed("onLayerClick","onClick")(),t.initialViewState&&!ac(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(t),s=this.layerManager.needsRedraw(t),n=this.effectManager.needsRedraw(t),c=this.deckRenderer.needsRedraw(t);return e=e||r||s||n||c,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return Bn(this.viewManager),this.viewManager.views}getViewports(t){return Bn(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const r in t)this.layerManager.resourceManager.add({resourceId:r,data:t[r],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,r){Bn(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(e).timeStart();const n=this.deckPicker[t]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(e).timeEnd(),n}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),Bn(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:r}=t;if(e||e===0){const n=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=n}if(r||r===0){var s;const n=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((s=t.style)===null||s===void 0?void 0:s.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var t,e;const{canvas:r}=this;if(!r)return;const s=(t=r.clientWidth)!==null&&t!==void 0?t:r.width,n=(e=r.clientHeight)!==null&&e!==void 0?e:r.height;if(s!==this.width||n!==this.height){var c,l;this.width=s,this.height=n,(c=this.viewManager)===null||c===void 0||c.setProps({width:s,height:n}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:n})}}_createAnimationLoop(t){const{width:e,height:r,gl:s,glOptions:n,debug:c,onError:l,onBeforeRender:f,onAfterRender:y,useDevicePixels:x}=t;return new l6({width:e,height:r,useDevicePixels:x,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,gl:s,onCreateContext:T=>JA({...n,...T,canvas:this.canvas,debug:c,onContextLost:()=>this._onContextLost()}),onInitialize:T=>this._setGLContext(T.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:f,onAfterRender:y,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new K1({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:r,emptyInfo:s}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let n=s,c=!1;for(const l of r){var e;n=l,c=((e=l.layer)===null||e===void 0?void 0:e.onHover(l,t.event))||c}if(!c&&this.props.onHover&&this.props.onHover(n,t.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(n);this.tooltip.setTooltip(l,n.x,n.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,E1(t,{enable:!0,copyState:!0})),this.tooltip=new t8(this.canvas),Yc(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new D3;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new D8(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in R2)this.eventManager.on(s,this._onEvent);this.viewManager=new CD({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new ED(t,{deck:this,stats:this.stats,viewport:r,timeline:e}),this.effectManager=new VD,this.deckRenderer=new WD(t),this.deckPicker=new YD(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:r}=this.layerManager.context;Yc(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:r})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),vr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const r=Au.get("Memory Usage");t.bufferMemory=r.get("Buffer Memory").count,t.textureMemory=r.get("Texture Memory").count,t.renderbufferMemory=r.get("Renderbuffer Memory").count,t.gpuMemory=r.get("GPU Memory").count}}H(Q1,"defaultProps",iS);H(Q1,"VERSION",pL);class hy{constructor(t,e){H(this,"opts",void 0),H(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:r}=this.source,{size:s}=e;let n=r;if(r&&r.length!==s){n=new Float32Array(s);const c=e.elementOffset||0;for(let l=0;l<s;++l)n[l]=r[c+l]}return n}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function F8(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Og(i){return i.stride||i.size*i.bytesPerElement}function rS(i,t){t.offset&&vr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=Og(i),r=t.vertexOffset!==void 0?t.vertexOffset:i.vertexOffset||0,s=t.elementOffset||0,n=r*e+s*i.bytesPerElement+(i.offset||0);return{...t,offset:n,stride:e}}function z8(i,t){const e=rS(i,t);return{high:e,low:{...e,offset:e.offset+i.size*4}}}class j8{constructor(t,e,r){H(this,"gl",void 0),H(this,"id",void 0),H(this,"size",void 0),H(this,"settings",void 0),H(this,"value",void 0),H(this,"doublePrecision",void 0),H(this,"_buffer",void 0),H(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const s=e.logicalType||e.type,n=s===5130;let{defaultValue:c}=e;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let l;n?l=5126:!s&&e.isIndexed?l=t&&I1(t,is.ELEMENT_INDEX_UINT32)?5125:5123:l=s||5126;let f=F8(s||l||5126);this.doublePrecision=n,n&&e.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...e,defaultType:f,defaultValue:c,logicalType:s,type:l,size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new Wr(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Og(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),sf.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const r={},s=this.value instanceof Float64Array,n=z8(this.getAccessor(),e||{});return r[t]=new hy(this,n.high),r["".concat(t,"64Low")]=s?new hy(this,n.low):new Float32Array(this.size),r}if(e){const r=rS(this.getAccessor(),e);return{[t]:new hy(this,r)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:r,size:s}=this,n=r*s;if(e&&n&&e.length>=n){const c=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let f=0;f<n;)for(let y=0;y<s;y++){const x=e[f++];x<c[y]&&(c[y]=x),x>l[y]&&(l[y]=x)}t=[c,l]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let r;ArrayBuffer.isView(t)?r={value:t}:t instanceof Wr?r={buffer:t}:r=t;const s={...this.settings,...r};if(e.bufferAccessor=s,e.bounds=null,r.constant){let n=r.value;if(n=this._normalizeValue(n,[],0),this.settings.normalized&&(n=this.normalizeConstant(n)),!(!e.constant||!this._areValuesEqual(n,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=n}else if(r.buffer){const n=r.buffer;e.externalBuffer=n,e.constant=!1,this.value=r.value||null;const c=r.value instanceof Float64Array;s.type=r.type||n.accessor.type,s.bytesPerElement=n.accessor.BYTES_PER_ELEMENT*(c?2:1),s.stride=Og(s)}else if(r.value){this._checkExternalBuffer(r);let n=r.value;e.externalBuffer=null,e.constant=!1,this.value=n,s.bytesPerElement=n.BYTES_PER_ELEMENT,s.stride=Og(s);const{buffer:c,byteOffset:l}=this;this.doublePrecision&&n instanceof Float64Array&&(n=oy(n,s));const f=n.byteLength+l+s.stride*2;c.byteLength<f&&c.reallocate(f),c.setAccessor(null),c.subData({data:n,offset:l}),s.type=r.type||c.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:r=0,endOffset:s}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?oy(e,{size:this.size,startIndex:r,endIndex:s}):e.subarray(r,s),offset:r*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:r}=this,s=r.allocatedValue,n=sf.allocate(s,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=n;const{buffer:c,byteOffset:l}=this;return c.byteLength<n.byteLength+l&&(c.reallocate(n.byteLength+l),e&&s&&c.subData({data:s instanceof Float64Array?oy(s,this):s,offset:l})),r.allocatedValue=n,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=e.BYTES_PER_ELEMENT<4),s)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof r)&&this.settings.normalized&&!("normalized"in t)&&vr.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,r){const{defaultValue:s,size:n}=this.settings;if(Number.isFinite(t))return e[r]=t,e;if(!t){let c=n;for(;--c>=0;)e[r+c]=s[c];return e}switch(n){case 4:e[r+3]=Number.isFinite(t[3])?t[3]:s[3];case 3:e[r+2]=Number.isFinite(t[2])?t[2]:s[2];case 2:e[r+1]=Number.isFinite(t[1])?t[1]:s[1];case 1:e[r+0]=Number.isFinite(t[0])?t[0]:s[0];break;default:let c=n;for(;--c>=0;)e[r+c]=Number.isFinite(t[c])?t[c]:s[c]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(t[s]!==e[s])return!1;return!0}}const ex=[],ix=[];function sS(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,r=ex;const s={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(ix.length=i.length,r=ix):r=ex,(t>0||Number.isFinite(e))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,e),s.index=t-1),{iterable:r,objectInfo:s}}function nS(i){return i&&i[Symbol.asyncIterator]}function U8(i,t){const{size:e,stride:r,offset:s,startIndices:n,nested:c}=t,l=i.BYTES_PER_ELEMENT,f=r?r/l:e,y=s?s/l:0,x=Math.floor((i.length-y)/f);return(T,P)=>{let{index:M,target:N}=P;if(!n){const $=M*f+y;for(let ct=0;ct<e;ct++)N[ct]=i[$+ct];return N}const G=n[M],Z=n[M+1]||x;let X;if(c){X=new Array(Z-G);for(let $=G;$<Z;$++){const ct=$*f+y;N=new Array(e);for(let yt=0;yt<e;yt++)N[yt]=i[ct+yt];X[$-G]=N}}else if(f===e)X=i.subarray(G*e+y,Z*e+y);else{X=new i.constructor((Z-G)*e);let $=0;for(let ct=G;ct<Z;ct++){const yt=ct*f+y;for(let Mt=0;Mt<e;Mt++)X[$++]=i[yt+Mt]}}return X}}const G8=[],Dg=[[0,1/0]];function V8(i,t){if(i===Dg||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return i;const e=[],r=i.length;let s=0;for(let n=0;n<r;n++){const c=i[n];c[1]<t[0]?(e.push(c),s=n+1):c[0]>t[1]?e.push(c):t=[Math.min(c[0],t[0]),Math.max(c[1],t[1])]}return e.splice(s,0,t),e}function uy(i){const{source:t,target:e,start:r=0,size:s,getData:n}=i,c=i.end||e.length,l=t.length,f=c-r;if(l>f){e.set(t.subarray(0,f),r);return}if(e.set(t,r),!n)return;let y=l;for(;y<f;){const x=n(y,t);for(let T=0;T<s;T++)e[r+y]=x[T]||0,y++}}function q8(i){let{source:t,target:e,size:r,getData:s,sourceStartIndices:n,targetStartIndices:c}=i;if(!Array.isArray(c))return uy({source:t,target:e,size:r,getData:s}),e;let l=0,f=0;const y=s&&((T,P)=>s(T+f,P)),x=Math.min(n.length,c.length);for(let T=1;T<x;T++){const P=n[T]*r,M=c[T]*r;uy({source:t.subarray(l,P),target:e,start:f,end:M,size:r,getData:y}),l=P,f=M}return f<e.length&&uy({source:[],target:e,start:f,size:r,getData:y}),e}const H8={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function oS(i,t){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const e=i.type||"interpolation";return{...H8[e],...t,...i,type:e}}function aS(i,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function lS(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function cS(i){i.push(i.shift())}function tv(i,t){const{doublePrecision:e,settings:r,value:s,size:n}=i,c=e&&s instanceof Float64Array?2:1;return(r.noAlloc?s.length:t*n)*c}function hS(i){let{buffer:t,numInstances:e,attribute:r,fromLength:s,fromStartIndices:n,getData:c=$=>$}=i;const l=r.doublePrecision&&r.value instanceof Float64Array?2:1,f=r.size*l,y=r.byteOffset,x=r.startIndices,T=n&&x,P=tv(r,e),M=r.isConstant;if(!T&&s>=P)return;const N=M?r.value:r.getBuffer().getData({srcByteOffset:y});if(r.settings.normalized&&!M){const $=c;c=(ct,yt)=>r.normalizeConstant($(ct,yt))}const G=M?($,ct)=>c(N,ct):($,ct)=>c(N.subarray($,$+f),ct),Z=t.getData({length:s}),X=new Float32Array(P);q8({source:Z,target:X,sourceStartIndices:n,targetStartIndices:x,size:f,getData:G}),t.byteLength<X.byteLength+y&&t.reallocate(X.byteLength+y),t.subData({data:X,offset:y})}class ev extends j8{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Dg}),H(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,r=this.settings.transition,s=Array.isArray(e)?t[e.find(n=>t[n])]:t[e];return oS(s,r)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:r=0,endRow:s=1/0}=e;this.state.updateRanges=V8(this.state.updateRanges,[r,s])}else this.state.updateRanges=Dg}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=G8}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(t,e.updateRanges!==Dg),!0):!1}updateBuffer(t){let{numInstances:e,data:r,props:s,context:n}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:l,noAlloc:f}}=this;let y=!0;if(l){for(const[x,T]of c)l.call(n,this,{data:r,startRow:x,endRow:T,props:s,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[x,T]of c){const P=Number.isFinite(x)?this.getVertexOffset(x):0,M=Number.isFinite(T)?this.getVertexOffset(T):f||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:P,endOffset:M})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:r,settings:s}=this;if(!t)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===t)return this.clearNeedsUpdate(),!0;if(r.binaryValue=t,this.setNeedsRedraw(),s.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const n=t;Bn(ArrayBuffer.isView(n.value),"invalid ".concat(s.accessor));const c=!!n.size&&n.size!==this.size;return r.binaryAccessor=U8(n.value,{size:n.size||this.size,stride:n.stride,offset:n.offset,startIndices:e,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const r in t)Object.assign(e,super.getShaderAttributes(r,t[r]));return e}_autoUpdater(t,e){let{data:r,startRow:s,endRow:n,props:c,numInstances:l}=e;if(t.constant)return;const{settings:f,state:y,value:x,size:T,startIndices:P}=t,{accessor:M,transform:N}=f,G=y.binaryAccessor||(typeof M=="function"?M:c[M]);Bn(typeof G=="function",'accessor "'.concat(M,'" is not a function'));let Z=t.getVertexOffset(s);const{iterable:X,objectInfo:$}=sS(r,s,n);for(const ct of X){$.index++;let yt=G(ct,$);if(N&&(yt=N.call(this,yt)),P){const Mt=($.index<P.length-1?P[$.index+1]:l)-P[$.index];if(yt&&Array.isArray(yt[0])){let Nt=Z;for(const Rt of yt)t._normalizeValue(Rt,x,Nt),Nt+=T}else yt&&yt.length>T?x.set(yt,Z):(t._normalizeValue(yt,$.target,0),mD({target:x,source:$.target,start:Z,count:Mt}));Z+=Mt*T}else t._normalizeValue(yt,x,Z),Z+=T}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let r=!0;switch(e){case 4:r=r&&Number.isFinite(t[3]);case 3:r=r&&Number.isFinite(t[2]);case 2:r=r&&Number.isFinite(t[1]);case 1:r=r&&Number.isFinite(t[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class W8{constructor(t){let{gl:e,attribute:r,timeline:s}=t;H(this,"gl",void 0),H(this,"type","interpolation"),H(this,"attributeInTransition",void 0),H(this,"settings",void 0),H(this,"attribute",void 0),H(this,"transition",void 0),H(this,"currentStartIndices",void 0),H(this,"currentLength",void 0),H(this,"transform",void 0),H(this,"buffers",void 0),this.gl=e,this.transition=new wf(s),this.attribute=r,this.attributeInTransition=new ev(e,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=Z8(e,r);const n={byteLength:0,usage:35050};this.buffers=[new Wr(e,n),new Wr(e,n)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:r,buffers:s,attribute:n}=this;cS(s);const c={numInstances:e,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const l of s)hS({buffer:l,...c});this.currentStartIndices=n.startIndices,this.currentLength=tv(n,e),this.attributeInTransition.setData({buffer:s[1],value:n.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aFrom:s[0],aTo:aS(r,n)},feedbackBuffers:{vCurrent:s[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:r}=this.settings,{time:s}=this.transition;let n=s/e;r&&(n=r(n)),this.transform.run({uniforms:{time:n}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const J8=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Z8(i,t){const e=lS(t.size);return new V1(i,{vs:J8,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class X8{constructor(t){let{gl:e,attribute:r,timeline:s}=t;H(this,"gl",void 0),H(this,"type","spring"),H(this,"attributeInTransition",void 0),H(this,"settings",void 0),H(this,"attribute",void 0),H(this,"transition",void 0),H(this,"currentStartIndices",void 0),H(this,"currentLength",void 0),H(this,"texture",void 0),H(this,"framebuffer",void 0),H(this,"transform",void 0),H(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new wf(s),this.attribute=r,this.attributeInTransition=new ev(e,{...r.settings,normalized:!1}),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=K8(e),this.framebuffer=Y8(e,this.texture),this.transform=$8(e,r,this.framebuffer);const n={byteLength:0,usage:35050};this.buffers=[new Wr(e,n),new Wr(e,n),new Wr(e,n)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:r,buffers:s,attribute:n}=this,c={numInstances:e,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const l of s)hS({buffer:l,...c});this.settings=t,this.currentStartIndices=n.startIndices,this.currentLength=tv(n,e),this.attributeInTransition.setData({buffer:s[1],value:n.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aTo:aS(r,n)}})}update(){const{buffers:t,transform:e,framebuffer:r,transition:s}=this;if(!s.update())return!1;const n=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:n.stiffness,damping:n.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),cS(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),Pm(r)[0]>0||s.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function $8(i,t,e){const r=lS(t.size);return new V1(i,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function K8(i){return new ua(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function Y8(i,t){return new sn(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const Q8={interpolation:W8,spring:X8};class tN{constructor(t,e){let{id:r,timeline:s}=e;H(this,"id",void 0),H(this,"isSupported",void 0),H(this,"gl",void 0),H(this,"timeline",void 0),H(this,"transitions",void 0),H(this,"needsRedraw",void 0),H(this,"numInstances",void 0),this.id=r,this.gl=t,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=V1.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:r,numInstances:s}=t;this.numInstances=s||1;for(const n in e){const c=e[n],l=c.getTransitionSetting(r);l&&this._updateAttribute(n,c,l)}for(const n in this.transitions){const c=e[n];(!c||!c.getTransitionSetting(r))&&this._removeTransition(n)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const r=this.transitions[e];r.inProgress&&(t[e]=r.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,r){const s=this.transitions[t];let n=!s||s.type!==r.type;if(n){if(!this.isSupported){vr.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}s&&this._removeTransition(t);const c=Q8[r.type];c?this.transitions[t]=new c({attribute:e,timeline:this.timeline,gl:this.gl}):(vr.error("unsupported transition type '".concat(r.type,"'"))(),n=!1)}(n||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(r,this.numInstances))}}const rx="attributeManager.invalidate",eN="attributeManager.updateStart",iN="attributeManager.updateEnd",rN="attribute.updateStart",sN="attribute.allocate",nN="attribute.updateEnd";class oN{constructor(t){let{id:e="attribute-manager",stats:r,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};H(this,"id",void 0),H(this,"gl",void 0),H(this,"attributes",void 0),H(this,"updateTriggers",void 0),H(this,"needsRedraw",void 0),H(this,"userData",void 0),H(this,"stats",void 0),H(this,"attributeTransitionManager",void 0),H(this,"mergeBoundsMemoized",bf(aD)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new tN(t,{id:"".concat(e,"-transitions"),timeline:s}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const r=this._invalidateTrigger(t,e);$n(rx,this,t,r)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);$n(rx,this,"all")}update(t){let{data:e,numInstances:r,startIndices:s=null,transitions:n,props:c={},buffers:l={},context:f={}}=t,y=!1;$n(eN,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const x in this.attributes){const T=this.attributes[x],P=T.settings.accessor;T.startIndices=s,T.numInstances=r,c[x]&&vr.removed("props.".concat(x),"data.attributes.".concat(x))(),T.setExternalBuffer(l[x])||T.setBinaryValue(typeof P=="string"?l[P]:void 0,e.startIndices)||typeof P=="string"&&!l[P]&&T.setConstantValue(c[P])||T.needsUpdate()&&(y=!0,this._updateAttribute({attribute:T,numInstances:r,data:e,props:c,context:f})),this.needsRedraw=this.needsRedraw||T.needsRedraw()}y&&$n(iN,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:n})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map(r=>{var s;return(s=this.attributes[r])===null||s===void 0?void 0:s.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const n in e){const c=e[n];c.needsRedraw(t)&&!r.hasAttribute(n)&&(s[n]=c)}return s}getShaderAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const r={};for(const s in t)e[s]||Object.assign(r,t[s].getShaderAttributes());return r}_add(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const r in t){const s=t[r];this.attributes[r]=this._createAttribute(r,s,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,r){const s={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:r.instanced?1:e.divisor||0};return new ev(this.gl,s)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(r=>{t[r]||(t[r]=[]),t[r].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:r,updateTriggers:s}=this,n=s[t];return n&&n.forEach(c=>{const l=r[c];l&&l.setNeedsUpdate(l.id,e)}),n}_updateAttribute(t){const{attribute:e,numInstances:r}=t;if($n(rN,e),e.constant){e.setConstantValue(e.value);return}e.allocate(r)&&$n(sN,e,r),e.updateBuffer(t)&&(this.needsRedraw=!0,$n(nN,e,r))}}class aN extends wf{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:r,duration:s,easing:n}}=this,c=n(t/s);this._value=am(e,r,c)}}const sx=1e-5;function nx(i,t,e,r,s){const n=t-i,c=(e-t)*s,l=-n*r;return c+l+n+t}function lN(i,t,e,r,s){if(Array.isArray(e)){const n=[];for(let c=0;c<e.length;c++)n[c]=nx(i[c],t[c],e[c],r,s);return n}return nx(i,t,e,r,s)}function ox(i,t){if(Array.isArray(i)){let e=0;for(let r=0;r<i.length;r++){const s=i[r]-t[r];e+=s*s}return Math.sqrt(e)}return Math.abs(i-t)}class cN extends wf{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:r,stiffness:s}=this.settings,{_prevValue:n=t,_currValue:c=t}=this;let l=lN(n,c,e,r,s);const f=ox(l,e),y=ox(l,c);f<sx&&y<sx&&(l=e,this.end()),this._prevValue=c,this._currValue=l}}const hN={interpolation:aN,spring:cN};class uN{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,r,s){const{transitions:n}=this;if(n.has(t)){const f=n.get(t),{value:y=f.settings.fromValue}=f;e=y,this.remove(t)}if(s=oS(s),!s)return;const c=hN[s.type];if(!c){vr.error("unsupported transition type '".concat(s.type,"'"))();return}const l=new c(this.timeline);l.start({...s,fromValue:e,toValue:r}),n.set(t,l)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,r]of this.transitions)r.update(),t[e]=r.value,r.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function dN(i){const t=i[Uh];for(const e in t){const r=t[e],{validate:s}=r;if(s&&!s(i[e],r))throw new Error("Invalid prop ".concat(e,": ").concat(i[e]))}}function pN(i,t){const e=uS({newProps:i,oldProps:t,propTypes:i[Uh],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=gN(i,t);let s=!1;return r||(s=mN(i,t)),{dataChanged:r,propsChanged:e,updateTriggersChanged:s,extensionsChanged:yN(i,t),transitionsChanged:fN(i,t)}}function fN(i,t){if(!i.transitions)return!1;const e={},r=i[Uh];let s=!1;for(const n in i.transitions){const c=r[n],l=c&&c.type;(l==="number"||l==="color"||l==="array")&&E_(i[n],t[n],c)&&(e[n]=!0,s=!0)}return s?e:!1}function uS(i){let{newProps:t,oldProps:e,ignoreProps:r={},propTypes:s={},triggerName:n="props"}=i;if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(n," changed shallowly");for(const c of Object.keys(t))if(!(c in r)){if(!(c in e))return"".concat(n,".").concat(c," added");const l=E_(t[c],e[c],s[c]);if(l)return"".concat(n,".").concat(c," ").concat(l)}for(const c of Object.keys(e))if(!(c in r)){if(!(c in t))return"".concat(n,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const l=E_(t[c],e[c],s[c]);if(l)return"".concat(n,".").concat(c," ").concat(l)}}return!1}function E_(i,t,e){let r=e&&e.equal;return r&&!r(i,t,e)||!r&&(r=i&&t&&i.equals,r&&!r.call(i,t))?"changed deeply":!r&&t!==i?"changed shallowly":null}function gN(i,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:r,_dataDiff:s}=i;return r?r(i.data,t.data)||(e="Data comparator detected a change"):i.data!==t.data&&(e="A new data container was supplied"),e&&s&&(e=s(i.data,t.data)||e),e}function mN(i,t){if(t===null)return{all:!0};if("all"in i.updateTriggers&&ax(i,t,"all"))return{all:!0};const e={};let r=!1;for(const s in i.updateTriggers)s!=="all"&&ax(i,t,s)&&(e[s]=!0,r=!0);return r?e:!1}function yN(i,t){if(t===null)return!0;const e=t.extensions,{extensions:r}=i;if(r===e)return!1;if(!e||!r||r.length!==e.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(e[s]))return!0;return!1}function ax(i,t,e){let r=i.updateTriggers[e];r=r??{};let s=t.updateTriggers[e];return s=s??{},uS({oldProps:s,newProps:r,triggerName:e})}const _N="count(): argument not an object",vN="count(): argument not a container";function bN(i){if(!xN(i))throw new Error(_N);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(wN(i))return Object.keys(i).length;throw new Error(vN)}function wN(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function xN(i){return i!==null&&typeof i=="object"}function AN(i,t){if(!t)return i;const e={...i,...t};if("defines"in t&&(e.defines={...i.defines,...t.defines}),"modules"in t&&(e.modules=(i.modules||[]).concat(t.modules),t.modules.some(r=>r.name==="project64"))){const r=e.modules.findIndex(s=>s.name==="project32");r>=0&&e.modules.splice(r,1)}if("inject"in t)if(!i.inject)e.inject=t.inject;else{const r={...i.inject};for(const s in t.inject)r[s]=(r[s]||"")+t.inject[s];e.inject=r}return e}const SN={10241:9987,10240:9729,10242:33071,10243:33071},C_={};function EN(i,t,e,r){if(e instanceof ua)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let s=null;e.compressed&&(s={10241:e.data.length>1?9985:9729});const n=new ua(t,{...e,parameters:{...SN,...s,...r}});return C_[n.id]=i,n}function CN(i,t){!t||!(t instanceof ua)||C_[t.id]===i&&(t.delete(),delete C_[t.id])}const TN={boolean:{validate(i,t){return!0},equal(i,t,e){return!!i==!!t}},number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},color:{validate(i,t){return t.optional&&!i||T_(i)&&(i.length===3||i.length===4)},equal(i,t,e){return ac(i,t,1)}},accessor:{validate(i,t){const e=fm(i);return e==="function"||e===fm(t.value)},equal(i,t,e){return typeof t=="function"?!0:ac(i,t,1)}},array:{validate(i,t){return t.optional&&!i||T_(i)},equal(i,t,e){const{compare:r}=e,s=Number.isInteger(r)?r:r?1:0;return r?ac(i,t,s):i===t}},object:{equal(i,t,e){if(e.ignore)return!0;const{compare:r}=e,s=Number.isInteger(r)?r:r?1:0;return r?ac(i,t,s):i===t}},function:{validate(i,t){return t.optional&&!i||typeof i=="function"},equal(i,t,e){return!e.compare&&e.ignore!==!1||i===t}},data:{transform:(i,t,e)=>{const{dataTransform:r}=e.props;return r&&i?r(i):i}},image:{transform:(i,t,e)=>{const r=e.context;return!r||!r.gl?null:EN(e.id,r.gl,i,{...t.parameters,...e.props.textureParameters})},release:(i,t,e)=>{CN(e.id,i)}}};function PN(i){const t={},e={},r={};for(const[s,n]of Object.entries(i)){const c=n==null?void 0:n.deprecatedFor;if(c)r[s]=Array.isArray(c)?c:[c];else{const l=IN(s,n);t[s]=l,e[s]=l.value}}return{propTypes:t,defaultProps:e,deprecatedProps:r}}function IN(i,t){switch(fm(t)){case"object":return Ep(i,t);case"array":return Ep(i,{type:"array",value:t,compare:!1});case"boolean":return Ep(i,{type:"boolean",value:t});case"number":return Ep(i,{type:"number",value:t});case"function":return Ep(i,{type:"function",value:t,compare:!0});default:return{name:i,type:"unknown",value:t}}}function Ep(i,t){return"type"in t?{name:i,...TN[t.type],...t}:"value"in t?{name:i,type:fm(t.value),...t}:{name:i,type:"object",value:t}}function T_(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function fm(i){return T_(i)?"array":i===null?"null":typeof i}function MN(i,t){let e;for(let n=t.length-1;n>=0;n--){const c=t[n];"extensions"in c&&(e=c.extensions)}const r=P_(i.constructor,e),s=Object.create(r);s[dm]=i,s[Bu]={},s[Fh]={};for(let n=0;n<t.length;++n){const c=t[n];for(const l in c)s[l]=c[l]}return Object.freeze(s),s}const LN="_mergedDefaultProps";function P_(i,t){let e=LN;if(t)for(const s of t){const n=s.constructor;n&&(e+=":".concat(n.extensionName||n.name))}return dS(i,e)||(i[e]=BN(i,t||[]))}function BN(i,t){if(!i.prototype)return null;const e=Object.getPrototypeOf(i),r=P_(e),s=dS(i,"defaultProps")||{},n=PN(s),c=Object.assign(Object.create(null),r,n.defaultProps),l=Object.assign(Object.create(null),r==null?void 0:r[Uh],n.propTypes),f=Object.assign(Object.create(null),r==null?void 0:r[ly],n.deprecatedProps);for(const y of t){const x=P_(y.constructor);x&&(Object.assign(c,x),Object.assign(l,x[Uh]),Object.assign(f,x[ly]))}return RN(c,i),ON(c,l),kN(c,f),c[Uh]=l,c[ly]=f,t.length===0&&!iv(i,"_propTypes")&&(i._propTypes=l),c}function RN(i,t){const e=NN(t);Object.defineProperties(i,{id:{writable:!0,value:e}})}function kN(i,t){for(const e in t)Object.defineProperty(i,e,{enumerable:!1,set(r){const s="".concat(this.id,": ").concat(e);for(const n of t[e])iv(this,n)||(this[n]=r);vr.deprecated(s,t[e].join("/"))()}})}function ON(i,t){const e={},r={};for(const s in t){const n=t[s],{name:c,value:l}=n;n.async&&(e[c]=l,r[c]=DN(c))}i[Td]=e,i[Bu]={},Object.defineProperties(i,r)}function DN(i){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||nS(t)?this[Bu][i]=t:this[Fh][i]=t},get(){if(this[Fh]){if(i in this[Fh])return this[Fh][i]||this[Td][i];if(i in this[Bu]){const t=this[dm]&&this[dm].internalState;if(t&&t.hasAsyncProp(i))return t.getAsyncProp(i)||this[Td][i]}}return this[Td][i]}}}function iv(i,t){return Object.prototype.hasOwnProperty.call(i,t)}function dS(i,t){return iv(i,t)&&i[t]}function NN(i){const t=i.componentName;return t||vr.warn("".concat(i.name,".componentName not specified"))(),t||i.name}let FN=0;class rv{constructor(){H(this,"id",void 0),H(this,"props",void 0),H(this,"count",void 0);for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.props=MN(this,e),this.id=this.props.id,this.count=FN++}clone(t){const{props:e}=this,r={};for(const s in e[Td])s in e[Fh]?r[s]=e[Fh][s]:s in e[Bu]&&(r[s]=e[Bu][s]);return new this.constructor({...e,...r,...t})}}H(rv,"componentName","Component");H(rv,"defaultProps",{});const zN=Object.freeze({});class jN{constructor(t){H(this,"component",void 0),H(this,"onAsyncPropUpdated",void 0),H(this,"asyncProps",void 0),H(this,"oldProps",void 0),H(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||zN}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[dm]||this.component;const e=t[Fh]||{},r=t[Bu]||t,s=t[Td]||{};for(const n in e){const c=e[n];this._createAsyncPropData(n,s[n]),this._updateAsyncProp(n,c),e[n]=this.getAsyncProp(n)}for(const n in r){const c=r[n];this._createAsyncPropData(n,s[n]),this._updateAsyncProp(n,c)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(nS(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const r=this.asyncProps[t];return e===r.resolvedValue||e===r.lastValue?!1:(r.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const r=this.asyncProps[t];r&&(e=this._postProcessValue(r,e),r.resolvedValue=e,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(t,e,r){const s=this.asyncProps[t];s&&r>=s.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=e,s.resolvedLoadCount=r,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const r=this.asyncProps[t];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;e.then(n=>{this.component&&(n=this._postProcessValue(r,n),this._setAsyncPropValue(t,n,s),this._onResolve(t,n))}).catch(n=>{this._onError(t,n)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const r=this.asyncProps[t];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let n=[],c=0;for await(const l of e){if(!this.component)return;const{dataTransform:f}=this.component.props;f?n=f(l,n):n=n.concat(l),Object.defineProperty(n,"__diff",{enumerable:!1,value:[{startRow:c,endRow:n.length}]}),c=n.length,this._setAsyncPropValue(t,n,s)}this._onResolve(t,n)}_postProcessValue(t,e){const r=t.type;return r&&this.component&&(r.release&&r.release(t.resolvedValue,r,this.component),r.transform)?r.transform(e,r,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const r=this.component&&this.component.props[Uh];this.asyncProps[t]={type:r&&r[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class UN extends jN{constructor(t){let{attributeManager:e,layer:r}=t;super(r),H(this,"attributeManager",void 0),H(this,"needsRedraw",void 0),H(this,"needsUpdate",void 0),H(this,"subLayers",void 0),H(this,"usesPickingColorCache",void 0),H(this,"hasPickingBuffer",void 0),H(this,"changeFlags",void 0),H(this,"viewport",void 0),H(this,"uniformTransitions",void 0),H(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(e,{propName:t,layer:r}):super._fetch(t,e)}_onResolve(t,e){const r=this.layer;if(r){const s=r.props.onDataLoad;t==="data"&&s&&s(e,{propName:t,layer:r})}}_onError(t,e){const r=this.layer;r&&r.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const GN="layer.changeFlag",VN="layer.initialize",qN="layer.update",HN="layer.finalize",WN="layer.matched",lx=2**24-1,JN=Object.freeze([]),ZN=bf(i=>{let{oldViewport:t,viewport:e}=i;return t.equals(e)});let ec=new Uint8ClampedArray(0);const XN={data:{type:"data",value:JN,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,t)=>{let{propName:e,layer:r,loaders:s,loadOptions:n,signal:c}=t;const{resourceManager:l}=r.context;if(n=n||r.getLoadOptions(),s=s||r.props.loaders,c){var f;n={...n,fetch:{...(f=n)===null||f===void 0?void 0:f.fetch,signal:c}}}let y=l.contains(i);return!y&&!n&&(l.add({resourceId:i,data:Vh(i,s),persistent:!1}),y=!0),y?l.subscribe({resourceId:i,onChange:x=>{var T;return(T=r.internalState)===null||T===void 0?void 0:T.reloadAsyncProp(e,x)},consumerId:r.id,requestId:e}):Vh(i,s,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:mr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:i=>{let{layerIndex:t}=i;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Xd extends rv{constructor(){super(...arguments),H(this,"internalState",null),H(this,"lifecycle",gd.NO_STATE),H(this,"context",void 0),H(this,"state",void 0),H(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Bn(this.internalState);const e=this.internalState.viewport||this.context.viewport,r=J3(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,n,c]=W3(r,e.pixelProjectionMatrix);return t.length===2?[s,n]:[s,n,c]}unproject(t){return Bn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){Bn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return pD(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===mr.DEFAULT||t===mr.LNGLAT||t===mr.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Bn(t instanceof Uint8Array);const[e,r,s]=t;return e+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:bN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=AN(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:r}=t.changeFlags;if(r&&e)if(Array.isArray(r))for(const s of r)e.invalidateAll(s);else e.invalidateAll();if(e){const{props:s}=t,n=this.internalState.hasPickingBuffer,c=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(n!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:l,instancePickingColors:f}=e.attributes,y=l||f;y&&(c&&y.constant&&(y.constant=!1,e.invalidate(y.id)),!y.value&&!c&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(t){for(const r of this.getModels())r.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:r,sourceLayer:s}=t;const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(t,e){var r,s;if(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),!((r=(s=this.props).onError)!==null&&r!==void 0&&r.call(s,t))){var n,c;(n=this.context)===null||n===void 0||(c=n.onError)===null||c===void 0||c.call(n,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!ZN({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,r=this.getNumInstances(),s=this.getStartIndices();t.update({data:e.data,numInstances:r,startIndices:s,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const n=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),r=Object.create(this.props);for(const s in e)Object.defineProperty(r,s,{value:e[s]});return r}return this.props}calculateInstancePickingColors(t,e){let{numInstances:r}=e;if(t.constant)return;const s=Math.floor(ec.length/3);if(this.internalState.usesPickingColorCache=!0,s<r){r>lx&&vr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ec=sf.allocate(ec,r,{size:3,copy:!0,maxCount:Math.max(r,lx)});const n=Math.floor(ec.length/3),c=[];for(let l=s;l<n;l++)this.encodePickingColor(l,c),ec[l*3+0]=c[0],ec[l*3+1]=c[1],ec[l*3+2]=c[2]}t.value=ec.subarray(0,r*3)}_setModelAttributes(t,e){const r=this.getAttributeManager(),s=t.userData.excludeAttributes||{},n=r.getShaderAttributes(e,s);t.setAttributes(n)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:r,instancePickingColors:s}=this.getAttributeManager().attributes,n=r||s,c=n&&e.attributes&&e.attributes[n.id];if(c&&c.value){const l=c.value,f=this.encodePickingColor(t);for(let y=0;y<e.length;y++){const x=n.getVertexOffset(y);l[x]===f[0]&&l[x+1]===f[1]&&l[x+2]===f[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,s=e||r;if(!s)return;const n=s.getVertexOffset(t),c=s.getVertexOffset(t+1);s.buffer.subData({data:new Uint8Array(c-n),offset:n})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,r=t||e;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==ec.buffer&&(r.value=ec.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Bn(!this.internalState),Bn(Number.isFinite(this.props.coordinateSystem)),$n(VN,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new UN({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(vr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new uN(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){$n(WN,this,this===t);const{state:e,internalState:r}=t;this!==t&&(this.internalState=r,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if($n(qN,this,t),!t)return;const e=this.props,r=this.context,s=this.internalState,n=r.viewport,c=this._updateUniformTransition();s.propsInTransition=c,r.viewport=s.viewport||n,this.props=c;try{const l=this._getUpdateParams(),f=this.getModels();if(r.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const x of this.props.extensions)x.updateState.call(this,l,x);const y=this.getModels()[0]!==f[0];this._postUpdate(l,y)}finally{r.viewport=n,this.props=e,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){$n(HN,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:r={},parameters:s={}}=t;this._updateAttributeTransition();const n=this.props,c=this.context;this.props=this.internalState.propsInTransition||n;const l=this.props.opacity;r.opacity=Math.pow(l,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:f}=this.props,y=f&&f(r)||[0,0];Yc(c.gl,{polygonOffset:y}),Pl(c.gl,s,()=>{const x={moduleParameters:e,uniforms:r,parameters:s,context:c};for(const T of this.props.extensions)T.draw.call(this,x,T);this.draw(x)})}finally{this.props=n}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const s in t)if(t[s]){let n=!1;switch(s){case"dataChanged":const c=t[s],l=e[s];c&&Array.isArray(l)&&(e.dataChanged=Array.isArray(c)?l.concat(c):c,n=!0);default:e[s]||(e[s]=t[s],n=!0)}n&&$n(GN,this,s,t)}const r=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=r,e.somethingChanged=r||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const r=pN(t,e);if(r.updateTriggersChanged)for(const n in r.updateTriggersChanged)r.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(r.transitionsChanged)for(const n in r.transitionsChanged){var s;this.internalState.uniformTransitions.add(n,e[n],t[n],(s=t.transitions)===null||s===void 0?void 0:s[n])}return this.setChangeFlags(r)}validateProps(){dN(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:r}=this.props;t.picked&&typeof r=="function"&&(e.pickingHighlightColor=r(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new oN(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:r,oldProps:s}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:n}=this.state;n==null||n.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:l,highlightColor:f}=r;if(e||s.autoHighlight!==c||s.highlightedObjectIndex!==l||s.highlightColor!==f){const y={};c||(y.pickingSelectedColor=null),Array.isArray(f)&&(y.pickingHighlightColor=f),(e||l!==s.highlightedObjectIndex)&&(y.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(y)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(t):!1;if(e=e||s,e)for(const n of this.props.extensions)n.onNeedsRedraw.call(this,n);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}H(Xd,"defaultProps",XN);H(Xd,"layerName","Layer");const $N="compositeLayer.renderLayers";class pS extends Xd{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:r}=this.props;return r&&r[t]&&r[t].type||e}getSubLayerRow(t,e,r){return t.__source={parent:this,object:e,index:r},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(r,s)=>r&&r.__source?(e.index=r.__source.index,t(r.__source.object,e)):t(r,s)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;const{opacity:r,pickable:s,visible:n,parameters:c,getPolygonOffset:l,highlightedObjectIndex:f,autoHighlight:y,highlightColor:x,coordinateSystem:T,coordinateOrigin:P,wrapLongitude:M,positionFormat:N,modelMatrix:G,extensions:Z,fetch:X,operation:$,_subLayerProps:ct}=this.props,yt={id:"",updateTriggers:{},opacity:r,pickable:s,visible:n,parameters:c,getPolygonOffset:l,highlightedObjectIndex:f,autoHighlight:y,highlightColor:x,coordinateSystem:T,coordinateOrigin:P,wrapLongitude:M,positionFormat:N,modelMatrix:G,extensions:Z,fetch:X,operation:$},Mt=ct&&t.id&&ct[t.id],Nt=Mt&&Mt.updateTriggers,Rt=t.id||"sublayer";if(Mt){const xt=this.props[Uh],qt=t.type?t.type._propTypes:{};for(const zt in Mt){const ot=qt[zt]||xt[zt];ot&&ot.type==="accessor"&&(Mt[zt]=this.getSubLayerAccessor(Mt[zt]))}}Object.assign(yt,t,Mt),yt.id="".concat(this.props.id,"-").concat(Rt),yt.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...Nt};for(const xt of Z){const qt=xt.getSubLayerProps.call(this,xt);qt&&Object.assign(yt,qt,{updateTriggers:Object.assign(yt.updateTriggers,qt.updateTriggers)})}return yt}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let r=this.internalState.subLayers;const s=!r||this.needsUpdate();if(s){const n=this.renderLayers();r=Im(n,Boolean),this.internalState.subLayers=r}$n($N,this,s,r);for(const n of r)n.parent=this}}H(pS,"layerName","CompositeLayer");const dy=512,KN=Math.PI/180;function YN(i){let{map:t,gl:e,deck:r}=i;if(t.__deck)return t.__deck;const s=r==null?void 0:r.props._customRender,n=r==null?void 0:r.props.onLoad,c=tF({...r==null?void 0:r.props,_customRender:()=>{t.triggerRepaint(),s==null||s("")}});let l;return(!r||r.props.gl===e)&&(Object.assign(c,{gl:e,width:null,height:null,touchAction:"unset",viewState:sv(t)}),r!=null&&r.isInitialized?cx(r,t):c.onLoad=()=>{n==null||n(),cx(l,t)}),r?(l=r,r.setProps(c),r.userData.isExternal=!0):(l=new Q1(c),t.on("remove",()=>{QN(t)})),l.userData.mapboxLayers=new Set,t.__deck=l,t.on("render",()=>{l.isInitialized&&oF(l,t)}),l}function cx(i,t){const e=()=>{i.isInitialized?aF(i,t):t.off("move",e)};t.on("move",e)}function QN(i){var t;(t=i.__deck)===null||t===void 0||t.finalize(),i.__deck=null}function tF(i){return{...i,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new K1({id:"mapbox"})]}}function eF(i,t){i.userData.mapboxLayers.add(t),nv(i)}function iF(i,t){i.userData.mapboxLayers.delete(t),nv(i)}function rF(i,t){nv(i)}function sF(i,t,e){let{currentViewport:r}=i.userData,s=!1;r||(r=fS(i,t,!0),i.userData.currentViewport=r,s=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:n=>{let{layer:c}=n;return e.id===c.id||c.props.operation.includes("terrain")},clearStack:s,clearCanvas:!1})}function sv(i){var t;const{lng:e,lat:r}=i.getCenter(),s={longitude:(e+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(t=i.getTerrain)!==null&&t!==void 0&&t.call(i)&&nF(i,s),s}function nF(i,t){if(i.getFreeCameraOptions){const{position:e}=i.getFreeCameraOptions();if(!e||e.z===void 0)return;const r=i.transform.height,{longitude:s,latitude:n,pitch:c}=t,l=e.x*dy,f=(1-e.y)*dy,y=e.z*dy,x=rf([s,n]),T=l-x[0],P=f-x[1],M=Math.sqrt(T*T+P*P),N=c*KN,G=1.5*r,Z=N<.001?G*Math.cos(N)/y:G*Math.sin(N)/M;t.zoom=Math.log2(Z);const X=G*Math.cos(N)/Z,$=y-X;t.position=[0,0,$/kg(n)]}else typeof i.transform.elevation=="number"&&(t.position=[0,0,i.transform.elevation])}function fS(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Lu({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...sv(t),nearZMultiplier:e?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function oF(i,t){const{mapboxLayers:e,isExternal:r}=i.userData;if(r){const s=Array.from(e,y=>y.id),n=Im(i.props.layers,Boolean).some(y=>y&&!s.includes(y.id));let c=i.getViewports();const l=c.findIndex(y=>y.id==="mapbox"),f=c.length>1||l<0;(n||f)&&(l>=0&&(c=c.slice(),c[l]=fS(i,t,!1)),i._drawLayers("mapbox-repaint",{viewports:c,layerFilter:y=>(!i.props.layerFilter||i.props.layerFilter(y))&&(y.viewport.id!=="mapbox"||!s.includes(y.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function aF(i,t){i.setProps({viewState:sv(t)}),i.needsRedraw({clearRedrawFlags:!0})}function nv(i){if(i.userData.isExternal)return;const t=[];i.userData.mapboxLayers.forEach(e=>{const r=e.props.type,s=new r(e.props);t.push(s)}),i.setProps({layers:t})}class lF{constructor(t){if(H(this,"id",void 0),H(this,"type",void 0),H(this,"renderingMode",void 0),H(this,"map",void 0),H(this,"deck",void 0),H(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=YN({map:t,gl:e,deck:this.props.deck}),eF(this.deck,this)}onRemove(){this.deck&&iF(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&rF(this.deck)}render(){sF(this.deck,this.map,this)}}const cF=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,hF=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,gS=[0,0,0,255],mS=[0,0,1],uF={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:mS},getColor:{type:"accessor",value:gS},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function dF(i){const{header:t,attributes:e}=i;!t||!e||(i.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}class ov extends Xd{getShaders(){return super.getShaders({vs:cF,fs:hF,modules:[X1,Rk,$1]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:mS},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:gS}})}updateState(t){const{changeFlags:e,props:r}=t;if(super.updateState(t),e.extensionsChanged){var s;const{gl:n}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(n),this.getAttributeManager().invalidateAll()}e.dataChanged&&dF(r.data)}draw(t){let{uniforms:e}=t;const{pointSize:r,sizeUnits:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:o_[s],radiusPixels:r}).draw()}_getModel(t){const e=[];for(let r=0;r<3;r++){const s=r/3*Math.PI*2;e.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new jd(t,{...this.getShaders(),id:this.props.id,geometry:new Wp({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}H(ov,"layerName","PointCloudLayer");H(ov,"defaultProps",uF);const la={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new re;new re;const Cp=new re,hx=new re;class Af{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;H(this,"center",void 0),H(this,"radius",void 0),this.radius=-0,this.center=new re,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Cp.from(e),this.center=new re().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Af(this.center,this.radius)}union(t){const e=this.center,r=this.radius,s=t.center,n=t.radius,c=Cp.copy(s).subtract(e),l=c.magnitude();if(r>=l+n)return this.clone();if(n>=l+r)return t.clone();const f=(r+l+n)*.5;return hx.copy(c).scale((-r+f)/l).add(e),this.center.copy(hx),this.radius=f,this}expand(t){const e=Cp.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=jR(Cp,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=Cp.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,r=this.radius,s=t.normal.dot(e)+t.distance;return s<-r?la.OUTSIDE:s<r?la.INTERSECTING:la.INSIDE}}const pF=new re,fF=new re,pg=new re,fg=new re,gg=new re,gF=new re,mF=new re,jc={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Sf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];H(this,"center",void 0),H(this,"halfAxes",void 0),this.center=new re().from(t),this.halfAxes=new Rs(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new re(t).len(),new re(e).len(),new re(r).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),s=new re(t).normalize(),n=new re(e).normalize(),c=new re(r).normalize();return new tf().fromMatrix3(new Rs([...s,...n,...c]))}fromCenterHalfSizeQuaternion(t,e,r){const s=new tf(r),n=new Rs().fromQuaternion(s);return n[0]=n[0]*e[0],n[1]=n[1]*e[0],n[2]=n[2]*e[0],n[3]=n[3]*e[1],n[4]=n[4]*e[1],n[5]=n[5]*e[1],n[6]=n[6]*e[2],n[7]=n[7]*e[2],n[8]=n[8]*e[2],this.center=new re().from(t),this.halfAxes=n,this}clone(){return new Sf(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Af;const e=this.halfAxes,r=e.getColumn(0,pg),s=e.getColumn(1,fg),n=e.getColumn(2,gg),c=pF.copy(r).add(s).add(n);return t.center.copy(this.center),t.radius=c.magnitude(),t}intersectPlane(t){const e=this.center,r=t.normal,s=this.halfAxes,n=r.x,c=r.y,l=r.z,f=Math.abs(n*s[jc.COLUMN0ROW0]+c*s[jc.COLUMN0ROW1]+l*s[jc.COLUMN0ROW2])+Math.abs(n*s[jc.COLUMN1ROW0]+c*s[jc.COLUMN1ROW1]+l*s[jc.COLUMN1ROW2])+Math.abs(n*s[jc.COLUMN2ROW0]+c*s[jc.COLUMN2ROW1]+l*s[jc.COLUMN2ROW2]),y=r.dot(e)+t.distance;return y<=-f?la.OUTSIDE:y>=f?la.INSIDE:la.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=fF.from(t).subtract(this.center),r=this.halfAxes,s=r.getColumn(0,pg),n=r.getColumn(1,fg),c=r.getColumn(2,gg),l=s.magnitude(),f=n.magnitude(),y=c.magnitude();s.normalize(),n.normalize(),c.normalize();let x=0,T;return T=Math.abs(e.dot(s))-l,T>0&&(x+=T*T),T=Math.abs(e.dot(n))-f,T>0&&(x+=T*T),T=Math.abs(e.dot(c))-y,T>0&&(x+=T*T),x}computePlaneDistances(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const c=this.center,l=this.halfAxes,f=l.getColumn(0,pg),y=l.getColumn(1,fg),x=l.getColumn(2,gg),T=gF.copy(f).add(y).add(x).add(c),P=mF.copy(T).subtract(t);let M=e.dot(P);return s=Math.min(M,s),n=Math.max(M,n),T.copy(c).add(f).add(y).subtract(x),P.copy(T).subtract(t),M=e.dot(P),s=Math.min(M,s),n=Math.max(M,n),T.copy(c).add(f).subtract(y).add(x),P.copy(T).subtract(t),M=e.dot(P),s=Math.min(M,s),n=Math.max(M,n),T.copy(c).add(f).subtract(y).subtract(x),P.copy(T).subtract(t),M=e.dot(P),s=Math.min(M,s),n=Math.max(M,n),c.copy(T).subtract(f).add(y).add(x),P.copy(T).subtract(t),M=e.dot(P),s=Math.min(M,s),n=Math.max(M,n),c.copy(T).subtract(f).add(y).subtract(x),P.copy(T).subtract(t),M=e.dot(P),s=Math.min(M,s),n=Math.max(M,n),c.copy(T).subtract(f).subtract(y).add(x),P.copy(T).subtract(t),M=e.dot(P),s=Math.min(M,s),n=Math.max(M,n),c.copy(T).subtract(f).subtract(y).subtract(x),P.copy(T).subtract(t),M=e.dot(P),s=Math.min(M,s),n=Math.max(M,n),r[0]=s,r[1]=n,r}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,pg);e.transformAsPoint(t);const r=this.halfAxes.getColumn(1,fg);r.transformAsPoint(t);const s=this.halfAxes.getColumn(2,gg);return s.transformAsPoint(t),this.halfAxes=new Rs([...e,...r,...s]),this}getTransform(){throw new Error("not implemented")}}const ux=new re,dx=new re;class Sl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;H(this,"normal",void 0),H(this,"distance",void 0),this.normal=new re,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return El(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=ux.from(t),this.normal.from(e).normalize();const r=-this.normal.dot(t);return this.distance=r,this}fromCoefficients(t,e,r,s){return this.normal.set(t,e,r),El(Il(this.normal.len(),1)),this.distance=s,this}clone(){return new Sl(this.normal,this.distance)}equals(t){return Il(this.distance,t.distance)&&Il(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=dx.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}projectPointOntoPlane(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=ux.from(t);const r=this.getPointDistance(t),s=dx.copy(this.normal).scale(r);return t.subtract(s).to(e)}}const px=[new re([1,0,0]),new re([0,1,0]),new re([0,0,1])],fx=new re,yF=new re;new Sl(new re(1,0,0),0);class za{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];H(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*px.length;const e=t.center,r=t.radius;let s=0;for(const n of px){let c=this.planes[s],l=this.planes[s+1];c||(c=this.planes[s]=new Sl),l||(l=this.planes[s+1]=new Sl);const f=fx.copy(n).scale(-r).add(e);-n.dot(f),c.fromPointNormal(f,n);const y=fx.copy(n).scale(r).add(e),x=yF.copy(n).negate();-x.dot(y),l.fromPointNormal(y,x),s+=2}return this}computeVisibility(t){let e=la.INSIDE;for(const r of this.planes)switch(t.intersectPlane(r)){case la.OUTSIDE:return la.OUTSIDE;case la.INTERSECTING:e=la.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(El(Number.isFinite(e),"parentPlaneMask is required."),e===za.MASK_OUTSIDE||e===za.MASK_INSIDE)return e;let r=za.MASK_INSIDE;const s=this.planes;for(let n=0;n<this.planes.length;++n){const c=n<31?1<<n:0;if(n<31&&!(e&c))continue;const l=s[n],f=t.intersectPlane(l);if(f===la.OUTSIDE)return za.MASK_OUTSIDE;f===la.INTERSECTING&&(r|=c)}return r}}H(za,"MASK_OUTSIDE",4294967295);H(za,"MASK_INSIDE",0);H(za,"MASK_INDETERMINATE",2147483647);new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;new re;const ic=new Rs,_F=new Rs,vF=new Rs,mg=new Rs,gx=new Rs;function bF(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=ef.EPSILON20,r=10;let s=0,n=0;const c=_F,l=vF;c.identity(),l.copy(i);const f=e*wF(l);for(;n<r&&xF(l)>f;)AF(l,mg),gx.copy(mg).transpose(),l.multiplyRight(mg),l.multiplyLeft(gx),c.multiplyRight(mg),++s>2&&(++n,s=0);return t.unitary=c.toTarget(t.unitary),t.diagonal=l.toTarget(t.diagonal),t}function wF(i){let t=0;for(let e=0;e<9;++e){const r=i[e];t+=r*r}return Math.sqrt(t)}const I_=[1,0,0],M_=[2,2,1];function xF(i){let t=0;for(let e=0;e<3;++e){const r=i[ic.getElementIndex(M_[e],I_[e])];t+=2*r*r}return Math.sqrt(t)}function AF(i,t){const e=ef.EPSILON15;let r=0,s=1;for(let y=0;y<3;++y){const x=Math.abs(i[ic.getElementIndex(M_[y],I_[y])]);x>r&&(s=y,r=x)}const n=I_[s],c=M_[s];let l=1,f=0;if(Math.abs(i[ic.getElementIndex(c,n)])>e){const y=i[ic.getElementIndex(c,c)],x=i[ic.getElementIndex(n,n)],T=i[ic.getElementIndex(c,n)],P=(y-x)/2/T;let M;P<0?M=-1/(-P+Math.sqrt(1+P*P)):M=1/(P+Math.sqrt(1+P*P)),l=1/Math.sqrt(1+M*M),f=M*l}return Rs.IDENTITY.to(t),t[ic.getElementIndex(n,n)]=t[ic.getElementIndex(c,c)]=l,t[ic.getElementIndex(c,n)]=f,t[ic.getElementIndex(n,c)]=-f,t}const Lh=new re,SF=new re,EF=new re,CF=new re,TF=new re,PF=new Rs,IF={diagonal:new Rs,unitary:new Rs};function MF(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Sf;if(!i||i.length===0)return t.halfAxes=new Rs([0,0,0,0,0,0,0,0,0]),t.center=new re,t;const e=i.length,r=new re(0,0,0);for(const qt of i)r.add(qt);const s=1/e;r.multiplyByScalar(s);let n=0,c=0,l=0,f=0,y=0,x=0;for(const qt of i){const zt=Lh.copy(qt).subtract(r);n+=zt.x*zt.x,c+=zt.x*zt.y,l+=zt.x*zt.z,f+=zt.y*zt.y,y+=zt.y*zt.z,x+=zt.z*zt.z}n*=s,c*=s,l*=s,f*=s,y*=s,x*=s;const T=PF;T[0]=n,T[1]=c,T[2]=l,T[3]=c,T[4]=f,T[5]=y,T[6]=l,T[7]=y,T[8]=x;const{unitary:P}=bF(T,IF),M=t.halfAxes.copy(P);let N=M.getColumn(0,EF),G=M.getColumn(1,CF),Z=M.getColumn(2,TF),X=-Number.MAX_VALUE,$=-Number.MAX_VALUE,ct=-Number.MAX_VALUE,yt=Number.MAX_VALUE,Mt=Number.MAX_VALUE,Nt=Number.MAX_VALUE;for(const qt of i)Lh.copy(qt),X=Math.max(Lh.dot(N),X),$=Math.max(Lh.dot(G),$),ct=Math.max(Lh.dot(Z),ct),yt=Math.min(Lh.dot(N),yt),Mt=Math.min(Lh.dot(G),Mt),Nt=Math.min(Lh.dot(Z),Nt);N=N.multiplyByScalar(.5*(yt+X)),G=G.multiplyByScalar(.5*(Mt+$)),Z=Z.multiplyByScalar(.5*(Nt+ct)),t.center.copy(N).add(G).add(Z);const Rt=SF.set(X-yt,$-Mt,ct-Nt).multiplyByScalar(.5),xt=new Rs([Rt[0],0,0,0,Rt[1],0,0,0,Rt[2]]);return t.halfAxes.multiplyRight(xt),t}const py=Math.PI/180,yg=new Float32Array(16),mx=new Float32Array(12);function yx(i,t,e){const r=t[0]*py,s=t[1]*py,n=t[2]*py,c=Math.sin(n),l=Math.sin(r),f=Math.sin(s),y=Math.cos(n),x=Math.cos(r),T=Math.cos(s),P=e[0],M=e[1],N=e[2];i[0]=P*T*x,i[1]=P*f*x,i[2]=P*-l,i[3]=M*(-f*y+T*l*c),i[4]=M*(T*y+f*l*c),i[5]=M*x*c,i[6]=N*(f*c+T*l*y),i[7]=N*(-T*c+f*l*y),i[8]=N*x*y}function _x(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const yS={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,t){let{startRow:e,endRow:r}=t;const{data:s,getOrientation:n,getScale:c,getTranslation:l,getTransformMatrix:f}=this.props,y=Array.isArray(f),x=y&&f.length===16,T=Array.isArray(c),P=Array.isArray(n),M=Array.isArray(l),N=x||!y&&!!f(s[0]);N?i.constant=x:i.constant=P&&T&&M;const G=i.value;if(i.constant){let Z;N?(yg.set(f),Z=_x(yg)):(Z=mx,yx(Z,n,c),Z.set(l,9)),i.value=new Float32Array(Z)}else{let Z=e*i.size;const{iterable:X,objectInfo:$}=sS(s,e,r);for(const ct of X){$.index++;let yt;if(N)yg.set(x?f:f(ct,$)),yt=_x(yg);else{yt=mx;const Mt=P?n:n(ct,$),Nt=T?c:c(ct,$);yx(yt,Mt,Nt),yt.set(M?l:l(ct,$),9)}G[Z++]=yt[0],G[Z++]=yt[1],G[Z++]=yt[2],G[Z++]=yt[3],G[Z++]=yt[4],G[Z++]=yt[5],G[Z++]=yt[6],G[Z++]=yt[7],G[Z++]=yt[8],G[Z++]=yt[9],G[Z++]=yt[10],G[Z++]=yt[11]}}}};function _S(i,t){return t===mr.CARTESIAN||t===mr.METER_OFFSETS||t===mr.DEFAULT&&!i.isGeospatial}const LF=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,BF=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function vS(i){let t=1/0,e=1/0,r=1/0,s=-1/0,n=-1/0,c=-1/0;const l=i.POSITION?i.POSITION.value:[],f=l&&l.length;for(let y=0;y<f;y+=3){const x=l[y],T=l[y+1],P=l[y+2];t=x<t?x:t,e=T<e?T:e,r=P<r?P:r,s=x>s?x:s,n=T>n?T:n,c=P>c?P:c}return[[t,e,r],[s,n,c]]}function RF(i,t){if(!i)throw new Error(t||"loader assertion failed.")}class xd{constructor(t,e){H(this,"fields",void 0),H(this,"metadata",void 0),RF(Array.isArray(t)),kF(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];for(const c of r)t[c]=!0;const n=this.fields.filter(c=>t[c.name]);return new xd(n,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const s=e.map(n=>this.fields[n]).filter(Boolean);return new xd(s,this.metadata)}assign(t){let e,r=this.metadata;if(t instanceof xd){const c=t;e=c.fields,r=vx(vx(new Map,this.metadata),c.metadata)}else e=t;const s=Object.create(null);for(const c of this.fields)s[c.name]=c;for(const c of e)s[c.name]=c;const n=Object.values(s);return new xd(n,r)}}function kF(i){const t={};for(const e of i)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function vx(i,t){return new Map([...i||new Map,...t||new Map])}class gm{constructor(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;H(this,"name",void 0),H(this,"type",void 0),H(this,"nullable",void 0),H(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=r,this.metadata=s}get typeId(){return this.type&&this.type.typeId}clone(){return new gm(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Ls=function(i){return i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i}({}),bS,wS,xS;class av{static isNull(t){return t&&t.typeId===Ls.Null}static isInt(t){return t&&t.typeId===Ls.Int}static isFloat(t){return t&&t.typeId===Ls.Float}static isBinary(t){return t&&t.typeId===Ls.Binary}static isUtf8(t){return t&&t.typeId===Ls.Utf8}static isBool(t){return t&&t.typeId===Ls.Bool}static isDecimal(t){return t&&t.typeId===Ls.Decimal}static isDate(t){return t&&t.typeId===Ls.Date}static isTime(t){return t&&t.typeId===Ls.Time}static isTimestamp(t){return t&&t.typeId===Ls.Timestamp}static isInterval(t){return t&&t.typeId===Ls.Interval}static isList(t){return t&&t.typeId===Ls.List}static isStruct(t){return t&&t.typeId===Ls.Struct}static isUnion(t){return t&&t.typeId===Ls.Union}static isFixedSizeBinary(t){return t&&t.typeId===Ls.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Ls.FixedSizeList}static isMap(t){return t&&t.typeId===Ls.Map}static isDictionary(t){return t&&t.typeId===Ls.Dictionary}get typeId(){return Ls.NONE}compareTo(t){return this===t}}bS=Symbol.toStringTag;class $d extends av{constructor(t,e){super(),H(this,"isSigned",void 0),H(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Ls.Int}get[bS](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class OF extends $d{constructor(){super(!0,8)}}class DF extends $d{constructor(){super(!0,16)}}class NF extends $d{constructor(){super(!0,32)}}class FF extends $d{constructor(){super(!1,8)}}class zF extends $d{constructor(){super(!1,16)}}class jF extends $d{constructor(){super(!1,32)}}const AS={HALF:16,SINGLE:32,DOUBLE:64};wS=Symbol.toStringTag;class SS extends av{constructor(t){super(),H(this,"precision",void 0),this.precision=t}get typeId(){return Ls.Float}get[wS](){return"Float"}toString(){return"Float".concat(this.precision)}}class UF extends SS{constructor(){super(AS.SINGLE)}}class GF extends SS{constructor(){super(AS.DOUBLE)}}xS=Symbol.toStringTag;class VF extends av{constructor(t,e){super(),H(this,"listSize",void 0),H(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Ls.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[xS](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function qF(i){switch(i.constructor){case Int8Array:return new OF;case Uint8Array:return new FF;case Int16Array:return new DF;case Uint16Array:return new zF;case Int32Array:return new NF;case Uint32Array:return new jF;case Float32Array:return new UF;case Float64Array:return new GF;default:throw new Error("array type not supported")}}function HF(i,t,e){const r=qF(t.value),s=e||WF(t);return new gm(i,new VF(t.size,new gm("value",r)),!1,s)}function WF(i){const t=new Map;return"byteOffset"in i&&t.set("byteOffset",i.byteOffset.toString(10)),"byteStride"in i&&t.set("byteStride",i.byteStride.toString(10)),"normalized"in i&&t.set("normalized",i.normalized.toString()),t}function bx(i,t){(i.COLOR_0||i.colors)&&t||(i.colors={constant:!0,value:new Float32Array([1,1,1])}),vr.assert(i.positions||i.POSITION,'no "postions" or "POSITION" attribute in mesh')}function wx(i,t){if(i.attributes)return bx(i.attributes,t),i instanceof Wp?i:new Wp(i);if(i.positions||i.POSITION)return bx(i,t),new Wp({attributes:i});throw Error("Invalid mesh")}const JF=[0,0,0,255],ZF={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:JF},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class lv extends Xd{constructor(){super(...arguments),H(this,"state",void 0)}getShaders(){const t=!ir(this.context.gl),e={};return I1(this.context.gl,is.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:LF,fs:BF,modules:[X1,kk,$1],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=(t=r.header)===null||t===void 0?void 0:t.boundingBox,!e){const{attributes:s}=wx(r,this.props._useMeshColors);s.POSITION=s.POSITION||s.positions,e=vS(s)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:yS}),this.setState({emptyTexture:new ua(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:r,changeFlags:s}=t;if(e.mesh!==r.mesh||s.extensionsChanged){var n;if(this.state.positionBounds=null,(n=this.state.model)===null||n===void 0||n.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const c=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(c.NORMAL||c.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==r.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:e}=t;if(!this.state.model)return;const{viewport:r}=this.context,{sizeScale:s,coordinateSystem:n,_instanced:c}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:s,composeModelMatrix:!c||_S(r,n),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const e=new jd(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:wx(t,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:s}=this.state;return e.setUniforms({sampler:r||s,hasTexture:!!r}),e}setTexture(t){const{emptyTexture:e,model:r}=this.state;r&&r.setUniforms({sampler:t||e,hasTexture:!!t})}}H(lv,"defaultProps",ZF);H(lv,"layerName","SimpleMeshLayer");class Pd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e}=t;this.id=e||Qc(this.constructor.name),this.display=!0,this.position=new re,this.rotation=new re,this.scale=new re(1,1,1),this.matrix=new cr,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return ei(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return ei(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return ei(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){!(arguments.length>1&&arguments[1]!==void 0)||arguments[1]?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:e,rotation:r,scale:s,update:n=!0}=t;return e&&this.setPosition(e),r&&this.setRotation(r),s&&this.setScale(s),n&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(r),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:e,rotation:r,scale:s}=t;return e&&this.setPosition(e),r&&this.setRotation(r),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(t,e){ei(t),e=e||this.matrix;const r=new cr(t).multiplyRight(e),s=r.invert(),n=s.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:r,worldInverseMatrix:s,worldInverseTransposeMatrix:n}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class Jp extends Pd{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;ci.assert(e.every(r=>r instanceof Pd),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const s of e)Array.isArray(s)?this.add(...s):this.children.push(s);return this}remove(t){const e=this.children,r=e.indexOf(t);return r>-1&&e.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,r)=>{let{worldMatrix:s}=r;const n=e.getBounds();if(!n)return;const[c,l]=n,f=new re(c).add(l).divide([2,2,2]);s.transformAsPoint(f,f);const y=new re(l).subtract(c).divide([2,2,2]);s.transformAsVector(y,y);for(let x=0;x<8;x++){const T=new re(x&1?-1:1,x&2?-1:1,x&4?-1:1).multiply(y).add(f);for(let P=0;P<3;P++)t[0][P]=Math.min(t[0][P],T[P]),t[1][P]=Math.max(t[1][P],T[P])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new cr}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new cr(e).multiplyRight(this.matrix);for(const s of this.children)s instanceof Jp?s.traverse(t,{worldMatrix:r}):t(s,{worldMatrix:r})}}const XF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$F={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function xx(i){if(!i._animation){const t=$F[i.componentType],e=XF[i.type],r=e*i.count,{buffer:s,byteOffset:n}=i.bufferView.data,c=new t(s,n+(i.byteOffset||0),r);if(e===1)i._animation=Array.from(c);else{const l=[];for(let f=0;f<c.length;f+=e)l.push(Array.from(c.slice(f,f+e)));i._animation=l}}return i._animation}const KF=new cr;function YF(i,t){if(t.matrix.identity(),i.translation&&t.matrix.translate(i.translation),i.rotation){const e=KF.fromQuaternion(i.rotation);t.matrix.multiplyRight(e)}i.scale&&t.matrix.scale(i.scale)}const fy=new tf;function QF(i,t,e,r,s){if(t==="rotation"){fy.slerp({start:e,target:r,ratio:s});for(let n=0;n<fy.length;n++)i[t][n]=fy[n]}else for(let n=0;n<e.length;n++)i[t][n]=s*r[n]+(1-s)*e[n]}function tz(i,t,e){let{p0:r,outTangent0:s,inTangent1:n,p1:c,tDiff:l,ratio:f}=e;for(let y=0;y<i[t].length;y++){const x=s[y]*l,T=n[y]*l;i[t][y]=(2*Math.pow(f,3)-3*Math.pow(f,2)+1)*r[y]+(Math.pow(f,3)-2*Math.pow(f,2)+f)*x+(-2*Math.pow(f,3)+3*Math.pow(f,2))*c[y]+(Math.pow(f,3)-Math.pow(f,2))*T}}function ez(i,t,e){for(let r=0;r<e.length;r++)i[t][r]=e[r]}function iz(i,t,e,r){let{input:s,interpolation:n,output:c}=t;const l=s[s.length-1],f=i%l,y=s.findIndex(M=>M>=f),x=Math.max(0,y-1);if(!Array.isArray(e[r]))switch(r){case"translation":e[r]=[0,0,0];break;case"rotation":e[r]=[0,0,0,1];break;case"scale":e[r]=[1,1,1];break;default:ci.warn("Bad animation path ".concat(r))()}ei(e[r].length===c[x].length);const T=s[x],P=s[y];switch(n){case"STEP":ez(e,r,c[x]);break;case"LINEAR":if(P>T){const M=(f-T)/(P-T);QF(e,r,c[x],c[y],M)}break;case"CUBICSPLINE":if(P>T){const M=(f-T)/(P-T),N=P-T,G=c[3*x+1],Z=c[3*x+2],X=c[3*y+0],$=c[3*y+1];tz(e,r,{p0:G,outTangent0:Z,inTangent1:X,p1:$,tDiff:N,ratio:M})}break;default:ci.warn("Interpolation ".concat(n," not supported"))();break}}class rz{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const e=(t/1e3-this.startTime)*this.speed;this.channels.forEach(r=>{let{sampler:s,target:n,path:c}=r;iz(e,s,n,c),YF(n,n._node)})}}class sz{constructor(t){this.animations=t.animations.map((e,r)=>{const s=e.name||"Animation-".concat(r),n=e.samplers.map(l=>{let{input:f,interpolation:y="LINEAR",output:x}=l;return{input:xx(t.accessors[f]),interpolation:y,output:xx(t.accessors[x])}}),c=e.channels.map(l=>{let{sampler:f,target:y}=l;return{sampler:n[f],target:t.nodes[y.node],path:y.path}});return new rz({name:s,channels:c})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class nz extends Pd{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof jd?(this.model=t,this._setModelNodeProps(e)):this.model=new jd(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class ES{constructor(t,e){let{attributes:r,material:s,pbrDebug:n,imageBasedLightingEnvironment:c,lights:l,useTangents:f}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},I1(t,is.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],c&&(this.uniforms.u_DiffuseEnvSampler=c.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=c.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=c.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),n&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&f,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(c,"USE_IBL"),this.defineIfPresent(l,"USE_LIGHTS"),this.defineIfPresent(n,"PBR_DEBUG"),s&&this.parseMaterial(s)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const s=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},n=t.texture.source.image;let c,l={};n.compressed?(c=n,l={[this.gl.TEXTURE_MIN_FILTER]:n.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):c={data:n};const f=new ua(this.gl,{id:t.name||t.id,parameters:{...s,...l},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...c});this.uniforms[e]=f,this.defineIfPresent(r,r),this.generatedTextures.push(f)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:r=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,r]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else t.alphaMode==="BLEND"&&(ci.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const oz=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,az=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Ax(i,t){return ir(i)?`#version 300 es
`.concat(t):t}function lz(i,t){const{id:e,drawMode:r,vertexCount:s,attributes:n,modelOptions:c}=t,l=new ES(i,t);ci.info(4,"createGLTFModel defines: ",l.defines)();const f=[];f.push(...l.generatedTextures),f.push(...Object.values(n).map(x=>x.buffer));const y=new nz(i,{id:e,drawMode:r,vertexCount:s,modules:[G1],parameters:l.parameters,vs:Ax(i,oz),fs:Ax(i,az),managedResources:f,...c,defines:{...l.defines,...c.defines}});return y.setProps({attributes:n}),y.setUniforms(l.uniforms),y}const cz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hz={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class uz{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},hz,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(e=>this.createScene(e))}createAnimator(){return Array.isArray(this.gltf.animations)?new sz(this.gltf):null}createScene(t){const e=(t.nodes||[]).map(r=>this.createNode(r));return new Jp({id:t.name||t.id,children:e})}createNode(t){if(!t._node){const e=(t.children||[]).map(s=>this.createNode(s));t.mesh&&e.push(this.createMesh(t.mesh));const r=new Jp({id:t.name||t.id,children:e});if(t.matrix)r.setMatrix(t.matrix);else{if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){const s=new cr().fromQuaternion(t.rotation);r.matrix.multiplyRight(s)}t.scale&&r.matrix.scale(t.scale)}t._node=r}return t._node}createMesh(t){if(!t._mesh){const e=(t.primitives||[]).map((s,n)=>this.createPrimitive(s,n,t)),r=new Jp({id:t.name||t.id,children:e});t._mesh=r}return t._mesh}getVertexCount(t){ci.warn("getVertexCount() not found")()}createPrimitive(t,e,r){const s=lz(this.gl,Object.assign({id:t.name||"".concat(r.name||r.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return s.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],s}createAttributes(t,e){const r={};return Object.keys(t).forEach(s=>{r[s]=this.createAccessor(t[s],this.createBuffer(t[s],this.gl.ARRAY_BUFFER))}),e&&(r.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),ci.info(4,"glTF Attributes",{attributes:t,indices:e,generated:r})(),r}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:r}=t;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[e]||(r.lumaBuffers[e]=new Wr(this.gl,{id:"from-".concat(r.id),data:r.data||t.value,target:e})),r.lumaBuffers[e]}createAccessor(t,e){return new Fo({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:cz[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function dz(i,t,e){const r=new uz(i,e),s=r.instantiate(t),n=r.createAnimator();return{scenes:s,animator:n}}const pz="3.4.14",fz="3.4.14",CS="3.4.14",gz="https://unpkg.com/@loaders.gl/textures@".concat(CS,"/dist/libs/basis_encoder.wasm"),mz="https://unpkg.com/@loaders.gl/textures@".concat(CS,"/dist/libs/basis_encoder.js");let gy;async function Sx(i){const t=i.modules||{};return t.basis?t.basis:(gy=gy||yz(i),await gy)}async function yz(i){let t=null,e=null;return[t,e]=await Promise.all([await Tu("basis_transcoder.js","textures",i),await Tu("basis_transcoder.wasm","textures",i)]),t=t||globalThis.BASIS,await _z(t,e)}function _z(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i(e).then(s=>{const{BasisFile:n,initializeBasis:c}=s;c(),r({BasisFile:n})})})}let my;async function Ex(i){const t=i.modules||{};return t.basisEncoder?t.basisEncoder:(my=my||vz(i),await my)}async function vz(i){let t=null,e=null;return[t,e]=await Promise.all([await Tu(mz,"textures",i),await Tu(gz,"textures",i)]),t=t||globalThis.BASIS,await bz(t,e)}function bz(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i(e).then(s=>{const{BasisFile:n,KTX2File:c,initializeBasis:l,BasisEncoder:f}=s;l(),r({BasisFile:n,KTX2File:c,BasisEncoder:f})})})}const hd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},wz=["","WEBKIT_","MOZ_"],Cx={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let _g=null;function xz(i){if(!_g){i=i||Az()||void 0,_g=new Set;for(const t of wz)for(const e in Cx)if(i&&i.getExtension("".concat(t).concat(e))){const r=Cx[e];_g.add(r)}}return _g}function Az(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Tx,Px,Ix,Mx,Lx,Bx,Rx,kx;(function(i){i[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB"})(Tx||(Tx={})),function(i){i[i.BASICFORMAT=0]="BASICFORMAT"}(Px||(Px={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.ETC1S=163]="ETC1S",i[i.UASTC=166]="UASTC"}(Ix||(Ix={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB"}(Mx||(Mx={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.LINEAR=1]="LINEAR",i[i.SRGB=2]="SRGB",i[i.ITU=3]="ITU",i[i.NTSC=4]="NTSC",i[i.SLOG=5]="SLOG",i[i.SLOG2=6]="SLOG2"}(Lx||(Lx={})),function(i){i[i.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",i[i.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Bx||(Bx={})),function(i){i[i.RGB=0]="RGB",i[i.RRR=3]="RRR",i[i.GGG=4]="GGG",i[i.AAA=15]="AAA"}(Rx||(Rx={})),function(i){i[i.RGB=0]="RGB",i[i.RGBA=3]="RGBA",i[i.RRR=4]="RRR",i[i.RRRG=5]="RRRG"}(kx||(kx={}));const sa=[171,75,84,88,32,50,48,187,13,10,26,10];function Sz(i){const t=new Uint8Array(i);return!(t.byteLength<sa.length||t[0]!==sa[0]||t[1]!==sa[1]||t[2]!==sa[2]||t[3]!==sa[3]||t[4]!==sa[4]||t[5]!==sa[5]||t[6]!==sa[6]||t[7]!==sa[7]||t[8]!==sa[8]||t[9]!==sa[9]||t[10]!==sa[10]||t[11]!==sa[11])}const Ez={etc1:{basisFormat:0,compressed:!0,format:hd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:hd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:hd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:hd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:hd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:hd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Cz(i,t){if(t.basis.containerFormat==="auto"){if(Sz(i)){const r=await Ex(t);return Ox(r.KTX2File,i,t)}const{BasisFile:e}=await Sx(t);return yy(e,i,t)}switch(t.basis.module){case"encoder":const e=await Ex(t);switch(t.basis.containerFormat){case"ktx2":return Ox(e.KTX2File,i,t);case"basis":default:return yy(e.BasisFile,i,t)}case"transcoder":default:const{BasisFile:r}=await Sx(t);return yy(r,i,t)}}function yy(i,t,e){const r=new i(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const s=r.getNumImages(),n=[];for(let c=0;c<s;c++){const l=r.getNumLevels(c),f=[];for(let y=0;y<l;y++)f.push(Tz(r,c,y,e));n.push(f)}return n}finally{r.close(),r.delete()}}function Tz(i,t,e,r){const s=i.getImageWidth(t,e),n=i.getImageHeight(t,e),c=i.getHasAlpha(),{compressed:l,format:f,basisFormat:y}=TS(r,c),x=i.getImageTranscodedSizeInBytes(t,e,y),T=new Uint8Array(x);if(!i.transcodeImage(T,t,e,y,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:n,data:T,compressed:l,format:f,hasAlpha:c}}function Ox(i,t,e){const r=new i(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=r.getLevels(),n=[];for(let c=0;c<s;c++){n.push(Pz(r,c,e));break}return[n]}finally{r.close(),r.delete()}}function Pz(i,t,e){const{alphaFlag:r,height:s,width:n}=i.getImageLevelInfo(t,0,0),{compressed:c,format:l,basisFormat:f}=TS(e,r),y=i.getImageTranscodedSizeInBytes(t,0,0,f),x=new Uint8Array(y);if(!i.transcodeImage(x,t,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:n,height:s,data:x,compressed:c,levelSize:y,hasAlpha:r,format:l}}function TS(i,t){let e=i&&i.basis&&i.basis.format;return e==="auto"&&(e=PS()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),Ez[e]}function PS(){const i=xz();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const Iz={name:"Basis",id:Zc?"basis":"basis-nodejs",module:"textures",version:fz,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Mz={...Iz,parse:Cz};function ca(i,t){if(!i)throw new Error(t||"assert failed: gltf")}function IS(i,t){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const e=t.baseUri||t.uri;if(!e)throw new Error("'baseUri' must be provided to resolve relative url ".concat(i));return e.substr(0,e.lastIndexOf("/")+1)+i}function Lz(i,t,e){const r=i.bufferViews[e];ca(r);const s=r.buffer,n=t[s];ca(n);const c=(r.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,c,r.byteLength)}const Dx=["SCALAR","VEC2","VEC3","VEC4"],Bz=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Rz=new Map(Bz),kz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Oz={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Dz={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function MS(i){return Dx[i-1]||Dx[0]}function LS(i){const t=Rz.get(i.constructor);if(!t)throw new Error("Illegal typed array");return t}function cv(i,t){const e=Dz[i.componentType],r=kz[i.type],s=Oz[i.componentType],n=i.count*r,c=i.count*r*s;return ca(c>=0&&c<=t.byteLength),{ArrayType:e,length:n,byteLength:c}}function BS(i){let{images:t,bufferViews:e}=i;t=t||[],e=e||[];const r=t.map(c=>c.bufferView);e=e.filter(c=>!r.includes(c));const s=e.reduce((c,l)=>c+l.byteLength,0),n=t.reduce((c,l)=>{const{width:f,height:y}=l.image;return c+f*y},0);return s+Math.ceil(4*n*1.33)}const Nz={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class jo{constructor(t){H(this,"gltf",void 0),H(this,"sourceBuffers",void 0),H(this,"byteLength",void 0),this.gltf=t||{json:{...Nz},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(s=>s===t),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return r}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,r=this.gltf.buffers[e];ca(r);const s=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,{ArrayType:s,length:n}=cv(t,e),c=e.byteOffset+t.byteOffset;return new s(r,c,n)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(r,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}setObjectExtension(t,e,r){const s=t.extensions||{};s[e]=r}removeObjectExtension(t,e){const r=t.extensions||{},s=r[e];return delete r[e],s}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ca(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ca(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:r}=t;this.json.nodes=this.json.nodes||[];const s={mesh:e};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:r,material:s,mode:n=4}=t,c={primitives:[{attributes:this._addAttributes(e),mode:n}]};if(r){const l=this._addIndices(r);c.primitives[0].indices=l}return Number.isFinite(s)&&(c.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const r=w1(t),s=e||(r==null?void 0:r.mimeType),n={bufferView:this.addBufferView(t),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(n),this.json.images.length-1}addBufferView(t){const e=t.byteLength;ca(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=df(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:MS(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(t);let s={min:e.min,max:e.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(t,e.size));const n={size:e.size,componentType:LS(t),count:Math.round(t.length/e.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(n,e))}addTexture(t){const{imageIndex:e}=t,r={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const r=this.byteLength,s=new ArrayBuffer(r),n=new Uint8Array(s);let c=0;for(const l of this.sourceBuffers||[])c=HP(l,n,c);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=s,this.sourceBuffers=[s]}_removeStringFromArray(t,e){let r=!0;for(;r;){const s=t.indexOf(e);s>-1?t.splice(s,1):r=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const r in t){const s=t[r],n=this._getGltfAttributeName(r),c=this.addBinaryBuffer(s.value,s);e[n]=c}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];const s=t.subarray(0,e);for(const n of s)r.min.push(n),r.max.push(n);for(let n=e;n<t.length;n+=e)for(let c=0;c<e;c++)r.min[0+c]=Math.min(r.min[0+c],t[n+c]),r.max[0+c]=Math.max(r.max[0+c],t[n+c]);return r}}const Fz="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",zz="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",jz=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Uz=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Gz={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Vz={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function qz(i,t,e,r,s){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const c=await Hz();Zz(c,c.exports[Vz[s]],i,t,e,r,c.exports[Gz[n||"NONE"]])}let _y;async function Hz(){return _y||(_y=Wz()),_y}async function Wz(){let i=Fz;WebAssembly.validate(jz)&&(i=zz,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(Jz(i),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function Jz(i){const t=new Uint8Array(i.length);for(let r=0;r<i.length;++r){const s=i.charCodeAt(r);t[r]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let e=0;for(let r=0;r<i.length;++r)t[e++]=t[r]<60?Uz[t[r]]:(t[r]-60)*64+t[++r];return t.buffer.slice(0,e)}function Zz(i,t,e,r,s,n,c){const l=i.exports.sbrk,f=r+3&-4,y=l(f*s),x=l(n.length),T=new Uint8Array(i.exports.memory.buffer);T.set(n,x);const P=t(y,r,s,x,n.length);if(P===0&&c&&c(y,f,s),e.set(T.subarray(y,y+r*s)),l(y-l(0)),P!==0)throw new Error("Malformed buffer data: ".concat(P))}const hv="EXT_meshopt_compression",Xz=hv;async function $z(i,t){var e;const r=new jo(i);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes))return;const s=[];for(const n of i.json.bufferViews||[])s.push(Kz(r,n));await Promise.all(s),r.removeExtension(hv)}async function Kz(i,t){const e=i.getObjectExtension(t,hv);if(e){const{byteOffset:r=0,byteLength:s=0,byteStride:n,count:c,mode:l,filter:f="NONE",buffer:y}=e,x=i.gltf.buffers[y],T=new Uint8Array(x.arrayBuffer,x.byteOffset+r,s),P=new Uint8Array(i.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await qz(P,c,n,T,l,f),P}return null}const Yz=Object.freeze(Object.defineProperty({__proto__:null,decode:$z,name:Xz},Symbol.toStringTag,{value:"Module"})),md="EXT_texture_webp",Qz=md;function t7(i,t){const e=new jo(i);if(!HM("image/webp")){if(e.getRequiredExtensions().includes(md))throw new Error("gltf: Required extension ".concat(md," not supported by browser"));return}const{json:r}=e;for(const s of r.textures||[]){const n=e.getObjectExtension(s,md);n&&(s.source=n.source),e.removeObjectExtension(s,md)}e.removeExtension(md)}const e7=Object.freeze(Object.defineProperty({__proto__:null,name:Qz,preprocess:t7},Symbol.toStringTag,{value:"Module"})),Ng="KHR_texture_basisu",i7=Ng;function r7(i,t){const e=new jo(i),{json:r}=e;for(const s of r.textures||[]){const n=e.getObjectExtension(s,Ng);n&&(s.source=n.source),e.removeObjectExtension(s,Ng)}e.removeExtension(Ng)}const s7=Object.freeze(Object.defineProperty({__proto__:null,name:i7,preprocess:r7},Symbol.toStringTag,{value:"Module"})),n7="3.4.14",o7={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},a7={name:"Draco",id:Zc?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:n7,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:o7};function l7(i,t,e){const r=RS(t.metadata),s=[],n=c7(t.attributes);for(const c in i){const l=i[c],f=Nx(c,l,n[c]);s.push(f)}if(e){const c=Nx("indices",e);s.push(c)}return new xd(s,r)}function c7(i){const t={};for(const e in i){const r=i[e];t[r.name||"undefined"]=r}return t}function Nx(i,t,e){const r=e?RS(e.metadata):void 0;return HF(i,t,r)}function RS(i){const t=new Map;for(const e in i)t.set("".concat(e,".string"),JSON.stringify(i[e]));return t}const Fx={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},h7={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},u7=4;class d7{constructor(t){H(this,"draco",void 0),H(this,"decoder",void 0),H(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const s=this.decoder.GetEncodedGeometryType(r),n=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(s){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,n);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,n);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!n.ptr){const T="DRACO decompression failed: ".concat(c.error_msg());throw new Error(T)}const l=this._getDracoLoaderData(n,s,e),f=this._getMeshData(n,l,e),y=vS(f.attributes),x=l7(f.attributes,l,f.indices);return{loader:"draco",loaderData:l,header:{vertexCount:n.num_points(),boundingBox:y},...f,schema:x}}finally{this.draco.destroy(r),n&&this.draco.destroy(n)}}_getDracoLoaderData(t,e,r){const s=this._getTopLevelMetadata(t),n=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:s,attributes:n}}_getDracoAttributes(t,e){const r={};for(let s=0;s<t.num_attributes();s++){const n=this.decoder.GetAttribute(t,s),c=this._getAttributeMetadata(t,s);r[n.unique_id()]={unique_id:n.unique_id(),attribute_type:n.attribute_type(),data_type:n.data_type(),num_components:n.num_components(),byte_offset:n.byte_offset(),byte_stride:n.byte_stride(),normalized:n.normalized(),attribute_index:s,metadata:c};const l=this._getQuantizationTransform(n,e);l&&(r[n.unique_id()].quantization_transform=l);const f=this._getOctahedronTransform(n,e);f&&(r[n.unique_id()].octahedron_transform=f)}return r}_getMeshData(t,e,r){const s=this._getMeshAttributes(e,t,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(t,e,r){const s={};for(const n of Object.values(t.attributes)){const c=this._deduceAttributeName(n,r);n.name=c;const{value:l,size:f}=this._getAttributeValues(e,n);s[c]={value:l,size:f,byteOffset:n.byte_offset,byteStride:n.byte_stride,normalized:n.normalized}}return s}_getTriangleListIndices(t){const e=t.num_faces()*3,r=e*u7,s=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,s),new Uint32Array(this.draco.HEAPF32.buffer,s,e).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),g7(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const r=h7[e.data_type],s=e.num_components,n=t.num_points()*s,c=n*r.BYTES_PER_ELEMENT,l=p7(this.draco,r);let f;const y=this.draco._malloc(c);try{const x=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,x,l,c,y),f=new r(this.draco.HEAPF32.buffer,y,n).slice()}finally{this.draco._free(y)}return{value:f,size:s}}_deduceAttributeName(t,e){const r=t.unique_id;for(const[c,l]of Object.entries(e.extraAttributes||{}))if(l===r)return c;const s=t.attribute_type;for(const c in Fx)if(this.draco[c]===s)return Fx[c];const n=e.attributeNameEntry||"name";return t.metadata[n]?t.metadata[n].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},r=this.metadataQuerier.NumEntries(t);for(let s=0;s<r;s++){const n=this.metadataQuerier.GetEntryName(t,s);e[n]=this._getDracoMetadataField(t,n)}return e}_getDracoMetadataField(t,e){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);const s=f7(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:r=[]}=t,s=[...e,...r];for(const n of s)this.decoder.SkipAttributeTransform(this.draco[n])}_getQuantizationTransform(t,e){const{quantizedAttributes:r=[]}=e,s=t.attribute_type();if(r.map(n=>this.decoder[n]).includes(s)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(t))return{quantization_bits:n.quantization_bits(),range:n.range(),min_values:new Float32Array([1,2,3]).map(c=>n.min_value(c))}}finally{this.draco.destroy(n)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:r=[]}=e,s=t.attribute_type();if(r.map(n=>this.decoder[n]).includes(s)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(t))return{quantization_bits:n.quantization_bits()}}finally{this.draco.destroy(n)}}return null}}function p7(i,t){switch(t){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function f7(i){const t=i.size(),e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=i.GetValue(r);return e}function g7(i){const t=i.size(),e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=i.GetValue(r);return e}const m7="1.5.5",uv="https://www.gstatic.com/draco/versioned/decoders/".concat(m7),y7="".concat(uv,"/draco_decoder.js"),_7="".concat(uv,"/draco_wasm_wrapper.js"),v7="".concat(uv,"/draco_decoder.wasm");let Tp;async function b7(i){const t=i.modules||{};return t.draco3d?Tp=Tp||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Tp=Tp||w7(i),await Tp}async function w7(i){let t,e;switch(i.draco&&i.draco.decoderType){case"js":t=await Tu(y7,"draco",i);break;case"wasm":default:[t,e]=await Promise.all([await Tu(_7,"draco",i),await Tu(v7,"draco",i)])}return t=t||globalThis.DracoDecoderModule,await x7(t,e)}function x7(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i({...e,onModuleLoaded:s=>r({draco:s})})})}const kS={...a7,parse:A7};async function A7(i,t){const{draco:e}=await b7(t),r=new d7(e);try{return r.parseSync(i,t==null?void 0:t.draco)}finally{r.destroy()}}function S7(i){const t={};for(const e in i){const r=i[e];if(e!=="indices"){const s=OS(r);t[e]=s}}return t}function OS(i){const{buffer:t,size:e,count:r}=E7(i);return{value:t,size:e,byteOffset:0,count:r,type:MS(e),componentType:LS(t)}}function E7(i){let t=i,e=1,r=0;return i&&i.value&&(t=i.value,e=i.size||1),t&&(ArrayBuffer.isView(t)||(t=C7(t,Float32Array)),r=t.length/e),{buffer:t,size:e,count:r}}function C7(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i?Array.isArray(i)?new t(i):e&&!(i instanceof t)?new t(i):i:null}const Ru="KHR_draco_mesh_compression",T7=Ru;function P7(i,t,e){const r=new jo(i);for(const s of DS(r))r.getObjectExtension(s,Ru)}async function I7(i,t,e){var r;if(!(t!=null&&(r=t.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const s=new jo(i),n=[];for(const c of DS(s))s.getObjectExtension(c,Ru)&&n.push(L7(s,c,t,e));await Promise.all(n),s.removeExtension(Ru)}function M7(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new jo(i);for(const r of e.json.meshes||[])B7(r,t),e.addRequiredExtension(Ru)}async function L7(i,t,e,r){const s=i.getObjectExtension(t,Ru);if(!s)return;const n=i.getTypedArrayForBufferView(s.bufferView),c=d1(n.buffer,n.byteOffset),{parse:l}=r,f={...e};delete f["3d-tiles"];const y=await l(c,kS,f,r),x=S7(y.attributes);for(const[T,P]of Object.entries(x))if(T in t.attributes){const M=t.attributes[T],N=i.getAccessor(M);N!=null&&N.min&&N!==null&&N!==void 0&&N.max&&(P.min=N.min,P.max=N.max)}t.attributes=x,y.indices&&(t.indices=OS(y.indices)),R7(t)}function B7(i,t){var e;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const c=s.DracoWriter.encodeSync({attributes:i}),l=n==null||(e=n.parseSync)===null||e===void 0?void 0:e.call(n,{attributes:i}),f=s._addFauxAttributes(l.attributes),y=s.addBufferView(c);return{primitives:[{attributes:f,mode:r,extensions:{[Ru]:{bufferView:y,attributes:f}}}]}}function R7(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*DS(i){for(const t of i.json.meshes||[])for(const e of t.primitives)yield e}const k7=Object.freeze(Object.defineProperty({__proto__:null,decode:I7,encode:M7,name:T7,preprocess:P7},Symbol.toStringTag,{value:"Module"})),O7={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},D7={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},dv="KHR_texture_transform",N7=dv,vg=new re,F7=new Rs,z7=new Rs;async function j7(i,t){if(!new jo(i).getExtension(dv))return;const e=i.json.materials||[];for(let r=0;r<e.length;r++)U7(r,i)}function U7(i,t){var e,r,s;const n=[],c=(e=t.json.materials)===null||e===void 0?void 0:e[i],l=c==null||(r=c.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;l&&Pp(t,i,l,n);const f=c==null?void 0:c.emissiveTexture;f&&Pp(t,i,f,n);const y=c==null?void 0:c.normalTexture;y&&Pp(t,i,y,n);const x=c==null?void 0:c.occlusionTexture;x&&Pp(t,i,x,n);const T=c==null||(s=c.pbrMetallicRoughness)===null||s===void 0?void 0:s.metallicRoughnessTexture;T&&Pp(t,i,T,n)}function Pp(i,t,e,r){const s=G7(e,r);if(!s)return;const n=i.json.meshes||[];for(const c of n)for(const l of c.primitives){const f=l.material;Number.isFinite(f)&&t===f&&V7(i,l,s)}}function G7(i,t){var e;const r=(e=i.extensions)===null||e===void 0?void 0:e[dv],{texCoord:s=0}=i,{texCoord:n=s}=r;if(t.findIndex(c=>{let[l,f]=c;return l===s&&f===n})===-1){const c=W7(r);return s!==n&&(i.texCoord=n),t.push([s,n]),{originalTexCoord:s,texCoord:n,matrix:c}}return null}function V7(i,t,e){const{originalTexCoord:r,texCoord:s,matrix:n}=e,c=t.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(c)){var l;const y=(l=i.json.accessors)===null||l===void 0?void 0:l[c];if(y&&y.bufferView){var f;const x=(f=i.json.bufferViews)===null||f===void 0?void 0:f[y.bufferView];if(x){const{arrayBuffer:T,byteOffset:P}=i.buffers[x.buffer],M=(P||0)+(y.byteOffset||0)+(x.byteOffset||0),{ArrayType:N,length:G}=cv(y,x),Z=D7[y.componentType],X=O7[y.type],$=x.byteStride||Z*X,ct=new Float32Array(G);for(let yt=0;yt<y.count;yt++){const Mt=new N(T,M+yt*$,2);vg.set(Mt[0],Mt[1],1),vg.transformByMatrix3(n),ct.set([vg[0],vg[1]],yt*X)}r===s?q7(y,x,i.buffers,ct):H7(s,y,t,i,ct)}}}}function q7(i,t,e,r){i.componentType=5126,e.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=r.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function H7(i,t,e,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const n=r.json.bufferViews;if(!n)return;n.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:(n==null?void 0:n.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(i)]=c.length-1)}function W7(i){const{offset:t=[0,0],rotation:e=0,scale:r=[1,1]}=i,s=new Rs().set(1,0,0,0,1,0,t[0],t[1],1),n=F7.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),c=z7.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(n).multiplyRight(c)}const J7=Object.freeze(Object.defineProperty({__proto__:null,decode:j7,name:N7},Symbol.toStringTag,{value:"Module"})),Su="KHR_lights_punctual",Z7=Su;async function X7(i){const t=new jo(i),{json:e}=t,r=t.getExtension(Su);r&&(t.json.lights=r.lights,t.removeExtension(Su));for(const s of e.nodes||[]){const n=t.getObjectExtension(s,Su);n&&(s.light=n.light),t.removeObjectExtension(s,Su)}}async function $7(i){const t=new jo(i),{json:e}=t;if(e.lights){const r=t.addExtension(Su);ca(!r.lights),r.lights=e.lights,delete e.lights}if(t.json.lights){for(const r of t.json.lights){const s=r.node;t.addObjectExtension(s,Su,r)}delete t.json.lights}}const K7=Object.freeze(Object.defineProperty({__proto__:null,decode:X7,encode:$7,name:Z7},Symbol.toStringTag,{value:"Module"})),nf="KHR_materials_unlit",Y7=nf;async function Q7(i){const t=new jo(i),{json:e}=t;for(const r of e.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,nf);t.removeExtension(nf)}function t9(i){const t=new jo(i),{json:e}=t;if(t.materials)for(const r of e.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,nf,{}),t.addExtension(nf))}const e9=Object.freeze(Object.defineProperty({__proto__:null,decode:Q7,encode:t9,name:Y7},Symbol.toStringTag,{value:"Module"})),Fp="KHR_techniques_webgl",i9=Fp;async function r9(i){const t=new jo(i),{json:e}=t,r=t.getExtension(Fp);if(r){const s=n9(r,t);for(const n of e.materials||[]){const c=t.getObjectExtension(n,Fp);c&&(n.technique=Object.assign({},c,s[c.technique]),n.technique.values=o9(n.technique,t)),t.removeObjectExtension(n,Fp)}t.removeExtension(Fp)}}async function s9(i,t){}function n9(i,t){const{programs:e=[],shaders:r=[],techniques:s=[]}=i,n=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=n.decode(t.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),s.forEach(c=>{c.program=e[c.program]}),s}function o9(i,t){const e=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(r=>{i.uniforms[r].value&&!(r in e)&&(e[r]=i.uniforms[r].value)}),Object.keys(e).forEach(r=>{typeof e[r]=="object"&&e[r].index!==void 0&&(e[r].texture=t.getTexture(e[r].index))}),e}const a9=Object.freeze(Object.defineProperty({__proto__:null,decode:r9,encode:s9,name:i9},Symbol.toStringTag,{value:"Module"})),NS="EXT_feature_metadata",l9=NS;async function c9(i){const t=new jo(i);h9(t)}function h9(i){var t;const e=i.getExtension(NS),r=e==null||(t=e.schema)===null||t===void 0?void 0:t.classes,s=e==null?void 0:e.featureTables;if(e!=null&&e.featureTextures&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&s)for(const n in r){const c=r[n],l=p9(s,n);l&&u9(i,l,c)}}function u9(i,t,e){for(const s in e.properties){var r;const n=e.properties[s],c=t==null||(r=t.properties)===null||r===void 0?void 0:r[s],l=t.count;if(c){const f=d9(i,n,l,c);c.data=f}}}function d9(i,t,e,r){const s=r.bufferView;let n=i.getTypedArrayForBufferView(s);switch(t.type){case"STRING":{const c=r.stringOffsetBufferView,l=i.getTypedArrayForBufferView(c);n=f9(n,l,e);break}}return n}function p9(i,t){for(const e in i){const r=i[e];if(r.class===t)return r}return null}function f9(i,t,e){const r=[],s=new TextDecoder("utf8");let n=0;const c=4;for(let l=0;l<e;l++){const f=t[(l+1)*c]-t[l*c],y=i.subarray(n,f+n),x=s.decode(y);r.push(x),n+=f}return r}const g9=Object.freeze(Object.defineProperty({__proto__:null,decode:c9,name:l9},Symbol.toStringTag,{value:"Module"})),FS=[Yz,e7,s7,k7,K7,e9,a9,J7,g9];function m9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=FS.filter(n=>zS(n.name,t));for(const n of r){var s;(s=n.preprocess)===null||s===void 0||s.call(n,i,t,e)}}async function y9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=FS.filter(n=>zS(n.name,t));for(const n of r){var s;await((s=n.decode)===null||s===void 0?void 0:s.call(n,i,t,e))}}function zS(i,t){var e;const r=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(i in r&&!r[i])}const vy="KHR_binary_glTF";function _9(i){const t=new jo(i),{json:e}=t;for(const r of e.images||[]){const s=t.getObjectExtension(r,vy);s&&Object.assign(r,s),t.removeObjectExtension(r,vy)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(vy)}const zx={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},v9={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class b9{constructor(){H(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),H(this,"json",void 0)}normalize(t,e){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),_9(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in zx)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const r=t[e];if(!(!r||Array.isArray(r))){t[e]=[];for(const s in r){const n=r[s];n.id=n.id||s;const c=t[e].length;t[e].push(n),this.idToIndexMap[e][s]=c}}}_convertObjectIdsToArrayIndices(t){for(const e in zx)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:r,indices:s,material:n}=e;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");s&&(e.indices=this._convertIdToIndex(s,"accessor")),n&&(e.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const r of t[e])for(const s in r){const n=r[s],c=this._convertIdToIndex(n,s);r[s]=c}}_convertIdToIndex(t,e){const r=v9[e];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][t];if(!Number.isFinite(s))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return s}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const n of t.materials){var e,r,s;n.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const c=((e=n.values)===null||e===void 0?void 0:e.tex)||((r=n.values)===null||r===void 0?void 0:r.texture2d_0)||((s=n.values)===null||s===void 0?void 0:s.diffuseTex),l=t.textures.findIndex(f=>f.id===c);l!==-1&&(n.pbrMetallicRoughness.baseColorTexture={index:l})}}}function w9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new b9().normalize(i,t)}const x9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A9={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Da={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},S9={magFilter:Da.TEXTURE_MAG_FILTER,minFilter:Da.TEXTURE_MIN_FILTER,wrapS:Da.TEXTURE_WRAP_S,wrapT:Da.TEXTURE_WRAP_T},E9={[Da.TEXTURE_MAG_FILTER]:Da.LINEAR,[Da.TEXTURE_MIN_FILTER]:Da.NEAREST_MIPMAP_LINEAR,[Da.TEXTURE_WRAP_S]:Da.REPEAT,[Da.TEXTURE_WRAP_T]:Da.REPEAT};function C9(i){return A9[i]}function T9(i){return x9[i]}class P9{constructor(){H(this,"baseUri",""),H(this,"json",{}),H(this,"buffers",[]),H(this,"images",[])}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:s=[],images:n=[],baseUri:c=""}=t;return ca(r),this.baseUri=c,this.json=r,this.buffers=s,this.images=n,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((e,r)=>this._resolveBufferView(e,r))),t.images&&(t.images=t.images.map((e,r)=>this._resolveImage(e,r))),t.samplers&&(t.samplers=t.samplers.map((e,r)=>this._resolveSampler(e,r))),t.textures&&(t.textures=t.textures.map((e,r)=>this._resolveTexture(e,r))),t.accessors&&(t.accessors=t.accessors.map((e,r)=>this._resolveAccessor(e,r))),t.materials&&(t.materials=t.materials.map((e,r)=>this._resolveMaterial(e,r))),t.meshes&&(t.meshes=t.meshes.map((e,r)=>this._resolveMesh(e,r))),t.nodes&&(t.nodes=t.nodes.map((e,r)=>this._resolveNode(e,r))),t.skins&&(t.skins=t.skins.map((e,r)=>this._resolveSkin(e,r))),t.scenes&&(t.scenes=t.scenes.map((e,r)=>this._resolveScene(e,r))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];return r||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),r}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(r=>this.getNode(r)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(r=>this.getNode(r))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((r,s)=>{const n=this.getMesh(s);return r.id=n.id,r.primitives=r.primitives.concat(n.primitives),r},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(r=>{r={...r};const s=r.attributes;r.attributes={};for(const n in s)r.attributes[n]=this.getAccessor(s[n]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const r=t.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){if(t.id=t.id||"accessor-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=C9(t.componentType),t.components=T9(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const r=t.bufferView.buffer,{ArrayType:s,byteLength:n}=cv(t,t.bufferView),c=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+r.byteOffset;let l=r.arrayBuffer.slice(c,c+n);t.bufferView.byteStride&&(l=this._getValueFromInterleavedBuffer(r,c,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new s(l)}return t}_getValueFromInterleavedBuffer(t,e,r,s,n){const c=new Uint8Array(n*s);for(let l=0;l<n;l++){const f=e+l*r;c.set(new Uint8Array(t.arrayBuffer.slice(f,f+s)),l*s)}return c.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):E9,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const r in t){const s=this._enumSamplerParameter(r);s!==void 0&&(t.parameters[s]=t[r])}return t}_enumSamplerParameter(t){return S9[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const r=this.images[e];return r&&(t.image=r),t}_resolveBufferView(t,e){const r=t.buffer,s={id:"bufferView-".concat(e),...t,buffer:this.buffers[r]},n=this.buffers[r].arrayBuffer;let c=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(c+=t.byteOffset),s.data=new Uint8Array(n,c,t.byteLength),s}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}function I9(i,t){return new P9().postProcess(i,t)}const jx=1735152710,pv=12,mm=8,M9=1313821514,L9=5130562,B9=0,R9=1,k9=0,Vd=!0;function O9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(i.getUint8(t+0))).concat(String.fromCharCode(i.getUint8(t+1))).concat(String.fromCharCode(i.getUint8(t+2))).concat(String.fromCharCode(i.getUint8(t+3)))}function D9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(i),{magic:s=jx}=e,n=r.getUint32(t,!1);return n===s||n===jx}function N9(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(t),s=O9(r,e+0),n=r.getUint32(e+4,Vd),c=r.getUint32(e+8,Vd);switch(Object.assign(i,{header:{byteOffset:e,byteLength:c,hasBinChunk:!1},type:s,version:n,json:{},binChunks:[]}),e+=pv,i.version){case 1:return F9(i,r,e);case 2:return z9(i,r,e,{});default:throw new Error("Invalid GLB version ".concat(i.version,". Only supports v1 and v2."))}}function F9(i,t,e){Qr(i.header.byteLength>pv+mm);const r=t.getUint32(e+0,Vd),s=t.getUint32(e+4,Vd);return e+=mm,Qr(s===k9),L_(i,t,e,r),e+=r,e+=B_(i,t,e,i.header.byteLength),e}function z9(i,t,e,r){return Qr(i.header.byteLength>pv+mm),j9(i,t,e,r),e+i.header.byteLength}function j9(i,t,e,r){for(;e+8<=i.header.byteLength;){const s=t.getUint32(e+0,Vd),n=t.getUint32(e+4,Vd);switch(e+=mm,n){case M9:L_(i,t,e,s);break;case L9:B_(i,t,e,s);break;case B9:r.strict||L_(i,t,e,s);break;case R9:r.strict||B_(i,t,e,s);break}e+=df(s,4)}return e}function L_(i,t,e,r){const s=new Uint8Array(t.buffer,e,r),n=new TextDecoder("utf8").decode(s);return i.json=JSON.parse(n),df(r,4)}function B_(i,t,e,r){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:e,byteLength:r,arrayBuffer:t.buffer}),df(r,4)}async function U9(i,t){var e,r,s,n;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;G9(i,t,c,l),w9(i,{normalize:l==null||(e=l.gltf)===null||e===void 0?void 0:e.normalize}),m9(i,l,f);const y=[];if(l!=null&&(r=l.gltf)!==null&&r!==void 0&&r.loadBuffers&&i.json.buffers&&await V9(i,l,f),l!=null&&(s=l.gltf)!==null&&s!==void 0&&s.loadImages){const T=q9(i,l,f);y.push(T)}const x=y9(i,l,f);return y.push(x),await Promise.all(y),l!=null&&(n=l.gltf)!==null&&n!==void 0&&n.postProcess?I9(i,l):i}function G9(i,t,e,r){if(r.uri&&(i.baseUri=r.uri),t instanceof ArrayBuffer&&!D9(t,e,r)&&(t=new TextDecoder().decode(t)),typeof t=="string")i.json=GP(t);else if(t instanceof ArrayBuffer){const c={};e=N9(c,t,e,r.glb),ca(c.type==="glTF","Invalid GLB magic string ".concat(c.type)),i._glb=c,i.json=c.json}else ca(!1,"GLTF: must be ArrayBuffer or string");const s=i.json.buffers||[];if(i.buffers=new Array(s.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:c}=i._glb;i.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const n=i.json.images||[];i.images=new Array(n.length).fill({})}async function V9(i,t,e){const r=i.json.buffers||[];for(let c=0;c<r.length;++c){const l=r[c];if(l.uri){var s,n;const{fetch:f}=e;ca(f);const y=IS(l.uri,t),x=await(e==null||(s=e.fetch)===null||s===void 0?void 0:s.call(e,y)),T=await(x==null||(n=x.arrayBuffer)===null||n===void 0?void 0:n.call(x));i.buffers[c]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete l.uri}else i.buffers[c]===null&&(i.buffers[c]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function q9(i,t,e){const r=H9(i),s=i.json.images||[],n=[];for(const c of r)n.push(W9(i,s[c],c,t,e));return await Promise.all(n)}function H9(i){const t=new Set,e=i.json.textures||[];for(const r of e)r.source!==void 0&&t.add(r.source);return Array.from(t).sort()}async function W9(i,t,e,r,s){const{fetch:n,parse:c}=s;let l;if(t.uri&&!t.hasOwnProperty("bufferView")){const y=IS(t.uri,r);l=await(await n(y)).arrayBuffer(),t.bufferView={data:l}}if(Number.isFinite(t.bufferView)){const y=Lz(i.json,i.buffers,t.bufferView);l=d1(y.buffer,y.byteOffset,y.byteLength)}ca(l,"glTF image has no data");let f=await c(l,[NA,Mz],{mimeType:t.mimeType,basis:r.basis||{format:PS()}},s);f&&f[0]&&(f={compressed:!0,mipmaps:!1,width:f[0].width,height:f[0].height,data:f[0]}),i.images=i.images||[],i.images[e]=f}const of={name:"glTF",id:"gltf",module:"gltf",version:pz,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:J9,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function J9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...of.options,...t},t.gltf={...of.options.gltf,...t.gltf};const{byteOffset:r=0}=t;return await U9({},i,r,t,e)}async function Z9(i){const t=[];return i.scenes.forEach(e=>{e.traverse(r=>{Object.values(r.model.getUniforms()).forEach(s=>{s.loaded===!1&&t.push(s)})})}),await X9(()=>t.some(e=>!e.loaded))}async function X9(i){for(;i();)await new Promise(t=>requestAnimationFrame(t))}const $9=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,K9=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,jS=[255,255,255,255],Y9={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:jS},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[of]};class fv extends Xd{constructor(){super(...arguments),H(this,"state",void 0)}getShaders(){const t=[X1,$1];return this.props._lighting==="pbr"&&t.push(G1),super.getShaders({vs:$9,fs:K9,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:jS,transition:!0},instanceModelMatrix:yS})}updateState(t){super.updateState(t);const{props:e,oldProps:r}=t;e.scenegraph!==r.scenegraph?this._updateScenegraph():e._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let r=null;if(t.scenegraph instanceof Pd)r={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const l=t.scenegraph,f=dz(e,l,this._getModelOptions());r={gltf:l,...f},Z9(f).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(vr.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=t.scenegraph);const s={layer:this,gl:e},n=t.getScene(r,s),c=t.getAnimator(r,s);n instanceof Pd?(this._deleteScenegraph(),this._applyAllAttributes(n),this._applyAnimationsProp(n,c,t._animations),this.setState({scenegraph:n,animator:c})):n!==null&&vr.warn("invalid scenegraph:",n)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(r=>{this._setModelAttributes(r.model,e)})}}_applyAnimationsProp(t,e,r){if(!t||!e||!r)return;const s=e.getAnimations();Object.keys(r).sort().forEach(n=>{const c=r[n];if(n==="*")s.forEach(l=>{Object.assign(l,c)});else if(Number.isFinite(Number(n))){const l=Number(n);l>=0&&l<s.length?Object.assign(s[l],c):vr.warn("animation ".concat(n," not found"))()}else{const l=s.find(f=>{let{name:y}=f;return y===n});l?Object.assign(l,c):vr.warn("animation ".concat(n," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof Pd&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!ir(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw(t){let{moduleParameters:e=null,parameters:r={},context:s}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(s.timeline.getTime()),this.setNeedsRedraw());const{viewport:n}=this.context,{sizeScale:c,sizeMinPixels:l,sizeMaxPixels:f,opacity:y,coordinateSystem:x}=this.props,T=this.getNumInstances();this.state.scenegraph.traverse((P,M)=>{let{worldMatrix:N}=M;P.model.setInstanceCount(T),P.updateModuleSettings(e),P.draw({parameters:r,uniforms:{sizeScale:c,opacity:y,sizeMinPixels:l,sizeMaxPixels:f,composeModelMatrix:_S(n,x),sceneModelMatrix:N,u_Camera:P.model.getUniforms().project_uCameraPosition}})})}}H(fv,"defaultProps",Y9);H(fv,"layerName","ScenegraphLayer");const Q9=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function ej(i){i.COLOR_0||i.colors||(i.colors={constant:!0,value:new Float32Array([1,1,1])})}const ij={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class gv extends lv{getShaders(){const t=super.getShaders();return t.modules.push(G1),{...t,vs:Q9,fs:tj}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:r}=t;e.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!e}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:r}=this.props,s=this.parseMaterial(r,t);this.setState({materialParser:s});const n=this.getShaders();return ej(t.attributes),new jd(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...n.defines,...s==null?void 0:s.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:s==null?void 0:s.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:r}=this.props,s=this.parseMaterial(t,r);this.setState({materialParser:s}),e.setUniforms(s.uniforms)}}parseMaterial(t,e){var r;const s=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new ES(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:s,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,r=new Uint8ClampedArray(e.length*t.size),s=[];for(let n=0;n<e.length;n++)this.encodePickingColor(e[n],s),r[n*3]=s[0],r[n*3+1]=s[1],r[n*3+2]=s[2];t.value=r}finalizeState(t){var e;super.finalizeState(t),(e=this.state.materialParser)===null||e===void 0||e.delete(),this.setState({materialParser:null})}}H(gv,"layerName","MeshLayer");H(gv,"defaultProps",ij);const rj=6378137,sj=6378137,nj=6356752314245179e-9;function Lm(i){return i}new re;function oj(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Lm;return"longitude"in i?(t[0]=e(i.longitude),t[1]=e(i.latitude),t[2]=i.height):"x"in i?(t[0]=e(i.x),t[1]=e(i.y),t[2]=i.z):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function aj(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return oj(i,t,rn._cartographicRadians?Lm:rR)}function lj(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Lm;return"longitude"in t?(t.longitude=e(i[0]),t.latitude=e(i[1]),t.height=i[2]):"x"in t?(t.x=e(i[0]),t.y=e(i[1]),t.z=i[2]):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function cj(i,t){return lj(i,t,rn._cartographicRadians?Lm:sR)}const ud=new re,hj=new re,uj=new re;function dj(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:r,oneOverRadiiSquared:s,centerToleranceSquared:n}=t;ud.from(i);const c=ud.x,l=ud.y,f=ud.z,y=r.x,x=r.y,T=r.z,P=c*c*y*y,M=l*l*x*x,N=f*f*T*T,G=P+M+N,Z=Math.sqrt(1/G);if(!Number.isFinite(Z))return;const X=hj;if(X.copy(i).scale(Z),G<n)return X.to(e);const $=s.x,ct=s.y,yt=s.z,Mt=uj;Mt.set(X.x*$*2,X.y*ct*2,X.z*yt*2);let Nt=(1-Z)*ud.len()/(.5*Mt.len()),Rt=0,xt,qt,zt,ot;do{Nt-=Rt,xt=1/(1+Nt*$),qt=1/(1+Nt*ct),zt=1/(1+Nt*yt);const dt=xt*xt,Lt=qt*qt,wt=zt*zt,le=dt*xt,oe=Lt*qt,de=wt*zt;ot=P*dt+M*Lt+N*wt-1;const te=-2*(P*le*$+M*oe*ct+N*de*yt);Rt=ot/te}while(Math.abs(ot)>ef.EPSILON12);return ud.scale([xt,qt,zt]).to(e)}const Ux=1e-14,pj=new re,Gx={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},by={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ip={east:new re,north:new re,up:new re,west:new re,south:new re,down:new re},fj=new re,gj=new re,mj=new re;function Vx(i,t,e,r,s,n){const c=Gx[t]&&Gx[t][e];El(c&&(!r||r===c));let l,f,y;const x=pj.copy(s);if(Il(x.x,0,Ux)&&Il(x.y,0,Ux)){const T=Math.sign(x.z);l=fj.fromArray(by[t]),t!=="east"&&t!=="west"&&l.scale(T),f=gj.fromArray(by[e]),e!=="east"&&e!=="west"&&f.scale(T),y=mj.fromArray(by[r]),r!=="east"&&r!=="west"&&y.scale(T)}else{const{up:T,east:P,north:M}=Ip;P.set(-x.y,x.x,0).normalize(),i.geodeticSurfaceNormal(x,T),M.copy(T).cross(P);const{down:N,west:G,south:Z}=Ip;N.copy(T).scale(-1),G.copy(P).scale(-1),Z.copy(M).scale(-1),l=Ip[t],f=Ip[e],y=Ip[r]}return n[0]=l.x,n[1]=l.y,n[2]=l.z,n[3]=0,n[4]=f.x,n[5]=f.y,n[6]=f.z,n[7]=0,n[8]=y.x,n[9]=y.y,n[10]=y.z,n[11]=0,n[12]=x.x,n[13]=x.y,n[14]=x.z,n[15]=1,n}const bg=new re,qx=new re,yj=new re,vl=new re,_j=new re,wg=new re;class ws{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;H(this,"radii",void 0),H(this,"radiiSquared",void 0),H(this,"radiiToTheFourth",void 0),H(this,"oneOverRadii",void 0),H(this,"oneOverRadiiSquared",void 0),H(this,"minimumRadius",void 0),H(this,"maximumRadius",void 0),H(this,"centerToleranceSquared",ef.EPSILON1),H(this,"squaredXOverSquaredZ",void 0),El(t>=0),El(e>=0),El(r>=0),this.radii=new re(t,e,r),this.radiiSquared=new re(t*t,e*e,r*r),this.radiiToTheFourth=new re(t*t*t*t,e*e*e*e,r*r*r*r),this.oneOverRadii=new re(t===0?0:1/t,e===0?0:1/e,r===0?0:1/r),this.oneOverRadiiSquared=new re(t===0?0:1/(t*t),e===0?0:1/(e*e),r===0?0:1/(r*r)),this.minimumRadius=Math.min(t,e,r),this.maximumRadius=Math.max(t,e,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=qx,s=yj,[,,n]=t;this.geodeticSurfaceNormalCartographic(t,r),s.copy(this.radiiSquared).scale(r);const c=Math.sqrt(r.dot(s));return s.scale(1/c),r.scale(n),s.add(r),s.to(e)}cartesianToCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];wg.from(t);const r=this.scaleToGeodeticSurface(wg,vl);if(!r)return;const s=this.geodeticSurfaceNormal(r,qx),n=_j;n.copy(wg).subtract(r);const c=Math.atan2(s.y,s.x),l=Math.asin(s.z),f=Math.sign(N1(n,wg))*A3(n);return cj([c,l,f],e)}eastNorthUpToFixedFrame(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new cr;return Vx(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,r,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new cr;return Vx(this,t,e,r,s,n)}geocentricSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return bg.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=aj(t),s=r[0],n=r[1],c=Math.cos(n);return bg.set(c*Math.cos(s),c*Math.sin(s),Math.sin(n)).normalize(),bg.to(e)}geodeticSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return bg.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return dj(t,this,e)}scaleToGeocentricSurface(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];vl.from(t);const r=vl.x,s=vl.y,n=vl.z,c=this.oneOverRadiiSquared,l=1/Math.sqrt(r*r*c.x+s*s*c.y+n*n*c.z);return vl.multiplyScalar(l).to(e)}transformPositionToScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return vl.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return vl.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];El(Il(this.radii.x,this.radii.y,ef.EPSILON15)),El(this.radii.z>0),vl.from(t);const s=vl.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-e))return vl.set(0,0,s).to(r)}}H(ws,"WGS84",new ws(rj,sj,nj));function Hx(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}class Wx{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Hx(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Hx()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class vj{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(t){const{name:e,type:r}=t;let s=this.stats[e];return s||(t instanceof Wx?s=t:s=new Wx(e,r),this.stats[e]=s),s}}class bj{constructor(t,e,r){H(this,"item",void 0),H(this,"previous",void 0),H(this,"next",void 0),this.item=t,this.previous=e,this.next=r}}class wj{constructor(){H(this,"head",null),H(this,"tail",null),H(this,"_length",0)}get length(){return this._length}add(t){const e=new bj(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}}class xj{constructor(){H(this,"_list",void 0),H(this,"_sentinel",void 0),H(this,"_trimTiles",void 0),this._list=new wj,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,r){e._cacheNode||(e._cacheNode=this._list.add(e),r&&r(t,e))}unloadTile(t,e,r){const s=e._cacheNode;s&&(this._list.remove(s),e._cacheNode=null,r&&r(t,e))}unloadTiles(t,e){const r=this._trimTiles;this._trimTiles=!1;const s=this._list,n=t.maximumMemoryUsage*1024*1024,c=this._sentinel;let l=s.head;for(;l!==c&&(t.gpuMemoryUsageInBytes>n||r);){const f=l.item;l=l.next,this.unloadTile(t,f,e)}}trim(){this._trimTiles=!0}}function Aj(i,t){Qr(i),Qr(t);const{rtcCenter:e,gltfUpAxis:r}=t,{computedTransform:s,boundingVolume:{center:n}}=i;let c=new cr(s);switch(e&&c.translate(e),r){case"Z":break;case"Y":const x=new cr().rotateX(Math.PI/2);c=c.multiplyRight(x);break;case"X":const T=new cr().rotateY(-Math.PI/2);c=c.multiplyRight(T);break}t.isQuantized&&c.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const l=new re(n);t.cartesianModelMatrix=c,t.cartesianOrigin=l;const f=ws.WGS84.cartesianToCartographic(l,new re),y=ws.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=y.multiplyRight(c),t.cartographicOrigin=f,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const Jx=new re,wy=new re,R_=new za([new Sl,new Sl,new Sl,new Sl,new Sl,new Sl]);function Sj(i,t){const{cameraDirection:e,cameraUp:r,height:s}=i,{metersPerUnit:n}=i.distanceScales,c=Fg(i,i.center),l=ws.WGS84.eastNorthUpToFixedFrame(c),f=i.unprojectPosition(i.cameraPosition),y=ws.WGS84.cartographicToCartesian(f,new re),x=new re(l.transformAsVector(new re(e).scale(n))).normalize(),T=new re(l.transformAsVector(new re(r).scale(n))).normalize();Cj(i);const P=i.constructor,{longitude:M,latitude:N,width:G,bearing:Z,zoom:X}=i,$=new P({longitude:M,latitude:N,height:s,width:G,bearing:Z,zoom:X,pitch:0});return{camera:{position:y,direction:x,up:T},viewport:i,topDownViewport:$,height:s,cullingVolume:R_,frameNumber:t,sseDenominator:1.15}}function Ej(i,t,e){if(e===0||i.length<=e)return[i,[]];const r=[],{longitude:s,latitude:n}=t.viewport;for(const[y,x]of i.entries()){const[T,P]=x.header.mbs,M=Math.abs(s-T),N=Math.abs(n-P),G=Math.sqrt(N*N+M*M);r.push([y,G])}const c=r.sort((y,x)=>y[1]-x[1]),l=[];for(let y=0;y<e;y++)l.push(i[c[y][0]]);const f=[];for(let y=e;y<c.length;y++)f.push(i[c[y][0]]);return[l,f]}function Cj(i){const t=i.getFrustumPlanes(),e=Zx(t.near,i.cameraPosition),r=Fg(i,e),s=Fg(i,i.cameraPosition,wy);let n=0;R_.planes[n++].fromPointNormal(r,Jx.copy(r).subtract(s));for(const c in t){if(c==="near")continue;const l=t[c],f=Zx(l,e,wy),y=Fg(i,f,wy);R_.planes[n++].fromPointNormal(y,Jx.copy(r).subtract(y))}}function Zx(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new re;const r=i.normal.dot(t);return e.copy(i.normal).scale(i.distance-r).add(t),e}function Fg(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new re;const r=i.unprojectPosition(t);return ws.WGS84.cartographicToCartesian(r,e)}const Tj=6378137,Pj=6378137,k_=6356752314245179e-9,Xx=new re;function Ij(i,t){if(i instanceof Sf){const{halfAxes:e}=i,r=Lj(e);return Math.log2(k_/(r+t[2]))}else if(i instanceof Af){const{radius:e}=i;return Math.log2(k_/(e+t[2]))}else if(i.width&&i.height){const{width:e,height:r}=i,s=Math.log2(Tj/e),n=Math.log2(Pj/r);return(s+n)/2}return 1}function US(i,t,e){const r=ws.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],new re),s=Math.sqrt(Math.pow(r[0]-e[0],2)+Math.pow(r[1]-e[1],2)+Math.pow(r[2]-e[2],2));return Math.log2(k_/(s+t[2]))}function Mj(i,t,e){const[r,s,n,c]=i;return US({xmin:r,xmax:n,ymin:s,ymax:c,zmin:0,zmax:0},t,e)}function Lj(i){i.getColumn(0,Xx);const t=i.getColumn(1),e=i.getColumn(2);return Xx.add(t).add(e).len()}const na={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Xc={ADD:1,REPLACE:2},Id={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Oa={I3S:"I3S",TILES3D:"TILES3D"},Bm={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},Bj={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function GS(i){return i!=null}const Kn=new re,zg=new re,Rj=new re,kj=new re;function xy(i,t,e){if(Qr(i,"3D Tile: boundingVolume must be defined"),i.box)return Dj(i.box,t,e);if(i.region){const[r,s,n,c,l,f]=i.region,y=ws.WGS84.cartographicToCartesian([Hc(r),Hc(c),l],Rj),x=ws.WGS84.cartographicToCartesian([Hc(n),Hc(s),f],kj),T=new re().addVectors(y,x).multiplyScalar(.5),P=new re().subVectors(y,x).len()/2;return $x([T[0],T[1],T[2],P],new cr)}if(i.sphere)return $x(i.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Oj(i,t){if(i.box)return Nj(t);if(i.region){const[e,r,s,n,c,l]=i.region;return[[Hc(e),Hc(r),c],[Hc(s),Hc(n),l]]}if(i.sphere)return Fj(t);throw new Error("Unkown boundingVolume type")}function Dj(i,t,e){const r=new re(i[0],i[1],i[2]);t.transform(r,r);let s=[];if(i.length===10){const y=i.slice(3,6),x=new tf;x.fromArray(i,6);const T=new re([1,0,0]),P=new re([0,1,0]),M=new re([0,0,1]);T.transformByQuaternion(x),T.scale(y[0]),P.transformByQuaternion(x),P.scale(y[1]),M.transformByQuaternion(x),M.scale(y[2]),s=[...T.toArray(),...P.toArray(),...M.toArray()]}else s=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const n=t.transformAsVector(s.slice(0,3)),c=t.transformAsVector(s.slice(3,6)),l=t.transformAsVector(s.slice(6,9)),f=new Rs([n[0],n[1],n[2],c[0],c[1],c[2],l[0],l[1],l[2]]);return GS(e)?(e.center=r,e.halfAxes=f,e):new Sf(r,f)}function $x(i,t,e){const r=new re(i[0],i[1],i[2]);t.transform(r,r);const s=t.getScale(zg),n=Math.max(Math.max(s[0],s[1]),s[2]),c=i[3]*n;return GS(e)?(e.center=r,e.radius=c,e):new Af(r,c)}function Nj(i){const t=VS(),{halfAxes:e}=i,r=new re(e.getColumn(0)),s=new re(e.getColumn(1)),n=new re(e.getColumn(2));for(let c=0;c<2;c++){for(let l=0;l<2;l++){for(let f=0;f<2;f++)Kn.copy(i.center),Kn.add(r),Kn.add(s),Kn.add(n),qS(t,Kn),n.negate();s.negate()}r.negate()}return t}function Fj(i){const t=VS(),{center:e,radius:r}=i,s=ws.WGS84.scaleToGeodeticSurface(e,Kn);let n;s?n=ws.WGS84.geodeticSurfaceNormal(s):n=new re(0,0,1);let c=new re(n[2],-n[1],0);c.len()>0?c.normalize():c=new re(0,1,0);const l=c.clone().cross(n);for(const f of[c,l,n]){zg.copy(f).scale(r);for(let y=0;y<2;y++)Kn.copy(e),Kn.add(zg),qS(t,Kn),zg.negate()}return t}function VS(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function qS(i,t){ws.WGS84.cartesianToCartographic(t,Kn),i[0][0]=Math.min(i[0][0],Kn[0]),i[0][1]=Math.min(i[0][1],Kn[1]),i[0][2]=Math.min(i[0][2],Kn[2]),i[1][0]=Math.max(i[1][0],Kn[0]),i[1][1]=Math.max(i[1][1],Kn[1]),i[1][2]=Math.max(i[1][2],Kn[2])}new re;new re;new cr;new re;new re;new re;function zj(i,t){const e=i*t;return 1-Math.exp(-(e*e))}function jj(i,t){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const e=i.dynamicScreenSpaceErrorComputedDensity,r=i.dynamicScreenSpaceErrorFactor;return zj(t,e)*r}return 0}function Uj(i,t,e){const r=i.tileset,s=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,n=e?s:i.lodMetricValue;if(n===0)return 0;const c=Math.max(i._distanceToCamera,1e-7),{height:l,sseDenominator:f}=t,{viewDistanceScale:y}=r.options;let x=n*l*(y||1)/(c*f);return x-=jj(r,c),x}const Ay=new re,Kx=new re,Bh=new re,Yx=new re,Gj=new re,Sy=new cr,Qx=new cr;function Vj(i,t){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const e=2*HS(i,t);return e<2?"OUT":!i.header.children||e<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function HS(i,t){const{topDownViewport:e}=t,r=i.header.mbs[1],s=i.header.mbs[0],n=i.header.mbs[2],c=i.header.mbs[3],l=[...i.boundingVolume.center],f=e.unprojectPosition(e.cameraPosition);ws.WGS84.cartographicToCartesian(f,Ay),Kx.copy(Ay).subtract(l).normalize(),ws.WGS84.eastNorthUpToFixedFrame(l,Sy),Qx.copy(Sy).invert(),Bh.copy(Ay).transform(Qx);const y=Math.sqrt(Bh[0]*Bh[0]+Bh[1]*Bh[1]),x=y*y/Bh[2];Yx.copy([Bh[0],Bh[1],x]);const T=Yx.transform(Sy).subtract(l).normalize(),P=Kx.cross(T).normalize().scale(c).add(l),M=ws.WGS84.cartesianToCartographic(P),N=e.project([s,r,n]),G=e.project(M);return Gj.copy(N).subtract(G).magnitude()}function qj(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class t5{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;H(this,"_map",new Map),H(this,"_array",void 0),H(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Qr(t<this._array.length),this._array[t]}set(t,e){Qr(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Qr(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Qr(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const Hj={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Rm{traversalFinished(t){return!0}constructor(t){H(this,"options",void 0),H(this,"root",null),H(this,"selectedTiles",{}),H(this,"requestedTiles",{}),H(this,"emptyTiles",{}),H(this,"lastUpdate",new Date().getTime()),H(this,"updateDebounceTime",1e3),H(this,"_traversalStack",new t5),H(this,"_emptyTraversalStack",new t5),H(this,"_frameNumber",null),this.options={...Hj,...t}}traverse(t,e,r){this.root=t,this.options={...this.options,...r},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const r=this._traversalStack;for(t._selectionDepth=1,r.push(t);r.length>0;){const n=r.pop();let c=!1;this.canTraverse(n,e)&&(this.updateChildTiles(n,e),c=this.updateAndPushChildren(n,e,r,n.hasRenderContent?n._selectionDepth+1:n._selectionDepth));const l=n.parent,f=!!(!l||l._shouldRefine),y=!c;n.hasRenderContent?n.refine===Xc.ADD?(this.loadTile(n,e),this.selectTile(n,e)):n.refine===Xc.REPLACE&&(this.loadTile(n,e),y&&this.selectTile(n,e)):(this.emptyTiles[n.id]=n,this.loadTile(n,e),y&&this.selectTile(n,e)),this.touchTile(n,e),n._shouldRefine=c&&f}const s=new Date().getTime();(this.traversalFinished(e)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const r=t.children;for(const s of r)this.updateTile(s,e)}updateAndPushChildren(t,e,r,s){const{loadSiblings:n,skipLevelOfDetail:c}=this.options,l=t.children;l.sort(this.compareDistanceToCamera.bind(this));const f=t.refine===Xc.REPLACE&&t.hasRenderContent&&!c;let y=!1,x=!0;for(const T of l)if(T._selectionDepth=s,T.isVisibleAndInRequestVolume?(r.find(T)&&r.delete(T),r.push(T),y=!0):(f||n)&&(this.loadTile(T,e),this.touchTile(T,e)),f){let P;if(T._inRequestVolume?T.hasRenderContent?P=T.contentAvailable:P=this.executeEmptyTraversal(T,e):P=!1,x=x&&P,!x)return!1}return y||(x=!1),x}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!s&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,e,r):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=t._screenSpaceError;return r&&(s=t.getScreenSpaceError(e,!0)),s>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const r=[];if(this.options.viewportTraversersMap)for(const s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===e.viewport.id&&r.push(s);else r.push(e.viewport.id);t.updateVisibility(e,r)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let r=!1;for(const s of t.children)s.updateVisibility(e),r=r||s.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(t,e){let r=!0;const s=this._emptyTraversalStack;for(s.push(t);s.length>0&&r;){const n=s.pop();if(this.updateTile(n,e),n.isVisibleAndInRequestVolume||this.loadTile(n,e),this.touchTile(n,e),!n.hasRenderContent&&this.canTraverse(n,e,!1,!0)){const c=n.children;for(const l of c)s.find(l)&&s.delete(l),s.push(l)}else!n.contentAvailable&&!n.hasEmptyContent&&(r=!1)}return r}}const e5=new re;function Wj(i){return i!=null}class O_{constructor(t,e,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";H(this,"tileset",void 0),H(this,"header",void 0),H(this,"id",void 0),H(this,"url",void 0),H(this,"parent",void 0),H(this,"refine",void 0),H(this,"type",void 0),H(this,"contentUrl",void 0),H(this,"lodMetricType","geometricError"),H(this,"lodMetricValue",0),H(this,"boundingVolume",null),H(this,"content",null),H(this,"contentState",na.UNLOADED),H(this,"gpuMemoryUsageInBytes",0),H(this,"children",[]),H(this,"depth",0),H(this,"viewportIds",[]),H(this,"transform",new cr),H(this,"extensions",null),H(this,"implicitTiling",null),H(this,"userData",{}),H(this,"computedTransform",void 0),H(this,"hasEmptyContent",!1),H(this,"hasTilesetContent",!1),H(this,"traverser",new Rm({})),H(this,"_cacheNode",null),H(this,"_frameNumber",null),H(this,"_expireDate",null),H(this,"_expiredContent",null),H(this,"_boundingBox",void 0),H(this,"_distanceToCamera",0),H(this,"_screenSpaceError",0),H(this,"_visibilityPlaneMask",void 0),H(this,"_visible",void 0),H(this,"_contentBoundingVolume",void 0),H(this,"_viewerRequestVolume",void 0),H(this,"_initialTransform",new cr),H(this,"_priority",0),H(this,"_selectedFrame",0),H(this,"_requestedFrame",0),H(this,"_selectionDepth",0),H(this,"_touchedFrame",0),H(this,"_centerZDepth",0),H(this,"_shouldRefine",!1),H(this,"_stackLength",0),H(this,"_visitedFrame",0),H(this,"_inRequestVolume",!1),H(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=s||e.id,this.url=e.url,this.parent=r,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===na.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===na.UNLOADED}get contentExpired(){return this.contentState===na.EXPIRED}get contentFailed(){return this.contentState===na.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Oj(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case Oa.I3S:return HS(this,t);case Oa.TILES3D:return Uj(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,r=this.refine===Xc.ADD||e;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===na.UNLOADED)return-1;const s=this.parent,n=s&&(!r||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,c=t.root?t.root._screenSpaceError:0;return Math.max(c-n,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=na.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=na.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,s={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Vh(e,r,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=na.READY,this._onContentLoaded(),!0}catch(e){throw this.contentState=na.FAILED,e}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=na.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const r=this.parent,s=r?r._visibilityPlaneMask:za.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const n=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(n)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,s),this._visible=this._visibilityPlaneMask!==za.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:r}=t,{boundingVolume:s}=this;return r.computeVisibilityWithPlaneMask(s,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const r=this.boundingVolume;return e5.subVectors(r.center,e.position),e.direction.dot(e5)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(Wj(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=na.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new cr(t.transform):new cr;const e=this.parent,r=this.tileset,s=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new cr(s).multiplyRight(this.transform);const n=e&&e._initialTransform?e._initialTransform.clone():new cr;this._initialTransform=new cr(n).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=na.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=za.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Xc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=xy(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=xy(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=xy(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new cr).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return qj(this.tileset.tileset)}}}class Jj extends Rm{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const c=t.children[0];this.updateTileVisibility(c,e),t._visible=c._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const s=t.refine===Xc.REPLACE,n=t._optimChildrenWithinParent===Bj.USE_OPTIMIZATION;if(s&&n&&r&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:r}=t;return!r||r.hasTilesetContent||r.refine!==Xc.ADD?!1:!this.shouldRefine(t,e,!0)}}class Zj{constructor(){H(this,"frameNumberMap",new Map)}register(t,e){const r=this.frameNumberMap.get(t)||new Map,s=r.get(e)||0;r.set(e,s+1),this.frameNumberMap.set(t,r)}deregister(t,e){const r=this.frameNumberMap.get(t);if(!r)return;const s=r.get(e)||1;r.set(e,s-1)}isZero(t,e){var r;return(((r=this.frameNumberMap.get(t))===null||r===void 0?void 0:r.get(e))||0)===0}}const Ey={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Xj{constructor(){H(this,"_statusMap",void 0),H(this,"pendingTilesRegister",new Zj),this._statusMap={}}add(t,e,r,s){if(!this._statusMap[e]){const{frameNumber:n,viewport:{id:c}}=s;this._statusMap[e]={request:t,callback:r,key:e,frameState:s,status:Ey.REQUESTED},this.pendingTilesRegister.register(c,n),t().then(l=>{this._statusMap[e].status=Ey.COMPLETED;const{frameNumber:f,viewport:{id:y}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(y,f),this._statusMap[e].callback(l,s)}).catch(l=>{this._statusMap[e].status=Ey.ERROR;const{frameNumber:f,viewport:{id:y}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(y,f),r(l)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:r,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,r);const{frameNumber:n,viewport:{id:c}}=e;this.pendingTilesRegister.register(c,n),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class $j extends Rm{constructor(t){super(t),H(this,"_tileManager",void 0),this._tileManager=new Xj}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=Vj(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const r=t.header.children||[],s=t.children,n=t.tileset;for(const c of r){const l="".concat(c.id,"-").concat(e.viewport.id),f=s&&s.find(y=>y.id===l);if(f)f&&this.updateTile(f,e);else{let y=()=>this._loadTile(c.id,n);this._tileManager.find(l)?this._tileManager.update(l,e):(n.tileset.nodePages&&(y=()=>n.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(y,l,x=>this._onTileLoad(x,t,l),e))}}return!1}async _loadTile(t,e){const{loader:r}=e,s=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),n={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await Vh(s,r,n)}_onTileLoad(t,e,r){const s=new O_(e.tileset,t,e,r);e.children.push(s);const n=this._tileManager.find(s.id).frameState;this.updateTile(s,n),this._frameNumber===n.frameNumber&&(this.traversalFinished(n)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,n)}}const Kj={description:"",ellipsoid:ws.WGS84,modelMatrix:new cr,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},xg="Tiles In Tileset(s)",Cy="Tiles In Memory",i5="Tiles In View",r5="Tiles To Render",s5="Tiles Loaded",Ty="Tiles Loading",n5="Tiles Unloaded",o5="Failed Tile Loads",a5="Points/Vertices",Py="Tile Memory Use";class Yj{constructor(t,e){H(this,"options",void 0),H(this,"loadOptions",void 0),H(this,"type",void 0),H(this,"tileset",void 0),H(this,"loader",void 0),H(this,"url",void 0),H(this,"basePath",void 0),H(this,"modelMatrix",void 0),H(this,"ellipsoid",void 0),H(this,"lodMetricType",void 0),H(this,"lodMetricValue",void 0),H(this,"refine",void 0),H(this,"root",null),H(this,"roots",{}),H(this,"asset",{}),H(this,"description",""),H(this,"properties",void 0),H(this,"extras",null),H(this,"attributions",{}),H(this,"credits",{}),H(this,"stats",void 0),H(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),H(this,"cartographicCenter",null),H(this,"cartesianCenter",null),H(this,"zoom",1),H(this,"boundingVolume",null),H(this,"dynamicScreenSpaceErrorComputedDensity",0),H(this,"maximumMemoryUsage",32),H(this,"gpuMemoryUsageInBytes",0),H(this,"_frameNumber",0),H(this,"_queryParams",{}),H(this,"_extensionsUsed",[]),H(this,"_tiles",{}),H(this,"_pendingCount",0),H(this,"selectedTiles",[]),H(this,"traverseCounter",0),H(this,"geometricError",0),H(this,"lastUpdatedVieports",null),H(this,"_requestedTiles",[]),H(this,"_emptyTiles",[]),H(this,"frameStateData",{}),H(this,"_traverser",void 0),H(this,"_cache",new xj),H(this,"_requestScheduler",void 0),H(this,"updatePromise",null),H(this,"tilesetInitializationPromise",void 0),this.options={...Kj,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||p1(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new tI({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new vj({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const r=[];for(const s of e){const n=s.id;this._needTraverse(n)?r.push(n):this.traverseCounter--}for(const s of e){const n=s.id;if(this.roots[n]||(this.roots[n]=this._initializeTileHeaders(this.tileset,null)),!r.includes(n))continue;const c=Sj(s,this._frameNumber);this._traverser.traverse(this.roots[n],c,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[e],s=Object.values(this._traverser.selectedTiles),[n,c]=Ej(s,t,this.options.maximumTilesSelected);r.selectedTiles=n;for(const l of c)l.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const r=new Set(t.map(c=>c.id)),s=new Set(e.map(c=>c.id));let n=t.filter(c=>!s.has(c.id)).length>0;return n=n||e.filter(c=>!r.has(c.id)).length>0,n}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(t++,r.content.pointCount?e+=r.content.pointCount:e+=r.content.vertexCount);this.stats.get(i5).count=this.selectedTiles.length,this.stats.get(r5).count=t,this.stats.get(a5).count=e}async _initializeTileSet(t){this.type===Oa.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Oa.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Oa.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:s,xmax:n,ymin:c,ymax:l,zmin:f,zmax:y}=e;this.cartographicCenter=new re(s+(n-s)/2,c+(l-c)/2,f+(y-f)/2),this.cartesianCenter=ws.WGS84.cartographicToCartesian(this.cartographicCenter,new re),this.zoom=US(e,this.cartographicCenter,this.cartesianCenter);return}const r=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(r){const[s,n,c,l]=r;this.cartographicCenter=new re(s+(c-s)/2,n+(l-n)/2,0),this.cartesianCenter=ws.WGS84.cartographicToCartesian(this.cartographicCenter,new re),this.zoom=Mj(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new re,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new re,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?this.cartographicCenter=ws.WGS84.cartesianToCartographic(e,new re):this.cartographicCenter=new re(0,0,-ws.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=Ij(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(xg),this.stats.get(Ty),this.stats.get(Cy),this.stats.get(i5),this.stats.get(r5),this.stats.get(s5),this.stats.get(n5),this.stats.get(o5),this.stats.get(a5),this.stats.get(Py,"memory")}_initializeTileHeaders(t,e){const r=new O_(this,t.root,e);if(e&&(e.children.push(r),r.depth=e.depth+1),this.type===Oa.TILES3D){const n=[];for(n.push(r);n.length>0;){const c=n.pop();this.stats.get(xg).incrementCount();const l=c.header.children||[];for(const f of l){var s;const y=new O_(this,f,c);if((s=y.contentUrl)!==null&&s!==void 0&&s.includes("?session=")){const x=new URL(y.contentUrl).searchParams.get("session");x&&(this._queryParams.session=x)}c.children.push(y),y.depth=c.depth+1,n.push(y)}}}return r}_initializeTraverser(){let t;switch(this.type){case Oa.TILES3D:t=Jj;break;case Oa.I3S:t=$j;break;default:t=Rm}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(r){this._onTileLoadError(t,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(o5).incrementCount();const r=e.message||e.toString(),s=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(r)),this.options.onTileError(t,r,s)}_onTileLoad(t,e){if(e){if(this.type===Oa.I3S){var r,s;const n=((r=this.tileset)===null||r===void 0||(s=r.nodePagesTile)===null||s===void 0?void 0:s.nodesInNodePages)||0;this.stats.get(xg).reset(),this.stats.get(xg).addCount(n)}t&&t.content&&Aj(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===Oa.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Oa.TILES3D){var e;const{extensionsRemoved:r=[]}=((e=t.content)===null||e===void 0?void 0:e.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Ty).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Ty).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(s5).incrementCount(),this.stats.get(Cy).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(Py).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(Cy).decrementCount(),this.stats.get(n5).incrementCount(),this.stats.get(Py).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const r of e.children)t.push(r);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();for(const s of t.children)r.push(s);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),r=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const WS="3.4.14",Mp={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function JS(i,t,e){Qr(i instanceof ArrayBuffer);const r=new TextDecoder("utf8"),s=new Uint8Array(i,t,e);return r.decode(s)}function Qj(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(i);return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}const tU={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Zs={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},xr={...tU,...Zs},Iy={[Zs.DOUBLE]:Float64Array,[Zs.FLOAT]:Float32Array,[Zs.UNSIGNED_SHORT]:Uint16Array,[Zs.UNSIGNED_INT]:Uint32Array,[Zs.UNSIGNED_BYTE]:Uint8Array,[Zs.BYTE]:Int8Array,[Zs.SHORT]:Int16Array,[Zs.INT]:Int32Array},eU={DOUBLE:Zs.DOUBLE,FLOAT:Zs.FLOAT,UNSIGNED_SHORT:Zs.UNSIGNED_SHORT,UNSIGNED_INT:Zs.UNSIGNED_INT,UNSIGNED_BYTE:Zs.UNSIGNED_BYTE,BYTE:Zs.BYTE,SHORT:Zs.SHORT,INT:Zs.INT},My="Failed to convert GL type";class lc{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in Iy)if(Iy[e]===t)return e;throw new Error(My)}static fromName(t){const e=eU[t];if(!e)throw new Error(My);return e}static getArrayType(t){switch(t){case Zs.UNSIGNED_SHORT_5_6_5:case Zs.UNSIGNED_SHORT_4_4_4_4:case Zs.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=Iy[t];if(!e)throw new Error(My);return e}}static getByteSize(t){return lc.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!lc.getArrayType(t)}static createTypedArray(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;s===void 0&&(s=(e.byteLength-r)/lc.getByteSize(t));const n=lc.getArrayType(t);return new n(e,r,s)}}function iU(i,t){if(!i)throw new Error("math.gl assertion failed. ".concat(t))}function rU(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=i>>11&31,r=i>>5&63,s=i&31;return t[0]=e<<3,t[1]=r<<2,t[2]=s<<3,t}new D1;new re;new D1;new D1;function l5(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Wc(i,0,t)/t*2-1}function c5(i){return i<0?-1:1}function sU(i,t,e,r){if(iU(r),i<0||i>e||t<0||t>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(r.x=l5(i,e),r.y=l5(t,e),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const s=r.x;r.x=(1-Math.abs(r.y))*c5(s),r.y=(1-Math.abs(s))*c5(r.y)}return r.normalize()}function nU(i,t,e){return sU(i,t,255,e)}class mv{constructor(t,e){H(this,"json",void 0),H(this,"buffer",void 0),H(this,"featuresLength",0),H(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xr.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,s.byteOffset):s}getPropertyArray(t,e,r){const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(e=lc.fromName(s.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(t,e,s)}getProperty(t,e,r,s,n){const c=this.json[t];if(!c)return c;const l=this.getPropertyArray(t,e,r);if(r===1)return l[s];for(let f=0;f<r;++f)n[f]=l[r*s+f];return n}_getTypedArrayFromBinary(t,e,r,s,n){const c=this._cachedTypedArrays;let l=c[t];return l||(l=lc.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+n,s*r),c[t]=l),l}_getTypedArrayFromArray(t,e,r){const s=this._cachedTypedArrays;let n=s[t];return n||(n=lc.createTypedArray(e,r),s[t]=n),n}}const oU={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},aU={SCALAR:(i,t)=>i[t],VEC2:(i,t)=>[i[2*t+0],i[2*t+1]],VEC3:(i,t)=>[i[3*t+0],i[3*t+1],i[3*t+2]],VEC4:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT2:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT3:(i,t)=>[i[9*t+0],i[9*t+1],i[9*t+2],i[9*t+3],i[9*t+4],i[9*t+5],i[9*t+6],i[9*t+7],i[9*t+8]],MAT4:(i,t)=>[i[16*t+0],i[16*t+1],i[16*t+2],i[16*t+3],i[16*t+4],i[16*t+5],i[16*t+6],i[16*t+7],i[16*t+8],i[16*t+9],i[16*t+10],i[16*t+11],i[16*t+12],i[16*t+13],i[16*t+14],i[16*t+15]]},lU={SCALAR:(i,t,e)=>{t[e]=i},VEC2:(i,t,e)=>{t[2*e+0]=i[0],t[2*e+1]=i[1]},VEC3:(i,t,e)=>{t[3*e+0]=i[0],t[3*e+1]=i[1],t[3*e+2]=i[2]},VEC4:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT2:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT3:(i,t,e)=>{t[9*e+0]=i[0],t[9*e+1]=i[1],t[9*e+2]=i[2],t[9*e+3]=i[3],t[9*e+4]=i[4],t[9*e+5]=i[5],t[9*e+6]=i[6],t[9*e+7]=i[7],t[9*e+8]=i[8],t[9*e+9]=i[9]},MAT4:(i,t,e)=>{t[16*e+0]=i[0],t[16*e+1]=i[1],t[16*e+2]=i[2],t[16*e+3]=i[3],t[16*e+4]=i[4],t[16*e+5]=i[5],t[16*e+6]=i[6],t[16*e+7]=i[7],t[16*e+8]=i[8],t[16*e+9]=i[9],t[16*e+10]=i[10],t[16*e+11]=i[11],t[16*e+12]=i[12],t[16*e+13]=i[13],t[16*e+14]=i[14],t[16*e+15]=i[15]}};function cU(i,t,e,r){const{componentType:s}=i;Qr(i.componentType);const n=typeof s=="string"?lc.fromName(s):s,c=oU[i.type],l=aU[i.type],f=lU[i.type];return e+=i.byteOffset,{values:lc.createTypedArray(n,t,e,c*r),type:n,size:c,unpacker:l,packer:f}}const nc=i=>i!==void 0;function hU(i,t,e){if(!t)return null;let r=i.getExtension("3DTILES_batch_table_hierarchy");const s=t.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,r=s),r?uU(r,e):null}function uU(i,t){let e,r,s;const n=i.instancesLength,c=i.classes;let l=i.classIds,f=i.parentCounts,y=i.parentIds,x=n;nc(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,n));let T;if(nc(f))for(nc(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,s=getBinaryAccessor(f),f=s.createArrayBufferView(t.buffer,t.byteOffset+f.byteOffset,n)),T=new Uint16Array(n),x=0,e=0;e<n;++e)T[e]=x,x+=f[e];nc(y)&&nc(y.byteOffset)&&(y.componentType=defaultValue(y.componentType,GL.UNSIGNED_SHORT),y.type=AttributeType.SCALAR,s=getBinaryAccessor(y),y=s.createArrayBufferView(t.buffer,t.byteOffset+y.byteOffset,x));const P=c.length;for(e=0;e<P;++e){const Z=c[e].length,X=c[e].instances,$=getBinaryProperties(Z,X,t);c[e].instances=combine($,X)}const M=new Array(P).fill(0),N=new Uint16Array(n);for(e=0;e<n;++e)r=l[e],N[e]=M[r],++M[r];const G={classes:c,classIds:l,classIndexes:N,parentCounts:f,parentIndexes:T,parentIds:y};return fU(G),G}function Lp(i,t,e){if(!i)return;const r=i.parentCounts;return i.parentIds?e(i,t):r>0?dU(i,t,e):pU(i,t,e)}function dU(i,t,e){const r=i.classIds,s=i.parentCounts,n=i.parentIds,c=i.parentIndexes,l=r.length,f=scratchVisited;f.length=Math.max(f.length,l);const y=++marker,x=scratchStack;for(x.length=0,x.push(t);x.length>0;){if(t=x.pop(),f[t]===y)continue;f[t]=y;const T=e(i,t);if(nc(T))return T;const P=s[t],M=c[t];for(let N=0;N<P;++N){const G=n[M+N];G!==t&&x.push(G)}}return null}function pU(i,t,e){let r=!0;for(;r;){const s=e(i,t);if(nc(s))return s;const n=i.parentIds[t];r=n!==t,t=n}throw new Error("traverseHierarchySingleParent")}function fU(i){const t=i.classIds.length;for(let e=0;e<t;++e)ZS(i,e,stack)}function ZS(i,t,e){const r=i.parentCounts,s=i.parentIds,n=i.parentIndexes,c=i.classIds.length;if(!nc(s))return;assert(t<c,"Parent index ".concat(t," exceeds the total number of instances: ").concat(c)),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const l=nc(r)?r[t]:1,f=nc(r)?n[t]:t;for(let y=0;y<l;++y){const x=s[f+y];x!==t&&ZS(i,x,e)}e.pop(t)}function Do(i){return i!=null}const Ag=(i,t)=>i,gU={HIERARCHY:!0,extensions:!0,extras:!0};class XS{constructor(t,e,r){var s;let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};H(this,"json",void 0),H(this,"binary",void 0),H(this,"featureCount",void 0),H(this,"_extensions",void 0),H(this,"_properties",void 0),H(this,"_binaryProperties",void 0),H(this,"_hierarchy",void 0),Qr(r>=0),this.json=t||{},this.binary=e,this.featureCount=r,this._extensions=((s=this.json)===null||s===void 0?void 0:s.extensions)||{},this._properties={};for(const c in this.json)gU[c]||(this._properties[c]=this.json[c]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=hU(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),Qr(typeof e=="string",e),this._hierarchy){const r=Lp(this._hierarchy,t,(s,n)=>{const c=s.classIds[n];return s.classes[c].name===e});return Do(r)}return!1}isExactClass(t,e){return Qr(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),Qr(typeof e=="string",e),Do(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=Do(e)?e:[],e.length=0;const r=Object.keys(this._properties);return e.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),Qr(typeof e=="string",e),this._binaryProperties){const s=this._binaryProperties[e];if(Do(s))return this._getBinaryProperty(s,t)}const r=this._properties[e];if(Do(r))return Ag(r[t]);if(this._hierarchy){const s=this._getHierarchyProperty(t,e);if(Do(s))return s}}setProperty(t,e,r){const s=this.featureCount;if(this._checkBatchId(t),Qr(typeof e=="string",e),this._binaryProperties){const c=this._binaryProperties[e];if(c){this._setBinaryProperty(c,t,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,r))return;let n=this._properties[e];Do(n)||(this._properties[e]=new Array(s),n=this._properties[e]),n[t]=Ag(r)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,r){t.pack(r,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const r=this._properties[e],s=this._initializeBinaryProperty(e,r);s&&(t=t||{},t[e]=s)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const r=e;Qr(this.binary,"Property ".concat(t," requires a batch table binary.")),Qr(r.type,"Property ".concat(t," requires a type."));const s=cU(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const r=Lp(this._hierarchy,t,(s,n)=>{const c=s.classIds[n],l=s.classes[c].instances;return Do(l[e])});return Do(r)}_getPropertyNamesInHierarchy(t,e){Lp(this._hierarchy,t,(r,s)=>{const n=r.classIds[s],c=r.classes[n].instances;for(const l in c)c.hasOwnProperty(l)&&e.indexOf(l)===-1&&e.push(l)})}_getHierarchyProperty(t,e){return Lp(this._hierarchy,t,(r,s)=>{const n=r.classIds[s],c=r.classes[n],l=r.classIndexes[s],f=c.instances[e];return Do(f)?Do(f.typedArray)?this._getBinaryProperty(f,l):Ag(f[l]):null})}_setHierarchyProperty(t,e,r,s){const n=Lp(this._hierarchy,e,(c,l)=>{const f=c.classIds[l],y=c.classes[f],x=c.classIndexes[l],T=y.instances[r];return Do(T)?(Qr(l===e,'Inherited property "'.concat(r,'" is read-only.')),Do(T.typedArray)?this._setBinaryProperty(T,x,s):T[x]=Ag(s),!0):!1});return Do(n)}}const Ly=4;function km(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(t);if(i.magic=r.getUint32(e,!0),e+=Ly,i.version=r.getUint32(e,!0),e+=Ly,i.byteLength=r.getUint32(e,!0),e+=Ly,i.version!==1)throw new Error("3D Tile Version ".concat(i.version," not supported"));return e}const dd=4,h5="b3dm tile in legacy format.";function yv(i,t,e){const r=new DataView(t);let s;i.header=i.header||{};let n=r.getUint32(e,!0);e+=dd;let c=r.getUint32(e,!0);e+=dd;let l=r.getUint32(e,!0);e+=dd;let f=r.getUint32(e,!0);return e+=dd,l>=570425344?(e-=dd*2,s=n,l=c,f=0,n=0,c=0,console.warn(h5)):f>=570425344&&(e-=dd,s=l,l=n,f=c,n=0,c=0,console.warn(h5)),i.header.featureTableJsonByteLength=n,i.header.featureTableBinaryByteLength=c,i.header.batchTableJsonByteLength=l,i.header.batchTableBinaryByteLength=f,i.header.batchLength=s,e}function _v(i,t,e,r){return e=mU(i,t,e),e=yU(i,t,e),e}function mU(i,t,e,r){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:n,batchLength:c}=i.header;if(i.featureTableJson={BATCH_LENGTH:c||0},s>0){const l=JS(t,e,s);i.featureTableJson=JSON.parse(l)}return e+=s,i.featureTableBinary=new Uint8Array(t,e,n),e+=n,e}function yU(i,t,e,r){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:n}=i.header;if(s>0){const c=JS(t,e,s);i.batchTableJson=JSON.parse(c),e+=s,n>0&&(i.batchTableBinary=new Uint8Array(t,e,n),i.batchTableBinary=new Uint8Array(i.batchTableBinary),e+=n)}return e}function $S(i,t,e){if(!t&&(!i||!i.batchIds||!e))return null;const{batchIds:r,isRGB565:s,pointCount:n}=i;if(r&&e){const c=new Uint8ClampedArray(n*3);for(let l=0;l<n;l++){const f=r[l],y=e.getProperty(f,"dimensions").map(x=>x*255);c[l*3]=y[0],c[l*3+1]=y[1],c[l*3+2]=y[2]}return{type:xr.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}if(s){const c=new Uint8ClampedArray(n*3);for(let l=0;l<n;l++){const f=rU(t[l]);c[l*3]=f[0],c[l*3+1]=f[1],c[l*3+2]=f[2]}return{type:xr.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return t&&t.length===n*3?{type:xr.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:xr.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const u5=new re;function _U(i,t){if(!t)return null;if(i.isOctEncoded16P){const e=new Float32Array(i.pointsLength*3);for(let r=0;r<i.pointsLength;r++)nU(t[r*2],t[r*2+1],u5),u5.toArray(e,r*3);return{type:xr.FLOAT,size:2,value:e}}return{type:xr.FLOAT,size:2,value:t}}function vU(i,t,e){return i.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,bU(i,t)):{type:xr.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function bU(i,t){const e=new re,r=new Float32Array(i.pointCount*3);for(let s=0;s<i.pointCount;s++)e.set(t[s*3],t[s*3+1],t[s*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(r,s*3);return r}async function wU(i,t,e,r,s){e=km(i,t,e),e=yv(i,t,e),e=_v(i,t,e),xU(i);const{featureTable:n,batchTable:c}=AU(i);return await PU(i,n,c,r,s),SU(i,n,r),EU(i,n,c),CU(i,n),e}function xU(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function AU(i){const t=new mv(i.featureTableJson,i.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,i.featuresLength=e,i.pointsLength=e,i.pointCount=e,i.rtcCenter=t.getGlobalProperty("RTC_CENTER",xr.FLOAT,3);const r=TU(i,t);return{featureTable:t,batchTable:r}}function SU(i,t,e){if(!i.attributes.positions){if(t.hasProperty("POSITION"))i.attributes.positions=t.getPropertyArray("POSITION",xr.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const r=t.getPropertyArray("POSITION_QUANTIZED",xr.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",xr.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",xr.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=vU(i,r,e)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function EU(i,t,e){if(!i.attributes.colors){let r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",xr.UNSIGNED_BYTE,4),i.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",xr.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",xr.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=$S(i,r,e)}t.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",xr.UNSIGNED_BYTE,4))}function CU(i,t){if(!i.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",xr.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",xr.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=_U(i,e)}}function TU(i,t){let e=null;if(!i.batchIds&&t.hasProperty("BATCH_ID")&&(i.batchIds=t.getPropertyArray("BATCH_ID",xr.UNSIGNED_SHORT,1),i.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:n}=i;e=new XS(s,n,r)}return e}async function PU(i,t,e,r,s){let n,c,l;const f=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(l=f.properties);const y=t.getExtension("3DTILES_draco_point_compression");if(y){c=y.properties;const T=y.byteOffset,P=y.byteLength;if(!c||!Number.isFinite(T)||!P)throw new Error("Draco properties, byteOffset, and byteLength must be defined");n=i.featureTableBinary.slice(T,T+P),i.hasPositions=Number.isFinite(c.POSITION),i.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),i.hasNormals=Number.isFinite(c.NORMAL),i.hasBatchIds=Number.isFinite(c.BATCH_ID),i.isTranslucent=Number.isFinite(c.RGBA)}if(!n)return!0;const x={buffer:n,properties:{...c,...l},featureTableProperties:c,batchTableProperties:l,dequantizeInShader:!1};return await IU(i,x,r,s)}async function IU(i,t,e,r){const{parse:s}=r,n={...e,draco:{...e.draco,extraAttributes:t.batchTableProperties||{}}};delete n["3d-tiles"];const c=await s(t.buffer,kS,n),l=c.attributes.POSITION&&c.attributes.POSITION.value,f=c.attributes.COLOR_0&&c.attributes.COLOR_0.value,y=c.attributes.NORMAL&&c.attributes.NORMAL.value,x=c.attributes.BATCH_ID&&c.attributes.BATCH_ID.value,T=l&&c.attributes.POSITION.value.quantization,P=y&&c.attributes.NORMAL.value.quantization;if(T){const N=c.POSITION.data.quantization,G=N.range;i.quantizedVolumeScale=new re(G,G,G),i.quantizedVolumeOffset=new re(N.minValues),i.quantizedRange=(1<<N.quantizationBits)-1,i.isQuantizedDraco=!0}P&&(i.octEncodedRange=(1<<c.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const M={};if(t.batchTableProperties)for(const N of Object.keys(t.batchTableProperties))c.attributes[N]&&c.attributes[N].value&&(M[N.toLowerCase()]=c.attributes[N].value);i.attributes={positions:l,colors:$S(i,f,void 0),normals:y,batchIds:x,...M}}const D_={URI:0,EMBEDDED:1};function KS(i,t,e,r){i.rotateYtoZ=!0;const s=i.byteOffset+i.byteLength-e;if(s===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=d1(t,e,s),i.gltfByteOffset=0,i.gltfByteLength=s,e%4===0||console.warn("".concat(i.type,": embedded glb is not aligned to a 4-byte boundary.")),i.byteOffset+i.byteLength}async function YS(i,t,e,r){const s=e["3d-tiles"]||{};if(MU(i,t),s.loadGLTF){const{parse:n,fetch:c}=r;i.gltfUrl&&(i.gltfArrayBuffer=await c(i.gltfUrl,e),i.gltfByteOffset=0),i.gltfArrayBuffer&&(i.gltf=await n(i.gltfArrayBuffer,of,e,r),i.gpuMemoryUsageInBytes=BS(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength)}}function MU(i,t,e){switch(t){case D_.URI:const r=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),s=new TextDecoder().decode(r);i.gltfUrl=s.replace(/[\s\0]+$/,""),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case D_.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function LU(i,t,e,r,s){var n;e=BU(i,t,e,r),await YS(i,D_.EMBEDDED,r,s);const c=i==null||(n=i.gltf)===null||n===void 0?void 0:n.extensions;return c&&c.CESIUM_RTC&&(i.rtcCenter=c.CESIUM_RTC.center),e}function BU(i,t,e,r,s){e=km(i,t,e),e=yv(i,t,e),e=_v(i,t,e),e=KS(i,t,e,r);const n=new mv(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=n.getGlobalProperty("RTC_CENTER",xr.FLOAT,3),e}async function RU(i,t,e,r,s){return e=kU(i,t,e,r),await YS(i,i.gltfFormat,r,s),e}function kU(i,t,e,r,s){if(e=km(i,t,e),i.version!==1)throw new Error("Instanced 3D Model version ".concat(i.version," is not supported"));e=yv(i,t,e);const n=new DataView(t);if(i.gltfFormat=n.getUint32(e,!0),e+=4,e=_v(i,t,e),e=KS(i,t,e,r),i.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const c=new mv(i.featureTableJson,i.featureTableBinary),l=c.getGlobalProperty("INSTANCES_LENGTH");if(c.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=c.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=c.getGlobalProperty("RTC_CENTER",xr.FLOAT,3);const f=new XS(i.batchTableJson,i.batchTableBinary,l);return OU(i,c,f,l),e}function OU(i,t,e,r){const s={instances:new Array(r),batchTable:i._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,n=new re;new re,new re,new re;const c=new Rs,l=new tf,f=new re,y={},x=new cr,T=[],P=[],M=new re,N=new re;for(let G=0;G<r;G++){let Z;if(t.hasProperty("POSITION"))Z=t.getProperty("POSITION",xr.FLOAT,3,G,n);else if(t.hasProperty("POSITION_QUANTIZED")){Z=t.getProperty("POSITION_QUANTIZED",xr.UNSIGNED_SHORT,3,G,n);const Nt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",xr.FLOAT,3,M);if(!Nt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Rt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",xr.FLOAT,3,N);if(!Rt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const xt=65535;for(let qt=0;qt<3;qt++)Z[qt]=Z[qt]/xt*Rt[qt]+Nt[qt]}if(!Z)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(n.copy(Z),y.translation=n,i.normalUp=t.getProperty("NORMAL_UP",xr.FLOAT,3,G,T),i.normalRight=t.getProperty("NORMAL_RIGHT",xr.FLOAT,3,G,P),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",xr.UNSIGNED_SHORT,2,T),i.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",xr.UNSIGNED_SHORT,2,P),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(ws.WGS84.eastNorthUpToFixedFrame(n,x),x.getRotationMatrix3(c)):c.identity()}l.fromMatrix3(c),y.rotation=l,f.set(1,1,1);const X=t.getProperty("SCALE",xr.FLOAT,1,G);Number.isFinite(X)&&f.multiplyByScalar(X);const $=t.getProperty("SCALE_NON_UNIFORM",xr.FLOAT,3,G,T);$&&f.scale($),y.scale=f;let ct=t.getProperty("BATCH_ID",xr.UNSIGNED_SHORT,1,G);ct===void 0&&(ct=G);const yt=new cr().fromQuaternion(y.rotation);x.identity(),x.translate(y.translation),x.multiplyRight(yt),x.scale(y.scale);const Mt=x.clone();s[G]={modelMatrix:Mt,batchId:ct}}i.instances=s}async function DU(i,t,e,r,s,n){e=km(i,t,e);const c=new DataView(t);for(i.tilesLength=c.getUint32(e,!0),e+=4,i.tiles=[];i.tiles.length<i.tilesLength&&i.byteLength-e>12;){const l={};i.tiles.push(l),e=await n(t,e,r,s,l)}return e}async function NU(i,t,e,r){i.rotateYtoZ=!0,i.gltfUpAxis=e["3d-tiles"]&&e["3d-tiles"].assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y";const{parse:s}=r;i.gltf=await s(t,of,e,r),i.gpuMemoryUsageInBytes=BS(i.gltf)}async function QS(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(s.byteOffset=t,s.type=Qj(i,t),s.type){case Mp.COMPOSITE:return await DU(s,i,t,e,r,QS);case Mp.BATCHED_3D_MODEL:return await LU(s,i,t,e,r);case Mp.GLTF:return await NU(s,i,e,r);case Mp.INSTANCED_3D_MODEL:return await RU(s,i,t,e,r);case Mp.POINT_CLOUD:return await wU(s,i,t,e,r);default:throw new Error("3DTileLoader: unknown type ".concat(s.type))}}const FU=1952609651,zU=1;async function jU(i,t,e){if(new Uint32Array(i.slice(0,4))[0]!==FU)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==zU)throw new Error("Wrong subtree file verson, must be 1");const r=d5(i.slice(8,16)),s=new Uint8Array(i,24,r),n=new TextDecoder("utf8").decode(s),c=JSON.parse(n),l=d5(i.slice(16,24));let f=new ArrayBuffer(0);return l&&(f=i.slice(24+r)),"bufferView"in c.tileAvailability&&(c.tileAvailability.explicitBitstream=await By(c,"tileAvailability",f,e)),"bufferView"in c.contentAvailability&&(c.contentAvailability.explicitBitstream=await By(c,"contentAvailability",f,e)),"bufferView"in c.childSubtreeAvailability&&(c.childSubtreeAvailability.explicitBitstream=await By(c,"childSubtreeAvailability",f,e)),c}function UU(i,t){if(t.startsWith("http")){const s=new URL(i,t);return decodeURI(s.toString())}const e="http://".concat(t),r=new URL(i,e);return"/".concat(r.host).concat(r.pathname)}async function By(i,t,e,r){const s=i[t].bufferView,n=i.bufferViews[s],c=i.buffers[n.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(c.uri){const l=UU(c.uri,r==null?void 0:r.url),f=await(await r.fetch(l)).arrayBuffer();return new Uint8Array(f,n.byteOffset,n.byteLength)}return new Uint8Array(e,n.byteOffset,n.byteLength)}function d5(i){const t=new DataView(i),e=t.getUint32(0,!0),r=t.getUint32(4,!0);return e+2**32*r}const tE={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:WS,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:jU,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var ja=null;try{ja=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function zr(i,t,e){this.low=i|0,this.high=t|0,this.unsigned=!!e}zr.prototype.__isLong__;Object.defineProperty(zr.prototype,"__isLong__",{value:!0});function Yn(i){return(i&&i.__isLong__)===!0}function p5(i){var t=Math.clz32(i&-i);return i?31-t:t}zr.isLong=Yn;var f5={},g5={};function Nu(i,t){var e,r,s;return t?(i>>>=0,(s=0<=i&&i<256)&&(r=g5[i],r)?r:(e=Sr(i,0,!0),s&&(g5[i]=e),e)):(i|=0,(s=-128<=i&&i<128)&&(r=f5[i],r)?r:(e=Sr(i,i<0?-1:0,!1),s&&(f5[i]=e),e))}zr.fromInt=Nu;function Ua(i,t){if(isNaN(i))return t?Jc:Tl;if(t){if(i<0)return Jc;if(i>=eE)return sE}else{if(i<=-y5)return zo;if(i+1>=y5)return rE}return i<0?Ua(-i,t).neg():Sr(i%qd|0,i/qd|0,t)}zr.fromNumber=Ua;function Sr(i,t,e){return new zr(i,t,e)}zr.fromBits=Sr;var ym=Math.pow;function vv(i,t,e){if(i.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return t?Jc:Tl;if(e=e||10,e<2||36<e)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return vv(i.substring(1),t,e).neg();for(var s=Ua(ym(e,8)),n=Tl,c=0;c<i.length;c+=8){var l=Math.min(8,i.length-c),f=parseInt(i.substring(c,c+l),e);if(l<8){var y=Ua(ym(e,l));n=n.mul(y).add(Ua(f))}else n=n.mul(s),n=n.add(Ua(f))}return n.unsigned=t,n}zr.fromString=vv;function Ll(i,t){return typeof i=="number"?Ua(i,t):typeof i=="string"?vv(i,t):Sr(i.low,i.high,typeof t=="boolean"?t:i.unsigned)}zr.fromValue=Ll;var m5=65536,GU=1<<24,qd=m5*m5,eE=qd*qd,y5=eE/2,_5=Nu(GU),Tl=Nu(0);zr.ZERO=Tl;var Jc=Nu(0,!0);zr.UZERO=Jc;var Ad=Nu(1);zr.ONE=Ad;var iE=Nu(1,!0);zr.UONE=iE;var N_=Nu(-1);zr.NEG_ONE=N_;var rE=Sr(-1,2147483647,!1);zr.MAX_VALUE=rE;var sE=Sr(-1,-1,!0);zr.MAX_UNSIGNED_VALUE=sE;var zo=Sr(0,-2147483648,!1);zr.MIN_VALUE=zo;var De=zr.prototype;De.toInt=function(){return this.unsigned?this.low>>>0:this.low};De.toNumber=function(){return this.unsigned?(this.high>>>0)*qd+(this.low>>>0):this.high*qd+(this.low>>>0)};De.toString=function(i){if(i=i||10,i<2||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(zo)){var t=Ua(i),e=this.div(t),r=e.mul(t).sub(this);return e.toString(i)+r.toInt().toString(i)}else return"-"+this.neg().toString(i);for(var s=Ua(ym(i,6),this.unsigned),n=this,c="";;){var l=n.div(s),f=n.sub(l.mul(s)).toInt()>>>0,y=f.toString(i);if(n=l,n.isZero())return y+c;for(;y.length<6;)y="0"+y;c=""+y+c}};De.getHighBits=function(){return this.high};De.getHighBitsUnsigned=function(){return this.high>>>0};De.getLowBits=function(){return this.low};De.getLowBitsUnsigned=function(){return this.low>>>0};De.getNumBitsAbs=function(){if(this.isNegative())return this.eq(zo)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,t=31;t>0&&!(i&1<<t);t--);return this.high!=0?t+33:t+1};De.isZero=function(){return this.high===0&&this.low===0};De.eqz=De.isZero;De.isNegative=function(){return!this.unsigned&&this.high<0};De.isPositive=function(){return this.unsigned||this.high>=0};De.isOdd=function(){return(this.low&1)===1};De.isEven=function(){return(this.low&1)===0};De.equals=function(i){return Yn(i)||(i=Ll(i)),this.unsigned!==i.unsigned&&this.high>>>31===1&&i.high>>>31===1?!1:this.high===i.high&&this.low===i.low};De.eq=De.equals;De.notEquals=function(i){return!this.eq(i)};De.neq=De.notEquals;De.ne=De.notEquals;De.lessThan=function(i){return this.comp(i)<0};De.lt=De.lessThan;De.lessThanOrEqual=function(i){return this.comp(i)<=0};De.lte=De.lessThanOrEqual;De.le=De.lessThanOrEqual;De.greaterThan=function(i){return this.comp(i)>0};De.gt=De.greaterThan;De.greaterThanOrEqual=function(i){return this.comp(i)>=0};De.gte=De.greaterThanOrEqual;De.ge=De.greaterThanOrEqual;De.compare=function(i){if(Yn(i)||(i=Ll(i)),this.eq(i))return 0;var t=this.isNegative(),e=i.isNegative();return t&&!e?-1:!t&&e?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1};De.comp=De.compare;De.negate=function(){return!this.unsigned&&this.eq(zo)?zo:this.not().add(Ad)};De.neg=De.negate;De.add=function(i){Yn(i)||(i=Ll(i));var t=this.high>>>16,e=this.high&65535,r=this.low>>>16,s=this.low&65535,n=i.high>>>16,c=i.high&65535,l=i.low>>>16,f=i.low&65535,y=0,x=0,T=0,P=0;return P+=s+f,T+=P>>>16,P&=65535,T+=r+l,x+=T>>>16,T&=65535,x+=e+c,y+=x>>>16,x&=65535,y+=t+n,y&=65535,Sr(T<<16|P,y<<16|x,this.unsigned)};De.subtract=function(i){return Yn(i)||(i=Ll(i)),this.add(i.neg())};De.sub=De.subtract;De.multiply=function(i){if(this.isZero())return this;if(Yn(i)||(i=Ll(i)),ja){var t=ja.mul(this.low,this.high,i.low,i.high);return Sr(t,ja.get_high(),this.unsigned)}if(i.isZero())return this.unsigned?Jc:Tl;if(this.eq(zo))return i.isOdd()?zo:Tl;if(i.eq(zo))return this.isOdd()?zo:Tl;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(_5)&&i.lt(_5))return Ua(this.toNumber()*i.toNumber(),this.unsigned);var e=this.high>>>16,r=this.high&65535,s=this.low>>>16,n=this.low&65535,c=i.high>>>16,l=i.high&65535,f=i.low>>>16,y=i.low&65535,x=0,T=0,P=0,M=0;return M+=n*y,P+=M>>>16,M&=65535,P+=s*y,T+=P>>>16,P&=65535,P+=n*f,T+=P>>>16,P&=65535,T+=r*y,x+=T>>>16,T&=65535,T+=s*f,x+=T>>>16,T&=65535,T+=n*l,x+=T>>>16,T&=65535,x+=e*y+r*f+s*l+n*c,x&=65535,Sr(P<<16|M,x<<16|T,this.unsigned)};De.mul=De.multiply;De.divide=function(i){if(Yn(i)||(i=Ll(i)),i.isZero())throw Error("division by zero");if(ja){if(!this.unsigned&&this.high===-2147483648&&i.low===-1&&i.high===-1)return this;var t=(this.unsigned?ja.div_u:ja.div_s)(this.low,this.high,i.low,i.high);return Sr(t,ja.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Jc:Tl;var e,r,s;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return Jc;if(i.gt(this.shru(1)))return iE;s=Jc}else{if(this.eq(zo)){if(i.eq(Ad)||i.eq(N_))return zo;if(i.eq(zo))return Ad;var n=this.shr(1);return e=n.div(i).shl(1),e.eq(Tl)?i.isNegative()?Ad:N_:(r=this.sub(i.mul(e)),s=e.add(r.div(i)),s)}else if(i.eq(zo))return this.unsigned?Jc:Tl;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();s=Tl}for(r=this;r.gte(i);){e=Math.max(1,Math.floor(r.toNumber()/i.toNumber()));for(var c=Math.ceil(Math.log(e)/Math.LN2),l=c<=48?1:ym(2,c-48),f=Ua(e),y=f.mul(i);y.isNegative()||y.gt(r);)e-=l,f=Ua(e,this.unsigned),y=f.mul(i);f.isZero()&&(f=Ad),s=s.add(f),r=r.sub(y)}return s};De.div=De.divide;De.modulo=function(i){if(Yn(i)||(i=Ll(i)),ja){var t=(this.unsigned?ja.rem_u:ja.rem_s)(this.low,this.high,i.low,i.high);return Sr(t,ja.get_high(),this.unsigned)}return this.sub(this.div(i).mul(i))};De.mod=De.modulo;De.rem=De.modulo;De.not=function(){return Sr(~this.low,~this.high,this.unsigned)};De.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};De.clz=De.countLeadingZeros;De.countTrailingZeros=function(){return this.low?p5(this.low):p5(this.high)+32};De.ctz=De.countTrailingZeros;De.and=function(i){return Yn(i)||(i=Ll(i)),Sr(this.low&i.low,this.high&i.high,this.unsigned)};De.or=function(i){return Yn(i)||(i=Ll(i)),Sr(this.low|i.low,this.high|i.high,this.unsigned)};De.xor=function(i){return Yn(i)||(i=Ll(i)),Sr(this.low^i.low,this.high^i.high,this.unsigned)};De.shiftLeft=function(i){return Yn(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?Sr(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):Sr(0,this.low<<i-32,this.unsigned)};De.shl=De.shiftLeft;De.shiftRight=function(i){return Yn(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?Sr(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):Sr(this.high>>i-32,this.high>=0?0:-1,this.unsigned)};De.shr=De.shiftRight;De.shiftRightUnsigned=function(i){return Yn(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?Sr(this.low>>>i|this.high<<32-i,this.high>>>i,this.unsigned):i===32?Sr(this.high,0,this.unsigned):Sr(this.high>>>i-32,0,this.unsigned)};De.shru=De.shiftRightUnsigned;De.shr_u=De.shiftRightUnsigned;De.rotateLeft=function(i){var t;return Yn(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?Sr(this.high,this.low,this.unsigned):i<32?(t=32-i,Sr(this.low<<i|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)):(i-=32,t=32-i,Sr(this.high<<i|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned))};De.rotl=De.rotateLeft;De.rotateRight=function(i){var t;return Yn(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?Sr(this.high,this.low,this.unsigned):i<32?(t=32-i,Sr(this.high<<t|this.low>>>i,this.low<<t|this.high>>>i,this.unsigned)):(i-=32,t=32-i,Sr(this.low<<t|this.high>>>i,this.high<<t|this.low>>>i,this.unsigned))};De.rotr=De.rotateRight;De.toSigned=function(){return this.unsigned?Sr(this.low,this.high,!1):this};De.toUnsigned=function(){return this.unsigned?this:Sr(this.low,this.high,!0)};De.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()};De.toBytesLE=function(){var i=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,i&255,i>>>8&255,i>>>16&255,i>>>24]};De.toBytesBE=function(){var i=this.high,t=this.low;return[i>>>24,i>>>16&255,i>>>8&255,i&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};zr.fromBytes=function(i,t,e){return e?zr.fromBytesLE(i,t):zr.fromBytesBE(i,t)};zr.fromBytesLE=function(i,t){return new zr(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,t)};zr.fromBytesBE=function(i,t){return new zr(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],t)};const VU=16;function nE(i){i==="X"&&(i="");const t=i.padEnd(VU,"0");return zr.fromString(t,!0,16)}function qU(i){if(i.isZero())return"X";let t=i.countTrailingZeros();const e=t%4;t=(t-e)/4;const r=t;t*=4;const s=i.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-r-s.length).join("0")+s}function HU(i,t){const e=WU(i).shiftRightUnsigned(2);return i.add(zr.fromNumber(2*t+1-4).multiply(e))}function WU(i){return i.and(i.not().add(1))}const JU=3,ZU=30,XU=2*ZU+1,v5=180/Math.PI;function $U(i){if(i.length===0)throw new Error("Invalid Hilbert quad key ".concat(i));const t=i.split("/"),e=parseInt(t[0],10),r=t[1],s=r.length;let n=0;const c=[0,0];for(let l=s-1;l>=0;l--){n=s-l;const f=r[l];let y=0,x=0;f==="1"?x=1:f==="2"?(y=1,x=1):f==="3"&&(y=1);const T=Math.pow(2,n-1);YU(T,c,y,x),c[0]+=T*y,c[1]+=T*x}if(e%2===1){const l=c[0];c[0]=c[1],c[1]=l}return{face:e,ij:c,level:n}}function KU(i){if(i.isZero())return"";let t=i.toString(2);for(;t.length<JU+XU;)t="0"+t;const e=t.lastIndexOf("1"),r=t.substring(0,3),s=t.substring(3,e),n=s.length/2,c=zr.fromString(r,!0,2).toString(10);let l="";if(n!==0)for(l=zr.fromString(s,!0,2).toString(4);l.length<n;)l="0"+l;return"".concat(c,"/").concat(l)}function oE(i,t,e){const r=1<<t;return[(i[0]+e[0])/r,(i[1]+e[1])/r]}function b5(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function aE(i){return[b5(i[0]),b5(i[1])]}function lE(i,t){let[e,r]=t;switch(i){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function cE(i){let[t,e,r]=i;const s=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*v5,s*v5]}function YU(i,t,e,r){if(r===0){e===1&&(t[0]=i-1-t[0],t[1]=i-1-t[1]);const s=t[0];t[0]=t[1],t[1]=s}}function QU(i){const t=oE(i.ij,i.level,[.5,.5]),e=aE(t),r=lE(i.face,e);return cE(r)}const tG=100;function w5(i){const{face:t,ij:e,level:r}=i,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(tG*Math.pow(2,-r))),c=new Float64Array(4*n*2+2);let l=0,f=0;for(let y=0;y<4;y++){const x=s[y].slice(0),T=s[y+1],P=(T[0]-x[0])/n,M=(T[1]-x[1])/n;for(let N=0;N<n;N++){x[0]+=P,x[1]+=M;const G=oE(e,r,x),Z=aE(G),X=lE(t,Z),$=cE(X);Math.abs($[1])>89.999&&($[0]=f);const ct=$[0]-f;$[0]+=ct>180?-360:ct<-180?360:0,c[l++]=$[0],c[l++]=$[1],f=$[0]}}return c[l++]=c[0],c[l++]=c[1],c}function bv(i){const t=eG(i);return $U(t)}function eG(i){if(i.indexOf("/")>0)return i;const t=nE(i);return KU(t)}function iG(i){const t=bv(i);return QU(t)}function rG(i){let t;if(i.face===2||i.face===5){let e=null,r=0;for(let s=0;s<4;s++){const n="".concat(i.face,"/").concat(s),c=bv(n),l=w5(c);(typeof e>"u"||e===null)&&(e=new Float64Array(4*l.length)),e.set(l,r),r+=l.length}t=x5(e)}else{const e=w5(i);t=x5(e)}return t}function x5(i){if(i.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let r=0;r<i.length;r+=2)t.push(i[r]),e.push(i[r+1]);return t.sort((r,s)=>r-s),e.sort((r,s)=>r-s),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function sG(i,t){const e=(t==null?void 0:t.minimumHeight)||0,r=(t==null?void 0:t.maximumHeight)||0,s=bv(i),n=rG(s),c=n.west,l=n.south,f=n.east,y=n.north,x=[];return x.push(new re(c,y,e)),x.push(new re(f,y,e)),x.push(new re(f,l,e)),x.push(new re(c,l,e)),x.push(new re(c,y,r)),x.push(new re(f,y,r)),x.push(new re(f,l,r)),x.push(new re(c,l,r)),x}function hE(i){const t=i.token,e={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},r=sG(t,e),s=iG(t),n=s[0],c=s[1],l=ws.WGS84.cartographicToCartesian([n,c,e.maximumHeight]),f=new re(l[0],l[1],l[2]);r.push(f);const y=MF(r);return[...y.center,...y.halfAxes]}const nG=4,oG=8,aG={QUADTREE:nG,OCTREE:oG};function lG(i,t,e){if(i!=null&&i.box){const r=nE(i.s2VolumeInfo.token),s=HU(r,t),n=qU(s),c={...i.s2VolumeInfo};switch(c.token=n,e){case"OCTREE":const l=i.s2VolumeInfo,f=l.maximumHeight-l.minimumHeight,y=f/2,x=l.minimumHeight+f/2;l.minimumHeight=x-y,l.maximumHeight=x+y;break}return{box:hE(c),s2VolumeInfo:c}}}async function uE(i){const{options:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:s={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:n}=i;let{subtree:c,level:l=0}=i;const{subdivisionScheme:f,subtreeLevels:y,maximumLevel:x,contentUrlTemplate:T,subtreesUriTemplate:P,basePath:M}=t,N={children:[],lodMetricValue:0,contentUrl:""},G=aG[f],Z=r&1,X=r>>1&1,$=r>>2&1,ct=(G**l-1)/(G-1);let yt=mu(e.mortonIndex,r),Mt=ct+yt,Nt=mu(e.x,Z),Rt=mu(e.y,X),xt=mu(e.z,$),qt=!1;l+1>y&&(qt=Ry(c.childSubtreeAvailability,yt));const zt=mu(s.x,Nt),ot=mu(s.y,Rt),dt=mu(s.z,xt),Lt=l+s.level;if(qt){const oe="".concat(M,"/").concat(P),de=F_(oe,Lt,zt,ot,dt);c=await Vh(de,tE),s.mortonIndex=yt,s.x=Nt,s.y=Rt,s.z=xt,s.level=l,yt=0,Mt=0,Nt=0,Rt=0,xt=0,l=0}if(!Ry(c.tileAvailability,Mt)||l>x)return N;Ry(c.contentAvailability,Mt)&&(N.contentUrl=F_(T,Lt,zt,ot,dt));const wt=l+1,le={mortonIndex:yt,x:Nt,y:Rt,z:xt};for(let oe=0;oe<G;oe++){const de=lG(n,oe,f),te=await uE({subtree:c,options:t,parentData:le,childIndex:oe,level:wt,globalData:s,s2VolumeBox:de});if(te.contentUrl||te.children.length){const me=Lt+1,ge=cG(te,me,{childTileX:Nt,childTileY:Rt,childTileZ:xt},t,n);N.children.push(ge)}}return N}function Ry(i,t){return"constant"in i?!!i.constant:i.explicitBitstream?dG(t,i.explicitBitstream):!1}function cG(i,t,e,r,s){const{basePath:n,refine:c,getRefine:l,lodMetricType:f,getTileType:y,rootLodMetricValue:x,rootBoundingVolume:T}=r,P=i.contentUrl&&i.contentUrl.replace("".concat(n,"/"),""),M=x/2**t,N=s!=null&&s.box?{box:s.box}:T,G=hG(t,N,e);return{children:i.children,contentUrl:i.contentUrl,content:{uri:P},id:i.contentUrl,refine:l(c),type:y(i),lodMetricType:f,lodMetricValue:M,geometricError:M,transform:i.transform,boundingVolume:G}}function hG(i,t,e){if(t.region){const{childTileX:r,childTileY:s,childTileZ:n}=e,[c,l,f,y,x,T]=t.region,P=2**i,M=(f-c)/P,N=(y-l)/P,G=(T-x)/P,[Z,X]=[c+M*r,c+M*(r+1)],[$,ct]=[l+N*s,l+N*(s+1)],[yt,Mt]=[x+G*n,x+G*(n+1)];return{region:[Z,$,X,ct,yt,Mt]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function mu(i,t){return parseInt(i.toString(2)+t.toString(2),2)}function F_(i,t,e,r,s){const n=uG({level:t,x:e,y:r,z:s});return i.replace(/{level}|{x}|{y}|{z}/gi,c=>n[c])}function uG(i){const t={};for(const e in i)t["{".concat(e,"}")]=i[e];return t}function dG(i,t){const e=Math.floor(i/8),r=i%8;return(t[e]>>r&1)===1}function wv(i){if(!i.contentUrl)return Id.EMPTY;const t=i.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return Id.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Id.SCENEGRAPH;default:return t}}function xv(i){switch(i){case"REPLACE":case"replace":return Xc.REPLACE;case"ADD":case"add":return Xc.ADD;default:return i}}function z_(i,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const e=new URL(i,"".concat(t,"/"));return decodeURI(e.toString())}else if(i.startsWith("/"))return i;return"".concat(t,"/").concat(i)}function A5(i,t){if(!i)return null;if(i.content){const e=i.content.uri||i.content.url;i.contentUrl=z_(e,t.basePath)}return i.id=i.contentUrl,i.lodMetricType=Bm.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform,i.type=wv(i),i.refine=xv(i.refine),i}async function pG(i,t){const e=i.basePath;let r;const s=E5(i==null?void 0:i.root);s&&i.root?r=await S5(i.root,i,s,t):r=A5(i.root,i);const n=[];for(n.push(r);n.length>0;){const c=(n.pop()||{}).children||[];for(let l of c){const f=E5(l);f?l=await S5(l,i,f,t):A5(l,{basePath:e}),n.push(l)}}return r}async function S5(i,t,e,r){var s,n;const c=t.basePath,{subdivisionScheme:l,maximumLevel:f,subtreeLevels:y,subtrees:{uri:x}}=e,T=F_(x,0,0,0,0),P=z_(T,c),M=await Vh(P,tE,r),N=z_(i.content.uri,c),G=t==null||(s=t.root)===null||s===void 0?void 0:s.refine,Z=i.geometricError,X=(n=i.boundingVolume.extensions)===null||n===void 0?void 0:n["3DTILES_bounding_volume_S2"];if(X){const yt={box:hE(X),s2VolumeInfo:X};i.boundingVolume=yt}const $=i.boundingVolume,ct={contentUrlTemplate:N,subtreesUriTemplate:x,subdivisionScheme:l,subtreeLevels:y,maximumLevel:f,refine:G,basePath:c,lodMetricType:Bm.GEOMETRIC_ERROR,rootLodMetricValue:Z,rootBoundingVolume:$,getTileType:wv,getRefine:xv};return await fG(i,M,ct)}async function fG(i,t,e){if(!i)return null;i.lodMetricType=Bm.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform;const{children:r,contentUrl:s}=await uE({subtree:t,options:e,s2VolumeBox:i});return s&&(i.contentUrl=s,i.content={uri:s.replace("".concat(e.basePath,"/"),"")}),i.refine=xv(i.refine),i.type=wv(i),i.children=r,i.id=i.contentUrl,i}function E5(i){var t;return(i==null||(t=i.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(i==null?void 0:i.implicitTiling)}const Av={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:WS,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:_G,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function gG(i){return p1(i.url)}async function mG(i,t,e){const r={content:{featureIds:null}};return await QS(i,0,t,e,r.content),r.content}async function yG(i,t,e){var r;const s=JSON.parse(new TextDecoder().decode(i));return s.loader=t.loader||Av,s.url=e.url,s.queryString=e.queryString,s.basePath=gG(s),s.root=await pG(s,t),s.type=Oa.TILES3D,s.lodMetricType=Bm.GEOMETRIC_ERROR,s.lodMetricValue=((r=s.root)===null||r===void 0?void 0:r.lodMetricValue)||0,s}async function _G(i,t,e){const r=t["3d-tiles"]||{};let s;return r.isTileset==="auto"?s=e.url&&e.url.indexOf(".json")!==-1:s=r.isTileset,s?i=await yG(i,t,e):i=await mG(i,t,e),i}const C5=[0],vG={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Av,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,t,e)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class Sv extends pS{constructor(){super(...arguments),H(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&vr.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,e;return!!(!((t=this.state)===null||t===void 0||(e=t.tileset3d)===null||e===void 0)&&e.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){let{props:e,oldProps:r,changeFlags:s}=t;if(e.data&&e.data!==r.data&&this._loadTileset(e.data),s.viewportChanged){const{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(s.propsChanged){const{layerMap:n}=this.state;for(const c in n)n[c].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:r}=this.state;this.internalState.viewport=t,e[t.id]=t;const s=r==null?void 0:r[t.id];(!s||!t.equals(s))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:e,sourceLayer:r}=t;const s=r&&r.props.tile;return e.picked&&(e.object=s),e.sourceTile=s,e}filterSubLayer(t){let{layer:e,viewport:r}=t;const{tile:s}=e.props,{id:n}=r;return s.selected&&s.viewportIds.includes(n)}_updateAutoHighlight(t){const e=t.sourceTile,r=this.state.layerMap[e==null?void 0:e.id];r&&r.layer&&r.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const s={loadOptions:{...e}};let n=t;if(r.preload){const f=await r.preload(t,e);f.url&&(n=f.url),f.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:f.headers}),Object.assign(s,f)}const c=await Vh(n,r,s.loadOptions),l=new Yj(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:l,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(l)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:r}=this.context,s=Object.keys(t).length;!r||!s||!e||e.selectTiles(Object.values(t)).then(n=>{this.state.frameNumber!==n&&this.setState({frameNumber:n})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case Id.POINTCLOUD:return this._makePointCloudLayer(t,e);case Id.SCENEGRAPH:return this._make3DModelLayer(t);case Id.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:r,pointCount:s,constantRGBA:n,cartographicOrigin:c,modelMatrix:l}=t.content,{positions:f,normals:y,colors:x}=r;if(!f)return null;const T=e&&e.props.data||{header:{vertexCount:s},attributes:{POSITION:f,NORMAL:y,COLOR_0:x}},{pointSize:P,getPointColor:M}=this.props,N=this.getSubLayerClass("pointcloud",ov);return new N({pointSize:P},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:T,coordinateSystem:mr.METER_OFFSETS,coordinateOrigin:c,modelMatrix:l,getColor:n||M,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:r,cartographicOrigin:s,modelMatrix:n}=t.content,c=this.getSubLayerClass("scenegraph",fv);return new c({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:r||C5,scenegraph:e,coordinateSystem:mr.METER_OFFSETS,coordinateOrigin:s,modelMatrix:n,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const r=t.content,{attributes:s,indices:n,modelMatrix:c,cartographicOrigin:l,coordinateSystem:f=mr.METER_OFFSETS,material:y,featureIds:x}=r,{_getMeshColor:T}=this.props,P=e&&e.props.mesh||new Wp({drawMode:4,attributes:bG(s),indices:n}),M=this.getSubLayerClass("mesh",gv);return new M(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:P,data:C5,getColor:T(t),pbrMaterial:y,modelMatrix:c,coordinateOrigin:l,coordinateSystem:f,featureIds:x,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(r=>{const s=e[r.id]=e[r.id]||{tile:r};let{layer:n}=s;return r.selected&&(n?s.needsUpdate&&(n=this._getSubLayer(r,n),s.needsUpdate=!1):n=this._getSubLayer(r)),s.layer=n,n}).filter(Boolean):null}}H(Sv,"defaultProps",vG);H(Sv,"layerName","Tile3DLayer");function bG(i){const t={};return t.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(t.normals=i.normals),i.texCoords&&(t.texCoords=i.texCoords),i.colors&&(t.colors=i.colors),i.uvRegions&&(t.uvRegions=i.uvRegions),t}var wG=Object.defineProperty,xG=(i,t,e)=>t in i?wG(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Br=(i,t,e)=>(xG(i,typeof t!="symbol"?t+"":t,e),e);class AG{constructor(t){Br(this,"map"),Br(this,"width"),Br(this,"height"),Br(this,"svgCanvas"),Br(this,"xLine"),Br(this,"yLine"),Br(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,e;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(e=this.map)==null?void 0:e.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,e=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${e}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${e}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="relative",e.setAttribute("width",`${this.width}px`),e.setAttribute("height",`${this.height}px`);const r=this.width/2,s=this.height/2;this.yLine=e.appendChild(this.createLine(r,0,r,this.height,this.color,"2px")),this.xLine=e.appendChild(this.createLine(0,s,this.width,s,this.color,"2px")),t==null||t.appendChild(e),this.svgCanvas=e}}createLine(t,e,r,s,n,c){const l=document.createElementNS("http://www.w3.org/2000/svg","line");return l.setAttribute("x1",t),l.setAttribute("y1",e),l.setAttribute("x2",r),l.setAttribute("y2",s),l.setAttribute("stroke-dasharray","5,5"),l.setAttribute("stroke",n),l.setAttribute("stroke-width",c),l}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const j_={72:72,96:96,200:200,300:300,400:400},Vc={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},zp={Landscape:"landscape",Portrait:"portrait"},Eu={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Hd={in:"in",mm:"mm"};class SG{constructor(t){Br(this,"map"),Br(this,"width"),Br(this,"height"),Br(this,"unit"),Br(this,"svgCanvas"),Br(this,"svgPath");var e,r,s;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const n=(e=this.map)==null?void 0:e.getCanvas().clientWidth,c=(r=this.map)==null?void 0:r.getCanvas().clientHeight,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.setAttribute("width",`${n}px`),l.setAttribute("height",`${c}px`);const f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("style","fill:#888888;stroke-width:0"),f.setAttribute("fill-opacity","0.5"),l.append(f),(s=this.map)==null||s.getCanvasContainer().appendChild(l),this.svgCanvas=l,this.svgPath=f}mapResize(){this.generateCutOut()}updateArea(t,e){this.width=t,this.height=e,this.unit=Hd.mm,this.generateCutOut()}generateCutOut(){var t,e;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const r=this.toPixels(this.width),s=this.toPixels(this.height),n=(t=this.map)==null?void 0:t.getCanvas().clientWidth,c=(e=this.map)==null?void 0:e.getCanvas().clientHeight,l=n/2-r/2,f=l+r,y=c/2-s/2,x=y+s;this.svgCanvas.setAttribute("width",`${n}px`),this.svgCanvas.setAttribute("height",`${c}px`),this.svgPath.setAttribute("d",`M 0 0 L ${n} 0 L ${n} ${c} L 0 ${c} M ${l} ${y} L ${l} ${x} L ${f} ${x} L ${f} ${y}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Hd.mm&&(e/=25.4),e*t}}const T5={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English"},EG={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"French"},CG={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Finish"},TG={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"German"},PG={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Swedish"},IG={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Spanish"},MG={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Vietnam"},LG={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"Ukranian"},BG={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"Chinese simplified"},RG={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"Chinese traditional"},kG={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"Japanese"},OG=i=>{switch(i){case"de":return TG;case"en":return T5;case"fr":return EG;case"fi":return CG;case"sv":return PG;case"es":return IG;case"vi":return MG;case"uk":return LG;case"zhHans":return BG;case"zhHant":return RG;case"ja":return kG;default:return T5}};(function(i){var t={};function e(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return i[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=i,e.c=t,e.d=function(r,s,n){e.o(r,s)||Object.defineProperty(r,s,{enumerable:!0,get:n})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,s){if(1&s&&(r=e(r)),8&s||4&s&&typeof r=="object"&&r&&r.__esModule)return r;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&s&&typeof r!="string")for(var c in r)e.d(n,c,(function(l){return r[l]}).bind(null,c));return n},e.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(s,"a",s),s},e.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},e.p="",e(e.s=0)})([function(i,t,e){i.exports=e(1)},function(i,t){function e(s,n){for(var c=0;c<n.length;c++){var l=n[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}var r=function(){function s(){(function(l,f){if(!(l instanceof f))throw new TypeError("Cannot call a class as a function")})(this,s),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var n,c;return n=s,(c=[{key:"show",value:function(l){this.setOptions(l),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var l=document.getElementById("loading-overlay-stylesheet");l&&(l.disabled=!0,l.parentNode.removeChild(l),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(l){if(l!==void 0)for(var f in l)this.options[f]=l[f]}},{key:"generateAndAddOverlayElement",value:function(){var l="50%";this.options.offsetX!==0&&(l="calc(50% + "+this.options.offsetX+")");var f="50%";if(this.options.offsetY!==0&&(f="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var y='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(f,"; left: ").concat(l,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),x=document.getElementById(this.options.containerID);return x.style.position="relative",void x.insertAdjacentHTML("beforeend",y)}var T='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(f,"; left: ").concat(l,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",T)}},{key:"generateSpinnerElement",value:function(){var l=this,f=Object.keys(this.numberOfEmptyDivForSpinner).find(function(x){return x===l.options.spinnerIcon}),y=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[f]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(y,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var l=document.createElement("link");l.setAttribute("id","loading-overlay-stylesheet"),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(l)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(l){for(var f="",y=1;y<=l;y++)f+="<div></div>";return f}}])&&e(n.prototype,c),s}();window.JsLoadingOverlay=new r,i.exports=JsLoadingOverlay}]);function Fr(i){"@babel/helpers - typeof";return Fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fr(i)}var xo=Uint8Array,Ao=Uint16Array,af=Uint32Array,Om=new xo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dm=new xo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),U_=new xo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dE=function(i,t){for(var e=new Ao(31),r=0;r<31;++r)e[r]=t+=1<<i[r-1];for(var s=new af(e[30]),r=1;r<30;++r)for(var n=e[r];n<e[r+1];++n)s[n]=n-e[r]<<5|r;return[e,s]},pE=dE(Om,2),fE=pE[0],G_=pE[1];fE[28]=258,G_[258]=28;var gE=dE(Dm,0),DG=gE[0],P5=gE[1],V_=new Ao(32768);for(var cs=0;cs<32768;++cs){var Rh=(cs&43690)>>>1|(cs&21845)<<1;Rh=(Rh&52428)>>>2|(Rh&13107)<<2,Rh=(Rh&61680)>>>4|(Rh&3855)<<4,V_[cs]=((Rh&65280)>>>8|(Rh&255)<<8)>>>1}var uc=function(i,t,e){for(var r=i.length,s=0,n=new Ao(t);s<r;++s)++n[i[s]-1];var c=new Ao(t);for(s=0;s<t;++s)c[s]=c[s-1]+n[s-1]<<1;var l;if(e){l=new Ao(1<<t);var f=15-t;for(s=0;s<r;++s)if(i[s])for(var y=s<<4|i[s],x=t-i[s],T=c[i[s]-1]++<<x,P=T|(1<<x)-1;T<=P;++T)l[V_[T]>>>f]=y}else for(l=new Ao(r),s=0;s<r;++s)l[s]=V_[c[i[s]-1]++]>>>15-i[s];return l},Hh=new xo(288);for(var cs=0;cs<144;++cs)Hh[cs]=8;for(var cs=144;cs<256;++cs)Hh[cs]=9;for(var cs=256;cs<280;++cs)Hh[cs]=7;for(var cs=280;cs<288;++cs)Hh[cs]=8;var lf=new xo(32);for(var cs=0;cs<32;++cs)lf[cs]=5;var NG=uc(Hh,9,0),FG=uc(Hh,9,1),zG=uc(lf,5,0),jG=uc(lf,5,1),ky=function(i){for(var t=i[0],e=1;e<i.length;++e)i[e]>t&&(t=i[e]);return t},bl=function(i,t,e){var r=t/8>>0;return(i[r]|i[r+1]<<8)>>>(t&7)&e},Oy=function(i,t){var e=t/8>>0;return(i[e]|i[e+1]<<8|i[e+2]<<16)>>>(t&7)},Ev=function(i){return(i/8>>0)+(i&7&&1)},mE=function(i,t,e){(t==null||t<0)&&(t=0),(e==null||e>i.length)&&(e=i.length);var r=new(i instanceof Ao?Ao:i instanceof af?af:xo)(e-t);return r.set(i.subarray(t,e)),r},UG=function(i,t,e){var r=i.length,s=!t||e,n=!e||e.i;e||(e={}),t||(t=new xo(r*3));var c=function(Xt){var Kt=t.length;if(Xt>Kt){var ie=new xo(Math.max(Kt*2,Xt));ie.set(t),t=ie}},l=e.f||0,f=e.p||0,y=e.b||0,x=e.l,T=e.d,P=e.m,M=e.n,N=r*8;do{if(!x){e.f=l=bl(i,f,1);var G=bl(i,f+1,3);if(f+=3,G)if(G==1)x=FG,T=jG,P=9,M=5;else if(G==2){var Z=bl(i,f,31)+257,X=bl(i,f+10,15)+4,$=Z+bl(i,f+5,31)+1;f+=14;for(var ct=new xo($),yt=new xo(19),Mt=0;Mt<X;++Mt)yt[U_[Mt]]=bl(i,f+Mt*3,7);f+=X*3;var Nt=ky(yt),Rt=(1<<Nt)-1;if(!n&&f+$*(Nt+7)>N)break;for(var xt=uc(yt,Nt,1),Mt=0;Mt<$;){var qt=xt[bl(i,f,Rt)];f+=qt&15;var zt=qt>>>4;if(zt<16)ct[Mt++]=zt;else{var ot=0,dt=0;for(zt==16?(dt=3+bl(i,f,3),f+=2,ot=ct[Mt-1]):zt==17?(dt=3+bl(i,f,7),f+=3):zt==18&&(dt=11+bl(i,f,127),f+=7);dt--;)ct[Mt++]=ot}}var Lt=ct.subarray(0,Z),wt=ct.subarray(Z);P=ky(Lt),M=ky(wt),x=uc(Lt,P,1),T=uc(wt,M,1)}else throw"invalid block type";else{var zt=Ev(f)+4,le=i[zt-4]|i[zt-3]<<8,oe=zt+le;if(oe>r){if(n)throw"unexpected EOF";break}s&&c(y+le),t.set(i.subarray(zt,oe),y),e.b=y+=le,e.p=f=oe*8;continue}if(f>N)throw"unexpected EOF"}s&&c(y+131072);for(var de=(1<<P)-1,te=(1<<M)-1,me=P+M+18;n||f+me<N;){var ot=x[Oy(i,f)&de],ge=ot>>>4;if(f+=ot&15,f>N)throw"unexpected EOF";if(!ot)throw"invalid length/literal";if(ge<256)t[y++]=ge;else if(ge==256){x=null;break}else{var ke=ge-254;if(ge>264){var Mt=ge-257,it=Om[Mt];ke=bl(i,f,(1<<it)-1)+fE[Mt],f+=it}var Et=T[Oy(i,f)&te],It=Et>>>4;if(!Et)throw"invalid distance";f+=Et&15;var wt=DG[It];if(It>3){var it=Dm[It];wt+=Oy(i,f)&(1<<it)-1,f+=it}if(f>N)throw"unexpected EOF";s&&c(y+131072);for(var Ut=y+ke;y<Ut;y+=4)t[y]=t[y-wt],t[y+1]=t[y+1-wt],t[y+2]=t[y+2-wt],t[y+3]=t[y+3-wt];y=Ut}}e.l=x,e.p=f,e.b=y,x&&(l=1,e.m=P,e.d=T,e.n=M)}while(!l);return y==t.length?t:mE(t,0,y)},Uc=function(i,t,e){e<<=t&7;var r=t/8>>0;i[r]|=e,i[r+1]|=e>>>8},Bp=function(i,t,e){e<<=t&7;var r=t/8>>0;i[r]|=e,i[r+1]|=e>>>8,i[r+2]|=e>>>16},Dy=function(i,t){for(var e=[],r=0;r<i.length;++r)i[r]&&e.push({s:r,f:i[r]});var s=e.length,n=e.slice();if(!s)return[new xo(0),0];if(s==1){var c=new xo(e[0].s+1);return c[e[0].s]=1,[c,1]}e.sort(function(Mt,Nt){return Mt.f-Nt.f}),e.push({s:-1,f:25001});var l=e[0],f=e[1],y=0,x=1,T=2;for(e[0]={s:-1,f:l.f+f.f,l,r:f};x!=s-1;)l=e[e[y].f<e[T].f?y++:T++],f=e[y!=x&&e[y].f<e[T].f?y++:T++],e[x++]={s:-1,f:l.f+f.f,l,r:f};for(var P=n[0].s,r=1;r<s;++r)n[r].s>P&&(P=n[r].s);var M=new Ao(P+1),N=q_(e[x-1],M,0);if(N>t){var r=0,G=0,Z=N-t,X=1<<Z;for(n.sort(function(Nt,Rt){return M[Rt.s]-M[Nt.s]||Nt.f-Rt.f});r<s;++r){var $=n[r].s;if(M[$]>t)G+=X-(1<<N-M[$]),M[$]=t;else break}for(G>>>=Z;G>0;){var ct=n[r].s;M[ct]<t?G-=1<<t-M[ct]++-1:++r}for(;r>=0&&G;--r){var yt=n[r].s;M[yt]==t&&(--M[yt],++G)}N=t}return[new xo(M),N]},q_=function(i,t,e){return i.s==-1?Math.max(q_(i.l,t,e+1),q_(i.r,t,e+1)):t[i.s]=e},I5=function(i){for(var t=i.length;t&&!i[--t];);for(var e=new Ao(++t),r=0,s=i[0],n=1,c=function(f){e[r++]=f},l=1;l<=t;++l)if(i[l]==s&&l!=t)++n;else{if(!s&&n>2){for(;n>138;n-=138)c(32754);n>2&&(c(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(c(s),--n;n>6;n-=6)c(8304);n>2&&(c(n-3<<5|8208),n=0)}for(;n--;)c(s);n=1,s=i[l]}return[e.subarray(0,r),t]},Rp=function(i,t){for(var e=0,r=0;r<t.length;++r)e+=i[r]*t[r];return e},jg=function(i,t,e){var r=e.length,s=Ev(t+2);i[s]=r&255,i[s+1]=r>>>8,i[s+2]=i[s]^255,i[s+3]=i[s+1]^255;for(var n=0;n<r;++n)i[s+n+4]=e[n];return(s+4+r)*8},M5=function(i,t,e,r,s,n,c,l,f,y,x){Uc(t,x++,e),++s[256];for(var T=Dy(s,15),P=T[0],M=T[1],N=Dy(n,15),G=N[0],Z=N[1],X=I5(P),$=X[0],ct=X[1],yt=I5(G),Mt=yt[0],Nt=yt[1],Rt=new Ao(19),xt=0;xt<$.length;++xt)Rt[$[xt]&31]++;for(var xt=0;xt<Mt.length;++xt)Rt[Mt[xt]&31]++;for(var qt=Dy(Rt,7),zt=qt[0],ot=qt[1],dt=19;dt>4&&!zt[U_[dt-1]];--dt);var Lt=y+5<<3,wt=Rp(s,Hh)+Rp(n,lf)+c,le=Rp(s,P)+Rp(n,G)+c+14+3*dt+Rp(Rt,zt)+(2*Rt[16]+3*Rt[17]+7*Rt[18]);if(Lt<=wt&&Lt<=le)return jg(t,x,i.subarray(f,f+y));var oe,de,te,me;if(Uc(t,x,1+(le<wt)),x+=2,le<wt){oe=uc(P,M,0),de=P,te=uc(G,Z,0),me=G;var ge=uc(zt,ot,0);Uc(t,x,ct-257),Uc(t,x+5,Nt-1),Uc(t,x+10,dt-4),x+=14;for(var xt=0;xt<dt;++xt)Uc(t,x+3*xt,zt[U_[xt]]);x+=3*dt;for(var ke=[$,Mt],it=0;it<2;++it)for(var Et=ke[it],xt=0;xt<Et.length;++xt){var It=Et[xt]&31;Uc(t,x,ge[It]),x+=zt[It],It>15&&(Uc(t,x,Et[xt]>>>5&127),x+=Et[xt]>>>12)}}else oe=NG,de=Hh,te=zG,me=lf;for(var xt=0;xt<l;++xt)if(r[xt]>255){var It=r[xt]>>>18&31;Bp(t,x,oe[It+257]),x+=de[It+257],It>7&&(Uc(t,x,r[xt]>>>23&31),x+=Om[It]);var Ut=r[xt]&31;Bp(t,x,te[Ut]),x+=me[Ut],Ut>3&&(Bp(t,x,r[xt]>>>5&8191),x+=Dm[Ut])}else Bp(t,x,oe[r[xt]]),x+=de[r[xt]];return Bp(t,x,oe[256]),x+de[256]},GG=new af([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),VG=new xo(0),qG=function(i,t,e,r,s,n){var c=i.length,l=new xo(r+c+5*(1+Math.floor(c/7e3))+s),f=l.subarray(r,l.length-s),y=0;if(!t||c<8)for(var x=0;x<=c;x+=65535){var T=x+65535;T<c?y=jg(f,y,i.subarray(x,T)):(f[x]=n,y=jg(f,y,i.subarray(x,c)))}else{for(var P=GG[t-1],M=P>>>13,N=P&8191,G=(1<<e)-1,Z=new Ao(32768),X=new Ao(G+1),$=Math.ceil(e/3),ct=2*$,yt=function(Xe){return(i[Xe]^i[Xe+1]<<$^i[Xe+2]<<ct)&G},Mt=new af(25e3),Nt=new Ao(288),Rt=new Ao(32),xt=0,qt=0,x=0,zt=0,ot=0,dt=0;x<c;++x){var Lt=yt(x),wt=x&32767,le=X[Lt];if(Z[wt]=le,X[Lt]=wt,ot<=x){var oe=c-x;if((xt>7e3||zt>24576)&&oe>423){y=M5(i,f,0,Mt,Nt,Rt,qt,zt,dt,x-dt,y),zt=xt=qt=0,dt=x;for(var de=0;de<286;++de)Nt[de]=0;for(var de=0;de<30;++de)Rt[de]=0}var te=2,me=0,ge=N,ke=wt-le&32767;if(oe>2&&Lt==yt(x-ke))for(var it=Math.min(M,oe)-1,Et=Math.min(32767,x),It=Math.min(258,oe);ke<=Et&&--ge&&wt!=le;){if(i[x+te]==i[x+te-ke]){for(var Ut=0;Ut<It&&i[x+Ut]==i[x+Ut-ke];++Ut);if(Ut>te){if(te=Ut,me=ke,Ut>it)break;for(var Xt=Math.min(ke,Ut-2),Kt=0,de=0;de<Xt;++de){var ie=x-ke+de+32768&32767,Qt=Z[ie],Ae=ie-Qt+32768&32767;Ae>Kt&&(Kt=Ae,le=ie)}}}wt=le,le=Z[wt],ke+=wt-le+32768&32767}if(me){Mt[zt++]=268435456|G_[te]<<18|P5[me];var Le=G_[te]&31,Fe=P5[me]&31;qt+=Om[Le]+Dm[Fe],++Nt[257+Le],++Rt[Fe],ot=x+te,++xt}else Mt[zt++]=i[x],++Nt[i[x]]}}y=M5(i,f,n,Mt,Nt,Rt,qt,zt,dt,x-dt,y),n||(y=jg(f,y,VG))}return mE(l,0,r+Ev(y)+s)},HG=function(){var i=1,t=0;return{p:function(e){for(var r=i,s=t,n=e.length,c=0;c!=n;){for(var l=Math.min(c+5552,n);c<l;++c)r+=e[c],s+=r;r%=65521,s%=65521}i=r,t=s},d:function(){return(i>>>8<<16|(t&255)<<8|t>>>8)+((i&255)<<23)*2}}},WG=function(i,t,e,r,s){return qG(i,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+t.mem,e,r,!s)},JG=function(i,t,e){for(;e;++t)i[t]=e,e>>>=8},ZG=function(i,t){var e=t.level,r=e==0?0:e<6?1:e==9?3:2;i[0]=120,i[1]=r<<6|(r?32-2*r:1)},XG=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function H_(i,t){t===void 0&&(t={});var e=HG();e.p(i);var r=WG(i,t,2,4);return ZG(r,t),JG(r,r.length-4,e.d()),r}function $G(i,t){return UG((XG(i),i.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Oi=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function Ny(){Oi.console&&typeof Oi.console.log=="function"&&Oi.console.log.apply(Oi.console,arguments)}var Yr={log:Ny,warn:function(i){Oi.console&&(typeof Oi.console.warn=="function"?Oi.console.warn.apply(Oi.console,arguments):Ny.call(null,arguments))},error:function(i){Oi.console&&(typeof Oi.console.error=="function"?Oi.console.error.apply(Oi.console,arguments):Ny(i))}};function Fy(i,t,e){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){vu(r.response,t,e)},r.onerror=function(){Yr.error("could not download file")},r.send()}function L5(i){var t=new XMLHttpRequest;t.open("HEAD",i,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Sg(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(t)}}var Zp,W_,vu=Oi.saveAs||((typeof window>"u"?"undefined":Fr(window))!=="object"||window!==Oi?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,t,e){var r=Oi.URL||Oi.webkitURL,s=document.createElement("a");t=t||i.name||"download",s.download=t,s.rel="noopener",typeof i=="string"?(s.href=i,s.origin!==location.origin?L5(s.href)?Fy(i,t,e):Sg(s,s.target="_blank"):Sg(s)):(s.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(s.href)},4e4),setTimeout(function(){Sg(s)},0))}:"msSaveOrOpenBlob"in navigator?function(i,t,e){if(t=t||i.name||"download",typeof i=="string")if(L5(i))Fy(i,t,e);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){Sg(r)})}else navigator.msSaveOrOpenBlob(function(s,n){return n===void 0?n={autoBom:!1}:Fr(n)!=="object"&&(Yr.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}(i,e),t)}:function(i,t,e,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return Fy(i,t,e);var s=i.type==="application/octet-stream",n=/constructor/i.test(Oi.HTMLElement)||Oi.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&n)&&(typeof FileReader>"u"?"undefined":Fr(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var x=l.result;x=c?x:x.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=x:location=x,r=null},l.readAsDataURL(i)}else{var f=Oi.URL||Oi.webkitURL,y=f.createObjectURL(i);r?r.location=y:location.href=y,r=null,setTimeout(function(){f.revokeObjectURL(y)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function yE(i){var t;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],r=0;r<e.length;r++){var s=e[r].re,n=e[r].process,c=s.exec(i);c&&(t=n(c),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),f=this.g.toString(16),y=this.b.toString(16);return l.length==1&&(l="0"+l),f.length==1&&(f="0"+f),y.length==1&&(y="0"+y),"#"+l+f+y}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function zy(i,t){var e=i[0],r=i[1],s=i[2],n=i[3];e=Wn(e,r,s,n,t[0],7,-680876936),n=Wn(n,e,r,s,t[1],12,-389564586),s=Wn(s,n,e,r,t[2],17,606105819),r=Wn(r,s,n,e,t[3],22,-1044525330),e=Wn(e,r,s,n,t[4],7,-176418897),n=Wn(n,e,r,s,t[5],12,1200080426),s=Wn(s,n,e,r,t[6],17,-1473231341),r=Wn(r,s,n,e,t[7],22,-45705983),e=Wn(e,r,s,n,t[8],7,1770035416),n=Wn(n,e,r,s,t[9],12,-1958414417),s=Wn(s,n,e,r,t[10],17,-42063),r=Wn(r,s,n,e,t[11],22,-1990404162),e=Wn(e,r,s,n,t[12],7,1804603682),n=Wn(n,e,r,s,t[13],12,-40341101),s=Wn(s,n,e,r,t[14],17,-1502002290),e=Jn(e,r=Wn(r,s,n,e,t[15],22,1236535329),s,n,t[1],5,-165796510),n=Jn(n,e,r,s,t[6],9,-1069501632),s=Jn(s,n,e,r,t[11],14,643717713),r=Jn(r,s,n,e,t[0],20,-373897302),e=Jn(e,r,s,n,t[5],5,-701558691),n=Jn(n,e,r,s,t[10],9,38016083),s=Jn(s,n,e,r,t[15],14,-660478335),r=Jn(r,s,n,e,t[4],20,-405537848),e=Jn(e,r,s,n,t[9],5,568446438),n=Jn(n,e,r,s,t[14],9,-1019803690),s=Jn(s,n,e,r,t[3],14,-187363961),r=Jn(r,s,n,e,t[8],20,1163531501),e=Jn(e,r,s,n,t[13],5,-1444681467),n=Jn(n,e,r,s,t[2],9,-51403784),s=Jn(s,n,e,r,t[7],14,1735328473),e=Zn(e,r=Jn(r,s,n,e,t[12],20,-1926607734),s,n,t[5],4,-378558),n=Zn(n,e,r,s,t[8],11,-2022574463),s=Zn(s,n,e,r,t[11],16,1839030562),r=Zn(r,s,n,e,t[14],23,-35309556),e=Zn(e,r,s,n,t[1],4,-1530992060),n=Zn(n,e,r,s,t[4],11,1272893353),s=Zn(s,n,e,r,t[7],16,-155497632),r=Zn(r,s,n,e,t[10],23,-1094730640),e=Zn(e,r,s,n,t[13],4,681279174),n=Zn(n,e,r,s,t[0],11,-358537222),s=Zn(s,n,e,r,t[3],16,-722521979),r=Zn(r,s,n,e,t[6],23,76029189),e=Zn(e,r,s,n,t[9],4,-640364487),n=Zn(n,e,r,s,t[12],11,-421815835),s=Zn(s,n,e,r,t[15],16,530742520),e=Xn(e,r=Zn(r,s,n,e,t[2],23,-995338651),s,n,t[0],6,-198630844),n=Xn(n,e,r,s,t[7],10,1126891415),s=Xn(s,n,e,r,t[14],15,-1416354905),r=Xn(r,s,n,e,t[5],21,-57434055),e=Xn(e,r,s,n,t[12],6,1700485571),n=Xn(n,e,r,s,t[3],10,-1894986606),s=Xn(s,n,e,r,t[10],15,-1051523),r=Xn(r,s,n,e,t[1],21,-2054922799),e=Xn(e,r,s,n,t[8],6,1873313359),n=Xn(n,e,r,s,t[15],10,-30611744),s=Xn(s,n,e,r,t[6],15,-1560198380),r=Xn(r,s,n,e,t[13],21,1309151649),e=Xn(e,r,s,n,t[4],6,-145523070),n=Xn(n,e,r,s,t[11],10,-1120210379),s=Xn(s,n,e,r,t[2],15,718787259),r=Xn(r,s,n,e,t[9],21,-343485551),i[0]=zh(e,i[0]),i[1]=zh(r,i[1]),i[2]=zh(s,i[2]),i[3]=zh(n,i[3])}function Nm(i,t,e,r,s,n){return t=zh(zh(t,i),zh(r,n)),zh(t<<s|t>>>32-s,e)}function Wn(i,t,e,r,s,n,c){return Nm(t&e|~t&r,i,t,s,n,c)}function Jn(i,t,e,r,s,n,c){return Nm(t&r|e&~r,i,t,s,n,c)}function Zn(i,t,e,r,s,n,c){return Nm(t^e^r,i,t,s,n,c)}function Xn(i,t,e,r,s,n,c){return Nm(e^(t|~r),i,t,s,n,c)}function _E(i){var t,e=i.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=i.length;t+=64)zy(r,KG(i.substring(t-64,t)));i=i.substring(t-64);var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i.length;t++)s[t>>2]|=i.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(zy(r,s),t=0;t<16;t++)s[t]=0;return s[14]=8*e,zy(r,s),r}function KG(i){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=i.charCodeAt(t)+(i.charCodeAt(t+1)<<8)+(i.charCodeAt(t+2)<<16)+(i.charCodeAt(t+3)<<24);return e}Zp=Oi.atob.bind(Oi),W_=Oi.btoa.bind(Oi);var B5="0123456789abcdef".split("");function YG(i){for(var t="",e=0;e<4;e++)t+=B5[i>>8*e+4&15]+B5[i>>8*e&15];return t}function QG(i){return String.fromCharCode((255&i)>>0,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function J_(i){return _E(i).map(QG).join("")}var tV=function(i){for(var t=0;t<i.length;t++)i[t]=YG(i[t]);return i.join("")}(_E("hello"))!="5d41402abc4b2a76b9719d911017c592";function zh(i,t){if(tV){var e=(65535&i)+(65535&t);return(i>>16)+(t>>16)+(e>>16)<<16|65535&e}return i+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function Z_(i,t){var e,r,s,n;if(i!==e){for(var c=(s=i,n=1+(256/i.length>>0),new Array(n+1).join(s)),l=[],f=0;f<256;f++)l[f]=f;var y=0;for(f=0;f<256;f++){var x=l[f];y=(y+x+c.charCodeAt(f))%256,l[f]=l[y],l[y]=x}e=i,r=l}else l=r;var T=t.length,P=0,M=0,N="";for(f=0;f<T;f++)M=(M+(x=l[P=(P+1)%256]))%256,l[P]=l[M],l[M]=x,c=l[(l[P]+l[M])%256],N+=String.fromCharCode(t.charCodeAt(f)^c);return N}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var R5={print:4,modify:8,copy:16,"annot-forms":32};function yd(i,t,e,r){this.v=1,this.r=2;var s=192;i.forEach(function(l){if(R5.perm!==void 0)throw new Error("Invalid permission: "+l);s+=R5[l]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var n=(t+this.padding).substr(0,32),c=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(n,c),this.P=-(1+(255^s)),this.encryptionKey=J_(n+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=Z_(this.encryptionKey,this.padding)}function _d(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var t="",e=i.length,r=0;r<e;r++){var s=i.charCodeAt(r);s<33||s===35||s===37||s===40||s===41||s===47||s===60||s===62||s===91||s===93||s===123||s===125||s>126?t+="#"+("0"+s.toString(16)).slice(-2):t+=i[r]}return t}function k5(i){if(Fr(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,r,s){if(s=s||!1,typeof e!="string"||typeof r!="function"||typeof s!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var n=Math.random().toString(35);return t[e][n]=[r,!!s],n},this.unsubscribe=function(e){for(var r in t)if(t[r][e])return delete t[r][e],Object.keys(t[r]).length===0&&delete t[r],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var r=Array.prototype.slice.call(arguments,1),s=[];for(var n in t[e]){var c=t[e][n];try{c[0].apply(i,r)}catch(l){Oi.console&&Yr.error("jsPDF PubSub Error",l.message,l)}c[1]&&s.push(n)}s.length&&s.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function _m(i){if(!(this instanceof _m))return new _m(i);var t="opacity,stroke-opacity".split(",");for(var e in i)i.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=i[e]);this.id="",this.objectNumber=-1}function vE(i,t){this.gState=i,this.matrix=t,this.id="",this.objectNumber=-1}function xu(i,t,e,r,s){if(!(this instanceof xu))return new xu(i,t,e,r,s);this.type=i==="axial"?2:3,this.coords=t,this.colors=e,vE.call(this,r,s)}function Sd(i,t,e,r,s){if(!(this instanceof Sd))return new Sd(i,t,e,r,s);this.boundingBox=i,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,vE.call(this,r,s)}function ki(i){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],s=arguments[2],n=arguments[3],c=[],l=1,f=16,y="S",x=null;Fr(i=i||{})==="object"&&(e=i.orientation,r=i.unit||r,s=i.format||s,n=i.compress||i.compressPdf||n,(x=i.encryption||null)!==null&&(x.userPassword=x.userPassword||"",x.ownerPassword=x.ownerPassword||"",x.userPermissions=x.userPermissions||[]),l=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(t=i.precision),i.floatPrecision!==void 0&&(f=i.floatPrecision),y=i.defaultPathOperation||"S"),c=i.filters||(n===!0?["FlateEncode"]:c),r=r||"mm",e=(""+(e||"P")).toLowerCase();var T=i.putOnlyUsedFonts||!1,P={},M={internal:{},__private__:{}};M.__private__.PubSub=k5;var N="1.3",G=M.__private__.getPdfVersion=function(){return N};M.__private__.setPdfVersion=function(D){N=D};var Z={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};M.__private__.getPageFormats=function(){return Z};var X=M.__private__.getPageFormat=function(D){return Z[D]};s=s||"a4";var $={COMPAT:"compat",ADVANCED:"advanced"},ct=$.COMPAT;function yt(){this.saveGraphicsState(),Pt(new At(Re,0,0,-Re,0,To()*Re).toString()+" cm"),this.setFontSize(this.getFontSize()/Re),y="n",ct=$.ADVANCED}function Mt(){this.restoreGraphicsState(),y="S",ct=$.COMPAT}var Nt=M.__private__.combineFontStyleAndFontWeight=function(D,Q){if(D=="bold"&&Q=="normal"||D=="bold"&&Q==400||D=="normal"&&Q=="italic"||D=="bold"&&Q=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Q&&(D=Q==400||Q==="normal"?D==="italic"?"italic":"normal":Q!=700&&Q!=="bold"||D!=="normal"?(Q==700?"bold":Q)+""+D:"bold"),D};M.advancedAPI=function(D){var Q=ct===$.COMPAT;return Q&&yt.call(this),typeof D!="function"||(D(this),Q&&Mt.call(this)),this},M.compatAPI=function(D){var Q=ct===$.ADVANCED;return Q&&Mt.call(this),typeof D!="function"||(D(this),Q&&yt.call(this)),this},M.isAdvancedAPI=function(){return ct===$.ADVANCED};var Rt,xt=function(D){if(ct!==$.ADVANCED)throw new Error(D+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},qt=M.roundToPrecision=M.__private__.roundToPrecision=function(D,Q){var Ct=t||Q;if(isNaN(D)||isNaN(Ct))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return D.toFixed(Ct).replace(/0+$/,"")};Rt=M.hpf=M.__private__.hpf=typeof f=="number"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return qt(D,f)}:f==="smart"?function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return qt(D,D>-1&&D<1?16:5)}:function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.hpf");return qt(D,16)};var zt=M.f2=M.__private__.f2=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f2");return qt(D,2)},ot=M.__private__.f3=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.f3");return qt(D,3)},dt=M.scale=M.__private__.scale=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.scale");return ct===$.COMPAT?D*Re:ct===$.ADVANCED?D:void 0},Lt=function(D){return ct===$.COMPAT?To()-D:ct===$.ADVANCED?D:void 0},wt=function(D){return dt(Lt(D))};M.__private__.setPrecision=M.setPrecision=function(D){typeof parseInt(D,10)=="number"&&(t=parseInt(D,10))};var le,oe="00000000000000000000000000000000",de=M.__private__.getFileId=function(){return oe},te=M.__private__.setFileId=function(D){return oe=D!==void 0&&/^[a-fA-F0-9]{32}$/.test(D)?D.toUpperCase():oe.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),x!==null&&(Ar=new yd(x.userPermissions,x.userPassword,x.ownerPassword,oe)),oe};M.setFileId=function(D){return te(D),this},M.getFileId=function(){return de()};var me=M.__private__.convertDateToPDFDate=function(D){var Q=D.getTimezoneOffset(),Ct=Q<0?"+":"-",Gt=Math.floor(Math.abs(Q/60)),Yt=Math.abs(Q%60),ee=[Ct,It(Gt),"'",It(Yt),"'"].join("");return["D:",D.getFullYear(),It(D.getMonth()+1),It(D.getDate()),It(D.getHours()),It(D.getMinutes()),It(D.getSeconds()),ee].join("")},ge=M.__private__.convertPDFDateToDate=function(D){var Q=parseInt(D.substr(2,4),10),Ct=parseInt(D.substr(6,2),10)-1,Gt=parseInt(D.substr(8,2),10),Yt=parseInt(D.substr(10,2),10),ee=parseInt(D.substr(12,2),10),Ie=parseInt(D.substr(14,2),10);return new Date(Q,Ct,Gt,Yt,ee,Ie,0)},ke=M.__private__.setCreationDate=function(D){var Q;if(D===void 0&&(D=new Date),D instanceof Date)Q=me(D);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(D))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Q=D}return le=Q},it=M.__private__.getCreationDate=function(D){var Q=le;return D==="jsDate"&&(Q=ge(le)),Q};M.setCreationDate=function(D){return ke(D),this},M.getCreationDate=function(D){return it(D)};var Et,It=M.__private__.padd2=function(D){return("0"+parseInt(D)).slice(-2)},Ut=M.__private__.padd2Hex=function(D){return("00"+(D=D.toString())).substr(D.length)},Xt=0,Kt=[],ie=[],Qt=0,Ae=[],Le=[],Fe=!1,Ge=ie,Xe=function(){Xt=0,Qt=0,ie=[],Kt=[],Ae=[],si=qe(),Si=qe()};M.__private__.setCustomOutputDestination=function(D){Fe=!0,Ge=D};var pe=function(D){Fe||(Ge=D)};M.__private__.resetCustomOutputDestination=function(){Fe=!1,Ge=ie};var Pt=M.__private__.out=function(D){return D=D.toString(),Qt+=D.length+1,Ge.push(D),Ge},Zt=M.__private__.write=function(D){return Pt(arguments.length===1?D.toString():Array.prototype.join.call(arguments," "))},ii=M.__private__.getArrayBuffer=function(D){for(var Q=D.length,Ct=new ArrayBuffer(Q),Gt=new Uint8Array(Ct);Q--;)Gt[Q]=D.charCodeAt(Q);return Ct},Pe=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];M.__private__.getStandardFonts=function(){return Pe};var ve=i.fontSize||16;M.__private__.setFontSize=M.setFontSize=function(D){return ve=ct===$.ADVANCED?D/Re:D,this};var Ee,Ve=M.__private__.getFontSize=M.getFontSize=function(){return ct===$.COMPAT?ve:ve*Re},ai=i.R2L||!1;M.__private__.setR2L=M.setR2L=function(D){return ai=D,this},M.__private__.getR2L=M.getR2L=function(){return ai};var Ai,Ti=M.__private__.setZoomMode=function(D){var Q=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(D))Ee=D;else if(isNaN(D)){if(Q.indexOf(D)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+D+'" is not recognized.');Ee=D}else Ee=parseInt(D,10)};M.__private__.getZoomMode=function(){return Ee};var Pi,qi=M.__private__.setPageMode=function(D){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(D)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+D+'" is not recognized.');Ai=D};M.__private__.getPageMode=function(){return Ai};var Ji=M.__private__.setLayoutMode=function(D){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(D)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+D+'" is not recognized.');Pi=D};M.__private__.getLayoutMode=function(){return Pi},M.__private__.setDisplayMode=M.setDisplayMode=function(D,Q,Ct){return Ti(D),Ji(Q),qi(Ct),this};var ce={title:"",subject:"",author:"",keywords:"",creator:""};M.__private__.getDocumentProperty=function(D){if(Object.keys(ce).indexOf(D)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ce[D]},M.__private__.getDocumentProperties=function(){return ce},M.__private__.setDocumentProperties=M.setProperties=M.setDocumentProperties=function(D){for(var Q in ce)ce.hasOwnProperty(Q)&&D[Q]&&(ce[Q]=D[Q]);return this},M.__private__.setDocumentProperty=function(D,Q){if(Object.keys(ce).indexOf(D)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ce[D]=Q};var Ei,Re,jr,Ci,Te,Ke={},Qe={},hr=[],Di={},vi={},yr={},sr={},vt=null,K=0,Y=[],st=new k5(M),_t=i.hotfixes||[],kt={},Ft={},Vt=[],At=function D(Q,Ct,Gt,Yt,ee,Ie){if(!(this instanceof D))return new D(Q,Ct,Gt,Yt,ee,Ie);isNaN(Q)&&(Q=1),isNaN(Ct)&&(Ct=0),isNaN(Gt)&&(Gt=0),isNaN(Yt)&&(Yt=1),isNaN(ee)&&(ee=0),isNaN(Ie)&&(Ie=0),this._matrix=[Q,Ct,Gt,Yt,ee,Ie]};Object.defineProperty(At.prototype,"sx",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(At.prototype,"shy",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(At.prototype,"shx",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(At.prototype,"sy",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(At.prototype,"tx",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(At.prototype,"ty",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(At.prototype,"a",{get:function(){return this._matrix[0]},set:function(D){this._matrix[0]=D}}),Object.defineProperty(At.prototype,"b",{get:function(){return this._matrix[1]},set:function(D){this._matrix[1]=D}}),Object.defineProperty(At.prototype,"c",{get:function(){return this._matrix[2]},set:function(D){this._matrix[2]=D}}),Object.defineProperty(At.prototype,"d",{get:function(){return this._matrix[3]},set:function(D){this._matrix[3]=D}}),Object.defineProperty(At.prototype,"e",{get:function(){return this._matrix[4]},set:function(D){this._matrix[4]=D}}),Object.defineProperty(At.prototype,"f",{get:function(){return this._matrix[5]},set:function(D){this._matrix[5]=D}}),Object.defineProperty(At.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(At.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(At.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(At.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),At.prototype.join=function(D){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Rt).join(D)},At.prototype.multiply=function(D){var Q=D.sx*this.sx+D.shy*this.shx,Ct=D.sx*this.shy+D.shy*this.sy,Gt=D.shx*this.sx+D.sy*this.shx,Yt=D.shx*this.shy+D.sy*this.sy,ee=D.tx*this.sx+D.ty*this.shx+this.tx,Ie=D.tx*this.shy+D.ty*this.sy+this.ty;return new At(Q,Ct,Gt,Yt,ee,Ie)},At.prototype.decompose=function(){var D=this.sx,Q=this.shy,Ct=this.shx,Gt=this.sy,Yt=this.tx,ee=this.ty,Ie=Math.sqrt(D*D+Q*Q),ti=(D/=Ie)*Ct+(Q/=Ie)*Gt;Ct-=D*ti,Gt-=Q*ti;var wi=Math.sqrt(Ct*Ct+Gt*Gt);return ti/=wi,D*(Gt/=wi)<Q*(Ct/=wi)&&(D=-D,Q=-Q,ti=-ti,Ie=-Ie),{scale:new At(Ie,0,0,wi,0,0),translate:new At(1,0,0,1,Yt,ee),rotate:new At(D,Q,-Q,D,0,0),skew:new At(1,0,ti,1,0,0)}},At.prototype.toString=function(D){return this.join(" ")},At.prototype.inversed=function(){var D=this.sx,Q=this.shy,Ct=this.shx,Gt=this.sy,Yt=this.tx,ee=this.ty,Ie=1/(D*Gt-Q*Ct),ti=Gt*Ie,wi=-Q*Ie,Ii=-Ct*Ie,hi=D*Ie;return new At(ti,wi,Ii,hi,-ti*Yt-Ii*ee,-wi*Yt-hi*ee)},At.prototype.applyToPoint=function(D){var Q=D.x*this.sx+D.y*this.shx+this.tx,Ct=D.x*this.shy+D.y*this.sy+this.ty;return new Fl(Q,Ct)},At.prototype.applyToRectangle=function(D){var Q=this.applyToPoint(D),Ct=this.applyToPoint(new Fl(D.x+D.w,D.y+D.h));return new Ka(Q.x,Q.y,Ct.x-Q.x,Ct.y-Q.y)},At.prototype.clone=function(){var D=this.sx,Q=this.shy,Ct=this.shx,Gt=this.sy,Yt=this.tx,ee=this.ty;return new At(D,Q,Ct,Gt,Yt,ee)},M.Matrix=At;var Jt=M.matrixMult=function(D,Q){return Q.multiply(D)},ye=new At(1,0,0,1,0,0);M.unitMatrix=M.identityMatrix=ye;var he=function(D,Q){if(!vi[D]){var Ct=(Q instanceof xu?"Sh":"P")+(Object.keys(Di).length+1).toString(10);Q.id=Ct,vi[D]=Ct,Di[Ct]=Q,st.publish("addPattern",Q)}};M.ShadingPattern=xu,M.TilingPattern=Sd,M.addShadingPattern=function(D,Q){return xt("addShadingPattern()"),he(D,Q),this},M.beginTilingPattern=function(D){xt("beginTilingPattern()"),zl(D.boundingBox[0],D.boundingBox[1],D.boundingBox[2]-D.boundingBox[0],D.boundingBox[3]-D.boundingBox[1],D.matrix)},M.endTilingPattern=function(D,Q){xt("endTilingPattern()"),Q.stream=Le[Et].join(`
`),he(D,Q),st.publish("endTilingPattern",Q),Vt.pop().restore()};var ae=M.__private__.newObject=function(){var D=qe();return Je(D,!0),D},qe=M.__private__.newObjectDeferred=function(){return Xt++,Kt[Xt]=function(){return Qt},Xt},Je=function(D,Q){return Q=typeof Q=="boolean"&&Q,Kt[D]=Qt,Q&&Pt(D+" 0 obj"),D},bi=M.__private__.newAdditionalObject=function(){var D={objId:qe(),content:""};return Ae.push(D),D},si=qe(),Si=qe(),Ni=M.__private__.decodeColorString=function(D){var Q=D.split(" ");if(Q.length!==2||Q[1]!=="g"&&Q[1]!=="G")Q.length===5&&(Q[4]==="k"||Q[4]==="K")&&(Q=[(1-Q[0])*(1-Q[3]),(1-Q[1])*(1-Q[3]),(1-Q[2])*(1-Q[3]),"r"]);else{var Ct=parseFloat(Q[0]);Q=[Ct,Ct,Ct,"r"]}for(var Gt="#",Yt=0;Yt<3;Yt++)Gt+=("0"+Math.floor(255*parseFloat(Q[Yt])).toString(16)).slice(-2);return Gt},Hi=M.__private__.encodeColorString=function(D){var Q;typeof D=="string"&&(D={ch1:D});var Ct=D.ch1,Gt=D.ch2,Yt=D.ch3,ee=D.ch4,Ie=D.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Ct=="string"&&Ct.charAt(0)!=="#"){var ti=new yE(Ct);if(ti.ok)Ct=ti.toHex();else if(!/^\d*\.?\d*$/.test(Ct))throw new Error('Invalid color "'+Ct+'" passed to jsPDF.encodeColorString.')}if(typeof Ct=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Ct)&&(Ct="#"+Ct[1]+Ct[1]+Ct[2]+Ct[2]+Ct[3]+Ct[3]),typeof Ct=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Ct)){var wi=parseInt(Ct.substr(1),16);Ct=wi>>16&255,Gt=wi>>8&255,Yt=255&wi}if(Gt===void 0||ee===void 0&&Ct===Gt&&Gt===Yt)if(typeof Ct=="string")Q=Ct+" "+Ie[0];else switch(D.precision){case 2:Q=zt(Ct/255)+" "+Ie[0];break;case 3:default:Q=ot(Ct/255)+" "+Ie[0]}else if(ee===void 0||Fr(ee)==="object"){if(ee&&!isNaN(ee.a)&&ee.a===0)return Q=["1.","1.","1.",Ie[1]].join(" ");if(typeof Ct=="string")Q=[Ct,Gt,Yt,Ie[1]].join(" ");else switch(D.precision){case 2:Q=[zt(Ct/255),zt(Gt/255),zt(Yt/255),Ie[1]].join(" ");break;default:case 3:Q=[ot(Ct/255),ot(Gt/255),ot(Yt/255),Ie[1]].join(" ")}}else if(typeof Ct=="string")Q=[Ct,Gt,Yt,ee,Ie[2]].join(" ");else switch(D.precision){case 2:Q=[zt(Ct),zt(Gt),zt(Yt),zt(ee),Ie[2]].join(" ");break;case 3:default:Q=[ot(Ct),ot(Gt),ot(Yt),ot(ee),Ie[2]].join(" ")}return Q},nr=M.__private__.getFilters=function(){return c},li=M.__private__.putStream=function(D){var Q=(D=D||{}).data||"",Ct=D.filters||nr(),Gt=D.alreadyAppliedFilters||[],Yt=D.addLength1||!1,ee=Q.length,Ie=D.objectId,ti=function(Fi){return Fi};if(x!==null&&Ie===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");x!==null&&(ti=Ar.encryptor(Ie,0));var wi={};Ct===!0&&(Ct=["FlateEncode"]);var Ii=D.additionalKeyValues||[],hi=(wi=ki.API.processDataByFilters!==void 0?ki.API.processDataByFilters(Q,Ct):{data:Q,reverseChain:[]}).reverseChain+(Array.isArray(Gt)?Gt.join(" "):Gt.toString());if(wi.data.length!==0&&(Ii.push({key:"Length",value:wi.data.length}),Yt===!0&&Ii.push({key:"Length1",value:ee})),hi.length!=0)if(hi.split("/").length-1==1)Ii.push({key:"Filter",value:hi});else{Ii.push({key:"Filter",value:"["+hi+"]"});for(var rr=0;rr<Ii.length;rr+=1)if(Ii[rr].key==="DecodeParms"){for(var ui=[],Zr=0;Zr<wi.reverseChain.split("/").length-1;Zr+=1)ui.push("null");ui.push(Ii[rr].value),Ii[rr].value="["+ui.join(" ")+"]"}}Pt("<<");for(var Ri=0;Ri<Ii.length;Ri++)Pt("/"+Ii[Ri].key+" "+Ii[Ri].value);Pt(">>"),wi.data.length!==0&&(Pt("stream"),Pt(ti(wi.data)),Pt("endstream"))},ji=M.__private__.putPage=function(D){var Q=D.number,Ct=D.data,Gt=D.objId,Yt=D.contentsObjId;Je(Gt,!0),Pt("<</Type /Page"),Pt("/Parent "+D.rootDictionaryObjId+" 0 R"),Pt("/Resources "+D.resourceDictionaryObjId+" 0 R"),Pt("/MediaBox ["+parseFloat(Rt(D.mediaBox.bottomLeftX))+" "+parseFloat(Rt(D.mediaBox.bottomLeftY))+" "+Rt(D.mediaBox.topRightX)+" "+Rt(D.mediaBox.topRightY)+"]"),D.cropBox!==null&&Pt("/CropBox ["+Rt(D.cropBox.bottomLeftX)+" "+Rt(D.cropBox.bottomLeftY)+" "+Rt(D.cropBox.topRightX)+" "+Rt(D.cropBox.topRightY)+"]"),D.bleedBox!==null&&Pt("/BleedBox ["+Rt(D.bleedBox.bottomLeftX)+" "+Rt(D.bleedBox.bottomLeftY)+" "+Rt(D.bleedBox.topRightX)+" "+Rt(D.bleedBox.topRightY)+"]"),D.trimBox!==null&&Pt("/TrimBox ["+Rt(D.trimBox.bottomLeftX)+" "+Rt(D.trimBox.bottomLeftY)+" "+Rt(D.trimBox.topRightX)+" "+Rt(D.trimBox.topRightY)+"]"),D.artBox!==null&&Pt("/ArtBox ["+Rt(D.artBox.bottomLeftX)+" "+Rt(D.artBox.bottomLeftY)+" "+Rt(D.artBox.topRightX)+" "+Rt(D.artBox.topRightY)+"]"),typeof D.userUnit=="number"&&D.userUnit!==1&&Pt("/UserUnit "+D.userUnit),st.publish("putPage",{objId:Gt,pageContext:Y[Q],pageNumber:Q,page:Ct}),Pt("/Contents "+Yt+" 0 R"),Pt(">>"),Pt("endobj");var ee=Ct.join(`
`);return ct===$.ADVANCED&&(ee+=`
Q`),Je(Yt,!0),li({data:ee,filters:nr(),objectId:Yt}),Pt("endobj"),Gt},ur=M.__private__.putPages=function(){var D,Q,Ct=[];for(D=1;D<=K;D++)Y[D].objId=qe(),Y[D].contentsObjId=qe();for(D=1;D<=K;D++)Ct.push(ji({number:D,data:Le[D],objId:Y[D].objId,contentsObjId:Y[D].contentsObjId,mediaBox:Y[D].mediaBox,cropBox:Y[D].cropBox,bleedBox:Y[D].bleedBox,trimBox:Y[D].trimBox,artBox:Y[D].artBox,userUnit:Y[D].userUnit,rootDictionaryObjId:si,resourceDictionaryObjId:Si}));Je(si,!0),Pt("<</Type /Pages");var Gt="/Kids [";for(Q=0;Q<K;Q++)Gt+=Ct[Q]+" 0 R ";Pt(Gt+"]"),Pt("/Count "+K),Pt(">>"),Pt("endobj"),st.publish("postPutPages")},Mr=function(D){st.publish("putFont",{font:D,out:Pt,newObject:ae,putStream:li}),D.isAlreadyPutted!==!0&&(D.objectNumber=ae(),Pt("<<"),Pt("/Type /Font"),Pt("/BaseFont /"+_d(D.postScriptName)),Pt("/Subtype /Type1"),typeof D.encoding=="string"&&Pt("/Encoding /"+D.encoding),Pt("/FirstChar 32"),Pt("/LastChar 255"),Pt(">>"),Pt("endobj"))},Ur=function(){for(var D in Ke)Ke.hasOwnProperty(D)&&(T===!1||T===!0&&P.hasOwnProperty(D))&&Mr(Ke[D])},Er=function(D){D.objectNumber=ae();var Q=[];Q.push({key:"Type",value:"/XObject"}),Q.push({key:"Subtype",value:"/Form"}),Q.push({key:"BBox",value:"["+[Rt(D.x),Rt(D.y),Rt(D.x+D.width),Rt(D.y+D.height)].join(" ")+"]"}),Q.push({key:"Matrix",value:"["+D.matrix.toString()+"]"});var Ct=D.pages[1].join(`
`);li({data:Ct,additionalKeyValues:Q,objectId:D.objectNumber}),Pt("endobj")},ks=function(){for(var D in kt)kt.hasOwnProperty(D)&&Er(kt[D])},qa=function(D,Q){var Ct,Gt=[],Yt=1/(Q-1);for(Ct=0;Ct<1;Ct+=Yt)Gt.push(Ct);if(Gt.push(1),D[0].offset!=0){var ee={offset:0,color:D[0].color};D.unshift(ee)}if(D[D.length-1].offset!=1){var Ie={offset:1,color:D[D.length-1].color};D.push(Ie)}for(var ti="",wi=0,Ii=0;Ii<Gt.length;Ii++){for(Ct=Gt[Ii];Ct>D[wi+1].offset;)wi++;var hi=D[wi].offset,rr=(Ct-hi)/(D[wi+1].offset-hi),ui=D[wi].color,Zr=D[wi+1].color;ti+=Ut(Math.round((1-rr)*ui[0]+rr*Zr[0]).toString(16))+Ut(Math.round((1-rr)*ui[1]+rr*Zr[1]).toString(16))+Ut(Math.round((1-rr)*ui[2]+rr*Zr[2]).toString(16))}return ti.trim()},da=function(D,Q){Q||(Q=21);var Ct=ae(),Gt=qa(D.colors,Q),Yt=[];Yt.push({key:"FunctionType",value:"0"}),Yt.push({key:"Domain",value:"[0.0 1.0]"}),Yt.push({key:"Size",value:"["+Q+"]"}),Yt.push({key:"BitsPerSample",value:"8"}),Yt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Yt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),li({data:Gt,additionalKeyValues:Yt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Ct}),Pt("endobj"),D.objectNumber=ae(),Pt("<< /ShadingType "+D.type),Pt("/ColorSpace /DeviceRGB");var ee="/Coords ["+Rt(parseFloat(D.coords[0]))+" "+Rt(parseFloat(D.coords[1]))+" ";D.type===2?ee+=Rt(parseFloat(D.coords[2]))+" "+Rt(parseFloat(D.coords[3])):ee+=Rt(parseFloat(D.coords[2]))+" "+Rt(parseFloat(D.coords[3]))+" "+Rt(parseFloat(D.coords[4]))+" "+Rt(parseFloat(D.coords[5])),Pt(ee+="]"),D.matrix&&Pt("/Matrix ["+D.matrix.toString()+"]"),Pt("/Function "+Ct+" 0 R"),Pt("/Extend [true true]"),Pt(">>"),Pt("endobj")},Bi=function(D,Q){var Ct=qe(),Gt=ae();Q.push({resourcesOid:Ct,objectOid:Gt}),D.objectNumber=Gt;var Yt=[];Yt.push({key:"Type",value:"/Pattern"}),Yt.push({key:"PatternType",value:"1"}),Yt.push({key:"PaintType",value:"1"}),Yt.push({key:"TilingType",value:"1"}),Yt.push({key:"BBox",value:"["+D.boundingBox.map(Rt).join(" ")+"]"}),Yt.push({key:"XStep",value:Rt(D.xStep)}),Yt.push({key:"YStep",value:Rt(D.yStep)}),Yt.push({key:"Resources",value:Ct+" 0 R"}),D.matrix&&Yt.push({key:"Matrix",value:"["+D.matrix.toString()+"]"}),li({data:D.stream,additionalKeyValues:Yt,objectId:D.objectNumber}),Pt("endobj")},$s=function(D){var Q;for(Q in Di)Di.hasOwnProperty(Q)&&(Di[Q]instanceof xu?da(Di[Q]):Di[Q]instanceof Sd&&Bi(Di[Q],D))},Ks=function(D){for(var Q in D.objectNumber=ae(),Pt("<<"),D)switch(Q){case"opacity":Pt("/ca "+zt(D[Q]));break;case"stroke-opacity":Pt("/CA "+zt(D[Q]))}Pt(">>"),Pt("endobj")},Rr=function(){var D;for(D in yr)yr.hasOwnProperty(D)&&Ks(yr[D])},Gr=function(){for(var D in Pt("/XObject <<"),kt)kt.hasOwnProperty(D)&&kt[D].objectNumber>=0&&Pt("/"+D+" "+kt[D].objectNumber+" 0 R");st.publish("putXobjectDict"),Pt(">>")},xs=function(){Ar.oid=ae(),Pt("<<"),Pt("/Filter /Standard"),Pt("/V "+Ar.v),Pt("/R "+Ar.r),Pt("/U <"+Ar.toHexString(Ar.U)+">"),Pt("/O <"+Ar.toHexString(Ar.O)+">"),Pt("/P "+Ar.P),Pt(">>"),Pt("endobj")},kr=function(){for(var D in Pt("/Font <<"),Ke)Ke.hasOwnProperty(D)&&(T===!1||T===!0&&P.hasOwnProperty(D))&&Pt("/"+D+" "+Ke[D].objectNumber+" 0 R");Pt(">>")},Os=function(){if(Object.keys(Di).length>0){for(var D in Pt("/Shading <<"),Di)Di.hasOwnProperty(D)&&Di[D]instanceof xu&&Di[D].objectNumber>=0&&Pt("/"+D+" "+Di[D].objectNumber+" 0 R");st.publish("putShadingPatternDict"),Pt(">>")}},nn=function(D){if(Object.keys(Di).length>0){for(var Q in Pt("/Pattern <<"),Di)Di.hasOwnProperty(Q)&&Di[Q]instanceof M.TilingPattern&&Di[Q].objectNumber>=0&&Di[Q].objectNumber<D&&Pt("/"+Q+" "+Di[Q].objectNumber+" 0 R");st.publish("putTilingPatternDict"),Pt(">>")}},to=function(){if(Object.keys(yr).length>0){var D;for(D in Pt("/ExtGState <<"),yr)yr.hasOwnProperty(D)&&yr[D].objectNumber>=0&&Pt("/"+D+" "+yr[D].objectNumber+" 0 R");st.publish("putGStateDict"),Pt(">>")}},xi=function(D){Je(D.resourcesOid,!0),Pt("<<"),Pt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),kr(),Os(),nn(D.objectOid),to(),Gr(),Pt(">>"),Pt("endobj")},wn=function(){var D=[];Ur(),Rr(),ks(),$s(D),st.publish("putResources"),D.forEach(xi),xi({resourcesOid:Si,objectOid:Number.MAX_SAFE_INTEGER}),st.publish("postPutResources")},Ys=function(){st.publish("putAdditionalObjects");for(var D=0;D<Ae.length;D++){var Q=Ae[D];Je(Q.objId,!0),Pt(Q.content),Pt("endobj")}st.publish("postPutAdditionalObjects")},dr=function(D){Qe[D.fontName]=Qe[D.fontName]||{},Qe[D.fontName][D.fontStyle]=D.id},Rn=function(D,Q,Ct,Gt,Yt){var ee={id:"F"+(Object.keys(Ke).length+1).toString(10),postScriptName:D,fontName:Q,fontStyle:Ct,encoding:Gt,isStandardFont:Yt||!1,metadata:{}};return st.publish("addFont",{font:ee,instance:this}),Ke[ee.id]=ee,dr(ee),ee.id},ds=function(D){for(var Q=0,Ct=Pe.length;Q<Ct;Q++){var Gt=Rn.call(this,D[Q][0],D[Q][1],D[Q][2],Pe[Q][3],!0);T===!1&&(P[Gt]=!0);var Yt=D[Q][0].split("-");dr({id:Gt,fontName:Yt[0],fontStyle:Yt[1]||""})}st.publish("addFonts",{fonts:Ke,dictionary:Qe})},ps=function(D){return D.foo=function(){try{return D.apply(this,arguments)}catch(Gt){var Q=Gt.stack||"";~Q.indexOf(" at ")&&(Q=Q.split(" at ")[1]);var Ct="Error in function "+Q.split(`
`)[0].split("<")[0]+": "+Gt.message;if(!Oi.console)throw new Error(Ct);Oi.console.error(Ct,Gt),Oi.alert&&alert(Ct)}},D.foo.bar=D,D.foo},Or=function(D,Q){var Ct,Gt,Yt,ee,Ie,ti,wi,Ii,hi;if(Yt=(Q=Q||{}).sourceEncoding||"Unicode",Ie=Q.outputEncoding,(Q.autoencode||Ie)&&Ke[Ei].metadata&&Ke[Ei].metadata[Yt]&&Ke[Ei].metadata[Yt].encoding&&(ee=Ke[Ei].metadata[Yt].encoding,!Ie&&Ke[Ei].encoding&&(Ie=Ke[Ei].encoding),!Ie&&ee.codePages&&(Ie=ee.codePages[0]),typeof Ie=="string"&&(Ie=ee[Ie]),Ie)){for(wi=!1,ti=[],Ct=0,Gt=D.length;Ct<Gt;Ct++)(Ii=Ie[D.charCodeAt(Ct)])?ti.push(String.fromCharCode(Ii)):ti.push(D[Ct]),ti[Ct].charCodeAt(0)>>8&&(wi=!0);D=ti.join("")}for(Ct=D.length;wi===void 0&&Ct!==0;)D.charCodeAt(Ct-1)>>8&&(wi=!0),Ct--;if(!wi)return D;for(ti=Q.noBOM?[]:[254,255],Ct=0,Gt=D.length;Ct<Gt;Ct++){if((hi=(Ii=D.charCodeAt(Ct))>>8)>>8)throw new Error("Character at position "+Ct+" of string '"+D+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");ti.push(hi),ti.push(Ii-(hi<<8))}return String.fromCharCode.apply(void 0,ti)},hs=M.__private__.pdfEscape=M.pdfEscape=function(D,Q){return Or(D,Q).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Zi=M.__private__.beginPage=function(D){Le[++K]=[],Y[K]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(D[0]),topRightY:Number(D[1])}},xn(K),pe(Le[Et])},eo=function(D,Q){var Ct,Gt,Yt;switch(e=Q||e,typeof D=="string"&&(Ct=X(D.toLowerCase()),Array.isArray(Ct)&&(Gt=Ct[0],Yt=Ct[1])),Array.isArray(D)&&(Gt=D[0]*Re,Yt=D[1]*Re),isNaN(Gt)&&(Gt=s[0],Yt=s[1]),(Gt>14400||Yt>14400)&&(Yr.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Gt=Math.min(14400,Gt),Yt=Math.min(14400,Yt)),s=[Gt,Yt],e.substr(0,1)){case"l":Yt>Gt&&(s=[Yt,Gt]);break;case"p":Gt>Yt&&(s=[Yt,Gt])}Zi(s),Xi(gs),Pt(on),yc!==0&&Pt(yc+" J"),_c!==0&&Pt(_c+" j"),st.publish("addPage",{pageNumber:K})},io=function(D){D>0&&D<=K&&(Le.splice(D,1),Y.splice(D,1),K--,Et>K&&(Et=K),this.setPage(Et))},xn=function(D){D>0&&D<=K&&(Et=D)},pa=M.__private__.getNumberOfPages=M.getNumberOfPages=function(){return Le.length-1},rt=function(D,Q,Ct){var Gt,Yt=void 0;return Ct=Ct||{},D=D!==void 0?D:Ke[Ei].fontName,Q=Q!==void 0?Q:Ke[Ei].fontStyle,Gt=D.toLowerCase(),Qe[Gt]!==void 0&&Qe[Gt][Q]!==void 0?Yt=Qe[Gt][Q]:Qe[D]!==void 0&&Qe[D][Q]!==void 0?Yt=Qe[D][Q]:Ct.disableWarning===!1&&Yr.warn("Unable to look up font label for font '"+D+"', '"+Q+"'. Refer to getFontList() for available fonts."),Yt||Ct.noFallback||(Yt=Qe.times[Q])==null&&(Yt=Qe.times.normal),Yt},mt=M.__private__.putInfo=function(){var D=ae(),Q=function(Gt){return Gt};for(var Ct in x!==null&&(Q=Ar.encryptor(D,0)),Pt("<<"),Pt("/Producer ("+hs(Q("jsPDF "+ki.version))+")"),ce)ce.hasOwnProperty(Ct)&&ce[Ct]&&Pt("/"+Ct.substr(0,1).toUpperCase()+Ct.substr(1)+" ("+hs(Q(ce[Ct]))+")");Pt("/CreationDate ("+hs(Q(le))+")"),Pt(">>"),Pt("endobj")},Dt=M.__private__.putCatalog=function(D){var Q=(D=D||{}).rootDictionaryObjId||si;switch(ae(),Pt("<<"),Pt("/Type /Catalog"),Pt("/Pages "+Q+" 0 R"),Ee||(Ee="fullwidth"),Ee){case"fullwidth":Pt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Pt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Pt("/OpenAction [3 0 R /Fit]");break;case"original":Pt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Ct=""+Ee;Ct.substr(Ct.length-1)==="%"&&(Ee=parseInt(Ee)/100),typeof Ee=="number"&&Pt("/OpenAction [3 0 R /XYZ null null "+zt(Ee)+"]")}switch(Pi||(Pi="continuous"),Pi){case"continuous":Pt("/PageLayout /OneColumn");break;case"single":Pt("/PageLayout /SinglePage");break;case"two":case"twoleft":Pt("/PageLayout /TwoColumnLeft");break;case"tworight":Pt("/PageLayout /TwoColumnRight")}Ai&&Pt("/PageMode /"+Ai),st.publish("putCatalog"),Pt(">>"),Pt("endobj")},ue=M.__private__.putTrailer=function(){Pt("trailer"),Pt("<<"),Pt("/Size "+(Xt+1)),Pt("/Root "+Xt+" 0 R"),Pt("/Info "+(Xt-1)+" 0 R"),x!==null&&Pt("/Encrypt "+Ar.oid+" 0 R"),Pt("/ID [ <"+oe+"> <"+oe+"> ]"),Pt(">>")},Se=M.__private__.putHeader=function(){Pt("%PDF-"+N),Pt("%ºß¬à")},gi=M.__private__.putXRef=function(){var D="0000000000";Pt("xref"),Pt("0 "+(Xt+1)),Pt("0000000000 65535 f ");for(var Q=1;Q<=Xt;Q++)typeof Kt[Q]=="function"?Pt((D+Kt[Q]()).slice(-10)+" 00000 n "):Kt[Q]!==void 0?Pt((D+Kt[Q]).slice(-10)+" 00000 n "):Pt("0000000000 00000 n ")},Mi=M.__private__.buildDocument=function(){Xe(),pe(ie),st.publish("buildDocument"),Se(),ur(),Ys(),wn(),x!==null&&xs(),mt(),Dt();var D=Qt;return gi(),ue(),Pt("startxref"),Pt(""+D),Pt("%%EOF"),pe(Le[Et]),ie.join(`
`)},pr=M.__private__.getBlob=function(D){return new Blob([ii(D)],{type:"application/pdf"})},fs=M.output=M.__private__.output=ps(function(D,Q){switch(typeof(Q=Q||{})=="string"?Q={filename:Q}:Q.filename=Q.filename||"generated.pdf",D){case void 0:return Mi();case"save":M.save(Q.filename);break;case"arraybuffer":return ii(Mi());case"blob":return pr(Mi());case"bloburi":case"bloburl":if(Oi.URL!==void 0&&typeof Oi.URL.createObjectURL=="function")return Oi.URL&&Oi.URL.createObjectURL(pr(Mi()))||void 0;Yr.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Ct="",Gt=Mi();try{Ct=W_(Gt)}catch{Ct=W_(unescape(encodeURIComponent(Gt)))}return"data:application/pdf;filename="+Q.filename+";base64,"+Ct;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Oi)==="[object Window]"){var Yt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ee=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Q.pdfObjectUrl&&(Yt=Q.pdfObjectUrl,ee="");var Ie='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Yt+'"'+ee+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Q)+");<\/script></body></html>",ti=Oi.open();return ti!==null&&ti.document.write(Ie),ti}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Oi)==="[object Window]"){var wi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Q.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Q.filename+'" width="500px" height="400px" /></body></html>',Ii=Oi.open();if(Ii!==null){Ii.document.write(wi);var hi=this;Ii.document.documentElement.querySelector("#pdfViewer").onload=function(){Ii.document.title=Q.filename,Ii.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(hi.output("bloburl"))}}return Ii}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Oi)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var rr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Q)+'"></iframe></body></html>',ui=Oi.open();if(ui!==null&&(ui.document.write(rr),ui.document.title=Q.filename),ui||typeof safari>"u")return ui;break;case"datauri":case"dataurl":return Oi.document.location.href=this.output("datauristring",Q);default:return null}}),rs=function(D){return Array.isArray(_t)===!0&&_t.indexOf(D)>-1};switch(r){case"pt":Re=1;break;case"mm":Re=72/25.4;break;case"cm":Re=72/2.54;break;case"in":Re=72;break;case"px":Re=rs("px_scaling")==1?.75:96/72;break;case"pc":case"em":Re=12;break;case"ex":Re=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);Re=r}var Ar=null;ke(),te();var rh=function(D){return x!==null?Ar.encryptor(D,0):function(Q){return Q}},Ha=M.__private__.getPageInfo=M.getPageInfo=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Y[D].objId,pageNumber:D,pageContext:Y[D]}},Li=M.__private__.getPageInfoByObjId=function(D){if(isNaN(D)||D%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Q in Y)if(Y[Q].objId===D)break;return Ha(Q)},Vo=M.__private__.getCurrentPageInfo=M.getCurrentPageInfo=function(){return{objId:Y[Et].objId,pageNumber:Et,pageContext:Y[Et]}};M.addPage=function(){return eo.apply(this,arguments),this},M.setPage=function(){return xn.apply(this,arguments),pe.call(this,Le[Et]),this},M.insertPage=function(D){return this.addPage(),this.movePage(Et,D),this},M.movePage=function(D,Q){var Ct,Gt;if(D>Q){Ct=Le[D],Gt=Y[D];for(var Yt=D;Yt>Q;Yt--)Le[Yt]=Le[Yt-1],Y[Yt]=Y[Yt-1];Le[Q]=Ct,Y[Q]=Gt,this.setPage(Q)}else if(D<Q){Ct=Le[D],Gt=Y[D];for(var ee=D;ee<Q;ee++)Le[ee]=Le[ee+1],Y[ee]=Y[ee+1];Le[Q]=Ct,Y[Q]=Gt,this.setPage(Q)}return this},M.deletePage=function(){return io.apply(this,arguments),this},M.__private__.text=M.text=function(D,Q,Ct,Gt,Yt){var ee,Ie,ti,wi,Ii,hi,rr,ui,Zr,Ri=(Gt=Gt||{}).scope||this;if(typeof D=="number"&&typeof Q=="number"&&(typeof Ct=="string"||Array.isArray(Ct))){var Fi=Ct;Ct=Q,Q=D,D=Fi}if(arguments[3]instanceof At?(xt("The transform parameter of text() with a Matrix value"),Zr=Yt):(ti=arguments[4],wi=arguments[5],Fr(rr=arguments[3])==="object"&&rr!==null||(typeof ti=="string"&&(wi=ti,ti=null),typeof rr=="string"&&(wi=rr,rr=null),typeof rr=="number"&&(ti=rr,rr=null),Gt={flags:rr,angle:ti,align:wi})),isNaN(Q)||isNaN(Ct)||D==null)throw new Error("Invalid arguments passed to jsPDF.text");if(D.length===0)return Ri;var Vr="",an=!1,ln=typeof Gt.lineHeightFactor=="number"?Gt.lineHeightFactor:Eo,Po=Ri.internal.scaleFactor;function Ya(er){return er=er.split("	").join(Array(Gt.TabLen||9).join(" ")),hs(er,rr)}function wa(er){for(var fr,gr=er.concat(),Dr=[],Xo=gr.length;Xo--;)typeof(fr=gr.shift())=="string"?Dr.push(fr):Array.isArray(er)&&(fr.length===1||fr[1]===void 0&&fr[2]===void 0)?Dr.push(fr[0]):Dr.push([fr[0],fr[1],fr[2]]);return Dr}function xa(er,fr){var gr;if(typeof er=="string")gr=fr(er)[0];else if(Array.isArray(er)){for(var Dr,Xo,Bo=er.concat(),ql=[],$o=Bo.length;$o--;)typeof(Dr=Bo.shift())=="string"?ql.push(fr(Dr)[0]):Array.isArray(Dr)&&typeof Dr[0]=="string"&&(Xo=fr(Dr[0],Dr[1],Dr[2]),ql.push([Xo[0],Xo[1],Xo[2]]));gr=ql}return gr}var Qa=!1,Aa=!0;if(typeof D=="string")Qa=!0;else if(Array.isArray(D)){var Ul=D.concat();Ie=[];for(var Wo,Ds=Ul.length;Ds--;)(typeof(Wo=Ul.shift())!="string"||Array.isArray(Wo)&&typeof Wo[0]!="string")&&(Aa=!1);Qa=Aa}if(Qa===!1)throw new Error('Type of text must be string or Array. "'+D+'" is not recognized.');typeof D=="string"&&(D=D.match(/[\r?\n]/)?D.split(/\r\n|\r|\n/g):[D]);var Sa=ve/Ri.internal.scaleFactor,tl=Sa*(ln-1);switch(Gt.baseline){case"bottom":Ct-=tl;break;case"top":Ct+=Sa-tl;break;case"hanging":Ct+=Sa-2*tl;break;case"middle":Ct+=Sa/2-tl}if((hi=Gt.maxWidth||0)>0&&(typeof D=="string"?D=Ri.splitTextToSize(D,hi):Object.prototype.toString.call(D)==="[object Array]"&&(D=D.reduce(function(er,fr){return er.concat(Ri.splitTextToSize(fr,hi))},[]))),ee={text:D,x:Q,y:Ct,options:Gt,mutex:{pdfEscape:hs,activeFontKey:Ei,fonts:Ke,activeFontSize:ve}},st.publish("preProcessText",ee),D=ee.text,ti=(Gt=ee.options).angle,!(Zr instanceof At)&&ti&&typeof ti=="number"){ti*=Math.PI/180,Gt.rotationDirection===0&&(ti=-ti),ct===$.ADVANCED&&(ti=-ti);var el=Math.cos(ti),Ea=Math.sin(ti);Zr=new At(el,Ea,-Ea,el,0,0)}else ti&&ti instanceof At&&(Zr=ti);ct!==$.ADVANCED||Zr||(Zr=ye),(Ii=Gt.charSpace||Nl)!==void 0&&(Vr+=Rt(dt(Ii))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(ui=Gt.horizontalScale)!==void 0&&(Vr+=Rt(100*ui)+` Tz
`),Gt.lang;var Js=-1,Xh=Gt.renderingMode!==void 0?Gt.renderingMode:Gt.stroke,Gl=Ri.internal.getCurrentPageInfo().pageContext;switch(Xh){case 0:case!1:case"fill":Js=0;break;case 1:case!0:case"stroke":Js=1;break;case 2:case"fillThenStroke":Js=2;break;case 3:case"invisible":Js=3;break;case 4:case"fillAndAddForClipping":Js=4;break;case 5:case"strokeAndAddPathForClipping":Js=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Js=6;break;case 7:case"addToPathForClipping":Js=7}var Lr=Gl.usedRenderingMode!==void 0?Gl.usedRenderingMode:-1;Js!==-1?Vr+=Js+` Tr
`:Lr!==-1&&(Vr+=`0 Tr
`),Js!==-1&&(Gl.usedRenderingMode=Js),wi=Gt.align||"left";var As,ms=ve*ln,bc=Ri.internal.pageSize.getWidth(),Vl=Ke[Ei];Ii=Gt.charSpace||Nl,hi=Gt.maxWidth||0,rr=Object.assign({autoencode:!0,noBOM:!0},Gt.flags);var Jo=[];if(Object.prototype.toString.call(D)==="[object Array]"){var ys;Ie=wa(D),wi!=="left"&&(As=Ie.map(function(er){return Ri.getStringUnitWidth(er,{font:Vl,charSpace:Ii,fontSize:ve,doKerning:!1})*ve/Po}));var Ss,An=0;if(wi==="right"){Q-=As[0],D=[],Ds=Ie.length;for(var kn=0;kn<Ds;kn++)kn===0?(Ss=ro(Q),ys=so(Ct)):(Ss=dt(An-As[kn]),ys=-ms),D.push([Ie[kn],Ss,ys]),An=As[kn]}else if(wi==="center"){Q-=As[0]/2,D=[],Ds=Ie.length;for(var On=0;On<Ds;On++)On===0?(Ss=ro(Q),ys=so(Ct)):(Ss=dt((An-As[On])/2),ys=-ms),D.push([Ie[On],Ss,ys]),An=As[On]}else if(wi==="left"){D=[],Ds=Ie.length;for(var Ca=0;Ca<Ds;Ca++)D.push(Ie[Ca])}else{if(wi!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');D=[],Ds=Ie.length,hi=hi!==0?hi:bc;for(var Sn=0;Sn<Ds;Sn++)ys=Sn===0?so(Ct):-ms,Ss=Sn===0?ro(Q):0,Sn<Ds-1?Jo.push(Rt(dt((hi-As[Sn])/(Ie[Sn].split(" ").length-1)))):Jo.push(0),D.push([Ie[Sn],Ss,ys])}}var Io=typeof Gt.R2L=="boolean"?Gt.R2L:ai;Io===!0&&(D=xa(D,function(er,fr,gr){return[er.split("").reverse().join(""),fr,gr]})),ee={text:D,x:Q,y:Ct,options:Gt,mutex:{pdfEscape:hs,activeFontKey:Ei,fonts:Ke,activeFontSize:ve}},st.publish("postProcessText",ee),D=ee.text,an=ee.mutex.isHex||!1;var ao=Ke[Ei].encoding;ao!=="WinAnsiEncoding"&&ao!=="StandardEncoding"||(D=xa(D,function(er,fr,gr){return[Ya(er),fr,gr]})),Ie=wa(D),D=[];for(var Zo,Dn,Mo,Ta=0,Lo=1,lo=Array.isArray(Ie[0])?Lo:Ta,ns="",cn=function(er,fr,gr){var Dr="";return gr instanceof At?(gr=typeof Gt.angle=="number"?Jt(gr,new At(1,0,0,1,er,fr)):Jt(new At(1,0,0,1,er,fr),gr),ct===$.ADVANCED&&(gr=Jt(new At(1,0,0,-1,0,0),gr)),Dr=gr.join(" ")+` Tm
`):Dr=Rt(er)+" "+Rt(fr)+` Td
`,Dr},hn=0;hn<Ie.length;hn++){switch(ns="",lo){case Lo:Mo=(an?"<":"(")+Ie[hn][0]+(an?">":")"),Zo=parseFloat(Ie[hn][1]),Dn=parseFloat(Ie[hn][2]);break;case Ta:Mo=(an?"<":"(")+Ie[hn]+(an?">":")"),Zo=ro(Q),Dn=so(Ct)}Jo!==void 0&&Jo[hn]!==void 0&&(ns=Jo[hn]+` Tw
`),hn===0?D.push(ns+cn(Zo,Dn,Zr)+Mo):lo===Ta?D.push(ns+Mo):lo===Lo&&D.push(ns+cn(Zo,Dn,Zr)+Mo)}D=lo===Ta?D.join(` Tj
T* `):D.join(` Tj
`),D+=` Tj
`;var _s=`BT
/`;return _s+=Ei+" "+ve+` Tf
`,_s+=Rt(ve*ln)+` TL
`,_s+=ya+`
`,_s+=Vr,_s+=D,Pt(_s+="ET"),P[Ei]=!0,Ri};var kl=M.__private__.clip=M.clip=function(D){return Pt(D==="evenodd"?"W*":"W"),this};M.clipEvenOdd=function(){return kl("evenodd")},M.__private__.discardPath=M.discardPath=function(){return Pt("n"),this};var ts=M.__private__.isValidStyle=function(D){var Q=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(D)!==-1&&(Q=!0),Q};M.__private__.setDefaultPathOperation=M.setDefaultPathOperation=function(D){return ts(D)&&(y=D),this};var fa=M.__private__.getStyle=M.getStyle=function(D){var Q=y;switch(D){case"D":case"S":Q="S";break;case"F":Q="f";break;case"FD":case"DF":Q="B";break;case"f":case"f*":case"B":case"B*":Q=D}return Q},Wa=M.close=function(){return Pt("h"),this};M.stroke=function(){return Pt("S"),this},M.fill=function(D){return So("f",D),this},M.fillEvenOdd=function(D){return So("f*",D),this},M.fillStroke=function(D){return So("B",D),this},M.fillStrokeEvenOdd=function(D){return So("B*",D),this};var So=function(D,Q){Fr(Q)==="object"?Za(Q,D):Pt(D)},qo=function(D){D===null||ct===$.ADVANCED&&D===void 0||(D=fa(D),Pt(D))};function Ja(D,Q,Ct,Gt,Yt){var ee=new Sd(Q||this.boundingBox,Ct||this.xStep,Gt||this.yStep,this.gState,Yt||this.matrix);ee.stream=this.stream;var Ie=D+"$$"+this.cloneIndex+++"$$";return he(Ie,ee),ee}var Za=function(D,Q){var Ct=vi[D.key],Gt=Di[Ct];if(Gt instanceof xu)Pt("q"),Pt(Jh(Q)),Gt.gState&&M.setGState(Gt.gState),Pt(D.matrix.toString()+" cm"),Pt("/"+Ct+" sh"),Pt("Q");else if(Gt instanceof Sd){var Yt=new At(1,0,0,-1,0,To());D.matrix&&(Yt=Yt.multiply(D.matrix||ye),Ct=Ja.call(Gt,D.key,D.boundingBox,D.xStep,D.yStep,Yt).id),Pt("q"),Pt("/Pattern cs"),Pt("/"+Ct+" scn"),Gt.gState&&M.setGState(Gt.gState),Pt(Q),Pt("Q")}},Jh=function(D){switch(D){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},gc=M.moveTo=function(D,Q){return Pt(Rt(dt(D))+" "+Rt(wt(Q))+" m"),this},ga=M.lineTo=function(D,Q){return Pt(Rt(dt(D))+" "+Rt(wt(Q))+" l"),this},ma=M.curveTo=function(D,Q,Ct,Gt,Yt,ee){return Pt([Rt(dt(D)),Rt(wt(Q)),Rt(dt(Ct)),Rt(wt(Gt)),Rt(dt(Yt)),Rt(wt(ee)),"c"].join(" ")),this};M.__private__.line=M.line=function(D,Q,Ct,Gt,Yt){if(isNaN(D)||isNaN(Q)||isNaN(Ct)||isNaN(Gt)||!ts(Yt))throw new Error("Invalid arguments passed to jsPDF.line");return ct===$.COMPAT?this.lines([[Ct-D,Gt-Q]],D,Q,[1,1],Yt||"S"):this.lines([[Ct-D,Gt-Q]],D,Q,[1,1]).stroke()},M.__private__.lines=M.lines=function(D,Q,Ct,Gt,Yt,ee){var Ie,ti,wi,Ii,hi,rr,ui,Zr,Ri,Fi,Vr,an;if(typeof D=="number"&&(an=Ct,Ct=Q,Q=D,D=an),Gt=Gt||[1,1],ee=ee||!1,isNaN(Q)||isNaN(Ct)||!Array.isArray(D)||!Array.isArray(Gt)||!ts(Yt)||typeof ee!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(gc(Q,Ct),Ie=Gt[0],ti=Gt[1],Ii=D.length,Fi=Q,Vr=Ct,wi=0;wi<Ii;wi++)(hi=D[wi]).length===2?(Fi=hi[0]*Ie+Fi,Vr=hi[1]*ti+Vr,ga(Fi,Vr)):(rr=hi[0]*Ie+Fi,ui=hi[1]*ti+Vr,Zr=hi[2]*Ie+Fi,Ri=hi[3]*ti+Vr,Fi=hi[4]*Ie+Fi,Vr=hi[5]*ti+Vr,ma(rr,ui,Zr,Ri,Fi,Vr));return ee&&Wa(),qo(Yt),this},M.path=function(D){for(var Q=0;Q<D.length;Q++){var Ct=D[Q],Gt=Ct.c;switch(Ct.op){case"m":gc(Gt[0],Gt[1]);break;case"l":ga(Gt[0],Gt[1]);break;case"c":ma.apply(this,Gt);break;case"h":Wa()}}return this},M.__private__.rect=M.rect=function(D,Q,Ct,Gt,Yt){if(isNaN(D)||isNaN(Q)||isNaN(Ct)||isNaN(Gt)||!ts(Yt))throw new Error("Invalid arguments passed to jsPDF.rect");return ct===$.COMPAT&&(Gt=-Gt),Pt([Rt(dt(D)),Rt(wt(Q)),Rt(dt(Ct)),Rt(dt(Gt)),"re"].join(" ")),qo(Yt),this},M.__private__.triangle=M.triangle=function(D,Q,Ct,Gt,Yt,ee,Ie){if(isNaN(D)||isNaN(Q)||isNaN(Ct)||isNaN(Gt)||isNaN(Yt)||isNaN(ee)||!ts(Ie))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Ct-D,Gt-Q],[Yt-Ct,ee-Gt],[D-Yt,Q-ee]],D,Q,[1,1],Ie,!0),this},M.__private__.roundedRect=M.roundedRect=function(D,Q,Ct,Gt,Yt,ee,Ie){if(isNaN(D)||isNaN(Q)||isNaN(Ct)||isNaN(Gt)||isNaN(Yt)||isNaN(ee)||!ts(Ie))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ti=4/3*(Math.SQRT2-1);return Yt=Math.min(Yt,.5*Ct),ee=Math.min(ee,.5*Gt),this.lines([[Ct-2*Yt,0],[Yt*ti,0,Yt,ee-ee*ti,Yt,ee],[0,Gt-2*ee],[0,ee*ti,-Yt*ti,ee,-Yt,ee],[2*Yt-Ct,0],[-Yt*ti,0,-Yt,-ee*ti,-Yt,-ee],[0,2*ee-Gt],[0,-ee*ti,Yt*ti,-ee,Yt,-ee]],D+Yt,Q,[1,1],Ie,!0),this},M.__private__.ellipse=M.ellipse=function(D,Q,Ct,Gt,Yt){if(isNaN(D)||isNaN(Q)||isNaN(Ct)||isNaN(Gt)||!ts(Yt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ee=4/3*(Math.SQRT2-1)*Ct,Ie=4/3*(Math.SQRT2-1)*Gt;return gc(D+Ct,Q),ma(D+Ct,Q-Ie,D+ee,Q-Gt,D,Q-Gt),ma(D-ee,Q-Gt,D-Ct,Q-Ie,D-Ct,Q),ma(D-Ct,Q+Ie,D-ee,Q+Gt,D,Q+Gt),ma(D+ee,Q+Gt,D+Ct,Q+Ie,D+Ct,Q),qo(Yt),this},M.__private__.circle=M.circle=function(D,Q,Ct,Gt){if(isNaN(D)||isNaN(Q)||isNaN(Ct)||!ts(Gt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(D,Q,Ct,Ct,Gt)},M.setFont=function(D,Q,Ct){return Ct&&(Q=Nt(Q,Ct)),Ei=rt(D,Q,{disableWarning:!1}),this};var Ho=M.__private__.getFont=M.getFont=function(){return Ke[rt.apply(M,arguments)]};M.__private__.getFontList=M.getFontList=function(){var D,Q,Ct={};for(D in Qe)if(Qe.hasOwnProperty(D))for(Q in Ct[D]=[],Qe[D])Qe[D].hasOwnProperty(Q)&&Ct[D].push(Q);return Ct},M.addFont=function(D,Q,Ct,Gt,Yt){var ee=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ee.indexOf(arguments[3])!==-1?Yt=arguments[3]:arguments[3]&&ee.indexOf(arguments[3])==-1&&(Ct=Nt(Ct,Gt)),Yt=Yt||"Identity-H",Rn.call(this,D,Q,Ct,Yt)};var Eo,gs=i.lineWidth||.200025,ss=M.__private__.getLineWidth=M.getLineWidth=function(){return gs},Xi=M.__private__.setLineWidth=M.setLineWidth=function(D){return gs=D,Pt(Rt(dt(D))+" w"),this};M.__private__.setLineDash=ki.API.setLineDash=ki.API.setLineDashPattern=function(D,Q){if(D=D||[],Q=Q||0,isNaN(Q)||!Array.isArray(D))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return D=D.map(function(Ct){return Rt(dt(Ct))}).join(" "),Q=Rt(dt(Q)),Pt("["+D+"] "+Q+" d"),this};var Xa=M.__private__.getLineHeight=M.getLineHeight=function(){return ve*Eo};M.__private__.getLineHeight=M.getLineHeight=function(){return ve*Eo};var $a=M.__private__.setLineHeightFactor=M.setLineHeightFactor=function(D){return typeof(D=D||1.15)=="number"&&(Eo=D),this},Ol=M.__private__.getLineHeightFactor=M.getLineHeightFactor=function(){return Eo};$a(i.lineHeight);var ro=M.__private__.getHorizontalCoordinate=function(D){return dt(D)},so=M.__private__.getVerticalCoordinate=function(D){return ct===$.ADVANCED?D:Y[Et].mediaBox.topRightY-Y[Et].mediaBox.bottomLeftY-dt(D)},mc=M.__private__.getHorizontalCoordinateString=M.getHorizontalCoordinateString=function(D){return Rt(ro(D))},Co=M.__private__.getVerticalCoordinateString=M.getVerticalCoordinateString=function(D){return Rt(so(D))},on=i.strokeColor||"0 G";M.__private__.getStrokeColor=M.getDrawColor=function(){return Ni(on)},M.__private__.setStrokeColor=M.setDrawColor=function(D,Q,Ct,Gt){return on=Hi({ch1:D,ch2:Q,ch3:Ct,ch4:Gt,pdfColorType:"draw",precision:2}),Pt(on),this};var Dl=i.fillColor||"0 g";M.__private__.getFillColor=M.getFillColor=function(){return Ni(Dl)},M.__private__.setFillColor=M.setFillColor=function(D,Q,Ct,Gt){return Dl=Hi({ch1:D,ch2:Q,ch3:Ct,ch4:Gt,pdfColorType:"fill",precision:2}),Pt(Dl),this};var ya=i.textColor||"0 g",_a=M.__private__.getTextColor=M.getTextColor=function(){return Ni(ya)};M.__private__.setTextColor=M.setTextColor=function(D,Q,Ct,Gt){return ya=Hi({ch1:D,ch2:Q,ch3:Ct,ch4:Gt,pdfColorType:"text",precision:3}),this};var Nl=i.charSpace,Zh=M.__private__.getCharSpace=M.getCharSpace=function(){return parseFloat(Nl||0)};M.__private__.setCharSpace=M.setCharSpace=function(D){if(isNaN(D))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Nl=D,this};var yc=0;M.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},M.__private__.setLineCap=M.setLineCap=function(D){var Q=M.CapJoinStyles[D];if(Q===void 0)throw new Error("Line cap style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return yc=Q,Pt(Q+" J"),this};var _c=0;M.__private__.setLineJoin=M.setLineJoin=function(D){var Q=M.CapJoinStyles[D];if(Q===void 0)throw new Error("Line join style of '"+D+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return _c=Q,Pt(Q+" j"),this},M.__private__.setLineMiterLimit=M.__private__.setMiterLimit=M.setLineMiterLimit=M.setMiterLimit=function(D){if(D=D||0,isNaN(D))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Pt(Rt(dt(D))+" M"),this},M.GState=_m,M.setGState=function(D){(D=typeof D=="string"?yr[sr[D]]:sh(null,D)).equals(vt)||(Pt("/"+D.id+" gs"),vt=D)};var sh=function(D,Q){if(!D||!sr[D]){var Ct=!1;for(var Gt in yr)if(yr.hasOwnProperty(Gt)&&yr[Gt].equals(Q)){Ct=!0;break}if(Ct)Q=yr[Gt];else{var Yt="GS"+(Object.keys(yr).length+1).toString(10);yr[Yt]=Q,Q.id=Yt}return D&&(sr[D]=Q.id),st.publish("addGState",Q),Q}};M.addGState=function(D,Q){return sh(D,Q),this},M.saveGraphicsState=function(){return Pt("q"),hr.push({key:Ei,size:ve,color:ya}),this},M.restoreGraphicsState=function(){Pt("Q");var D=hr.pop();return Ei=D.key,ve=D.size,ya=D.color,vt=null,this},M.setCurrentTransformationMatrix=function(D){return Pt(D.toString()+" cm"),this},M.comment=function(D){return Pt("#"+D),this};var Fl=function(D,Q){var Ct=D||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Ct},set:function(ee){isNaN(ee)||(Ct=parseFloat(ee))}});var Gt=Q||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Gt},set:function(ee){isNaN(ee)||(Gt=parseFloat(ee))}});var Yt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Yt},set:function(ee){Yt=ee.toString()}}),this},Ka=function(D,Q,Ct,Gt){Fl.call(this,D,Q),this.type="rect";var Yt=Ct||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Yt},set:function(Ie){isNaN(Ie)||(Yt=parseFloat(Ie))}});var ee=Gt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ee},set:function(Ie){isNaN(Ie)||(ee=parseFloat(Ie))}}),this},va=function(){this.page=K,this.currentPage=Et,this.pages=Le.slice(0),this.pagesContext=Y.slice(0),this.x=jr,this.y=Ci,this.matrix=Te,this.width=ba(Et),this.height=To(Et),this.outputDestination=Ge,this.id="",this.objectNumber=-1};va.prototype.restore=function(){K=this.page,Et=this.currentPage,Y=this.pagesContext,Le=this.pages,jr=this.x,Ci=this.y,Te=this.matrix,jl(Et,this.width),oo(Et,this.height),Ge=this.outputDestination};var zl=function(D,Q,Ct,Gt,Yt){Vt.push(new va),K=Et=0,Le=[],jr=D,Ci=Q,Te=Yt,Zi([Ct,Gt])},vc=function(D){if(Ft[D])Vt.pop().restore();else{var Q=new va,Ct="Xo"+(Object.keys(kt).length+1).toString(10);Q.id=Ct,Ft[D]=Ct,kt[Ct]=Q,st.publish("addFormObject",Q),Vt.pop().restore()}};for(var no in M.beginFormObject=function(D,Q,Ct,Gt,Yt){return zl(D,Q,Ct,Gt,Yt),this},M.endFormObject=function(D){return vc(D),this},M.doFormObject=function(D,Q){var Ct=kt[Ft[D]];return Pt("q"),Pt(Q.toString()+" cm"),Pt("/"+Ct.id+" Do"),Pt("Q"),this},M.getFormObject=function(D){var Q=kt[Ft[D]];return{x:Q.x,y:Q.y,width:Q.width,height:Q.height,matrix:Q.matrix}},M.save=function(D,Q){return D=D||"generated.pdf",(Q=Q||{}).returnPromise=Q.returnPromise||!1,Q.returnPromise===!1?(vu(pr(Mi()),D),typeof vu.unload=="function"&&Oi.setTimeout&&setTimeout(vu.unload,911),this):new Promise(function(Ct,Gt){try{var Yt=vu(pr(Mi()),D);typeof vu.unload=="function"&&Oi.setTimeout&&setTimeout(vu.unload,911),Ct(Yt)}catch(ee){Gt(ee.message)}})},ki.API)ki.API.hasOwnProperty(no)&&(no==="events"&&ki.API.events.length?function(D,Q){var Ct,Gt,Yt;for(Yt=Q.length-1;Yt!==-1;Yt--)Ct=Q[Yt][0],Gt=Q[Yt][1],D.subscribe.apply(D,[Ct].concat(typeof Gt=="function"?[Gt]:Gt))}(st,ki.API.events):M[no]=ki.API[no]);var ba=M.getPageWidth=function(D){return(Y[D=D||Et].mediaBox.topRightX-Y[D].mediaBox.bottomLeftX)/Re},jl=M.setPageWidth=function(D,Q){Y[D].mediaBox.topRightX=Q*Re+Y[D].mediaBox.bottomLeftX},To=M.getPageHeight=function(D){return(Y[D=D||Et].mediaBox.topRightY-Y[D].mediaBox.bottomLeftY)/Re},oo=M.setPageHeight=function(D,Q){Y[D].mediaBox.topRightY=Q*Re+Y[D].mediaBox.bottomLeftY};return M.internal={pdfEscape:hs,getStyle:fa,getFont:Ho,getFontSize:Ve,getCharSpace:Zh,getTextColor:_a,getLineHeight:Xa,getLineHeightFactor:Ol,getLineWidth:ss,write:Zt,getHorizontalCoordinate:ro,getVerticalCoordinate:so,getCoordinateString:mc,getVerticalCoordinateString:Co,collections:{},newObject:ae,newAdditionalObject:bi,newObjectDeferred:qe,newObjectDeferredBegin:Je,getFilters:nr,putStream:li,events:st,scaleFactor:Re,pageSize:{getWidth:function(){return ba(Et)},setWidth:function(D){jl(Et,D)},getHeight:function(){return To(Et)},setHeight:function(D){oo(Et,D)}},encryptionOptions:x,encryption:Ar,getEncryptor:rh,output:fs,getNumberOfPages:pa,pages:Le,out:Pt,f2:zt,f3:ot,getPageInfo:Ha,getPageInfoByObjId:Li,getCurrentPageInfo:Vo,getPDFVersion:G,Point:Fl,Rectangle:Ka,Matrix:At,hasHotfix:rs},Object.defineProperty(M.internal.pageSize,"width",{get:function(){return ba(Et)},set:function(D){jl(Et,D)},enumerable:!0,configurable:!0}),Object.defineProperty(M.internal.pageSize,"height",{get:function(){return To(Et)},set:function(D){oo(Et,D)},enumerable:!0,configurable:!0}),ds.call(M,Pe),Ei="F1",eo(s,e),st.publish("initialized"),M}yd.prototype.lsbFirstWord=function(i){return String.fromCharCode(i>>0&255,i>>8&255,i>>16&255,i>>24&255)},yd.prototype.toHexString=function(i){return i.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},yd.prototype.hexToBytes=function(i){for(var t=[],e=0;e<i.length;e+=2)t.push(String.fromCharCode(parseInt(i.substr(e,2),16)));return t.join("")},yd.prototype.processOwnerPassword=function(i,t){return Z_(J_(t).substr(0,5),i)},yd.prototype.encryptor=function(i,t){var e=J_(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&t,t>>8&255)).substr(0,10);return function(r){return Z_(e,r)}},_m.prototype.equals=function(i){var t,e="id,objectNumber,equals";if(!i||Fr(i)!==Fr(this))return!1;var r=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!i.hasOwnProperty(t)||this[t]!==i[t])return!1;r++}for(t in i)i.hasOwnProperty(t)&&e.indexOf(t)<0&&r--;return r===0},ki.API={events:[]},ki.version="2.5.1";var Bs=ki.API,Cv=1,Fu=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},pd=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Vi=function(i){return i.toFixed(2)},kh=function(i){return i.toFixed(5)};Bs.__acroform__={};var Uo=function(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i},O5=function(i){return i*Cv},rc=function(i){var t=new wE,e=fi.internal.getHeight(i)||0,r=fi.internal.getWidth(i)||0;return t.BBox=[0,0,Number(Vi(r)),Number(Vi(e))],t},eV=Bs.__acroform__.setBit=function(i,t){if(i=i||0,t=t||0,isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|=1<<t},iV=Bs.__acroform__.clearBit=function(i,t){if(i=i||0,t=t||0,isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&=~(1<<t)},rV=Bs.__acroform__.getBit=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<t?1:0},qs=Bs.__acroform__.getBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return rV(i,t-1)},Hs=Bs.__acroform__.setBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return eV(i,t-1)},Ws=Bs.__acroform__.clearBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return iV(i,t-1)},sV=Bs.__acroform__.calculateCoordinates=function(i,t){var e=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,s=i[0],n=i[1],c=i[2],l=i[3],f={};return f.lowerLeft_X=e(s)||0,f.lowerLeft_Y=r(n+l)||0,f.upperRight_X=e(s+c)||0,f.upperRight_Y=r(n)||0,[Number(Vi(f.lowerLeft_X)),Number(Vi(f.lowerLeft_Y)),Number(Vi(f.upperRight_X)),Number(Vi(f.upperRight_Y))]},nV=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var t=[],e=i._V||i.DV,r=X_(i,e),s=i.scope.internal.getFont(i.fontName,i.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(i.scope.__private__.encodeColorString(i.color)),t.push("/"+s+" "+Vi(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var n=rc(i);return n.scope=i.scope,n.stream=t.join(`
`),n}},X_=function(i,t){var e=i.fontSize===0?i.maxFontSize:i.fontSize,r={text:"",fontSize:""},s=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");s=i.multiline?s.map(function(ot){return ot.split(`
`)}):s.map(function(ot){return[ot]});var n=e,c=fi.internal.getHeight(i)||0;c=c<0?-c:c;var l=fi.internal.getWidth(i)||0;l=l<0?-l:l;var f=function(ot,dt,Lt){if(ot+1<s.length){var wt=dt+" "+s[ot+1][0];return Eg(wt,i,Lt).width<=l-4}return!1};n++;t:for(;n>0;){t="",n--;var y,x,T=Eg("3",i,n).height,P=i.multiline?c-n:(c-T)/2,M=P+=2,N=0,G=0,Z=0;if(n<=0){t=`(...) Tj
`,t+="% Width of Text: "+Eg(t,i,n=12).width+", FieldWidth:"+l+`
`;break}for(var X="",$=0,ct=0;ct<s.length;ct++)if(s.hasOwnProperty(ct)){var yt=!1;if(s[ct].length!==1&&Z!==s[ct].length-1){if((T+2)*($+2)+2>c)continue t;X+=s[ct][Z],yt=!0,G=ct,ct--}else{X=(X+=s[ct][Z]+" ").substr(X.length-1)==" "?X.substr(0,X.length-1):X;var Mt=parseInt(ct),Nt=f(Mt,X,n),Rt=ct>=s.length-1;if(Nt&&!Rt){X+=" ",Z=0;continue}if(Nt||Rt){if(Rt)G=Mt;else if(i.multiline&&(T+2)*($+2)+2>c)continue t}else{if(!i.multiline||(T+2)*($+2)+2>c)continue t;G=Mt}}for(var xt="",qt=N;qt<=G;qt++){var zt=s[qt];if(i.multiline){if(qt===G){xt+=zt[Z]+" ",Z=(Z+1)%zt.length;continue}if(qt===N){xt+=zt[zt.length-1]+" ";continue}}xt+=zt[0]+" "}switch(xt=xt.substr(xt.length-1)==" "?xt.substr(0,xt.length-1):xt,x=Eg(xt,i,n).width,i.textAlign){case"right":y=l-x-2;break;case"center":y=(l-x)/2;break;case"left":default:y=2}t+=Vi(y)+" "+Vi(M)+` Td
`,t+="("+Fu(xt)+`) Tj
`,t+=-Vi(y)+` 0 Td
`,M=-(n+2),x=0,N=yt?G:G+1,$++,X=""}break}return r.text=t,r.fontSize=n,r},Eg=function(i,t,e){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),s=t.scope.getStringUnitWidth(i,{font:r,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:s}},oV={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},aV=function(i,t){var e={type:"reference",object:i};t.internal.getPageInfo(i.page).pageContext.annotations.find(function(r){return r.type===e.type&&r.object===e.object})===void 0&&t.internal.getPageInfo(i.page).pageContext.annotations.push(e)},lV=function(i,t){for(var e in i)if(i.hasOwnProperty(e)){var r=e,s=i[e];t.internal.newObjectDeferredBegin(s.objId,!0),Fr(s)==="object"&&typeof s.putStream=="function"&&s.putStream(),delete i[r]}},cV=function(i,t){if(t.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(Bl.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(oV)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Cv=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new xE,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var s in r)if(r.hasOwnProperty(s)){var n=r[s];n.objId=void 0,n.hasAnnotation&&aV(n,e)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(e){(function(r,s){var n=!r;for(var c in r||(s.internal.newObjectDeferredBegin(s.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),s.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||s.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(c)){var l=r[c],f=[],y=l.Rect;if(l.Rect&&(l.Rect=sV(l.Rect,s)),s.internal.newObjectDeferredBegin(l.objId,!0),l.DA=fi.createDefaultAppearanceStream(l),Fr(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(f=l.getKeyValueListForStream()),l.Rect=y,l.hasAppearanceStream&&!l.appearanceStreamContent){var x=nV(l);f.push({key:"AP",value:"<</N "+x+">>"}),s.internal.acroformPlugin.xForms.push(x)}if(l.appearanceStreamContent){var T="";for(var P in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(P)){var M=l.appearanceStreamContent[P];if(T+="/"+P+" ",T+="<<",Object.keys(M).length>=1||Array.isArray(M)){for(var c in M)if(M.hasOwnProperty(c)){var N=M[c];typeof N=="function"&&(N=N.call(s,l)),T+="/"+c+" "+N+" ",s.internal.acroformPlugin.xForms.indexOf(N)>=0||s.internal.acroformPlugin.xForms.push(N)}}else typeof(N=M)=="function"&&(N=N.call(s,l)),T+="/"+c+" "+N,s.internal.acroformPlugin.xForms.indexOf(N)>=0||s.internal.acroformPlugin.xForms.push(N);T+=">>"}f.push({key:"AP",value:`<<
`+T+">>"})}s.internal.putStream({additionalKeyValues:f,objectId:l.objId}),s.internal.out("endobj")}n&&lV(s.internal.acroformPlugin.xForms,s)})(e,i)}),i.internal.acroformPlugin.isInitialized=!0}},bE=Bs.__acroform__.arrayToPdfArray=function(i,t,e){var r=function(c){return c};if(Array.isArray(i)){for(var s="[",n=0;n<i.length;n++)switch(n!==0&&(s+=" "),Fr(i[n])){case"boolean":case"number":case"object":s+=i[n].toString();break;case"string":i[n].substr(0,1)!=="/"?(t!==void 0&&e&&(r=e.internal.getEncryptor(t)),s+="("+Fu(r(i[n].toString()))+")"):s+=i[n].toString()}return s+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},jy=function(i,t,e){var r=function(s){return s};return t!==void 0&&e&&(r=e.internal.getEncryptor(t)),(i=i||"").toString(),i="("+Fu(r(i))+")"},cc=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};cc.prototype.toString=function(){return this.objId+" 0 R"},cc.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},cc.prototype.getKeyValueListForStream=function(){var i=[],t=Object.getOwnPropertyNames(this).filter(function(n){return n!="content"&&n!="appearanceStreamContent"&&n!="scope"&&n!="objId"&&n.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var r=t[e],s=this[r];s&&(Array.isArray(s)?i.push({key:r,value:bE(s,this.objId,this.scope)}):s instanceof cc?(s.scope=this.scope,i.push({key:r,value:s.objId+" 0 R"})):typeof s!="function"&&i.push({key:r,value:s}))}return i};var wE=function(){cc.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){i=e.trim()},get:function(){return i||null}})};Uo(wE,cc);var xE=function(){cc.call(this);var i,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var e=function(r){return r};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Fu(e(i))+")"}},set:function(e){i=e}})};Uo(xE,cc);var Bl=function i(){cc.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(X){if(isNaN(X))throw new Error('Invalid value "'+X+'" for attribute F supplied.');t=X}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!qs(t,3)},set:function(X){X?this.F=Hs(t,3):this.F=Ws(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(X){if(isNaN(X))throw new Error('Invalid value "'+X+'" for attribute Ff supplied.');e=X}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(X){r=X!==void 0?X:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(X){r[0]=X}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(X){r[1]=X}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(X){r[2]=X}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(X){r[3]=X}});var s="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return s},set:function(X){switch(X){case"/Btn":case"/Tx":case"/Ch":case"/Sig":s=X;break;default:throw new Error('Invalid value "'+X+'" for attribute FT supplied.')}}});var n=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!n||n.length<1){if(this instanceof vm)return;n="FieldObject"+i.FieldNum++}var X=function($){return $};return this.scope&&(X=this.scope.internal.getEncryptor(this.objId)),"("+Fu(X(n))+")"},set:function(X){n=X.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return n},set:function(X){n=X}});var c="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return c},set:function(X){c=X}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(X){l=X}});var f=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return f},set:function(X){f=X}});var y=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return y===void 0?50/Cv:y},set:function(X){y=X}});var x="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return x},set:function(X){x=X}});var T="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!T||this instanceof vm||this instanceof Iu))return jy(T,this.objId,this.scope)},set:function(X){X=X.toString(),T=X}});var P=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(P)return this instanceof _n?P:jy(P,this.objId,this.scope)},set:function(X){X=X.toString(),P=this instanceof _n?X:X.substr(0,1)==="("?pd(X.substr(1,X.length-2)):pd(X)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof _n?pd(P.substr(1,P.length-1)):P},set:function(X){X=X.toString(),P=this instanceof _n?"/"+X:X}});var M=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(M)return M},set:function(X){this.V=X}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(M)return this instanceof _n?M:jy(M,this.objId,this.scope)},set:function(X){X=X.toString(),M=this instanceof _n?X:X.substr(0,1)==="("?pd(X.substr(1,X.length-2)):pd(X)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof _n?pd(M.substr(1,M.length-1)):M},set:function(X){X=X.toString(),M=this instanceof _n?"/"+X:X}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var N,G=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return G},set:function(X){X=!!X,G=X}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(N)return N},set:function(X){N=X}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,1)},set:function(X){X?this.Ff=Hs(this.Ff,1):this.Ff=Ws(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,2)},set:function(X){X?this.Ff=Hs(this.Ff,2):this.Ff=Ws(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,3)},set:function(X){X?this.Ff=Hs(this.Ff,3):this.Ff=Ws(this.Ff,3)}});var Z=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(Z!==null)return Z},set:function(X){if([0,1,2].indexOf(X)===-1)throw new Error('Invalid value "'+X+'" for attribute Q supplied.');Z=X}}),Object.defineProperty(this,"textAlign",{get:function(){var X;switch(Z){case 0:default:X="left";break;case 1:X="center";break;case 2:X="right"}return X},configurable:!0,enumerable:!0,set:function(X){switch(X){case"right":case 2:Z=2;break;case"center":case 1:Z=1;break;case"left":case 0:default:Z=0}}})};Uo(Bl,cc);var Md=function(){Bl.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){i=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return bE(t,this.objId,this.scope)},set:function(e){var r,s;s=[],typeof(r=e)=="string"&&(s=function(n,c,l){l||(l=1);for(var f,y=[];f=c.exec(n);)y.push(f[l]);return y}(r,/\((.*?)\)/g)),t=s}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,r){for(r=r||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,18)},set:function(e){e?this.Ff=Hs(this.Ff,18):this.Ff=Ws(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Hs(this.Ff,19):this.Ff=Ws(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,20)},set:function(e){e?(this.Ff=Hs(this.Ff,20),t.sort()):this.Ff=Ws(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,22)},set:function(e){e?this.Ff=Hs(this.Ff,22):this.Ff=Ws(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,23)},set:function(e){e?this.Ff=Hs(this.Ff,23):this.Ff=Ws(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,27)},set:function(e){e?this.Ff=Hs(this.Ff,27):this.Ff=Ws(this.Ff,27)}}),this.hasAppearanceStream=!1};Uo(Md,Bl);var Ld=function(){Md.call(this),this.fontName="helvetica",this.combo=!1};Uo(Ld,Md);var Bd=function(){Ld.call(this),this.combo=!0};Uo(Bd,Ld);var Ug=function(){Bd.call(this),this.edit=!0};Uo(Ug,Bd);var _n=function(){Bl.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,15)},set:function(e){e?this.Ff=Hs(this.Ff,15):this.Ff=Ws(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,16)},set:function(e){e?this.Ff=Hs(this.Ff,16):this.Ff=Ws(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,17)},set:function(e){e?this.Ff=Hs(this.Ff,17):this.Ff=Ws(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,26)},set:function(e){e?this.Ff=Hs(this.Ff,26):this.Ff=Ws(this.Ff,26)}});var i,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(n){return n};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var r,s=[];for(r in s.push("<<"),t)s.push("/"+r+" ("+Fu(e(t[r]))+")");return s.push(">>"),s.join(`
`)}},set:function(e){Fr(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(e){i="/"+e}})};Uo(_n,Bl);var Gg=function(){_n.call(this),this.pushButton=!0};Uo(Gg,_n);var Rd=function(){_n.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t!==void 0?t:[]}})};Uo(Rd,_n);var vm=function(){var i,t;Bl.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(s){i=s}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(s){t=s}});var e,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var s=function(l){return l};this.scope&&(s=this.scope.internal.getEncryptor(this.objId));var n,c=[];for(n in c.push("<<"),r)c.push("/"+n+" ("+Fu(s(r[n]))+")");return c.push(">>"),c.join(`
`)},set:function(s){Fr(s)==="object"&&(r=s)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(s){typeof s=="string"&&(r.CA=s)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(s){e=s}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(s){e="/"+s}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=fi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Uo(vm,Bl),Rd.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=i.createAppearanceStream(e.optionName),e.caption=i.getCA()}},Rd.prototype.createOption=function(i){var t=new vm;return t.Parent=this,t.optionName=i,this.Kids.push(t),hV.call(this.scope,t),t};var Vg=function(){_n.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=fi.CheckBox.createAppearanceStream()};Uo(Vg,_n);var Iu=function(){Bl.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,13)},set:function(t){t?this.Ff=Hs(this.Ff,13):this.Ff=Ws(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,21)},set:function(t){t?this.Ff=Hs(this.Ff,21):this.Ff=Ws(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,23)},set:function(t){t?this.Ff=Hs(this.Ff,23):this.Ff=Ws(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,24)},set:function(t){t?this.Ff=Hs(this.Ff,24):this.Ff=Ws(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,25)},set:function(t){t?this.Ff=Hs(this.Ff,25):this.Ff=Ws(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,26)},set:function(t){t?this.Ff=Hs(this.Ff,26):this.Ff=Ws(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){Number.isInteger(t)&&(i=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Uo(Iu,Bl);var qg=function(){Iu.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!qs(this.Ff,14)},set:function(i){i?this.Ff=Hs(this.Ff,14):this.Ff=Ws(this.Ff,14)}}),this.password=!0};Uo(qg,Iu);var fi={CheckBox:{createAppearanceStream:function(){return{N:{On:fi.CheckBox.YesNormal},D:{On:fi.CheckBox.YesPushDown,Off:fi.CheckBox.OffPushDown}}},YesPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=i.scope.internal.getFont(i.fontName,i.fontStyle).id,s=i.scope.__private__.encodeColorString(i.color),n=X_(i,i.caption);return e.push("0.749023 g"),e.push("0 0 "+Vi(fi.internal.getWidth(i))+" "+Vi(fi.internal.getHeight(i))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+r+" "+Vi(n.fontSize)+" Tf "+s),e.push("BT"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(i){var t=rc(i);t.scope=i.scope;var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),s=[],n=fi.internal.getHeight(i),c=fi.internal.getWidth(i),l=X_(i,i.caption);return s.push("1 g"),s.push("0 0 "+Vi(c)+" "+Vi(n)+" re"),s.push("f"),s.push("q"),s.push("0 0 1 rg"),s.push("0 0 "+Vi(c-1)+" "+Vi(n-1)+" re"),s.push("W"),s.push("n"),s.push("0 g"),s.push("BT"),s.push("/"+e+" "+Vi(l.fontSize)+" Tf "+r),s.push(l.text),s.push("ET"),s.push("Q"),t.stream=s.join(`
`),t},OffPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Vi(fi.internal.getWidth(i))+" "+Vi(fi.internal.getHeight(i))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(i){var t={D:{Off:fi.RadioButton.Circle.OffPushDown},N:{}};return t.N[i]=fi.RadioButton.Circle.YesNormal,t.D[i]=fi.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.getWidth(i)<=fi.internal.getHeight(i)?fi.internal.getWidth(i)/4:fi.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var s=fi.internal.Bezier_C,n=Number((r*s).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+kh(fi.internal.getWidth(i)/2)+" "+kh(fi.internal.getHeight(i)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+n+" "+n+" "+r+" 0 "+r+" c"),e.push("-"+n+" "+r+" -"+r+" "+n+" -"+r+" 0 c"),e.push("-"+r+" -"+n+" -"+n+" -"+r+" 0 -"+r+" c"),e.push(n+" -"+r+" "+r+" -"+n+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.getWidth(i)<=fi.internal.getHeight(i)?fi.internal.getWidth(i)/4:fi.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),n=Number((s*fi.internal.Bezier_C).toFixed(5)),c=Number((r*fi.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+kh(fi.internal.getWidth(i)/2)+" "+kh(fi.internal.getHeight(i)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+n+" "+n+" "+s+" 0 "+s+" c"),e.push("-"+n+" "+s+" -"+s+" "+n+" -"+s+" 0 c"),e.push("-"+s+" -"+n+" -"+n+" -"+s+" 0 -"+s+" c"),e.push(n+" -"+s+" "+s+" -"+n+" "+s+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+kh(fi.internal.getWidth(i)/2)+" "+kh(fi.internal.getHeight(i)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+c+" "+c+" "+r+" 0 "+r+" c"),e.push("-"+c+" "+r+" -"+r+" "+c+" -"+r+" 0 c"),e.push("-"+r+" -"+c+" -"+c+" -"+r+" 0 -"+r+" c"),e.push(c+" -"+r+" "+r+" -"+c+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.getWidth(i)<=fi.internal.getHeight(i)?fi.internal.getWidth(i)/4:fi.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var s=Number((2*r).toFixed(5)),n=Number((s*fi.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+kh(fi.internal.getWidth(i)/2)+" "+kh(fi.internal.getHeight(i)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+n+" "+n+" "+s+" 0 "+s+" c"),e.push("-"+n+" "+s+" -"+s+" "+n+" -"+s+" 0 c"),e.push("-"+s+" -"+n+" -"+n+" -"+s+" 0 -"+s+" c"),e.push(n+" -"+s+" "+s+" -"+n+" "+s+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(i){var t={D:{Off:fi.RadioButton.Cross.OffPushDown},N:{}};return t.N[i]=fi.RadioButton.Cross.YesNormal,t.D[i]=fi.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(i){var t=rc(i);t.scope=i.scope;var e=[],r=fi.internal.calculateCross(i);return e.push("q"),e.push("1 1 "+Vi(fi.internal.getWidth(i)-2)+" "+Vi(fi.internal.getHeight(i)-2)+" re"),e.push("W"),e.push("n"),e.push(Vi(r.x1.x)+" "+Vi(r.x1.y)+" m"),e.push(Vi(r.x2.x)+" "+Vi(r.x2.y)+" l"),e.push(Vi(r.x4.x)+" "+Vi(r.x4.y)+" m"),e.push(Vi(r.x3.x)+" "+Vi(r.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=fi.internal.calculateCross(i),r=[];return r.push("0.749023 g"),r.push("0 0 "+Vi(fi.internal.getWidth(i))+" "+Vi(fi.internal.getHeight(i))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Vi(fi.internal.getWidth(i)-2)+" "+Vi(fi.internal.getHeight(i)-2)+" re"),r.push("W"),r.push("n"),r.push(Vi(e.x1.x)+" "+Vi(e.x1.y)+" m"),r.push(Vi(e.x2.x)+" "+Vi(e.x2.y)+" l"),r.push(Vi(e.x4.x)+" "+Vi(e.x4.y)+" m"),r.push(Vi(e.x3.x)+" "+Vi(e.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(i){var t=rc(i);t.scope=i.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Vi(fi.internal.getWidth(i))+" "+Vi(fi.internal.getHeight(i))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(i){var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,e=i.scope.__private__.encodeColorString(i.color);return"/"+t+" "+i.fontSize+" Tf "+e}};fi.internal={Bezier_C:.551915024494,calculateCross:function(i){var t=fi.internal.getWidth(i),e=fi.internal.getHeight(i),r=Math.min(t,e);return{x1:{x:(t-r)/2,y:(e-r)/2+r},x2:{x:(t-r)/2+r,y:(e-r)/2},x3:{x:(t-r)/2,y:(e-r)/2},x4:{x:(t-r)/2+r,y:(e-r)/2+r}}}},fi.internal.getWidth=function(i){var t=0;return Fr(i)==="object"&&(t=O5(i.Rect[2])),t},fi.internal.getHeight=function(i){var t=0;return Fr(i)==="object"&&(t=O5(i.Rect[3])),t};var hV=Bs.addField=function(i){if(cV(this,i),!(i instanceof Bl))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=i).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Bs.AcroFormChoiceField=Md,Bs.AcroFormListBox=Ld,Bs.AcroFormComboBox=Bd,Bs.AcroFormEditBox=Ug,Bs.AcroFormButton=_n,Bs.AcroFormPushButton=Gg,Bs.AcroFormRadioButton=Rd,Bs.AcroFormCheckBox=Vg,Bs.AcroFormTextField=Iu,Bs.AcroFormPasswordField=qg,Bs.AcroFormAppearance=fi,Bs.AcroForm={ChoiceField:Md,ListBox:Ld,ComboBox:Bd,EditBox:Ug,Button:_n,PushButton:Gg,RadioButton:Rd,CheckBox:Vg,TextField:Iu,PasswordField:qg,Appearance:fi},ki.AcroForm={ChoiceField:Md,ListBox:Ld,ComboBox:Bd,EditBox:Ug,Button:_n,PushButton:Gg,RadioButton:Rd,CheckBox:Vg,TextField:Iu,PasswordField:qg,Appearance:fi};function AE(i){return i.reduce(function(t,e,r){return t[e]=r,t},{})}(function(i){i.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(ot,dt){var Lt,wt,le,oe,de,te=t;if((dt=dt||t)==="RGBA"||ot.data!==void 0&&ot.data instanceof Uint8ClampedArray&&"height"in ot&&"width"in ot)return"RGBA";if(Nt(ot))for(de in e)for(le=e[de],Lt=0;Lt<le.length;Lt+=1){for(oe=!0,wt=0;wt<le[Lt].length;wt+=1)if(le[Lt][wt]!==void 0&&le[Lt][wt]!==ot[wt]){oe=!1;break}if(oe===!0){te=de;break}}else for(de in e)for(le=e[de],Lt=0;Lt<le.length;Lt+=1){for(oe=!0,wt=0;wt<le[Lt].length;wt+=1)if(le[Lt][wt]!==void 0&&le[Lt][wt]!==ot.charCodeAt(wt)){oe=!1;break}if(oe===!0){te=de;break}}return te===t&&dt!==t&&(te=dt),te},s=function ot(dt){for(var Lt=this.internal.write,wt=this.internal.putStream,le=(0,this.internal.getFilters)();le.indexOf("FlateEncode")!==-1;)le.splice(le.indexOf("FlateEncode"),1);dt.objectId=this.internal.newObject();var oe=[];if(oe.push({key:"Type",value:"/XObject"}),oe.push({key:"Subtype",value:"/Image"}),oe.push({key:"Width",value:dt.width}),oe.push({key:"Height",value:dt.height}),dt.colorSpace===Z.INDEXED?oe.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(dt.palette.length/3-1)+" "+("sMask"in dt&&dt.sMask!==void 0?dt.objectId+2:dt.objectId+1)+" 0 R]"}):(oe.push({key:"ColorSpace",value:"/"+dt.colorSpace}),dt.colorSpace===Z.DEVICE_CMYK&&oe.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),oe.push({key:"BitsPerComponent",value:dt.bitsPerComponent}),"decodeParameters"in dt&&dt.decodeParameters!==void 0&&oe.push({key:"DecodeParms",value:"<<"+dt.decodeParameters+">>"}),"transparency"in dt&&Array.isArray(dt.transparency)){for(var de="",te=0,me=dt.transparency.length;te<me;te++)de+=dt.transparency[te]+" "+dt.transparency[te]+" ";oe.push({key:"Mask",value:"["+de+"]"})}dt.sMask!==void 0&&oe.push({key:"SMask",value:dt.objectId+1+" 0 R"});var ge=dt.filter!==void 0?["/"+dt.filter]:void 0;if(wt({data:dt.data,additionalKeyValues:oe,alreadyAppliedFilters:ge,objectId:dt.objectId}),Lt("endobj"),"sMask"in dt&&dt.sMask!==void 0){var ke="/Predictor "+dt.predictor+" /Colors 1 /BitsPerComponent "+dt.bitsPerComponent+" /Columns "+dt.width,it={width:dt.width,height:dt.height,colorSpace:"DeviceGray",bitsPerComponent:dt.bitsPerComponent,decodeParameters:ke,data:dt.sMask};"filter"in dt&&(it.filter=dt.filter),ot.call(this,it)}if(dt.colorSpace===Z.INDEXED){var Et=this.internal.newObject();wt({data:xt(new Uint8Array(dt.palette)),objectId:Et}),Lt("endobj")}},n=function(){var ot=this.internal.collections.addImage_images;for(var dt in ot)s.call(this,ot[dt])},c=function(){var ot,dt=this.internal.collections.addImage_images,Lt=this.internal.write;for(var wt in dt)Lt("/I"+(ot=dt[wt]).index,ot.objectId,"0","R")},l=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",n),this.internal.events.subscribe("putXobjectDict",c))},f=function(){var ot=this.internal.collections.addImage_images;return l.call(this),ot},y=function(){return Object.keys(this.internal.collections.addImage_images).length},x=function(ot){return typeof i["process"+ot.toUpperCase()]=="function"},T=function(ot){return Fr(ot)==="object"&&ot.nodeType===1},P=function(ot,dt){if(ot.nodeName==="IMG"&&ot.hasAttribute("src")){var Lt=""+ot.getAttribute("src");if(Lt.indexOf("data:image/")===0)return Zp(unescape(Lt).split("base64,").pop());var wt=i.loadFile(Lt,!0);if(wt!==void 0)return wt}if(ot.nodeName==="CANVAS"){if(ot.width===0||ot.height===0)throw new Error("Given canvas must have data. Canvas width: "+ot.width+", height: "+ot.height);var le;switch(dt){case"PNG":le="image/png";break;case"WEBP":le="image/webp";break;case"JPEG":case"JPG":default:le="image/jpeg"}return Zp(ot.toDataURL(le,1).split("base64,").pop())}},M=function(ot){var dt=this.internal.collections.addImage_images;if(dt){for(var Lt in dt)if(ot===dt[Lt].alias)return dt[Lt]}},N=function(ot,dt,Lt){return ot||dt||(ot=-96,dt=-96),ot<0&&(ot=-1*Lt.width*72/ot/this.internal.scaleFactor),dt<0&&(dt=-1*Lt.height*72/dt/this.internal.scaleFactor),ot===0&&(ot=dt*Lt.width/Lt.height),dt===0&&(dt=ot*Lt.height/Lt.width),[ot,dt]},G=function(ot,dt,Lt,wt,le,oe){var de=N.call(this,Lt,wt,le),te=this.internal.getCoordinateString,me=this.internal.getVerticalCoordinateString,ge=f.call(this);if(Lt=de[0],wt=de[1],ge[le.index]=le,oe){oe*=Math.PI/180;var ke=Math.cos(oe),it=Math.sin(oe),Et=function(Ut){return Ut.toFixed(4)},It=[Et(ke),Et(it),Et(-1*it),Et(ke),0,0,"cm"]}this.internal.write("q"),oe?(this.internal.write([1,"0","0",1,te(ot),me(dt+wt),"cm"].join(" ")),this.internal.write(It.join(" ")),this.internal.write([te(Lt),"0","0",te(wt),"0","0","cm"].join(" "))):this.internal.write([te(Lt),"0","0",te(wt),te(ot),me(dt+wt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+le.index+" Do"),this.internal.write("Q")},Z=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var X=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},$=i.__addimage__.sHashCode=function(ot){var dt,Lt,wt=0;if(typeof ot=="string")for(Lt=ot.length,dt=0;dt<Lt;dt++)wt=(wt<<5)-wt+ot.charCodeAt(dt),wt|=0;else if(Nt(ot))for(Lt=ot.byteLength/2,dt=0;dt<Lt;dt++)wt=(wt<<5)-wt+ot[dt],wt|=0;return wt},ct=i.__addimage__.validateStringAsBase64=function(ot){(ot=ot||"").toString().trim();var dt=!0;return ot.length===0&&(dt=!1),ot.length%4!=0&&(dt=!1),/^[A-Za-z0-9+/]+$/.test(ot.substr(0,ot.length-2))===!1&&(dt=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(ot.substr(-2))===!1&&(dt=!1),dt},yt=i.__addimage__.extractImageFromDataUrl=function(ot){var dt=(ot=ot||"").split("base64,"),Lt=null;if(dt.length===2){var wt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(dt[0]);Array.isArray(wt)&&(Lt={mimeType:wt[1],charset:wt[2],data:dt[1]})}return Lt},Mt=i.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};i.__addimage__.isArrayBuffer=function(ot){return Mt()&&ot instanceof ArrayBuffer};var Nt=i.__addimage__.isArrayBufferView=function(ot){return Mt()&&typeof Uint32Array<"u"&&(ot instanceof Int8Array||ot instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&ot instanceof Uint8ClampedArray||ot instanceof Int16Array||ot instanceof Uint16Array||ot instanceof Int32Array||ot instanceof Uint32Array||ot instanceof Float32Array||ot instanceof Float64Array)},Rt=i.__addimage__.binaryStringToUint8Array=function(ot){for(var dt=ot.length,Lt=new Uint8Array(dt),wt=0;wt<dt;wt++)Lt[wt]=ot.charCodeAt(wt);return Lt},xt=i.__addimage__.arrayBufferToBinaryString=function(ot){for(var dt="",Lt=Nt(ot)?ot:new Uint8Array(ot),wt=0;wt<Lt.length;wt+=8192)dt+=String.fromCharCode.apply(null,Lt.subarray(wt,wt+8192));return dt};i.addImage=function(){var ot,dt,Lt,wt,le,oe,de,te,me;if(typeof arguments[1]=="number"?(dt=t,Lt=arguments[1],wt=arguments[2],le=arguments[3],oe=arguments[4],de=arguments[5],te=arguments[6],me=arguments[7]):(dt=arguments[1],Lt=arguments[2],wt=arguments[3],le=arguments[4],oe=arguments[5],de=arguments[6],te=arguments[7],me=arguments[8]),Fr(ot=arguments[0])==="object"&&!T(ot)&&"imageData"in ot){var ge=ot;ot=ge.imageData,dt=ge.format||dt||t,Lt=ge.x||Lt||0,wt=ge.y||wt||0,le=ge.w||ge.width||le,oe=ge.h||ge.height||oe,de=ge.alias||de,te=ge.compression||te,me=ge.rotation||ge.angle||me}var ke=this.internal.getFilters();if(te===void 0&&ke.indexOf("FlateEncode")!==-1&&(te="SLOW"),isNaN(Lt)||isNaN(wt))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var it=qt.call(this,ot,dt,de,te);return G.call(this,Lt,wt,le,oe,it,me),this};var qt=function(ot,dt,Lt,wt){var le,oe,de;if(typeof ot=="string"&&r(ot)===t){ot=unescape(ot);var te=zt(ot,!1);(te!==""||(te=i.loadFile(ot,!0))!==void 0)&&(ot=te)}if(T(ot)&&(ot=P(ot,dt)),dt=r(ot,dt),!x(dt))throw new Error("addImage does not support files of type '"+dt+"', please ensure that a plugin for '"+dt+"' support is added.");if(((de=Lt)==null||de.length===0)&&(Lt=function(me){return typeof me=="string"||Nt(me)?$(me):Nt(me.data)?$(me.data):null}(ot)),(le=M.call(this,Lt))||(Mt()&&(ot instanceof Uint8Array||dt==="RGBA"||(oe=ot,ot=Rt(ot))),le=this["process"+dt.toUpperCase()](ot,y.call(this),Lt,function(me){return me&&typeof me=="string"&&(me=me.toUpperCase()),me in i.image_compression?me:X.NONE}(wt),oe)),!le)throw new Error("An unknown error occurred whilst processing the image.");return le},zt=i.__addimage__.convertBase64ToBinaryString=function(ot,dt){var Lt;dt=typeof dt!="boolean"||dt;var wt,le="";if(typeof ot=="string"){wt=(Lt=yt(ot))!==null?Lt.data:ot;try{le=Zp(wt)}catch(oe){if(dt)throw ct(wt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+oe.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return le};i.getImageProperties=function(ot){var dt,Lt,wt="";if(T(ot)&&(ot=P(ot)),typeof ot=="string"&&r(ot)===t&&((wt=zt(ot,!1))===""&&(wt=i.loadFile(ot)||""),ot=wt),Lt=r(ot),!x(Lt))throw new Error("addImage does not support files of type '"+Lt+"', please ensure that a plugin for '"+Lt+"' support is added.");if(!Mt()||ot instanceof Uint8Array||(ot=Rt(ot)),!(dt=this["process"+Lt.toUpperCase()](ot)))throw new Error("An unknown error occurred whilst processing the image");return dt.fileType=Lt,dt}})(ki.API),function(i){var t=function(e){if(e!==void 0&&e!="")return!0};ki.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(e){for(var r,s,n,c=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,f=this.internal.getPageInfoByObjId(e.objId),y=e.pageContext.annotations,x=!1,T=0;T<y.length&&!x;T++)switch((r=y[T]).type){case"link":(t(r.options.url)||t(r.options.pageNumber))&&(x=!0);break;case"reference":case"text":case"freetext":x=!0}if(x!=0){this.internal.write("/Annots [");for(var P=0;P<y.length;P++){r=y[P];var M=this.internal.pdfEscape,N=this.internal.getEncryptor(e.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var G=this.internal.newAdditionalObject(),Z=this.internal.newAdditionalObject(),X=this.internal.getEncryptor(G.objId),$=r.title||"Note";n="<</Type /Annot /Subtype /Text "+(s="/Rect ["+c(r.bounds.x)+" "+l(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y)+"] ")+"/Contents ("+M(X(r.contents))+")",n+=" /Popup "+Z.objId+" 0 R",n+=" /P "+f.objId+" 0 R",n+=" /T ("+M(X($))+") >>",G.content=n;var ct=G.objId+" 0 R";n="<</Type /Annot /Subtype /Popup "+(s="/Rect ["+c(r.bounds.x+30)+" "+l(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w+30)+" "+l(r.bounds.y)+"] ")+" /Parent "+ct,r.open&&(n+=" /Open true"),n+=" >>",Z.content=n,this.internal.write(G.objId,"0 R",Z.objId,"0 R");break;case"freetext":s="/Rect ["+c(r.bounds.x)+" "+l(r.bounds.y)+" "+c(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y+r.bounds.h)+"] ";var yt=r.color||"#000000";n="<</Type /Annot /Subtype /FreeText "+s+"/Contents ("+M(N(r.contents))+")",n+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+yt+")",n+=" /Border [0 0 0]",n+=" >>",this.internal.write(n);break;case"link":if(r.options.name){var Mt=this.annotations._nameMap[r.options.name];r.options.pageNumber=Mt.page,r.options.top=Mt.y}else r.options.top||(r.options.top=0);if(s="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",n="",r.options.url)n="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /A <</S /URI /URI ("+M(N(r.options.url))+") >>";else if(r.options.pageNumber)switch(n="<</Type /Annot /Subtype /Link "+s+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":n+=" /Fit]";break;case"FitH":n+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,n+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var Nt=l(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),n+=" /XYZ "+r.options.left+" "+Nt+" "+r.options.zoom+"]"}n!=""&&(n+=" >>",this.internal.write(n))}}this.internal.write("]")}}]),i.createAnnotation=function(e){var r=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":r.pageContext.annotations.push(e)}},i.link=function(e,r,s,n,c){var l=this.internal.getCurrentPageInfo(),f=this.internal.getCoordinateString,y=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:f(e),y:y(r),w:f(e+s),h:y(r+n)},options:c,type:"link"})},i.textWithLink=function(e,r,s,n){var c,l,f=this.getTextWidth(e),y=this.internal.getLineHeight()/this.internal.scaleFactor;if(n.maxWidth!==void 0){l=n.maxWidth;var x=this.splitTextToSize(e,l).length;c=Math.ceil(y*x)}else l=f,c=y;return this.text(e,r,s,n),s+=.2*y,n.align==="center"&&(r-=f/2),n.align==="right"&&(r-=f),this.link(r,s-y,l,c,n),f},i.getTextWidth=function(e){var r=this.internal.getFontSize();return this.getStringUnitWidth(e)*r/this.internal.scaleFactor}}(ki.API),function(i){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},s=[1570,1571,1573,1575];i.__arabicParser__={};var n=i.__arabicParser__.isInArabicSubstitutionA=function(G){return t[G.charCodeAt(0)]!==void 0},c=i.__arabicParser__.isArabicLetter=function(G){return typeof G=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(G)},l=i.__arabicParser__.isArabicEndLetter=function(G){return c(G)&&n(G)&&t[G.charCodeAt(0)].length<=2},f=i.__arabicParser__.isArabicAlfLetter=function(G){return c(G)&&s.indexOf(G.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function(G){return c(G)&&n(G)&&t[G.charCodeAt(0)].length>=1};var y=i.__arabicParser__.arabicLetterHasFinalForm=function(G){return c(G)&&n(G)&&t[G.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function(G){return c(G)&&n(G)&&t[G.charCodeAt(0)].length>=3};var x=i.__arabicParser__.arabicLetterHasMedialForm=function(G){return c(G)&&n(G)&&t[G.charCodeAt(0)].length==4},T=i.__arabicParser__.resolveLigatures=function(G){var Z=0,X=e,$="",ct=0;for(Z=0;Z<G.length;Z+=1)X[G.charCodeAt(Z)]!==void 0?(ct++,typeof(X=X[G.charCodeAt(Z)])=="number"&&($+=String.fromCharCode(X),X=e,ct=0),Z===G.length-1&&(X=e,$+=G.charAt(Z-(ct-1)),Z-=ct-1,ct=0)):(X=e,$+=G.charAt(Z-ct),Z-=ct,ct=0);return $};i.__arabicParser__.isArabicDiacritic=function(G){return G!==void 0&&r[G.charCodeAt(0)]!==void 0};var P=i.__arabicParser__.getCorrectForm=function(G,Z,X){return c(G)?n(G)===!1?-1:!y(G)||!c(Z)&&!c(X)||!c(X)&&l(Z)||l(G)&&!c(Z)||l(G)&&f(Z)||l(G)&&l(Z)?0:x(G)&&c(Z)&&!l(Z)&&c(X)&&y(X)?3:l(G)||!c(X)?1:2:-1},M=function(G){var Z=0,X=0,$=0,ct="",yt="",Mt="",Nt=(G=G||"").split("\\s+"),Rt=[];for(Z=0;Z<Nt.length;Z+=1){for(Rt.push(""),X=0;X<Nt[Z].length;X+=1)ct=Nt[Z][X],yt=Nt[Z][X-1],Mt=Nt[Z][X+1],c(ct)?($=P(ct,yt,Mt),Rt[Z]+=$!==-1?String.fromCharCode(t[ct.charCodeAt(0)][$]):ct):Rt[Z]+=ct;Rt[Z]=T(Rt[Z])}return Rt.join(" ")},N=i.__arabicParser__.processArabic=i.processArabic=function(){var G,Z=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,X=[];if(Array.isArray(Z)){var $=0;for(X=[],$=0;$<Z.length;$+=1)Array.isArray(Z[$])?X.push([M(Z[$][0]),Z[$][1],Z[$][2]]):X.push([M(Z[$])]);G=X}else G=M(Z);return typeof arguments[0]=="string"?G:(arguments[0].text=G,arguments[0])};i.events.push(["preProcessText",N])}(ki.API),ki.API.autoPrint=function(i){var t;switch((i=i||{}).variant=i.variant||"non-conform",i.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(i){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(l){e=l}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var s=300;Object.defineProperty(this,"height",{get:function(){return s},set:function(l){s=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=s+1)}});var n=[];Object.defineProperty(this,"childNodes",{get:function(){return n},set:function(l){n=l}});var c={};Object.defineProperty(this,"style",{get:function(){return c},set:function(l){c=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,r){var s;if((e=e||"2d")!=="2d")return null;for(s in r)this.pdf.context2d.hasOwnProperty(s)&&(this.pdf.context2d[s]=r[s]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(ki.API),function(i){var t={left:0,top:0,bottom:0,right:0},e=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),s.call(this))},s=function(){this.internal.__cell__.lastCell=new n,this.internal.__cell__.pages=1},n=function(){var f=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return f},set:function(G){f=G}});var y=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return y},set:function(G){y=G}});var x=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return x},set:function(G){x=G}});var T=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return T},set:function(G){T=G}});var P=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return P},set:function(G){P=G}});var M=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return M},set:function(G){M=G}});var N=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return N},set:function(G){N=G}}),this};n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},n.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(f){return r.call(this),this.internal.__cell__.headerFunction=typeof f=="function"?f:void 0,this},i.getTextDimensions=function(f,y){r.call(this);var x=(y=y||{}).fontSize||this.getFontSize(),T=y.font||this.getFont(),P=y.scaleFactor||this.internal.scaleFactor,M=0,N=0,G=0,Z=this;if(!Array.isArray(f)&&typeof f!="string"){if(typeof f!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");f=String(f)}var X=y.maxWidth;X>0?typeof f=="string"?f=this.splitTextToSize(f,X):Object.prototype.toString.call(f)==="[object Array]"&&(f=f.reduce(function(ct,yt){return ct.concat(Z.splitTextToSize(yt,X))},[])):f=Array.isArray(f)?f:[f];for(var $=0;$<f.length;$++)M<(G=this.getStringUnitWidth(f[$],{font:T})*x)&&(M=G);return M!==0&&(N=f.length),{w:M/=P,h:Math.max((N*x*this.getLineHeightFactor()-x*(this.getLineHeightFactor()-1))/P,0)}},i.cellAddPage=function(){r.call(this),this.addPage();var f=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new n(f.left,f.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var c=i.cell=function(){var f;f=arguments[0]instanceof n?arguments[0]:new n(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var y=this.internal.__cell__.lastCell,x=this.internal.__cell__.padding,T=this.internal.__cell__.margins||t,P=this.internal.__cell__.tableHeaderRow,M=this.internal.__cell__.printHeaders;return y.lineNumber!==void 0&&(y.lineNumber===f.lineNumber?(f.x=(y.x||0)+(y.width||0),f.y=y.y||0):y.y+y.height+f.height+T.bottom>this.getPageHeight()?(this.cellAddPage(),f.y=T.top,M&&P&&(this.printHeaderRow(f.lineNumber,!0),f.y+=P[0].height)):f.y=y.y+y.height||f.y),f.text[0]!==void 0&&(this.rect(f.x,f.y,f.width,f.height,e===!0?"FD":void 0),f.align==="right"?this.text(f.text,f.x+f.width-x,f.y+x,{align:"right",baseline:"top"}):f.align==="center"?this.text(f.text,f.x+f.width/2,f.y+x,{align:"center",baseline:"top",maxWidth:f.width-x-x}):this.text(f.text,f.x+x,f.y+x,{align:"left",baseline:"top",maxWidth:f.width-x-x})),this.internal.__cell__.lastCell=f,this};i.table=function(f,y,x,T,P){if(r.call(this),!x)throw new Error("No data for PDF table.");var M,N,G,Z,X=[],$=[],ct=[],yt={},Mt={},Nt=[],Rt=[],xt=(P=P||{}).autoSize||!1,qt=P.printHeaders!==!1,zt=P.css&&P.css["font-size"]!==void 0?16*P.css["font-size"]:P.fontSize||12,ot=P.margins||Object.assign({width:this.getPageWidth()},t),dt=typeof P.padding=="number"?P.padding:3,Lt=P.headerBackgroundColor||"#c8c8c8",wt=P.headerTextColor||"#000";if(s.call(this),this.internal.__cell__.printHeaders=qt,this.internal.__cell__.margins=ot,this.internal.__cell__.table_font_size=zt,this.internal.__cell__.padding=dt,this.internal.__cell__.headerBackgroundColor=Lt,this.internal.__cell__.headerTextColor=wt,this.setFontSize(zt),T==null)$=X=Object.keys(x[0]),ct=X.map(function(){return"left"});else if(Array.isArray(T)&&Fr(T[0])==="object")for(X=T.map(function(ge){return ge.name}),$=T.map(function(ge){return ge.prompt||ge.name||""}),ct=T.map(function(ge){return ge.align||"left"}),M=0;M<T.length;M+=1)Mt[T[M].name]=T[M].width*(19.049976/25.4);else Array.isArray(T)&&typeof T[0]=="string"&&($=X=T,ct=X.map(function(){return"left"}));if(xt||Array.isArray(T)&&typeof T[0]=="string")for(M=0;M<X.length;M+=1){for(yt[Z=X[M]]=x.map(function(ge){return ge[Z]}),this.setFont(void 0,"bold"),Nt.push(this.getTextDimensions($[M],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),N=yt[Z],this.setFont(void 0,"normal"),G=0;G<N.length;G+=1)Nt.push(this.getTextDimensions(N[G],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Mt[Z]=Math.max.apply(null,Nt)+dt+dt,Nt=[]}if(qt){var le={};for(M=0;M<X.length;M+=1)le[X[M]]={},le[X[M]].text=$[M],le[X[M]].align=ct[M];var oe=l.call(this,le,Mt);Rt=X.map(function(ge){return new n(f,y,Mt[ge],oe,le[ge].text,void 0,le[ge].align)}),this.setTableHeaderRow(Rt),this.printHeaderRow(1,!1)}var de=T.reduce(function(ge,ke){return ge[ke.name]=ke.align,ge},{});for(M=0;M<x.length;M+=1){"rowStart"in P&&P.rowStart instanceof Function&&P.rowStart({row:M,data:x[M]},this);var te=l.call(this,x[M],Mt);for(G=0;G<X.length;G+=1){var me=x[M][X[G]];"cellStart"in P&&P.cellStart instanceof Function&&P.cellStart({row:M,col:G,data:me},this),c.call(this,new n(f,y,Mt[X[G]],te,me,M+2,de[X[G]]))}}return this.internal.__cell__.table_x=f,this.internal.__cell__.table_y=y,this};var l=function(f,y){var x=this.internal.__cell__.padding,T=this.internal.__cell__.table_font_size,P=this.internal.scaleFactor;return Object.keys(f).map(function(M){var N=f[M];return this.splitTextToSize(N.hasOwnProperty("text")?N.text:N,y[M]-x-x)},this).map(function(M){return this.getLineHeightFactor()*M.length*T/P+x+x},this).reduce(function(M,N){return Math.max(M,N)},0)};i.setTableHeaderRow=function(f){r.call(this),this.internal.__cell__.tableHeaderRow=f},i.printHeaderRow=function(f,y){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var x;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var T=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new n(T[0],T[1],T[2],T[3],void 0,-1)}this.setFont(void 0,"bold");for(var P=[],M=0;M<this.internal.__cell__.tableHeaderRow.length;M+=1){x=this.internal.__cell__.tableHeaderRow[M].clone(),y&&(x.y=this.internal.__cell__.margins.top||0,P.push(x)),x.lineNumber=f;var N=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),c.call(this,x),this.setTextColor(N)}P.length>0&&this.setTableHeaderRow(P),this.setFont(void 0,"normal"),e=!1}}(ki.API);var SE={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},EE=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],$_=AE(EE),CE=[100,200,300,400,500,600,700,800,900],uV=AE(CE);function K_(i){var t=i.family.replace(/"|'/g,"").toLowerCase(),e=function(n){return SE[n=n||"normal"]?n:"normal"}(i.style),r=function(n){if(!n)return 400;if(typeof n=="number")return n>=100&&n<=900&&n%100==0?n:400;if(/^\d00$/.test(n))return parseInt(n);switch(n){case"bold":return 700;case"normal":default:return 400}}(i.weight),s=function(n){return typeof $_[n=n||"normal"]=="number"?n:"normal"}(i.stretch);return{family:t,style:e,weight:r,stretch:s,src:i.src||[],ref:i.ref||{name:t,style:[s,e,r].join(" ")}}}function D5(i,t,e,r){var s;for(s=e;s>=0&&s<t.length;s+=r)if(i[t[s]])return i[t[s]];for(s=e;s>=0&&s<t.length;s-=r)if(i[t[s]])return i[t[s]]}var dV={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},N5={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function F5(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function pV(i,t,e){for(var r=(e=e||{}).defaultFontFamily||"times",s=Object.assign({},dV,e.genericFontFamilies||{}),n=null,c=null,l=0;l<t.length;++l)if(s[(n=K_(t[l])).family]&&(n.family=s[n.family]),i.hasOwnProperty(n.family)){c=i[n.family];break}if(!(c=c||i[r]))throw new Error("Could not find a font-family for the rule '"+F5(n)+"' and default family '"+r+"'.");if(c=function(f,y){if(y[f])return y[f];var x=$_[f],T=x<=$_.normal?-1:1,P=D5(y,EE,x,T);if(!P)throw new Error("Could not find a matching font-stretch value for "+f);return P}(n.stretch,c),c=function(f,y){if(y[f])return y[f];for(var x=SE[f],T=0;T<x.length;++T)if(y[x[T]])return y[x[T]];throw new Error("Could not find a matching font-style for "+f)}(n.style,c),!(c=function(f,y){if(y[f])return y[f];if(f===400&&y[500])return y[500];if(f===500&&y[400])return y[400];var x=uV[f],T=D5(y,CE,x,f<400?-1:1);if(!T)throw new Error("Could not find a matching font-weight for value "+f);return T}(n.weight,c)))throw new Error("Failed to resolve a font for the rule '"+F5(n)+"'.");return c}function z5(i){return i.trimLeft()}function fV(i,t){for(var e=0;e<i.length;){if(i.charAt(e)===t)return[i.substring(0,e),i.substring(e+1)];e+=1}return null}function gV(i){var t=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],i.substring(t[0].length)]}var Cg,j5,U5,G5=["times"];(function(i){var t,e,r,s,n,c,l,f,y,x=function(it){return it=it||{},this.isStrokeTransparent=it.isStrokeTransparent||!1,this.strokeOpacity=it.strokeOpacity||1,this.strokeStyle=it.strokeStyle||"#000000",this.fillStyle=it.fillStyle||"#000000",this.isFillTransparent=it.isFillTransparent||!1,this.fillOpacity=it.fillOpacity||1,this.font=it.font||"10px sans-serif",this.textBaseline=it.textBaseline||"alphabetic",this.textAlign=it.textAlign||"left",this.lineWidth=it.lineWidth||1,this.lineJoin=it.lineJoin||"miter",this.lineCap=it.lineCap||"butt",this.path=it.path||[],this.transform=it.transform!==void 0?it.transform.clone():new f,this.globalCompositeOperation=it.globalCompositeOperation||"normal",this.globalAlpha=it.globalAlpha||1,this.clip_path=it.clip_path||[],this.currentPoint=it.currentPoint||new c,this.miterLimit=it.miterLimit||10,this.lastPoint=it.lastPoint||new c,this.lineDashOffset=it.lineDashOffset||0,this.lineDash=it.lineDash||[],this.margin=it.margin||[0,0,0,0],this.prevPageLastElemOffset=it.prevPageLastElemOffset||0,this.ignoreClearRect=typeof it.ignoreClearRect!="boolean"||it.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new T(this),t=this.internal.f2,e=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,s=this.internal.getHorizontalCoordinate,n=this.internal.getVerticalCoordinate,c=this.internal.Point,l=this.internal.Rectangle,f=this.internal.Matrix,y=new x}]);var T=function(it){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Et=it;Object.defineProperty(this,"pdf",{get:function(){return Et}});var It=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return It},set:function(pe){It=!!pe}});var Ut=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ut},set:function(pe){Ut=!!pe}});var Xt=0;Object.defineProperty(this,"posX",{get:function(){return Xt},set:function(pe){isNaN(pe)||(Xt=pe)}});var Kt=0;Object.defineProperty(this,"posY",{get:function(){return Kt},set:function(pe){isNaN(pe)||(Kt=pe)}}),Object.defineProperty(this,"margin",{get:function(){return y.margin},set:function(pe){var Pt;typeof pe=="number"?Pt=[pe,pe,pe,pe]:((Pt=new Array(4))[0]=pe[0],Pt[1]=pe.length>=2?pe[1]:Pt[0],Pt[2]=pe.length>=3?pe[2]:Pt[0],Pt[3]=pe.length>=4?pe[3]:Pt[1]),y.margin=Pt}});var ie=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ie},set:function(pe){ie=pe}});var Qt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Qt},set:function(pe){Qt=pe}});var Ae=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ae},set:function(pe){Ae=pe}}),Object.defineProperty(this,"ctx",{get:function(){return y},set:function(pe){pe instanceof x&&(y=pe)}}),Object.defineProperty(this,"path",{get:function(){return y.path},set:function(pe){y.path=pe}});var Le=[];Object.defineProperty(this,"ctxStack",{get:function(){return Le},set:function(pe){Le=pe}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(pe){var Pt;Pt=P(pe),this.ctx.fillStyle=Pt.style,this.ctx.isFillTransparent=Pt.a===0,this.ctx.fillOpacity=Pt.a,this.pdf.setFillColor(Pt.r,Pt.g,Pt.b,{a:Pt.a}),this.pdf.setTextColor(Pt.r,Pt.g,Pt.b,{a:Pt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(pe){var Pt=P(pe);this.ctx.strokeStyle=Pt.style,this.ctx.isStrokeTransparent=Pt.a===0,this.ctx.strokeOpacity=Pt.a,Pt.a===0?this.pdf.setDrawColor(255,255,255):(Pt.a,this.pdf.setDrawColor(Pt.r,Pt.g,Pt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(pe){["butt","round","square"].indexOf(pe)!==-1&&(this.ctx.lineCap=pe,this.pdf.setLineCap(pe))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(pe){isNaN(pe)||(this.ctx.lineWidth=pe,this.pdf.setLineWidth(pe))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(pe){["bevel","round","miter"].indexOf(pe)!==-1&&(this.ctx.lineJoin=pe,this.pdf.setLineJoin(pe))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(pe){isNaN(pe)||(this.ctx.miterLimit=pe,this.pdf.setMiterLimit(pe))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(pe){this.ctx.textBaseline=pe}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(pe){["right","end","center","left","start"].indexOf(pe)!==-1&&(this.ctx.textAlign=pe)}});var Fe=null;function Ge(pe,Pt){if(Fe===null){var Zt=function(ii){var Pe=[];return Object.keys(ii).forEach(function(ve){ii[ve].forEach(function(Ee){var Ve=null;switch(Ee){case"bold":Ve={family:ve,weight:"bold"};break;case"italic":Ve={family:ve,style:"italic"};break;case"bolditalic":Ve={family:ve,weight:"bold",style:"italic"};break;case"":case"normal":Ve={family:ve}}Ve!==null&&(Ve.ref={name:ve,style:Ee},Pe.push(Ve))})}),Pe}(pe.getFontList());Fe=function(ii){for(var Pe={},ve=0;ve<ii.length;++ve){var Ee=K_(ii[ve]),Ve=Ee.family,ai=Ee.stretch,Ai=Ee.style,Ti=Ee.weight;Pe[Ve]=Pe[Ve]||{},Pe[Ve][ai]=Pe[Ve][ai]||{},Pe[Ve][ai][Ai]=Pe[Ve][ai][Ai]||{},Pe[Ve][ai][Ai][Ti]=Ee}return Pe}(Zt.concat(Pt))}return Fe}var Xe=null;Object.defineProperty(this,"fontFaces",{get:function(){return Xe},set:function(pe){Fe=null,Xe=pe}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(pe){var Pt;if(this.ctx.font=pe,(Pt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(pe))!==null){var Zt=Pt[1],ii=(Pt[2],Pt[3]),Pe=Pt[4],ve=(Pt[5],Pt[6]),Ee=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Pe)[2];Pe=Math.floor(Ee==="px"?parseFloat(Pe)*this.pdf.internal.scaleFactor:Ee==="em"?parseFloat(Pe)*this.pdf.getFontSize():parseFloat(Pe)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Pe);var Ve=function(ce){var Ei,Re,jr=[],Ci=ce.trim();if(Ci==="")return G5;if(Ci in N5)return[N5[Ci]];for(;Ci!=="";){switch(Re=null,Ei=(Ci=z5(Ci)).charAt(0)){case'"':case"'":Re=fV(Ci.substring(1),Ei);break;default:Re=gV(Ci)}if(Re===null||(jr.push(Re[0]),(Ci=z5(Re[1]))!==""&&Ci.charAt(0)!==","))return G5;Ci=Ci.replace(/^,/,"")}return jr}(ve);if(this.fontFaces){var ai=pV(Ge(this.pdf,this.fontFaces),Ve.map(function(ce){return{family:ce,stretch:"normal",weight:ii,style:Zt}}));this.pdf.setFont(ai.ref.name,ai.ref.style)}else{var Ai="";(ii==="bold"||parseInt(ii,10)>=700||Zt==="bold")&&(Ai="bold"),Zt==="italic"&&(Ai+="italic"),Ai.length===0&&(Ai="normal");for(var Ti="",Pi={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},qi=0;qi<Ve.length;qi++){if(this.pdf.internal.getFont(Ve[qi],Ai,{noFallback:!0,disableWarning:!0})!==void 0){Ti=Ve[qi];break}if(Ai==="bolditalic"&&this.pdf.internal.getFont(Ve[qi],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ti=Ve[qi],Ai="bold";else if(this.pdf.internal.getFont(Ve[qi],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ti=Ve[qi],Ai="normal";break}}if(Ti===""){for(var Ji=0;Ji<Ve.length;Ji++)if(Pi[Ve[Ji]]){Ti=Pi[Ve[Ji]];break}}Ti=Ti===""?"Times":Ti,this.pdf.setFont(Ti,Ai)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(pe){this.ctx.globalCompositeOperation=pe}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(pe){this.ctx.globalAlpha=pe}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(pe){this.ctx.lineDashOffset=pe,ke.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(pe){this.ctx.lineDash=pe,ke.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(pe){this.ctx.ignoreClearRect=!!pe}})};T.prototype.setLineDash=function(it){this.lineDash=it},T.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},T.prototype.fill=function(){yt.call(this,"fill",!1)},T.prototype.stroke=function(){yt.call(this,"stroke",!1)},T.prototype.beginPath=function(){this.path=[{type:"begin"}]},T.prototype.moveTo=function(it,Et){if(isNaN(it)||isNaN(Et))throw Yr.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var It=this.ctx.transform.applyToPoint(new c(it,Et));this.path.push({type:"mt",x:It.x,y:It.y}),this.ctx.lastPoint=new c(it,Et)},T.prototype.closePath=function(){var it=new c(0,0),Et=0;for(Et=this.path.length-1;Et!==-1;Et--)if(this.path[Et].type==="begin"&&Fr(this.path[Et+1])==="object"&&typeof this.path[Et+1].x=="number"){it=new c(this.path[Et+1].x,this.path[Et+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new c(it.x,it.y)},T.prototype.lineTo=function(it,Et){if(isNaN(it)||isNaN(Et))throw Yr.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var It=this.ctx.transform.applyToPoint(new c(it,Et));this.path.push({type:"lt",x:It.x,y:It.y}),this.ctx.lastPoint=new c(It.x,It.y)},T.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),yt.call(this,null,!0)},T.prototype.quadraticCurveTo=function(it,Et,It,Ut){if(isNaN(It)||isNaN(Ut)||isNaN(it)||isNaN(Et))throw Yr.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Xt=this.ctx.transform.applyToPoint(new c(It,Ut)),Kt=this.ctx.transform.applyToPoint(new c(it,Et));this.path.push({type:"qct",x1:Kt.x,y1:Kt.y,x:Xt.x,y:Xt.y}),this.ctx.lastPoint=new c(Xt.x,Xt.y)},T.prototype.bezierCurveTo=function(it,Et,It,Ut,Xt,Kt){if(isNaN(Xt)||isNaN(Kt)||isNaN(it)||isNaN(Et)||isNaN(It)||isNaN(Ut))throw Yr.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ie=this.ctx.transform.applyToPoint(new c(Xt,Kt)),Qt=this.ctx.transform.applyToPoint(new c(it,Et)),Ae=this.ctx.transform.applyToPoint(new c(It,Ut));this.path.push({type:"bct",x1:Qt.x,y1:Qt.y,x2:Ae.x,y2:Ae.y,x:ie.x,y:ie.y}),this.ctx.lastPoint=new c(ie.x,ie.y)},T.prototype.arc=function(it,Et,It,Ut,Xt,Kt){if(isNaN(it)||isNaN(Et)||isNaN(It)||isNaN(Ut)||isNaN(Xt))throw Yr.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Kt=!!Kt,!this.ctx.transform.isIdentity){var ie=this.ctx.transform.applyToPoint(new c(it,Et));it=ie.x,Et=ie.y;var Qt=this.ctx.transform.applyToPoint(new c(0,It)),Ae=this.ctx.transform.applyToPoint(new c(0,0));It=Math.sqrt(Math.pow(Qt.x-Ae.x,2)+Math.pow(Qt.y-Ae.y,2))}Math.abs(Xt-Ut)>=2*Math.PI&&(Ut=0,Xt=2*Math.PI),this.path.push({type:"arc",x:it,y:Et,radius:It,startAngle:Ut,endAngle:Xt,counterclockwise:Kt})},T.prototype.arcTo=function(it,Et,It,Ut,Xt){throw new Error("arcTo not implemented.")},T.prototype.rect=function(it,Et,It,Ut){if(isNaN(it)||isNaN(Et)||isNaN(It)||isNaN(Ut))throw Yr.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(it,Et),this.lineTo(it+It,Et),this.lineTo(it+It,Et+Ut),this.lineTo(it,Et+Ut),this.lineTo(it,Et),this.lineTo(it+It,Et),this.lineTo(it,Et)},T.prototype.fillRect=function(it,Et,It,Ut){if(isNaN(it)||isNaN(Et)||isNaN(It)||isNaN(Ut))throw Yr.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!M.call(this)){var Xt={};this.lineCap!=="butt"&&(Xt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Xt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(it,Et,It,Ut),this.fill(),Xt.hasOwnProperty("lineCap")&&(this.lineCap=Xt.lineCap),Xt.hasOwnProperty("lineJoin")&&(this.lineJoin=Xt.lineJoin)}},T.prototype.strokeRect=function(it,Et,It,Ut){if(isNaN(it)||isNaN(Et)||isNaN(It)||isNaN(Ut))throw Yr.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");N.call(this)||(this.beginPath(),this.rect(it,Et,It,Ut),this.stroke())},T.prototype.clearRect=function(it,Et,It,Ut){if(isNaN(it)||isNaN(Et)||isNaN(It)||isNaN(Ut))throw Yr.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(it,Et,It,Ut))},T.prototype.save=function(it){it=typeof it!="boolean"||it;for(var Et=this.pdf.internal.getCurrentPageInfo().pageNumber,It=0;It<this.pdf.internal.getNumberOfPages();It++)this.pdf.setPage(It+1),this.pdf.internal.out("q");if(this.pdf.setPage(Et),it){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ut=new x(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ut}},T.prototype.restore=function(it){it=typeof it!="boolean"||it;for(var Et=this.pdf.internal.getCurrentPageInfo().pageNumber,It=0;It<this.pdf.internal.getNumberOfPages();It++)this.pdf.setPage(It+1),this.pdf.internal.out("Q");this.pdf.setPage(Et),it&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},T.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var P=function(it){var Et,It,Ut,Xt;if(it.isCanvasGradient===!0&&(it=it.getColor()),!it)return{r:0,g:0,b:0,a:0,style:it};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(it))Et=0,It=0,Ut=0,Xt=0;else{var Kt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(it);if(Kt!==null)Et=parseInt(Kt[1]),It=parseInt(Kt[2]),Ut=parseInt(Kt[3]),Xt=1;else if((Kt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(it))!==null)Et=parseInt(Kt[1]),It=parseInt(Kt[2]),Ut=parseInt(Kt[3]),Xt=parseFloat(Kt[4]);else{if(Xt=1,typeof it=="string"&&it.charAt(0)!=="#"){var ie=new yE(it);it=ie.ok?ie.toHex():"#000000"}it.length===4?(Et=it.substring(1,2),Et+=Et,It=it.substring(2,3),It+=It,Ut=it.substring(3,4),Ut+=Ut):(Et=it.substring(1,3),It=it.substring(3,5),Ut=it.substring(5,7)),Et=parseInt(Et,16),It=parseInt(It,16),Ut=parseInt(Ut,16)}}return{r:Et,g:It,b:Ut,a:Xt,style:it}},M=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},N=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};T.prototype.fillText=function(it,Et,It,Ut){if(isNaN(Et)||isNaN(It)||typeof it!="string")throw Yr.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ut=isNaN(Ut)?void 0:Ut,!M.call(this)){var Xt=te(this.ctx.transform.rotation),Kt=this.ctx.transform.scaleX;dt.call(this,{text:it,x:Et,y:It,scale:Kt,angle:Xt,align:this.textAlign,maxWidth:Ut})}},T.prototype.strokeText=function(it,Et,It,Ut){if(isNaN(Et)||isNaN(It)||typeof it!="string")throw Yr.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!N.call(this)){Ut=isNaN(Ut)?void 0:Ut;var Xt=te(this.ctx.transform.rotation),Kt=this.ctx.transform.scaleX;dt.call(this,{text:it,x:Et,y:It,scale:Kt,renderingMode:"stroke",angle:Xt,align:this.textAlign,maxWidth:Ut})}},T.prototype.measureText=function(it){if(typeof it!="string")throw Yr.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Et=this.pdf,It=this.pdf.internal.scaleFactor,Ut=Et.internal.getFontSize(),Xt=Et.getStringUnitWidth(it)*Ut/Et.internal.scaleFactor,Kt=function(ie){var Qt=(ie=ie||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Qt}}),this};return new Kt({width:Xt*=Math.round(96*It/72*1e4)/1e4})},T.prototype.scale=function(it,Et){if(isNaN(it)||isNaN(Et))throw Yr.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var It=new f(it,0,0,Et,0,0);this.ctx.transform=this.ctx.transform.multiply(It)},T.prototype.rotate=function(it){if(isNaN(it))throw Yr.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Et=new f(Math.cos(it),Math.sin(it),-Math.sin(it),Math.cos(it),0,0);this.ctx.transform=this.ctx.transform.multiply(Et)},T.prototype.translate=function(it,Et){if(isNaN(it)||isNaN(Et))throw Yr.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var It=new f(1,0,0,1,it,Et);this.ctx.transform=this.ctx.transform.multiply(It)},T.prototype.transform=function(it,Et,It,Ut,Xt,Kt){if(isNaN(it)||isNaN(Et)||isNaN(It)||isNaN(Ut)||isNaN(Xt)||isNaN(Kt))throw Yr.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ie=new f(it,Et,It,Ut,Xt,Kt);this.ctx.transform=this.ctx.transform.multiply(ie)},T.prototype.setTransform=function(it,Et,It,Ut,Xt,Kt){it=isNaN(it)?1:it,Et=isNaN(Et)?0:Et,It=isNaN(It)?0:It,Ut=isNaN(Ut)?1:Ut,Xt=isNaN(Xt)?0:Xt,Kt=isNaN(Kt)?0:Kt,this.ctx.transform=new f(it,Et,It,Ut,Xt,Kt)};var G=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};T.prototype.drawImage=function(it,Et,It,Ut,Xt,Kt,ie,Qt,Ae){var Le=this.pdf.getImageProperties(it),Fe=1,Ge=1,Xe=1,pe=1;Ut!==void 0&&Qt!==void 0&&(Xe=Qt/Ut,pe=Ae/Xt,Fe=Le.width/Ut*Qt/Ut,Ge=Le.height/Xt*Ae/Xt),Kt===void 0&&(Kt=Et,ie=It,Et=0,It=0),Ut!==void 0&&Qt===void 0&&(Qt=Ut,Ae=Xt),Ut===void 0&&Qt===void 0&&(Qt=Le.width,Ae=Le.height);for(var Pt,Zt=this.ctx.transform.decompose(),ii=te(Zt.rotate.shx),Pe=new f,ve=(Pe=(Pe=(Pe=Pe.multiply(Zt.translate)).multiply(Zt.skew)).multiply(Zt.scale)).applyToRectangle(new l(Kt-Et*Xe,ie-It*pe,Ut*Fe,Xt*Ge)),Ee=Z.call(this,ve),Ve=[],ai=0;ai<Ee.length;ai+=1)Ve.indexOf(Ee[ai])===-1&&Ve.push(Ee[ai]);if(ct(Ve),this.autoPaging)for(var Ai=Ve[0],Ti=Ve[Ve.length-1],Pi=Ai;Pi<Ti+1;Pi++){this.pdf.setPage(Pi);var qi=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ji=Pi===1?this.posY+this.margin[0]:this.margin[0],ce=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ei=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Re=Pi===1?0:ce+(Pi-2)*Ei;if(this.ctx.clip_path.length!==0){var jr=this.path;Pt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(Pt,this.posX+this.margin[3],-Re+Ji+this.ctx.prevPageLastElemOffset),Mt.call(this,"fill",!0),this.path=jr}var Ci=JSON.parse(JSON.stringify(ve));Ci=$([Ci],this.posX+this.margin[3],-Re+Ji+this.ctx.prevPageLastElemOffset)[0];var Te=(Pi>Ai||Pi<Ti)&&G.call(this);Te&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],qi,Ei,null).clip().discardPath()),this.pdf.addImage(it,"JPEG",Ci.x,Ci.y,Ci.w,Ci.h,null,null,ii),Te&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(it,"JPEG",ve.x,ve.y,ve.w,ve.h,null,null,ii)};var Z=function(it,Et,It){var Ut=[];Et=Et||this.pdf.internal.pageSize.width,It=It||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Xt=this.posY+this.ctx.prevPageLastElemOffset;switch(it.type){default:case"mt":case"lt":Ut.push(Math.floor((it.y+Xt)/It)+1);break;case"arc":Ut.push(Math.floor((it.y+Xt-it.radius)/It)+1),Ut.push(Math.floor((it.y+Xt+it.radius)/It)+1);break;case"qct":var Kt=me(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x,it.y);Ut.push(Math.floor((Kt.y+Xt)/It)+1),Ut.push(Math.floor((Kt.y+Kt.h+Xt)/It)+1);break;case"bct":var ie=ge(this.ctx.lastPoint.x,this.ctx.lastPoint.y,it.x1,it.y1,it.x2,it.y2,it.x,it.y);Ut.push(Math.floor((ie.y+Xt)/It)+1),Ut.push(Math.floor((ie.y+ie.h+Xt)/It)+1);break;case"rect":Ut.push(Math.floor((it.y+Xt)/It)+1),Ut.push(Math.floor((it.y+it.h+Xt)/It)+1)}for(var Qt=0;Qt<Ut.length;Qt+=1)for(;this.pdf.internal.getNumberOfPages()<Ut[Qt];)X.call(this);return Ut},X=function(){var it=this.fillStyle,Et=this.strokeStyle,It=this.font,Ut=this.lineCap,Xt=this.lineWidth,Kt=this.lineJoin;this.pdf.addPage(),this.fillStyle=it,this.strokeStyle=Et,this.font=It,this.lineCap=Ut,this.lineWidth=Xt,this.lineJoin=Kt},$=function(it,Et,It){for(var Ut=0;Ut<it.length;Ut++)switch(it[Ut].type){case"bct":it[Ut].x2+=Et,it[Ut].y2+=It;case"qct":it[Ut].x1+=Et,it[Ut].y1+=It;case"mt":case"lt":case"arc":default:it[Ut].x+=Et,it[Ut].y+=It}return it},ct=function(it){return it.sort(function(Et,It){return Et-It})},yt=function(it,Et){for(var It,Ut,Xt=this.fillStyle,Kt=this.strokeStyle,ie=this.lineCap,Qt=this.lineWidth,Ae=Math.abs(Qt*this.ctx.transform.scaleX),Le=this.lineJoin,Fe=JSON.parse(JSON.stringify(this.path)),Ge=JSON.parse(JSON.stringify(this.path)),Xe=[],pe=0;pe<Ge.length;pe++)if(Ge[pe].x!==void 0)for(var Pt=Z.call(this,Ge[pe]),Zt=0;Zt<Pt.length;Zt+=1)Xe.indexOf(Pt[Zt])===-1&&Xe.push(Pt[Zt]);for(var ii=0;ii<Xe.length;ii++)for(;this.pdf.internal.getNumberOfPages()<Xe[ii];)X.call(this);if(ct(Xe),this.autoPaging)for(var Pe=Xe[0],ve=Xe[Xe.length-1],Ee=Pe;Ee<ve+1;Ee++){this.pdf.setPage(Ee),this.fillStyle=Xt,this.strokeStyle=Kt,this.lineCap=ie,this.lineWidth=Ae,this.lineJoin=Le;var Ve=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ai=Ee===1?this.posY+this.margin[0]:this.margin[0],Ai=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ti=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Pi=Ee===1?0:Ai+(Ee-2)*Ti;if(this.ctx.clip_path.length!==0){var qi=this.path;It=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(It,this.posX+this.margin[3],-Pi+ai+this.ctx.prevPageLastElemOffset),Mt.call(this,it,!0),this.path=qi}if(Ut=JSON.parse(JSON.stringify(Fe)),this.path=$(Ut,this.posX+this.margin[3],-Pi+ai+this.ctx.prevPageLastElemOffset),Et===!1||Ee===0){var Ji=(Ee>Pe||Ee<ve)&&G.call(this);Ji&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ve,Ti,null).clip().discardPath()),Mt.call(this,it,Et),Ji&&this.pdf.restoreGraphicsState()}this.lineWidth=Qt}else this.lineWidth=Ae,Mt.call(this,it,Et),this.lineWidth=Qt;this.path=Fe},Mt=function(it,Et){if((it!=="stroke"||Et||!N.call(this))&&(it==="stroke"||Et||!M.call(this))){for(var It,Ut,Xt=[],Kt=this.path,ie=0;ie<Kt.length;ie++){var Qt=Kt[ie];switch(Qt.type){case"begin":Xt.push({begin:!0});break;case"close":Xt.push({close:!0});break;case"mt":Xt.push({start:Qt,deltas:[],abs:[]});break;case"lt":var Ae=Xt.length;if(Kt[ie-1]&&!isNaN(Kt[ie-1].x)&&(It=[Qt.x-Kt[ie-1].x,Qt.y-Kt[ie-1].y],Ae>0)){for(;Ae>=0;Ae--)if(Xt[Ae-1].close!==!0&&Xt[Ae-1].begin!==!0){Xt[Ae-1].deltas.push(It),Xt[Ae-1].abs.push(Qt);break}}break;case"bct":It=[Qt.x1-Kt[ie-1].x,Qt.y1-Kt[ie-1].y,Qt.x2-Kt[ie-1].x,Qt.y2-Kt[ie-1].y,Qt.x-Kt[ie-1].x,Qt.y-Kt[ie-1].y],Xt[Xt.length-1].deltas.push(It);break;case"qct":var Le=Kt[ie-1].x+2/3*(Qt.x1-Kt[ie-1].x),Fe=Kt[ie-1].y+2/3*(Qt.y1-Kt[ie-1].y),Ge=Qt.x+2/3*(Qt.x1-Qt.x),Xe=Qt.y+2/3*(Qt.y1-Qt.y),pe=Qt.x,Pt=Qt.y;It=[Le-Kt[ie-1].x,Fe-Kt[ie-1].y,Ge-Kt[ie-1].x,Xe-Kt[ie-1].y,pe-Kt[ie-1].x,Pt-Kt[ie-1].y],Xt[Xt.length-1].deltas.push(It);break;case"arc":Xt.push({deltas:[],abs:[],arc:!0}),Array.isArray(Xt[Xt.length-1].abs)&&Xt[Xt.length-1].abs.push(Qt)}}Ut=Et?null:it==="stroke"?"stroke":"fill";for(var Zt=!1,ii=0;ii<Xt.length;ii++)if(Xt[ii].arc)for(var Pe=Xt[ii].abs,ve=0;ve<Pe.length;ve++){var Ee=Pe[ve];Ee.type==="arc"?xt.call(this,Ee.x,Ee.y,Ee.radius,Ee.startAngle,Ee.endAngle,Ee.counterclockwise,void 0,Et,!Zt):Lt.call(this,Ee.x,Ee.y),Zt=!0}else if(Xt[ii].close===!0)this.pdf.internal.out("h"),Zt=!1;else if(Xt[ii].begin!==!0){var Ve=Xt[ii].start.x,ai=Xt[ii].start.y;wt.call(this,Xt[ii].deltas,Ve,ai),Zt=!0}Ut&&qt.call(this,Ut),Et&&zt.call(this)}},Nt=function(it){var Et=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,It=Et*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return it-It;case"top":return it+Et-It;case"hanging":return it+Et-2*It;case"middle":return it+Et/2-It;case"ideographic":return it;case"alphabetic":default:return it}},Rt=function(it){return it+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};T.prototype.createLinearGradient=function(){var it=function(){};return it.colorStops=[],it.addColorStop=function(Et,It){this.colorStops.push([Et,It])},it.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},it.isCanvasGradient=!0,it},T.prototype.createPattern=function(){return this.createLinearGradient()},T.prototype.createRadialGradient=function(){return this.createLinearGradient()};var xt=function(it,Et,It,Ut,Xt,Kt,ie,Qt,Ae){for(var Le=oe.call(this,It,Ut,Xt,Kt),Fe=0;Fe<Le.length;Fe++){var Ge=Le[Fe];Fe===0&&(Ae?ot.call(this,Ge.x1+it,Ge.y1+Et):Lt.call(this,Ge.x1+it,Ge.y1+Et)),le.call(this,it,Et,Ge.x2,Ge.y2,Ge.x3,Ge.y3,Ge.x4,Ge.y4)}Qt?zt.call(this):qt.call(this,ie)},qt=function(it){switch(it){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},zt=function(){this.pdf.clip(),this.pdf.discardPath()},ot=function(it,Et){this.pdf.internal.out(e(it)+" "+r(Et)+" m")},dt=function(it){var Et;switch(it.align){case"right":case"end":Et="right";break;case"center":Et="center";break;case"left":case"start":default:Et="left"}var It=this.pdf.getTextDimensions(it.text),Ut=Nt.call(this,it.y),Xt=Rt.call(this,Ut)-It.h,Kt=this.ctx.transform.applyToPoint(new c(it.x,Ut)),ie=this.ctx.transform.decompose(),Qt=new f;Qt=(Qt=(Qt=Qt.multiply(ie.translate)).multiply(ie.skew)).multiply(ie.scale);for(var Ae,Le,Fe,Ge=this.ctx.transform.applyToRectangle(new l(it.x,Ut,It.w,It.h)),Xe=Qt.applyToRectangle(new l(it.x,Xt,It.w,It.h)),pe=Z.call(this,Xe),Pt=[],Zt=0;Zt<pe.length;Zt+=1)Pt.indexOf(pe[Zt])===-1&&Pt.push(pe[Zt]);if(ct(Pt),this.autoPaging)for(var ii=Pt[0],Pe=Pt[Pt.length-1],ve=ii;ve<Pe+1;ve++){this.pdf.setPage(ve);var Ee=ve===1?this.posY+this.margin[0]:this.margin[0],Ve=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ai=this.pdf.internal.pageSize.height-this.margin[2],Ai=ai-this.margin[0],Ti=this.pdf.internal.pageSize.width-this.margin[1],Pi=Ti-this.margin[3],qi=ve===1?0:Ve+(ve-2)*Ai;if(this.ctx.clip_path.length!==0){var Ji=this.path;Ae=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(Ae,this.posX+this.margin[3],-1*qi+Ee),Mt.call(this,"fill",!0),this.path=Ji}var ce=$([JSON.parse(JSON.stringify(Xe))],this.posX+this.margin[3],-qi+Ee+this.ctx.prevPageLastElemOffset)[0];it.scale>=.01&&(Le=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Le*it.scale),Fe=this.lineWidth,this.lineWidth=Fe*it.scale);var Ei=this.autoPaging!=="text";if(Ei||ce.y+ce.h<=ai){if(Ei||ce.y>=Ee&&ce.x<=Ti){var Re=Ei?it.text:this.pdf.splitTextToSize(it.text,it.maxWidth||Ti-ce.x)[0],jr=$([JSON.parse(JSON.stringify(Ge))],this.posX+this.margin[3],-qi+Ee+this.ctx.prevPageLastElemOffset)[0],Ci=Ei&&(ve>ii||ve<Pe)&&G.call(this);Ci&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Pi,Ai,null).clip().discardPath()),this.pdf.text(Re,jr.x,jr.y,{angle:it.angle,align:Et,renderingMode:it.renderingMode}),Ci&&this.pdf.restoreGraphicsState()}}else ce.y<ai&&(this.ctx.prevPageLastElemOffset+=ai-ce.y);it.scale>=.01&&(this.pdf.setFontSize(Le),this.lineWidth=Fe)}else it.scale>=.01&&(Le=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Le*it.scale),Fe=this.lineWidth,this.lineWidth=Fe*it.scale),this.pdf.text(it.text,Kt.x+this.posX,Kt.y+this.posY,{angle:it.angle,align:Et,renderingMode:it.renderingMode,maxWidth:it.maxWidth}),it.scale>=.01&&(this.pdf.setFontSize(Le),this.lineWidth=Fe)},Lt=function(it,Et,It,Ut){It=It||0,Ut=Ut||0,this.pdf.internal.out(e(it+It)+" "+r(Et+Ut)+" l")},wt=function(it,Et,It){return this.pdf.lines(it,Et,It,null,null)},le=function(it,Et,It,Ut,Xt,Kt,ie,Qt){this.pdf.internal.out([t(s(It+it)),t(n(Ut+Et)),t(s(Xt+it)),t(n(Kt+Et)),t(s(ie+it)),t(n(Qt+Et)),"c"].join(" "))},oe=function(it,Et,It,Ut){for(var Xt=2*Math.PI,Kt=Math.PI/2;Et>It;)Et-=Xt;var ie=Math.abs(It-Et);ie<Xt&&Ut&&(ie=Xt-ie);for(var Qt=[],Ae=Ut?-1:1,Le=Et;ie>1e-5;){var Fe=Le+Ae*Math.min(ie,Kt);Qt.push(de.call(this,it,Le,Fe)),ie-=Math.abs(Fe-Le),Le=Fe}return Qt},de=function(it,Et,It){var Ut=(It-Et)/2,Xt=it*Math.cos(Ut),Kt=it*Math.sin(Ut),ie=Xt,Qt=-Kt,Ae=ie*ie+Qt*Qt,Le=Ae+ie*Xt+Qt*Kt,Fe=4/3*(Math.sqrt(2*Ae*Le)-Le)/(ie*Kt-Qt*Xt),Ge=ie-Fe*Qt,Xe=Qt+Fe*ie,pe=Ge,Pt=-Xe,Zt=Ut+Et,ii=Math.cos(Zt),Pe=Math.sin(Zt);return{x1:it*Math.cos(Et),y1:it*Math.sin(Et),x2:Ge*ii-Xe*Pe,y2:Ge*Pe+Xe*ii,x3:pe*ii-Pt*Pe,y3:pe*Pe+Pt*ii,x4:it*Math.cos(It),y4:it*Math.sin(It)}},te=function(it){return 180*it/Math.PI},me=function(it,Et,It,Ut,Xt,Kt){var ie=it+.5*(It-it),Qt=Et+.5*(Ut-Et),Ae=Xt+.5*(It-Xt),Le=Kt+.5*(Ut-Kt),Fe=Math.min(it,Xt,ie,Ae),Ge=Math.max(it,Xt,ie,Ae),Xe=Math.min(Et,Kt,Qt,Le),pe=Math.max(Et,Kt,Qt,Le);return new l(Fe,Xe,Ge-Fe,pe-Xe)},ge=function(it,Et,It,Ut,Xt,Kt,ie,Qt){var Ae,Le,Fe,Ge,Xe,pe,Pt,Zt,ii,Pe,ve,Ee,Ve,ai,Ai=It-it,Ti=Ut-Et,Pi=Xt-It,qi=Kt-Ut,Ji=ie-Xt,ce=Qt-Kt;for(Le=0;Le<41;Le++)ii=(Pt=(Fe=it+(Ae=Le/40)*Ai)+Ae*((Xe=It+Ae*Pi)-Fe))+Ae*(Xe+Ae*(Xt+Ae*Ji-Xe)-Pt),Pe=(Zt=(Ge=Et+Ae*Ti)+Ae*((pe=Ut+Ae*qi)-Ge))+Ae*(pe+Ae*(Kt+Ae*ce-pe)-Zt),Le==0?(ve=ii,Ee=Pe,Ve=ii,ai=Pe):(ve=Math.min(ve,ii),Ee=Math.min(Ee,Pe),Ve=Math.max(Ve,ii),ai=Math.max(ai,Pe));return new l(Math.round(ve),Math.round(Ee),Math.round(Ve-ve),Math.round(ai-Ee))},ke=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var it,Et,It=(it=this.ctx.lineDash,Et=this.ctx.lineDashOffset,JSON.stringify({lineDash:it,lineDashOffset:Et}));this.prevLineDash!==It&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=It)}}})(ki.API),function(i){var t=function(n){var c,l,f,y,x,T,P,M,N,G;for(l=[],f=0,y=(n+=c="\0\0\0\0".slice(n.length%4||4)).length;y>f;f+=4)(x=(n.charCodeAt(f)<<24)+(n.charCodeAt(f+1)<<16)+(n.charCodeAt(f+2)<<8)+n.charCodeAt(f+3))!==0?(T=(x=((x=((x=((x=(x-(G=x%85))/85)-(N=x%85))/85)-(M=x%85))/85)-(P=x%85))/85)%85,l.push(T+33,P+33,M+33,N+33,G+33)):l.push(122);return function(Z,X){for(var $=X;$>0;$--)Z.pop()}(l,c.length),String.fromCharCode.apply(String,l)+"~>"},e=function(n){var c,l,f,y,x,T=String,P="length",M=255,N="charCodeAt",G="slice",Z="replace";for(n[G](-2),n=n[G](0,-2)[Z](/\s/g,"")[Z]("z","!!!!!"),f=[],y=0,x=(n+=c="uuuuu"[G](n[P]%5||5))[P];x>y;y+=5)l=52200625*(n[N](y)-33)+614125*(n[N](y+1)-33)+7225*(n[N](y+2)-33)+85*(n[N](y+3)-33)+(n[N](y+4)-33),f.push(M&l>>24,M&l>>16,M&l>>8,M&l);return function(X,$){for(var ct=$;ct>0;ct--)X.pop()}(f,c[P]),T.fromCharCode.apply(T,f)},r=function(n){var c=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((n=n.replace(/\s/g,"")).indexOf(">")!==-1&&(n=n.substr(0,n.indexOf(">"))),n.length%2&&(n+="0"),c.test(n)===!1)return"";for(var l="",f=0;f<n.length;f+=2)l+=String.fromCharCode("0x"+(n[f]+n[f+1]));return l},s=function(n){for(var c=new Uint8Array(n.length),l=n.length;l--;)c[l]=n.charCodeAt(l);return n=(c=H_(c)).reduce(function(f,y){return f+String.fromCharCode(y)},"")};i.processDataByFilters=function(n,c){var l=0,f=n||"",y=[];for(typeof(c=c||[])=="string"&&(c=[c]),l=0;l<c.length;l+=1)switch(c[l]){case"ASCII85Decode":case"/ASCII85Decode":f=e(f),y.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":f=t(f),y.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":f=r(f),y.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":f=f.split("").map(function(x){return("0"+x.charCodeAt().toString(16)).slice(-2)}).join("")+">",y.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":f=s(f),y.push("/FlateDecode");break;default:throw new Error('The filter: "'+c[l]+'" is not implemented')}return{data:f,reverseChain:y.reverse().join(" ")}}}(ki.API),function(i){i.loadFile=function(t,e,r){return function(s,n,c){n=n!==!1,c=typeof c=="function"?c:function(){};var l=void 0;try{l=function(f,y,x){var T=new XMLHttpRequest,P=0,M=function(N){var G=N.length,Z=[],X=String.fromCharCode;for(P=0;P<G;P+=1)Z.push(X(255&N.charCodeAt(P)));return Z.join("")};if(T.open("GET",f,!y),T.overrideMimeType("text/plain; charset=x-user-defined"),y===!1&&(T.onload=function(){T.status===200?x(M(this.responseText)):x(void 0)}),T.send(null),y&&T.status===200)return M(T.responseText)}(s,n,c)}catch{}return l}(t,e,r)},i.loadImageFile=i.loadFile}(ki.API),function(i){function t(){return(Oi.html2canvas?Promise.resolve(Oi.html2canvas):Jy(()=>import("./html2canvas.esm-DbilGY6A-DB3xAFLF-mQbHvwLr.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load html2canvas: "+c))}).then(function(c){return c.default?c.default:c})}function e(){return(Oi.DOMPurify?Promise.resolve(Oi.DOMPurify):Jy(()=>import("./purify.es-C-d0AVPf-BZqXIm-R-GlwoURd-.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load dompurify: "+c))}).then(function(c){return c.default?c.default:c})}var r=function(c){var l=Fr(c);return l==="undefined"?"undefined":l==="string"||c instanceof String?"string":l==="number"||c instanceof Number?"number":l==="function"||c instanceof Function?"function":c&&c.constructor===Array?"array":c&&c.nodeType===1?"element":l==="object"?"object":"unknown"},s=function(c,l){var f=document.createElement(c);for(var y in l.className&&(f.className=l.className),l.innerHTML&&l.dompurify&&(f.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)f.style[y]=l.style[y];return f},n=function c(l){var f=Object.assign(c.convert(Promise.resolve()),JSON.parse(JSON.stringify(c.template))),y=c.convert(Promise.resolve(),f);return y=(y=y.setProgress(1,c,1,[c])).set(l)};(n.prototype=Object.create(Promise.prototype)).constructor=n,n.convert=function(c,l){return c.__proto__=l||n.prototype,c},n.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},n.prototype.from=function(c,l){return this.then(function(){switch(l=l||function(f){switch(r(f)){case"string":return"string";case"element":return f.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(c)){case"string":return this.then(e).then(function(f){return this.set({src:s("div",{innerHTML:c,dompurify:f})})});case"element":return this.set({src:c});case"canvas":return this.set({canvas:c});case"img":return this.set({img:c});default:return this.error("Unknown source type.")}})},n.prototype.to=function(c){switch(c){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},n.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var c={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=function f(y,x){for(var T=y.nodeType===3?document.createTextNode(y.nodeValue):y.cloneNode(!1),P=y.firstChild;P;P=P.nextSibling)x!==!0&&P.nodeType===1&&P.nodeName==="SCRIPT"||T.appendChild(f(P,x));return y.nodeType===1&&(y.nodeName==="CANVAS"?(T.width=y.width,T.height=y.height,T.getContext("2d").drawImage(y,0,0)):y.nodeName!=="TEXTAREA"&&y.nodeName!=="SELECT"||(T.value=y.value),T.addEventListener("load",function(){T.scrollTop=y.scrollTop,T.scrollLeft=y.scrollLeft},!0)),T}(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(c.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=s("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=s("div",{className:"html2pdf__container",style:c}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(s("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},n.prototype.toCanvas=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(l){var f=Object.assign({},this.opt.html2canvas);return delete f.onrendered,l(this.prop.container,f)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},n.prototype.toContext2d=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(l){var f=this.opt.jsPDF,y=this.opt.fontFaces,x=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,T=Object.assign({async:!0,allowTaint:!0,scale:x,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete T.onrendered,f.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,f.context2d.posX=this.opt.x,f.context2d.posY=this.opt.y,f.context2d.margin=this.opt.margin,f.context2d.fontFaces=y,y)for(var P=0;P<y.length;++P){var M=y[P],N=M.src.find(function(G){return G.format==="truetype"});N&&f.addFont(N.url,M.ref.name,M.ref.style)}return T.windowHeight=T.windowHeight||0,T.windowHeight=T.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):T.windowHeight,f.context2d.save(!0),l(this.prop.container,T)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},n.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var c=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=c})},n.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},n.prototype.output=function(c,l,f){return(f=f||"pdf").toLowerCase()==="img"||f.toLowerCase()==="image"?this.outputImg(c,l):this.outputPdf(c,l)},n.prototype.outputPdf=function(c,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(c,l)})},n.prototype.outputImg=function(c){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(c){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+c+'" is not supported.'}})},n.prototype.save=function(c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(c?{filename:c}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},n.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},n.prototype.set=function(c){if(r(c)!=="object")return this;var l=Object.keys(c||{}).map(function(f){if(f in n.template.prop)return function(){this.prop[f]=c[f]};switch(f){case"margin":return this.setMargin.bind(this,c.margin);case"jsPDF":return function(){return this.opt.jsPDF=c.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,c.pageSize);default:return function(){this.opt[f]=c[f]}}},this);return this.then(function(){return this.thenList(l)})},n.prototype.get=function(c,l){return this.then(function(){var f=c in n.template.prop?this.prop[c]:this.opt[c];return l?l(f):f})},n.prototype.setMargin=function(c){return this.then(function(){switch(r(c)){case"number":c=[c,c,c,c];case"array":if(c.length===2&&(c=[c[0],c[1],c[0],c[1]]),c.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=c}).then(this.setPageSize)},n.prototype.setPageSize=function(c){function l(f,y){return Math.floor(f*y/72*96)}return this.then(function(){(c=c||ki.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(c.inner={width:c.width-this.opt.margin[1]-this.opt.margin[3],height:c.height-this.opt.margin[0]-this.opt.margin[2]},c.inner.px={width:l(c.inner.width,c.k),height:l(c.inner.height,c.k)},c.inner.ratio=c.inner.height/c.inner.width),this.prop.pageSize=c})},n.prototype.setProgress=function(c,l,f,y){return c!=null&&(this.progress.val=c),l!=null&&(this.progress.state=l),f!=null&&(this.progress.n=f),y!=null&&(this.progress.stack=y),this.progress.ratio=this.progress.val/this.progress.state,this},n.prototype.updateProgress=function(c,l,f,y){return this.setProgress(c?this.progress.val+c:null,l||null,f?this.progress.n+f:null,y?this.progress.stack.concat(y):null)},n.prototype.then=function(c,l){var f=this;return this.thenCore(c,l,function(y,x){return f.updateProgress(null,null,1,[y]),Promise.prototype.then.call(this,function(T){return f.updateProgress(null,y),T}).then(y,x).then(function(T){return f.updateProgress(1),T})})},n.prototype.thenCore=function(c,l,f){f=f||Promise.prototype.then,c&&(c=c.bind(this)),l&&(l=l.bind(this));var y=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:n.convert(Object.assign({},this),Promise.prototype),x=f.call(y,c,l);return n.convert(x,this.__proto__)},n.prototype.thenExternal=function(c,l){return Promise.prototype.then.call(this,c,l)},n.prototype.thenList=function(c){var l=this;return c.forEach(function(f){l=l.thenCore(f)}),l},n.prototype.catch=function(c){c&&(c=c.bind(this));var l=Promise.prototype.catch.call(this,c);return n.convert(l,this)},n.prototype.catchExternal=function(c){return Promise.prototype.catch.call(this,c)},n.prototype.error=function(c){return this.then(function(){throw new Error(c)})},n.prototype.using=n.prototype.set,n.prototype.saveAs=n.prototype.save,n.prototype.export=n.prototype.output,n.prototype.run=n.prototype.then,ki.getPageSize=function(c,l,f){if(Fr(c)==="object"){var y=c;c=y.orientation,l=y.unit||l,f=y.format||f}l=l||"mm",f=f||"a4",c=(""+(c||"P")).toLowerCase();var x,T=(""+f).toLowerCase(),P={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":x=1;break;case"mm":x=72/25.4;break;case"cm":x=72/2.54;break;case"in":x=72;break;case"px":x=.75;break;case"pc":case"em":x=12;break;case"ex":x=6;break;default:throw"Invalid unit: "+l}var M,N=0,G=0;if(P.hasOwnProperty(T))N=P[T][1]/x,G=P[T][0]/x;else try{N=f[1],G=f[0]}catch{throw new Error("Invalid format: "+f)}if(c==="p"||c==="portrait")c="p",G>N&&(M=G,G=N,N=M);else{if(c!=="l"&&c!=="landscape")throw"Invalid orientation: "+c;c="l",N>G&&(M=G,G=N,N=M)}return{width:G,height:N,unit:l,k:x,orientation:c}},i.html=function(c,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(K_):null;var f=new n(l);return l.worker?f:f.from(c).doCallback()}}(ki.API),ki.API.addJS=function(i){return U5=i,this.internal.events.subscribe("postPutResources",function(){Cg=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Cg+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),j5=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+U5+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Cg!==void 0&&j5!==void 0&&this.internal.out("/Names <</JavaScript "+Cg+" 0 R>>")}),this},function(i){var t;i.events.push(["postPutResources",function(){var e=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var s=e.outline.render().split(/\r\n/),n=0;n<s.length;n++){var c=s[n],l=r.exec(c);if(l!=null){var f=l[1];e.internal.newObjectDeferredBegin(f,!1)}e.internal.write(c)}if(this.outline.createNamedDestinations){var y=this.internal.pages.length,x=[];for(n=0;n<y;n++){var T=e.internal.newObject();x.push(T);var P=e.internal.getPageInfo(n+1);e.internal.write("<< /D["+P.objId+" 0 R /XYZ null null null]>> endobj")}var M=e.internal.newObject();for(e.internal.write("<< /Names [ "),n=0;n<x.length;n++)e.internal.write("(page_"+(n+1)+")"+x[n]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+M+" 0 R"),e.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),i.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(r,s,n){var c={title:s,options:n,children:[]};return r==null&&(r=this.root),r.children.push(c),c},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(r){r.id=e.internal.newObjectDeferred();for(var s=0;s<r.children.length;s++)this.genIds_r(r.children[s])},e.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},e.outline.renderItems=function(r){for(var s=this.ctx.pdf.internal.getVerticalCoordinateString,n=0;n<r.children.length;n++){var c=r.children[n];this.objStart(c),this.line("/Title "+this.makeString(c.title)),this.line("/Parent "+this.makeRef(r)),n>0&&this.line("/Prev "+this.makeRef(r.children[n-1])),n<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[n+1])),c.children.length>0&&(this.line("/First "+this.makeRef(c.children[0])),this.line("/Last "+this.makeRef(c.children[c.children.length-1])));var l=this.count=this.count_r({count:0},c);if(l>0&&this.line("/Count "+l),c.options&&c.options.pageNumber){var f=e.internal.getPageInfo(c.options.pageNumber);this.line("/Dest ["+f.objId+" 0 R /XYZ 0 "+s(0)+" 0]")}this.objEnd()}for(var y=0;y<r.children.length;y++)this.renderItems(r.children[y])},e.outline.line=function(r){this.ctx.val+=r+`\r
`},e.outline.makeRef=function(r){return r.id+" 0 R"},e.outline.makeString=function(r){return"("+e.internal.pdfEscape(r)+")"},e.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(r,s){for(var n=0;n<s.children.length;n++)r.count++,this.count_r(r,s.children[n]);return r.count}}])}(ki.API),function(i){var t=[192,193,194,195,196,197,198,199];i.processJPEG=function(e,r,s,n,c,l){var f,y=this.decode.DCT_DECODE,x=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=c||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(f=function(T){for(var P,M=256*T.charCodeAt(4)+T.charCodeAt(5),N=T.length,G={width:0,height:0,numcomponents:1},Z=4;Z<N;Z+=2){if(Z+=M,t.indexOf(T.charCodeAt(Z+1))!==-1){P=256*T.charCodeAt(Z+5)+T.charCodeAt(Z+6),G={width:256*T.charCodeAt(Z+7)+T.charCodeAt(Z+8),height:P,numcomponents:T.charCodeAt(Z+9)};break}M=256*T.charCodeAt(Z+2)+T.charCodeAt(Z+3)}return G}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}x={data:e,width:f.width,height:f.height,colorSpace:l,bitsPerComponent:8,filter:y,index:r,alias:s}}return x}}(ki.API);var fd,Tg,V5,q5,H5,mV=function(){var i,t,e;function r(n){var c,l,f,y,x,T,P,M,N,G,Z,X,$,ct;for(this.data=n,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},T=null;;){switch(c=this.readUInt32(),N=(function(){var yt,Mt;for(Mt=[],yt=0;yt<4;++yt)Mt.push(String.fromCharCode(this.data[this.pos++]));return Mt}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(c);break;case"fcTL":T&&this.animation.frames.push(T),this.pos+=4,T={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},x=this.readUInt16(),y=this.readUInt16()||100,T.delay=1e3*x/y,T.disposeOp=this.data[this.pos++],T.blendOp=this.data[this.pos++],T.data=[];break;case"IDAT":case"fdAT":for(N==="fdAT"&&(this.pos+=4,c-=4),n=(T!=null?T.data:void 0)||this.imgData,X=0;0<=c?X<c:X>c;0<=c?++X:--X)n.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(f=this.palette.length/3,this.transparency.indexed=this.read(c),this.transparency.indexed.length>f)throw new Error("More transparent colors than palette size");if((G=f-this.transparency.indexed.length)>0)for($=0;0<=G?$<G:$>G;0<=G?++$:--$)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case"tEXt":P=(Z=this.read(c)).indexOf(0),M=String.fromCharCode.apply(String,Z.slice(0,P)),this.text[M]=String.fromCharCode.apply(String,Z.slice(P+1));break;case"IEND":return T&&this.animation.frames.push(T),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(ct=this.colorType)===4||ct===6,l=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*l,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=c}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(n){var c,l;for(l=[],c=0;0<=n?c<n:c>n;0<=n?++c:--c)l.push(this.data[this.pos++]);return l},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(n){var c=this.pixelBitlength/8,l=new Uint8Array(this.width*this.height*c),f=0,y=this;if(n==null&&(n=this.imgData),n.length===0)return new Uint8Array(0);function x(T,P,M,N){var G,Z,X,$,ct,yt,Mt,Nt,Rt,xt,qt,zt,ot,dt,Lt,wt,le,oe,de,te,me,ge=Math.ceil((y.width-T)/M),ke=Math.ceil((y.height-P)/N),it=y.width==ge&&y.height==ke;for(dt=c*ge,zt=it?l:new Uint8Array(dt*ke),yt=n.length,ot=0,Z=0;ot<ke&&f<yt;){switch(n[f++]){case 0:for($=le=0;le<dt;$=le+=1)zt[Z++]=n[f++];break;case 1:for($=oe=0;oe<dt;$=oe+=1)G=n[f++],ct=$<c?0:zt[Z-c],zt[Z++]=(G+ct)%256;break;case 2:for($=de=0;de<dt;$=de+=1)G=n[f++],X=($-$%c)/c,Lt=ot&&zt[(ot-1)*dt+X*c+$%c],zt[Z++]=(Lt+G)%256;break;case 3:for($=te=0;te<dt;$=te+=1)G=n[f++],X=($-$%c)/c,ct=$<c?0:zt[Z-c],Lt=ot&&zt[(ot-1)*dt+X*c+$%c],zt[Z++]=(G+Math.floor((ct+Lt)/2))%256;break;case 4:for($=me=0;me<dt;$=me+=1)G=n[f++],X=($-$%c)/c,ct=$<c?0:zt[Z-c],ot===0?Lt=wt=0:(Lt=zt[(ot-1)*dt+X*c+$%c],wt=X&&zt[(ot-1)*dt+(X-1)*c+$%c]),Mt=ct+Lt-wt,Nt=Math.abs(Mt-ct),xt=Math.abs(Mt-Lt),qt=Math.abs(Mt-wt),Rt=Nt<=xt&&Nt<=qt?ct:xt<=qt?Lt:wt,zt[Z++]=(G+Rt)%256;break;default:throw new Error("Invalid filter algorithm: "+n[f-1])}if(!it){var Et=((P+ot*N)*y.width+T)*c,It=ot*dt;for($=0;$<ge;$+=1){for(var Ut=0;Ut<c;Ut+=1)l[Et++]=zt[It++];Et+=(M-1)*c}}ot++}}return n=$G(n),y.interlaceMethod==1?(x(0,0,8,8),x(4,0,8,8),x(0,4,4,8),x(2,0,4,4),x(0,2,2,4),x(1,0,2,2),x(0,1,1,2)):x(0,0,1,1),l},r.prototype.decodePalette=function(){var n,c,l,f,y,x,T,P,M;for(l=this.palette,x=this.transparency.indexed||[],y=new Uint8Array((x.length||0)+l.length),f=0,n=0,c=T=0,P=l.length;T<P;c=T+=3)y[f++]=l[c],y[f++]=l[c+1],y[f++]=l[c+2],y[f++]=(M=x[n++])!=null?M:255;return y},r.prototype.copyToImageData=function(n,c){var l,f,y,x,T,P,M,N,G,Z,X;if(f=this.colors,G=null,l=this.hasAlphaChannel,this.palette.length&&(G=(X=this._decodedPalette)!=null?X:this._decodedPalette=this.decodePalette(),f=4,l=!0),N=(y=n.data||n).length,T=G||c,x=P=0,f===1)for(;x<N;)M=G?4*c[x/4]:P,Z=T[M++],y[x++]=Z,y[x++]=Z,y[x++]=Z,y[x++]=l?T[M++]:255,P=M;else for(;x<N;)M=G?4*c[x/4]:P,y[x++]=T[M++],y[x++]=T[M++],y[x++]=T[M++],y[x++]=l?T[M++]:255,P=M},r.prototype.decode=function(){var n;return n=new Uint8Array(this.width*this.height*4),this.copyToImageData(n,this.decodePixels()),n};var s=function(){if(Object.prototype.toString.call(Oi)==="[object Window]"){try{t=Oi.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return s(),i=function(n){var c;if(s()===!0)return e.width=n.width,e.height=n.height,e.clearRect(0,0,n.width,n.height),e.putImageData(n,0,0),(c=new Image).src=t.toDataURL(),c;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(n){var c,l,f,y,x,T,P,M;if(this.animation){for(M=[],l=x=0,T=(P=this.animation.frames).length;x<T;l=++x)c=P[l],f=n.createImageData(c.width,c.height),y=this.decodePixels(new Uint8Array(c.data)),this.copyToImageData(f,y),c.imageData=f,M.push(c.image=i(f));return M}},r.prototype.renderFrame=function(n,c){var l,f,y;return l=(f=this.animation.frames)[c],y=f[c-1],c===0&&n.clearRect(0,0,this.width,this.height),(y!=null?y.disposeOp:void 0)===1?n.clearRect(y.xOffset,y.yOffset,y.width,y.height):(y!=null?y.disposeOp:void 0)===2&&n.putImageData(y.imageData,y.xOffset,y.yOffset),l.blendOp===0&&n.clearRect(l.xOffset,l.yOffset,l.width,l.height),n.drawImage(l.image,l.xOffset,l.yOffset)},r.prototype.animate=function(n){var c,l,f,y,x,T,P=this;return l=0,T=this.animation,y=T.numFrames,f=T.frames,x=T.numPlays,(c=function(){var M,N;if(M=l++%y,N=f[M],P.renderFrame(n,M),y>1&&l/y<x)return P.animation._timeout=setTimeout(c,N.delay)})()},r.prototype.stopAnimation=function(){var n;return clearTimeout((n=this.animation)!=null?n._timeout:void 0)},r.prototype.render=function(n){var c,l;return n._png&&n._png.stopAnimation(),n._png=this,n.width=this.width,n.height=this.height,c=n.getContext("2d"),this.animation?(this.decodeFrames(c),this.animate(c)):(l=c.createImageData(this.width,this.height),this.copyToImageData(l,this.decodePixels()),c.putImageData(l,0,0))},r}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function yV(i){var t=0;if(i[t++]!==71||i[t++]!==73||i[t++]!==70||i[t++]!==56||(i[t++]+1&253)!=56||i[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=i[t++]|i[t++]<<8,r=i[t++]|i[t++]<<8,s=i[t++],n=s>>7,c=1<<(7&s)+1;i[t++],i[t++];var l=null,f=null;n&&(l=t,f=c,t+=3*c);var y=!0,x=[],T=0,P=null,M=0,N=null;for(this.width=e,this.height=r;y&&t<i.length;)switch(i[t++]){case 33:switch(i[t++]){case 255:if(i[t]!==11||i[t+1]==78&&i[t+2]==69&&i[t+3]==84&&i[t+4]==83&&i[t+5]==67&&i[t+6]==65&&i[t+7]==80&&i[t+8]==69&&i[t+9]==50&&i[t+10]==46&&i[t+11]==48&&i[t+12]==3&&i[t+13]==1&&i[t+16]==0)t+=14,N=i[t++]|i[t++]<<8,t++;else for(t+=12;;){if(!((ot=i[t++])>=0))throw Error("Invalid block size");if(ot===0)break;t+=ot}break;case 249:if(i[t++]!==4||i[t+4]!==0)throw new Error("Invalid graphics extension block.");var G=i[t++];T=i[t++]|i[t++]<<8,P=i[t++],!(1&G)&&(P=null),M=G>>2&7,t++;break;case 254:for(;;){if(!((ot=i[t++])>=0))throw Error("Invalid block size");if(ot===0)break;t+=ot}break;default:throw new Error("Unknown graphic control label: 0x"+i[t-1].toString(16))}break;case 44:var Z=i[t++]|i[t++]<<8,X=i[t++]|i[t++]<<8,$=i[t++]|i[t++]<<8,ct=i[t++]|i[t++]<<8,yt=i[t++],Mt=yt>>6&1,Nt=1<<(7&yt)+1,Rt=l,xt=f,qt=!1;yt>>7&&(qt=!0,Rt=t,xt=Nt,t+=3*Nt);var zt=t;for(t++;;){var ot;if(!((ot=i[t++])>=0))throw Error("Invalid block size");if(ot===0)break;t+=ot}x.push({x:Z,y:X,width:$,height:ct,has_local_palette:qt,palette_offset:Rt,palette_size:xt,data_offset:zt,data_length:t-zt,transparent_index:P,interlaced:!!Mt,delay:T,disposal:M});break;case 59:y=!1;break;default:throw new Error("Unknown gif block: 0x"+i[t-1].toString(16))}this.numFrames=function(){return x.length},this.loopCount=function(){return N},this.frameInfo=function(dt){if(dt<0||dt>=x.length)throw new Error("Frame index out of range.");return x[dt]},this.decodeAndBlitFrameBGRA=function(dt,Lt){var wt=this.frameInfo(dt),le=wt.width*wt.height,oe=new Uint8Array(le);W5(i,wt.data_offset,oe,le);var de=wt.palette_offset,te=wt.transparent_index;te===null&&(te=256);var me=wt.width,ge=e-me,ke=me,it=4*(wt.y*e+wt.x),Et=4*((wt.y+wt.height)*e+wt.x),It=it,Ut=4*ge;wt.interlaced===!0&&(Ut+=4*e*7);for(var Xt=8,Kt=0,ie=oe.length;Kt<ie;++Kt){var Qt=oe[Kt];if(ke===0&&(ke=me,(It+=Ut)>=Et&&(Ut=4*ge+4*e*(Xt-1),It=it+(me+ge)*(Xt<<1),Xt>>=1)),Qt===te)It+=4;else{var Ae=i[de+3*Qt],Le=i[de+3*Qt+1],Fe=i[de+3*Qt+2];Lt[It++]=Fe,Lt[It++]=Le,Lt[It++]=Ae,Lt[It++]=255}--ke}},this.decodeAndBlitFrameRGBA=function(dt,Lt){var wt=this.frameInfo(dt),le=wt.width*wt.height,oe=new Uint8Array(le);W5(i,wt.data_offset,oe,le);var de=wt.palette_offset,te=wt.transparent_index;te===null&&(te=256);var me=wt.width,ge=e-me,ke=me,it=4*(wt.y*e+wt.x),Et=4*((wt.y+wt.height)*e+wt.x),It=it,Ut=4*ge;wt.interlaced===!0&&(Ut+=4*e*7);for(var Xt=8,Kt=0,ie=oe.length;Kt<ie;++Kt){var Qt=oe[Kt];if(ke===0&&(ke=me,(It+=Ut)>=Et&&(Ut=4*ge+4*e*(Xt-1),It=it+(me+ge)*(Xt<<1),Xt>>=1)),Qt===te)It+=4;else{var Ae=i[de+3*Qt],Le=i[de+3*Qt+1],Fe=i[de+3*Qt+2];Lt[It++]=Ae,Lt[It++]=Le,Lt[It++]=Fe,Lt[It++]=255}--ke}}}function W5(i,t,e,r){for(var s=i[t++],n=1<<s,c=n+1,l=c+1,f=s+1,y=(1<<f)-1,x=0,T=0,P=0,M=i[t++],N=new Int32Array(4096),G=null;;){for(;x<16&&M!==0;)T|=i[t++]<<x,x+=8,M===1?M=i[t++]:--M;if(x<f)break;var Z=T&y;if(T>>=f,x-=f,Z!==n){if(Z===c)break;for(var X=Z<l?Z:G,$=0,ct=X;ct>n;)ct=N[ct]>>8,++$;var yt=ct;if(P+$+(X!==Z?1:0)>r)return void Yr.log("Warning, gif stream longer than expected.");e[P++]=yt;var Mt=P+=$;for(X!==Z&&(e[P++]=yt),ct=X;$--;)ct=N[ct],e[--Mt]=255&ct,ct>>=8;G!==null&&l<4096&&(N[l++]=G<<8|yt,l>=y+1&&f<12&&(++f,y=y<<1|1)),G=Z}else l=c+1,y=(1<<(f=s+1))-1,G=null}return P!==r&&Yr.log("Warning, gif stream shorter than expected."),e}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Uy(i){var t,e,r,s,n,c=Math.floor,l=new Array(64),f=new Array(64),y=new Array(64),x=new Array(64),T=new Array(65535),P=new Array(65535),M=new Array(64),N=new Array(64),G=[],Z=0,X=7,$=new Array(64),ct=new Array(64),yt=new Array(64),Mt=new Array(256),Nt=new Array(2048),Rt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],xt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],qt=[0,1,2,3,4,5,6,7,8,9,10,11],zt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ot=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],dt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Lt=[0,1,2,3,4,5,6,7,8,9,10,11],wt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],le=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function oe(it,Et){for(var It=0,Ut=0,Xt=new Array,Kt=1;Kt<=16;Kt++){for(var ie=1;ie<=it[Kt];ie++)Xt[Et[Ut]]=[],Xt[Et[Ut]][0]=It,Xt[Et[Ut]][1]=Kt,Ut++,It++;It*=2}return Xt}function de(it){for(var Et=it[0],It=it[1]-1;It>=0;)Et&1<<It&&(Z|=1<<X),It--,--X<0&&(Z==255?(te(255),te(0)):te(Z),X=7,Z=0)}function te(it){G.push(it)}function me(it){te(it>>8&255),te(255&it)}function ge(it,Et,It,Ut,Xt){for(var Kt,ie=Xt[0],Qt=Xt[240],Ae=function(Pe,ve){var Ee,Ve,ai,Ai,Ti,Pi,qi,Ji,ce,Ei,Re=0;for(ce=0;ce<8;++ce){Ee=Pe[Re],Ve=Pe[Re+1],ai=Pe[Re+2],Ai=Pe[Re+3],Ti=Pe[Re+4],Pi=Pe[Re+5],qi=Pe[Re+6];var jr=Ee+(Ji=Pe[Re+7]),Ci=Ee-Ji,Te=Ve+qi,Ke=Ve-qi,Qe=ai+Pi,hr=ai-Pi,Di=Ai+Ti,vi=Ai-Ti,yr=jr+Di,sr=jr-Di,vt=Te+Qe,K=Te-Qe;Pe[Re]=yr+vt,Pe[Re+4]=yr-vt;var Y=.707106781*(K+sr);Pe[Re+2]=sr+Y,Pe[Re+6]=sr-Y;var st=.382683433*((yr=vi+hr)-(K=Ke+Ci)),_t=.5411961*yr+st,kt=1.306562965*K+st,Ft=.707106781*(vt=hr+Ke),Vt=Ci+Ft,At=Ci-Ft;Pe[Re+5]=At+_t,Pe[Re+3]=At-_t,Pe[Re+1]=Vt+kt,Pe[Re+7]=Vt-kt,Re+=8}for(Re=0,ce=0;ce<8;++ce){Ee=Pe[Re],Ve=Pe[Re+8],ai=Pe[Re+16],Ai=Pe[Re+24],Ti=Pe[Re+32],Pi=Pe[Re+40],qi=Pe[Re+48];var Jt=Ee+(Ji=Pe[Re+56]),ye=Ee-Ji,he=Ve+qi,ae=Ve-qi,qe=ai+Pi,Je=ai-Pi,bi=Ai+Ti,si=Ai-Ti,Si=Jt+bi,Ni=Jt-bi,Hi=he+qe,nr=he-qe;Pe[Re]=Si+Hi,Pe[Re+32]=Si-Hi;var li=.707106781*(nr+Ni);Pe[Re+16]=Ni+li,Pe[Re+48]=Ni-li;var ji=.382683433*((Si=si+Je)-(nr=ae+ye)),ur=.5411961*Si+ji,Mr=1.306562965*nr+ji,Ur=.707106781*(Hi=Je+ae),Er=ye+Ur,ks=ye-Ur;Pe[Re+40]=ks+ur,Pe[Re+24]=ks-ur,Pe[Re+8]=Er+Mr,Pe[Re+56]=Er-Mr,Re++}for(ce=0;ce<64;++ce)Ei=Pe[ce]*ve[ce],M[ce]=Ei>0?Ei+.5|0:Ei-.5|0;return M}(it,Et),Le=0;Le<64;++Le)N[Rt[Le]]=Ae[Le];var Fe=N[0]-It;It=N[0],Fe==0?de(Ut[0]):(de(Ut[P[Kt=32767+Fe]]),de(T[Kt]));for(var Ge=63;Ge>0&&N[Ge]==0;)Ge--;if(Ge==0)return de(ie),It;for(var Xe,pe=1;pe<=Ge;){for(var Pt=pe;N[pe]==0&&pe<=Ge;)++pe;var Zt=pe-Pt;if(Zt>=16){Xe=Zt>>4;for(var ii=1;ii<=Xe;++ii)de(Qt);Zt&=15}Kt=32767+N[pe],de(Xt[(Zt<<4)+P[Kt]]),de(T[Kt]),pe++}return Ge!=63&&de(ie),It}function ke(it){it=Math.min(Math.max(it,1),100),n!=it&&(function(Et){for(var It=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ut=0;Ut<64;Ut++){var Xt=c((It[Ut]*Et+50)/100);Xt=Math.min(Math.max(Xt,1),255),l[Rt[Ut]]=Xt}for(var Kt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ie=0;ie<64;ie++){var Qt=c((Kt[ie]*Et+50)/100);Qt=Math.min(Math.max(Qt,1),255),f[Rt[ie]]=Qt}for(var Ae=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Le=0,Fe=0;Fe<8;Fe++)for(var Ge=0;Ge<8;Ge++)y[Le]=1/(l[Rt[Le]]*Ae[Fe]*Ae[Ge]*8),x[Le]=1/(f[Rt[Le]]*Ae[Fe]*Ae[Ge]*8),Le++}(it<50?Math.floor(5e3/it):Math.floor(200-2*it)),n=it)}this.encode=function(it,Et){Et&&ke(Et),G=new Array,Z=0,X=7,me(65496),me(65504),me(16),te(74),te(70),te(73),te(70),te(0),te(1),te(1),te(0),me(1),me(1),te(0),te(0),function(){me(65499),me(132),te(0);for(var Ve=0;Ve<64;Ve++)te(l[Ve]);te(1);for(var ai=0;ai<64;ai++)te(f[ai])}(),function(Ve,ai){me(65472),me(17),te(8),me(ai),me(Ve),te(3),te(1),te(17),te(0),te(2),te(17),te(1),te(3),te(17),te(1)}(it.width,it.height),function(){me(65476),me(418),te(0);for(var Ve=0;Ve<16;Ve++)te(xt[Ve+1]);for(var ai=0;ai<=11;ai++)te(qt[ai]);te(16);for(var Ai=0;Ai<16;Ai++)te(zt[Ai+1]);for(var Ti=0;Ti<=161;Ti++)te(ot[Ti]);te(1);for(var Pi=0;Pi<16;Pi++)te(dt[Pi+1]);for(var qi=0;qi<=11;qi++)te(Lt[qi]);te(17);for(var Ji=0;Ji<16;Ji++)te(wt[Ji+1]);for(var ce=0;ce<=161;ce++)te(le[ce])}(),me(65498),me(12),te(3),te(1),te(0),te(2),te(17),te(3),te(17),te(0),te(63),te(0);var It=0,Ut=0,Xt=0;Z=0,X=7,this.encode.displayName="_encode_";for(var Kt,ie,Qt,Ae,Le,Fe,Ge,Xe,pe,Pt=it.data,Zt=it.width,ii=it.height,Pe=4*Zt,ve=0;ve<ii;){for(Kt=0;Kt<Pe;){for(Le=Pe*ve+Kt,Ge=-1,Xe=0,pe=0;pe<64;pe++)Fe=Le+(Xe=pe>>3)*Pe+(Ge=4*(7&pe)),ve+Xe>=ii&&(Fe-=Pe*(ve+1+Xe-ii)),Kt+Ge>=Pe&&(Fe-=Kt+Ge-Pe+4),ie=Pt[Fe++],Qt=Pt[Fe++],Ae=Pt[Fe++],$[pe]=(Nt[ie]+Nt[Qt+256>>0]+Nt[Ae+512>>0]>>16)-128,ct[pe]=(Nt[ie+768>>0]+Nt[Qt+1024>>0]+Nt[Ae+1280>>0]>>16)-128,yt[pe]=(Nt[ie+1280>>0]+Nt[Qt+1536>>0]+Nt[Ae+1792>>0]>>16)-128;It=ge($,y,It,t,r),Ut=ge(ct,x,Ut,e,s),Xt=ge(yt,x,Xt,e,s),Kt+=32}ve+=8}if(X>=0){var Ee=[];Ee[1]=X+1,Ee[0]=(1<<X+1)-1,de(Ee)}return me(65497),new Uint8Array(G)},i=i||50,function(){for(var it=String.fromCharCode,Et=0;Et<256;Et++)Mt[Et]=it(Et)}(),t=oe(xt,qt),e=oe(dt,Lt),r=oe(zt,ot),s=oe(wt,le),function(){for(var it=1,Et=2,It=1;It<=15;It++){for(var Ut=it;Ut<Et;Ut++)P[32767+Ut]=It,T[32767+Ut]=[],T[32767+Ut][1]=It,T[32767+Ut][0]=Ut;for(var Xt=-(Et-1);Xt<=-it;Xt++)P[32767+Xt]=It,T[32767+Xt]=[],T[32767+Xt][1]=It,T[32767+Xt][0]=Et-1+Xt;it<<=1,Et<<=1}}(),function(){for(var it=0;it<256;it++)Nt[it]=19595*it,Nt[it+256>>0]=38470*it,Nt[it+512>>0]=7471*it+32768,Nt[it+768>>0]=-11059*it,Nt[it+1024>>0]=-21709*it,Nt[it+1280>>0]=32768*it+8421375,Nt[it+1536>>0]=-27439*it,Nt[it+1792>>0]=-5329*it}(),ke(i)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function wl(i,t){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function J5(i){function t(xt){if(!xt)throw Error("assert :P")}function e(xt,qt,zt){for(var ot=0;4>ot;ot++)if(xt[qt+ot]!=zt.charCodeAt(ot))return!0;return!1}function r(xt,qt,zt,ot,dt){for(var Lt=0;Lt<dt;Lt++)xt[qt+Lt]=zt[ot+Lt]}function s(xt,qt,zt,ot){for(var dt=0;dt<ot;dt++)xt[qt+dt]=zt}function n(xt){return new Int32Array(xt)}function c(xt,qt){for(var zt=[],ot=0;ot<xt;ot++)zt.push(new qt);return zt}function l(xt,qt){var zt=[];return function ot(dt,Lt,wt){for(var le=wt[Lt],oe=0;oe<le&&(dt.push(wt.length>Lt+1?[]:new qt),!(wt.length<Lt+1));oe++)ot(dt[oe],Lt+1,wt)}(zt,0,xt),zt}var f=function(){var xt=this;function qt(g,b){for(var E=1<<b-1>>>0;g&E;)E>>>=1;return E?(g&E-1)+E:g}function zt(g,b,E,I,O){t(!(I%E));do g[b+(I-=E)]=O;while(0<I)}function ot(g,b,E,I,O){if(t(2328>=O),512>=O)var F=n(512);else if((F=n(O))==null)return 0;return function(z,V,U,W,at,tt){var ht,ut,Tt=V,bt=1<<U,pt=n(16),ft=n(16);for(t(at!=0),t(W!=null),t(z!=null),t(0<U),ut=0;ut<at;++ut){if(15<W[ut])return 0;++pt[W[ut]]}if(pt[0]==at)return 0;for(ft[1]=0,ht=1;15>ht;++ht){if(pt[ht]>1<<ht)return 0;ft[ht+1]=ft[ht]+pt[ht]}for(ut=0;ut<at;++ut)ht=W[ut],0<W[ut]&&(tt[ft[ht]++]=ut);if(ft[15]==1)return(W=new dt).g=0,W.value=tt[0],zt(z,Tt,1,bt,W),bt;var jt,Wt=-1,se=bt-1,ne=0,fe=1,Me=1,we=1<<U;for(ut=0,ht=1,at=2;ht<=U;++ht,at<<=1){if(fe+=Me<<=1,0>(Me-=pt[ht]))return 0;for(;0<pt[ht];--pt[ht])(W=new dt).g=ht,W.value=tt[ut++],zt(z,Tt+ne,at,we,W),ne=qt(ne,ht)}for(ht=U+1,at=2;15>=ht;++ht,at<<=1){if(fe+=Me<<=1,0>(Me-=pt[ht]))return 0;for(;0<pt[ht];--pt[ht]){if(W=new dt,(ne&se)!=Wt){for(Tt+=we,jt=1<<(Wt=ht)-U;15>Wt&&!(0>=(jt-=pt[Wt]));)++Wt,jt<<=1;bt+=we=1<<(jt=Wt-U),z[V+(Wt=ne&se)].g=jt+U,z[V+Wt].value=Tt-V-Wt}W.g=ht-U,W.value=tt[ut++],zt(z,Tt+(ne>>U),at,we,W),ne=qt(ne,ht)}}return fe!=2*ft[15]-1?0:bt}(g,b,E,I,O,F)}function dt(){this.value=this.g=0}function Lt(){this.value=this.g=0}function wt(){this.G=c(5,dt),this.H=n(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=c(Ds,Lt)}function le(g,b,E,I){t(g!=null),t(b!=null),t(2147483648>I),g.Ca=254,g.I=0,g.b=-8,g.Ka=0,g.oa=b,g.pa=E,g.Jd=b,g.Yc=E+I,g.Zc=4<=I?E+I-4+1:E,Kt(g)}function oe(g,b){for(var E=0;0<b--;)E|=Qt(g,128)<<b;return E}function de(g,b){var E=oe(g,b);return ie(g)?-E:E}function te(g,b,E,I){var O,F=0;for(t(g!=null),t(b!=null),t(4294967288>I),g.Sb=I,g.Ra=0,g.u=0,g.h=0,4<I&&(I=4),O=0;O<I;++O)F+=b[E+O]<<8*O;g.Ra=F,g.bb=I,g.oa=b,g.pa=E}function me(g){for(;8<=g.u&&g.bb<g.Sb;)g.Ra>>>=8,g.Ra+=g.oa[g.pa+g.bb]<<el-8>>>0,++g.bb,g.u-=8;It(g)&&(g.h=1,g.u=0)}function ge(g,b){if(t(0<=b),!g.h&&b<=tl){var E=Et(g)&Sa[b];return g.u+=b,me(g),E}return g.h=1,g.u=0}function ke(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function it(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Et(g){return g.Ra>>>(g.u&el-1)>>>0}function It(g){return t(g.bb<=g.Sb),g.h||g.bb==g.Sb&&g.u>el}function Ut(g,b){g.u=b,g.h=It(g)}function Xt(g){g.u>=Ea&&(t(g.u>=Ea),me(g))}function Kt(g){t(g!=null&&g.oa!=null),g.pa<g.Zc?(g.I=(g.oa[g.pa++]|g.I<<8)>>>0,g.b+=8):(t(g!=null&&g.oa!=null),g.pa<g.Yc?(g.b+=8,g.I=g.oa[g.pa++]|g.I<<8):g.Ka?g.b=0:(g.I<<=8,g.b+=8,g.Ka=1))}function ie(g){return oe(g,1)}function Qt(g,b){var E=g.Ca;0>g.b&&Kt(g);var I=g.b,O=E*b>>>8,F=(g.I>>>I>O)+0;for(F?(E-=O,g.I-=O+1<<I>>>0):E=O+1,I=E,O=0;256<=I;)O+=8,I>>=8;return I=7^O+Js[I],g.b-=I,g.Ca=(E<<I)-1,F}function Ae(g,b,E){g[b+0]=E>>24&255,g[b+1]=E>>16&255,g[b+2]=E>>8&255,g[b+3]=E>>0&255}function Le(g,b){return g[b+0]<<0|g[b+1]<<8}function Fe(g,b){return Le(g,b)|g[b+2]<<16}function Ge(g,b){return Le(g,b)|Le(g,b+2)<<16}function Xe(g,b){var E=1<<b;return t(g!=null),t(0<b),g.X=n(E),g.X==null?0:(g.Mb=32-b,g.Xa=b,1)}function pe(g,b){t(g!=null),t(b!=null),t(g.Xa==b.Xa),r(b.X,0,g.X,0,1<<b.Xa)}function Pt(){this.X=[],this.Xa=this.Mb=0}function Zt(g,b,E,I){t(E!=null),t(I!=null);var O=E[0],F=I[0];return O==0&&(O=(g*F+b/2)/b),F==0&&(F=(b*O+g/2)/g),0>=O||0>=F?0:(E[0]=O,I[0]=F,1)}function ii(g,b){return g+(1<<b)-1>>>b}function Pe(g,b){return((4278255360&g)+(4278255360&b)>>>0&4278255360)+((16711935&g)+(16711935&b)>>>0&16711935)>>>0}function ve(g,b){xt[b]=function(E,I,O,F,z,V,U){var W;for(W=0;W<z;++W){var at=xt[g](V[U+W-1],O,F+W);V[U+W]=Pe(E[I+W],at)}}}function Ee(){this.ud=this.hd=this.jd=0}function Ve(g,b){return((4278124286&(g^b))>>>1)+(g&b)>>>0}function ai(g){return 0<=g&&256>g?g:0>g?0:255<g?255:void 0}function Ai(g,b){return ai(g+(g-b+.5>>1))}function Ti(g,b,E){return Math.abs(b-E)-Math.abs(g-E)}function Pi(g,b,E,I,O,F,z){for(I=F[z-1],E=0;E<O;++E)F[z+E]=I=Pe(g[b+E],I)}function qi(g,b,E,I,O){var F;for(F=0;F<E;++F){var z=g[b+F],V=z>>8&255,U=16711935&(U=(U=16711935&z)+((V<<16)+V));I[O+F]=(4278255360&z)+U>>>0}}function Ji(g,b){b.jd=g>>0&255,b.hd=g>>8&255,b.ud=g>>16&255}function ce(g,b,E,I,O,F){var z;for(z=0;z<I;++z){var V=b[E+z],U=V>>>8,W=V,at=255&(at=(at=V>>>16)+((g.jd<<24>>24)*(U<<24>>24)>>>5));W=255&(W=(W=W+((g.hd<<24>>24)*(U<<24>>24)>>>5))+((g.ud<<24>>24)*(at<<24>>24)>>>5)),O[F+z]=(4278255360&V)+(at<<16)+W}}function Ei(g,b,E,I,O){xt[b]=function(F,z,V,U,W,at,tt,ht,ut){for(U=tt;U<ht;++U)for(tt=0;tt<ut;++tt)W[at++]=O(V[I(F[z++])])},xt[g]=function(F,z,V,U,W,at,tt){var ht=8>>F.b,ut=F.Ea,Tt=F.K[0],bt=F.w;if(8>ht)for(F=(1<<F.b)-1,bt=(1<<ht)-1;z<V;++z){var pt,ft=0;for(pt=0;pt<ut;++pt)pt&F||(ft=I(U[W++])),at[tt++]=O(Tt[ft&bt]),ft>>=ht}else xt["VP8LMapColor"+E](U,W,Tt,bt,at,tt,z,V,ut)}}function Re(g,b,E,I,O){for(E=b+E;b<E;){var F=g[b++];I[O++]=F>>16&255,I[O++]=F>>8&255,I[O++]=F>>0&255}}function jr(g,b,E,I,O){for(E=b+E;b<E;){var F=g[b++];I[O++]=F>>16&255,I[O++]=F>>8&255,I[O++]=F>>0&255,I[O++]=F>>24&255}}function Ci(g,b,E,I,O){for(E=b+E;b<E;){var F=(z=g[b++])>>16&240|z>>12&15,z=z>>0&240|z>>28&15;I[O++]=F,I[O++]=z}}function Te(g,b,E,I,O){for(E=b+E;b<E;){var F=(z=g[b++])>>16&248|z>>13&7,z=z>>5&224|z>>3&31;I[O++]=F,I[O++]=z}}function Ke(g,b,E,I,O){for(E=b+E;b<E;){var F=g[b++];I[O++]=F>>0&255,I[O++]=F>>8&255,I[O++]=F>>16&255}}function Qe(g,b,E,I,O,F){if(F==0)for(E=b+E;b<E;)Ae(I,((F=g[b++])[0]>>24|F[1]>>8&65280|F[2]<<8&16711680|F[3]<<24)>>>0),O+=32;else r(I,O,g,b,E)}function hr(g,b){xt[b][0]=xt[g+"0"],xt[b][1]=xt[g+"1"],xt[b][2]=xt[g+"2"],xt[b][3]=xt[g+"3"],xt[b][4]=xt[g+"4"],xt[b][5]=xt[g+"5"],xt[b][6]=xt[g+"6"],xt[b][7]=xt[g+"7"],xt[b][8]=xt[g+"8"],xt[b][9]=xt[g+"9"],xt[b][10]=xt[g+"10"],xt[b][11]=xt[g+"11"],xt[b][12]=xt[g+"12"],xt[b][13]=xt[g+"13"],xt[b][14]=xt[g+"0"],xt[b][15]=xt[g+"0"]}function Di(g){return g==Cr||g==ol||g==al||g==Sc}function vi(){this.eb=[],this.size=this.A=this.fb=0}function yr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function sr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new vi,this.f.kb=new yr,this.sd=null}function vt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function K(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Y(g){return alert("todo:WebPSamplerProcessPlane"),g.T}function st(g,b){var E=g.T,I=b.ba.f.RGBA,O=I.eb,F=I.fb+g.ka*I.A,z=Qs[b.ba.S],V=g.y,U=g.O,W=g.f,at=g.N,tt=g.ea,ht=g.W,ut=b.cc,Tt=b.dc,bt=b.Mc,pt=b.Nc,ft=g.ka,jt=g.ka+g.T,Wt=g.U,se=Wt+1>>1;for(ft==0?z(V,U,null,null,W,at,tt,ht,W,at,tt,ht,O,F,null,null,Wt):(z(b.ec,b.fc,V,U,ut,Tt,bt,pt,W,at,tt,ht,O,F-I.A,O,F,Wt),++E);ft+2<jt;ft+=2)ut=W,Tt=at,bt=tt,pt=ht,at+=g.Rc,ht+=g.Rc,F+=2*I.A,z(V,(U+=2*g.fa)-g.fa,V,U,ut,Tt,bt,pt,W,at,tt,ht,O,F-I.A,O,F,Wt);return U+=g.fa,g.j+jt<g.o?(r(b.ec,b.fc,V,U,Wt),r(b.cc,b.dc,W,at,se),r(b.Mc,b.Nc,tt,ht,se),E--):1&jt||z(V,U,null,null,W,at,tt,ht,W,at,tt,ht,O,F+I.A,null,null,Wt),E}function _t(g,b,E){var I=g.F,O=[g.J];if(I!=null){var F=g.U,z=b.ba.S,V=z==Ac||z==al;b=b.ba.f.RGBA;var U=[0],W=g.ka;U[0]=g.T,g.Kb&&(W==0?--U[0]:(--W,O[0]-=g.width),g.j+g.ka+g.T==g.o&&(U[0]=g.o-g.j-W));var at=b.eb;W=b.fb+W*b.A,g=$o(I,O[0],g.width,F,U,at,W+(V?0:3),b.A),t(E==U),g&&Di(z)&&Bo(at,W,V,F,U,b.A)}return 0}function kt(g){var b=g.ma,E=b.ba.S,I=11>E,O=E==sl||E==nl||E==Ac||E==$h||E==12||Di(E);if(b.memory=null,b.Ib=null,b.Jb=null,b.Nd=null,!Aa(b.Oa,g,O?11:12))return 0;if(O&&Di(E)&&Ie(),g.da)alert("todo:use_scaling");else{if(I){if(b.Ib=Y,g.Kb){if(E=g.U+1>>1,b.memory=n(g.U+2*E),b.memory==null)return 0;b.ec=b.memory,b.fc=0,b.cc=b.ec,b.dc=b.fc+g.U,b.Mc=b.cc,b.Nc=b.dc+E,b.Ib=st,Ie()}}else alert("todo:EmitYUV");O&&(b.Jb=_t,I&&Yt())}if(I&&!ch){for(g=0;256>g;++g)ru[g]=89858*(g-128)+Yo>>cl,w[g]=-22014*(g-128)+Yo,Gu[g]=-45773*(g-128),hh[g]=113618*(g-128)+Yo>>cl;for(g=fo;g<Jl;++g)b=76283*(g-16)+Yo>>cl,a[g-fo]=ln(b,255),d[g-fo]=ln(b+8>>4,15);ch=1}return 1}function Ft(g){var b=g.ma,E=g.U,I=g.T;return t(!(1&g.ka)),0>=E||0>=I?0:(E=b.Ib(g,b),b.Jb!=null&&b.Jb(g,b,E),b.Dc+=E,1)}function Vt(g){g.ma.memory=null}function At(g,b,E,I){return ge(g,8)!=47?0:(b[0]=ge(g,14)+1,E[0]=ge(g,14)+1,I[0]=ge(g,1),ge(g,3)!=0?0:!g.h)}function Jt(g,b){if(4>g)return g+1;var E=g-2>>1;return(2+(1&g)<<E)+ge(b,E)+1}function ye(g,b){return 120<b?b-120:1<=(E=((E=ni[b-1])>>4)*g+(8-(15&E)))?E:1;var E}function he(g,b,E){var I=Et(E),O=g[b+=255&I].g-8;return 0<O&&(Ut(E,E.u+8),I=Et(E),b+=g[b].value,b+=I&(1<<O)-1),Ut(E,E.u+g[b].g),g[b].value}function ae(g,b,E){return E.g+=g.g,E.value+=g.value<<b>>>0,t(8>=E.g),g.g}function qe(g,b,E){var I=g.xc;return t((b=I==0?0:g.vc[g.md*(E>>I)+(b>>I)])<g.Wb),g.Ya[b]}function Je(g,b,E,I){var O=g.ab,F=g.c*b,z=g.C;b=z+b;var V=E,U=I;for(I=g.Ta,E=g.Ua;0<O--;){var W=g.gc[O],at=z,tt=b,ht=V,ut=U,Tt=(U=I,V=E,W.Ea);switch(t(at<tt),t(tt<=W.nc),W.hc){case 2:Lr(ht,ut,(tt-at)*Tt,U,V);break;case 0:var bt=at,pt=tt,ft=U,jt=V,Wt=(we=W).Ea;bt==0&&(Xh(ht,ut,null,null,1,ft,jt),Pi(ht,ut+1,0,0,Wt-1,ft,jt+1),ut+=Wt,jt+=Wt,++bt);for(var se=1<<we.b,ne=se-1,fe=ii(Wt,we.b),Me=we.K,we=we.w+(bt>>we.b)*fe;bt<pt;){var je=Me,$e=we,Ze=1;for(Gl(ht,ut,ft,jt-Wt,1,ft,jt);Ze<Wt;){var yi=(Ze&~ne)+se;yi>Wt&&(yi=Wt),(0,Jo[je[$e++]>>8&15])(ht,ut+ +Ze,ft,jt+Ze-Wt,yi-Ze,ft,jt+Ze),Ze=yi}ut+=Wt,jt+=Wt,++bt&ne||(we+=fe)}tt!=W.nc&&r(U,V-Tt,U,V+(tt-at-1)*Tt,Tt);break;case 1:for(Tt=ht,pt=ut,Wt=(ht=W.Ea)-(jt=ht&~(ft=(ut=1<<W.b)-1)),bt=ii(ht,W.b),se=W.K,W=W.w+(at>>W.b)*bt;at<tt;){for(ne=se,fe=W,Me=new Ee,we=pt+jt,je=pt+ht;pt<we;)Ji(ne[fe++],Me),ys(Me,Tt,pt,ut,U,V),pt+=ut,V+=ut;pt<je&&(Ji(ne[fe++],Me),ys(Me,Tt,pt,Wt,U,V),pt+=Wt,V+=Wt),++at&ft||(W+=bt)}break;case 3:if(ht==U&&ut==V&&0<W.b){for(pt=U,ht=Tt=V+(tt-at)*Tt-(jt=(tt-at)*ii(W.Ea,W.b)),ut=U,ft=V,bt=[],jt=(Wt=jt)-1;0<=jt;--jt)bt[jt]=ut[ft+jt];for(jt=Wt-1;0<=jt;--jt)pt[ht+jt]=bt[jt];As(W,at,tt,U,Tt,U,V)}else As(W,at,tt,ht,ut,U,V)}V=I,U=E}U!=E&&r(I,E,V,U,F)}function bi(g,b){var E=g.V,I=g.Ba+g.c*g.C,O=b-g.C;if(t(b<=g.l.o),t(16>=O),0<O){var F=g.l,z=g.Ta,V=g.Ua,U=F.width;if(Je(g,O,E,I),O=V=[V],t((E=g.C)<(I=b)),t(F.v<F.va),I>F.o&&(I=F.o),E<F.j){var W=F.j-E;E=F.j,O[0]+=W*U}if(E>=I?E=0:(O[0]+=4*F.v,F.ka=E-F.j,F.U=F.va-F.v,F.T=I-E,E=1),E){if(V=V[0],11>(E=g.ca).S){var at=E.f.RGBA,tt=(I=E.S,O=F.U,F=F.T,W=at.eb,at.A),ht=F;for(at=at.fb+g.Ma*at.A;0<ht--;){var ut=z,Tt=V,bt=O,pt=W,ft=at;switch(I){case xc:Ss(ut,Tt,bt,pt,ft);break;case sl:An(ut,Tt,bt,pt,ft);break;case Cr:An(ut,Tt,bt,pt,ft),Bo(pt,ft,0,bt,1,0);break;case oh:Ca(ut,Tt,bt,pt,ft);break;case nl:Qe(ut,Tt,bt,pt,ft,1);break;case ol:Qe(ut,Tt,bt,pt,ft,1),Bo(pt,ft,0,bt,1,0);break;case Ac:Qe(ut,Tt,bt,pt,ft,0);break;case al:Qe(ut,Tt,bt,pt,ft,0),Bo(pt,ft,1,bt,1,0);break;case $h:kn(ut,Tt,bt,pt,ft);break;case Sc:kn(ut,Tt,bt,pt,ft),ql(pt,ft,bt,1,0);break;case Ko:On(ut,Tt,bt,pt,ft);break;default:t(0)}V+=U,at+=tt}g.Ma+=F}else alert("todo:EmitRescaledRowsYUVA");t(g.Ma<=E.height)}}g.C=b,t(g.C<=g.i)}function si(g){var b;if(0<g.ua)return 0;for(b=0;b<g.Wb;++b){var E=g.Ya[b].G,I=g.Ya[b].H;if(0<E[1][I[1]+0].g||0<E[2][I[2]+0].g||0<E[3][I[3]+0].g)return 0}return 1}function Si(g,b,E,I,O,F){if(g.Z!=0){var z=g.qd,V=g.rd;for(t(Fn[g.Z]!=null);b<E;++b)Fn[g.Z](z,V,I,O,I,O,F),z=I,V=O,O+=F;g.qd=z,g.rd=V}}function Ni(g,b){var E=g.l.ma,I=E.Z==0||E.Z==1?g.l.j:g.C;if(I=g.C<I?I:g.C,t(b<=g.l.o),b>I){var O=g.l.width,F=E.ca,z=E.tb+O*I,V=g.V,U=g.Ba+g.c*I,W=g.gc;t(g.ab==1),t(W[0].hc==3),bc(W[0],I,b,V,U,F,z),Si(E,I,b,F,z,O)}g.C=g.Ma=b}function Hi(g,b,E,I,O,F,z){var V=g.$/I,U=g.$%I,W=g.m,at=g.s,tt=E+g.$,ht=tt;O=E+I*O;var ut=E+I*F,Tt=280+at.ua,bt=g.Pb?V:16777216,pt=0<at.ua?at.Wa:null,ft=at.wc,jt=tt<ut?qe(at,U,V):null;t(g.C<F),t(ut<=O);var Wt=!1;t:for(;;){for(;Wt||tt<ut;){var se=0;if(V>=bt){var ne=tt-E;t((bt=g).Pb),bt.wd=bt.m,bt.xd=ne,0<bt.s.ua&&pe(bt.s.Wa,bt.s.vb),bt=V+ah}if(U&ft||(jt=qe(at,U,V)),t(jt!=null),jt.Qb&&(b[tt]=jt.qb,Wt=!0),!Wt)if(Xt(W),jt.jc){se=W,ne=b;var fe=tt,Me=jt.pd[Et(se)&Ds-1];t(jt.jc),256>Me.g?(Ut(se,se.u+Me.g),ne[fe]=Me.value,se=0):(Ut(se,se.u+Me.g-256),t(256<=Me.value),se=Me.value),se==0&&(Wt=!0)}else se=he(jt.G[0],jt.H[0],W);if(W.h)break;if(Wt||256>se){if(!Wt)if(jt.nd)b[tt]=(jt.qb|se<<8)>>>0;else{if(Xt(W),Wt=he(jt.G[1],jt.H[1],W),Xt(W),ne=he(jt.G[2],jt.H[2],W),fe=he(jt.G[3],jt.H[3],W),W.h)break;b[tt]=(fe<<24|Wt<<16|se<<8|ne)>>>0}if(Wt=!1,++tt,++U>=I&&(U=0,++V,z!=null&&V<=F&&!(V%16)&&z(g,V),pt!=null))for(;ht<tt;)se=b[ht++],pt.X[(506832829*se&4294967295)>>>pt.Mb]=se}else if(280>se){if(se=Jt(se-256,W),ne=he(jt.G[4],jt.H[4],W),Xt(W),ne=ye(I,ne=Jt(ne,W)),W.h)break;if(tt-E<ne||O-tt<se)break t;for(fe=0;fe<se;++fe)b[tt+fe]=b[tt+fe-ne];for(tt+=se,U+=se;U>=I;)U-=I,++V,z!=null&&V<=F&&!(V%16)&&z(g,V);if(t(tt<=O),U&ft&&(jt=qe(at,U,V)),pt!=null)for(;ht<tt;)se=b[ht++],pt.X[(506832829*se&4294967295)>>>pt.Mb]=se}else{if(!(se<Tt))break t;for(Wt=se-280,t(pt!=null);ht<tt;)se=b[ht++],pt.X[(506832829*se&4294967295)>>>pt.Mb]=se;se=tt,t(!(Wt>>>(ne=pt).Xa)),b[se]=ne.X[Wt],Wt=!0}Wt||t(W.h==It(W))}if(g.Pb&&W.h&&tt<O)t(g.m.h),g.a=5,g.m=g.wd,g.$=g.xd,0<g.s.ua&&pe(g.s.vb,g.s.Wa);else{if(W.h)break t;z!=null&&z(g,V>F?F:V),g.a=0,g.$=tt-E}return 1}return g.a=3,0}function nr(g){t(g!=null),g.vc=null,g.yc=null,g.Ya=null;var b=g.Wa;b!=null&&(b.X=null),g.vb=null,t(g!=null)}function li(){var g=new vc;return g==null?null:(g.a=0,g.xb=lh,hr("Predictor","VP8LPredictors"),hr("Predictor","VP8LPredictors_C"),hr("PredictorAdd","VP8LPredictorsAdd"),hr("PredictorAdd","VP8LPredictorsAdd_C"),Lr=qi,ys=ce,Ss=Re,An=jr,kn=Ci,On=Te,Ca=Ke,xt.VP8LMapColor32b=ms,xt.VP8LMapColor8b=Vl,g)}function ji(g,b,E,I,O){var F=1,z=[g],V=[b],U=I.m,W=I.s,at=null,tt=0;t:for(;;){if(E)for(;F&&ge(U,1);){var ht=z,ut=V,Tt=I,bt=1,pt=Tt.m,ft=Tt.gc[Tt.ab],jt=ge(pt,2);if(Tt.Oc&1<<jt)F=0;else{switch(Tt.Oc|=1<<jt,ft.hc=jt,ft.Ea=ht[0],ft.nc=ut[0],ft.K=[null],++Tt.ab,t(4>=Tt.ab),jt){case 0:case 1:ft.b=ge(pt,3)+2,bt=ji(ii(ft.Ea,ft.b),ii(ft.nc,ft.b),0,Tt,ft.K),ft.K=ft.K[0];break;case 3:var Wt,se=ge(pt,8)+1,ne=16<se?0:4<se?1:2<se?2:3;if(ht[0]=ii(ft.Ea,ne),ft.b=ne,Wt=bt=ji(se,1,0,Tt,ft.K)){var fe,Me=se,we=ft,je=1<<(8>>we.b),$e=n(je);if($e==null)Wt=0;else{var Ze=we.K[0],yi=we.w;for($e[0]=we.K[0][0],fe=1;fe<1*Me;++fe)$e[fe]=Pe(Ze[yi+fe],$e[fe-1]);for(;fe<4*je;++fe)$e[fe]=0;we.K[0]=null,we.K[0]=$e,Wt=1}}bt=Wt;break;case 2:break;default:t(0)}F=bt}}if(z=z[0],V=V[0],F&&ge(U,1)&&!(F=1<=(tt=ge(U,4))&&11>=tt)){I.a=3;break t}var _i;if(_i=F)e:{var Ui,pi,zi,or=I,ar=z,$r=V,Yi=tt,Ns=E,us=or.m,Tr=or.s,Qi=[null],Wi=1,tr=0,as=di[Yi];i:for(;;){if(Ns&&ge(us,1)){var $i=ge(us,3)+2,lr=ii(ar,$i),Ts=ii($r,$i),Nr=lr*Ts;if(!ji(lr,Ts,0,or,Qi))break i;for(Qi=Qi[0],Tr.xc=$i,Ui=0;Ui<Nr;++Ui){var br=Qi[Ui]>>8&65535;Qi[Ui]=br,br>=Wi&&(Wi=br+1)}}if(us.h)break i;for(pi=0;5>pi;++pi){var qr=Kh[pi];!pi&&0<Yi&&(qr+=1<<Yi),tr<qr&&(tr=qr)}var uh=c(Wi*as,dt),Pa=Wi,Ia=c(Pa,wt);if(Ia==null)var ul=null;else t(65536>=Pa),ul=Ia;var zn=n(tr);if(ul==null||zn==null||uh==null){or.a=1;break i}var Zl=uh;for(Ui=zi=0;Ui<Wi;++Ui){var jn=ul[Ui],Ma=jn.G,La=jn.H,Bc=0,Xl=1,Vu=0;for(pi=0;5>pi;++pi){qr=Kh[pi],Ma[pi]=Zl,La[pi]=zi,!pi&&0<Yi&&(qr+=1<<Yi);s:{var su,qu=qr,dl=or,nu=zn,ou=Zl,Hu=zi,dh=0,pl=dl.m,Tf=ge(pl,1);if(s(nu,0,0,qu),Tf){var qm=ge(pl,1)+1,un=ge(pl,1),Rc=ge(pl,un==0?1:8);nu[Rc]=1,qm==2&&(nu[Rc=ge(pl,8)]=1);var ph=1}else{var Qd=n(19),fh=ge(pl,4)+4;if(19<fh){dl.a=3;var Wu=0;break s}for(su=0;su<fh;++su)Qd[Ec[su]]=ge(pl,3);var gh=void 0,au=void 0,tp=dl,Pf=Qd,lu=qu,If=nu,cu=0,fl=tp.m,Ju=8,mh=c(128,dt);r:for(;ot(mh,0,7,Pf,19);){if(ge(fl,1)){var go=2+2*ge(fl,3);if((gh=2+ge(fl,go))>lu)break r}else gh=lu;for(au=0;au<lu&&gh--;){Xt(fl);var ep=mh[0+(127&Et(fl))];Ut(fl,fl.u+ep.g);var yh=ep.value;if(16>yh)If[au++]=yh,yh!=0&&(Ju=yh);else{var Mf=yh==16,Lf=yh-16,Hm=ju[Lf],Bf=ge(fl,zu[Lf])+Hm;if(au+Bf>lu)break r;for(var Wm=Mf?Ju:0;0<Bf--;)If[au++]=Wm}}cu=1;break r}cu||(tp.a=3),ph=cu}(ph=ph&&!pl.h)&&(dh=ot(ou,Hu,8,nu,qu)),ph&&dh!=0?Wu=dh:(dl.a=3,Wu=0)}if(Wu==0)break i;if(Xl&&ho[pi]==1&&(Xl=Zl[zi].g==0),Bc+=Zl[zi].g,zi+=Wu,3>=pi){var kc,_h=zn[0];for(kc=1;kc<qr;++kc)zn[kc]>_h&&(_h=zn[kc]);Vu+=_h}}if(jn.nd=Xl,jn.Qb=0,Xl&&(jn.qb=(Ma[3][La[3]+0].value<<24|Ma[1][La[1]+0].value<<16|Ma[2][La[2]+0].value)>>>0,Bc==0&&256>Ma[0][La[0]+0].value&&(jn.Qb=1,jn.qb+=Ma[0][La[0]+0].value<<8)),jn.jc=!jn.Qb&&6>Vu,jn.jc){var hu,Cn=jn;for(hu=0;hu<Ds;++hu){var ko=hu,$l=Cn.pd[ko],Zu=Cn.G[0][Cn.H[0]+ko];256<=Zu.value?($l.g=Zu.g+256,$l.value=Zu.value):($l.g=0,$l.value=0,ko>>=ae(Zu,8,$l),ko>>=ae(Cn.G[1][Cn.H[1]+ko],16,$l),ko>>=ae(Cn.G[2][Cn.H[2]+ko],0,$l),ae(Cn.G[3][Cn.H[3]+ko],24,$l))}}}Tr.vc=Qi,Tr.Wb=Wi,Tr.Ya=ul,Tr.yc=uh,_i=1;break e}_i=0}if(!(F=_i)){I.a=3;break t}if(0<tt){if(W.ua=1<<tt,!Xe(W.Wa,tt)){I.a=1,F=0;break t}}else W.ua=0;var ip=I,Rf=z,Jm=V,rp=ip.s,sp=rp.xc;if(ip.c=Rf,ip.i=Jm,rp.md=ii(Rf,sp),rp.wc=sp==0?-1:(1<<sp)-1,E){I.xb=tu;break t}if((at=n(z*V))==null){I.a=1,F=0;break t}F=(F=Hi(I,at,0,z,V,V,null))&&!U.h;break t}return F?(O!=null?O[0]=at:(t(at==null),t(E)),I.$=0,E||nr(W)):nr(W),F}function ur(g,b){var E=g.c*g.i,I=E+b+16*b;return t(g.c<=b),g.V=n(I),g.V==null?(g.Ta=null,g.Ua=0,g.a=1,0):(g.Ta=g.V,g.Ua=g.Ba+E+b,1)}function Mr(g,b){var E=g.C,I=b-E,O=g.V,F=g.Ba+g.c*E;for(t(b<=g.l.o);0<I;){var z=16<I?16:I,V=g.l.ma,U=g.l.width,W=U*z,at=V.ca,tt=V.tb+U*E,ht=g.Ta,ut=g.Ua;Je(g,z,O,F),Hl(ht,ut,at,tt,W),Si(V,E,E+z,at,tt,U),I-=z,O+=z*g.c,E+=z}t(E==b),g.C=g.Ma=b}function Ur(){this.ub=this.yd=this.td=this.Rb=0}function Er(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function ks(){this.Fb=this.Bb=this.Cb=0,this.Zb=n(4),this.Lb=n(4)}function qa(){this.Yb=function(){var g=[];return function b(E,I,O){for(var F=O[I],z=0;z<F&&(E.push(O.length>I+1?[]:0),!(O.length<I+1));z++)b(E[z],I+1,O)}(g,0,[3,11]),g}()}function da(){this.jb=n(3),this.Wc=l([4,8],qa),this.Xc=l([4,17],qa)}function Bi(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new n(4),this.od=new n(4)}function $s(){this.ld=this.La=this.dd=this.tc=0}function Ks(){this.Na=this.la=0}function Rr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Gr(){this.ad=n(384),this.Za=0,this.Ob=n(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function xs(){this.uc=this.M=this.Nb=0,this.wa=Array(new $s),this.Y=0,this.ya=Array(new Gr),this.aa=0,this.l=new nn}function kr(){this.y=n(16),this.f=n(8),this.ea=n(8)}function Os(){this.cb=this.a=0,this.sc="",this.m=new ke,this.Od=new Ur,this.Kc=new Er,this.ed=new Bi,this.Qa=new ks,this.Ic=this.$c=this.Aa=0,this.D=new xs,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=c(8,ke),this.ia=0,this.pb=c(4,Rr),this.Pa=new da,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new kr),this.Hd=0,this.rb=Array(new Ks),this.sb=0,this.wa=Array(new $s),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Gr),this.L=this.aa=0,this.gd=l([4,2],$s),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function nn(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function to(){var g=new Os;return g!=null&&(g.a=0,g.sc="OK",g.cb=0,g.Xb=0,Cs||(Cs=dr)),g}function xi(g,b,E){return g.a==0&&(g.a=b,g.sc=E,g.cb=0),0}function wn(g,b,E){return 3<=E&&g[b+0]==157&&g[b+1]==1&&g[b+2]==42}function Ys(g,b){if(g==null)return 0;if(g.a=0,g.sc="OK",b==null)return xi(g,2,"null VP8Io passed to VP8GetHeaders()");var E=b.data,I=b.w,O=b.ha;if(4>O)return xi(g,7,"Truncated header.");var F=E[I+0]|E[I+1]<<8|E[I+2]<<16,z=g.Od;if(z.Rb=!(1&F),z.td=F>>1&7,z.yd=F>>4&1,z.ub=F>>5,3<z.td)return xi(g,3,"Incorrect keyframe parameters.");if(!z.yd)return xi(g,4,"Frame not displayable.");I+=3,O-=3;var V=g.Kc;if(z.Rb){if(7>O)return xi(g,7,"cannot parse picture header");if(!wn(E,I,O))return xi(g,3,"Bad code word");V.c=16383&(E[I+4]<<8|E[I+3]),V.Td=E[I+4]>>6,V.i=16383&(E[I+6]<<8|E[I+5]),V.Ud=E[I+6]>>6,I+=7,O-=7,g.za=V.c+15>>4,g.Ub=V.i+15>>4,b.width=V.c,b.height=V.i,b.Da=0,b.j=0,b.v=0,b.va=b.width,b.o=b.height,b.da=0,b.ib=b.width,b.hb=b.height,b.U=b.width,b.T=b.height,s((F=g.Pa).jb,0,255,F.jb.length),t((F=g.Qa)!=null),F.Cb=0,F.Bb=0,F.Fb=1,s(F.Zb,0,0,F.Zb.length),s(F.Lb,0,0,F.Lb)}if(z.ub>O)return xi(g,7,"bad partition length");le(F=g.m,E,I,z.ub),I+=z.ub,O-=z.ub,z.Rb&&(V.Ld=ie(F),V.Kd=ie(F)),V=g.Qa;var U,W=g.Pa;if(t(F!=null),t(V!=null),V.Cb=ie(F),V.Cb){if(V.Bb=ie(F),ie(F)){for(V.Fb=ie(F),U=0;4>U;++U)V.Zb[U]=ie(F)?de(F,7):0;for(U=0;4>U;++U)V.Lb[U]=ie(F)?de(F,6):0}if(V.Bb)for(U=0;3>U;++U)W.jb[U]=ie(F)?oe(F,8):255}else V.Bb=0;if(F.Ka)return xi(g,3,"cannot parse segment header");if((V=g.ed).zd=ie(F),V.Tb=oe(F,6),V.wb=oe(F,3),V.Pc=ie(F),V.Pc&&ie(F)){for(W=0;4>W;++W)ie(F)&&(V.vd[W]=de(F,6));for(W=0;4>W;++W)ie(F)&&(V.od[W]=de(F,6))}if(g.L=V.Tb==0?0:V.zd?1:2,F.Ka)return xi(g,3,"cannot parse filter header");var at=O;if(O=U=I,I=U+at,V=at,g.Xb=(1<<oe(g.m,2))-1,at<3*(W=g.Xb))E=7;else{for(U+=3*W,V-=3*W,at=0;at<W;++at){var tt=E[O+0]|E[O+1]<<8|E[O+2]<<16;tt>V&&(tt=V),le(g.Jc[+at],E,U,tt),U+=tt,V-=tt,O+=3}le(g.Jc[+W],E,U,V),E=U<I?0:5}if(E!=0)return xi(g,E,"cannot parse partitions");for(E=oe(U=g.m,7),O=ie(U)?de(U,4):0,I=ie(U)?de(U,4):0,V=ie(U)?de(U,4):0,W=ie(U)?de(U,4):0,U=ie(U)?de(U,4):0,at=g.Qa,tt=0;4>tt;++tt){if(at.Cb){var ht=at.Zb[tt];at.Fb||(ht+=E)}else{if(0<tt){g.pb[tt]=g.pb[0];continue}ht=E}var ut=g.pb[tt];ut.Sc[0]=ll[ln(ht+O,127)],ut.Sc[1]=Cc[ln(ht+0,127)],ut.Eb[0]=2*ll[ln(ht+I,127)],ut.Eb[1]=101581*Cc[ln(ht+V,127)]>>16,8>ut.Eb[1]&&(ut.Eb[1]=8),ut.Qc[0]=ll[ln(ht+W,117)],ut.Qc[1]=Cc[ln(ht+U,127)],ut.lc=ht+U}if(!z.Rb)return xi(g,4,"Not a key frame.");for(ie(F),z=g.Pa,E=0;4>E;++E){for(O=0;8>O;++O)for(I=0;3>I;++I)for(V=0;11>V;++V)W=Qt(F,os[E][O][I][V])?oe(F,8):Tc[E][O][I][V],z.Wc[E][O].Yb[I][V]=W;for(O=0;17>O;++O)z.Xc[E][O]=z.Wc[E][Uu[O]]}return g.kc=ie(F),g.kc&&(g.Bd=oe(F,8)),g.cb=1}function dr(g,b,E,I,O,F,z){var V=b[O].Yb[E];for(E=0;16>O;++O){if(!Qt(g,V[E+0]))return O;for(;!Qt(g,V[E+1]);)if(V=b[++O].Yb[0],E=0,O==16)return 16;var U=b[O+1].Yb;if(Qt(g,V[E+2])){var W=g,at=0;if(Qt(W,(ht=V)[(tt=E)+3]))if(Qt(W,ht[tt+6])){for(V=0,tt=2*(at=Qt(W,ht[tt+8]))+(ht=Qt(W,ht[tt+9+at])),at=0,ht=Yh[tt];ht[V];++V)at+=at+Qt(W,ht[V]);at+=3+(8<<tt)}else Qt(W,ht[tt+7])?(at=7+2*Qt(W,165),at+=Qt(W,145)):at=5+Qt(W,159);else at=Qt(W,ht[tt+4])?3+Qt(W,ht[tt+5]):2;V=U[2]}else at=1,V=U[1];U=z+uo[O],0>(W=g).b&&Kt(W);var tt,ht=W.b,ut=(tt=W.Ca>>1)-(W.I>>ht)>>31;--W.b,W.Ca+=ut,W.Ca|=1,W.I-=(tt+1&ut)<<ht,F[U]=((at^ut)-ut)*I[(0<O)+0]}return 16}function Rn(g){var b=g.rb[g.sb-1];b.la=0,b.Na=0,s(g.zc,0,0,g.zc.length),g.ja=0}function ds(g,b){if(g==null)return 0;if(b==null)return xi(g,2,"NULL VP8Io parameter in VP8Decode().");if(!g.cb&&!Ys(g,b))return 0;if(t(g.cb),b.ac==null||b.ac(b)){b.ob&&(g.L=0);var E=_[g.L];if(g.L==2?(g.yb=0,g.zb=0):(g.yb=b.v-E>>4,g.zb=b.j-E>>4,0>g.yb&&(g.yb=0),0>g.zb&&(g.zb=0)),g.Va=b.o+15+E>>4,g.Hb=b.va+15+E>>4,g.Hb>g.za&&(g.Hb=g.za),g.Va>g.Ub&&(g.Va=g.Ub),0<g.L){var I=g.ed;for(E=0;4>E;++E){var O;if(g.Qa.Cb){var F=g.Qa.Lb[E];g.Qa.Fb||(F+=I.Tb)}else F=I.Tb;for(O=0;1>=O;++O){var z=g.gd[E][O],V=F;if(I.Pc&&(V+=I.vd[0],O&&(V+=I.od[0])),0<(V=0>V?0:63<V?63:V)){var U=V;0<I.wb&&(U=4<I.wb?U>>2:U>>1)>9-I.wb&&(U=9-I.wb),1>U&&(U=1),z.dd=U,z.tc=2*V+U,z.ld=40<=V?2:15<=V?1:0}else z.tc=0;z.La=O}}}E=0}else xi(g,6,"Frame setup failed"),E=g.a;if(E=E==0){if(E){g.$c=0,0<g.Aa||(g.Ic=B);t:{E=g.Ic,I=4*(U=g.za);var W=32*U,at=U+1,tt=0<g.L?U*(0<g.Aa?2:1):0,ht=(g.Aa==2?2:1)*U;if((z=I+832+(O=3*(16*E+_[g.L])/2*W)+(F=g.Fa!=null&&0<g.Fa.length?g.Kc.c*g.Kc.i:0))!=z)E=0;else{if(z>g.Vb){if(g.Vb=0,g.Ec=n(z),g.Fc=0,g.Ec==null){E=xi(g,1,"no memory during frame initialization.");break t}g.Vb=z}z=g.Ec,V=g.Fc,g.Ac=z,g.Bc=V,V+=I,g.Gd=c(W,kr),g.Hd=0,g.rb=c(at+1,Ks),g.sb=1,g.wa=tt?c(tt,$s):null,g.Y=0,g.D.Nb=0,g.D.wa=g.wa,g.D.Y=g.Y,0<g.Aa&&(g.D.Y+=U),t(!0),g.oc=z,g.pc=V,V+=832,g.ya=c(ht,Gr),g.aa=0,g.D.ya=g.ya,g.D.aa=g.aa,g.Aa==2&&(g.D.aa+=U),g.R=16*U,g.B=8*U,U=(W=_[g.L])*g.R,W=W/2*g.B,g.sa=z,g.ta=V+U,g.qa=g.sa,g.ra=g.ta+16*E*g.R+W,g.Ha=g.qa,g.Ia=g.ra+8*E*g.B+W,g.$c=0,V+=O,g.mb=F?z:null,g.nb=F?V:null,t(V+F<=g.Fc+g.Vb),Rn(g),s(g.Ac,g.Bc,0,I),E=1}}if(E){if(b.ka=0,b.y=g.sa,b.O=g.ta,b.f=g.qa,b.N=g.ra,b.ea=g.Ha,b.Vd=g.Ia,b.fa=g.R,b.Rc=g.B,b.F=null,b.J=0,!rl){for(E=-255;255>=E;++E)co[255+E]=0>E?-E:E;for(E=-1020;1020>=E;++E)We[1020+E]=-128>E?-128:127<E?127:E;for(E=-112;112>=E;++E)wc[112+E]=-16>E?-16:15<E?15:E;for(E=-255;510>=E;++E)il[255+E]=0>E?0:255<E?255:E;rl=1}Sn=mt,Io=io,Zo=xn,Dn=pa,Mo=rt,ao=eo,Ta=Dl,Lo=ya,lo=Zh,ns=yc,cn=_a,hn=Nl,_s=_c,er=sh,fr=Ol,gr=ro,Dr=so,Xo=mc,vs[0]=ts,vs[1]=ue,vs[2]=Vo,vs[3]=kl,vs[4]=fa,vs[5]=So,vs[6]=Wa,vs[7]=qo,vs[8]=Za,vs[9]=Ja,Nn[0]=rs,Nn[1]=gi,Nn[2]=Mi,Nn[3]=pr,Nn[4]=Ar,Nn[5]=rh,Nn[6]=Ha,po[0]=ma,po[1]=Se,po[2]=Jh,po[3]=gc,po[4]=Eo,po[5]=Ho,po[6]=gs,E=1}else E=0}E&&(E=function(ut,Tt){for(ut.M=0;ut.M<ut.Va;++ut.M){var bt,pt=ut.Jc[ut.M&ut.Xb],ft=ut.m,jt=ut;for(bt=0;bt<jt.za;++bt){var Wt=ft,se=jt,ne=se.Ac,fe=se.Bc+4*bt,Me=se.zc,we=se.ya[se.aa+bt];if(se.Qa.Bb?we.$b=Qt(Wt,se.Pa.jb[0])?2+Qt(Wt,se.Pa.jb[2]):Qt(Wt,se.Pa.jb[1]):we.$b=0,se.kc&&(we.Ad=Qt(Wt,se.Bd)),we.Za=!Qt(Wt,145)+0,we.Za){var je=we.Ob,$e=0;for(se=0;4>se;++se){var Ze,yi=Me[0+se];for(Ze=0;4>Ze;++Ze){yi=Xr[ne[fe+Ze]][yi];for(var _i=Qh[Qt(Wt,yi[0])];0<_i;)_i=Qh[2*_i+Qt(Wt,yi[_i])];yi=-_i,ne[fe+Ze]=yi}r(je,$e,ne,fe,4),$e+=4,Me[0+se]=yi}}else yi=Qt(Wt,156)?Qt(Wt,128)?1:3:Qt(Wt,163)?2:0,we.Ob[0]=yi,s(ne,fe,yi,4),s(Me,0,yi,4);we.Dd=Qt(Wt,142)?Qt(Wt,114)?Qt(Wt,183)?1:3:2:0}if(jt.m.Ka)return xi(ut,7,"Premature end-of-partition0 encountered.");for(;ut.ja<ut.za;++ut.ja){if(jt=pt,Wt=(ft=ut).rb[ft.sb-1],ne=ft.rb[ft.sb+ft.ja],bt=ft.ya[ft.aa+ft.ja],fe=ft.kc?bt.Ad:0)Wt.la=ne.la=0,bt.Za||(Wt.Na=ne.Na=0),bt.Hc=0,bt.Gc=0,bt.ia=0;else{var Ui,pi;if(Wt=ne,ne=jt,fe=ft.Pa.Xc,Me=ft.ya[ft.aa+ft.ja],we=ft.pb[Me.$b],se=Me.ad,je=0,$e=ft.rb[ft.sb-1],yi=Ze=0,s(se,je,0,384),Me.Za)var zi=0,or=fe[3];else{_i=n(16);var ar=Wt.Na+$e.Na;if(ar=Cs(ne,fe[1],ar,we.Eb,0,_i,0),Wt.Na=$e.Na=(0<ar)+0,1<ar)Sn(_i,0,se,je);else{var $r=_i[0]+3>>3;for(_i=0;256>_i;_i+=16)se[je+_i]=$r}zi=1,or=fe[0]}var Yi=15&Wt.la,Ns=15&$e.la;for(_i=0;4>_i;++_i){var us=1&Ns;for($r=pi=0;4>$r;++$r)Yi=Yi>>1|(us=(ar=Cs(ne,or,ar=us+(1&Yi),we.Sc,zi,se,je))>zi)<<7,pi=pi<<2|(3<ar?3:1<ar?2:se[je+0]!=0),je+=16;Yi>>=4,Ns=Ns>>1|us<<7,Ze=(Ze<<8|pi)>>>0}for(or=Yi,zi=Ns>>4,Ui=0;4>Ui;Ui+=2){for(pi=0,Yi=Wt.la>>4+Ui,Ns=$e.la>>4+Ui,_i=0;2>_i;++_i){for(us=1&Ns,$r=0;2>$r;++$r)ar=us+(1&Yi),Yi=Yi>>1|(us=0<(ar=Cs(ne,fe[2],ar,we.Qc,0,se,je)))<<3,pi=pi<<2|(3<ar?3:1<ar?2:se[je+0]!=0),je+=16;Yi>>=2,Ns=Ns>>1|us<<5}yi|=pi<<4*Ui,or|=Yi<<4<<Ui,zi|=(240&Ns)<<Ui}Wt.la=or,$e.la=zi,Me.Hc=Ze,Me.Gc=yi,Me.ia=43690&yi?0:we.ia,fe=!(Ze|yi)}if(0<ft.L&&(ft.wa[ft.Y+ft.ja]=ft.gd[bt.$b][bt.Za],ft.wa[ft.Y+ft.ja].La|=!fe),jt.Ka)return xi(ut,7,"Premature end-of-file encountered.")}if(Rn(ut),ft=Tt,jt=1,bt=(pt=ut).D,Wt=0<pt.L&&pt.M>=pt.zb&&pt.M<=pt.Va,pt.Aa==0)t:{if(bt.M=pt.M,bt.uc=Wt,xa(pt,bt),jt=1,bt=(pi=pt.D).Nb,Wt=(yi=_[pt.L])*pt.R,ne=yi/2*pt.B,_i=16*bt*pt.R,$r=8*bt*pt.B,fe=pt.sa,Me=pt.ta-Wt+_i,we=pt.qa,se=pt.ra-ne+$r,je=pt.Ha,$e=pt.Ia-ne+$r,Ns=(Yi=pi.M)==0,Ze=Yi>=pt.Va-1,pt.Aa==2&&xa(pt,pi),pi.uc)for(us=(ar=pt).D.M,t(ar.D.uc),pi=ar.yb;pi<ar.Hb;++pi){zi=pi,or=us;var Tr=(Qi=(qr=ar).D).Nb;Ui=qr.R;var Qi=Qi.wa[Qi.Y+zi],Wi=qr.sa,tr=qr.ta+16*Tr*Ui+16*zi,as=Qi.dd,$i=Qi.tc;if($i!=0)if(t(3<=$i),qr.L==1)0<zi&&gr(Wi,tr,Ui,$i+4),Qi.La&&Xo(Wi,tr,Ui,$i),0<or&&fr(Wi,tr,Ui,$i+4),Qi.La&&Dr(Wi,tr,Ui,$i);else{var lr=qr.B,Ts=qr.qa,Nr=qr.ra+8*Tr*lr+8*zi,br=qr.Ha,qr=qr.Ia+8*Tr*lr+8*zi;Tr=Qi.ld,0<zi&&(Lo(Wi,tr,Ui,$i+4,as,Tr),ns(Ts,Nr,br,qr,lr,$i+4,as,Tr)),Qi.La&&(hn(Wi,tr,Ui,$i,as,Tr),er(Ts,Nr,br,qr,lr,$i,as,Tr)),0<or&&(Ta(Wi,tr,Ui,$i+4,as,Tr),lo(Ts,Nr,br,qr,lr,$i+4,as,Tr)),Qi.La&&(cn(Wi,tr,Ui,$i,as,Tr),_s(Ts,Nr,br,qr,lr,$i,as,Tr))}}if(pt.ia&&alert("todo:DitherRow"),ft.put!=null){if(pi=16*Yi,Yi=16*(Yi+1),Ns?(ft.y=pt.sa,ft.O=pt.ta+_i,ft.f=pt.qa,ft.N=pt.ra+$r,ft.ea=pt.Ha,ft.W=pt.Ia+$r):(pi-=yi,ft.y=fe,ft.O=Me,ft.f=we,ft.N=se,ft.ea=je,ft.W=$e),Ze||(Yi-=yi),Yi>ft.o&&(Yi=ft.o),ft.F=null,ft.J=null,pt.Fa!=null&&0<pt.Fa.length&&pi<Yi&&(ft.J=oo(pt,ft,pi,Yi-pi),ft.F=pt.mb,ft.F==null&&ft.F.length==0)){jt=xi(pt,3,"Could not decode alpha data.");break t}pi<ft.j&&(yi=ft.j-pi,pi=ft.j,t(!(1&yi)),ft.O+=pt.R*yi,ft.N+=pt.B*(yi>>1),ft.W+=pt.B*(yi>>1),ft.F!=null&&(ft.J+=ft.width*yi)),pi<Yi&&(ft.O+=ft.v,ft.N+=ft.v>>1,ft.W+=ft.v>>1,ft.F!=null&&(ft.J+=ft.v),ft.ka=pi-ft.j,ft.U=ft.va-ft.v,ft.T=Yi-pi,jt=ft.put(ft))}bt+1!=pt.Ic||Ze||(r(pt.sa,pt.ta-Wt,fe,Me+16*pt.R,Wt),r(pt.qa,pt.ra-ne,we,se+8*pt.B,ne),r(pt.Ha,pt.Ia-ne,je,$e+8*pt.B,ne))}if(!jt)return xi(ut,6,"Output aborted.")}return 1}(g,b)),b.bc!=null&&b.bc(b),E&=1}return E?(g.cb=0,E):0}function ps(g,b,E,I,O){O=g[b+E+32*I]+(O>>3),g[b+E+32*I]=-256&O?0>O?0:255:O}function Or(g,b,E,I,O,F){ps(g,b,0,E,I+O),ps(g,b,1,E,I+F),ps(g,b,2,E,I-F),ps(g,b,3,E,I-O)}function hs(g){return(20091*g>>16)+g}function Zi(g,b,E,I){var O,F=0,z=n(16);for(O=0;4>O;++O){var V=g[b+0]+g[b+8],U=g[b+0]-g[b+8],W=(35468*g[b+4]>>16)-hs(g[b+12]),at=hs(g[b+4])+(35468*g[b+12]>>16);z[F+0]=V+at,z[F+1]=U+W,z[F+2]=U-W,z[F+3]=V-at,F+=4,b++}for(O=F=0;4>O;++O)V=(g=z[F+0]+4)+z[F+8],U=g-z[F+8],W=(35468*z[F+4]>>16)-hs(z[F+12]),ps(E,I,0,0,V+(at=hs(z[F+4])+(35468*z[F+12]>>16))),ps(E,I,1,0,U+W),ps(E,I,2,0,U-W),ps(E,I,3,0,V-at),F++,I+=32}function eo(g,b,E,I){var O=g[b+0]+4,F=35468*g[b+4]>>16,z=hs(g[b+4]),V=35468*g[b+1]>>16;Or(E,I,0,O+z,g=hs(g[b+1]),V),Or(E,I,1,O+F,g,V),Or(E,I,2,O-F,g,V),Or(E,I,3,O-z,g,V)}function io(g,b,E,I,O){Zi(g,b,E,I),O&&Zi(g,b+16,E,I+4)}function xn(g,b,E,I){Io(g,b+0,E,I,1),Io(g,b+32,E,I+128,1)}function pa(g,b,E,I){var O;for(g=g[b+0]+4,O=0;4>O;++O)for(b=0;4>b;++b)ps(E,I,b,O,g)}function rt(g,b,E,I){g[b+0]&&Dn(g,b+0,E,I),g[b+16]&&Dn(g,b+16,E,I+4),g[b+32]&&Dn(g,b+32,E,I+128),g[b+48]&&Dn(g,b+48,E,I+128+4)}function mt(g,b,E,I){var O,F=n(16);for(O=0;4>O;++O){var z=g[b+0+O]+g[b+12+O],V=g[b+4+O]+g[b+8+O],U=g[b+4+O]-g[b+8+O],W=g[b+0+O]-g[b+12+O];F[0+O]=z+V,F[8+O]=z-V,F[4+O]=W+U,F[12+O]=W-U}for(O=0;4>O;++O)z=(g=F[0+4*O]+3)+F[3+4*O],V=F[1+4*O]+F[2+4*O],U=F[1+4*O]-F[2+4*O],W=g-F[3+4*O],E[I+0]=z+V>>3,E[I+16]=W+U>>3,E[I+32]=z-V>>3,E[I+48]=W-U>>3,I+=64}function Dt(g,b,E){var I,O=b-32,F=Es,z=255-g[O-1];for(I=0;I<E;++I){var V,U=F,W=z+g[b-1];for(V=0;V<E;++V)g[b+V]=U[W+g[O+V]];b+=32}}function ue(g,b){Dt(g,b,4)}function Se(g,b){Dt(g,b,8)}function gi(g,b){Dt(g,b,16)}function Mi(g,b){var E;for(E=0;16>E;++E)r(g,b+32*E,g,b-32,16)}function pr(g,b){var E;for(E=16;0<E;--E)s(g,b,g[b-1],16),b+=32}function fs(g,b,E){var I;for(I=0;16>I;++I)s(b,E+32*I,g,16)}function rs(g,b){var E,I=16;for(E=0;16>E;++E)I+=g[b-1+32*E]+g[b+E-32];fs(I>>5,g,b)}function Ar(g,b){var E,I=8;for(E=0;16>E;++E)I+=g[b-1+32*E];fs(I>>4,g,b)}function rh(g,b){var E,I=8;for(E=0;16>E;++E)I+=g[b+E-32];fs(I>>4,g,b)}function Ha(g,b){fs(128,g,b)}function Li(g,b,E){return g+2*b+E+2>>2}function Vo(g,b){var E,I=b-32;for(I=new Uint8Array([Li(g[I-1],g[I+0],g[I+1]),Li(g[I+0],g[I+1],g[I+2]),Li(g[I+1],g[I+2],g[I+3]),Li(g[I+2],g[I+3],g[I+4])]),E=0;4>E;++E)r(g,b+32*E,I,0,I.length)}function kl(g,b){var E=g[b-1],I=g[b-1+32],O=g[b-1+64],F=g[b-1+96];Ae(g,b+0,16843009*Li(g[b-1-32],E,I)),Ae(g,b+32,16843009*Li(E,I,O)),Ae(g,b+64,16843009*Li(I,O,F)),Ae(g,b+96,16843009*Li(O,F,F))}function ts(g,b){var E,I=4;for(E=0;4>E;++E)I+=g[b+E-32]+g[b-1+32*E];for(I>>=3,E=0;4>E;++E)s(g,b+32*E,I,4)}function fa(g,b){var E=g[b-1+0],I=g[b-1+32],O=g[b-1+64],F=g[b-1-32],z=g[b+0-32],V=g[b+1-32],U=g[b+2-32],W=g[b+3-32];g[b+0+96]=Li(I,O,g[b-1+96]),g[b+1+96]=g[b+0+64]=Li(E,I,O),g[b+2+96]=g[b+1+64]=g[b+0+32]=Li(F,E,I),g[b+3+96]=g[b+2+64]=g[b+1+32]=g[b+0+0]=Li(z,F,E),g[b+3+64]=g[b+2+32]=g[b+1+0]=Li(V,z,F),g[b+3+32]=g[b+2+0]=Li(U,V,z),g[b+3+0]=Li(W,U,V)}function Wa(g,b){var E=g[b+1-32],I=g[b+2-32],O=g[b+3-32],F=g[b+4-32],z=g[b+5-32],V=g[b+6-32],U=g[b+7-32];g[b+0+0]=Li(g[b+0-32],E,I),g[b+1+0]=g[b+0+32]=Li(E,I,O),g[b+2+0]=g[b+1+32]=g[b+0+64]=Li(I,O,F),g[b+3+0]=g[b+2+32]=g[b+1+64]=g[b+0+96]=Li(O,F,z),g[b+3+32]=g[b+2+64]=g[b+1+96]=Li(F,z,V),g[b+3+64]=g[b+2+96]=Li(z,V,U),g[b+3+96]=Li(V,U,U)}function So(g,b){var E=g[b-1+0],I=g[b-1+32],O=g[b-1+64],F=g[b-1-32],z=g[b+0-32],V=g[b+1-32],U=g[b+2-32],W=g[b+3-32];g[b+0+0]=g[b+1+64]=F+z+1>>1,g[b+1+0]=g[b+2+64]=z+V+1>>1,g[b+2+0]=g[b+3+64]=V+U+1>>1,g[b+3+0]=U+W+1>>1,g[b+0+96]=Li(O,I,E),g[b+0+64]=Li(I,E,F),g[b+0+32]=g[b+1+96]=Li(E,F,z),g[b+1+32]=g[b+2+96]=Li(F,z,V),g[b+2+32]=g[b+3+96]=Li(z,V,U),g[b+3+32]=Li(V,U,W)}function qo(g,b){var E=g[b+0-32],I=g[b+1-32],O=g[b+2-32],F=g[b+3-32],z=g[b+4-32],V=g[b+5-32],U=g[b+6-32],W=g[b+7-32];g[b+0+0]=E+I+1>>1,g[b+1+0]=g[b+0+64]=I+O+1>>1,g[b+2+0]=g[b+1+64]=O+F+1>>1,g[b+3+0]=g[b+2+64]=F+z+1>>1,g[b+0+32]=Li(E,I,O),g[b+1+32]=g[b+0+96]=Li(I,O,F),g[b+2+32]=g[b+1+96]=Li(O,F,z),g[b+3+32]=g[b+2+96]=Li(F,z,V),g[b+3+64]=Li(z,V,U),g[b+3+96]=Li(V,U,W)}function Ja(g,b){var E=g[b-1+0],I=g[b-1+32],O=g[b-1+64],F=g[b-1+96];g[b+0+0]=E+I+1>>1,g[b+2+0]=g[b+0+32]=I+O+1>>1,g[b+2+32]=g[b+0+64]=O+F+1>>1,g[b+1+0]=Li(E,I,O),g[b+3+0]=g[b+1+32]=Li(I,O,F),g[b+3+32]=g[b+1+64]=Li(O,F,F),g[b+3+64]=g[b+2+64]=g[b+0+96]=g[b+1+96]=g[b+2+96]=g[b+3+96]=F}function Za(g,b){var E=g[b-1+0],I=g[b-1+32],O=g[b-1+64],F=g[b-1+96],z=g[b-1-32],V=g[b+0-32],U=g[b+1-32],W=g[b+2-32];g[b+0+0]=g[b+2+32]=E+z+1>>1,g[b+0+32]=g[b+2+64]=I+E+1>>1,g[b+0+64]=g[b+2+96]=O+I+1>>1,g[b+0+96]=F+O+1>>1,g[b+3+0]=Li(V,U,W),g[b+2+0]=Li(z,V,U),g[b+1+0]=g[b+3+32]=Li(E,z,V),g[b+1+32]=g[b+3+64]=Li(I,E,z),g[b+1+64]=g[b+3+96]=Li(O,I,E),g[b+1+96]=Li(F,O,I)}function Jh(g,b){var E;for(E=0;8>E;++E)r(g,b+32*E,g,b-32,8)}function gc(g,b){var E;for(E=0;8>E;++E)s(g,b,g[b-1],8),b+=32}function ga(g,b,E){var I;for(I=0;8>I;++I)s(b,E+32*I,g,8)}function ma(g,b){var E,I=8;for(E=0;8>E;++E)I+=g[b+E-32]+g[b-1+32*E];ga(I>>4,g,b)}function Ho(g,b){var E,I=4;for(E=0;8>E;++E)I+=g[b+E-32];ga(I>>3,g,b)}function Eo(g,b){var E,I=4;for(E=0;8>E;++E)I+=g[b-1+32*E];ga(I>>3,g,b)}function gs(g,b){ga(128,g,b)}function ss(g,b,E){var I=g[b-E],O=g[b+0],F=3*(O-I)+nh[1020+g[b-2*E]-g[b+E]],z=Ne[112+(F+4>>3)];g[b-E]=Es[255+I+Ne[112+(F+3>>3)]],g[b+0]=Es[255+O-z]}function Xi(g,b,E,I){var O=g[b+0],F=g[b+E];return En[255+g[b-2*E]-g[b-E]]>I||En[255+F-O]>I}function Xa(g,b,E,I){return 4*En[255+g[b-E]-g[b+0]]+En[255+g[b-2*E]-g[b+E]]<=I}function $a(g,b,E,I,O){var F=g[b-3*E],z=g[b-2*E],V=g[b-E],U=g[b+0],W=g[b+E],at=g[b+2*E],tt=g[b+3*E];return 4*En[255+V-U]+En[255+z-W]>I?0:En[255+g[b-4*E]-F]<=O&&En[255+F-z]<=O&&En[255+z-V]<=O&&En[255+tt-at]<=O&&En[255+at-W]<=O&&En[255+W-U]<=O}function Ol(g,b,E,I){var O=2*I+1;for(I=0;16>I;++I)Xa(g,b+I,E,O)&&ss(g,b+I,E)}function ro(g,b,E,I){var O=2*I+1;for(I=0;16>I;++I)Xa(g,b+I*E,1,O)&&ss(g,b+I*E,1)}function so(g,b,E,I){var O;for(O=3;0<O;--O)Ol(g,b+=4*E,E,I)}function mc(g,b,E,I){var O;for(O=3;0<O;--O)ro(g,b+=4,E,I)}function Co(g,b,E,I,O,F,z,V){for(F=2*F+1;0<O--;){if($a(g,b,E,F,z))if(Xi(g,b,E,V))ss(g,b,E);else{var U=g,W=b,at=E,tt=U[W-2*at],ht=U[W-at],ut=U[W+0],Tt=U[W+at],bt=U[W+2*at],pt=27*(jt=nh[1020+3*(ut-ht)+nh[1020+tt-Tt]])+63>>7,ft=18*jt+63>>7,jt=9*jt+63>>7;U[W-3*at]=Es[255+U[W-3*at]+jt],U[W-2*at]=Es[255+tt+ft],U[W-at]=Es[255+ht+pt],U[W+0]=Es[255+ut-pt],U[W+at]=Es[255+Tt-ft],U[W+2*at]=Es[255+bt-jt]}b+=I}}function on(g,b,E,I,O,F,z,V){for(F=2*F+1;0<O--;){if($a(g,b,E,F,z))if(Xi(g,b,E,V))ss(g,b,E);else{var U=g,W=b,at=E,tt=U[W-at],ht=U[W+0],ut=U[W+at],Tt=Ne[112+((bt=3*(ht-tt))+4>>3)],bt=Ne[112+(bt+3>>3)],pt=Tt+1>>1;U[W-2*at]=Es[255+U[W-2*at]+pt],U[W-at]=Es[255+tt+bt],U[W+0]=Es[255+ht-Tt],U[W+at]=Es[255+ut-pt]}b+=I}}function Dl(g,b,E,I,O,F){Co(g,b,E,1,16,I,O,F)}function ya(g,b,E,I,O,F){Co(g,b,1,E,16,I,O,F)}function _a(g,b,E,I,O,F){var z;for(z=3;0<z;--z)on(g,b+=4*E,E,1,16,I,O,F)}function Nl(g,b,E,I,O,F){var z;for(z=3;0<z;--z)on(g,b+=4,1,E,16,I,O,F)}function Zh(g,b,E,I,O,F,z,V){Co(g,b,O,1,8,F,z,V),Co(E,I,O,1,8,F,z,V)}function yc(g,b,E,I,O,F,z,V){Co(g,b,1,O,8,F,z,V),Co(E,I,1,O,8,F,z,V)}function _c(g,b,E,I,O,F,z,V){on(g,b+4*O,O,1,8,F,z,V),on(E,I+4*O,O,1,8,F,z,V)}function sh(g,b,E,I,O,F,z,V){on(g,b+4,1,O,8,F,z,V),on(E,I+4,1,O,8,F,z,V)}function Fl(){this.ba=new sr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new K,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ka(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function va(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function zl(){this.ua=0,this.Wa=new Pt,this.vb=new Pt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new wt,this.yc=new dt}function vc(){this.xb=this.a=0,this.l=new nn,this.ca=new sr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new it,this.Pb=0,this.wd=new it,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new zl,this.ab=0,this.gc=c(4,va),this.Oc=0}function no(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new nn,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ba(g,b,E,I,O,F,z){for(g=g==null?0:g[b+0],b=0;b<z;++b)O[F+b]=g+E[I+b]&255,g=O[F+b]}function jl(g,b,E,I,O,F,z){var V;if(g==null)ba(null,null,E,I,O,F,z);else for(V=0;V<z;++V)O[F+V]=g[b+V]+E[I+V]&255}function To(g,b,E,I,O,F,z){if(g==null)ba(null,null,E,I,O,F,z);else{var V,U=g[b+0],W=U,at=U;for(V=0;V<z;++V)W=at+(U=g[b+V])-W,at=E[I+V]+(-256&W?0>W?0:255:W)&255,W=U,O[F+V]=at}}function oo(g,b,E,I){var O=b.width,F=b.o;if(t(g!=null&&b!=null),0>E||0>=I||E+I>F)return null;if(!g.Cc){if(g.ga==null){var z;if(g.ga=new no,(z=g.ga==null)||(z=b.width*b.o,t(g.Gb.length==0),g.Gb=n(z),g.Uc=0,g.Gb==null?z=0:(g.mb=g.Gb,g.nb=g.Uc,g.rc=null,z=1),z=!z),!z){z=g.ga;var V=g.Fa,U=g.P,W=g.qc,at=g.mb,tt=g.nb,ht=U+1,ut=W-1,Tt=z.l;if(t(V!=null&&at!=null&&b!=null),Fn[0]=null,Fn[1]=ba,Fn[2]=jl,Fn[3]=To,z.ca=at,z.tb=tt,z.c=b.width,z.i=b.height,t(0<z.c&&0<z.i),1>=W)b=0;else if(z.$a=V[U+0]>>0&3,z.Z=V[U+0]>>2&3,z.Lc=V[U+0]>>4&3,U=V[U+0]>>6&3,0>z.$a||1<z.$a||4<=z.Z||1<z.Lc||U)b=0;else if(Tt.put=Ft,Tt.ac=kt,Tt.bc=Vt,Tt.ma=z,Tt.width=b.width,Tt.height=b.height,Tt.Da=b.Da,Tt.v=b.v,Tt.va=b.va,Tt.j=b.j,Tt.o=b.o,z.$a)t:{t(z.$a==1),b=li();e:for(;;){if(b==null){b=0;break t}if(t(z!=null),z.mc=b,b.c=z.c,b.i=z.i,b.l=z.l,b.l.ma=z,b.l.width=z.c,b.l.height=z.i,b.a=0,te(b.m,V,ht,ut),!ji(z.c,z.i,1,b,null)||(b.ab==1&&b.gc[0].hc==3&&si(b.s)?(z.ic=1,V=b.c*b.i,b.Ta=null,b.Ua=0,b.V=n(V),b.Ba=0,b.V==null?(b.a=1,b=0):b=1):(z.ic=0,b=ur(b,z.c)),!b))break e;b=1;break t}z.mc=null,b=0}else b=ut>=z.c*z.i;z=!b}if(z)return null;g.ga.Lc!=1?g.Ga=0:I=F-E}t(g.ga!=null),t(E+I<=F);t:{if(b=(V=g.ga).c,F=V.l.o,V.$a==0){if(ht=g.rc,ut=g.Vc,Tt=g.Fa,U=g.P+1+E*b,W=g.mb,at=g.nb+E*b,t(U<=g.P+g.qc),V.Z!=0)for(t(Fn[V.Z]!=null),z=0;z<I;++z)Fn[V.Z](ht,ut,Tt,U,W,at,b),ht=W,ut=at,at+=b,U+=b;else for(z=0;z<I;++z)r(W,at,Tt,U,b),ht=W,ut=at,at+=b,U+=b;g.rc=ht,g.Vc=ut}else{if(t(V.mc!=null),b=E+I,t((z=V.mc)!=null),t(b<=z.i),z.C>=b)b=1;else if(V.ic||Yt(),V.ic){V=z.V,ht=z.Ba,ut=z.c;var bt=z.i,pt=(Tt=1,U=z.$/ut,W=z.$%ut,at=z.m,tt=z.s,z.$),ft=ut*bt,jt=ut*b,Wt=tt.wc,se=pt<jt?qe(tt,W,U):null;t(pt<=ft),t(b<=bt),t(si(tt));e:for(;;){for(;!at.h&&pt<jt;){if(W&Wt||(se=qe(tt,W,U)),t(se!=null),Xt(at),256>(bt=he(se.G[0],se.H[0],at)))V[ht+pt]=bt,++pt,++W>=ut&&(W=0,++U<=b&&!(U%16)&&Ni(z,U));else{if(!(280>bt)){Tt=0;break e}bt=Jt(bt-256,at);var ne,fe=he(se.G[4],se.H[4],at);if(Xt(at),!(pt>=(fe=ye(ut,fe=Jt(fe,at)))&&ft-pt>=bt)){Tt=0;break e}for(ne=0;ne<bt;++ne)V[ht+pt+ne]=V[ht+pt+ne-fe];for(pt+=bt,W+=bt;W>=ut;)W-=ut,++U<=b&&!(U%16)&&Ni(z,U);pt<jt&&W&Wt&&(se=qe(tt,W,U))}t(at.h==It(at))}Ni(z,U>b?b:U);break e}!Tt||at.h&&pt<ft?(Tt=0,z.a=at.h?5:3):z.$=pt,b=Tt}else b=Hi(z,z.V,z.Ba,z.c,z.i,b,Mr);if(!b){I=0;break t}}E+I>=F&&(g.Cc=1),I=1}if(!I)return null;if(g.Cc&&((I=g.ga)!=null&&(I.mc=null),g.ga=null,0<g.Ga))return alert("todo:WebPDequantizeLevels"),null}return g.nb+E*O}function D(g,b,E,I,O,F){for(;0<O--;){var z,V=g,U=b+(E?1:0),W=g,at=b+(E?0:3);for(z=0;z<I;++z){var tt=W[at+4*z];tt!=255&&(tt*=32897,V[U+4*z+0]=V[U+4*z+0]*tt>>23,V[U+4*z+1]=V[U+4*z+1]*tt>>23,V[U+4*z+2]=V[U+4*z+2]*tt>>23)}b+=F}}function Q(g,b,E,I,O){for(;0<I--;){var F;for(F=0;F<E;++F){var z=g[b+2*F+0],V=15&(W=g[b+2*F+1]),U=4369*V,W=(240&W|W>>4)*U>>16;g[b+2*F+0]=(240&z|z>>4)*U>>16&240|(15&z|z<<4)*U>>16>>4&15,g[b+2*F+1]=240&W|V}b+=O}}function Ct(g,b,E,I,O,F,z,V){var U,W,at=255;for(W=0;W<O;++W){for(U=0;U<I;++U){var tt=g[b+U];F[z+4*U]=tt,at&=tt}b+=E,z+=V}return at!=255}function Gt(g,b,E,I,O){var F;for(F=0;F<O;++F)E[I+F]=g[b+F]>>8}function Yt(){Bo=D,ql=Q,$o=Ct,Hl=Gt}function ee(g,b,E){xt[g]=function(I,O,F,z,V,U,W,at,tt,ht,ut,Tt,bt,pt,ft,jt,Wt){var se,ne=Wt-1>>1,fe=V[U+0]|W[at+0]<<16,Me=tt[ht+0]|ut[Tt+0]<<16;t(I!=null);var we=3*fe+Me+131074>>2;for(b(I[O+0],255&we,we>>16,bt,pt),F!=null&&(we=3*Me+fe+131074>>2,b(F[z+0],255&we,we>>16,ft,jt)),se=1;se<=ne;++se){var je=V[U+se]|W[at+se]<<16,$e=tt[ht+se]|ut[Tt+se]<<16,Ze=fe+je+Me+$e+524296,yi=Ze+2*(je+Me)>>3;we=yi+fe>>1,fe=(Ze=Ze+2*(fe+$e)>>3)+je>>1,b(I[O+2*se-1],255&we,we>>16,bt,pt+(2*se-1)*E),b(I[O+2*se-0],255&fe,fe>>16,bt,pt+(2*se-0)*E),F!=null&&(we=Ze+Me>>1,fe=yi+$e>>1,b(F[z+2*se-1],255&we,we>>16,ft,jt+(2*se-1)*E),b(F[z+2*se+0],255&fe,fe>>16,ft,jt+(2*se+0)*E)),fe=je,Me=$e}1&Wt||(we=3*fe+Me+131074>>2,b(I[O+Wt-1],255&we,we>>16,bt,pt+(Wt-1)*E),F!=null&&(we=3*Me+fe+131074>>2,b(F[z+Wt-1],255&we,we>>16,ft,jt+(Wt-1)*E)))}}function Ie(){Qs[xc]=eu,Qs[sl]=Ro,Qs[oh]=iu,Qs[nl]=Pc,Qs[Ac]=Wl,Qs[$h]=Ic,Qs[Ko]=Mc,Qs[Cr]=Ro,Qs[ol]=Pc,Qs[al]=Wl,Qs[Sc]=Ic}function ti(g){return g&~hl?0>g?0:255:g>>Lc}function wi(g,b){return ti((19077*g>>8)+(26149*b>>8)-14234)}function Ii(g,b,E){return ti((19077*g>>8)-(6419*b>>8)-(13320*E>>8)+8708)}function hi(g,b){return ti((19077*g>>8)+(33050*b>>8)-17685)}function rr(g,b,E,I,O){I[O+0]=wi(g,E),I[O+1]=Ii(g,b,E),I[O+2]=hi(g,b)}function ui(g,b,E,I,O){I[O+0]=hi(g,b),I[O+1]=Ii(g,b,E),I[O+2]=wi(g,E)}function Zr(g,b,E,I,O){var F=Ii(g,b,E);b=F<<3&224|hi(g,b)>>3,I[O+0]=248&wi(g,E)|F>>5,I[O+1]=b}function Ri(g,b,E,I,O){var F=240&hi(g,b)|15;I[O+0]=240&wi(g,E)|Ii(g,b,E)>>4,I[O+1]=F}function Fi(g,b,E,I,O){I[O+0]=255,rr(g,b,E,I,O+1)}function Vr(g,b,E,I,O){ui(g,b,E,I,O),I[O+3]=255}function an(g,b,E,I,O){rr(g,b,E,I,O),I[O+3]=255}function ln(g,b){return 0>g?0:g>b?b:g}function Po(g,b,E){xt[g]=function(I,O,F,z,V,U,W,at,tt){for(var ht=at+(-2&tt)*E;at!=ht;)b(I[O+0],F[z+0],V[U+0],W,at),b(I[O+1],F[z+0],V[U+0],W,at+E),O+=2,++z,++U,at+=2*E;1&tt&&b(I[O+0],F[z+0],V[U+0],W,at)}}function Ya(g,b,E){return E==0?g==0?b==0?6:5:b==0?4:0:E}function wa(g,b,E,I,O){switch(g>>>30){case 3:Io(b,E,I,O,0);break;case 2:ao(b,E,I,O);break;case 1:Dn(b,E,I,O)}}function xa(g,b){var E,I,O=b.M,F=b.Nb,z=g.oc,V=g.pc+40,U=g.oc,W=g.pc+584,at=g.oc,tt=g.pc+600;for(E=0;16>E;++E)z[V+32*E-1]=129;for(E=0;8>E;++E)U[W+32*E-1]=129,at[tt+32*E-1]=129;for(0<O?z[V-1-32]=U[W-1-32]=at[tt-1-32]=129:(s(z,V-32-1,127,21),s(U,W-32-1,127,9),s(at,tt-32-1,127,9)),I=0;I<g.za;++I){var ht=b.ya[b.aa+I];if(0<I){for(E=-1;16>E;++E)r(z,V+32*E-4,z,V+32*E+12,4);for(E=-1;8>E;++E)r(U,W+32*E-4,U,W+32*E+4,4),r(at,tt+32*E-4,at,tt+32*E+4,4)}var ut=g.Gd,Tt=g.Hd+I,bt=ht.ad,pt=ht.Hc;if(0<O&&(r(z,V-32,ut[Tt].y,0,16),r(U,W-32,ut[Tt].f,0,8),r(at,tt-32,ut[Tt].ea,0,8)),ht.Za){var ft=z,jt=V-32+16;for(0<O&&(I>=g.za-1?s(ft,jt,ut[Tt].y[15],4):r(ft,jt,ut[Tt+1].y,0,4)),E=0;4>E;E++)ft[jt+128+E]=ft[jt+256+E]=ft[jt+384+E]=ft[jt+0+E];for(E=0;16>E;++E,pt<<=2)ft=z,jt=V+m[E],vs[ht.Ob[E]](ft,jt),wa(pt,bt,16*+E,ft,jt)}else if(ft=Ya(I,O,ht.Ob[0]),Nn[ft](z,V),pt!=0)for(E=0;16>E;++E,pt<<=2)wa(pt,bt,16*+E,z,V+m[E]);for(E=ht.Gc,ft=Ya(I,O,ht.Dd),po[ft](U,W),po[ft](at,tt),pt=bt,ft=U,jt=W,255&(ht=E>>0)&&(170&ht?Zo(pt,256,ft,jt):Mo(pt,256,ft,jt)),ht=at,pt=tt,255&(E>>=8)&&(170&E?Zo(bt,320,ht,pt):Mo(bt,320,ht,pt)),O<g.Ub-1&&(r(ut[Tt].y,0,z,V+480,16),r(ut[Tt].f,0,U,W+224,8),r(ut[Tt].ea,0,at,tt+224,8)),E=8*F*g.B,ut=g.sa,Tt=g.ta+16*I+16*F*g.R,bt=g.qa,ht=g.ra+8*I+E,pt=g.Ha,ft=g.Ia+8*I+E,E=0;16>E;++E)r(ut,Tt+E*g.R,z,V+32*E,16);for(E=0;8>E;++E)r(bt,ht+E*g.B,U,W+32*E,8),r(pt,ft+E*g.B,at,tt+32*E,8)}}function Qa(g,b,E,I,O,F,z,V,U){var W=[0],at=[0],tt=0,ht=U!=null?U.kd:0,ut=U??new Ka;if(g==null||12>E)return 7;ut.data=g,ut.w=b,ut.ha=E,b=[b],E=[E],ut.gb=[ut.gb];t:{var Tt=b,bt=E,pt=ut.gb;if(t(g!=null),t(bt!=null),t(pt!=null),pt[0]=0,12<=bt[0]&&!e(g,Tt[0],"RIFF")){if(e(g,Tt[0]+8,"WEBP")){pt=3;break t}var ft=Ge(g,Tt[0]+4);if(12>ft||4294967286<ft){pt=3;break t}if(ht&&ft>bt[0]-8){pt=7;break t}pt[0]=ft,Tt[0]+=12,bt[0]-=12}pt=0}if(pt!=0)return pt;for(ft=0<ut.gb[0],E=E[0];;){t:{var jt=g;bt=b,pt=E;var Wt=W,se=at,ne=Tt=[0];if((we=tt=[tt])[0]=0,8>pt[0])pt=7;else{if(!e(jt,bt[0],"VP8X")){if(Ge(jt,bt[0]+4)!=10){pt=3;break t}if(18>pt[0]){pt=7;break t}var fe=Ge(jt,bt[0]+8),Me=1+Fe(jt,bt[0]+12);if(2147483648<=Me*(jt=1+Fe(jt,bt[0]+15))){pt=3;break t}ne!=null&&(ne[0]=fe),Wt!=null&&(Wt[0]=Me),se!=null&&(se[0]=jt),bt[0]+=18,pt[0]-=18,we[0]=1}pt=0}}if(tt=tt[0],Tt=Tt[0],pt!=0)return pt;if(bt=!!(2&Tt),!ft&&tt)return 3;if(F!=null&&(F[0]=!!(16&Tt)),z!=null&&(z[0]=bt),V!=null&&(V[0]=0),z=W[0],Tt=at[0],tt&&bt&&U==null){pt=0;break}if(4>E){pt=7;break}if(ft&&tt||!ft&&!tt&&!e(g,b[0],"ALPH")){E=[E],ut.na=[ut.na],ut.P=[ut.P],ut.Sa=[ut.Sa];t:{fe=g,pt=b,ft=E;var we=ut.gb;Wt=ut.na,se=ut.P,ne=ut.Sa,Me=22,t(fe!=null),t(ft!=null),jt=pt[0];var je=ft[0];for(t(Wt!=null),t(ne!=null),Wt[0]=null,se[0]=null,ne[0]=0;;){if(pt[0]=jt,ft[0]=je,8>je){pt=7;break t}var $e=Ge(fe,jt+4);if(4294967286<$e){pt=3;break t}var Ze=8+$e+1&-2;if(Me+=Ze,0<we&&Me>we){pt=3;break t}if(!e(fe,jt,"VP8 ")||!e(fe,jt,"VP8L")){pt=0;break t}if(je[0]<Ze){pt=7;break t}e(fe,jt,"ALPH")||(Wt[0]=fe,se[0]=jt+8,ne[0]=$e),jt+=Ze,je-=Ze}}if(E=E[0],ut.na=ut.na[0],ut.P=ut.P[0],ut.Sa=ut.Sa[0],pt!=0)break}E=[E],ut.Ja=[ut.Ja],ut.xa=[ut.xa];t:if(we=g,pt=b,ft=E,Wt=ut.gb[0],se=ut.Ja,ne=ut.xa,fe=pt[0],jt=!e(we,fe,"VP8 "),Me=!e(we,fe,"VP8L"),t(we!=null),t(ft!=null),t(se!=null),t(ne!=null),8>ft[0])pt=7;else{if(jt||Me){if(we=Ge(we,fe+4),12<=Wt&&we>Wt-12){pt=3;break t}if(ht&&we>ft[0]-8){pt=7;break t}se[0]=we,pt[0]+=8,ft[0]-=8,ne[0]=Me}else ne[0]=5<=ft[0]&&we[fe+0]==47&&!(we[fe+4]>>5),se[0]=ft[0];pt=0}if(E=E[0],ut.Ja=ut.Ja[0],ut.xa=ut.xa[0],b=b[0],pt!=0)break;if(4294967286<ut.Ja)return 3;if(V==null||bt||(V[0]=ut.xa?2:1),z=[z],Tt=[Tt],ut.xa){if(5>E){pt=7;break}V=z,ht=Tt,bt=F,g==null||5>E?g=0:5<=E&&g[b+0]==47&&!(g[b+4]>>5)?(ft=[0],we=[0],Wt=[0],te(se=new it,g,b,E),At(se,ft,we,Wt)?(V!=null&&(V[0]=ft[0]),ht!=null&&(ht[0]=we[0]),bt!=null&&(bt[0]=Wt[0]),g=1):g=0):g=0}else{if(10>E){pt=7;break}V=Tt,g==null||10>E||!wn(g,b+3,E-3)?g=0:(ht=g[b+0]|g[b+1]<<8|g[b+2]<<16,bt=16383&(g[b+7]<<8|g[b+6]),g=16383&(g[b+9]<<8|g[b+8]),1&ht||3<(ht>>1&7)||!(ht>>4&1)||ht>>5>=ut.Ja||!bt||!g?g=0:(z&&(z[0]=bt),V&&(V[0]=g),g=1))}if(!g||(z=z[0],Tt=Tt[0],tt&&(W[0]!=z||at[0]!=Tt)))return 3;U!=null&&(U[0]=ut,U.offset=b-U.w,t(4294967286>b-U.w),t(U.offset==U.ha-E));break}return pt==0||pt==7&&tt&&U==null?(F!=null&&(F[0]|=ut.na!=null&&0<ut.na.length),I!=null&&(I[0]=z),O!=null&&(O[0]=Tt),0):pt}function Aa(g,b,E){var I=b.width,O=b.height,F=0,z=0,V=I,U=O;if(b.Da=g!=null&&0<g.Da,b.Da&&(V=g.cd,U=g.bd,F=g.v,z=g.j,11>E||(F&=-2,z&=-2),0>F||0>z||0>=V||0>=U||F+V>I||z+U>O))return 0;if(b.v=F,b.j=z,b.va=F+V,b.o=z+U,b.U=V,b.T=U,b.da=g!=null&&0<g.da,b.da){if(!Zt(V,U,E=[g.ib],F=[g.hb]))return 0;b.ib=E[0],b.hb=F[0]}return b.ob=g!=null&&g.ob,b.Kb=g==null||!g.Sd,b.da&&(b.ob=b.ib<3*I/4&&b.hb<3*O/4,b.Kb=0),1}function Ul(g){if(g==null)return 2;if(11>g.S){var b=g.f.RGBA;b.fb+=(g.height-1)*b.A,b.A=-b.A}else b=g.f.kb,g=g.height,b.O+=(g-1)*b.fa,b.fa=-b.fa,b.N+=(g-1>>1)*b.Ab,b.Ab=-b.Ab,b.W+=(g-1>>1)*b.Db,b.Db=-b.Db,b.F!=null&&(b.J+=(g-1)*b.lb,b.lb=-b.lb);return 0}function Wo(g,b,E,I){if(I==null||0>=g||0>=b)return 2;if(E!=null){if(E.Da){var O=E.cd,F=E.bd,z=-2&E.v,V=-2&E.j;if(0>z||0>V||0>=O||0>=F||z+O>g||V+F>b)return 2;g=O,b=F}if(E.da){if(!Zt(g,b,O=[E.ib],F=[E.hb]))return 2;g=O[0],b=F[0]}}I.width=g,I.height=b;t:{var U=I.width,W=I.height;if(g=I.S,0>=U||0>=W||!(g>=xc&&13>g))g=2;else{if(0>=I.Rd&&I.sd==null){z=F=O=b=0;var at=(V=U*R[g])*W;if(11>g||(F=(W+1)/2*(b=(U+1)/2),g==12&&(z=(O=U)*W)),(W=n(at+2*F+z))==null){g=1;break t}I.sd=W,11>g?((U=I.f.RGBA).eb=W,U.fb=0,U.A=V,U.size=at):((U=I.f.kb).y=W,U.O=0,U.fa=V,U.Fd=at,U.f=W,U.N=0+at,U.Ab=b,U.Cd=F,U.ea=W,U.W=0+at+F,U.Db=b,U.Ed=F,g==12&&(U.F=W,U.J=0+at+2*F),U.Tc=z,U.lb=O)}if(b=1,O=I.S,F=I.width,z=I.height,O>=xc&&13>O)if(11>O)g=I.f.RGBA,b&=(V=Math.abs(g.A))*(z-1)+F<=g.size,b&=V>=F*R[O],b&=g.eb!=null;else{g=I.f.kb,V=(F+1)/2,at=(z+1)/2,U=Math.abs(g.fa),W=Math.abs(g.Ab);var tt=Math.abs(g.Db),ht=Math.abs(g.lb),ut=ht*(z-1)+F;b&=U*(z-1)+F<=g.Fd,b&=W*(at-1)+V<=g.Cd,b=(b&=tt*(at-1)+V<=g.Ed)&U>=F&W>=V&tt>=V,b&=g.y!=null,b&=g.f!=null,b&=g.ea!=null,O==12&&(b&=ht>=F,b&=ut<=g.Tc,b&=g.F!=null)}else b=0;g=b?0:2}}return g!=0||E!=null&&E.fd&&(g=Ul(I)),g}var Ds=64,Sa=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],tl=24,el=32,Ea=8,Js=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ve("Predictor0","PredictorAdd0"),xt.Predictor0=function(){return 4278190080},xt.Predictor1=function(g){return g},xt.Predictor2=function(g,b,E){return b[E+0]},xt.Predictor3=function(g,b,E){return b[E+1]},xt.Predictor4=function(g,b,E){return b[E-1]},xt.Predictor5=function(g,b,E){return Ve(Ve(g,b[E+1]),b[E+0])},xt.Predictor6=function(g,b,E){return Ve(g,b[E-1])},xt.Predictor7=function(g,b,E){return Ve(g,b[E+0])},xt.Predictor8=function(g,b,E){return Ve(b[E-1],b[E+0])},xt.Predictor9=function(g,b,E){return Ve(b[E+0],b[E+1])},xt.Predictor10=function(g,b,E){return Ve(Ve(g,b[E-1]),Ve(b[E+0],b[E+1]))},xt.Predictor11=function(g,b,E){var I=b[E+0];return 0>=Ti(I>>24&255,g>>24&255,(b=b[E-1])>>24&255)+Ti(I>>16&255,g>>16&255,b>>16&255)+Ti(I>>8&255,g>>8&255,b>>8&255)+Ti(255&I,255&g,255&b)?I:g},xt.Predictor12=function(g,b,E){var I=b[E+0];return(ai((g>>24&255)+(I>>24&255)-((b=b[E-1])>>24&255))<<24|ai((g>>16&255)+(I>>16&255)-(b>>16&255))<<16|ai((g>>8&255)+(I>>8&255)-(b>>8&255))<<8|ai((255&g)+(255&I)-(255&b)))>>>0},xt.Predictor13=function(g,b,E){var I=b[E-1];return(Ai((g=Ve(g,b[E+0]))>>24&255,I>>24&255)<<24|Ai(g>>16&255,I>>16&255)<<16|Ai(g>>8&255,I>>8&255)<<8|Ai(g>>0&255,I>>0&255))>>>0};var Xh=xt.PredictorAdd0;xt.PredictorAdd1=Pi,ve("Predictor2","PredictorAdd2"),ve("Predictor3","PredictorAdd3"),ve("Predictor4","PredictorAdd4"),ve("Predictor5","PredictorAdd5"),ve("Predictor6","PredictorAdd6"),ve("Predictor7","PredictorAdd7"),ve("Predictor8","PredictorAdd8"),ve("Predictor9","PredictorAdd9"),ve("Predictor10","PredictorAdd10"),ve("Predictor11","PredictorAdd11"),ve("Predictor12","PredictorAdd12"),ve("Predictor13","PredictorAdd13");var Gl=xt.PredictorAdd2;Ei("ColorIndexInverseTransform","MapARGB","32b",function(g){return g>>8&255},function(g){return g}),Ei("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(g){return g},function(g){return g>>8&255});var Lr,As=xt.ColorIndexInverseTransform,ms=xt.MapARGB,bc=xt.VP8LColorIndexInverseTransformAlpha,Vl=xt.MapAlpha,Jo=xt.VP8LPredictorsAdd=[];Jo.length=16,(xt.VP8LPredictors=[]).length=16,(xt.VP8LPredictorsAdd_C=[]).length=16,(xt.VP8LPredictors_C=[]).length=16;var ys,Ss,An,kn,On,Ca,Sn,Io,ao,Zo,Dn,Mo,Ta,Lo,lo,ns,cn,hn,_s,er,fr,gr,Dr,Xo,Bo,ql,$o,Hl,co=n(511),We=n(2041),wc=n(225),il=n(767),rl=0,nh=We,Ne=wc,Es=il,En=co,xc=0,sl=1,oh=2,nl=3,Ac=4,$h=5,Ko=6,Cr=7,ol=8,al=9,Sc=10,zu=[2,3,7],ju=[3,3,11],Kh=[280,256,256,256,40],ho=[0,1,1,1,0],Ec=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],ni=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],di=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ah=8,ll=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Cc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Cs=null,Yh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],uo=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Qh=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Tc=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Xr=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],os=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Uu=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Nn=[],vs=[],po=[],tu=1,lh=2,Fn=[],Qs=[];ee("UpsampleRgbLinePair",rr,3),ee("UpsampleBgrLinePair",ui,3),ee("UpsampleRgbaLinePair",an,4),ee("UpsampleBgraLinePair",Vr,4),ee("UpsampleArgbLinePair",Fi,4),ee("UpsampleRgba4444LinePair",Ri,2),ee("UpsampleRgb565LinePair",Zr,2);var eu=xt.UpsampleRgbLinePair,iu=xt.UpsampleBgrLinePair,Ro=xt.UpsampleRgbaLinePair,Pc=xt.UpsampleBgraLinePair,Wl=xt.UpsampleArgbLinePair,Ic=xt.UpsampleRgba4444LinePair,Mc=xt.UpsampleRgb565LinePair,cl=16,Yo=1<<cl-1,fo=-227,Jl=482,Lc=6,hl=(256<<Lc)-1,ch=0,ru=n(256),hh=n(256),Gu=n(256),w=n(256),a=n(Jl-fo),d=n(Jl-fo);Po("YuvToRgbRow",rr,3),Po("YuvToBgrRow",ui,3),Po("YuvToRgbaRow",an,4),Po("YuvToBgraRow",Vr,4),Po("YuvToArgbRow",Fi,4),Po("YuvToRgba4444Row",Ri,2),Po("YuvToRgb565Row",Zr,2);var m=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],_=[0,2,8],A=[8,7,6,4,4,2,2,2,1,1,1,1],B=1;this.WebPDecodeRGBA=function(g,b,E,I,O){var F=sl,z=new Fl,V=new sr;z.ba=V,V.S=F,V.width=[V.width],V.height=[V.height];var U=V.width,W=V.height,at=new vt;if(at==null||g==null)var tt=2;else t(at!=null),tt=Qa(g,b,E,at.width,at.height,at.Pd,at.Qd,at.format,null);if(tt!=0?U=0:(U!=null&&(U[0]=at.width[0]),W!=null&&(W[0]=at.height[0]),U=1),U){V.width=V.width[0],V.height=V.height[0],I!=null&&(I[0]=V.width),O!=null&&(O[0]=V.height);t:{if(I=new nn,(O=new Ka).data=g,O.w=b,O.ha=E,O.kd=1,b=[0],t(O!=null),((g=Qa(O.data,O.w,O.ha,null,null,null,b,null,O))==0||g==7)&&b[0]&&(g=4),(b=g)==0){if(t(z!=null),I.data=O.data,I.w=O.w+O.offset,I.ha=O.ha-O.offset,I.put=Ft,I.ac=kt,I.bc=Vt,I.ma=z,O.xa){if((g=li())==null){z=1;break t}if(function(ht,ut){var Tt=[0],bt=[0],pt=[0];e:for(;;){if(ht==null)return 0;if(ut==null)return ht.a=2,0;if(ht.l=ut,ht.a=0,te(ht.m,ut.data,ut.w,ut.ha),!At(ht.m,Tt,bt,pt)){ht.a=3;break e}if(ht.xb=lh,ut.width=Tt[0],ut.height=bt[0],!ji(Tt[0],bt[0],1,ht,null))break e;return 1}return t(ht.a!=0),0}(g,I)){if(I=(b=Wo(I.width,I.height,z.Oa,z.ba))==0){e:{I=g;i:for(;;){if(I==null){I=0;break e}if(t(I.s.yc!=null),t(I.s.Ya!=null),t(0<I.s.Wb),t((E=I.l)!=null),t((O=E.ma)!=null),I.xb!=0){if(I.ca=O.ba,I.tb=O.tb,t(I.ca!=null),!Aa(O.Oa,E,nl)){I.a=2;break i}if(!ur(I,E.width)||E.da)break i;if((E.da||Di(I.ca.S))&&Yt(),11>I.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),I.ca.f.kb.F!=null&&Yt()),I.Pb&&0<I.s.ua&&I.s.vb.X==null&&!Xe(I.s.vb,I.s.Wa.Xa)){I.a=1;break i}I.xb=0}if(!Hi(I,I.V,I.Ba,I.c,I.i,E.o,bi))break i;O.Dc=I.Ma,I=1;break e}t(I.a!=0),I=0}I=!I}I&&(b=g.a)}else b=g.a}else{if((g=new to)==null){z=1;break t}if(g.Fa=O.na,g.P=O.P,g.qc=O.Sa,Ys(g,I)){if((b=Wo(I.width,I.height,z.Oa,z.ba))==0){if(g.Aa=0,E=z.Oa,t((O=g)!=null),E!=null){if(0<(U=0>(U=E.Md)?0:100<U?255:255*U/100)){for(W=at=0;4>W;++W)12>(tt=O.pb[W]).lc&&(tt.ia=U*A[0>tt.lc?0:tt.lc]>>3),at|=tt.ia;at&&(alert("todo:VP8InitRandom"),O.ia=1)}O.Ga=E.Id,100<O.Ga?O.Ga=100:0>O.Ga&&(O.Ga=0)}ds(g,I)||(b=g.a)}}else b=g.a}b==0&&z.Oa!=null&&z.Oa.fd&&(b=Ul(z.ba))}z=b}F=z!=0?null:11>F?V.f.RGBA.eb:V.f.kb.y}else F=null;return F};var R=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function y(xt,qt){for(var zt="",ot=0;ot<4;ot++)zt+=String.fromCharCode(xt[qt++]);return zt}function x(xt,qt){return(xt[qt+0]<<0|xt[qt+1]<<8|xt[qt+2]<<16)>>>0}function T(xt,qt){return(xt[qt+0]<<0|xt[qt+1]<<8|xt[qt+2]<<16|xt[qt+3]<<24)>>>0}new f;var P=[0],M=[0],N=[],G=new f,Z=i,X=function(xt,qt){var zt={},ot=0,dt=!1,Lt=0,wt=0;if(zt.frames=[],!function(Et,It,Ut,Xt){for(var Kt=0;Kt<Xt;Kt++)if(Et[It+Kt]!=Ut.charCodeAt(Kt))return!0;return!1}(xt,qt,"RIFF",4)){var le,oe;for(T(xt,qt+=4),qt+=8;qt<xt.length;){var de=y(xt,qt),te=T(xt,qt+=4);qt+=4;var me=te+(1&te);switch(de){case"VP8 ":case"VP8L":zt.frames[ot]===void 0&&(zt.frames[ot]={}),(it=zt.frames[ot]).src_off=dt?wt:qt-8,it.src_size=Lt+te+8,ot++,dt&&(dt=!1,Lt=0,wt=0);break;case"VP8X":(it=zt.header={}).feature_flags=xt[qt];var ge=qt+4;it.canvas_width=1+x(xt,ge),ge+=3,it.canvas_height=1+x(xt,ge),ge+=3;break;case"ALPH":dt=!0,Lt=me+8,wt=qt-8;break;case"ANIM":(it=zt.header).bgcolor=T(xt,qt),ge=qt+4,it.loop_count=(le=xt)[(oe=ge)+0]<<0|le[oe+1]<<8,ge+=2;break;case"ANMF":var ke,it;(it=zt.frames[ot]={}).offset_x=2*x(xt,qt),qt+=3,it.offset_y=2*x(xt,qt),qt+=3,it.width=1+x(xt,qt),qt+=3,it.height=1+x(xt,qt),qt+=3,it.duration=x(xt,qt),qt+=3,ke=xt[qt++],it.dispose=1&ke,it.blend=ke>>1&1}de!="ANMF"&&(qt+=me)}return zt}}(Z,0);X.response=Z,X.rgbaoutput=!0,X.dataurl=!1;var $=X.header?X.header:null,ct=X.frames?X.frames:null;if($){$.loop_counter=$.loop_count,P=[$.canvas_height],M=[$.canvas_width];for(var yt=0;yt<ct.length&&ct[yt].blend!=0;yt++);}var Mt=ct[0],Nt=G.WebPDecodeRGBA(Z,Mt.src_off,Mt.src_size,M,P);Mt.rgba=Nt,Mt.imgwidth=M[0],Mt.imgheight=P[0];for(var Rt=0;Rt<M[0]*P[0]*4;Rt++)N[Rt]=Nt[Rt];return this.width=M,this.height=P,this.data=N,this}(function(i){var t=function(){return typeof H_=="function"},e=function(P,M,N,G){var Z=4,X=c;switch(G){case i.image_compression.FAST:Z=1,X=n;break;case i.image_compression.MEDIUM:Z=6,X=l;break;case i.image_compression.SLOW:Z=9,X=f}P=r(P,M,N,X);var $=H_(P,{level:Z});return i.__addimage__.arrayBufferToBinaryString($)},r=function(P,M,N,G){for(var Z,X,$,ct=P.length/M,yt=new Uint8Array(P.length+ct),Mt=x(),Nt=0;Nt<ct;Nt+=1){if($=Nt*M,Z=P.subarray($,$+M),G)yt.set(G(Z,N,X),$+Nt);else{for(var Rt,xt=Mt.length,qt=[];Rt<xt;Rt+=1)qt[Rt]=Mt[Rt](Z,N,X);var zt=T(qt.concat());yt.set(qt[zt],$+Nt)}X=Z}return yt},s=function(P){var M=Array.apply([],P);return M.unshift(0),M},n=function(P,M){var N,G=[],Z=P.length;G[0]=1;for(var X=0;X<Z;X+=1)N=P[X-M]||0,G[X+1]=P[X]-N+256&255;return G},c=function(P,M,N){var G,Z=[],X=P.length;Z[0]=2;for(var $=0;$<X;$+=1)G=N&&N[$]||0,Z[$+1]=P[$]-G+256&255;return Z},l=function(P,M,N){var G,Z,X=[],$=P.length;X[0]=3;for(var ct=0;ct<$;ct+=1)G=P[ct-M]||0,Z=N&&N[ct]||0,X[ct+1]=P[ct]+256-(G+Z>>>1)&255;return X},f=function(P,M,N){var G,Z,X,$,ct=[],yt=P.length;ct[0]=4;for(var Mt=0;Mt<yt;Mt+=1)G=P[Mt-M]||0,Z=N&&N[Mt]||0,X=N&&N[Mt-M]||0,$=y(G,Z,X),ct[Mt+1]=P[Mt]-$+256&255;return ct},y=function(P,M,N){if(P===M&&M===N)return P;var G=Math.abs(M-N),Z=Math.abs(P-N),X=Math.abs(P+M-N-N);return G<=Z&&G<=X?P:Z<=X?M:N},x=function(){return[s,n,c,l,f]},T=function(P){var M=P.map(function(N){return N.reduce(function(G,Z){return G+Math.abs(Z)},0)});return M.indexOf(Math.min.apply(null,M))};i.processPNG=function(P,M,N,G){var Z,X,$,ct,yt,Mt,Nt,Rt,xt,qt,zt,ot,dt,Lt,wt,le=this.decode.FLATE_DECODE,oe="";if(this.__addimage__.isArrayBuffer(P)&&(P=new Uint8Array(P)),this.__addimage__.isArrayBufferView(P)){if(P=($=new mV(P)).imgData,X=$.bits,Z=$.colorSpace,yt=$.colors,[4,6].indexOf($.colorType)!==-1){if($.bits===8){xt=(Rt=$.pixelBitlength==32?new Uint32Array($.decodePixels().buffer):$.pixelBitlength==16?new Uint16Array($.decodePixels().buffer):new Uint8Array($.decodePixels().buffer)).length,zt=new Uint8Array(xt*$.colors),qt=new Uint8Array(xt);var de,te=$.pixelBitlength-$.bits;for(Lt=0,wt=0;Lt<xt;Lt++){for(dt=Rt[Lt],de=0;de<te;)zt[wt++]=dt>>>de&255,de+=$.bits;qt[Lt]=dt>>>de&255}}if($.bits===16){xt=(Rt=new Uint32Array($.decodePixels().buffer)).length,zt=new Uint8Array(xt*(32/$.pixelBitlength)*$.colors),qt=new Uint8Array(xt*(32/$.pixelBitlength)),ot=$.colors>1,Lt=0,wt=0;for(var me=0;Lt<xt;)dt=Rt[Lt++],zt[wt++]=dt>>>0&255,ot&&(zt[wt++]=dt>>>16&255,dt=Rt[Lt++],zt[wt++]=dt>>>0&255),qt[me++]=dt>>>16&255;X=8}G!==i.image_compression.NONE&&t()?(P=e(zt,$.width*$.colors,$.colors,G),Nt=e(qt,$.width,1,G)):(P=zt,Nt=qt,le=void 0)}if($.colorType===3&&(Z=this.color_spaces.INDEXED,Mt=$.palette,$.transparency.indexed)){var ge=$.transparency.indexed,ke=0;for(Lt=0,xt=ge.length;Lt<xt;++Lt)ke+=ge[Lt];if((ke/=255)===xt-1&&ge.indexOf(0)!==-1)ct=[ge.indexOf(0)];else if(ke!==xt){for(Rt=$.decodePixels(),qt=new Uint8Array(Rt.length),Lt=0,xt=Rt.length;Lt<xt;Lt++)qt[Lt]=ge[Rt[Lt]];Nt=e(qt,$.width,1)}}var it=function(Et){var It;switch(Et){case i.image_compression.FAST:It=11;break;case i.image_compression.MEDIUM:It=13;break;case i.image_compression.SLOW:It=14;break;default:It=12}return It}(G);return le===this.decode.FLATE_DECODE&&(oe="/Predictor "+it+" "),oe+="/Colors "+yt+" /BitsPerComponent "+X+" /Columns "+$.width,(this.__addimage__.isArrayBuffer(P)||this.__addimage__.isArrayBufferView(P))&&(P=this.__addimage__.arrayBufferToBinaryString(P)),(Nt&&this.__addimage__.isArrayBuffer(Nt)||this.__addimage__.isArrayBufferView(Nt))&&(Nt=this.__addimage__.arrayBufferToBinaryString(Nt)),{alias:N,data:P,index:M,filter:le,decodeParameters:oe,transparency:ct,palette:Mt,sMask:Nt,predictor:it,width:$.width,height:$.height,bitsPerComponent:X,colorSpace:Z}}}})(ki.API),function(i){i.processGIF89A=function(t,e,r,s){var n=new yV(t),c=n.width,l=n.height,f=[];n.decodeAndBlitFrameRGBA(0,f);var y={data:f,width:c,height:l},x=new Uy(100).encode(y,100);return i.processJPEG.call(this,x,e,r,s)},i.processGIF87A=i.processGIF89A}(ki.API),wl.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var t=0;t<i;t++){var e=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:s,green:r,blue:e,quad:n}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},wl.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[i]()}catch(e){Yr.log("bit decode error:"+e)}},wl.prototype.bit1=function(){var i,t=Math.ceil(this.width/8),e=t%4;for(i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,s=0;s<t;s++)for(var n=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+8*s*4,l=0;l<8&&8*s+l<this.width;l++){var f=this.palette[n>>7-l&1];this.data[c+4*l]=f.blue,this.data[c+4*l+1]=f.green,this.data[c+4*l+2]=f.red,this.data[c+4*l+3]=255}e!==0&&(this.pos+=4-e)}},wl.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),t=i%4,e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,s=0;s<i;s++){var n=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+2*s*4,l=n>>4,f=15&n,y=this.palette[l];if(this.data[c]=y.blue,this.data[c+1]=y.green,this.data[c+2]=y.red,this.data[c+3]=255,2*s+1>=this.width)break;y=this.palette[f],this.data[c+4]=y.blue,this.data[c+4+1]=y.green,this.data[c+4+2]=y.red,this.data[c+4+3]=255}t!==0&&(this.pos+=4-t)}},wl.prototype.bit8=function(){for(var i=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var s=this.datav.getUint8(this.pos++,!0),n=e*this.width*4+4*r;if(s<this.palette.length){var c=this.palette[s];this.data[n]=c.red,this.data[n+1]=c.green,this.data[n+2]=c.blue,this.data[n+3]=255}else this.data[n]=255,this.data[n+1]=255,this.data[n+2]=255,this.data[n+3]=255}i!==0&&(this.pos+=4-i)}},wl.prototype.bit15=function(){for(var i=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,s=0;s<this.width;s++){var n=this.datav.getUint16(this.pos,!0);this.pos+=2;var c=(n&t)/t*255|0,l=(n>>5&t)/t*255|0,f=(n>>10&t)/t*255|0,y=n>>15?255:0,x=r*this.width*4+4*s;this.data[x]=f,this.data[x+1]=l,this.data[x+2]=c,this.data[x+3]=y}this.pos+=i}},wl.prototype.bit16=function(){for(var i=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var s=this.bottom_up?r:this.height-1-r,n=0;n<this.width;n++){var c=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(c&t)/t*255|0,f=(c>>5&e)/e*255|0,y=(c>>11)/t*255|0,x=s*this.width*4+4*n;this.data[x]=y,this.data[x+1]=f,this.data[x+2]=l,this.data[x+3]=255}this.pos+=i}},wl.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var t=this.bottom_up?i:this.height-1-i,e=0;e<this.width;e++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),c=t*this.width*4+4*e;this.data[c]=n,this.data[c+1]=s,this.data[c+2]=r,this.data[c+3]=255}this.pos+=this.width%4}},wl.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var t=this.bottom_up?i:this.height-1-i,e=0;e<this.width;e++){var r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*e;this.data[l]=n,this.data[l+1]=s,this.data[l+2]=r,this.data[l+3]=c}},wl.prototype.getData=function(){return this.data},function(i){i.processBMP=function(t,e,r,s){var n=new wl(t,!1),c=n.width,l=n.height,f={data:n.getData(),width:c,height:l},y=new Uy(100).encode(f,100);return i.processJPEG.call(this,y,e,r,s)}}(ki.API),J5.prototype.getData=function(){return this.data},function(i){i.processWEBP=function(t,e,r,s){var n=new J5(t),c=n.width,l=n.height,f={data:n.getData(),width:c,height:l},y=new Uy(100).encode(f,100);return i.processJPEG.call(this,y,e,r,s)}}(ki.API),ki.API.processRGBA=function(i,t,e){for(var r=i.data,s=r.length,n=new Uint8Array(s/4*3),c=new Uint8Array(s/4),l=0,f=0,y=0;y<s;y+=4){var x=r[y],T=r[y+1],P=r[y+2],M=r[y+3];n[l++]=x,n[l++]=T,n[l++]=P,c[f++]=M}var N=this.__addimage__.arrayBufferToBinaryString(n);return{alpha:this.__addimage__.arrayBufferToBinaryString(c),data:N,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},ki.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},fd=ki.API,Tg=fd.getCharWidthsArray=function(i,t){var e,r,s=(t=t||{}).font||this.internal.getFont(),n=t.fontSize||this.internal.getFontSize(),c=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:s.metadata.Unicode.widths,f=l.fof?l.fof:1,y=t.kerning?t.kerning:s.metadata.Unicode.kerning,x=y.fof?y.fof:1,T=t.doKerning!==!1,P=0,M=i.length,N=0,G=l[0]||f,Z=[];for(e=0;e<M;e++)r=i.charCodeAt(e),typeof s.metadata.widthOfString=="function"?Z.push((s.metadata.widthOfGlyph(s.metadata.characterToGlyph(r))+c*(1e3/n)||0)/1e3):(P=T&&Fr(y[r])==="object"&&!isNaN(parseInt(y[r][N],10))?y[r][N]/x:0,Z.push((l[r]||G)/f+P)),N=r;return Z},V5=fd.getStringUnitWidth=function(i,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),s=t.charSpace||this.internal.getCharSpace();return fd.processArabic&&(i=fd.processArabic(i)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(i,e,s)/e:Tg.apply(this,arguments).reduce(function(n,c){return n+c},0)},q5=function(i,t,e,r){for(var s=[],n=0,c=i.length,l=0;n!==c&&l+t[n]<e;)l+=t[n],n++;s.push(i.slice(0,n));var f=n;for(l=0;n!==c;)l+t[n]>r&&(s.push(i.slice(f,n)),l=0,f=n),l+=t[n],n++;return f!==n&&s.push(i.slice(f,n)),s},H5=function(i,t,e){e||(e={});var r,s,n,c,l,f,y,x=[],T=[x],P=e.textIndent||0,M=0,N=0,G=i.split(" "),Z=Tg.apply(this,[" ",e])[0];if(f=e.lineIndent===-1?G[0].length+2:e.lineIndent||0){var X=Array(f).join(" "),$=[];G.map(function(yt){(yt=yt.split(/\s*\n/)).length>1?$=$.concat(yt.map(function(Mt,Nt){return(Nt&&Mt.length?`
`:"")+Mt})):$.push(yt[0])}),G=$,f=V5.apply(this,[X,e])}for(n=0,c=G.length;n<c;n++){var ct=0;if(r=G[n],f&&r[0]==`
`&&(r=r.substr(1),ct=1),P+M+(N=(s=Tg.apply(this,[r,e])).reduce(function(yt,Mt){return yt+Mt},0))>t||ct){if(N>t){for(l=q5.apply(this,[r,s,t-(P+M),t]),x.push(l.shift()),x=[l.pop()];l.length;)T.push([l.shift()]);N=s.slice(r.length-(x[0]?x[0].length:0)).reduce(function(yt,Mt){return yt+Mt},0)}else x=[r];T.push(x),P=N+f,M=Z}else x.push(r),P+=M+N,M=Z}return y=f?function(yt,Mt){return(Mt?X:"")+yt.join(" ")}:function(yt){return yt.join(" ")},T.map(y)},fd.splitTextToSize=function(i,t,e){var r,s=(e=e||{}).fontSize||this.internal.getFontSize(),n=(function(x){if(x.widths&&x.kerning)return{widths:x.widths,kerning:x.kerning};var T=this.internal.getFont(x.fontName,x.fontStyle);return T.metadata.Unicode?{widths:T.metadata.Unicode.widths||{0:1},kerning:T.metadata.Unicode.kerning||{}}:{font:T.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);r=Array.isArray(i)?i:String(i).split(/\r?\n/);var c=1*this.internal.scaleFactor*t/s;n.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/s:0,n.lineIndent=e.lineIndent;var l,f,y=[];for(l=0,f=r.length;l<f;l++)y=y.concat(H5.apply(this,[r[l],c,n]));return y},function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},r={},s=0;s<t.length;s++)e[t[s]]="0123456789abcdef"[s],r["0123456789abcdef"[s]]=t[s];var n=function(T){return"0x"+parseInt(T,10).toString(16)},c=i.__fontmetrics__.compress=function(T){var P,M,N,G,Z=["{"];for(var X in T){if(P=T[X],isNaN(parseInt(X,10))?M="'"+X+"'":(X=parseInt(X,10),M=(M=n(X).slice(2)).slice(0,-1)+r[M.slice(-1)]),typeof P=="number")P<0?(N=n(P).slice(3),G="-"):(N=n(P).slice(2),G=""),N=G+N.slice(0,-1)+r[N.slice(-1)];else{if(Fr(P)!=="object")throw new Error("Don't know what to do with value type "+Fr(P)+".");N=c(P)}Z.push(M+N)}return Z.push("}"),Z.join("")},l=i.__fontmetrics__.uncompress=function(T){if(typeof T!="string")throw new Error("Invalid argument passed to uncompress.");for(var P,M,N,G,Z={},X=1,$=Z,ct=[],yt="",Mt="",Nt=T.length-1,Rt=1;Rt<Nt;Rt+=1)(G=T[Rt])=="'"?P?(N=P.join(""),P=void 0):P=[]:P?P.push(G):G=="{"?(ct.push([$,N]),$={},N=void 0):G=="}"?((M=ct.pop())[0][M[1]]=$,N=void 0,$=M[0]):G=="-"?X=-1:N===void 0?e.hasOwnProperty(G)?(yt+=e[G],N=parseInt(yt,16)*X,X=1,yt=""):yt+=G:e.hasOwnProperty(G)?(Mt+=e[G],$[N]=parseInt(Mt,16)*X,X=1,N=void 0,Mt=""):Mt+=G;return Z},f={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},y={Unicode:{Courier:f,"Courier-Bold":f,"Courier-BoldOblique":f,"Courier-Oblique":f,Helvetica:f,"Helvetica-Bold":f,"Helvetica-BoldOblique":f,"Helvetica-Oblique":f,"Times-Roman":f,"Times-Bold":f,"Times-BoldItalic":f,"Times-Italic":f}},x={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(T){var P=T.font,M=x.Unicode[P.postScriptName];M&&(P.metadata.Unicode={},P.metadata.Unicode.widths=M.widths,P.metadata.Unicode.kerning=M.kerning);var N=y.Unicode[P.postScriptName];N&&(P.metadata.Unicode.encoding=N,P.encoding=N.codePages[0])}])}(ki.API),function(i){var t=function(e){for(var r=e.length,s=new Uint8Array(r),n=0;n<r;n++)s[n]=e.charCodeAt(n);return s};i.API.events.push(["addFont",function(e){var r=void 0,s=e.font,n=e.instance;if(!s.isStandardFont){if(n===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");if(typeof(r=n.existsFileInVFS(s.postScriptName)===!1?n.loadFile(s.postScriptName):n.getFileFromVFS(s.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+s.postScriptName+"').");(function(c,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(Zp(l)),c.metadata=i.API.TTFFont.open(l),c.metadata.Unicode=c.metadata.Unicode||{encoding:{},kerning:{},widths:[]},c.metadata.glyIdsUsed=[0]})(s,r)}}])}(ki),function(i){function t(){return(Oi.canvg?Promise.resolve(Oi.canvg):Jy(()=>import("./index.es-BR8y8uSW-DmctbIix-Dq56SvdI.js"),[])).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}ki.API.addSvgAsImage=function(e,r,s,n,c,l,f,y){if(isNaN(r)||isNaN(s))throw Yr.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(c))throw Yr.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var x=document.createElement("canvas");x.width=n,x.height=c;var T=x.getContext("2d");T.fillStyle="#fff",T.fillRect(0,0,x.width,x.height);var P={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},M=this;return t().then(function(N){return N.fromString(T,e,P)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(N){return N.render(P)}).then(function(){M.addImage(x.toDataURL("image/jpeg",1),r,s,n,c,f,y)})}}(),ki.API.putTotalPages=function(i){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(i,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var s=0;s<this.internal.pages[r].length;s++)this.internal.pages[r][s]=this.internal.pages[r][s].replace(t,e);return this},ki.API.viewerPreferences=function(i,t){var e;i=i||{},t=t||!1;var r,s,n,c={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(c),f=[],y=0,x=0,T=0;function P(N,G){var Z,X=!1;for(Z=0;Z<N.length;Z+=1)N[Z]===G&&(X=!0);return X}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(c)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,i==="reset"||t===!0){var M=l.length;for(T=0;T<M;T+=1)e[l[T]].value=e[l[T]].defaultValue,e[l[T]].explicitSet=!1}if(Fr(i)==="object"){for(s in i)if(n=i[s],P(l,s)&&n!==void 0){if(e[s].type==="boolean"&&typeof n=="boolean")e[s].value=n;else if(e[s].type==="name"&&P(e[s].valueSet,n))e[s].value=n;else if(e[s].type==="integer"&&Number.isInteger(n))e[s].value=n;else if(e[s].type==="array"){for(y=0;y<n.length;y+=1)if(r=!0,n[y].length===1&&typeof n[y][0]=="number")f.push(String(n[y]-1));else if(n[y].length>1){for(x=0;x<n[y].length;x+=1)typeof n[y][x]!="number"&&(r=!1);r===!0&&f.push([n[y][0]-1,n[y][1]-1].join(" "))}e[s].value="["+f.join(" ")+"]"}else e[s].value=e[s].defaultValue;e[s].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var N,G=[];for(N in e)e[N].explicitSet===!0&&(e[N].type==="name"?G.push("/"+N+" /"+e[N].value):G.push("/"+N+" "+e[N].value));G.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+G.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(i){var t=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',s=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(r)),c=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),f=unescape(encodeURIComponent("</x:xmpmeta>")),y=n.length+c.length+l.length+s.length+f.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+y+" >>"),this.internal.write("stream"),this.internal.write(s+n+c+l+f),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(r,s){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:s||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(ki.API),function(i){var t=i.API,e=t.pdfEscape16=function(n,c){for(var l,f=c.metadata.Unicode.widths,y=["","0","00","000","0000"],x=[""],T=0,P=n.length;T<P;++T){if(l=c.metadata.characterToGlyph(n.charCodeAt(T)),c.metadata.glyIdsUsed.push(l),c.metadata.toUnicode[l]=n.charCodeAt(T),f.indexOf(l)==-1&&(f.push(l),f.push([parseInt(c.metadata.widthOfGlyph(l),10)])),l=="0")return x.join("");l=l.toString(16),x.push(y[4-l.length],l)}return x.join("")},r=function(n){var c,l,f,y,x,T,P;for(x=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,f=[],T=0,P=(l=Object.keys(n).sort(function(M,N){return M-N})).length;T<P;T++)c=l[T],f.length>=100&&(x+=`
`+f.length+` beginbfchar
`+f.join(`
`)+`
endbfchar`,f=[]),n[c]!==void 0&&n[c]!==null&&typeof n[c].toString=="function"&&(y=("0000"+n[c].toString(16)).slice(-4),c=("0000"+(+c).toString(16)).slice(-4),f.push("<"+c+"><"+y+">"));return f.length&&(x+=`
`+f.length+` beginbfchar
`+f.join(`
`)+`
endbfchar
`),x+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(n){(function(c){var l=c.font,f=c.out,y=c.newObject,x=c.putStream;if(l.metadata instanceof i.API.TTFFont&&l.encoding==="Identity-H"){for(var T=l.metadata.Unicode.widths,P=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),M="",N=0;N<P.length;N++)M+=String.fromCharCode(P[N]);var G=y();x({data:M,addLength1:!0,objectId:G}),f("endobj");var Z=y();x({data:r(l.metadata.toUnicode),addLength1:!0,objectId:Z}),f("endobj");var X=y();f("<<"),f("/Type /FontDescriptor"),f("/FontName /"+_d(l.fontName)),f("/FontFile2 "+G+" 0 R"),f("/FontBBox "+i.API.PDFObject.convert(l.metadata.bbox)),f("/Flags "+l.metadata.flags),f("/StemV "+l.metadata.stemV),f("/ItalicAngle "+l.metadata.italicAngle),f("/Ascent "+l.metadata.ascender),f("/Descent "+l.metadata.decender),f("/CapHeight "+l.metadata.capHeight),f(">>"),f("endobj");var $=y();f("<<"),f("/Type /Font"),f("/BaseFont /"+_d(l.fontName)),f("/FontDescriptor "+X+" 0 R"),f("/W "+i.API.PDFObject.convert(T)),f("/CIDToGIDMap /Identity"),f("/DW 1000"),f("/Subtype /CIDFontType2"),f("/CIDSystemInfo"),f("<<"),f("/Supplement 0"),f("/Registry (Adobe)"),f("/Ordering ("+l.encoding+")"),f(">>"),f(">>"),f("endobj"),l.objectNumber=y(),f("<<"),f("/Type /Font"),f("/Subtype /Type0"),f("/ToUnicode "+Z+" 0 R"),f("/BaseFont /"+_d(l.fontName)),f("/Encoding /"+l.encoding),f("/DescendantFonts ["+$+" 0 R]"),f(">>"),f("endobj"),l.isAlreadyPutted=!0}})(n)}]),t.events.push(["putFont",function(n){(function(c){var l=c.font,f=c.out,y=c.newObject,x=c.putStream;if(l.metadata instanceof i.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var T=l.metadata.rawData,P="",M=0;M<T.length;M++)P+=String.fromCharCode(T[M]);var N=y();x({data:P,addLength1:!0,objectId:N}),f("endobj");var G=y();x({data:r(l.metadata.toUnicode),addLength1:!0,objectId:G}),f("endobj");var Z=y();f("<<"),f("/Descent "+l.metadata.decender),f("/CapHeight "+l.metadata.capHeight),f("/StemV "+l.metadata.stemV),f("/Type /FontDescriptor"),f("/FontFile2 "+N+" 0 R"),f("/Flags 96"),f("/FontBBox "+i.API.PDFObject.convert(l.metadata.bbox)),f("/FontName /"+_d(l.fontName)),f("/ItalicAngle "+l.metadata.italicAngle),f("/Ascent "+l.metadata.ascender),f(">>"),f("endobj"),l.objectNumber=y();for(var X=0;X<l.metadata.hmtx.widths.length;X++)l.metadata.hmtx.widths[X]=parseInt(l.metadata.hmtx.widths[X]*(1e3/l.metadata.head.unitsPerEm));f("<</Subtype/TrueType/Type/Font/ToUnicode "+G+" 0 R/BaseFont/"+_d(l.fontName)+"/FontDescriptor "+Z+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),f("endobj"),l.isAlreadyPutted=!0}})(n)}]);var s=function(n){var c,l=n.text||"",f=n.x,y=n.y,x=n.options||{},T=n.mutex||{},P=T.pdfEscape,M=T.activeFontKey,N=T.fonts,G=M,Z="",X=0,$="",ct=N[G].encoding;if(N[G].encoding!=="Identity-H")return{text:l,x:f,y,options:x,mutex:T};for($=l,G=M,Array.isArray(l)&&($=l[0]),X=0;X<$.length;X+=1)N[G].metadata.hasOwnProperty("cmap")&&(c=N[G].metadata.cmap.unicode.codeMap[$[X].charCodeAt(0)]),c||$[X].charCodeAt(0)<256&&N[G].metadata.hasOwnProperty("Unicode")?Z+=$[X]:Z+="";var yt="";return parseInt(G.slice(1))<14||ct==="WinAnsiEncoding"?yt=P(Z,G).split("").map(function(Mt){return Mt.charCodeAt(0).toString(16)}).join(""):ct==="Identity-H"&&(yt=e(Z,N[G])),T.isHex=!0,{text:yt,x:f,y,options:x,mutex:T}};t.events.push(["postProcessText",function(n){var c=n.text||"",l=[],f={text:c,x:n.x,y:n.y,options:n.options,mutex:n.mutex};if(Array.isArray(c)){var y=0;for(y=0;y<c.length;y+=1)Array.isArray(c[y])&&c[y].length===3?l.push([s(Object.assign({},f,{text:c[y][0]})).text,c[y][1],c[y][2]]):l.push(s(Object.assign({},f,{text:c[y]})).text);n.text=l}else n.text=s(Object.assign({},f,{text:c})).text}])}(ki),function(i){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},i.addFileToVFS=function(e,r){return t.call(this),this.internal.vFS[e]=r,this},i.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(ki.API),function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(r){var s,n,c,l,f,y,x,T=t,P=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],M=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],N={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},G={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},Z=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],X=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),$=!1,ct=0;this.__bidiEngine__={};var yt=function(ot){var dt=ot.charCodeAt(),Lt=dt>>8,wt=G[Lt];return wt!==void 0?T[256*wt+(255&dt)]:Lt===252||Lt===253?"AL":X.test(Lt)?"L":Lt===8?"R":"N"},Mt=function(ot){for(var dt,Lt=0;Lt<ot.length;Lt++){if((dt=yt(ot.charAt(Lt)))==="L")return!1;if(dt==="R")return!0}return!1},Nt=function(ot,dt,Lt,wt){var le,oe,de,te,me=dt[wt];switch(me){case"L":case"R":$=!1;break;case"N":case"AN":break;case"EN":$&&(me="AN");break;case"AL":$=!0,me="R";break;case"WS":me="N";break;case"CS":wt<1||wt+1>=dt.length||(le=Lt[wt-1])!=="EN"&&le!=="AN"||(oe=dt[wt+1])!=="EN"&&oe!=="AN"?me="N":$&&(oe="AN"),me=oe===le?oe:"N";break;case"ES":me=(le=wt>0?Lt[wt-1]:"B")==="EN"&&wt+1<dt.length&&dt[wt+1]==="EN"?"EN":"N";break;case"ET":if(wt>0&&Lt[wt-1]==="EN"){me="EN";break}if($){me="N";break}for(de=wt+1,te=dt.length;de<te&&dt[de]==="ET";)de++;me=de<te&&dt[de]==="EN"?"EN":"N";break;case"NSM":if(c&&!l){for(te=dt.length,de=wt+1;de<te&&dt[de]==="NSM";)de++;if(de<te){var ge=ot[wt],ke=ge>=1425&&ge<=2303||ge===64286;if(le=dt[de],ke&&(le==="R"||le==="AL")){me="R";break}}}me=wt<1||(le=dt[wt-1])==="B"?"N":Lt[wt-1];break;case"B":$=!1,s=!0,me=ct;break;case"S":n=!0,me="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":$=!1;break;case"BN":me="N"}return me},Rt=function(ot,dt,Lt){var wt=ot.split("");return Lt&&xt(wt,Lt,{hiLevel:ct}),wt.reverse(),dt&&dt.reverse(),wt.join("")},xt=function(ot,dt,Lt){var wt,le,oe,de,te,me=-1,ge=ot.length,ke=0,it=[],Et=ct?M:P,It=[];for($=!1,s=!1,n=!1,le=0;le<ge;le++)It[le]=yt(ot[le]);for(oe=0;oe<ge;oe++){if(te=ke,it[oe]=Nt(ot,It,it,oe),wt=240&(ke=Et[te][N[it[oe]]]),ke&=15,dt[oe]=de=Et[ke][5],wt>0)if(wt===16){for(le=me;le<oe;le++)dt[le]=1;me=-1}else me=-1;if(Et[ke][6])me===-1&&(me=oe);else if(me>-1){for(le=me;le<oe;le++)dt[le]=de;me=-1}It[oe]==="B"&&(dt[oe]=0),Lt.hiLevel|=de}n&&function(Ut,Xt,Kt){for(var ie=0;ie<Kt;ie++)if(Ut[ie]==="S"){Xt[ie]=ct;for(var Qt=ie-1;Qt>=0&&Ut[Qt]==="WS";Qt--)Xt[Qt]=ct}}(It,dt,ge)},qt=function(ot,dt,Lt,wt,le){if(!(le.hiLevel<ot)){if(ot===1&&ct===1&&!s)return dt.reverse(),void(Lt&&Lt.reverse());for(var oe,de,te,me,ge=dt.length,ke=0;ke<ge;){if(wt[ke]>=ot){for(te=ke+1;te<ge&&wt[te]>=ot;)te++;for(me=ke,de=te-1;me<de;me++,de--)oe=dt[me],dt[me]=dt[de],dt[de]=oe,Lt&&(oe=Lt[me],Lt[me]=Lt[de],Lt[de]=oe);ke=te}ke++}}},zt=function(ot,dt,Lt){var wt=ot.split(""),le={hiLevel:ct};return Lt||(Lt=[]),xt(wt,Lt,le),function(oe,de,te){if(te.hiLevel!==0&&x)for(var me,ge=0;ge<oe.length;ge++)de[ge]===1&&(me=Z.indexOf(oe[ge]))>=0&&(oe[ge]=Z[me+1])}(wt,Lt,le),qt(2,wt,dt,Lt,le),qt(1,wt,dt,Lt,le),wt.join("")};return this.__bidiEngine__.doBidiReorder=function(ot,dt,Lt){if(function(le,oe){if(oe)for(var de=0;de<le.length;de++)oe[de]=de;l===void 0&&(l=Mt(le)),y===void 0&&(y=Mt(le))}(ot,dt),c||!f||y)if(c&&f&&l^y)ct=l?1:0,ot=Rt(ot,dt,Lt);else if(!c&&f&&y)ct=l?1:0,ot=zt(ot,dt,Lt),ot=Rt(ot,dt);else if(!c||l||f||y){if(c&&!f&&l^y)ot=Rt(ot,dt),l?(ct=0,ot=zt(ot,dt,Lt)):(ct=1,ot=zt(ot,dt,Lt),ot=Rt(ot,dt));else if(c&&l&&!f&&y)ct=1,ot=zt(ot,dt,Lt),ot=Rt(ot,dt);else if(!c&&!f&&l^y){var wt=x;l?(ct=1,ot=zt(ot,dt,Lt),ct=0,x=!1,ot=zt(ot,dt,Lt),x=wt):(ct=0,ot=zt(ot,dt,Lt),ot=Rt(ot,dt),ct=1,x=!1,ot=zt(ot,dt,Lt),x=wt,ot=Rt(ot,dt))}}else ct=0,ot=zt(ot,dt,Lt);else ct=l?1:0,ot=zt(ot,dt,Lt);return ot},this.__bidiEngine__.setOptions=function(ot){ot&&(c=ot.isInputVisual,f=ot.isOutputVisual,l=ot.isInputRtl,y=ot.isOutputRtl,x=ot.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(r){var s=r.text,n=(r.x,r.y,r.options||{}),c=(r.mutex,n.lang,[]);if(n.isInputVisual=typeof n.isInputVisual!="boolean"||n.isInputVisual,e.setOptions(n),Object.prototype.toString.call(s)==="[object Array]"){var l=0;for(c=[],l=0;l<s.length;l+=1)Object.prototype.toString.call(s[l])==="[object Array]"?c.push([e.doBidiReorder(s[l][0]),s[l][1],s[l][2]]):c.push([e.doBidiReorder(s[l])]);r.text=c}else r.text=e.doBidiReorder(s);e.setOptions({isInputVisual:!0})}])}(ki),ki.API.TTFFont=function(){function i(t){var e;if(this.rawData=t,e=this.contents=new Wh(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new BV(this),this.registerTTF()}return i.open=function(t){return new i(t)},i.prototype.parse=function(){return this.directory=new _V(this.contents),this.head=new bV(this),this.name=new EV(this),this.cmap=new TE(this),this.toUnicode={},this.hhea=new wV(this),this.maxp=new CV(this),this.hmtx=new TV(this),this.post=new AV(this),this.os2=new xV(this),this.loca=new LV(this),this.glyf=new PV(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var t,e,r,s,n;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var c,l,f,y;for(y=[],c=0,l=(f=this.bbox).length;c<l;c++)t=f[c],y.push(Math.round(t*this.scaleFactor));return y}).call(this),this.stemV=0,this.post.exists?(r=255&(s=this.post.italic_angle),32768&(e=s>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(n=this.familyClass)===1||n===2||n===3||n===4||n===5||n===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},i.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},i.prototype.widthOfString=function(t,e,r){var s,n,c,l;for(c=0,n=0,l=(t=""+t).length;0<=l?n<l:n>l;n=0<=l?++n:--n)s=t.charCodeAt(n),c+=this.widthOfGlyph(this.characterToGlyph(s))+r*(1e3/e)||0;return c*(e/1e3)},i.prototype.lineHeight=function(t,e){var r;return e==null&&(e=!1),r=e?this.lineGap:0,(this.ascender+r-this.decender)/1e3*t},i}();var Rl,Wh=function(){function i(t){this.data=t??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(t){return this.data[this.pos++]=t},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},i.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},i.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},i.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},i.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},i.prototype.readString=function(t){var e,r;for(r=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)r[e]=String.fromCharCode(this.readByte());return r.join("")},i.prototype.writeString=function(t){var e,r,s;for(s=[],e=0,r=t.length;0<=r?e<r:e>r;e=0<=r?++e:--e)s.push(this.writeByte(t.charCodeAt(e)));return s},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(t){return this.writeInt16(t)},i.prototype.readLongLong=function(){var t,e,r,s,n,c,l,f;return t=this.readByte(),e=this.readByte(),r=this.readByte(),s=this.readByte(),n=this.readByte(),c=this.readByte(),l=this.readByte(),f=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^r)+4294967296*(255^s)+16777216*(255^n)+65536*(255^c)+256*(255^l)+(255^f)+1):72057594037927940*t+281474976710656*e+1099511627776*r+4294967296*s+16777216*n+65536*c+256*l+f},i.prototype.writeLongLong=function(t){var e,r;return e=Math.floor(t/4294967296),r=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(t){return this.writeInt32(t)},i.prototype.read=function(t){var e,r;for(e=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)e.push(this.readByte());return e},i.prototype.write=function(t){var e,r,s,n;for(n=[],r=0,s=t.length;r<s;r++)e=t[r],n.push(this.writeByte(e));return n},i}(),_V=function(){var i;function t(e){var r,s,n;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},s=0,n=this.tableCount;0<=n?s<n:s>n;s=0<=n?++s:--s)r={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[r.tag]=r}return t.prototype.encode=function(e){var r,s,n,c,l,f,y,x,T,P,M,N,G;for(G in M=Object.keys(e).length,f=Math.log(2),T=16*Math.floor(Math.log(M)/f),c=Math.floor(T/f),x=16*M-T,(s=new Wh).writeInt(this.scalarType),s.writeShort(M),s.writeShort(T),s.writeShort(c),s.writeShort(x),n=16*M,y=s.pos+n,l=null,N=[],e)for(P=e[G],s.writeString(G),s.writeInt(i(P)),s.writeInt(y),s.writeInt(P.length),N=N.concat(P),G==="head"&&(l=y),y+=P.length;y%4;)N.push(0),y++;return s.write(N),r=2981146554-i(s.data),s.pos=l+8,s.writeUInt32(r),s.data},i=function(e){var r,s,n,c;for(e=PE.call(e);e.length%4;)e.push(0);for(n=new Wh(e),s=0,r=0,c=e.length;r<c;r=r+=4)s+=n.readUInt32();return 4294967295&s},t}(),vV={}.hasOwnProperty,pc=function(i,t){for(var e in t)vV.call(t,e)&&(i[e]=t[e]);function r(){this.constructor=i}return r.prototype=t.prototype,i.prototype=new r,i.__super__=t.prototype,i};Rl=function(){function i(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i}();var bV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var r;return(r=new Wh).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(e),r.writeShort(this.glyphDataFormat),r.data},t}(),Z5=function(){function i(t,e){var r,s,n,c,l,f,y,x,T,P,M,N,G,Z,X,$,ct;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),T=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(f=0;f<256;++f)this.codeMap[f]=t.readByte();break;case 4:for(M=t.readUInt16(),P=M/2,t.pos+=6,n=function(){var yt,Mt;for(Mt=[],f=yt=0;0<=P?yt<P:yt>P;f=0<=P?++yt:--yt)Mt.push(t.readUInt16());return Mt}(),t.pos+=2,G=function(){var yt,Mt;for(Mt=[],f=yt=0;0<=P?yt<P:yt>P;f=0<=P?++yt:--yt)Mt.push(t.readUInt16());return Mt}(),y=function(){var yt,Mt;for(Mt=[],f=yt=0;0<=P?yt<P:yt>P;f=0<=P?++yt:--yt)Mt.push(t.readUInt16());return Mt}(),x=function(){var yt,Mt;for(Mt=[],f=yt=0;0<=P?yt<P:yt>P;f=0<=P?++yt:--yt)Mt.push(t.readUInt16());return Mt}(),s=(this.length-t.pos+this.offset)/2,l=function(){var yt,Mt;for(Mt=[],f=yt=0;0<=s?yt<s:yt>s;f=0<=s?++yt:--yt)Mt.push(t.readUInt16());return Mt}(),f=X=0,ct=n.length;X<ct;f=++X)for(Z=n[f],r=$=N=G[f];N<=Z?$<=Z:$>=Z;r=N<=Z?++$:--$)x[f]===0?c=r+y[f]:(c=l[x[f]/2+(r-N)-(P-f)]||0)!==0&&(c+=y[f]),this.codeMap[r]=65535&c}t.pos=T}return i.encode=function(t,e){var r,s,n,c,l,f,y,x,T,P,M,N,G,Z,X,$,ct,yt,Mt,Nt,Rt,xt,qt,zt,ot,dt,Lt,wt,le,oe,de,te,me,ge,ke,it,Et,It,Ut,Xt,Kt,ie,Qt,Ae,Le,Fe;switch(wt=new Wh,c=Object.keys(t).sort(function(Ge,Xe){return Ge-Xe}),e){case"macroman":for(G=0,Z=function(){var Ge=[];for(N=0;N<256;++N)Ge.push(0);return Ge}(),$={0:0},n={},le=0,me=c.length;le<me;le++)$[Qt=t[s=c[le]]]==null&&($[Qt]=++G),n[s]={old:t[s],new:$[t[s]]},Z[s]=$[t[s]];return wt.writeUInt16(1),wt.writeUInt16(0),wt.writeUInt32(12),wt.writeUInt16(0),wt.writeUInt16(262),wt.writeUInt16(0),wt.write(Z),{charMap:n,subtable:wt.data,maxGlyphID:G+1};case"unicode":for(dt=[],T=[],ct=0,$={},r={},X=y=null,oe=0,ge=c.length;oe<ge;oe++)$[Mt=t[s=c[oe]]]==null&&($[Mt]=++ct),r[s]={old:Mt,new:$[Mt]},l=$[Mt]-s,X!=null&&l===y||(X&&T.push(X),dt.push(s),y=l),X=s;for(X&&T.push(X),T.push(65535),dt.push(65535),zt=2*(qt=dt.length),xt=2*Math.pow(Math.log(qt)/Math.LN2,2),P=Math.log(xt/2)/Math.LN2,Rt=2*qt-xt,f=[],Nt=[],M=[],N=de=0,ke=dt.length;de<ke;N=++de){if(ot=dt[N],x=T[N],ot===65535){f.push(0),Nt.push(0);break}if(ot-(Lt=r[ot].new)>=32768)for(f.push(0),Nt.push(2*(M.length+qt-N)),s=te=ot;ot<=x?te<=x:te>=x;s=ot<=x?++te:--te)M.push(r[s].new);else f.push(Lt-ot),Nt.push(0)}for(wt.writeUInt16(3),wt.writeUInt16(1),wt.writeUInt32(12),wt.writeUInt16(4),wt.writeUInt16(16+8*qt+2*M.length),wt.writeUInt16(0),wt.writeUInt16(zt),wt.writeUInt16(xt),wt.writeUInt16(P),wt.writeUInt16(Rt),Kt=0,it=T.length;Kt<it;Kt++)s=T[Kt],wt.writeUInt16(s);for(wt.writeUInt16(0),ie=0,Et=dt.length;ie<Et;ie++)s=dt[ie],wt.writeUInt16(s);for(Ae=0,It=f.length;Ae<It;Ae++)l=f[Ae],wt.writeUInt16(l);for(Le=0,Ut=Nt.length;Le<Ut;Le++)yt=Nt[Le],wt.writeUInt16(yt);for(Fe=0,Xt=M.length;Fe<Xt;Fe++)G=M[Fe],wt.writeUInt16(G);return{charMap:r,subtable:wt.data,maxGlyphID:ct+1}}},i}(),TE=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="cmap",t.prototype.parse=function(e){var r,s,n;for(e.pos=this.offset,this.version=e.readUInt16(),n=e.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)r=new Z5(e,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},t.encode=function(e,r){var s,n;return r==null&&(r="macroman"),s=Z5.encode(e,r),(n=new Wh).writeUInt16(0),n.writeUInt16(1),s.table=n.data.concat(s.subtable),s},t}(),wV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),xV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var r,s;for(s=[],r=0;r<10;++r)s.push(e.readByte());return s}(),this.charRange=function(){var r,s;for(s=[],r=0;r<4;++r)s.push(e.readInt());return s}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var r,s;for(s=[],r=0;r<2;r=++r)s.push(e.readInt());return s}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),AV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="post",t.prototype.parse=function(e){var r,s,n;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var c;for(s=e.readUInt16(),this.glyphNameIndex=[],c=0;0<=s?c<s:c>s;c=0<=s?++c:--c)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],n=[];e.pos<this.offset+this.length;)r=e.readByte(),n.push(this.names.push(e.readString(r)));return n;case 151552:return s=e.readUInt16(),this.offsets=e.read(s);case 196608:break;case 262144:return this.map=(function(){var l,f,y;for(y=[],c=l=0,f=this.file.maxp.numGlyphs;0<=f?l<f:l>f;c=0<=f?++l:--l)y.push(e.readUInt32());return y}).call(this)}},t}(),SV=function(i,t){this.raw=i,this.length=i.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},EV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="name",t.prototype.parse=function(e){var r,s,n,c,l,f,y,x,T,P,M;for(e.pos=this.offset,e.readShort(),r=e.readShort(),f=e.readShort(),s=[],c=0;0<=r?c<r:c>r;c=0<=r?++c:--c)s.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+f+e.readShort()});for(y={},c=T=0,P=s.length;T<P;c=++T)n=s[c],e.pos=n.offset,x=e.readString(n.length),l=new SV(x,n),y[M=n.nameID]==null&&(y[M]=[]),y[n.nameID].push(l);this.strings=y,this.copyright=y[0],this.fontFamily=y[1],this.fontSubfamily=y[2],this.uniqueSubfamily=y[3],this.fontName=y[4],this.version=y[5];try{this.postscriptName=y[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=y[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=y[7],this.manufacturer=y[8],this.designer=y[9],this.description=y[10],this.vendorUrl=y[11],this.designerUrl=y[12],this.license=y[13],this.licenseUrl=y[14],this.preferredFamily=y[15],this.preferredSubfamily=y[17],this.compatibleFull=y[18],this.sampleText=y[19]},t}(),CV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),TV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="hmtx",t.prototype.parse=function(e){var r,s,n,c,l,f,y;for(e.pos=this.offset,this.metrics=[],r=0,f=this.file.hhea.numberOfMetrics;0<=f?r<f:r>f;r=0<=f?++r:--r)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(n=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var x,T;for(T=[],r=x=0;0<=n?x<n:x>n;r=0<=n?++x:--x)T.push(e.readInt16());return T}(),this.widths=(function(){var x,T,P,M;for(M=[],x=0,T=(P=this.metrics).length;x<T;x++)c=P[x],M.push(c.advance);return M}).call(this),s=this.widths[this.widths.length-1],y=[],r=l=0;0<=n?l<n:l>n;r=0<=n?++l:--l)y.push(this.widths.push(s));return y},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),PE=[].slice,PV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var r,s,n,c,l,f,y,x,T,P;return e in this.cache?this.cache[e]:(c=this.file.loca,r=this.file.contents,s=c.indexOf(e),(n=c.lengthOf(e))===0?this.cache[e]=null:(r.pos=this.offset+s,l=(f=new Wh(r.read(n))).readShort(),x=f.readShort(),P=f.readShort(),y=f.readShort(),T=f.readShort(),this.cache[e]=l===-1?new MV(f,x,P,y,T):new IV(f,l,x,P,y,T),this.cache[e]))},t.prototype.encode=function(e,r,s){var n,c,l,f,y;for(l=[],c=[],f=0,y=r.length;f<y;f++)n=e[r[f]],c.push(l.length),n&&(l=l.concat(n.encode(s)));return c.push(l.length),{table:l,offsets:c}},t}(),IV=function(){function i(t,e,r,s,n,c){this.raw=t,this.numberOfContours=e,this.xMin=r,this.yMin=s,this.xMax=n,this.yMax=c,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i}(),MV=function(){function i(t,e,r,s,n){var c,l;for(this.raw=t,this.xMin=e,this.yMin=r,this.xMax=s,this.yMax=n,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],c=this.raw;l=c.readShort(),this.glyphOffsets.push(c.pos),this.glyphIDs.push(c.readUInt16()),32&l;)c.pos+=1&l?4:2,128&l?c.pos+=8:64&l?c.pos+=4:8&l&&(c.pos+=2)}return i.prototype.encode=function(){var t,e,r;for(e=new Wh(PE.call(this.raw.data)),t=0,r=this.glyphIDs.length;t<r;++t)e.pos=this.glyphOffsets[t];return e.data},i}(),LV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return pc(t,Rl),t.prototype.tag="loca",t.prototype.parse=function(e){var r,s;return e.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var n,c;for(c=[],s=0,n=this.length;s<n;s+=2)c.push(2*e.readUInt16());return c}).call(this):(function(){var n,c;for(c=[],s=0,n=this.length;s<n;s+=4)c.push(e.readUInt32());return c}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,r){for(var s=new Uint32Array(this.offsets.length),n=0,c=0,l=0;l<s.length;++l)if(s[l]=n,c<r.length&&r[c]==l){++c,s[l]=n;var f=this.offsets[l],y=this.offsets[l+1]-f;y>0&&(n+=y)}for(var x=new Array(4*s.length),T=0;T<s.length;++T)x[4*T+3]=255&s[T],x[4*T+2]=(65280&s[T])>>8,x[4*T+1]=(16711680&s[T])>>16,x[4*T]=(4278190080&s[T])>>24;return x},t}(),BV=function(){function i(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var t,e,r,s,n;for(e in s=this.font.cmap.tables[0].codeMap,t={},n=this.subset)r=n[e],t[e]=s[r];return t},i.prototype.glyphsFor=function(t){var e,r,s,n,c,l,f;for(s={},c=0,l=t.length;c<l;c++)s[n=t[c]]=this.font.glyf.glyphFor(n);for(n in e=[],s)(r=s[n])!=null&&r.compound&&e.push.apply(e,r.glyphIDs);if(e.length>0)for(n in f=this.glyphsFor(e))r=f[n],s[n]=r;return s},i.prototype.encode=function(t,e){var r,s,n,c,l,f,y,x,T,P,M,N,G,Z,X;for(s in r=TE.encode(this.generateCmap(),"unicode"),c=this.glyphsFor(t),M={0:0},X=r.charMap)M[(f=X[s]).old]=f.new;for(N in P=r.maxGlyphID,c)N in M||(M[N]=P++);return x=function($){var ct,yt;for(ct in yt={},$)yt[$[ct]]=ct;return yt}(M),T=Object.keys(x).sort(function($,ct){return $-ct}),G=function(){var $,ct,yt;for(yt=[],$=0,ct=T.length;$<ct;$++)l=T[$],yt.push(x[l]);return yt}(),n=this.font.glyf.encode(c,G,M),y=this.font.loca.encode(n.offsets,G),Z={cmap:this.font.cmap.raw(),glyf:n.table,loca:y,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(Z["OS/2"]=this.font.os2.raw()),this.font.directory.encode(Z)},i}();ki.API.PDFObject=function(){var i;function t(){}return i=function(e,r){return(Array(r+1).join("0")+e).slice(-r)},t.convert=function(e){var r,s,n,c;if(Array.isArray(e))return"["+function(){var l,f,y;for(y=[],l=0,f=e.length;l<f;l++)r=e[l],y.push(t.convert(r));return y}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+i(e.getUTCFullYear(),4)+i(e.getUTCMonth(),2)+i(e.getUTCDate(),2)+i(e.getUTCHours(),2)+i(e.getUTCMinutes(),2)+i(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(s in n=["<<"],e)c=e[s],n.push("/"+s+" "+t.convert(c));return n.push(">>"),n.join(`
`)}return""+e},t}();const Tv={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"};class RV{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Eu.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Vc.PNG,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hd.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",f=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Tv;Br(this,"map"),Br(this,"width"),Br(this,"height"),Br(this,"dpi"),Br(this,"format"),Br(this,"unit"),Br(this,"fileName"),Br(this,"markerClassName"),Br(this,"markerCirclePaint"),this.map=t,this.width=e[0],this.height=e[1],this.dpi=r,this.format=s,this.unit=n,this.fileName=c,this.markerClassName=l,this.markerCirclePaint=f}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const e=this.getMarkers();for(let r=0;r<e.length;r++){const s=e.item(r);if(!s)continue;const n=s.getAttribute("style");if(!n)continue;const c=/translate\(([^,]+)px,\s*([^,]+)px\)/,l=n.match(c);if(!l)continue;const f=parseInt(l[1]),y=parseInt(l[2]),x=this.map.unproject([f,y]),T=`point${r}`;t.addSource(T,{type:"geojson",data:{type:"Point",coordinates:[x.lng,x.lat]}}),t.addLayer({id:T,source:T,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const e=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const r=document.createElement("div");r.className="hidden-map",document.body.appendChild(r);const s=document.createElement("div");s.style.width=this.toPixels(this.width),s.style.height=this.toPixels(this.height),r.appendChild(s);const n=this.map.getStyle();if(n&&n.sources){const l=n.sources;Object.keys(l).forEach(f=>{const y=l[f];Object.keys(y).forEach(x=>{y[x]||delete y[x]})})}let c=this.getRenderedMap(s,n);c.once("idle",()=>{c=this.renderMapPost(c),this.getMarkers().length===0?this.exportImage(c,r,e):(c=this.renderMarkers(c),c.once("idle",()=>{this.exportImage(c,r,e)}))})}exportImage(t,e,r){var s;const n=t.getCanvas(),c=`${this.fileName}.${this.format}`;switch(this.format){case Vc.PNG:this.toPNG(n,c);break;case Vc.JPEG:this.toJPEG(n,c);break;case Vc.PDF:this.toPDF(t,c);break;case Vc.SVG:this.toSVG(n,c);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(s=e.parentNode)==null||s.removeChild(e),Object.defineProperty(window,"devicePixelRatio",{get(){return r}}),e.remove(),JsLoadingOverlay.hide()}toPNG(t,e){const r=document.createElement("a");r.href=t.toDataURL(),r.download=e,r.click(),r.remove()}toJPEG(t,e){const r=t.toDataURL("image/jpeg",.85),s=document.createElement("a");s.href=r,s.download=e,s.click(),s.remove()}toPDF(t,e){const r=t.getCanvas(),s=new ki({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});s.addImage(r.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:n,lat:c}=t.getCenter();s.setProperties({title:t.getStyle().name,subject:`center: [${n}, ${c}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),s.save(e)}toSVG(t,e){const r=t.toDataURL("image/png"),s=Number(this.toPixels(this.width,this.dpi).replace("px","")),n=Number(this.toPixels(this.height,this.dpi).replace("px","")),c=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${s}" 
      height="${n}" 
      viewBox="0 0 ${s} ${n}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${r}" width="${s}" height="${n}"></image>
    </svg>`,l=document.createElement("a");l.href=`data:application/xml,${encodeURIComponent(c)}`,l.download=e,l.click(),l.remove()}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===Hd.mm&&(e/=25.4),`${e*t}px`}}class kV extends RV{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Eu.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Vc.PNG,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hd.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Tv;super(t,e,r,s,n,c,"maplibregl-marker",l)}getRenderedMap(t,e){const r=new fA.Map({container:t,style:e,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(r.setMaxPitch(85),r.setPitch(this.map.getPitch()));const s=(this.map.style.imageManager||{}).images||[];return Object.keys(s).forEach(n=>{r.addImage(n,s[n].data)}),r}renderMapPost(t){const e=this.map.getTerrain();return e&&t.setTerrain({source:e.source,exaggeration:e.exaggeration}),t}}class OV{constructor(t){Br(this,"controlContainer"),Br(this,"exportContainer"),Br(this,"crosshair"),Br(this,"printableArea"),Br(this,"map"),Br(this,"exportButton"),Br(this,"options",{PageSize:Eu.A4,PageOrientation:zp.Landscape,Format:Vc.PDF,DPI:j_[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Eu),Filename:"map",markerCirclePaint:Tv}),Br(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return OG(t)}onAdd(t){var e;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const r=document.createElement("TABLE");r.className="print-table";const s={};(e=this.options.AllowedSizes)==null||e.forEach(x=>{Eu[x]&&(s[x]=Eu[x])});const n=this.createSelection(s,this.getTranslation().PageSize,"page-size",this.options.PageSize,(x,T)=>JSON.stringify(x[T]));r.appendChild(n);const c=this.createSelection(zp,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(x,T)=>x[T]);r.appendChild(c);const l=this.createSelection(Vc,this.getTranslation().Format,"format-type",this.options.Format,(x,T)=>x[T]);r.appendChild(l);const f=this.createSelection(j_,this.getTranslation().DPI,"dpi-type",this.options.DPI,(x,T)=>x[T]);r.appendChild(f),this.exportContainer.appendChild(r);const y=document.createElement("button");return y.type="button",y.textContent=this.getTranslation().Generate,y.classList.add("generate-button"),y.addEventListener("click",()=>{const x=document.getElementById("mapbox-gl-export-page-size"),T=document.getElementById("mapbox-gl-export-page-orientation"),P=document.getElementById("mapbox-gl-export-format-type"),M=document.getElementById("mapbox-gl-export-dpi-type"),N=T.value;let G=JSON.parse(x.value);N===zp.Portrait&&(G=G.reverse()),this.generateMap(t,G,Number(M.value),P.value,Hd.mm,this.options.Filename)}),this.exportContainer.appendChild(y),this.controlContainer}generateMap(t,e,r,s,n,c){new kV(t,e,r,s,n,c,this.options.markerCirclePaint).generate()}createSelection(t,e,r,s,n){const c=document.createElement("label");c.textContent=e;const l=document.createElement("select");l.setAttribute("id",`mapbox-gl-export-${r}`),l.style.width="100%",Object.keys(t).forEach(T=>{const P=document.createElement("option");P.setAttribute("value",n(t,T)),P.appendChild(document.createTextNode(T)),P.setAttribute("name",r),s===t[T]&&(P.selected=!0),l.appendChild(P)}),l.addEventListener("change",()=>{this.updatePrintableArea()});const f=document.createElement("TR"),y=document.createElement("TD"),x=document.createElement("TD");return y.appendChild(c),x.appendChild(l),f.appendChild(y),f.appendChild(x),f}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new AG(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new SG(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),e=document.getElementById("mapbox-gl-export-page-orientation").value;let r=JSON.parse(t.value);e===zp.Portrait&&(r=r.reverse()),this.printableArea.updateArea(r[0],r[1])}}var IE=NV,DV=Object.prototype.hasOwnProperty;function NV(){for(var i={},t=0;t<arguments.length;t++){var e=arguments[t];for(var r in e)DV.call(e,r)&&(i[r]=e[r])}return i}var ME={exports:{}};(function(i,t){(function(){var e={};i.exports=e,e.simpleFilter=function(r,s){return s.filter(function(n){return e.test(r,n)})},e.test=function(r,s){return e.match(r,s)!==null},e.match=function(r,s,n){n=n||{};var c=0,l=[],f=s.length,y=0,x=0,T=n.pre||"",P=n.post||"",M=n.caseSensitive&&s||s.toLowerCase(),N;r=n.caseSensitive&&r||r.toLowerCase();for(var G=0;G<f;G++)N=s[G],M[G]===r[c]?(N=T+N+P,c+=1,x+=1+x):x=0,y+=x,l[l.length]=N;return c===r.length?(y=M===r?1/0:y,{rendered:l.join(""),score:y}):null},e.filter=function(r,s,n){return!s||s.length===0?[]:typeof r!="string"?s:(n=n||{},s.reduce(function(c,l,f,y){var x=l;n.extract&&(x=n.extract(l));var T=e.match(r,x,n);return T!=null&&(c[c.length]={string:T.rendered,score:T.score,index:f,original:l}),c},[]).sort(function(c,l){var f=l.score-c.score;return f||c.index-l.index}))}})()})(ME);var FV=ME.exports,Go=function(i){return this.component=i,this.items=[],this.active=i.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};Go.prototype.show=function(){this.element.style.display="block"};Go.prototype.hide=function(){this.element.style.display="none"};Go.prototype.add=function(i){this.items.push(i)};Go.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0};Go.prototype.isEmpty=function(){return!this.items.length};Go.prototype.isVisible=function(){return this.element.style.display==="block"};Go.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()};Go.prototype.drawItem=function(i,t){var e=document.createElement("li"),r=document.createElement("a");t&&(e.className+=" active"),r.innerHTML=i.string,e.appendChild(r),this.element.appendChild(e),e.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),e.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,i)}).bind(this))};Go.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()};Go.prototype.move=function(i){this.active=i,this.draw()};Go.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)};Go.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)};Go.prototype.drawError=function(i){var t=document.createElement("li");t.innerHTML=i,this.element.appendChild(t),this.show()};var zV=Go,jV=IE,UV=FV,GV=zV,Qn=function(i,t,e){return e=e||{},this.options=jV({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},e),this.el=i,this.data=t||[],this.list=new GV(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode,r)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Qn.prototype.handleKeyUp=function(i,t){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}};Qn.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Qn.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Qn.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(i.target.value)},100)}};Qn.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}).bind(this))};Qn.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Qn.prototype.update=function(i){this.data=i,this.handleKeyUp()};Qn.prototype.clear=function(){this.data=[],this.list.clear()};Qn.prototype.normalize=function(i){return i=i.toLowerCase(),i};Qn.prototype.match=function(i,t){return i.indexOf(t)>-1};Qn.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Qn.prototype.getCandidates=function(i){var t={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},e;this.options.filter?(e=UV.filter(this.query,this.data,t),e=e.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):e=this.data.map((function(r){var s=this.render(r);return{original:r,string:s}}).bind(this)),i(e)};Qn.prototype.getItemValue=function(i){return i};Qn.prototype.render=function(i,t){if(t)return t;for(var e=i.original?this.getItemValue(i.original):this.getItemValue(i),r=this.normalize(e),s=r.lastIndexOf(this.query);s>-1;){var n=s+this.query.length;e=e.slice(0,s)+"<strong>"+e.slice(s,n)+"</strong>"+e.slice(n),s=r.slice(0,s).lastIndexOf(this.query)}return e};Qn.prototype.renderError=function(i){this.list.drawError(i)};var VV=Qn,LE=VV,qV=LE;typeof window<"u"&&(window.Suggestions=LE);var HV="Expected a function",X5=NaN,WV="[object Symbol]",JV=/^\s+|\s+$/g,ZV=/^[-+]0x[0-9a-f]+$/i,XV=/^0b[01]+$/i,$V=/^0o[0-7]+$/i,KV=parseInt,YV=typeof vd=="object"&&vd&&vd.Object===Object&&vd,QV=typeof self=="object"&&self&&self.Object===Object&&self,tq=YV||QV||Function("return this")(),eq=Object.prototype,iq=eq.toString,rq=Math.max,sq=Math.min,Gy=function(){return tq.Date.now()};function nq(i,t,e){var r,s,n,c,l,f,y=0,x=!1,T=!1,P=!0;if(typeof i!="function")throw new TypeError(HV);t=$5(t)||0,Y_(e)&&(x=!!e.leading,T="maxWait"in e,n=T?rq($5(e.maxWait)||0,t):n,P="trailing"in e?!!e.trailing:P);function M(Nt){var Rt=r,xt=s;return r=s=void 0,y=Nt,c=i.apply(xt,Rt),c}function N(Nt){return y=Nt,l=setTimeout(X,t),x?M(Nt):c}function G(Nt){var Rt=Nt-f,xt=Nt-y,qt=t-Rt;return T?sq(qt,n-xt):qt}function Z(Nt){var Rt=Nt-f,xt=Nt-y;return f===void 0||Rt>=t||Rt<0||T&&xt>=n}function X(){var Nt=Gy();if(Z(Nt))return $(Nt);l=setTimeout(X,G(Nt))}function $(Nt){return l=void 0,P&&r?M(Nt):(r=s=void 0,c)}function ct(){l!==void 0&&clearTimeout(l),y=0,r=f=s=l=void 0}function yt(){return l===void 0?c:$(Gy())}function Mt(){var Nt=Gy(),Rt=Z(Nt);if(r=arguments,s=this,f=Nt,Rt){if(l===void 0)return N(f);if(T)return l=setTimeout(X,t),M(f)}return l===void 0&&(l=setTimeout(X,t)),c}return Mt.cancel=ct,Mt.flush=yt,Mt}function Y_(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function oq(i){return!!i&&typeof i=="object"}function aq(i){return typeof i=="symbol"||oq(i)&&iq.call(i)==WV}function $5(i){if(typeof i=="number")return i;if(aq(i))return X5;if(Y_(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=Y_(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(JV,"");var e=XV.test(i);return e||$V.test(i)?KV(i.slice(2),e?2:8):ZV.test(i)?X5:+i}var lq=nq,Pv={exports:{}},kd=typeof Reflect=="object"?Reflect:null,K5=kd&&typeof kd.apply=="function"?kd.apply:function(i,t,e){return Function.prototype.apply.call(i,t,e)},Hg;kd&&typeof kd.ownKeys=="function"?Hg=kd.ownKeys:Object.getOwnPropertySymbols?Hg=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:Hg=function(i){return Object.getOwnPropertyNames(i)};function cq(i){console&&console.warn&&console.warn(i)}var BE=Number.isNaN||function(i){return i!==i};function Jr(){Jr.init.call(this)}Pv.exports=Jr;Pv.exports.once=pq;Jr.EventEmitter=Jr;Jr.prototype._events=void 0;Jr.prototype._eventsCount=0;Jr.prototype._maxListeners=void 0;var Y5=10;function Fm(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Jr,"defaultMaxListeners",{enumerable:!0,get:function(){return Y5},set:function(i){if(typeof i!="number"||i<0||BE(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Y5=i}});Jr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Jr.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||BE(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function RE(i){return i._maxListeners===void 0?Jr.defaultMaxListeners:i._maxListeners}Jr.prototype.getMaxListeners=function(){return RE(this)};Jr.prototype.emit=function(i){for(var t=[],e=1;e<arguments.length;e++)t.push(arguments[e]);var r=i==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var n;if(t.length>0&&(n=t[0]),n instanceof Error)throw n;var c=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw c.context=n,c}var l=s[i];if(l===void 0)return!1;if(typeof l=="function")K5(l,this,t);else for(var f=l.length,y=FE(l,f),e=0;e<f;++e)K5(y[e],this,t);return!0};function kE(i,t,e,r){var s,n,c;if(Fm(e),n=i._events,n===void 0?(n=i._events=Object.create(null),i._eventsCount=0):(n.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),n=i._events),c=n[t]),c===void 0)c=n[t]=e,++i._eventsCount;else if(typeof c=="function"?c=n[t]=r?[e,c]:[c,e]:r?c.unshift(e):c.push(e),s=RE(i),s>0&&c.length>s&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=i,l.type=t,l.count=c.length,cq(l)}return i}Jr.prototype.addListener=function(i,t){return kE(this,i,t,!1)};Jr.prototype.on=Jr.prototype.addListener;Jr.prototype.prependListener=function(i,t){return kE(this,i,t,!0)};function hq(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function OE(i,t,e){var r={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},s=hq.bind(r);return s.listener=e,r.wrapFn=s,s}Jr.prototype.once=function(i,t){return Fm(t),this.on(i,OE(this,i,t)),this};Jr.prototype.prependOnceListener=function(i,t){return Fm(t),this.prependListener(i,OE(this,i,t)),this};Jr.prototype.removeListener=function(i,t){var e,r,s,n,c;if(Fm(t),r=this._events,r===void 0)return this;if(e=r[i],e===void 0)return this;if(e===t||e.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[i],r.removeListener&&this.emit("removeListener",i,e.listener||t));else if(typeof e!="function"){for(s=-1,n=e.length-1;n>=0;n--)if(e[n]===t||e[n].listener===t){c=e[n].listener,s=n;break}if(s<0)return this;s===0?e.shift():uq(e,s),e.length===1&&(r[i]=e[0]),r.removeListener!==void 0&&this.emit("removeListener",i,c||t)}return this};Jr.prototype.off=Jr.prototype.removeListener;Jr.prototype.removeAllListeners=function(i){var t,e,r;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[i]),this;if(arguments.length===0){var s=Object.keys(e),n;for(r=0;r<s.length;++r)n=s[r],n!=="removeListener"&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=e[i],typeof t=="function")this.removeListener(i,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(i,t[r]);return this};function DE(i,t,e){var r=i._events;if(r===void 0)return[];var s=r[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?dq(s):FE(s,s.length)}Jr.prototype.listeners=function(i){return DE(this,i,!0)};Jr.prototype.rawListeners=function(i){return DE(this,i,!1)};Jr.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):NE.call(i,t)};Jr.prototype.listenerCount=NE;function NE(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Jr.prototype.eventNames=function(){return this._eventsCount>0?Hg(this._events):[]};function FE(i,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=i[r];return e}function uq(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function dq(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function pq(i,t){return new Promise(function(e,r){function s(c){i.removeListener(t,n),r(c)}function n(){typeof i.removeListener=="function"&&i.removeListener("error",s),e([].slice.call(arguments))}zE(i,t,n,{once:!0}),t!=="error"&&fq(i,s,{once:!0})})}function fq(i,t,e){typeof i.on=="function"&&zE(i,"error",t,e)}function zE(i,t,e,r){if(typeof i.on=="function")r.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function s(n){r.once&&i.removeEventListener(t,s),e(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var jE=Pv.exports,gq={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},mq={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},yq={placeholder:mq},UE={exports:{}};(function(i){(function(t,e,r){i.exports?i.exports=r():t[e]=r()})(vd,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(f){return f.match(e)||[]}function s(f){return r(f).filter(function(y,x){return y&&x})}function n(f){return f=r(f),{language:f[1]||t,extlang:f[2]||t,script:f[3]||t,region:f[4]||t}}function c(f,y,x){Object.defineProperty(f,y,{value:x,enumerable:!0})}function l(f,y,x){function T(P){return r(P)[f]||t}c(T,"pattern",y),c(n,x,T)}return l(1,/^[a-zA-Z]{2,3}$/,"language"),l(2,/^[a-zA-Z]{3}$/,"extlang"),l(3,/^[a-zA-Z]{4}$/,"script"),l(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),c(n,"split",s),n})})(UE);var _q=UE.exports,vq=qV,bq=lq,oa=IE,wq=jE.EventEmitter,Q5=gq,xq=yq,Aq=_q;function GE(i,t){this._eventEmitter=new wq,this.options=oa({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=i}GE.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(i){return i.text!==void 0?i.text:i.place_name},render:function(i){if(i.geometry){var t=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+t.splice(1,t.length).join(",")+"</div></div></div>"}else{var e=i.text,r=e.toLowerCase().indexOf(this.query.toLowerCase()),s=this.query.length,n=e.substring(0,r),c=e.substring(r,r+s),l=e.substring(r+s);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+n+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+c+"</span>"+l+"</div></div></div>"}},popupRender:function(i){var t=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(i){function t(r,s){if(!document.body.contains(s))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var n=r.onAdd();s.appendChild(n)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)t(this,i);else if(typeof i=="string"){var e=document.querySelectorAll(i);if(e.length===0)throw new Error("Element ",i,"not found.");if(e.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,e[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var e=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",bq(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),t.appendChild(e),t.appendChild(this._inputEl),t.appendChild(r),this._typeahead=new vq(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(i,t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+i),e.setAttribute("viewBox","0 0 18 18"),e.setAttribute("xml:space","preserve"),e.setAttribute("width",18),e.setAttribute("height",18),"innerHTML"in e)e.innerHTML=t;else{var r=document.createElement("div");r.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var s=r.firstChild,n=s.firstChild;e.appendChild(n)}return e},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(i){var t=(i.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(i){var t=27,e=9;if(i.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var r=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,s=r?r.value:"";if(!s)return this.fresh=!0,i.keyCode!==e&&this.clear(i),this._clearEl.style.display="none";if(!(i.metaKey||[e,t,37,39,38,40].indexOf(i.keyCode)!==-1)){if(i.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(r.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(r.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}r.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;if(i&&!i.geometry)i.placeId?this._geocode(i.placeId,!0,!0):this._geocode(i.text,!0);else if(i&&JSON.stringify(i)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),i.properties&&Q5[i.properties.short_code])t=oa({},this.options.flyTo),this._map&&this._map.fitBounds(Q5[i.properties.short_code].bbox,t);else if(i.bbox){var e=i.bbox;t=oa({},this.options.flyTo),this._map&&this._map.fitBounds([[e[0],e[1]],[e[2],e[3]]],t)}else{var r={zoom:this.options.zoom};t=oa({},r,this.options.flyTo),i.center?t.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(t.center=i.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:i})}},_getConfigForRequest:function(){var i=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,e=i.reduce(function(r,s){return t.options[s]&&(["countries","types","language"].indexOf(s)>-1?r[s]=t.options[s].split(/[\s,]+/):r[s]=t.options[s],s==="proximity"&&t.options[s]&&typeof t.options[s].longitude=="number"&&typeof t.options[s].latitude=="number"&&(r[s]=[t.options[s].longitude,t.options[s].latitude])),r},{});return e},_geocode:function(i,t,e){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:i}),this.inputString=i;var r=null,s=this._getConfigForRequest(),n;if(this.options.localGeocoderOnly)n=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(i)){var c=i.split(/[\s(,)?]+/).map(function(y){return parseFloat(y,10)}).reverse();s.types&&s.types[0],s=oa(s,{query:c,limit:1}),"proximity"in s&&delete s.proximity,n=this.geocoderApi.reverseGeocode(s)}else s=oa(s,{query:i}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&e?n=this.geocoderApi.searchByPlaceId(s):n=this.geocoderApi.forwardGeocode(s):n=this.geocoderApi.getSuggestions(s):n=this.geocoderApi.forwardGeocode(s);var l=[];this.options.localGeocoder&&(l=this.options.localGeocoder(i),l||(l=[]));var f=[];return n.catch((function(y){r=y}).bind(this)).then((function(y){this._loadingEl.style.display="none";var x={};return y?x=y:x={type:"FeatureCollection",features:[]},x.config=s,this.fresh&&(this.fresh=!1),x.features=x.features?l.concat(x.features):l,this.options.externalGeocoder?(f=this.options.externalGeocoder(i,x.features,s)||[],f.then(function(T){return x.features=x.features?T.concat(x.features):T,x},function(){return x})):x}).bind(this)).then((function(y){if(r)throw r;this.options.filter&&y.features.length&&(y.features=y.features.filter(this.options.filter));var x=[];y.suggestions?x=y.suggestions:y.place?x=[y.place]:x=y.features,x.length?(this._clearEl.style.display="block",this._typeahead.update(x),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(y.features.length>0||y.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",y)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",y))}).bind(this)).catch((function(y){this._loadingEl.style.display="none",l.length&&this.options.localGeocoder||f.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(l)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:l}),this._eventEmitter.emit("error",{error:y})}).bind(this)),n},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var t=this;i.relatedTarget&&t._clear(i)},_onQueryResult:function(i){var t=i;if(t.features.length){var e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],t=Aq.language(i),e=xq.placeholder[t];if(e)return e}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var i=this._typeahead.data.filter(function(s){return typeof s!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},e=oa({},t,this.options.flyTo),r=new this._maplibregl.LngLatBounds;i.forEach(function(s){r.extend(s.geometry.coordinates)}),this._map.fitBounds(r.toArray(),e)}return i.length>0&&this._maplibregl&&this._handleResultMarkers(i),this}},setInput:function(i){return this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i),this},setProximity:function(i){return this.options.proximity=i,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setGeocoderApi:function(i){return this.geocoderApi=i,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(i){if(this._map){this._removeMarker();var t={color:"#4668F2"},e=oa({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(e);var r;if(this.options.popup){var s={},n=oa({},s,this.options.popup);r=new this._maplibregl.Popup(n).setHTML(this.options.popupRender(i))}return i.center?(this.mapMarker.setLngLat(i.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(i){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},e=oa({},t,this.options.showResultMarkers);return i.forEach((function(r){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var s=this.options.showResultMarkers.element.cloneNode(!0);e=oa(e,{element:s})}var n=new this._maplibregl.Marker(oa({},e,{element:s})),c;if(this.options.popup){var l={},f=oa({},l,this.options.popup);c=new this._maplibregl.Popup(f).setHTML(this.options.popupRender(r))}r.center?(n.setLngLat(r.center).addTo(this._map),this.options.popup&&n.setPopup(c)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(n.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&n.setPopup(c)),this.resultMarkers.push(n)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(i){i.remove()}),this.resultMarkers=[])},on:function(i,t){return this._eventEmitter.on(i,t),this},off:function(i,t){return this._eventEmitter.removeListener(i,t),this}};var Sq=GE;const Eq=wm(Sq),Cq={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogràfic i Geològic de Catalunya",logoWidth:100},logoGencatOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Tq={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},Pq={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Iq={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},Cu={defaultOptions:Cq,Styles:Tq,Terrains:Pq,Layers:Iq};class Mq{constructor(t){this.options=t||{}}onAdd(t){let e=Cu.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?e.logoIcgcOptions.logoUrlColor:e.logoIcgcOptions.logoUrlWhite,this._img1.width=e.logoIcgcOptions.logoWidth,this._img1.title=e.logoIcgcOptions.logoTitle,this.link1=document.createElement("a"),this.link1.href=e.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${e.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?e.logoGencatOptions.logoUrlColor:e.logoGencatOptions.logoUrlWhite,this._img2.width=e.logoGencatOptions.logoWidth,this._img2.title=e.logoGencatOptions.logoTitle,this.link2=document.createElement("a"),this.link2.href=e.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${e.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class Lq{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const e=document.createElement("label");return e.classList.add("maplibregl-legend-title-label"),e.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(e),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var Kd=VE.prototype,Q_="WGS 84";function VE(i){i!==void 0&&(Q_=i),this.setEllipsoid(Q_)}Kd.convertLatLngToUtm=function(i,t,e){var r;if(this.status)return"No ecclipsoid data associated with unknown datum: "+Q_;if(!Number.isInteger(e))return"Precision is not integer number.";i=parseFloat(i),t=parseFloat(t);var s=t,n=this.toRadians(i),c=this.toRadians(s);s>=8&&s<=13&&i>54.5&&i<58||i>=56&&i<64&&s>=3&&s<12?r=32:(r=(s+180)/6+1,i>=72&&i<84&&(s>=0&&s<9?r=31:s>=9&&s<21?r=33:s>=21&&s<33?r=35:s>=33&&s<42&&(r=37))),r=parseInt(r);var l=(r-1)*6-180+3,f=this.toRadians(l),y=this.getUtmLetterDesignator(i),x=this.eccSquared/(1-this.eccSquared),T=this.a/Math.sqrt(1-this.eccSquared*Math.sin(n)*Math.sin(n)),P=Math.tan(n)*Math.tan(n),M=x*Math.cos(n)*Math.cos(n),N=Math.cos(n)*(c-f),G=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*n-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*n)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*n)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*n)),Z=parseFloat(.9996*T*(N+(1-P+M)*N*N*N/6+(5-18*P+P*P+72*M-58*x)*N*N*N*N*N/120)+5e5),X=parseFloat(.9996*(G+T*Math.tan(n)*(N*N/2+(5-P+9*M+4*M*M)*N*N*N*N/24+(61-58*P+P*P+600*M-330*x)*N*N*N*N*N*N/720)));return i<0&&(X+=1e7),X=tA(X,e),Z=tA(Z,e),{Easting:Z,Northing:X,ZoneNumber:parseInt(r),ZoneLetter:y}};Kd.convertUtmToLatLng=function(i,t,e,r){var s=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),n=i-5e5,c=t,l=e,f=r;if(i===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(e===void 0)return"Please pass the UTMZoneNumber!";if(r===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(f)!==-1||(c-=1e7);var y=(l-1)*6-180+3,x=this.eccSquared/(1-this.eccSquared),T=c/.9996,P=T/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),M=P+(3*s/2-27*s*s*s/32)*Math.sin(2*P)+(21*s*s/16-55*s*s*s*s/32)*Math.sin(4*P)+151*s*s*s/96*Math.sin(6*P);this.toDegrees(M);var N=this.a/Math.sqrt(1-this.eccSquared*Math.sin(M)*Math.sin(M)),G=Math.tan(M)*Math.tan(M),Z=x*Math.cos(M)*Math.cos(M),X=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(M)*Math.sin(M),1.5),$=n/(N*.9996),ct=M-N*Math.tan(M)/X*($*$/2-(5+3*G+10*Z-4*Z*Z-9*x)*$*$*$*$/24+(61+90*G+298*Z+45*G*G-252*x-3*Z*Z)*$*$*$*$*$*$/720);ct=this.toDegrees(ct);var yt=($-(1+2*G+Z)*$*$*$/6+(5-2*Z+28*G-3*Z*Z+8*x+24*G*G)*$*$*$*$*$/120)/Math.cos(M);return yt=y+this.toDegrees(yt),{lat:ct,lng:yt}};Kd.getUtmLetterDesignator=function(i){return i=parseFloat(i),84>=i&&i>=72?"X":72>i&&i>=64?"W":64>i&&i>=56?"V":56>i&&i>=48?"U":48>i&&i>=40?"T":40>i&&i>=32?"S":32>i&&i>=24?"R":24>i&&i>=16?"Q":16>i&&i>=8?"P":8>i&&i>=0?"N":0>i&&i>=-8?"M":-8>i&&i>=-16?"L":-16>i&&i>=-24?"K":-24>i&&i>=-32?"J":-32>i&&i>=-40?"H":-40>i&&i>=-48?"G":-48>i&&i>=-56?"F":-56>i&&i>=-64?"E":-64>i&&i>=-72?"D":-72>i&&i>=-80?"C":"Z"};Kd.setEllipsoid=function(i){switch(i){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}};Kd.toDegrees=function(i){return i/Math.PI*180};Kd.toRadians=function(i){return i*Math.PI/180};function tA(i,t){var e=Math.pow(10,t);return Math.round(i*e)/e}var Bq=VE;const Rq=wm(Bq);class kq{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const e=new Rq;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",r=>{const s=r.lngLat.lat,n=r.lngLat.lng;let c="",l="";const f=e.convertLatLngToUtm(s,n,2),y=s>0?"N":"S";this.options.utm&&(c=`ETRS89 UTM ${f.ZoneNumber}${y} X:<b> ${f.Easting}</b> Y:<b> ${f.Northing}</b> <br>`),this.options.lonlat&&(l=`WGS 84 Lon:<b> ${n.toFixed(5)}</b>  Lat:<b> ${s.toFixed(5)}</b>`);const x=`${c}${l}`;this._container.innerHTML=x}),this._container}_lookUTM31(t,e){var r=0,s=0,n=6,c=84;return t>=r&&t<=n&&e>=s&&e<=c}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function qE(i,t){return function(){return i.apply(t,arguments)}}const{toString:Oq}=Object.prototype,{getPrototypeOf:Iv}=Object,zm=(i=>t=>{const e=Oq.call(t);return i[e]||(i[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),fc=i=>(i=i.toLowerCase(),t=>zm(t)===i),jm=i=>t=>typeof t===i,{isArray:Yd}=Array,cf=jm("undefined");function Dq(i){return i!==null&&!cf(i)&&i.constructor!==null&&!cf(i.constructor)&&Va(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const HE=fc("ArrayBuffer");function Nq(i){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(i):t=i&&i.buffer&&HE(i.buffer),t}const Fq=jm("string"),Va=jm("function"),WE=jm("number"),Um=i=>i!==null&&typeof i=="object",zq=i=>i===!0||i===!1,Wg=i=>{if(zm(i)!=="object")return!1;const t=Iv(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},jq=fc("Date"),Uq=fc("File"),Gq=fc("Blob"),Vq=fc("FileList"),qq=i=>Um(i)&&Va(i.pipe),Hq=i=>{let t;return i&&(typeof FormData=="function"&&i instanceof FormData||Va(i.append)&&((t=zm(i))==="formdata"||t==="object"&&Va(i.toString)&&i.toString()==="[object FormData]"))},Wq=fc("URLSearchParams"),Jq=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ef(i,t){let{allOwnKeys:e=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(i===null||typeof i>"u")return;let r,s;if(typeof i!="object"&&(i=[i]),Yd(i))for(r=0,s=i.length;r<s;r++)t.call(null,i[r],r,i);else{const n=e?Object.getOwnPropertyNames(i):Object.keys(i),c=n.length;let l;for(r=0;r<c;r++)l=n[r],t.call(null,i[l],l,i)}}function JE(i,t){t=t.toLowerCase();const e=Object.keys(i);let r=e.length,s;for(;r-- >0;)if(s=e[r],t===s.toLowerCase())return s;return null}const ZE=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,XE=i=>!cf(i)&&i!==ZE;function t1(){const{caseless:i}=XE(this)&&this||{},t={},e=(r,s)=>{const n=i&&JE(t,s)||s;Wg(t[n])&&Wg(r)?t[n]=t1(t[n],r):Wg(r)?t[n]=t1({},r):Yd(r)?t[n]=r.slice():t[n]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Ef(arguments[r],e);return t}const Zq=function(i,t,e){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ef(t,(s,n)=>{e&&Va(s)?i[n]=qE(s,e):i[n]=s},{allOwnKeys:r}),i},Xq=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),$q=(i,t,e,r)=>{i.prototype=Object.create(t.prototype,r),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:t.prototype}),e&&Object.assign(i.prototype,e)},Kq=(i,t,e,r)=>{let s,n,c;const l={};if(t=t||{},i==null)return t;do{for(s=Object.getOwnPropertyNames(i),n=s.length;n-- >0;)c=s[n],(!r||r(c,i,t))&&!l[c]&&(t[c]=i[c],l[c]=!0);i=e!==!1&&Iv(i)}while(i&&(!e||e(i,t))&&i!==Object.prototype);return t},Yq=(i,t,e)=>{i=String(i),(e===void 0||e>i.length)&&(e=i.length),e-=t.length;const r=i.indexOf(t,e);return r!==-1&&r===e},Qq=i=>{if(!i)return null;if(Yd(i))return i;let t=i.length;if(!WE(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=i[t];return e},tH=(i=>t=>i&&t instanceof i)(typeof Uint8Array<"u"&&Iv(Uint8Array)),eH=(i,t)=>{const e=(i&&i[Symbol.iterator]).call(i);let r;for(;(r=e.next())&&!r.done;){const s=r.value;t.call(i,s[0],s[1])}},iH=(i,t)=>{let e;const r=[];for(;(e=i.exec(t))!==null;)r.push(e);return r},rH=fc("HTMLFormElement"),sH=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,e,r){return e.toUpperCase()+r}),eA=(i=>{let{hasOwnProperty:t}=i;return(e,r)=>t.call(e,r)})(Object.prototype),nH=fc("RegExp"),$E=(i,t)=>{const e=Object.getOwnPropertyDescriptors(i),r={};Ef(e,(s,n)=>{let c;(c=t(s,n,i))!==!1&&(r[n]=c||s)}),Object.defineProperties(i,r)},oH=i=>{$E(i,(t,e)=>{if(Va(i)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=i[e];if(Va(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},aH=(i,t)=>{const e={},r=s=>{s.forEach(n=>{e[n]=!0})};return Yd(i)?r(i):r(String(i).split(t)),e},lH=()=>{},cH=(i,t)=>(i=+i,Number.isFinite(i)?i:t),Vy="abcdefghijklmnopqrstuvwxyz",iA="0123456789",KE={DIGIT:iA,ALPHA:Vy,ALPHA_DIGIT:Vy+Vy.toUpperCase()+iA},hH=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:KE.ALPHA_DIGIT,e="";const{length:r}=t;for(;i--;)e+=t[Math.random()*r|0];return e};function uH(i){return!!(i&&Va(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const dH=i=>{const t=new Array(10),e=(r,s)=>{if(Um(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[s]=r;const n=Yd(r)?[]:{};return Ef(r,(c,l)=>{const f=e(c,s+1);!cf(f)&&(n[l]=f)}),t[s]=void 0,n}}return r};return e(i,0)},pH=fc("AsyncFunction"),fH=i=>i&&(Um(i)||Va(i))&&Va(i.then)&&Va(i.catch),xe={isArray:Yd,isArrayBuffer:HE,isBuffer:Dq,isFormData:Hq,isArrayBufferView:Nq,isString:Fq,isNumber:WE,isBoolean:zq,isObject:Um,isPlainObject:Wg,isUndefined:cf,isDate:jq,isFile:Uq,isBlob:Gq,isRegExp:nH,isFunction:Va,isStream:qq,isURLSearchParams:Wq,isTypedArray:tH,isFileList:Vq,forEach:Ef,merge:t1,extend:Zq,trim:Jq,stripBOM:Xq,inherits:$q,toFlatObject:Kq,kindOf:zm,kindOfTest:fc,endsWith:Yq,toArray:Qq,forEachEntry:eH,matchAll:iH,isHTMLForm:rH,hasOwnProperty:eA,hasOwnProp:eA,reduceDescriptors:$E,freezeMethods:oH,toObjectSet:aH,toCamelCase:sH,noop:lH,toFiniteNumber:cH,findKey:JE,global:ZE,isContextDefined:XE,ALPHABET:KE,generateString:hH,isSpecCompliantForm:uH,toJSONObject:dH,isAsyncFn:pH,isThenable:fH};function _r(i,t,e,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),r&&(this.request=r),s&&(this.response=s)}xe.inherits(_r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:xe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const YE=_r.prototype,QE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{QE[i]={value:i}});Object.defineProperties(_r,QE);Object.defineProperty(YE,"isAxiosError",{value:!0});_r.from=(i,t,e,r,s,n)=>{const c=Object.create(YE);return xe.toFlatObject(i,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),_r.call(c,i.message,t,e,r,s),c.cause=i,c.name=i.name,n&&Object.assign(c,n),c};const gH=null;function e1(i){return xe.isPlainObject(i)||xe.isArray(i)}function tC(i){return xe.endsWith(i,"[]")?i.slice(0,-2):i}function rA(i,t,e){return i?i.concat(t).map(function(r,s){return r=tC(r),!e&&s?"["+r+"]":r}).join(e?".":""):t}function mH(i){return xe.isArray(i)&&!i.some(e1)}const yH=xe.toFlatObject(xe,{},null,function(i){return/^is[A-Z]/.test(i)});function Gm(i,t,e){if(!xe.isObject(i))throw new TypeError("target must be an object");t=t||new FormData,e=xe.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(M,N){return!xe.isUndefined(N[M])});const r=e.metaTokens,s=e.visitor||y,n=e.dots,c=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&xe.isSpecCompliantForm(t);if(!xe.isFunction(s))throw new TypeError("visitor must be a function");function f(M){if(M===null)return"";if(xe.isDate(M))return M.toISOString();if(!l&&xe.isBlob(M))throw new _r("Blob is not supported. Use a Buffer instead.");return xe.isArrayBuffer(M)||xe.isTypedArray(M)?l&&typeof Blob=="function"?new Blob([M]):Buffer.from(M):M}function y(M,N,G){let Z=M;if(M&&!G&&typeof M=="object"){if(xe.endsWith(N,"{}"))N=r?N:N.slice(0,-2),M=JSON.stringify(M);else if(xe.isArray(M)&&mH(M)||(xe.isFileList(M)||xe.endsWith(N,"[]"))&&(Z=xe.toArray(M)))return N=tC(N),Z.forEach(function(X,$){!(xe.isUndefined(X)||X===null)&&t.append(c===!0?rA([N],$,n):c===null?N:N+"[]",f(X))}),!1}return e1(M)?!0:(t.append(rA(G,N,n),f(M)),!1)}const x=[],T=Object.assign(yH,{defaultVisitor:y,convertValue:f,isVisitable:e1});function P(M,N){if(!xe.isUndefined(M)){if(x.indexOf(M)!==-1)throw Error("Circular reference detected in "+N.join("."));x.push(M),xe.forEach(M,function(G,Z){(!(xe.isUndefined(G)||G===null)&&s.call(t,G,xe.isString(Z)?Z.trim():Z,N,T))===!0&&P(G,N?N.concat(Z):[Z])}),x.pop()}}if(!xe.isObject(i))throw new TypeError("data must be an object");return P(i),t}function sA(i){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Mv(i,t){this._pairs=[],i&&Gm(i,this,t)}const eC=Mv.prototype;eC.append=function(i,t){this._pairs.push([i,t])};eC.toString=function(i){const t=i?function(e){return i.call(this,e,sA)}:sA;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};function _H(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function iC(i,t,e){if(!t)return i;const r=e&&e.encode||_H,s=e&&e.serialize;let n;if(s?n=s(t,e):n=xe.isURLSearchParams(t)?t.toString():new Mv(t,e).toString(r),n){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+n}return i}class nA{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){xe.forEach(this.handlers,function(e){e!==null&&t(e)})}}const rC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vH=typeof URLSearchParams<"u"?URLSearchParams:Mv,bH=typeof FormData<"u"?FormData:null,wH=typeof Blob<"u"?Blob:null,xH={isBrowser:!0,classes:{URLSearchParams:vH,FormData:bH,Blob:wH},protocols:["http","https","file","blob","url","data"]},sC=typeof window<"u"&&typeof document<"u",AH=(i=>sC&&["ReactNative","NativeScript","NS"].indexOf(i)<0)(typeof navigator<"u"&&navigator.product),SH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",EH=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:sC,hasStandardBrowserEnv:AH,hasStandardBrowserWebWorkerEnv:SH},Symbol.toStringTag,{value:"Module"})),hc={...EH,...xH};function CH(i,t){return Gm(i,new hc.classes.URLSearchParams,Object.assign({visitor:function(e,r,s,n){return hc.isNode&&xe.isBuffer(e)?(this.append(r,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}function TH(i){return xe.matchAll(/\w+|\[(\w*)]/g,i).map(t=>t[0]==="[]"?"":t[1]||t[0])}function PH(i){const t={},e=Object.keys(i);let r;const s=e.length;let n;for(r=0;r<s;r++)n=e[r],t[n]=i[n];return t}function nC(i){function t(e,r,s,n){let c=e[n++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),f=n>=e.length;return c=!c&&xe.isArray(s)?s.length:c,f?(xe.hasOwnProp(s,c)?s[c]=[s[c],r]:s[c]=r,!l):((!s[c]||!xe.isObject(s[c]))&&(s[c]=[]),t(e,r,s[c],n)&&xe.isArray(s[c])&&(s[c]=PH(s[c])),!l)}if(xe.isFormData(i)&&xe.isFunction(i.entries)){const e={};return xe.forEachEntry(i,(r,s)=>{t(TH(r),s,e,0)}),e}return null}function IH(i,t,e){if(xe.isString(i))try{return(t||JSON.parse)(i),xe.trim(i)}catch(r){if(r.name!=="SyntaxError")throw r}return(e||JSON.stringify)(i)}const Lv={transitional:rC,adapter:["xhr","http"],transformRequest:[function(i,t){const e=t.getContentType()||"",r=e.indexOf("application/json")>-1,s=xe.isObject(i);if(s&&xe.isHTMLForm(i)&&(i=new FormData(i)),xe.isFormData(i))return r?JSON.stringify(nC(i)):i;if(xe.isArrayBuffer(i)||xe.isBuffer(i)||xe.isStream(i)||xe.isFile(i)||xe.isBlob(i))return i;if(xe.isArrayBufferView(i))return i.buffer;if(xe.isURLSearchParams(i))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let n;if(s){if(e.indexOf("application/x-www-form-urlencoded")>-1)return CH(i,this.formSerializer).toString();if((n=xe.isFileList(i))||e.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Gm(n?{"files[]":i}:i,c&&new c,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),IH(i)):i}],transformResponse:[function(i){const t=this.transitional||Lv.transitional,e=t&&t.forcedJSONParsing,r=this.responseType==="json";if(i&&xe.isString(i)&&(e&&!this.responseType||r)){const s=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(i)}catch(n){if(s)throw n.name==="SyntaxError"?_r.from(n,_r.ERR_BAD_RESPONSE,this,null,this.response):n}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:hc.classes.FormData,Blob:hc.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};xe.forEach(["delete","get","head","post","put","patch"],i=>{Lv.headers[i]={}});const Bv=Lv,MH=xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),LH=i=>{const t={};let e,r,s;return i&&i.split(`
`).forEach(function(n){s=n.indexOf(":"),e=n.substring(0,s).trim().toLowerCase(),r=n.substring(s+1).trim(),!(!e||t[e]&&MH[e])&&(e==="set-cookie"?t[e]?t[e].push(r):t[e]=[r]:t[e]=t[e]?t[e]+", "+r:r)}),t},oA=Symbol("internals");function kp(i){return i&&String(i).trim().toLowerCase()}function Jg(i){return i===!1||i==null?i:xe.isArray(i)?i.map(Jg):String(i)}function BH(i){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(i);)t[r[1]]=r[2];return t}const RH=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function qy(i,t,e,r,s){if(xe.isFunction(r))return r.call(this,t,e);if(s&&(t=e),!!xe.isString(t)){if(xe.isString(r))return t.indexOf(r)!==-1;if(xe.isRegExp(r))return r.test(t)}}function kH(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,r)=>e.toUpperCase()+r)}function OH(i,t){const e=xe.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(i,r+e,{value:function(s,n,c){return this[r].call(this,t,s,n,c)},configurable:!0})})}class Vm{constructor(t){t&&this.set(t)}set(t,e,r){const s=this;function n(l,f,y){const x=kp(f);if(!x)throw new Error("header name must be a non-empty string");const T=xe.findKey(s,x);(!T||s[T]===void 0||y===!0||y===void 0&&s[T]!==!1)&&(s[T||f]=Jg(l))}const c=(l,f)=>xe.forEach(l,(y,x)=>n(y,x,f));return xe.isPlainObject(t)||t instanceof this.constructor?c(t,e):xe.isString(t)&&(t=t.trim())&&!RH(t)?c(LH(t),e):t!=null&&n(e,t,r),this}get(t,e){if(t=kp(t),t){const r=xe.findKey(this,t);if(r){const s=this[r];if(!e)return s;if(e===!0)return BH(s);if(xe.isFunction(e))return e.call(this,s,r);if(xe.isRegExp(e))return e.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=kp(t),t){const r=xe.findKey(this,t);return!!(r&&this[r]!==void 0&&(!e||qy(this,this[r],r,e)))}return!1}delete(t,e){const r=this;let s=!1;function n(c){if(c=kp(c),c){const l=xe.findKey(r,c);l&&(!e||qy(r,r[l],l,e))&&(delete r[l],s=!0)}}return xe.isArray(t)?t.forEach(n):n(t),s}clear(t){const e=Object.keys(this);let r=e.length,s=!1;for(;r--;){const n=e[r];(!t||qy(this,this[n],n,t,!0))&&(delete this[n],s=!0)}return s}normalize(t){const e=this,r={};return xe.forEach(this,(s,n)=>{const c=xe.findKey(r,n);if(c){e[c]=Jg(s),delete e[n];return}const l=t?kH(n):String(n).trim();l!==n&&delete e[n],e[l]=Jg(s),r[l]=!0}),this}concat(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.constructor.concat(this,...e)}toJSON(t){const e=Object.create(null);return xe.forEach(this,(r,s)=>{r!=null&&r!==!1&&(e[s]=t&&xe.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[e,r]=t;return e+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const e=new this(t);for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];return s.forEach(c=>e.set(c)),e}static accessor(t){const e=(this[oA]=this[oA]={accessors:{}}).accessors,r=this.prototype;function s(n){const c=kp(n);e[c]||(OH(r,n),e[c]=!0)}return xe.isArray(t)?t.forEach(s):s(t),this}}Vm.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);xe.reduceDescriptors(Vm.prototype,(i,t)=>{let{value:e}=i,r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[r]=s}}});xe.freezeMethods(Vm);const $c=Vm;function Hy(i,t){const e=this||Bv,r=t||e,s=$c.from(r.headers);let n=r.data;return xe.forEach(i,function(c){n=c.call(e,n,s.normalize(),t?t.status:void 0)}),s.normalize(),n}function oC(i){return!!(i&&i.__CANCEL__)}function Cf(i,t,e){_r.call(this,i??"canceled",_r.ERR_CANCELED,t,e),this.name="CanceledError"}xe.inherits(Cf,_r,{__CANCEL__:!0});function DH(i,t,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?i(e):t(new _r("Request failed with status code "+e.status,[_r.ERR_BAD_REQUEST,_r.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}const NH=hc.hasStandardBrowserEnv?{write(i,t,e,r,s,n){const c=[i+"="+encodeURIComponent(t)];xe.isNumber(e)&&c.push("expires="+new Date(e).toGMTString()),xe.isString(r)&&c.push("path="+r),xe.isString(s)&&c.push("domain="+s),n===!0&&c.push("secure"),document.cookie=c.join("; ")},read(i){const t=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function FH(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function zH(i,t){return t?i.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):i}function aC(i,t){return i&&!FH(t)?zH(i,t):t}const jH=hc.hasStandardBrowserEnv?function(){const i=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let e;function r(s){let n=s;return i&&(t.setAttribute("href",n),n=t.href),t.setAttribute("href",n),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return e=r(window.location.href),function(s){const n=xe.isString(s)?r(s):s;return n.protocol===e.protocol&&n.host===e.host}}():function(){return function(){return!0}}();function UH(i){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return t&&t[1]||""}function GH(i,t){i=i||10;const e=new Array(i),r=new Array(i);let s=0,n=0,c;return t=t!==void 0?t:1e3,function(l){const f=Date.now(),y=r[n];c||(c=f),e[s]=l,r[s]=f;let x=n,T=0;for(;x!==s;)T+=e[x++],x=x%i;if(s=(s+1)%i,s===n&&(n=(n+1)%i),f-c<t)return;const P=y&&f-y;return P?Math.round(T*1e3/P):void 0}}function aA(i,t){let e=0;const r=GH(50,250);return s=>{const n=s.loaded,c=s.lengthComputable?s.total:void 0,l=n-e,f=r(l),y=n<=c;e=n;const x={loaded:n,total:c,progress:c?n/c:void 0,bytes:l,rate:f||void 0,estimated:f&&c&&y?(c-n)/f:void 0,event:s};x[t?"download":"upload"]=!0,i(x)}}const VH=typeof XMLHttpRequest<"u",qH=VH&&function(i){return new Promise(function(t,e){let r=i.data;const s=$c.from(i.headers).normalize();let{responseType:n,withXSRFToken:c}=i,l;function f(){i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let y;if(xe.isFormData(r)){if(hc.hasStandardBrowserEnv||hc.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((y=s.getContentType())!==!1){const[N,...G]=y?y.split(";").map(Z=>Z.trim()).filter(Boolean):[];s.setContentType([N||"multipart/form-data",...G].join("; "))}}let x=new XMLHttpRequest;if(i.auth){const N=i.auth.username||"",G=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";s.set("Authorization","Basic "+btoa(N+":"+G))}const T=aC(i.baseURL,i.url);x.open(i.method.toUpperCase(),iC(T,i.params,i.paramsSerializer),!0),x.timeout=i.timeout;function P(){if(!x)return;const N=$c.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),G={data:!n||n==="text"||n==="json"?x.responseText:x.response,status:x.status,statusText:x.statusText,headers:N,config:i,request:x};DH(function(Z){t(Z),f()},function(Z){e(Z),f()},G),x=null}if("onloadend"in x?x.onloadend=P:x.onreadystatechange=function(){!x||x.readyState!==4||x.status===0&&!(x.responseURL&&x.responseURL.indexOf("file:")===0)||setTimeout(P)},x.onabort=function(){x&&(e(new _r("Request aborted",_r.ECONNABORTED,i,x)),x=null)},x.onerror=function(){e(new _r("Network Error",_r.ERR_NETWORK,i,x)),x=null},x.ontimeout=function(){let N=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const G=i.transitional||rC;i.timeoutErrorMessage&&(N=i.timeoutErrorMessage),e(new _r(N,G.clarifyTimeoutError?_r.ETIMEDOUT:_r.ECONNABORTED,i,x)),x=null},hc.hasStandardBrowserEnv&&(c&&xe.isFunction(c)&&(c=c(i)),c||c!==!1&&jH(T))){const N=i.xsrfHeaderName&&i.xsrfCookieName&&NH.read(i.xsrfCookieName);N&&s.set(i.xsrfHeaderName,N)}r===void 0&&s.setContentType(null),"setRequestHeader"in x&&xe.forEach(s.toJSON(),function(N,G){x.setRequestHeader(G,N)}),xe.isUndefined(i.withCredentials)||(x.withCredentials=!!i.withCredentials),n&&n!=="json"&&(x.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&x.addEventListener("progress",aA(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&x.upload&&x.upload.addEventListener("progress",aA(i.onUploadProgress)),(i.cancelToken||i.signal)&&(l=N=>{x&&(e(!N||N.type?new Cf(null,i,x):N),x.abort(),x=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const M=UH(T);if(M&&hc.protocols.indexOf(M)===-1){e(new _r("Unsupported protocol "+M+":",_r.ERR_BAD_REQUEST,i));return}x.send(r||null)})},i1={http:gH,xhr:qH};xe.forEach(i1,(i,t)=>{if(i){try{Object.defineProperty(i,"name",{value:t})}catch{}Object.defineProperty(i,"adapterName",{value:t})}});const lA=i=>`- ${i}`,HH=i=>xe.isFunction(i)||i===null||i===!1,lC={getAdapter:i=>{i=xe.isArray(i)?i:[i];const{length:t}=i;let e,r;const s={};for(let n=0;n<t;n++){e=i[n];let c;if(r=e,!HH(e)&&(r=i1[(c=String(e)).toLowerCase()],r===void 0))throw new _r(`Unknown adapter '${c}'`);if(r)break;s[c||"#"+n]=r}if(!r){const n=Object.entries(s).map(l=>{let[f,y]=l;return`adapter ${f} `+(y===!1?"is not supported by the environment":"is not available in the build")});let c=t?n.length>1?`since :
`+n.map(lA).join(`
`):" "+lA(n[0]):"as no adapter specified";throw new _r("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return r},adapters:i1};function Wy(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Cf(null,i)}function cA(i){return Wy(i),i.headers=$c.from(i.headers),i.data=Hy.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),lC.getAdapter(i.adapter||Bv.adapter)(i).then(function(t){return Wy(i),t.data=Hy.call(i,i.transformResponse,t),t.headers=$c.from(t.headers),t},function(t){return oC(t)||(Wy(i),t&&t.response&&(t.response.data=Hy.call(i,i.transformResponse,t.response),t.response.headers=$c.from(t.response.headers))),Promise.reject(t)})}const hA=i=>i instanceof $c?i.toJSON():i;function Wd(i,t){t=t||{};const e={};function r(y,x,T){return xe.isPlainObject(y)&&xe.isPlainObject(x)?xe.merge.call({caseless:T},y,x):xe.isPlainObject(x)?xe.merge({},x):xe.isArray(x)?x.slice():x}function s(y,x,T){if(xe.isUndefined(x)){if(!xe.isUndefined(y))return r(void 0,y,T)}else return r(y,x,T)}function n(y,x){if(!xe.isUndefined(x))return r(void 0,x)}function c(y,x){if(xe.isUndefined(x)){if(!xe.isUndefined(y))return r(void 0,y)}else return r(void 0,x)}function l(y,x,T){if(T in t)return r(y,x);if(T in i)return r(void 0,y)}const f={url:n,method:n,data:n,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(y,x)=>s(hA(y),hA(x),!0)};return xe.forEach(Object.keys(Object.assign({},i,t)),function(y){const x=f[y]||s,T=x(i[y],t[y],y);xe.isUndefined(T)&&x!==l||(e[y]=T)}),e}const cC="1.6.7",Rv={};["object","boolean","number","function","string","symbol"].forEach((i,t)=>{Rv[i]=function(e){return typeof e===i||"a"+(t<1?"n ":" ")+i}});const uA={};Rv.transitional=function(i,t,e){function r(s,n){return"[Axios v"+cC+"] Transitional option '"+s+"'"+n+(e?". "+e:"")}return(s,n,c)=>{if(i===!1)throw new _r(r(n," has been removed"+(t?" in "+t:"")),_r.ERR_DEPRECATED);return t&&!uA[n]&&(uA[n]=!0,console.warn(r(n," has been deprecated since v"+t+" and will be removed in the near future"))),i?i(s,n,c):!0}};function WH(i,t,e){if(typeof i!="object")throw new _r("options must be an object",_r.ERR_BAD_OPTION_VALUE);const r=Object.keys(i);let s=r.length;for(;s-- >0;){const n=r[s],c=t[n];if(c){const l=i[n],f=l===void 0||c(l,n,i);if(f!==!0)throw new _r("option "+n+" must be "+f,_r.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new _r("Unknown option "+n,_r.ERR_BAD_OPTION)}}const r1={assertOptions:WH,validators:Rv},Oh=r1.validators;class bm{constructor(t){this.defaults=t,this.interceptors={request:new nA,response:new nA}}async request(t,e){try{return await this._request(t,e)}catch(r){if(r instanceof Error){let s;Error.captureStackTrace?Error.captureStackTrace(s={}):s=new Error;const n=s.stack?s.stack.replace(/^.+\n/,""):"";r.stack?n&&!String(r.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+n):r.stack=n}throw r}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Wd(this.defaults,e);const{transitional:r,paramsSerializer:s,headers:n}=e;r!==void 0&&r1.assertOptions(r,{silentJSONParsing:Oh.transitional(Oh.boolean),forcedJSONParsing:Oh.transitional(Oh.boolean),clarifyTimeoutError:Oh.transitional(Oh.boolean)},!1),s!=null&&(xe.isFunction(s)?e.paramsSerializer={serialize:s}:r1.assertOptions(s,{encode:Oh.function,serialize:Oh.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let c=n&&xe.merge(n.common,n[e.method]);n&&xe.forEach(["delete","get","head","post","put","patch","common"],N=>{delete n[N]}),e.headers=$c.concat(c,n);const l=[];let f=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(e)===!1||(f=f&&N.synchronous,l.unshift(N.fulfilled,N.rejected))});const y=[];this.interceptors.response.forEach(function(N){y.push(N.fulfilled,N.rejected)});let x,T=0,P;if(!f){const N=[cA.bind(this),void 0];for(N.unshift.apply(N,l),N.push.apply(N,y),P=N.length,x=Promise.resolve(e);T<P;)x=x.then(N[T++],N[T++]);return x}P=l.length;let M=e;for(T=0;T<P;){const N=l[T++],G=l[T++];try{M=N(M)}catch(Z){G.call(this,Z);break}}try{x=cA.call(this,M)}catch(N){return Promise.reject(N)}for(T=0,P=y.length;T<P;)x=x.then(y[T++],y[T++]);return x}getUri(t){t=Wd(this.defaults,t);const e=aC(t.baseURL,t.url);return iC(e,t.params,t.paramsSerializer)}}xe.forEach(["delete","get","head","options"],function(i){bm.prototype[i]=function(t,e){return this.request(Wd(e||{},{method:i,url:t,data:(e||{}).data}))}});xe.forEach(["post","put","patch"],function(i){function t(e){return function(r,s,n){return this.request(Wd(n||{},{method:i,headers:e?{"Content-Type":"multipart/form-data"}:{},url:r,data:s}))}}bm.prototype[i]=t(),bm.prototype[i+"Form"]=t(!0)});const Zg=bm;class kv{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(s){e=s});const r=this;this.promise.then(s=>{if(!r._listeners)return;let n=r._listeners.length;for(;n-- >0;)r._listeners[n](s);r._listeners=null}),this.promise.then=s=>{let n;const c=new Promise(l=>{r.subscribe(l),n=l}).then(s);return c.cancel=function(){r.unsubscribe(n)},c},t(function(s,n,c){r.reason||(r.reason=new Cf(s,n,c),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}static source(){let t;return{token:new kv(function(e){t=e}),cancel:t}}}const JH=kv;function ZH(i){return function(t){return i.apply(null,t)}}function XH(i){return xe.isObject(i)&&i.isAxiosError===!0}const s1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(s1).forEach(i=>{let[t,e]=i;s1[e]=t});const $H=s1;function hC(i){const t=new Zg(i),e=qE(Zg.prototype.request,t);return xe.extend(e,Zg.prototype,t,{allOwnKeys:!0}),xe.extend(e,t,null,{allOwnKeys:!0}),e.create=function(r){return hC(Wd(i,r))},e}const Xs=hC(Bv);Xs.Axios=Zg;Xs.CanceledError=Cf;Xs.CancelToken=JH;Xs.isCancel=oC;Xs.VERSION=cC;Xs.toFormData=Gm;Xs.AxiosError=_r;Xs.Cancel=Xs.CanceledError;Xs.all=function(i){return Promise.all(i)};Xs.spread=ZH;Xs.isAxiosError=XH;Xs.mergeConfig=Wd;Xs.AxiosHeaders=$c;Xs.formToJSON=i=>nC(xe.isHTMLForm(i)?new FormData(i):i);Xs.getAdapter=lC.getAdapter;Xs.HttpStatusCode=$H;Xs.default=Xs;const KH="https://tilemaps.icgc.cat/cdn/configs/mapicgc-config.json",YH=5e3;class uC{static async getConfigICGC(){try{const t=await Xs.get(KH,{timeout:YH});return t.data?t.data:(console.log("Resposta sense dades:",t),Cu)}catch(t){return t.response?(console.error("Error de resposta:",t.response.data),console.error("Codi d'estat:",t.response.status)):t.request?console.error("No s'ha rebut resposta del servidor:",t.request):console.error("Error:",t.message),Cu}}}const QH={"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]},tW={cobertesSol:QH},eW="lines",Pg="labels";let yu,Op,Ms,wr,iW=class{constructor(i){uC.getConfigICGC().then(t=>{yu={...t.Styles},Ms={...t.Layers},Op={...t.Terrains},wr={...t.defaultOptions},this.initTheMap(i)}).catch(t=>{console.info("Configuracio per defecte",t),yu={...Cu.Styles},Ms={...Cu.Layers},Op={...Cu.Terrains},wr={...Cu.defaultOptions},this.initTheMap(i)})}initTheMap(i){if(!i)i=wr.mapOptions;else for(const t in wr.mapOptions){let e=[wr.mapOptions.center[0],wr.mapOptions.center[1]];wr.mapOptions.center=e,i.hasOwnProperty(t)||(i[t]=wr.mapOptions[t])}i.maxPitch=85,i.maplibreLogo=!1,i.attributionControl=!1,this.map=new gn.Map(i),this.map.options=i,this.map.addControl(new gn.AttributionControl({compact:!0})),this.map.on("load",async()=>{const t=this.map.getStyle().name,e=this.map.options.style;if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this.map.addControl(new Mq({color:e.indexOf("orto")===-1,defaultOptions:wr}),"bottom-left"),this._dealOrto3dStyle(t)})}addGeocoderICGC(i){try{i===void 0&&(i="top-right");let t={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:gn,showResultsWhileTyping:!0,minLength:2};const e={forwardGeocode:async s=>{const n=[];try{const c=wr.geocoder.peliasUrl1+encodeURIComponent(s.query)+wr.geocoder.peliasUrl2,l=await(await fetch(c)).json();for(const f of l.features){const y=f.geometry.coordinates,x={type:"Feature",geometry:{type:"Point",coordinates:y},place_name:f.properties.label,properties:f.properties,text:f.properties.label,place_type:["place"],center:y};n.push(x)}}catch(c){console.error(`Failed to forwardGeocode with error: ${c}`)}return{features:n}}};this.map.addControl(new Eq(e,t),i);let r=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");r[0].attributes[2].nodeValue="Cerca...",r[0].addEventListener("input",function(s){s.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(i){console.error(`Error getting style: ${i.message}`)}}async loadImage(i){try{return this.map.loadImage(i)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(i,t){try{return this.map.addImage(i,t)}catch(e){console.error(`Error getting addImage: ${e.message}`)}}getConfigStyles(){try{let i=[];for(const t of yu)i.push(t.name);return i}catch(i){console.error(`Error retrieving base styles: ${i.message}`)}}getConfigWMSLayers(){try{let i=[];for(const t in Ms.WMS)Ms.WMS.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving WMS layers: ${i.message}`)}}getConfigOrtoLayers(){try{let i=[];for(const t in Ms.Orto)Ms.Orto.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving orto image layers: ${i.message}`)}}getConfigVectorLayers(){try{let i=[];for(const t in Ms.Vector)Ms.Vector.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving vector layers: ${i.message}`)}}getConfigVectorAdminLayers(){try{let i=[];for(const t in Ms.VectorAdmin)Ms.VectorAdmin.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving vectorAdmin layers: ${i.message}`)}}getConfigFGBAdminLayers(){try{let i=[];for(const t in Ms.FGBAdmin)Ms.FGBAdmin.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving FGBAdmin layers: ${i.message}`)}}async fetchData(i,t,e){try{(!e||e===void 0)&&(e={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let r=e.layerPosition;if(i.includes(".fgb"))this.addFGBLayerICGC(i,t,e);else{const s=await(await fetch(i)).json();let n=t,c=this._dealOrderLayer(r),l=s.features[0].geometry.type;l.includes("ine")&&(e!==void 0?this.map.addLayer({id:n,type:"line",source:{type:"geojson",data:s},layout:e.layout||{},paint:e.paint||{}},c):this.map.addLayer({id:n,type:"line",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},c)),l.includes("olygon")&&(e!==void 0?this.map.addLayer({id:n,type:"fill",source:{type:"geojson",data:s},layout:e.layout,paint:e.paint},c):this.map.addLayer({id:n,type:"fill",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},c)),l.includes("oint")&&(e!==void 0?this.map.addLayer({id:n,type:"circle",source:{type:"geojson",data:s},layout:e.layout,paint:e.paint},c):this.map.addLayer({id:n,type:"circle",source:{type:"geojson",data:s},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},c))}}catch(r){console.error(`Error fetching data: ${r.message}`)}}async fetchDataAndMenu(i,t,e,r){try{let s;r!==null?s=r.layerPosition:s=Pg;let n,c=document.getElementById("map");if(document.getElementById("menu-group")?n=document.getElementById("menu-group"):(n=document.createElement("nav"),n.id="menu-group",n.classList.add="filter-group",c.appendChild(n)),n!==null){let l="visible",f=this._dealOrderLayer(s),y;if(i.includes(".fgb")){let T=this._getKeyByUrlFGB(i);T===null&&(T="userFGB");const P=await fetch(i),M={type:"FeatureCollection",features:[]};for await(const G of a2(P.body))M.features.push(G);y=M;let N=t;if(this.map.addSource(N,{type:"geojson",data:M}),i.includes("text"))r!==void 0?this.map.addLayer({id:t,type:"symbol",source:N,layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"symbol",source:N,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:l,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f);else{let G=t+"Text";this.map.addLayer({id:G,type:"symbol",source:N,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:l,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)}}else y=await(await fetch(i)).json();if(e!=="all"){const T=document.createElement("div");T.id="titleDivMenu",T.textContent=t,n.appendChild(T);const P=document.createElement("div");P.id="titleDivMenuSub",P.textContent=`📂 ${e}`,n.appendChild(P)}let x;if(r.type?x=r.type:x=y.features[0].geometry.type,e==="all")x.includes("ine")&&(r!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),x.includes("olygon")&&(r!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},f)),x.includes("oint")&&(r!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},f)),x.includes("ymbol")&&(r!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint},f):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},f)),this.addMenuItem(t);else{let T=e;const P={};y.features.forEach(M=>{const N=M.properties[T],G=N+"-userFieldFilter-"+t;N!==null&&(P[G]||(x.includes("ine")&&(r!==void 0?this.map.addLayer({id:G,type:"line",source:{type:"geojson",data:y},layout:r.layout,paint:r.paint,filter:["==",`${T}`,N]},f):this.map.addLayer({id:G,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${T}`,N],paint:{"line-color":"black","line-width":2,"line-opacity":1}},f)),x.includes("olygon")&&(r!==void 0?this.map.addLayer({id:G,type:"fill",source:{type:"geojson",data:y},filter:["==",`${T}`,N],layout:r.layout,paint:r.paint},f):this.map.addLayer({id:G,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${T}`,N],paint:{"fill-color":"blue","fill-opacity":.6}},f)),x.includes("oint")&&(r!==void 0?this.map.addLayer({id:G,type:"circle",source:{type:"geojson",data:y},filter:["==",`${T}`,N],layout:r.layout,paint:r.paint},f):this.map.addLayer({id:G,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${T}`,N],paint:{"circle-color":"red","circle-opacity":.85}},f)),P[G]=!0,this.addMenuItem(G)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(i,t){setTimeout(()=>{try{this.map.on(i,t)}catch(e){console.error(`Error adding event ON listener: ${e.message}`)}},500)}getSource(i){try{return this.map.getSource(i)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(i,t){try{this.map.addSource(i,t)}catch(e){console.error(`Error adding source: ${e.message}`)}}setStyle(i,t){try{t!==void 0?this.map.setStyle(i,t):this.map.setStyle(i),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var e=window.document.querySelector(".maplibregl-compact-show");e.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(e){console.error(`Error setting style: ${e.message}`)}}getLayer(i){try{return this.map.getLayer(i)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(i,t,e){try{return this.map.setFilter(i,t,e)}catch(r){console.error(`Error setting filter: ${r.message}`)}}jumpTo(i){try{this.map.jumpTo(i)}catch(t){console.error(`Error jumping to ${i}: ${t.message}`)}}setLayoutProperty(i,t,e){try{this.map.setLayoutProperty(i,t,e)}catch(r){console.error(`Error setting layout property: ${r.message}`)}}setPaintProperty(i,t,e){try{this.map.setPaintProperty(i,t,e)}catch(r){console.error(`Error setting paint property: ${r.message}`)}}addControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(i,t)}catch(e){console.error(`Error adding control: ${e.message}`)}}getZoom(){try{return this.map.getZoom()}catch(i){console.error(`Error getting zoom level: ${i.message}`)}}addMouseCoordControl(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new kq(i),t)}catch(e){console.error(`Error adding mouse coordinate control: ${e.message}`)}}addGeolocateControl(i,t){try{t===void 0&&(t="top-right"),i===void 0?this.map.addControl(new gn.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new gn.GeolocateControl(i),t)}catch(e){console.error(`Error adding geolocate control: ${e.message}`)}}addFullscreenControl(i,t){try{t===void 0&&(t="top-right"),i===void 0?this.map.addControl(new gn.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new gn.FullscreenControl(i),t)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}getBounds(){try{return this.map.getBounds()}catch(i){console.error(`Error getting bounds: ${i.message}`)}}getCenter(){try{return this.map.getCenter()}catch(i){console.error(`Error getting center: ${i.message}`)}}setTerrain(i){try{return this.map.setTerrain(i)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(i,t,e){try{return this.map.setLayerZoomRange(i,t,e)}catch(r){console.error(`Error setting terrain: ${r.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(i){console.error(`Error getting canvas: ${i.message}`)}}setCenter(i){try{return this.map.setCenter(i)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(i,t){try{this.map.addLayer(i,t)}catch(e){console.error(`Error adding layer: ${e.message}`)}}addLayerGeoJSON(i,t){try{let e=this._dealOrderLayer(t);this.map.addSource(`${i.id}`,{type:"geojson",data:i.data}),this.map.addLayer({id:`${i.id}-layerIcgcMap`,type:i.layerType,source:`${i.id}`,layout:i.layout,paint:i.paint},e)}catch(e){console.error(`Error adding GeoJSON layer: ${e.message}`)}}addLayerWMS(i,t,e){try{let r=this._dealOrderLayer(e.layerPosition);e?(this.map.addSource(`${t}`,{type:"raster",tiles:[i],tileSize:256},r),this.map.addLayer({id:t,type:"raster",source:t,layout:e.layout,paint:e.paint},r)):(this.map.addSource(`${t}`,{type:"raster",tiles:[i],tileSize:256},r),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},r))}catch(r){console.error(`Error adding WMS layer: ${r.message}`)}}removeControl(i){try{this.map.removeControl(i)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(i){try{this.map.removeLayer(i)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(i){try{this.map.removeSource(i)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(i){try{const t=document.createElement("img");t.src=i.url,t.style.height=i.height;const e=document.getElementById("logos"),r=document.createElement("a");r.id=i.id,r.href=i.href,r.target="_blank",r.style.position="relative",r.style.bottom="1px",r.appendChild(t),e.appendChild(r)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(i){try{const t=n=>{this.map.setStyle(n)};let e=document.getElementById("map"),r;r=document.createElement("div"),r.id="basemap-group",r.classList.add="filter-group",e.appendChild(r);const s=document.getElementById("basemap-group");for(const n of i)for(const c of Object.keys(wr.baseStyles)){const l=wr.baseStyles[c];if(n===l.url){const f=document.createElement("div");f.className="basemap-item",f.title=l.key,f.style.backgroundImage=`url('${l.image}')`,s.appendChild(f),f.addEventListener("click",()=>t(l.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(i){try{const t=r=>{map.setStyle(r.url)},e=document.getElementById("basemap-group");i.forEach(r=>{const s=document.createElement("div");s.className="basemap-item",s.title=r.label,s.style.backgroundImage=`url('${r.image}')`,e.appendChild(s),s.addEventListener("click",()=>t(r))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(i,t,e){try{let r;this.map.on("mouseenter",i,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",i,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let n=this.map.queryRenderedFeatures(s.point);if(n&&n[0].source.includes(i)){let c=[s.lngLat.lng,s.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let l="";t.forEach(f=>{let y=n[0].properties[f];l=l+`<h4>${y}</h4>`}),r=l,map.addPopup(c,r,e)}}else{let l="";for(const f in n[0].properties)l+="<b>"+f+"</b>:"+n[0].properties[f]+"<br>";r=l,map.addPopup(c,r,e)}}})}catch(r){console.error(`Error adding feature query: ${r.message}`)}}addScaleControl(i,t){try{var e=new gn.ScaleControl(i);this.map.addControl(e,t)}catch(r){console.error(`Error adding scale: ${r.message}`)}}addExportControl(i,t){try{typeof i=="string"&&(t=i,i=void 0),i===void 0&&(i={PageSize:Eu.A4,PageOrientation:zp.Landscape,Format:Vc.PNG,DPI:j_[300],Crosshair:!0,PrintableArea:!0},t="top-right"),this.map.addControl(new OV(i),t)}catch(e){console.error(`Error adding export control: ${e.message}`)}}addPopup(i,t){try{new gn.Popup().setLngLat(i).setHTML(t).addTo(this.map)}catch{}}addMarker(i){try{let t,e;return i.text===void 0?t=new gn.Marker(i.options).setLngLat(i.coord).addTo(this.map):(e=new gn.Popup({offset:i.textOffset}).setHTML(i.text),t=new gn.Marker().setLngLat(i.coord).setPopup(e).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(i,t,e){try{return e.image===void 0?new gn.Popup().setLngLat(i).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${e.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new gn.Popup().setLngLat(i).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${e.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${e.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(r){return console.error(`Error adding popup: ${r.message}`),null}}addFullScreen(i){try{i===void 0&&(i="top-right"),this.map.addControl(new gn.FullscreenControl,i)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(i){try{let t;if(i.includes("-userFieldFilter-")?t=i.split("-userFieldFilter-")[0]:t=i,i.length>0){const e=document.getElementById("menu-group"),r=document.createElement("input");r.type="checkbox",r.id=i,r.checked=!0,e.appendChild(r);const s=document.createElement("label");s.setAttribute("for",i),s.textContent=t,e.appendChild(s),r.addEventListener("change",n=>{this.map.setLayoutProperty(i,"visibility",n.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(i){try{let t=i.features;const e=document.getElementById("filter-group");this.map.addSource(`${i.id}`,{type:i.type,data:t}),t.features.forEach(r=>{const s=r.properties.icon,n=`poi-${s}`;if(!this.map.getLayer(n)){this.map.addLayer({id:n,type:"circle",source:`${i.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",s]},this._firstSymbolLayer());const c=document.createElement("input");c.type="checkbox",c.id=n,c.checked=!0,e.appendChild(c);const l=document.createElement("label");l.setAttribute("for",n),l.textContent=s,e.appendChild(l),c.addEventListener("change",f=>{this.map.setLayoutProperty(n,"visibility",f.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(new gn.NavigationControl(i),t)}catch(e){return console.error(`Error creating navigation control: ${e.message}`),null}}addNavigationControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(new gn.NavigationControl(i),t)}catch(e){console.error(`Error adding navigation control: ${e.message}`)}}addAttributionControl(i,t){try{this.map.addControl(new gn.AttributionControl(i),t)}catch(e){console.error(`Error adding attribution control: ${e.message}`)}}addImageLayerICGC(i,t,e){try{let r=null,s,n;e?(n=e,s=e.layerPosition):n={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:Pg},r=this._findImageType(i,Ms.Orto,Ms.VectorAdmin,Ms.WMS,Ms.Vector),r||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",i,"font-weight: bold; font-style: italic;");let c={id:t,tiles:i};this.addLayerWMS(i,t,n)}catch(r){console.error(`Error adding ICGC image layer: ${r.message}`)}}async addVectorLayerICGC(i,t,e){try{let{type:r="line",layerPosition:s=Pg,layoutOptions:n={visibility:"visible"},paintOption:c}=e||{},l=this._dealOrderLayer(s);if(!i){console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",i,"font-weight: bold; font-style: italic;");return}if(i.includes("https")){let f=this._getKeyByUrlVector(i);this.map.addSource(f,{type:"vector",url:i});let y={id:f,type:"fill",source:f,"source-layer":"cobertes",maxzoom:18,layout:e.layout,paint:tW.cobertesSol};if(f==="cobertes2018"&&this.map.addLayer(y,l),n.visibility==="visible"){let x=this._getLegendByName(f);console.info("legendUrl",x),console.info("sourceName",f),this.addLegend(x,f)}}else{let f=t;this.map.addSource(f,{type:"vector",url:wr.limitsUrl});let y={id:t,type:r,source:f,"source-layer":i,layout:e.layout,paint:e.paint||{}};r==="fill"||r==="polygon"?y.paint=c||{"fill-color":"#0000FF","fill-opacity":0}:r==="line"&&(y.paint=c||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(y,l)}}catch(r){console.error(`Error adding ICGC vector layer: ${r.message}`)}}async addFGBLayerICGC(i,t,e){try{e||(e.layout={visibility:!0},e.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},e.type="lines",e.layerPosition="labels");let r=this._dealOrderLayer(e.layerPosition);const s=await fetch(i),n={type:"FeatureCollection",features:[]};for await(const l of a2(s.body))n.features.push(l);let c=t;this.map.addSource(c,{type:"geojson",data:n}),i.includes("text")?this.map.addLayer({id:t,type:"symbol",source:c,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:e.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},r):this.map.addLayer({id:t,type:e.type,source:c,layout:e.layout,paint:e.paint},r)}catch(r){console.error(`Error adding ICGC FGB layer: ${r.message}`)}}addTerrainICGC(i,t){try{let e;for(const s in Op)if(Op.hasOwnProperty(s)){const n=Op[s];n===i&&(e=n)}let r=e;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(s=>{s.source==="terrainICGC"&&this.removeLayer(s.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(i.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[r],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[r],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new mP({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(e){console.error(`Error adding 3D terrain: ${e.message}`)}}addLegend(i,t){try{this.map.addControl(new Lq({url:i,idLayer:t}))}catch(e){console.error(`Error adding legend: ${e.message}`)}}_findImageType(i,t,e,r,s){const n=[t,e,r,s];for(const c of n)for(const[l,f]of Object.entries(c))if(f===i)return l;return null}_getKeyByUrlFGB(i){for(const t in Ms.FGBAdmin)if(Ms.FGBAdmin.hasOwnProperty(t)&&Ms.FGBAdmin[t]===i)return t;return null}_getLegendByName(i){for(const t in wr.vectorLayers){const e=wr.vectorLayers[t];if(e.key===i)return e.legend}return null}_getKeyByUrlVector(i){for(const t in Ms.Vector)if(Ms.Vector.hasOwnProperty(t)&&Ms.Vector[t]===i)return t;return null}async _raiseText3DStyle(){try{const i=await this.map.loadImage(wr.map3dOptions.imageIcon);this.map.addImage("stick",i.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===wr.map3dOptions.sourceLayerFilterId&&t.minzoom>=wr.map3dOptions.minZoomFilter&&i){const e=t.id;this.map.setLayoutProperty(e,"icon-image","stick"),this.map.setLayoutProperty(e,"text-offset",[0,-9]),this.map.setLayoutProperty(e,"symbol-placement","point"),this.map.setLayoutProperty(e,"symbol-avoid-edges",!1),this.map.setLayoutProperty(e,"text-allow-overlap",!0),this.map.setLayoutProperty(e,"text-ignore-placement",!1),this.map.setLayoutProperty(e,"text-pitch-alignment","auto"),this.map.setLayoutProperty(e,"text-rotation-alignment","auto"),this.map.setLayoutProperty(e,"text-justify","center"),this.map.setLayoutProperty(e,"text-anchor","bottom"),this.map.setLayoutProperty(e,"icon-anchor","bottom"),this.map.setPaintProperty(e,"text-color","#ffffff"),this.map.setPaintProperty(e,"text-halo-color","#000000"),this.map.setPaintProperty(e,"text-halo-width",2)}})}catch(i){return console.error(`Error dealing orto 3D: ${i.message}`),null}}_dealStyleMaps(i){try{if(i&&i.indexOf("icgc.cat")!=-1){for(const t in yu)if(yu.hasOwnProperty(t)){const e=yu[t];if(t===i)return e}return yu[0]}else return i}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(i){try{if(i=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new N3({intensity:4}),e=new Z1({ambientLight:t});this.map.setTerrain({source:wr.map3dOptions.terrainSource,exaggeration:wr.map3dOptions.exaggeration});const r=this._createCitiesMapboxLayer();this.map.getLayer(wr.map3dOptions.layerId3d)||(this.map.addLayer(r,wr.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(wr.map3dOptions.layerId3d,wr.map3dOptions.minZoomRange,wr.map3dOptions.maxZoomRange),r.deck.setProps({effects:[e]}),this._raiseText3DStyle())}else this.map.getLayer(wr.map3dOptions.layerId3d)&&(this.map.removeLayer(wr.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(i){return i===Pg?this._firstSymbolLayer():i===eW?this._firstLineLayer():""}_firstSymbolLayer(){try{const i=this.map.getStyle().layers;let t;for(let e=0;e<i.length;e++)if(i[e].type==="symbol"&&i[e].id.indexOf("contour")===-1&&i[e].id.indexOf("water")===-1){console.info(i[e].id),t=i[e].id;break}return t}catch(i){console.error(`Error getting first symbol layer: ${i.message}`)}}_firstLineLayer(){try{const i=this.map.getStyle().layers;let t;for(let e=0;e<i.length;e++)if(i[e].type==="line"){t=i[e].id;break}return t}catch(i){console.error(`Error getting first symbol layer: ${i.message}`)}}_createCitiesMapboxLayer(){try{return new lF({id:wr.map3dOptions.layerId3d,type:Sv,data:wr.map3dOptions.urlTilesetCities,loader:Av,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:wr.map3dOptions.spaceErrorFactor}},onTilesetLoad:i=>{i.options.maximumScreenSpaceError=wr.map3dOptions.spaceErrorFactor},onTileLoad:i=>{i.content.cartographicOrigin.z-=wr.map3dOptions.zfactor},operation:"terrain+draw"})}catch(i){return console.error(`Error adding MapboxLayer: ${i.message}`),null}}};var rW={exports:{}};function sW(i,t){var e=i.getCenter(),r=i.getZoom(),s=i.getBearing(),n=i.getPitch();t.forEach(function(c){c.jumpTo({center:e,zoom:r,bearing:s,pitch:n})})}function nW(){var i,t=arguments.length;if(t===1)i=arguments[0];else{i=[];for(var e=0;e<t;e++)i.push(arguments[e])}var r=[];i.forEach(function(l,f){r[f]=c.bind(null,l,i.filter(function(y,x){return x!==f}))});function s(){i.forEach(function(l,f){l.on("move",r[f])})}function n(){i.forEach(function(l,f){l.off("move",r[f])})}function c(l,f){n(),sW(l,f),s()}return s(),function(){n(),r=[],i=[]}}var oW=nW;(function(i){var t=oW,e=jE.EventEmitter;function r(s,n,c,l){if(this.options=l||{},this._mapA=s,this._mapB=n,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new e,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof c=="string"&&document.body.querySelectorAll){var f=document.body.querySelectorAll(c)[0];if(!f)throw new Error("Cannot find element with specified container selector.");f.appendChild(this._controlContainer)}else if(c instanceof Element&&c.appendChild)c.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=n.getContainer().getBoundingClientRect();var y=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(y),this._clearSync=t(s,n),this._onResize=(function(){this._bounds=n.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),n.on("resize",this._onResize),this.options&&this.options.mousemove&&(s.getContainer().addEventListener("mousemove",this._onMove),n.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}r.prototype={_setPointerEvents:function(s){this._controlContainer.style.pointerEvents=s,this._swiper.style.pointerEvents=s},_onDown:function(s){s.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(s){s=Math.min(s,this._horizontal?this._bounds.height:this._bounds.width);var n=this._horizontal?"translate(0, "+s+"px)":"translate("+s+"px, 0)";this._controlContainer.style.transform=n,this._controlContainer.style.WebkitTransform=n;var c=this._horizontal?"rect(0, 999em, "+s+"px, 0)":"rect(0, "+s+"px, "+this._bounds.height+"px, 0)",l=this._horizontal?"rect("+s+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+s+"px)";this._mapA.getContainer().style.clip=c,this._mapB.getContainer().style.clip=l,this.currentPosition=s},_onMove:function(s){this.options&&this.options.mousemove&&this._setPointerEvents(s.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(s)):this._setPosition(this._getX(s))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(s){s=s.touches?s.touches[0]:s;var n=s.clientX-this._bounds.left;return n<0&&(n=0),n>this._bounds.width&&(n=this._bounds.width),n},_getY:function(s){s=s.touches?s.touches[0]:s;var n=s.clientY-this._bounds.top;return n<0&&(n=0),n>this._bounds.height&&(n=this._bounds.height),n},setSlider:function(s){this._setPosition(s)},on:function(s,n){return this._ev.on(s,n),this},fire:function(s,n){return this._ev.emit(s,n),this},off:function(s,n){return this._ev.removeListener(s,n),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var s=this._mapA.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove));var n=this._mapB.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=r:i.exports=r})(rW);async function aW(){try{const i=await uC.getConfigICGC(),t=new iW({container:"map",style:i.Styles.LIGHT,center:[1.808,41.618],zoom:10,maxZoom:19,hash:!0,pitch:0});t.on("load",()=>{t.addGeocoderICGC(),t.addGeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0},"bottom-right"),t.addExportControl({},"top-right"),t.addFullscreenControl({},"top-right"),t.addTerrainICGC(i.Terrains.ICGC5M,"bottom-right")})}catch(i){console.error(i)}}aW();export{Fr as U};
